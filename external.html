<!DOCTYPE html>
<html lang="en">

<head>


  <title>Printess-Custom-Ui</title>

  <meta charset="utf-8">

  <meta name="viewport" content="width=device-width">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">

  <!--<link href="sketchy.css" rel="stylesheet">-->

  <link type="text/css" rel="stylesheet" href="external.css" />

</head>

<body style="margin: 0; padding: 0;">

  <nav class="desktop-navbar navbar navbar-expand navbar-dark bg-primary" >

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
      aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav mr-auto" style="width: 100%;">
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown"
            aria-haspopup="true" aria-expanded="false">
            Ui
          </a>
          <div class="dropdown-menu" aria-labelledby="navbarDropdown">
            <a class="dropdown-item" href="index.html">Printess Ui</a>
            <a class="dropdown-item" href="external.html">Custom Ui</a>
          </div>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="temlateDropdown" role="button" data-bs-toggle="dropdown"
            aria-haspopup="true" aria-expanded="false">
            Open
          </a>
          <div class="dropdown-menu" id="test-template-list" aria-labelledby="temlateDropdown">
            <a class="dropdown-item" href="#Children%27s%20book">Children's book</a>
            <a class="dropdown-item" href="#Retro%20Sign">Retro Sign</a>
            <a class="dropdown-item" href="#Business%20Card">Business Card</a>
            <a class="dropdown-item" href="#Greeting%20Card">Greeting Card</a>
            <a class="dropdown-item" href="#Chocolate%20Bar">Chocolate Bar</a>
            <a class="dropdown-item" href="#Photo-Calendar%201">Photo-Calendar</a>
            <a class="dropdown-item" href="#Calendar">Calendar</a>
            <a class="dropdown-item" href="#Newborn%20Card">Newborn Card</a>
            <a class="dropdown-item" href="#Phone-Case">Phone-Case</a>
            <a class="dropdown-item" href="#Puzzle">Puzzle</a>
            <a class="dropdown-item" href="#T-shirt%202">T-Shirt</a>
            <a class="dropdown-item" href="#Coffee%20Mug">Coffee Mug</a>

            <div class="dropdown-divider">UI Test Templates</div>
            <a class="dropdown-item" href="#BuyerText-Eddi-P-or-Sel">Rich Editing with Fallback to Paragraph</a>
            <a class="dropdown-item" href="#BuyerText-No-Eddi">Form Editing with and without Paragraph Split</a>
            <a class="dropdown-item" href="#8Pages">8 Pages</a>
            <a class="dropdown-item" href="#8DoublePages">14 Facing Pages</a>
            <a class="dropdown-item" href="#8DoublePagesFF">14 Facing Pages w. FormField</a>
            <a class="dropdown-item" href="#Avatar">Avatar-Test</a>
          </div>
        </li>
        <li class="nav-item" style="flex-grow: 1;"></li>
        <li class="nav-item">
          <a class="nav-link" href="#" id="btnUndo" title="Undo">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
              class="bi bi-arrow-counterclockwise" viewBox="0 0 16 16">
              <path fill-rule="evenodd" d="M8 3a5 5 0 1 1-4.546 2.914.5.5 0 0 0-.908-.417A6 6 0 1 0 8 2v1z" />
              <path
                d="M8 4.466V.534a.25.25 0 0 0-.41-.192L5.23 2.308a.25.25 0 0 0 0 .384l2.36 1.966A.25.25 0 0 0 8 4.466z" />
            </svg>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#" id="btnRedo" title="Redo">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16"
              class="bi bi-arrow-clockwise">
              <path fill-rule="evenodd" d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z" />
              <path
                d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z" />
            </svg>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#" id="btnSelect" title="Select Frame by Property-ID">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
              class="bi bi-bounding-box-circles" viewBox="0 0 16 16">
              <path
                d="M2 1a1 1 0 1 0 0 2 1 1 0 0 0 0-2zM0 2a2 2 0 0 1 3.937-.5h8.126A2 2 0 1 1 14.5 3.937v8.126a2 2 0 1 1-2.437 2.437H3.937A2 2 0 1 1 1.5 12.063V3.937A2 2 0 0 1 0 2zm2.5 1.937v8.126c.703.18 1.256.734 1.437 1.437h8.126a2.004 2.004 0 0 1 1.437-1.437V3.937A2.004 2.004 0 0 1 12.063 2.5H3.937A2.004 2.004 0 0 1 2.5 3.937zM14 1a1 1 0 1 0 0 2 1 1 0 0 0 0-2zM2 13a1 1 0 1 0 0 2 1 1 0 0 0 0-2zm12 0a1 1 0 1 0 0 2 1 1 0 0 0 0-2z" />
            </svg>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#" id="btnClearSelection" title="Clear Selection">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-x-circle"
              viewBox="0 0 16 16">
              <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" />
              <path
                d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z" />
            </svg>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#" id="btnDelete" title="Delete Selected Frames">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-trash"
              viewBox="0 0 16 16">
              <path
                d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z" />
              <path fill-rule="evenodd"
                d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z" />
            </svg>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#" id="btnShowJson" title="Show Properties JSON" data-bs-toggle="offcanvas"
            data-bs-target="#jsonOffcanvas">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-code"
              viewBox="0 0 16 16">
              <path
                d="M5.854 4.854a.5.5 0 1 0-.708-.708l-3.5 3.5a.5.5 0 0 0 0 .708l3.5 3.5a.5.5 0 0 0 .708-.708L2.707 8l3.147-3.146zm4.292 0a.5.5 0 0 1 .708-.708l3.5 3.5a.5.5 0 0 1 0 .708l-3.5 3.5a.5.5 0 0 1-.708-.708L13.293 8l-3.147-3.146z" />
            </svg>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#" id="btnSave" title="Save Current Artwork">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
              class="bi bi-cloud-arrow-up-fill" viewBox="0 0 16 16">
              <path
                d="M8 2a5.53 5.53 0 0 0-3.594 1.342c-.766.66-1.321 1.52-1.464 2.383C1.266 6.095 0 7.555 0 9.318 0 11.366 1.708 13 3.781 13h8.906C14.502 13 16 11.57 16 9.773c0-1.636-1.242-2.969-2.834-3.194C12.923 3.999 10.69 2 8 2zm2.354 5.146a.5.5 0 0 1-.708.708L8.5 6.707V10.5a.5.5 0 0 1-1 0V6.707L6.354 7.854a.5.5 0 1 1-.708-.708l2-2a.5.5 0 0 1 .708 0l2 2z" />
            </svg>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#" id="btnLoad" title="Load Artwork by ID">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
              class="bi bi-cloud-arrow-down" viewBox="0 0 16 16">
              <path fill-rule="evenodd"
                d="M7.646 10.854a.5.5 0 0 0 .708 0l2-2a.5.5 0 0 0-.708-.708L8.5 9.293V5.5a.5.5 0 0 0-1 0v3.793L6.354 8.146a.5.5 0 1 0-.708.708l2 2z" />
              <path
                d="M4.406 3.342A5.53 5.53 0 0 1 8 2c2.69 0 4.923 2 5.166 4.579C14.758 6.804 16 8.137 16 9.773 16 11.569 14.502 13 12.687 13H3.781C1.708 13 0 11.366 0 9.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383zm.653.757c-.757.653-1.153 1.44-1.153 2.056v.448l-.445.049C2.064 6.805 1 7.952 1 9.318 1 10.785 2.23 12 3.781 12h8.906C13.98 12 15 10.988 15 9.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 4.825 10.328 3 8 3a4.53 4.53 0 0 0-2.941 1.1z" />
            </svg>
          </a>
        </li>



      </ul>

    </div>
  </nav>


  <nav class="page-buttons">
  </nav>

  <button class="show-layouts-button btn btn-primary" type="button" data-bs-toggle="offcanvas"
    data-bs-target="#layoutOffcanvas" aria-controls="layoutOffcanvas">
    Change Layout
  </button>

  <div class="offcanvas offcanvas-start" data-bs-backdrop="false" tabindex="-1" id="layoutOffcanvas"
    aria-labelledby="offcanvasLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="offcanvasLabel">Layouts</h5>
      <button type="button" class="btn-close text-reset" id="closeLayoutOffCanvas" data-bs-dismiss="offcanvas"
        aria-label="Close"></button>
    </div>
    <div id="layoutSnippets" class="offcanvas-body">
    </div>
  </div>

  <!-- JSON DEBUG VIEW -->

  <div class="offcanvas offcanvas-start" data-bs-backdrop="false" tabindex="-1" id="jsonOffcanvas"
    aria-labelledby="offcanvasLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="offcanvasLabel">Properties JSON</h5>
      <button type="button" class="btn-close text-reset" id="closeJsonOffCanvas" data-bs-dismiss="offcanvas"
        aria-label="Close"></button>
    </div>
    <pre id="propertiesJson" class="offcanvas-body">
    </pre>
  </div>

  <div id="desktop-properties"></div>


  <div id="printessin"></div>




  <div class="token-warning">
    <h4>This site is using a test token. </h4>
    You will not be able to modify or print the template.
    Please contact us to get your personal token.
  </div>

  <!-- Bootstrap -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4"
    crossorigin="anonymous"></script>

  <!-- Load polyfills -->
  <script src="https://editor.printess.com/node_modules/@webcomponents/webcomponentsjs/webcomponents-loader.js"></script>

  <script src="external.js"></script>

  <!-- Load components via WebComponents.waitFor -->
  <script>

    let printess;
    let currentGroupSnippets = [];
    let templateTitle = "";
   
    window.WebComponents = window.WebComponents || {
      waitFor(cb) {
        addEventListener('WebComponentsReady', cb)
      }
    };


    window.addEventListener("resize", () => resizePrintess());

    function resizePrintess() {
      if (printess) {
        printess.resizePrintess();
      } else {
        window.setTimeout(resizePrintess, 100);
      }
    }

    const loadingDoneCallback = function (spreads, title) {
      uiHelper.renderPageNavigation(printess, spreads);
      templateTitle = title;
      printess.resizePrintess();
    }

    const spreadChangeCallback = (groupSnippets, layoutSnippets, spread, spreadCount) => {
 
      uiHelper.renderMobileNavBar(printess);

      // remember groupSnippets for showing as add-able items
      currentGroupSnippets = groupSnippets

      const desktop = document.getElementById("desktop-properties");

      if (!desktop) {
        throw "#desktop-properties not found, please add to html.";
      }
      desktop.innerHTML = "";


      const layoutSnippetsDiv = document.getElementById("layoutSnippets");
      layoutSnippetsDiv.innerHTML = "";
      layoutSnippetsDiv.appendChild(uiHelper.renderLayoutSnippets(printess, layoutSnippets));
      document.querySelector(".show-layouts-button").style.visibility = layoutSnippets.length ? "visible" : "hidden";

      uiHelper.renderLayoutSnippets(printess, layoutSnippets)

      /* Get Information of all properties on this spread */
      /* printess.getAllPropertiesBySpreadId(spread.id)
         .then((props) => {
           console.warn("ALL PROPERTIES:", props);
         })*/


    }

    const selectionChangeCallback = (properties, state) => {

      // state is "document" or "frames"
      const desktop = document.getElementById("desktop-properties");
      if (!desktop) {
        throw "#desktop-properties not found, please add to html.";
      }
      desktop.innerHTML = "";

      const t = [];

      // render mobile page navigation if document has properties 
      if (state === "document") {
        if (properties.length === 0 || printess.spreadCount() < 2) {
          // sets css varibale --mobile-pagebar-height: 0px;
          document.body.classList.add("inline-mobile-page-bar");
        } else {
          document.body.classList.remove("inline-mobile-page-bar");
        }
      }

      // add mobile - ui 
      uiHelper.renderMobileUi(printess, properties, state, currentGroupSnippets);

      if (state === "document") {
        //****** Show Document Wide Options
        desktop.appendChild(uiHelper.getTitle(templateTitle))
        for (const p of properties) {
          t.push(JSON.stringify(p, undefined, 2));
          desktop.appendChild(uiHelper.getPropertyControl(printess, p));
        }
        desktop.appendChild(uiHelper.renderGroupSnippets(printess, currentGroupSnippets, false))

      } else {
        desktop.appendChild(uiHelper.getTitle(templateTitle))
        //****** Show Just the frame / text Properties
        let colorsContainer = null;
        for (const p of properties) {
          if (p.kind === "color") {
            if (!colorsContainer) {
              colorsContainer = document.createElement("div");
              colorsContainer.className = "color-drop-down-list";
              desktop.appendChild(colorsContainer);
            }
            colorsContainer.appendChild(uiHelper.getPropertyControl(printess, p))
          } else {
            colorsContainer = null;
            desktop.appendChild(uiHelper.getPropertyControl(printess, p));
          }
          t.push(JSON.stringify(p, undefined, 2));
        }
        const hr = document.createElement("hr");
        desktop.appendChild(hr);
        desktop.appendChild(uiHelper.getDoneButton(printess));
      }

      // print json for debug purposes
      const jsonPre = document.getElementById("propertiesJson");
      if (jsonPre) {
        jsonPre.innerHTML = t.join("<br/>");
      }
    }


    const getOverlayCallback = (properties) => {
      return uiHelper.getOverlay(printess, properties);
    }


    // Add a Printess token, you can get it on printess.com
    let token = "";

    if (!token) {
      token = "eyJhbGciOiJSUzI1NiIsImtpZCI6InByaW50ZXNzLXNhYXMtYWxwaGEiLCJ0eXAiOiJKV1QifQ.eyJzdWIiOiJneTh6NDRFbUxpWjB2clVLclhsV3RpWlkxNUQyIiwianRpIjoibnl4NGJFZlZ5SVVvM1NkR2dYVnEtempzS3hlb0FYZUYiLCJyb2xlIjoic2hvcCIsIm5iZiI6MTYxODg2ODUxMSwiZXhwIjoxOTM0MjI4NTExLCJpYXQiOjE2MTg4Njg1MTEsImlzcyI6IlByaW50ZXNzIEdtYkggJiBDby5LRyIsImF1ZCI6InByaW50ZXNzLXNhYXMifQ.CuI6zdCzBm2y3t2GBD4pYdyztFzSeSEfdGIDBeiZIYvzQckB9oEB1Z4hDkBCGZGBtTMRyuHCbkwZgO6uxD-ZyahifiqrIqfqSqtFEGwgZUF87TvV_KlrYWBzDNTaUIQjr-yUoxLkdnEMzh-3D5qV8UKWIDfqwnYd0KhJiB2K9CSg82_etnz5Lk-altMDAT8b1AnzxcjRAJ9_b6-CAJFXG6AAnfdl7c_PS3sD-RPOkJ75Ta2glfikIiGZzfh09bn5Ptk7rucRdxUsLCLR6m5nUFpZbV77d2eqRw8pT4Kl-5by5gvMr1wUBGbEx751CNXtcCO3qk4uNnptfZ3yCpK0Z2FOo2CYLZBzmDiYCrdFV5U-_SZuVOEl8vk0uR3tj_PQci_R7MlQOjpB4NjlKckQ2zGvBSKNeupuiC71UZ2AT5BFlbqMsuYu0necIztyKiWsBmbniVlLe-v7_paP1N4nS2haD2n4s4N_CenJqijtPggWsITfoLm2twCOe7yNB5IH7bcEFv1-MbANuaFmJVLOcTfc89Zi-mkidaHV-n_9qXypzyB-ih_27YBNluRGwcHgTEkbJecSssMfvHSt1MUuqX-8gbl7bhFGryqHA2gMoSZNDW0LkSYig2K3poOUumD67vtYdNSPLhOmDK4ck9wLAKLOvk6dtywg2qfV-58_VbI";
      document.querySelector(".token-warning").style.display = "block";
    }



    window.WebComponents.waitFor(async () => {
      const printessLoader = await import('https://editor.printess.com/printess-editor/printess-editor.js');
      printess = await printessLoader.attachPrintess({
        resourcePath: "https://editor.printess.com/printess-editor", // relative or absolute path to where the printess-editor directory is. E.g. http://mydomain.com/library 

        div: document.getElementById("printessin"),


        domain: "api.printess.com",
        token: token, // your printess shop-token
        basketId: "CurrentShopBasketId", // your shop  sessionId or baskedId
        shopUserId: "CurrentShopCustomerId", // optional the userId of your shop customer

        templateName: decodeURIComponent(window.location.hash.substr(1)) || "Greeting Card",
        templateJson: undefined, // will be used only if templateName is empty
        templateUserId: undefined, // only needed when loaded from different account
        /* mergeTemplates: [
           {
             templateName: "set2",
             templateUserId: undefined // only needed when loaded from different account 
             // add spread-number (offset) for placing backsides, etc. 
           }
        ],*/

        hideControls: true,
        allowZoomAndPan: true,
        zoomDuration: 0.5, // in seconds 
        /* autoScale: {
          maxWidth: 420,
          maxHeight: 800,
        },*/

        loadingDoneCallback: loadingDoneCallback,
        selectionChangeCallback: selectionChangeCallback,
        spreadChangeCallback: spreadChangeCallback,
        getOverlayCallback: getOverlayCallback,

      });

      // listen to viual viewport changes to detect virtual keyboard on iOs
      if (window.visualViewport) {
        // window.visualViewport.addEventListener("resize", () => uiHelper.viewPortResize(printess))
        window.visualViewport.addEventListener("scroll", () => uiHelper.viewPortScroll(printess))
      }

    });


    document.getElementById("btnUndo").onclick = () => {
      printess.undo();
      selectionChangeCallback([]);
    };
    document.getElementById("btnRedo").onclick = () => {
      printess.redo();
      selectionChangeCallback([]);
    };

    document.getElementById("btnSelect").onclick = () => {
      const id = prompt("Paste propertyId ...");
      if (id) {
        printess.selectFrames(id);
      }
    };

    document.getElementById("btnClearSelection").onclick = () => {
      printess.clearSelection();
      printess.resizePrintess();
    };
    document.getElementById("btnDelete").onclick = () => {
      printess.deleteSelectedFrames();
    };

    document.getElementById("btnSave").onclick = () => {
      printess.saveJson().then(id => {
        navigator.clipboard.writeText(id).then(function () {
          /* clipboard successfully set */
          prompt("Saved Artwork and copied ID to clipboard:", id);
        }, function () {
          alert("Copy failed!");
        });
      })

    };
    document.getElementById("btnLoad").onclick = () => {
      navigator.clipboard.readText().then(
        clipText => {
          const newId = prompt("Load Saved Artwork by ID:", clipText);
          if (newId) printess.loadJson(newId);
        });
    };

    window.addEventListener('hashchange', function () {
      const id = decodeURIComponent(window.location.hash.substr(1));
      const list = document.getElementById("test-template-list");
      if (list) list.style.display = "none";
      let pagebar = document.querySelector(".mobile-pagebar");
      if (pagebar) pagebar.parentElement.removeChild(pagebar); // will be re-attached when needed
      if (id) printess.loadTemplate(decodeURIComponent(window.location.hash.substr(1)));
    }, false);



  </script>

</body>

</html>