<!DOCTYPE html>
<html lang="en">

<head>


  <title>Printess-Test-Page</title>

  <meta charset="utf-8">

  <meta name="viewport" content="width=device-width">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">

  <link type="text/css" rel="stylesheet" href="external.css" />

</head>

<body style="margin: 0; padding: 0;">

  <div class="page-buttons">
  </div>
  <button class="show-layouts-button btn btn-primary" type="button" data-bs-toggle="offcanvas"
    data-bs-target="#layoutOffcanvas" aria-controls="layoutOffcanvas">
    Change Layout
  </button>



  <div class="offcanvas offcanvas-start" data-bs-backdrop="false" tabindex="-1" id="layoutOffcanvas"
    aria-labelledby="offcanvasLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="offcanvasLabel">Layouts</h5>
      <button type="button" class="btn-close text-reset" id="closeLayoutOffCanvas" data-bs-dismiss="offcanvas"
        aria-label="Close"></button>
    </div>
    <div id="layoutSnippets" class="offcanvas-body">

    </div>
  </div>

  <div id="desktop-properties"></div>
  <pre id="json"></pre>

  <div id="printessin"></div>

  <div class="button-bar">

    <select onchange="location = this.value;">
      <option value="index.html">Printess Ui</option>
      <option selected value="external.html">Custom Ui</option>
    </select>
    <select id="loadTemplate">
      <option disabled selected>Load Template ...</option>
      <option value="Children's book">Children's book</option>
      <option value="Retro Sign">Retro Sign</option>
      <option value="Business Card">Business Card</option>
      <option selected value="Greeting Card">Greeting Card</option>
      <option value="Chocolate Bar">Chocolate Bar</option>
      <option value="Photo-Calendar 1">Photo-Calendar 1</option>
      <option value="Calendar">Calendar</option>
      <option value="Newborn Card">Newborn Card</option>
      <option value="Phone-Case">Phone-Case</option>
      <option value="Puzzle">Puzzle</option>
      <option value="T-Shirt">T-shirt 2</option>
      <option value="Coffee Mug">Coffee Mug</option>
    </select>
    <div></div>
    <button id="btnUndo">Undo</button>
    <button id="btnRedo">Redo</button>
    <div></div>
    <button id="btnSelect">Select Frames</button>
    <button id="btnClearSelection">Clear Selection</button>
    <button id="btnDelete">Delete Frames</button>
    <div></div>
    <button id="btnGetJson">Get JSON</button>
    <button id="btnSetJson">Set JSON</button>
  </div>

  <div class="token-warning">
    <h4>This site is using a test token. </h4>
    You will not be able to modify or print the template.
    Please contact us to get your personal token.
  </div>

  <!-- Bootstrap -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4"
    crossorigin="anonymous"></script>

  <!-- Load polyfills -->
  <script src="https://editor.printess.com/node_modules/@webcomponents/webcomponentsjs/webcomponents-loader.js"></script>

  <script src="external.js"></script>

  <!-- Load components via WebComponents.waitFor -->
  <script>

    let printess;
    let currentGroupSnippets = [];

    window.WebComponents = window.WebComponents || {
      waitFor(cb) {
        addEventListener('WebComponentsReady', cb)
      }
    };


    window.addEventListener("resize", () => {
      printess.resizePrintess();
    });

    const loadingDoneCallback = function (spreads, properties) {
      uiHelper.renderPageNavigation(printess, spreads, properties)
    }

    const spreadChangeCallback = (groupSnippets, layoutSnippets, spread, spreadCount) => {

      uiHelper.renderMobileToolbar(printess);      

      // remember groupSnippets for showing as add-able items
      currentGroupSnippets = groupSnippets

      const desktop = document.getElementById("desktop-properties");
      const jsonPre = document.getElementById("json");

      if (!desktop) {
        throw "#desktop-properties not found, please add to html.";
      }
      desktop.innerHTML = "";

      const layoutSnippetsDiv = document.getElementById("layoutSnippets");
      layoutSnippetsDiv.innerHTML = "";
      layoutSnippetsDiv.appendChild(uiHelper.renderLayoutSnippets(printess, layoutSnippets));
      document.querySelector(".show-layouts-button").style.visibility = layoutSnippets.length ? "visible" : "hidden";

      uiHelper.renderLayoutSnippets(printess, layoutSnippets)

      /* Get Information of all properties on this spread */
      /* printess.getAllPropertiesBySpreadId(spread.id)
         .then((props) => {
           console.warn("ALL PROPERTIES:", props);
         })*/

    }

    const selectionChangeCallback = (properties, scope) => {

      const desktop = document.getElementById("desktop-properties");
      if (!desktop) {
        throw "#desktop-properties not found, please add to html.";
      }
      desktop.innerHTML = "";

      const t = [];

      // add mobile - ui 
      const mobile = document.querySelector(".mobile-ui");
      if (mobile) {
        mobile.parentElement.removeChild(mobile);
      }
      document.body.appendChild(uiHelper.getMobileUi(printess, properties));


      if (scope === "document") {
        //****** Show Document Wide Options
        for (const p of properties) {
          t.push(JSON.stringify(p, undefined, 2));
          desktop.appendChild(uiHelper.getPropertyControl(printess, p));
        }
        desktop.appendChild(uiHelper.renderGroupSnippets(printess, currentGroupSnippets))

      } else {
        //****** Show Just the frame / text Properties
        let colorsContainer = null;
        for (const p of properties) {
          if (p.kind === "color") {
            if (!colorsContainer) {
              colorsContainer = document.createElement("div");
              colorsContainer.className = "color-drop-down-list";
              desktop.appendChild(colorsContainer);
            }
            colorsContainer.appendChild(uiHelper.getPropertyControl(printess, p))
          } else {
            colorsContainer = null;
            desktop.appendChild(uiHelper.getPropertyControl(printess, p));
          }
          t.push(JSON.stringify(p, undefined, 2));
        }
        const hr = document.createElement("hr");
        desktop.appendChild(hr);
        desktop.appendChild(uiHelper.getDoneButton(printess));
      }

      // print json for debug purposes
      const jsonPre = document.getElementById("json");
      if (jsonPre) {
        jsonPre.innerHTML = t.join("<br/>");
      }
    }


    const getOverlayCallback = (properties) => {
      return uiHelper.getOverlay(printess, properties);
    }


    // Add a Printess token, you can get it on printess.com
    let token = "";

    if (!token) {
      token = "eyJhbGciOiJSUzI1NiIsImtpZCI6InByaW50ZXNzLXNhYXMtYWxwaGEiLCJ0eXAiOiJKV1QifQ.eyJzdWIiOiJneTh6NDRFbUxpWjB2clVLclhsV3RpWlkxNUQyIiwianRpIjoibnl4NGJFZlZ5SVVvM1NkR2dYVnEtempzS3hlb0FYZUYiLCJyb2xlIjoic2hvcCIsIm5iZiI6MTYxODg2ODUxMSwiZXhwIjoxOTM0MjI4NTExLCJpYXQiOjE2MTg4Njg1MTEsImlzcyI6IlByaW50ZXNzIEdtYkggJiBDby5LRyIsImF1ZCI6InByaW50ZXNzLXNhYXMifQ.CuI6zdCzBm2y3t2GBD4pYdyztFzSeSEfdGIDBeiZIYvzQckB9oEB1Z4hDkBCGZGBtTMRyuHCbkwZgO6uxD-ZyahifiqrIqfqSqtFEGwgZUF87TvV_KlrYWBzDNTaUIQjr-yUoxLkdnEMzh-3D5qV8UKWIDfqwnYd0KhJiB2K9CSg82_etnz5Lk-altMDAT8b1AnzxcjRAJ9_b6-CAJFXG6AAnfdl7c_PS3sD-RPOkJ75Ta2glfikIiGZzfh09bn5Ptk7rucRdxUsLCLR6m5nUFpZbV77d2eqRw8pT4Kl-5by5gvMr1wUBGbEx751CNXtcCO3qk4uNnptfZ3yCpK0Z2FOo2CYLZBzmDiYCrdFV5U-_SZuVOEl8vk0uR3tj_PQci_R7MlQOjpB4NjlKckQ2zGvBSKNeupuiC71UZ2AT5BFlbqMsuYu0necIztyKiWsBmbniVlLe-v7_paP1N4nS2haD2n4s4N_CenJqijtPggWsITfoLm2twCOe7yNB5IH7bcEFv1-MbANuaFmJVLOcTfc89Zi-mkidaHV-n_9qXypzyB-ih_27YBNluRGwcHgTEkbJecSssMfvHSt1MUuqX-8gbl7bhFGryqHA2gMoSZNDW0LkSYig2K3poOUumD67vtYdNSPLhOmDK4ck9wLAKLOvk6dtywg2qfV-58_VbI";
      document.querySelector(".token-warning").style.display = "block";
    }


    window.WebComponents.waitFor(async () => {
      const printessLoader = await import('https://editor.printess.com/printess-editor/printess-editor.js');
      printess = await printessLoader.attachPrintess({
        resourcePath: "https://editor.printess.com/printess-editor", // relative or absolute path to where the printess-editor directory is. E.g. http://mydomain.com/library 

        div: document.getElementById("printessin"),
        /* autoScale: {
           maxWidth: 420,
           maxHeight: 800,
         },*/

        domain: "api.printess.com",
        token: token, // your printess shop-token
        basketId: "CurrentShopBasketId", // your shop  sessionId or baskedId
        shopUserId: "CurrentShopCustomerId", // optional the userId of your shop customer

        templateName: "Greeting Card",
        templateJson: undefined, // will be used only if templateName is empty
        templateUserId: undefined, // only needed when loaded from different account
        /* mergeTemplates: [
           {
             templateName: "set2",
             templateUserId: undefined // only needed when loaded from different account 
             // add spread-number (offset) for placing backsides, etc. 
           }
         ],*/
        hideControls: true,
        allowZoomAndPan: false,
        zoomDuration: 0.5, // in seconds 
        loadingDoneCallback: loadingDoneCallback,
        selectionChangeCallback: selectionChangeCallback,
        spreadChangeCallback: spreadChangeCallback,
        getOverlayCallback: getOverlayCallback,
        forceMultilineFormEditing: false,
        splitMultilineToParagraphs: false,
        enterImageCropingOnSelect: false,
        singleSelectionOnly: false,
        applyImageEffectsInCropMode: true,
        scaledImageMinimumDpi: 180

      });
    });


    document.getElementById("btnUndo").onclick = () => {
      printess.undo();
      selectionChangeCallback([]);
    };
    document.getElementById("btnRedo").onclick = () => {
      printess.redo();
      selectionChangeCallback([]);
    };


    document.getElementById("btnSelect").onclick = () => {
      const id = prompt("Paste propertyId ...");
      if (id) {
        printess.selectFrames(id);
      }
    };

    document.getElementById("btnClearSelection").onclick = () => {
      printess.clearSelection();
    };
    document.getElementById("btnDelete").onclick = () => {
      printess.deleteSelectedFrames();
    };

    document.getElementById("btnGetJson").onclick = () => {
      navigator.clipboard.writeText(printess.getJson()).then(function () {
        /* clipboard successfully set */
        alert("JSON copied to clipboard");
      }, function () {
        alert("Copy failed!");
      });
    };
    document.getElementById("btnSetJson").onclick = () => {
      navigator.clipboard.readText().then(
        clipText => {
          printess.setJson(clipText);
        });
    };
    document.getElementById("loadTemplate").onchange = () => {
      // alert(document.getElementById("loadTemplate").value);
      printess.loadTemplate(document.getElementById("loadTemplate").value);
    };


  </script>

</body>

</html>