<!DOCTYPE html>
<html lang="en">

<head>

  <title>Printess iFrame Plain Example</title>

  <meta charset="utf-8">

  <!--Please always add the correct viewport to ensure Printess works fine on mobile devices-->
  <meta name="viewport" content="width=device-width, interactive-widget=resizes-content">

  <style>
    /* Counter act the Safari viewport-height bug */
    html {
      height: -webkit-fill-available;
    }

    body {
      margin: 0;
      padding: 0;
      height: 100vh;
      height: -webkit-fill-available;
    }

    iframe {
      width: 100vw;
      height: 100%;
      border: none;
      display: block;
      position: fixed;
      top: 0;
      left: 0;
    }
  </style>

</head>

<body">

  <script>

    function loadPrintess() {
      const iframe = document.getElementById("printess");

      /* **************************** */
      /* listen to printess callbacks */
      /* **************************** */
      window.addEventListener("message", () => {
        switch (event.data.cmd) {

          case "back":
            alert("Back to catalog. save-token:" + event.data.token);
            break;

          case "basket":
            prompt("Proceed to checkout.\n\nsave-token:\n" + event.data.token + "\n\nThumbnailUrl:", event.data.thumbnailUrl);
            break;

          case "save":
            prompt("Save button pressed.\n\nsave-token:\n", + event.data.token);
            break;

          case "load":
            alert("Please show ui to load a new template.");
            break;

          case "formFieldChanged":
            /* You can react to changes of price-relevant form fields here */
            console.log("Form Field: [" + event.data.name + "] changed to '" + event.data.value + "'");
            console.log("label: [" + event.data.label + "]");
            console.log("tag: [" + event.data.tag + "]");

        }
      });

      /* *************************** */
      /*    load Printess editor     */
      /* *************************** */
      iframe.contentWindow.postMessage({
        cmd: "attach", properties: {

          /* Paste your Printess shop-token here */
          token: "eyJhbGciOiJSUzI1NiIsImtpZCI6InByaW50ZXNzLXNhYXMtYWxwaGEiLCJ0eXAiOiJKV1QifQ.eyJzdWIiOiJneTh6NDRFbUxpWjB2clVLclhsV3RpWlkxNUQyIiwianRpIjoibnl4NGJFZlZ5SVVvM1NkR2dYVnEtempzS3hlb0FYZUYiLCJyb2xlIjoic2hvcCIsIm5iZiI6MTYxODg2ODUxMSwiZXhwIjoxOTM0MjI4NTExLCJpYXQiOjE2MTg4Njg1MTEsImlzcyI6IlByaW50ZXNzIEdtYkggJiBDby5LRyIsImF1ZCI6InByaW50ZXNzLXNhYXMifQ.CuI6zdCzBm2y3t2GBD4pYdyztFzSeSEfdGIDBeiZIYvzQckB9oEB1Z4hDkBCGZGBtTMRyuHCbkwZgO6uxD-ZyahifiqrIqfqSqtFEGwgZUF87TvV_KlrYWBzDNTaUIQjr-yUoxLkdnEMzh-3D5qV8UKWIDfqwnYd0KhJiB2K9CSg82_etnz5Lk-altMDAT8b1AnzxcjRAJ9_b6-CAJFXG6AAnfdl7c_PS3sD-RPOkJ75Ta2glfikIiGZzfh09bn5Ptk7rucRdxUsLCLR6m5nUFpZbV77d2eqRw8pT4Kl-5by5gvMr1wUBGbEx751CNXtcCO3qk4uNnptfZ3yCpK0Z2FOo2CYLZBzmDiYCrdFV5U-_SZuVOEl8vk0uR3tj_PQci_R7MlQOjpB4NjlKckQ2zGvBSKNeupuiC71UZ2AT5BFlbqMsuYu0necIztyKiWsBmbniVlLe-v7_paP1N4nS2haD2n4s4N_CenJqijtPggWsITfoLm2twCOe7yNB5IH7bcEFv1-MbANuaFmJVLOcTfc89Zi-mkidaHV-n_9qXypzyB-ih_27YBNluRGwcHgTEkbJecSssMfvHSt1MUuqX-8gbl7bhFGryqHA2gMoSZNDW0LkSYig2K3poOUumD67vtYdNSPLhOmDK4ck9wLAKLOvk6dtywg2qfV-58_VbI", // 

          /* Name of the template to load. You can also pass a save-token from "basket" or "back" callback here to load previously saved work. */
          templateName:  "Photo Mug",
          templateVersion: "draft",

          /* A unique ID to identify this session, can later be used to connect to a UserID once the user has logged in or createdan account */
          basketId: "Some-Unique-Basket-Or-Session-Id",

          /* Optional if available: the ID of the current shop-user to keep all uploaded resources together and display for reccuring users */
          shopUserId: ""

          /* Optional: List of one or more templates to merge on load */
          /* mergeTemplates: [
            {
              "templateName": "Card-Title-2",
              "spreadIndex": 0  // Example to merge a card title to the first spread on load 
            },
            {
              "templateName": "Card-Back-2",
              "spreadIndex": 2  // Example to merge a card back to the third spread on load 
            }
          ], */

          /* Optional: Add your own translation-table. 
                     You'll find all available keys here: 
                     https://github.com/PrintessEditor/getting-started/blob/main/translations.json */
          /* translations: {
            "custom": {
              "name": "Your Name" // you can access this translation with ${gl("custom.name")}
            },
            "ui": {
              "okButton": "Perfect!"
            }
          } */

        }
      }, "*");
    }


    /* *************************** */
    /*   Forward Visual Viewport   */
    /* *************************** */
    if (window.visualViewport) {
      window.visualViewport.addEventListener("scroll", () => {
        // unfortunately an iframe on iOS is not able to receive the correct visual-viewport, so we forward it. 
        iframe.contentWindow.postMessage({ cmd: "viewportScroll", height: window.visualViewport.height, offsetTop: window.visualViewport.offsetTop }, "*")
      })
    }

  </script>


  <iframe id="printess" src="https://editor.printess.com/v/2.6.0/printess-editor/embed.html" onload="loadPrintess()"></iframe>

  </body>

</html>