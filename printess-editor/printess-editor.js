class NobsBase{constructor(e,t){if(e instanceof Nobs&&t instanceof NobsBase){e._called_from_constructor_findMutations(t);for(const o of Object.keys(t)){const i=t[o];i instanceof NobsBase?e.hasObjectReplacement(i)?this[o]=e.getObjectReplacement(i):e._called_from_constructor_hasMutation(i)?this[o]=new i.constructor(e,i):this[o]=i:i instanceof Map?this[o]=e._called_from_constructor_cloneMap(i):Array.isArray(i)?this[o]=e._called_from_constructor_cloneArray(i):e.hasProperty(t,o)?this[o]=e.popProperty(t,o):this[o]=t[o]}const o=e.getChangedProperties(t);if(o&&o.size>0)for(const[e,t]of o)this[e]=t}}}class Nobs{constructor(){this.createdObjects=new Map,this.replacedObjects=new Map,this.removedObjects=new Set,this.changedProperties=new Map,this.replacedCollections=new Map,this.mutatedObjects=new Set}setProperty(e,t,o){if(e&&(o instanceof NobsBase||null===o)&&e[t]instanceof NobsBase)this.replaceObject(e[t],o);else{let i=this.changedProperties.get(e);i||(i=new Map,this.changedProperties.set(e,i)),i.set(t,o)}return this}getChangedProperties(e){return this.changedProperties.get(e)}getProperty(e,t){const o=this.changedProperties.get(e);return o&&o.has(t)?o.get(t):e[t]}popProperty(e,t){const o=this.changedProperties.get(e);if(o&&o.has(t)){const e=o.get(t);return o.delete(t),e}return e[t]}hasProperty(e,t){const o=this.changedProperties.get(e);return!(!o||!o.has(t))}replaceCollection(e,t){return this.replacedCollections.set(e,t),this}addToCollection(e,t,o,i){let r=this.createdObjects.get(e);r||(r=[],this.createdObjects.set(e,r));const s={object:t,insertBefore:o,insertAfter:i};return r.push(s),this}reOrderInsideCollection(e,t,o,i){return t!==o&&t!==i&&(this.removeObject(t),this.addToCollection(e,t,o,i)),this}replaceObject(e,t){return this.replacedObjects.set(e,t),this}hasObjectReplacement(e){return this.replacedObjects.has(e)}getObjectReplacement(e){return this.replacedObjects.get(e)}removeObject(e){return this.removedObjects.add(e),this}_called_from_constructor_hasMutation(e){return this.mutatedObjects.has(e)}_called_from_constructor_findMutations(e){let t=!1;for(const o of Object.keys(e)){const i=e[o];if(this.hasProperty(e,o)&&(t=!0),i instanceof NobsBase)(this.replacedObjects.has(i)||this._called_from_constructor_findMutations(i))&&(this.mutatedObjects.add(i),t=!0);else if(i instanceof Map||Array.isArray(i)){if(this.replacedCollections.has(i)&&(this.mutatedObjects.add(i),t=!0),i instanceof Map)for(const e of i.values())(this.removedObjects.has(e)||this.replacedObjects.has(e))&&(this.mutatedObjects.add(e),t=!0),t=this._called_from_constructor_findMutations(e)||t;else for(const e of i)(this.removedObjects.has(e)||this.replacedObjects.has(e))&&(this.mutatedObjects.add(e),t=!0),t=this._called_from_constructor_findMutations(e)||t;this.createdObjects.has(i)&&(t=!0)}}return t&&this.mutatedObjects.add(e),t}static getId(e){const t=e.id;if(!t)throw new Error("Nobs: By convention, objects stored in a Map need to have an 'id' property");return t}_called_from_constructor_cloneMap(e){const t=new Map,o=this.replacedCollections.get(e);if(o&&o instanceof Map)return o;let i;const r=this.createdObjects.get(e);for(const[o,s]of e.entries())if(!this.removedObjects.has(s)){if(i=this.replacedObjects.get(s),!i&&this.mutatedObjects.has(s)&&(i=new s.constructor(this,s)),i||(i=s),r)for(const e of r)e.insertBefore===i&&t.set(Nobs.getId(e.object),e.object);if(t.set(o,i),r)for(const e of r)e.insertAfter===i&&t.set(Nobs.getId(e.object),e.object)}if(r)for(const e of r)void 0===e.insertBefore&&void 0===e.insertAfter&&t.set(Nobs.getId(e.object),e.object);return t}_called_from_constructor_cloneArray(e){const t=[],o=this.replacedCollections.get(e);if(o&&Array.isArray(o))return o;let i;const r=this.createdObjects.get(e);for(const o of e)if(!this.removedObjects.has(o)){if(i=this.replacedObjects.get(o),!i&&this.mutatedObjects.has(o)&&(i=new o.constructor(this,o)),i||(i=o),r)for(const e of r)e.insertBefore===i&&t.push(e.object);if(t.push(i),r)for(const e of r)e.insertAfter===i&&t.push(e.object)}if(r)for(const e of r)void 0===e.insertBefore&&void 0===e.insertAfter&&t.push(e.object);return t}}var __awaiter=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};let subscriberCount=0,subscribers=[];function sendToSubscribers(e){for(const t of subscribers.filter((t=>t.type===e.type)))t.parentId&&"doc"!==t.type&&t.parentId!==e.parentId||t.callback([e])}function sendMultipleToSubscribers(e,t,o){for(const i of subscribers.filter((t=>t.type===e)))i.parentId&&"doc"!==i.type&&i.parentId!==t||i.callback(o)}const db={create(e){var t;return __awaiter(this,void 0,void 0,(function*(){try{const o=new Map;for(const i of e){localStorage.setItem(i.scopeId+"*"+i.type+":"+i.id,JSON.stringify(i)),localStorage.setItem(i.scopeId+"*TS-ISO",(new Date).toISOString());const e=i.type+"|"+i.parentId;o.has(e)||o.set(e,[]),null===(t=o.get(e))||void 0===t||t.push({event:"added",data:i,id:i.id,parentId:i.parentId,type:i.type})}for(const e of o.values())e.length&&sendMultipleToSubscribers(e[0].type,e[0].parentId,e);return}catch(e){throw"Can't add data to local storage"+e.message}}))},update(e){return __awaiter(this,void 0,void 0,(function*(){try{for(const t of e)localStorage.setItem(t.scopeId+"*"+t.type+":"+t.id,JSON.stringify(t)),localStorage.setItem(t.scopeId+"*TS-ISO",(new Date).toISOString()),sendToSubscribers({event:"modified",data:t,id:t.id,parentId:t.parentId,type:t.type})}catch(e){throw"Can't update data to local storage"+e.message}}))},remove(e){return __awaiter(this,void 0,void 0,(function*(){for(const t of e)localStorage.removeItem(t.scopeId+"*"+t.type+":"+t.id),localStorage.setItem(t.scopeId+"*TS-ISO",(new Date).toISOString()),sendToSubscribers({event:"removed",id:t.id,parentId:t.parentId,type:t.type})}))},subscribe(e,t,o,i){const r=generateDBID();let s,n;subscribers.push({id:r,type:t,parentId:o,callback:i,index:++subscriberCount});const a=[],l=e+"*"+t;for(let e=0;e<localStorage.length;e++)if(s=localStorage.key(e),s&&s.startsWith(l)&&(n=localStorage.getItem(s),n))try{const e=JSON.parse(n);o&&e.parentId!==o||a.push({event:"added",data:e,id:s.substr(l.length+1),parentId:e.parentId,type:t})}catch(e){}return i(a),r},unsubscribe(e){subscribers=subscribers.filter((t=>t.id!==e&&t.parentId!==e))}};var __awaiter$1=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};function getUrl(e,t){return-1!==e.indexOf("localhost")||-1!==e.indexOf(".bkrl.local")?("http://"+e+t).toLowerCase():("https://"+e+t).toLowerCase()}function postJson(e,t,o,i){return __awaiter$1(this,void 0,void 0,(function*(){t.startsWith("/")||(t="/"+t);const r=getUrl(e,t);return yield fetch(r,{method:"POST",mode:"cors",cache:"no-cache",credentials:"omit",headers:{"Content-Type":"application/json",Authorization:"Bearer "+o},redirect:"error",referrerPolicy:"no-referrer",body:i})}))}function postFormData(e,t,o,i){return __awaiter$1(this,void 0,void 0,(function*(){t.startsWith("/")||(t="/"+t);const r=getUrl(e,t);return yield fetch(r,{method:"POST",mode:"cors",cache:"no-cache",credentials:"omit",headers:{Authorization:"Bearer "+o},redirect:"error",referrerPolicy:"no-referrer",body:i})}))}var __awaiter$2=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};class Template{constructor(e,t){e&&t&&(this.id=t.id,this.userId=e.uid,this.name=t.n,this.isWritable=t.w,this.isDeletable=t.d,this.isPublishable=t.p,this.hasPublishedVersion=t.hpv,this.hasDesignVersion=t.hdv,this.thumbnailUrl=t.turl,this.backgroundColor=t.bg,this.lastSaveDate=new Date(t.ls),this.lastPublishDate=new Date(t.lp))}copyWithUserId(e){const t=new Template;Object.assign(t,this);const o=t;return o.userId=e,o.id=0,t}copyWithFullAccess(e,t,o){const i=new Template;Object.assign(i,this);const r=i;return r.userId=e,r.id=t,r.name=o,r.isWritable=!0,r.isDeletable=!0,r.isPublishable=!0,r.hasPublishedVersion=!1,r.hasDesignVersion=!0,i}}class UserTemplates{constructor(e){this.userId=e.uid,this.eMail=e.e,this.templates=e.ts.map((t=>new Template(e,t)))}}class TemplatesList{constructor(e){this.globalUserId=e.gid,this.userId=e.uid,this.userTemplates=e.uts.map((e=>new UserTemplates(e)))}}class TemplatePageImage{constructor(e){this.spreadIndex=e.si,this.pageIndex=e.pi,this.thumbnailUrl=e.t,this.backgroundColor=e.bg,this.documentId=e.did}}class TemplateDetails{constructor(e){this.id=e.id,this.images=e.images.map((e=>new TemplatePageImage(e))),e.documentInfo&&(this.documentIdToNameMapping=JSON.parse(e.documentInfo))}}class DirectoryTree{constructor(e){this.id=e.id,this.parentId=e.pid,this.name=e.n,this.children=e.c.map((e=>new DirectoryTree(e)))}}function pad(e){return e<10?"0"+e:e}function dateString(){const e=new Date;return e.getUTCFullYear()+"-"+pad(e.getUTCMonth()+1)+"-"+pad(e.getUTCDate())+"T"+pad(e.getUTCHours())+"-"+pad(e.getUTCMinutes())+"-"+pad(e.getUTCSeconds())+"-"+(e.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)}function decodeBase64Url(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");const o=e.length%4;if(o){if(1===o)throw new Error("InvalidLengthError: Input base64url string is the wrong length to determine padding");t+=new Array(5-o).join("=")}const i=Uint8Array.from(atob(t),(e=>e.charCodeAt(0)));return(new TextDecoder).decode(i)}function readTokenData(e){const t=decodeBase64Url(e.split(".")[1]);return JSON.parse(t)}class Api{constructor(e,t,o){this.domain=e,this.token=t,this.tokenData=readTokenData(t),this.tokenRefresher=o}get userId(){return this.tokenData?this.tokenData.sub:""}isTokenValidFor(e){const t=this.tokenData.exp;return new Date(1e3*t).getTime()-(new Date).getTime()>e}handleErrorResponse(e,t){return __awaiter$2(this,void 0,void 0,(function*(){if(!e.ok){let o=`${t}: ${e.statusText} (statusCode=${e.status})`;try{const i=yield e.text();o=401===e.status?`${t}: Please reload the editor or logout and login to continue. Seems like your authentication token expired and the request didn't go through.`:`${i} ${e.statusText} (statusCode=${e.status})`}catch(e){console_log(e)}throw o}}))}saveTemplate(e,t,o){return __awaiter$2(this,void 0,void 0,(function*(){const i=new FormData;i.append("id",e),i.append("tid",null!=o?o:""),i.append("j",new Blob([t],{type:"application/json"}));const r=yield postFormData(this.domain,"/template/save",this.token,i);yield this.handleErrorResponse(r,"Cannot save template")}))}publishTemplate(e,t,o){return __awaiter$2(this,void 0,void 0,(function*(){const i=new FormData;i.append("id",e),i.append("tid",null!=o?o:""),i.append("j",new Blob([t],{type:"application/json"}));const r=yield postFormData(this.domain,"/template/publish",this.token,i);yield this.handleErrorResponse(r,"Cannot publish template")}))}deleteTemplate(e,t){return __awaiter$2(this,void 0,void 0,(function*(){const o={id:e,userId:t},i=yield postJson(this.domain,"/template/delete",this.token,JSON.stringify(o));yield this.handleErrorResponse(i,"Cannot delete template")}))}moveTemplateIntoDirectory(e,t){return __awaiter$2(this,void 0,void 0,(function*(){const o=yield postJson(this.domain,"/template/move",this.token,JSON.stringify({templateId:e,directoryId:t}));yield this.handleErrorResponse(o,"Cannot move template")}))}unpublishTemplate(e,t){return __awaiter$2(this,void 0,void 0,(function*(){const o={id:e,userId:t},i=yield postJson(this.domain,"/template/unpublish",this.token,JSON.stringify(o));yield this.handleErrorResponse(i,"Cannot unpublish template")}))}saveTemplateThumbnails(e){return __awaiter$2(this,void 0,void 0,(function*(){const t=yield postFormData(this.domain,"/template/upload/thumbnails",this.token,e);yield this.handleErrorResponse(t,"Cannot save template thumbnails")}))}loadTemplatesList(){return __awaiter$2(this,void 0,void 0,(function*(){const e=yield postJson(this.domain,"/templates/list",this.token,"{}");yield this.handleErrorResponse(e,"Cannot list templates");const t=yield e.json();return new TemplatesList(t)}))}loadDirectories(e){return __awaiter$2(this,void 0,void 0,(function*(){const t=yield postJson(this.domain,"/directories/load",this.token,JSON.stringify({userId:e}));yield this.handleErrorResponse(t,"Cannot load directories");const o=yield t.json();return new DirectoryTree(o)}))}createDirectory(e,t){return __awaiter$2(this,void 0,void 0,(function*(){const o=yield postJson(this.domain,"/directory/create",this.token,JSON.stringify({parentId:e,name:t}));yield this.handleErrorResponse(o,"Cannot create directory")}))}deleteDirectory(e){return __awaiter$2(this,void 0,void 0,(function*(){const t=yield postJson(this.domain,"/directory/delete",this.token,JSON.stringify({id:e}));yield this.handleErrorResponse(t,"Cannot delete directory")}))}moveDirectory(e,t){return __awaiter$2(this,void 0,void 0,(function*(){const o=yield postJson(this.domain,"/directory/move",this.token,JSON.stringify({id:e,parentId:t}));yield this.handleErrorResponse(o,"Cannot move directory")}))}loadGlobalUserTemplates(){return __awaiter$2(this,void 0,void 0,(function*(){const e=yield postJson(this.domain,"/templates/global/load",this.token,"{}");yield this.handleErrorResponse(e,"Cannot load global user templates");const t=yield e.json();return new UserTemplates(t)}))}loadUserTemplates(e){return __awaiter$2(this,void 0,void 0,(function*(){const t=yield postJson(this.domain,"/templates/user/load",this.token,JSON.stringify({directoryId:e}));yield this.handleErrorResponse(t,"Cannot load user templates");const o=yield t.json();return new UserTemplates(o)}))}loadSharedUserTemplates(e,t){return __awaiter$2(this,void 0,void 0,(function*(){const o=yield postJson(this.domain,"/templates/user/shared/load",this.token,JSON.stringify({userId:e,directoryId:t}));yield this.handleErrorResponse(o,"Cannot load shared user templates");const i=yield o.json();return new UserTemplates(i)}))}loadRecentUserTemplates(){return __awaiter$2(this,void 0,void 0,(function*(){const e=yield postJson(this.domain,"/templates/user/recent/load",this.token,"{}");yield this.handleErrorResponse(e,"Cannot load recent user templates");const t=yield e.json();return new UserTemplates(t)}))}loadTemplateDetails(e,t,o){return __awaiter$2(this,void 0,void 0,(function*(){const i=yield postJson(this.domain,"/template/details",this.token,JSON.stringify({userId:e,templateId:t,templateName:o}));yield this.handleErrorResponse(i,"Cannot load template details");const r=yield i.json();return new TemplateDetails(r)}))}loadTemplateFromUser(e,t,o){return __awaiter$2(this,void 0,void 0,(function*(){const i=yield postJson(this.domain,"/template/load",this.token,JSON.stringify({userId:t,id:e,p:"published"==o}));yield this.handleErrorResponse(i,"Cannot load template from user");return yield i.json()}))}upload(e,t){return __awaiter$2(this,void 0,void 0,(function*(){const o=yield postFormData(this.domain,e,this.token,t);yield this.handleErrorResponse(o,"Cannot upload file");return yield o.json()}))}uploadAsDesigner(e){return __awaiter$2(this,void 0,void 0,(function*(){return yield this.upload("/printess/upload/design",e)}))}uploadSnippet(e){return __awaiter$2(this,void 0,void 0,(function*(){const t=yield postFormData(this.domain,"/printess/upload/snippet",this.token,e);yield this.handleErrorResponse(t,"Cannot upload snippet");return yield t.json()}))}deleteSnippet(e){return __awaiter$2(this,void 0,void 0,(function*(){const t=yield postJson(this.domain,"/snippet/delete",this.token,JSON.stringify({id:e}));yield this.handleErrorResponse(t,"Cannot delete snippet")}))}loadSnippetTags(e){return __awaiter$2(this,void 0,void 0,(function*(){const t=yield postJson(this.domain,"/printess/snippets/tags/load",this.token,JSON.stringify({includeGlobal:e}));yield this.handleErrorResponse(t,"Cannot load snippet tags");return yield t.json()}))}loadSnippets(e,t,o){return __awaiter$2(this,void 0,void 0,(function*(){const i=yield postJson(this.domain,"/printess/snippets/load",this.token,JSON.stringify({type:e,tags:t,includeGlobal:o}));yield this.handleErrorResponse(i,"Cannot load snippets");return yield i.json()}))}renderSvgBarcode(e,t,o,i,r,s,n){return __awaiter$2(this,void 0,void 0,(function*(){const a=yield postJson(this.domain,"barcode/svg/render",this.token,JSON.stringify({symbology:e,content:t,width:o,height:i,unit:r,color:s,properties:n}));yield this.handleErrorResponse(a,"Cannot render barcode");return yield a.text()}))}getRenderDocuments(e,t){const o={};let i=0;for(const r of e.documents)r.data.pro&&(i++,o[r.data.na]=t+"__"+i+".pdf");if(i>0)return o;for(const i of e.documents)if(i.data.pri)return o[i.data.na]=t+".pdf",o;return o[e.documents[0].data.na]=t+".pdf",o}debugProduceMany(e,t,o=!1){return __awaiter$2(this,void 0,void 0,(function*(){const i=[],r=new Set;if(o)for(let o=0;o<t.length;o++)try{const r=yield this.debugProduceDocument(e,t[o]);r&&i.push(t[o]+" -> "+r)}catch(e){i.push(t[o]+" -> "+e)}else for(let o=0;o<t.length;o++){const s=o,n=this.debugProduceDocument(e,t[o]);for(r.add(n),n.then((e=>{e&&i.push(t[s]+" -> "+e)})).catch((e=>{i.push(t[s]+" -> "+e)})).finally((()=>{r.delete(n)}));r.size>1;)yield Promise.race(r)}console_log(JSON.stringify(i)),alert(JSON.stringify(i))}))}debugProduceDocument(e,t){return __awaiter$2(this,void 0,void 0,(function*(){const o=yield this.loadTemplateFromUser(e,t);return yield this.debugProduce(o,!0)}))}debugProduce(e,t=!1){var o,i,r,s;return __awaiter$2(this,void 0,void 0,(function*(){const n=null!==(i=null===(o=e.template)||void 0===o?void 0:o.id)&&void 0!==i?i:e.scope.id,a={jobId:n,templateName:e.template.id,json:JSON.stringify(e),documents:this.getRenderDocuments(e,n),record:JSON.stringify({})},l=yield postJson(this.domain,"/printess/debug/produce",this.token,JSON.stringify(a));if(!l.ok)throw`Cannot debug produce: ${l.statusText} (statusCode=${l.status})`;const c=yield l.text();if(c.startsWith("[")){const e=JSON.parse(c);if(t)return"";e.forEach((e=>{window.open(e.url)}))}else{if(t)return c;{const t=null!==(s=null===(r=e.template)||void 0===r?void 0:r.id)&&void 0!==s?s:e.scope.id;alert(t+":"+c)}}return""}))}debugProduceImposed(e,t=!1){var o,i,r,s;return __awaiter$2(this,void 0,void 0,(function*(){const n=null!==(i=null===(o=e.template)||void 0===o?void 0:o.id)&&void 0!==i?i:e.scope.id,a={jobId:n,templateName:e.template.id,json:JSON.stringify(e),documents:this.getRenderDocuments(e,n),record:JSON.stringify({}),outputSettings:{impositionUrl:"https://printess-bkr.s3.eu-central-1.amazonaws.com/impositions/a5.card.portrait.json"}},l=yield postJson(this.domain,"/printess/debug/produce",this.token,JSON.stringify(a));if(!l.ok)throw`Cannot debug produce: ${l.statusText} (statusCode=${l.status})`;const c=yield l.text();if(c.startsWith("[")){const e=JSON.parse(c);if(t)return"";e.forEach((e=>{window.open(e.url)}))}else{if(t)return c;{const t=null!==(s=null===(r=e.template)||void 0===r?void 0:r.id)&&void 0!==s?s:e.scope.id;alert(t+":"+c)}}return""}))}debugProduceModel(e){return __awaiter$2(this,void 0,void 0,(function*(){const t=yield postJson(this.domain,"/printess/debug/produce",this.token,e);if(!t.ok)throw`Cannot debug produce: ${t.statusText} (statusCode=${t.status})`;const o=yield t.text();if(o.startsWith("[")){JSON.parse(o).forEach((e=>{window.open(e.url)}))}else alert(o);return""}))}produce(e){return __awaiter$2(this,void 0,void 0,(function*(){const t=dateString(),o={jobId:t,json:JSON.stringify(e),templateName:e.template.id,record:JSON.stringify({}),documents:this.getRenderDocuments(e,t)},i=yield postJson(this.domain,"/printess/produce",this.token,JSON.stringify(o));if(!i.ok)throw`Cannot produce: ${i.statusText} (statusCode=${i.status})`;return t}))}produceTemplate(e){return __awaiter$2(this,void 0,void 0,(function*(){const t={templateName:e,record:JSON.stringify({}),documents:{Document:""}},o=yield postJson(this.domain,"/printess/produce",this.token,JSON.stringify(t));if(!o.ok)throw`Cannot produce: ${o.statusText} (statusCode=${o.status})`;return yield o.text()}))}getStatus(e){return __awaiter$2(this,void 0,void 0,(function*(){const t={jobId:e},o=yield postJson(this.domain,"/printess/status/get",this.token,JSON.stringify(t));if(!o.ok)throw`Cannot retrieve status: ${o.statusText} (statusCode=${o.status})`;const i=yield o.json();return{jobId:i.jobId,isFinalStatus:i.isFinalStatus,isSuccess:i.isSuccess,enqueuedOn:new Date(i.enqueuedOn),processingOn:i.processingOn?new Date(i.processingOn):null,finishedOn:i.finishedOn?new Date(i.finishedOn):null,failedOn:i.failedOn?new Date(i.failedOn):null,errorDetails:i.errorDetails,statistics:i.statistics,distribution:i.distribution}}))}}var __awaiter$3=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};function BlobToFormData(e,t,o){const i=new FormData;return o&&o(i,t,e),i.append("file",t,e),i}class ApiUploadProvider{constructor(e){this.api=e}upload(e,t){return __awaiter$3(this,void 0,void 0,(function*(){const t=yield this.api.uploadAsDesigner(e);if(0===t.length)throw"Could not upload file. Something went wrong.";return{url:t[0].url,id:t[0].id,originalFormName:t[0].fk}}))}}var __awaiter$4=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};class DocumentProvider{load(e){return this.loadCore({id:e})}save(e,t){return this.saveCore({id:e,templateJson:t})}}class ApiDocumentProvider extends DocumentProvider{constructor(e){super(),this.api=e}loadCore(e){return-1!=window.location.href.indexOf("thundercats.html")?this.api.loadTemplateFromUser(e.id.toLocaleLowerCase(),e.fromUserId):this.api.loadTemplateFromUser(e.id,e.fromUserId)}saveCore(e){return this.api.saveTemplate(e.id,e.templateJson,e.targetUserId)}}class DevDocumentProvider extends DocumentProvider{constructor(e){super(),this.targetSystem=e}loadCore(e){return __awaiter$4(this,void 0,void 0,(function*(){const t=yield fetch(this.targetSystem+"/api/store/"+encodeURIComponent(e.id)+"/load");if(!t.ok)throw`Cannot load document: ${t.statusText} (statusCode=${t.status})`;return yield t.json()}))}saveCore(e){return __awaiter$4(this,void 0,void 0,(function*(){const t=yield fetch(this.targetSystem+"/api/store/"+encodeURIComponent(e.id)+"/save",{headers:{"Content-Type":"text/plain; charset=utf-8"},method:"POST",body:e.templateJson});if(!t.ok)throw`Cannot save document: ${t.statusText} (statusCode=${t.status})`}))}}function createPrintessApiFromSettings(e){if(!e)throw"No Printess api settings found.";if(!e.domain)throw"No 'domain' in Printess api settings found.";if(!e.token)throw"No 'token' in Printess api settings found.";return new Api(e.domain,e.token)}function createPrintessDocumentApi(e){return createPrintessApiFromSettings(config)}function uploadProvider(){if(config.uploadProvider)return config.uploadProvider;const e=createPrintessApiFromSettings(config);return new ApiUploadProvider(e)}function documentProvider(e){const t=createPrintessDocumentApi();return new ApiDocumentProvider(t)}function createPrintessApiFromExternalConfig(){return createPrintessApiFromSettings(config)}const config={isAutomationMode:!1,isDebugViewBkr:!1,providedContainerDiv:null,loadingFadeCallback:null,loadingDoneCallback:null,uploadProvider:null,wasmUrl:"wasm/printess.wasm",domain:"",token:"",pointCollapseThreshold:1,pathLeftOffset:900,pathScaleFactor:20,user:{displayName:"[no user]",email:"",emailVerified:!1,isAnonymous:!0,phoneNumber:"",photoUrl:""},enableMacros:!1,updatePageThumbnails:!0,mobileDeviceWidth:896,isMobile:isMobile(896),isBuyer:!1,buyerOnly:!1,fullScreenOnMobile:!0,hideControls:!1,allowZoomAndPan:!0,forceMultilineFormEditing:!1,splitMultilineToParagraphs:!0,enterImageCropingOnSelect:!1,enableZoomToFrame:!1,scaledImageMinimumDpi:0,zoomDuration:1,singleSelectionOnly:!1,applyImageEffectsInCropMode:!0,sessionId:generateDBID(),debug:"localhost"===window.location.hostname||window.location.href.indexOf("debug=1")>0,moverSize:()=>parseFloat(getComputedStyle(document.body).getPropertyValue("--printess-frame-mover-size").replace("px","")),pathEditorPathColor:()=>getComputedStyle(document.body).getPropertyValue("--printess-path-editor-path-color"),pathEditorDisabledPathColor:()=>getComputedStyle(document.body).getPropertyValue("--printess-path-editor-disabled-path-color"),cropperLargeSide:()=>parseFloat(getComputedStyle(document.body).getPropertyValue("--printess-cropper-large-side").replace("px","")),cropperSmallSide:()=>parseFloat(getComputedStyle(document.body).getPropertyValue("--printess-cropper-small-side").replace("px","")),resourceToolBarWidth:()=>parseFloat(getComputedStyle(document.body).getPropertyValue("--printess-resource-toolbar-width").replace("px","")),propertiesToolBarWidth:()=>parseFloat(getComputedStyle(document.body).getPropertyValue("--printess-toolbar-width").replace("px","")),resourcePanelInitialWidth:()=>parseFloat(getComputedStyle(document.body).getPropertyValue("--printess-resource-panel-initial-width").replace("px","")),pageSizes:()=>[{name:"A0",width:84.1,height:118.9,unit:"cm"},{name:"A1",width:59.4,height:84.1,unit:"cm"},{name:"A2",width:42,height:59.4,unit:"cm"},{name:"A3",width:29.7,height:42,unit:"cm"},{name:"A4",width:21,height:29.7,unit:"cm"},{name:"A5",width:14.85,height:21,unit:"cm"},{name:"A6",width:10.5,height:14.85,unit:"cm"},{name:"EU Business Card",width:8.5,height:5.5,unit:"cm"},{name:"U.S. Business Card",width:3.5,height:2,unit:"inch"},{name:"Junior Legal",width:8,height:5,unit:"inch"},{name:"Government Letter",width:8,height:10.5,unit:"inch"},{name:"Letter",width:8.5,height:11,unit:"inch"},{name:"Legal",width:8.5,height:14,unit:"inch"},{name:"Tabloid",width:11,height:17,unit:"inch"},{name:"Ledger",width:17,height:11,unit:"inch"},{name:"C5 Envelope",width:22.9,height:11,unit:"cm"},{name:"DIN Long Envelope",width:22,height:11,unit:"cm"},{name:"Monarch Envelope",width:7.5,height:3.875,unit:"inch"},{name:"Apple iPhone 8 Plus",width:1080,height:1920,unit:"px"},{name:"Apple iPhone 8",width:750,height:1334,unit:"px"},{name:"Apple iPhone X",width:1125,height:2436,unit:"px"},{name:"Apple iPhone 11",width:828,height:1792,unit:"px"},{name:"Apple iPad Pro",width:2732,height:2048,unit:"px"},{name:"Apple iPad Air 2",width:2048,height:1536,unit:"px"}],printessSvgLogo:function(e="#eee",t=30){return`<svg xmlns="http://www.w3.org/2000/svg" height="${t}" viewBox="0 0 166.6 63.5">\n  <style type="text/css">\n    .st2 {\n      fill: #FF0D98;\n    }\n    .text {\n      fill: ${e};\n    }\n  </style>\n  <g>\n    <path class="text" d="M0,26.68c3.89-1.1,7.58-1.63,10.99-1.63c8.69,0,14.93,3.84,14.93,12.63s-6.05,13.06-14.16,13.44c-1.49,0-3.07,0-4.75-0.24\n                L7.2,62.78c-2.45,0.1-4.27,0.29-6.67,0.38L0,26.68z M8.78,45.5c4.9,0,10.03-1.34,10.66-7.49c0.53-4.42-2.88-6.91-7.82-7.06\n                c-1.92,0-2.98,0.05-4.94,0.43l0.24,14.07C7.54,45.5,8.16,45.5,8.78,45.5z" />\n    <path class="text" d="M27.55,34.7l5.23-0.38l0.53,3.74c2.02-2.93,4.75-4.37,7.68-4.37c0.53,0,1.06,0.05,1.58,0.14c0.1,2.26,0.19,4.46,0.29,6.72\n                c-0.58-0.14-1.2-0.24-1.73-0.24c-3.89,0-6.62,3.55-7.01,7.73l0.53,14.4h-6.72L27.55,34.7z" />\n\n    <path class="text" d="M52.99,45.36l0.14,17.19c-2.4,0.05-4.75,0.1-7.15,0.14l0.04-17.99L52.99,45.36z" />\n\n    <path class="st2" d="M52.88,36.52l0.11,8.84l-6.97-0.65v-9L52.88,36.52z" />\n\n    <path class="text"\n      d="M58.62,34.17c2.26,0.1,3.94,0.19,6.19,0.29l0.14,3.94c1.49-2.64,4.03-4.8,7.3-4.8c0.29,0,0.58,0,0.86,0.05\n                c5.18,0.62,7.68,4.18,7.68,11.86c0.05,4.37-0.48,10.08-1.58,17.52c-2.11-0.24-4.23-0.43-6.34-0.67c0.82-6.58,1.58-12.24,1.54-16.27\n                c-0.05-4.03-0.91-6.48-3.31-6.62c-4.51,0-5.95,5.71-6.19,9.31c-0.58,4.85-0.29,9.12-0.43,13.68h-6.34L58.62,34.17z" />\n    <path class="text" d="M93.57,52.79c0,2.64,0.91,3.98,3.7,4.66c-0.62,2.02-1.2,4.03-1.82,6.05c-6.43-0.86-8.74-5.38-8.74-10.27V41.03l-3.6,0.38\n                l-0.58-6.29l4.7-0.58l0.91-5.57c1.73-0.14,3.46-0.24,5.18-0.38c0,1.73,0.05,3.5,0.05,5.23l4.8-0.62l0.62,6.38l-5.38,0.62\n                L93.57,52.79z" />\n    <path class="text"\n      d="M116.81,54.52l4.13,3.89c-2.26,2.93-5.52,4.94-10.18,4.94c-7.87,0-11.62-7.49-11.42-15.02\n                c0.19-7.49,4.42-15.03,12.58-15.03c9.41,0,12,9.65,9.79,17.67c-5.38-0.05-10.8-0.05-16.18-0.1c0.14,3.7,2.06,6.62,5.18,6.62\n                C112.73,57.5,114.17,57.02,116.81,54.52z M116.18,45.5c0-2.98-1.39-6.1-4.61-6.1c-2.69,0-4.99,2.16-5.47,5.62L116.18,45.5z" />\n    <path class="text" d="M162.76,41.13c-1.97-1.2-3.94-1.78-5.52-1.78s-2.74,0.62-3.12,1.78c-1.54,4.8,12.77,3.7,12.48,13.54\n                c-0.24,5.86-5.18,8.54-10.56,8.54c-0.38,0-0.72,0-1.1-0.05c-3.84-0.24-7.83-1.82-10.32-4.61l3.26-5.04c1.97,2.11,4.85,3.5,7.78,3.5\n                c2.35,0,4.22-0.91,4.37-2.3c0.34-2.74-4.37-3.79-8.06-6.05c-7.68-4.61-4.85-15.03,5.14-15.03c2.83,0,5.95,0.72,8.45,2.16\n                L162.76,41.13z" />\n    <path class="text" d="M139.55,42.76c-2.08-1.37-2.92-1.88-4.71-2.41c-1.56-0.46-2.81-0.09-3.19,1.06c-1.54,4.8,12.84,3.41,12.55,13.25\n                c-0.24,5.86-5.18,8.54-10.56,8.54c-0.38,0-0.72,0-1.1-0.05c-3.84-0.24-6.64-2.22-9.32-4.61l3.26-5.04c2.27,1.96,3.88,3.17,6.78,3.5\n                c2.34,0.27,4.22-0.91,4.37-2.3c0.34-2.74-4.37-3.79-8.06-6.05c-7.68-4.61-4.84-14.94,5.14-14.03c2.82,0.26,4.66,1.28,7.45,3.16\n                L139.55,42.76z" />\n  </g>\n  <g id="Ebene_2">\n    <polygon class="st2"\n      points="47.56,9.93 52.26,16.39 59.71,19.29 53.25,23.99 50.35,31.44 45.65,24.98 38.2,22.08 44.66,17.38 \t" />\n    <path class="st2" d="M46.33,5.17l-1.27-3.01c-0.11-0.29-0.08-0.53,0.18-0.67l1.02-0.37c0.38-0.15,0.52-0.04,0.55,0.46l0.24,3.26\n                C47.08,5.37,46.58,5.7,46.33,5.17z" />\n    <path class="st2" d="M57.67,9.39l1.21-1.95c0.24-0.36,0.47-0.66,0.87-0.51l0.7,0.22c0.42,0.17,0.51,0.69,0.18,0.98l-1.92,1.73\n                C58.3,10.24,57.62,9.94,57.67,9.39z" />\n    <path class="st2" d="M36.56,11.73l-1.78-0.96c-0.45-0.28-0.6-0.53-0.42-0.91l0.27-0.53c0.19-0.41,0.63-0.46,0.96-0.11l1.51,1.49\n                C37.97,11.49,37.53,12.24,36.56,11.73z" />\n    <path class="st2" d="M33.18,22.43L30.9,23.1c-0.31,0.07-0.41-0.1-0.46-0.34l-0.12-1.21c0.01-0.25,0.24-0.38,0.53-0.31l2.4,0.54\n                C33.55,21.91,33.5,22.33,33.18,22.43z" />\n    <path class="st2" d="M64.81,18.59l2.79,0.21c0.29,0.02,0.47-0.17,0.41-0.43l-0.23-1.22c-0.09-0.25-0.33-0.3-0.72-0.15l-2.53,0.96\n                C64.23,18.15,64.41,18.56,64.81,18.59z" />\n  </g>\n</svg>`},rgbColors:[{name:"Black",value:rgb(0,0,0)},{name:"White",value:rgb(255,255,255)},{name:"Pink",value:rgb(242,44,134)},{name:"Rose",value:rgb(247,116,171)},{name:"Flamingo Pink",value:rgb(251,165,200)},{name:"Light pink",value:rgb(253,208,228)},{name:"Purple-1",value:rgb(202,177,212)},{name:"Purple-2",value:rgb(164,151,198)},{name:"Purple-3",value:rgb(135,50,124)},{name:"Hydrangea",value:rgb(105,92,151)},{name:"Dark purple",value:rgb(73,29,74)},{name:"Cherry red",value:rgb(136,23,74)},{name:"Raspberry",value:rgb(195,61,81)},{name:"Fire red",value:rgb(241,47,43)},{name:"Brick red",value:rgb(206,52,48)},{name:"Warm Rose",value:rgb(255,126,138)},{name:"Pastel pink",value:rgb(254,213,207)},{name:"Peach",value:rgb(248,195,179)},{name:"Salmon",value:rgb(253,161,105)},{name:"Dutch",value:rgb(250,131,44)},{name:"Orange",value:rgb(249,113,45)},{name:"Okker",value:rgb(233,176,70)},{name:"Honey",value:rgb(246,221,81)},{name:"Buttercup",value:rgb(255,242,0)},{name:"Pastel yellow",value:rgb(250,250,197)},{name:"Apple green",value:rgb(153,200,53)},{name:"Old green",value:rgb(81,180,64)},{name:"Leaf",value:rgb(0,155,71)},{name:"Petrol",value:rgb(0,110,125)},{name:"Army",value:rgb(111,126,114)},{name:"Olive",value:rgb(149,165,131)},{name:"Grey green",value:rgb(182,200,185)},{name:"Mint",value:rgb(183,246,220)},{name:"Pastel green",value:rgb(200,227,214)},{name:"Blue",value:rgb(175,212,219)},{name:"Sea",value:rgb(0,159,176)},{name:"Turquoise",value:rgb(2,182,174)},{name:"Azure",value:rgb(0,166,228)},{name:"Sky blue",value:rgb(136,212,244)},{name:"Light blue",value:rgb(198,233,250)},{name:"Royal blue",value:rgb(0,115,180)},{name:"Dark blue",value:rgb(16,89,147)},{name:"Galaxy",value:rgb(49,40,131)},{name:"Night blue",value:rgb(24,49,102)},{name:"Navy",value:rgb(10,24,56)},{name:"Pearl",value:rgb(104,156,182)},{name:"Cornflower",value:rgb(127,163,197)},{name:"Pale blue",value:rgb(165,205,227)},{name:"Grey blue",value:rgb(136,159,172)},{name:"Dark green",value:rgb(64,64,64)},{name:"Cement",value:rgb(119,119,119)},{name:"Grey",value:rgb(159,159,159)},{name:"Light grey",value:rgb(201,207,209)},{name:"Pebble",value:rgb(183,171,155)},{name:"Taupe",value:rgb(108,96,81)},{name:"Chocolate",value:rgb(112,68,39)},{name:"Bronze",value:rgb(169,114,88)},{name:"Gold-1",value:rgb(213,177,96)},{name:"Gold-2",value:rgb(206,164,51)}]};function rgb(e,t,o){return"#"+[e,t,o].map((e=>{const t=e.toString(16);return 1===t.length?"0"+t:t})).join("")}function getCssVariable(e){return document.documentElement.style.getPropertyValue(e)}let Layer=(()=>{class e extends NobsBase{constructor(t,o){if(super(t,o),!(t instanceof Nobs&&o instanceof e)){const i=o;this.name=i.na||"Layer 1",this.color=i.co||e.colors[0],this.id=t||generateDBID(),this.lock=(!0===i.lo||!1===i.lo)&&i.lo,this.visible=!0!==i.vi&&!1!==i.vi||i.vi,this.buyer=!0!==i.bu&&!1!==i.bu||i.bu,this.print=!0!==i.pr&&!1!==i.pr||i.pr,this.mergedFromArtwork=(!0===i.aw||!1===i.aw)&&i.aw,this.visibilityFormField=(!0===i.vff||!1===i.vff)&&i.vff}}isCurrentlyVisible(e){const t=!(config.isBuyer||config.isMobile)||this.buyer;let o=this.visible;if(this.visibilityFormField&&e&&e.docRef){const t=e.docRef.formFieldValues.get("LAYER_"+this.id);"ON"===t?o=!0:"OFF"===t&&(o=!1)}return o&&t}get jsName(){return getValidJsName(this.name)}serialize(e){return{id:this.id,na:this.name,co:this.color,lo:this.lock,vi:e?this.isCurrentlyVisible(e):this.visible,bu:this.buyer,pr:this.print,aw:this.mergedFromArtwork,vff:this.visibilityFormField}}}return e.colors=["#21b7ff","green","blue","magenta","cyan","gray","yellow","black","red","orange","darkGreen","darkRed","teal","brown","violet","gold","pink"],e})();class Point{constructor(e=0,t=0){if("number"!=typeof e){const t=e;this.x=t.x,this.y=t.y}else this.x=e||0,this.y=t||0}clone(){return new Point(this.x,this.y)}transform(e){if(e){const t=e.GetNewX(this.x,this.y),o=e.GetNewY(this.x,this.y);return this.x=t,this.y=o,new Point(t,o)}return this}getAngle(e){const t=e.x-this.x,o=e.y-this.y;return 0===t&&0===o?0:0===t?o>0?180:0:0===o?t>0?0:270:t>0&&o>0?90+180*Math.atan(o/t)/Math.PI:t<0&&o>0?180+180*Math.atan(-t/o)/Math.PI:t<0&&o<0?270+180*Math.atan(-o/-t)/Math.PI:t>0&&o<0?0+180*Math.atan(t/-o)/Math.PI:0}rot90(){const e=this.x;return this.x=this.y,this.y=-e,this}reverse(){return this.x=-this.x,this.y=-this.y,this}normalize(){const e=this.len();return e>0&&(this.x=this.x/e,this.y=this.y/e),this}add(e){return this.x+=e.x,this.y+=e.y,this}sub(e){return this.x-=e.x,this.y-=e.y,this}scale(e,t){return this.x*=e,this.y*=t||e,this}project(e){const t=this.dot(e)/e.len();return this.x=t*e.x,this.y=t*e.y,this}projectN(e){const t=this.dot(e);return this.x=t*e.x,this.y=t*e.y,this}reflect(e){const t=this.x,o=this.y;return this.project(e).scale(2),this.x-=t,this.y-=o,this}reflectN(e){const t=this.x,o=this.y;return this.projectN(e).scale(2),this.x-=t,this.y-=o,this}dot(e){return this.x*e.x+this.y*e.y}len(){return Math.sqrt(this.lenSqr())}lenSqr(){return this.dot(this)}}class Matrix{constructor(e=1,t=0,o=0,i=1,r=0,s=0){this.M11=1,this.M12=0,this.M13=0,this.M21=0,this.M22=1,this.M23=0,this.M31=0,this.M32=0,this.M33=1,this.M11=e||1,this.M12=t||0,this.M21=o||0,this.M22=i||1,this.M31=r||0,this.M32=s||0}clone(){return new Matrix(this.M11,this.M12,this.M21,this.M22,this.M31,this.M32)}a(){return this.M11}b(){return this.M12}c(){return this.M21}d(){return this.M22}e(){return this.M31}f(){return this.M32}determinant(){return this.M11*this.M22*this.M33+this.M12*this.M23*this.M31+this.M13*this.M21*this.M32-this.M13*this.M22*this.M31-this.M11*this.M23*this.M32-this.M12*this.M21*this.M33}isDegenerated(){return 0===this.determinant()}GetNewX(e,t){return this.M11*e+this.M21*t+this.M31}GetNewY(e,t){return this.M12*e+this.M22*t+this.M32}GetNewPoint(e){const t=new Point;return t.x=this.GetNewX(e.x||0,e.y||0),t.y=this.GetNewY(e.x||0,e.y||0),t}multiply(e){const t=new Matrix;return t.M11=this.M11*e.M11+this.M12*e.M21+this.M13*e.M31,t.M12=this.M11*e.M12+this.M12*e.M22+this.M13*e.M32,t.M13=this.M11*e.M13+this.M12*e.M23+this.M13*e.M33,t.M21=this.M21*e.M11+this.M22*e.M21+this.M23*e.M31,t.M22=this.M21*e.M12+this.M22*e.M22+this.M23*e.M32,t.M23=this.M21*e.M13+this.M22*e.M23+this.M23*e.M33,t.M31=this.M31*e.M11+this.M32*e.M21+this.M33*e.M31,t.M32=this.M31*e.M12+this.M32*e.M22+this.M33*e.M32,t.M33=this.M31*e.M13+this.M32*e.M23+this.M33*e.M33,this.M11=t.M11,this.M12=t.M12,this.M13=t.M13,this.M21=t.M21,this.M22=t.M22,this.M23=t.M23,this.M31=t.M31,this.M32=t.M32,this.M33=t.M33,this}translate(e,t){const o=new Matrix;return o.M31=e,o.M32=t,this.multiply(o),this}rotate(e){const t=new Matrix;return t.M11=Math.cos(e*Math.PI/180),t.M12=Math.sin(e*Math.PI/180),t.M21=-t.M12,t.M22=t.M11,this.multiply(t),this}scale(e,t){e=e||1,t=t||e;const o=new Matrix;return o.M11=e,o.M22=t,this.multiply(o),this}skew(e,t){e=e||0,t=t||e;const o=new Matrix;return e+t<90&&(o.M12=Math.tan(e*Math.PI/180),o.M21=Math.tan(t*Math.PI/180)),this.multiply(o),this}invert(){let e=this.determinant();if(0!=e){const t=this.clone();e=1/e,this.M11=(t.M22*t.M33-t.M32*t.M23)*e,this.M12=-(t.M12*t.M33-t.M32*t.M13)*e,this.M13=(t.M12*t.M23-t.M22*t.M13)*e,this.M21=-(t.M21*t.M33-t.M31*t.M23)*e,this.M22=(t.M11*t.M33-t.M31*t.M13)*e,this.M23=-(t.M11*t.M23-t.M21*t.M13)*e,this.M31=(t.M21*t.M32-t.M31*t.M22)*e,this.M32=-(t.M11*t.M32-t.M31*t.M12)*e,this.M33=(t.M11*t.M22-t.M21*t.M12)*e}return this}toString(){let e='<table border="1">';return e+="<tr><th>["+Math.round(100*this.M11)/100+"]</th><th>["+Math.round(100*this.M12)/100+"]</th><th>["+Math.round(100*this.M13)/100+"]</th></tr>\n",e+="<tr><th>["+Math.round(100*this.M21)/100+"]</th><th>["+Math.round(100*this.M22)/100+"]</th><th>["+Math.round(100*this.M23)/100+"]</th></tr>\n",e+="<tr><th>["+Math.round(100*this.M31)/100+"]</th><th>["+Math.round(100*this.M32)/100+"]</th><th>["+Math.round(100*this.M33)/100+"]</th></tr>\n",e+="</table>",e}}class Polygon{constructor(e=[]){this.points=e}clone(){return new Polygon(this.points.map((e=>({x:e.x,y:e.y}))))}transform(e){return new Polygon(this.points.map((t=>e.GetNewPoint(t))))}rotate(e){const t=new Matrix,o=this.getBoundingBox();return t.translate(-(o.left+o.width/2),-(o.top+o.height/2)),t.rotate(e),t.translate(o.left+o.width/2,o.top+o.height/2),this.transform(t)}getBoundingBox(){let e,t,o,i;const r=this.points,s=this.points.length;if(s){e=r[0].x,t=e,o=r[0].y,i=o;for(let n=1;n<s;n++)e=Math.min(e,r[n].x),t=Math.max(t,r[n].x),o=Math.min(o,r[n].y),i=Math.max(i,r[n].y);return new Rect(e,o,t-e,i-o)}return console_log("getBoundingBox failed, no points submitted"),new Rect(0,0,100,100)}getInnerBox(){const e=[],t=[],o=this.points.length;for(let i=0;i<o;i++)e.push(this.points[i].x),t.push(this.points[i].y);if(e.sort((function(e,t){return e-t})),t.sort((function(e,t){return e-t})),o>=4){const i=e[1],r=(t[1]+t[0])/2,s=e[o-2]-i,n=(t[o-2]+t[o-1])/2-r;return new Rect(i,r,s,n)}return null}getEdgesAndNormals(){const e=this.points,t=e.length,o=[],i=[];for(let r=0;r<t;r++){const s=e[r],n=r<t-1?e[r+1]:e[0],a=new Point(n.x,n.y).sub(s),l=new Point(a.x,a.y).rot90().normalize();o.push(a),i.push(l)}return{edges:o,normals:i}}testForOverlap(e){let t=this.points.length;let o=e.points.length;const i=this.getEdgesAndNormals(),r=e.getEdgesAndNormals();for(;t--;)if(_hasSepAxis(this,e,i.normals[t]))return!1;for(;o--;)if(_hasSepAxis(this,e,r.normals[o]))return!1;return!0}}const _VECBUF=[];for(let e=0;e<10;e++)_VECBUF.push(new Point(0,0));const _ARRAYBUF=[];for(let e=0;e<5;e++)_ARRAYBUF.push([]);const _flattenPointsOn=function(e,t,o){let i=Number.MAX_VALUE,r=-Number.MAX_VALUE,s=e.length;for(;s--;){const o=new Point(e[s]).dot(t);i=Math.min(o,i),r=Math.max(o,r)}o[0]=i,o[1]=r},_hasSepAxis=function(e,t,o){const i=e.points,r=t.points,s=_ARRAYBUF.pop(),n=_ARRAYBUF.pop(),a=_VECBUF.pop();if(!a)throw"_hasSepAxis: _VECBUF is empty error";const l=a.dot(o);return _flattenPointsOn(i,o,s),_flattenPointsOn(r,o,n),n[0]+=l,n[1]+=l,s[0]>n[1]||n[0]>s[1]?(_VECBUF.push(a),_ARRAYBUF.push(s),_ARRAYBUF.push(n),!0):(_VECBUF.push(a),_ARRAYBUF.push(s),_ARRAYBUF.push(n),!1)};class Rect{constructor(e=0,t=0,o=0,i=0){this.left=e,this.top=t,this.width=o,this.height=i||o}toPolygon(e){const t=new Polygon([new Point(this.left,this.top),new Point(this.left+this.width,this.top),new Point(this.left+this.width,this.top+this.height),new Point(this.left,this.top+this.height)]);return e?t.transform(e):t}getRotMatrix(e){const t=new Matrix;return t.translate(-(this.left+this.width/2),-(this.top+this.height/2)),t.rotate(e),t.translate(this.left+this.width/2,this.top+this.height/2),t}getRotatedAsPolygon(e){const t=this.getRotMatrix(e);return this.toPolygon(t)}getCombinedBox(e){let t=0,o=0,i=0,r=0;if(t=this.left<e.left?this.left:e.left,o=this.top<e.top?this.top:e.top,i=this.left+this.width>e.left+e.width?this.left+this.width:e.left+e.width,r=this.top+this.height>e.top+e.height?this.top+this.height:e.top+e.height,r<o){const e=o;o=r,r=e}if(i<t){const e=t;t=i,i=e}return new Rect(t,o,i-t,r-o)}hasOverlap(e){return!(this.left>e.left+e.width)&&(!(this.left+this.width<e.left)&&(!(this.top>e.top+e.height)&&!(this.top+this.height<e.top)))}isPointInside(e){return e.x>=this.left&&e.x<=this.left+this.width&&e.y>=this.top&&e.y<=this.top+this.height}isPolygonInside(e){if(e.points){const t=e.points.length;if(t>0){let o=!0,i=0;for(;o&&i<t;){const t=e.points[i];t.x>=this.left||(o=!1),t.x<=this.left+this.width||(o=!1),t.y>=this.top||(o=!1),t.y<=this.top+this.height||(o=!1),i++}return o}}return!1}}let xLines=[],yLines=[];class SnapLine{constructor(e,t,o,i,r,s){this.type=e,this.position=t,this.boxId=r,this.origin=o,this.context=i,this.rect=s}draw(e){const t=scope().docUi.getDivForSelection();if(!t)return;const o=document.createElement("div");o.style.position="absolute";const i=this.boxId?"red":"green";if("x"===this.type){const t=Math.min(this.rect.top,e.top)-20,r=Math.max(this.rect.top+this.rect.height,e.top+e.height)+20;o.style.left=this.position+"px",o.style.top=t+"px",o.style.width="1px",o.style.height=Math.abs(r-t)+"px",o.style.borderLeft="1px dashed "+i,xLines.push(o)}else{const t=Math.min(this.rect.left,e.left)-20,r=Math.max(this.rect.left+this.rect.width,e.left+e.width)+20;o.style.left=t+"px",o.style.top=this.position+"px",o.style.height="1px",o.style.width=Math.abs(r-t)+"px",o.style.borderTop="1px dashed "+i,yLines.push(o)}null==t||t.appendChild(o)}static clear_ui(e){if(!e||"x"===e){for(const e of xLines)e.parentElement&&e.parentElement.removeChild(e);xLines=[]}if(!e||"y"===e){for(const e of yLines)e.parentElement&&e.parentElement.removeChild(e);yLines=[]}}static add(e,t,o,i,r,s){let n=null;"Doc"===t||"Bleed"===t||"Save"===t||t.startsWith("Margin")||(n=t);const a=new SnapLine(o,i,r,n?"box":"page",n,s);"x"===o?e.snapLinesX.set(r+t,a):e.snapLinesY.set(r+t,a)}static addBox(e,t,o){SnapLine.add(e,t,"x",o.left,"start",o),SnapLine.add(e,t,"x",o.left+o.width/2,"center",o),SnapLine.add(e,t,"x",o.left+o.width,"end",o),SnapLine.add(e,t,"y",o.top,"start",o),SnapLine.add(e,t,"y",o.top+o.height/2,"center",o),SnapLine.add(e,t,"y",o.top+o.height,"end",o)}static get threshold(){return 5/zoomFactor()}static getClosestLeftSnapline(e){const t=scope().docUi.currentSpread,o=SnapLine.threshold;let i=o+1,r=null;const s=e.left-o,n=e.left+o;for(const o of t.snapLinesX.values())o.position>s&&o.position<n&&Math.abs(o.position-e.left)<i&&(o.boxId&&scope().selection.has(o.boxId)||(i=Math.abs(o.position-e.left),r=o));return null==r||r.draw(e),r}static getClosestCenterSnapline(e){const t=scope().docUi.currentSpread,o=SnapLine.threshold;let i=o+1,r=null;const s=e.left+e.width/2-o,n=e.left+e.width/2+o;for(const o of t.snapLinesX.values())o.position>s&&o.position<n&&Math.abs(o.position-(e.left+e.width/2))<i&&(o.boxId&&scope().selection.has(o.boxId)||(i=Math.abs(o.position-(e.left+e.width/2)),r=o));return null==r||r.draw(e),r}static snapToLayoutGrid(e){const t=scope().templateProperties.gridStepInPx;return Math.round(e/t)*t}static snapToLines(e,t,o="position"){const i=[];if("position"===o||"start"===o){const o=scope().docUi.currentSpread.getSnapLinesByPosition(e,"start",t);o&&i.push(o)}if("position"===o){const o=scope().docUi.currentSpread.getSnapLinesByPosition(e,"center",t);o&&i.push(o)}if("position"===o||"size"===o){const o=scope().docUi.currentSpread.getSnapLinesByPosition(e,"end",t);o&&i.push(o)}if(i.length){const r=i.sort(((e,t)=>e.dif-t.dif))[0],s=r.snaps[0].position;for(const e of i){const o=Math.abs(e.dif-r.dif);if(console_log("DIFF "+e.where+"="+o),o<1)for(const o of e.snaps)o.draw(t)}return"size"===o?"x"===e?s-t.left:s-t.top:"start"===o||"start"===r.where?s:"center"===r.where?"x"===e?s-t.width/2:s-t.height/2:"x"===e?s-t.width:s-t.height}return"size"===o?"x"===e?t.width:t.height:"x"===e?t.left:t.top}static snapLeft(e,t="position"){return scope().templateProperties.showGrid?this.snapToLayoutGrid(e.left):scope().templateProperties.showSmartGuides?this.snapToLines("x",e,t):e.left}static snapTop(e,t="position"){return scope().templateProperties.showGrid?this.snapToLayoutGrid(e.top):scope().templateProperties.showSmartGuides?this.snapToLines("y",e,t):e.top}static snapWidth(e){return scope().templateProperties.showGrid?this.snapToLayoutGrid(e.left+e.width)-e.left:scope().templateProperties.showSmartGuides?this.snapToLines("x",e,"size"):e.width}static snapHeight(e){return scope().templateProperties.showGrid?this.snapToLayoutGrid(e.top+e.height)-e.top:scope().templateProperties.showSmartGuides?this.snapToLines("y",e,"size"):e.height}}const rotatediscreteStep=15;function getXFactor(e){switch(e){case"left":return 0;case"center":return.5;case"right":return 1}}function getYFactor(e){switch(e){case"top":return 0;case"middle":return.5;case"bottom":return 1}}function getPinPoint(e,t,o){const i=new Point,r=getXFactor(e.ax),s=getYFactor(e.ay);switch(t){case"left":i.x=e.left-r*e.width;break;case"center":i.x=e.left+e.width/2-r*e.width;break;case"right":i.x=e.left+e.width-r*e.width}switch(o){case"top":i.y=e.top-s*e.height;break;case"middle":i.y=e.top+e.height/2-s*e.height;break;case"bottom":i.y=e.top+e.height-s*e.height}return i}function xGrow(e){switch(e){case"left":return-1;case"center":return 0;case"right":return 1}}function yGrow(e){switch(e){case"top":return-1;case"middle":return 0;case"bottom":return 1}}function rotatePointInBox(e,t,o,i,r=.5,s=.5){const n=new Matrix;return n.translate(-(o.left+o.width*r),-(o.top+o.height*s)),n.rotate(i),n.translate(o.left+o.width*r,o.top+o.height*s),{x:n.GetNewX(e,t),y:n.GetNewY(e,t)}}function getRotationAngle(e,t,o,i){let r=0;const s=o-e,n=i-t;return 0===s&&0===n||(0===s?r=n>0?90:270:0===n?r=s>0?0:180:s>0&&n>0?r=180*Math.atan(n/s)/Math.PI:s<0&&n>0?r=90+180*Math.atan(-s/n)/Math.PI:s<0&&n<0?r=180+180*Math.atan(-n/-s)/Math.PI:s>0&&n<0&&(r=270+180*Math.atan(s/-n)/Math.PI)),r}function changeAnchor(e,t,o,i,r,s,n=!1){let a=e.left,l=e.top;const c={x:e.left+e.width*r,y:e.top+e.height*s},d=rotatePointInBox(c.x,c.y,e,t,o,i);return a+=d.x-c.x,l+=d.y-c.y,n||(a+=e.width*r,l+=e.height*s),{left:a,top:l,width:e.width,height:e.height}}let lastValidTransformedBox=null;function resetLastValidTransformedBox(){lastValidTransformedBox=null}function transformRect(e,t,o,i,r,s="right",n="bottom",a="scale",l=e.width,c=e.height,d="center",h="middle",p=!0,u,m=!0){const f={left:e.left,top:e.top,width:e.width,height:e.height,rotation:e.rotation,ax:e.ax,ay:e.ay,rotXFactor:e.rotXFactor,rotYFactor:e.rotYFactor},g=new Matrix;g.translate(-getPinPoint(e,d,h).x,-getPinPoint(e,d,h).y),g.rotate(-e.rotation),g.translate(getPinPoint(f,d,h).x,getPinPoint(f,d,h).y);const y=g.GetNewX(t,o),b=g.GetNewY(t,o);if("translate"===a)f.left+=i,f.top+=r,m&&(f.left=SnapLine.snapLeft(f),f.top=SnapLine.snapTop(f));else if("shift-translate"===a)Math.abs(i)>Math.abs(r)?(f.left+=i,m&&(f.left=SnapLine.snapLeft(f))):(f.top+=r,m&&(f.top=SnapLine.snapTop(f)));else if("rotate"===a||"shift-rotate"===a){const s=getPinPoint(e,"left","top"),n=s.x+e.rotXFactor*e.width,l=s.y+e.rotXFactor*e.width,c=getRotationAngle(n,l,t-i,o-r),d=getRotationAngle(n,l,t,o),h=f.rotation+(d-c);console_log("angle1="+c+"/angle2="+d+"/rot="+f.rotation+"/result="+h),f.rotation+=d-c,"shift-rotate"===a&&(f.rotation=15*Math.floor(f.rotation/15)),f.rotation>=360&&(f.rotation-=360)}else if("scale"===a||"scale-prop"===a){const t=getPinPoint(e,s,n),o=xGrow(s),i=yGrow(n);let r=(y-t.x)*o,p=(b-t.y)*i;if("scale-prop"===a&&e.width>0&&e.height>0){const e=c/l*r,t=l/c*p;"left"===s&&"middle"===n||"right"===s&&"middle"===n?p=c/l*r:"center"===s&&"top"===n||"center"===s&&"bottom"===n||e>=t?r=l/c*p:p=c/l*r}f.width+r<0?(r=-f.width,f.width=0):f.width+=r,f.height+p<0?(p=-f.height,f.height=0):f.height+=p;const u=new Matrix;u.translate(-getPinPoint(e,d,h).x,-getPinPoint(e,d,h).y),u.rotate(e.rotation),u.translate(getPinPoint(e,d,h).x,getPinPoint(e,d,h).y);const m=new Matrix;m.translate(-getPinPoint(f,d,h).x,-getPinPoint(f,d,h).y),m.rotate(f.rotation),m.translate(getPinPoint(f,d,h).x,getPinPoint(f,d,h).y);let g=getPinPoint(e,"center","middle"),v=getPinPoint(f,"center","middle");switch(s+" "+n){case"left top":g=getPinPoint(e,"right","bottom"),v=getPinPoint(f,"right","bottom");break;case"center top":g=getPinPoint(e,"center","bottom"),v=getPinPoint(f,"center","bottom");break;case"right top":g=getPinPoint(e,"left","bottom"),v=getPinPoint(f,"left","bottom");break;case"left middle":g=getPinPoint(e,"right","middle"),v=getPinPoint(f,"right","middle");break;case"center middle":g=getPinPoint(e,"center","middle"),v=getPinPoint(f,"center","middle");break;case"right middle":g=getPinPoint(e,"left","middle"),v=getPinPoint(f,"left","middle");break;case"left bottom":g=getPinPoint(e,"right","top"),v=getPinPoint(f,"right","top");break;case"center bottom":g=getPinPoint(e,"center","top"),v=getPinPoint(f,"center","top");break;case"right bottom":g=getPinPoint(e,"left","top"),v=getPinPoint(f,"left","top")}f.left+=u.GetNewX(g.x,g.y)-m.GetNewX(v.x,v.y),f.top+=u.GetNewY(g.x,g.y)-m.GetNewY(v.x,v.y)}let v=!1;if(p&&(config.isBuyer||config.isMobile)){const e=scope().currentDoc.pageWidth*scope().docUi.currentSpread.pages.length,t=scope().currentDoc.pageHeight;if(f.left<0&&(f.left=0),f.top<0&&(f.top=0),f.left+f.width>e){const t=e-f.width;t>0&&("translate"===a||"shift-translate"===a)?f.left=t:v=!0}if(f.top+f.height>scope().currentDoc.pageHeight){const e=t-f.height;e>0&&("translate"===a||"shift-translate"===a)?f.top=e:v=!0}}if("scale"===a&&0===f.rotation&&m){if(u&&"left"===u.horizontal){const e=SnapLine.snapLeft(f,"start");e!==f.left&&(f.width+=f.left-e,f.left=e)}if(u&&"top"===u.vertical){const e=SnapLine.snapTop(f,"start");e!==f.top&&(f.height+=f.top-e,f.top=e)}u&&"right"===u.horizontal&&(f.width=SnapLine.snapWidth(f)),u&&"bottom"===u.vertical&&(f.height=SnapLine.snapHeight(f))}return v?lastValidTransformedBox||e:(lastValidTransformedBox=f,f)}class Length extends NobsBase{constructor(e,t="px",o=!1,i=""){if(super(e,t),this.unit="px",this.value=0,this.equation="",this.mixed=!1,this.disableScript=!1,"string"==typeof e){let t=e;t.indexOf(",")>=0&&(t=t.indexOf(".")>=0?t.replace(",",""):t.replace(",",".")),t.indexOf("-.")>=0&&(t=t.replace("-.","-0.")),t&&(0===t.indexOf("=")?(this.equation=t.substr(1),this.unit="equation"):t.indexOf("px")>0?(this.value=parseFloat(t.replace("px","")),this.unit="px"):t.indexOf("cm")>0?(this.value=parseFloat(t.replace("cm","")),this.unit="cm"):t.indexOf("mm")>0?(this.value=parseFloat(t.replace("mm","")),this.unit="mm"):t.indexOf("pt")>0?(this.value=parseFloat(t.replace("pt","")),this.unit="pt"):t.indexOf("inch")>0?(this.value=parseFloat(t.replace("inch","")),this.unit="inch"):t.indexOf("%%")>0?(this.value=parseFloat(t.replace("%%","")),this.unit="%%"):t.indexOf("%")>0?(this.value=parseFloat(t.replace("%","")),this.unit="%"):(this.value=parseFloat(t),this.unit=scope().currentDoc.unit))}else"number"!=typeof e||t instanceof Length||(this.value=e,this.unit=t||"px",this.mixed=o,this.equation=i)}toString(){return"px"===this.unit?this.value+"px":"pt"===this.unit?this.value+"pt":"inch"===this.unit?this.value+"inch":"cm"===this.unit?this.value+"cm":"mm"===this.unit?this.value+"mm":"%"===this.unit?this.value+"%":"%%"===this.unit?this.value+"%%":"equation"===this.unit?"="+this.equation:void assertNever$1(this.unit)}toDisplayString(){return"px"===this.unit?Math.floor(this.value)+"px":"pt"===this.unit?Math.floor(this.value)+"pt":"cm"===this.unit?Math.floor(100*this.value)/100+"cm":"mm"===this.unit?Math.floor(10*this.value)/10+"mm":"inch"===this.unit?Math.floor(100*this.value)/100+"inch":"%"===this.unit?Math.floor(10*this.value)/10+"%":"%%"===this.unit?Math.floor(10*this.value)/10+"%%":"equation"===this.unit?"="+this.equation:"unset"}toPixel_1Axis(e){return this.toPixel(e,e)}toPixel_boxGeoProperty(e,t,o){return"left"===e||"right"===e||"width"===e?this.toPixel(t,o):"top"===e||"bottom"===e||"height"===e?this.toPixel(o,t):void assertNever$1(e)}resolveEquations(e,t){return"equation"==this.unit?new Length(this.toPixel(e,t),"px"):this}toPixel(e,t){if("px"===this.unit)return this.value;if("cm"===this.unit)return this.value*(96/2.54);if("mm"===this.unit)return this.value*(96/25.4);if("inch"===this.unit)return 96*this.value;if("pt"===this.unit)return this.value*(1/.75);if("equation"===this.unit&&this.disableScript)return 111;if("equation"===this.unit){const o={};let i=0;const r=this.equation.replace(/\d+\.*\d*(cm|px|inch|%|pt)/gm,(o=>new Length(o).toPixel(e,t).toString()));try{i=new Function("return "+r).bind(o)()}catch(e){console.error("Script-Error in Length-Equation: [="+this.equation+"] "),console.error(e)}return i}return"%"===this.unit?this.value/100*e:"%%"===this.unit?this.value/100*t:void assertNever$1(this.unit)}toPixelOrPercent(){return"%"===this.unit?this.value+"%":"%%"===this.unit?(console.error("toPixelOrPercent: Cross axis alignment does not work (%%)."),this.value+"%"):this.toPixel(100,100)+"px"}fromPixel_1Axis(e,t){return this.fromPixel(e,t,t)}fromPixel_boxGeoProperty(e,t,o,i){return"left"===t||"right"===t||"width"===t?this.fromPixel(e,o,i):"top"===t||"bottom"===t||"height"===t?this.fromPixel(e,i,o):void assertNever$1(t)}fromPixel(e,t,o,i=this.unit,r=-1){let s=0;if("equation"===i)return this;if("%"===i?s=e/t*100:"%%"===i?s=e/o*100:"cm"===i?s=e/(96/2.54):"mm"===i?s=e/(96/25.4):"inch"===i?s=e/96:"pt"===i?s=.75*e:"px"===i?s=e:assertNever$1(i),r>=0){const e=Math.pow(10,r);s=Math.round(s*e)/e}return new Length(s,i)}addPixel(e,t){const o=this.toPixel(e,e)+t;return this.fromPixel_1Axis(o,e)}static minValue(){return.1}static deserialize(e){return new Length(e.v,e.u,void 0,e.e)}clone(){return new Length(this.value,this.unit,void 0,this.equation)}serialize(){return{u:this.unit,v:this.value,e:this.equation}}}class BoxGeometry extends NobsBase{constructor(e=200,t=200,o=400,i=300,r=0,s=!1,n="0",a){if(super(e,t),this.id=generateDBID(),"number"==typeof e&&"number"==typeof t){const l=e,c=t;a?(this.left=new Length(0,a).fromPixel(l,111,111),this.top=new Length(0,a).fromPixel(c,111,111),this.right=new Length(0,a),this.bottom=new Length(0,a),this.width=new Length(0,a).fromPixel(o,111,111),this.height=new Length(0,a).fromPixel(i,111,111)):(this.left=new Length(l,"px"),this.top=new Length(c,"px"),this.right=new Length(0,"px"),this.bottom=new Length(0,"px"),this.width=new Length(o,"px"),this.height=new Length(i,"px")),this.rotation=r,this.anchorTop=!0,this.anchorBottom=!1,this.anchorLeft=!0,this.anchorRight=!1,this.moverAnchor="lt",this.rotateAroundCenter=s,this.anchorRotation=n}else if(!(e instanceof Nobs)){const t=e;this.left=Length.deserialize(t.l),this.top=Length.deserialize(t.t),this.bottom=Length.deserialize(t.b),this.right=Length.deserialize(t.r),this.width=Length.deserialize(t.w),this.height=Length.deserialize(t.h),this.rotation=t.a,this.anchorLeft=t.al,this.anchorTop=t.at,this.anchorBottom=t.ab,this.anchorRight=t.ar,this.moverAnchor=t.ma||"lt",this.anchorRotation=t.arot||0}"string"==typeof this.rotation&&(alert("Rotation is a string!!!"),this.rotation=parseFloat(this.rotation)),this.styleControlledProperties||(this.styleControlledProperties=new Map),this.anchorRotation||(this.anchorRotation="0"),void 0===this.rotateAroundCenter&&(this.rotateAroundCenter=!1)}hasWidth(){return!(this.anchorLeft&&this.anchorRight)}hasHeight(){return!(this.anchorTop&&this.anchorBottom)}hasMoverAnchor(){return"lt"!==this.moverAnchor&&this.anchorLeft&&this.anchorTop&&!this.anchorRight&&!this.anchorBottom}toFrame(e,t,o="???",i=!1){let r=this.toPixel(e,t),s=BoxGeometry.getRotationPositionX(this),n=BoxGeometry.getRotationPositionY(this);if(i&&(.5!==s||.5!==n)){const e=changeAnchor(r,this.rotation,s,n,.5,.5,!0);r=new Rect(e.left,e.top,e.width,e.height),s=.5,n=.5}return{left:r.left,top:r.top,width:r.width,height:r.height,children:[],parent:null,layer:"",rotation:this.rotation,id:o,zindex:0,rotationPositionX:s,rotationPositionY:n}}hasPercentages(){return"%"===this.left.unit||"%"===this.top.unit||"%"===this.bottom.unit||"%"===this.right.unit||"%"===this.width.unit||"%"===this.height.unit||"%%"===this.left.unit||"%%"===this.top.unit||"%%"===this.bottom.unit||"%%"===this.right.unit||"%%"===this.width.unit||"%%"===this.height.unit}hasCrossAxisPercentages(){return"%%"===this.left.unit||"%%"===this.top.unit||"%%"===this.bottom.unit||"%%"===this.right.unit||"%%"===this.width.unit||"%%"===this.height.unit}hasAnchorRotation(){return!("0"===this.anchorRotation||this.hasWidth()&&this.hasHeight())}hasEquations(){return"equation"===this.left.unit||"equation"===this.top.unit||"equation"===this.bottom.unit||"equation"===this.right.unit||"equation"===this.width.unit||"equation"===this.height.unit}toPixel(e,t,o=!1){const i=new Rect(0,0,0,0);!0!==o||!this.anchorRotation||this.hasAnchorRotation()&&!scope().pathEditorActive()||(o=!1);const r=BoxGeometry.getRotationPositionX(this),s=BoxGeometry.getRotationPositionY(this);if(this.hasWidth())i.width=this.width.toPixel(e,t),this.anchorLeft?i.left=this.left.toPixel(e,t)-i.width*r:i.left=e-this.right.toPixel(e,t)-i.width*r;else{const o=e-this.right.toPixel(e,t);i.width=Math.abs(o-this.left.toPixel(e,t)),i.left=this.left.toPixel(e,t)}if(this.hasHeight())i.height=this.height.toPixel(t,e),this.anchorTop?i.top=this.top.toPixel(t,e)-i.height*s:i.top=t-this.bottom.toPixel(t,e)-i.height*s;else{const o=t-this.bottom.toPixel(t,e);i.height=Math.abs(o-this.top.toPixel(t,e)),i.top=this.top.toPixel(t,e)}if(o&&this.hasAnchorRotation()){const e=new Rect(0,0,0,0);return"90"===this.anchorRotation||"270"===this.anchorRotation?(e.width=i.height,e.height=i.width):(e.width=i.width,e.height=i.height),"90"===this.anchorRotation&&(e.left=i.left+i.width,e.top=i.top),"180"===this.anchorRotation&&(e.left=i.left+i.width,e.top=i.top+i.height),"270"===this.anchorRotation&&(e.left=i.left,e.top=i.top+i.height),e}return i}fromPixel(e,t,o,i,r,s,n,a=!0,l,c){const d=new Nobs,h=BoxGeometry.getRotationPositionX(this),p=BoxGeometry.getRotationPositionY(this);a&&(this.hasWidth()&&(o+=r*h),this.hasHeight()&&(i+=s*p));let u=null,m=null,f=null,g=null,y=null,b=null;this.hasWidth()?(y=r,this.anchorRight&&(u=e-o)):u=e-o-r,m=o,this.hasHeight()?(b=s,this.anchorBottom&&(f=t-i)):f=t-i-s,g=i,null===y&&null!==u&&(y=e-m-u),null===u&&null!==y&&(u=e-m-y),null===b&&null!==f&&(b=t-g-f),null===f&&null!==b&&(f=t-g-b),this.anchorLeft||null===y||null===u||(m=e-y-u),this.anchorTop||null===b||null===f||(g=t-b-f);const v={left:this.left.unit,top:this.top.unit,right:this.right.unit,bottom:this.bottom.unit,width:this.width.unit,height:this.height.unit};return l&&c&&(v[l]=c),null!==m&&this.setNobsPropertyWithStyleCheck(d,"left",this.left.fromPixel(m,e,t,v.left)),null!==u&&this.setNobsPropertyWithStyleCheck(d,"right",this.right.fromPixel(u,e,t,v.right)),null!==g&&this.setNobsPropertyWithStyleCheck(d,"top",this.top.fromPixel(g,t,e,v.top)),null!==f&&this.setNobsPropertyWithStyleCheck(d,"bottom",this.bottom.fromPixel(f,t,e,v.bottom)),null!==y&&this.setNobsPropertyWithStyleCheck(d,"width",this.width.fromPixel(y,e,t,v.width)),null!==b&&this.setNobsPropertyWithStyleCheck(d,"height",this.height.fromPixel(b,t,e,v.height)),this.styleControlledProperties.has("rotation")||d.setProperty(this,"rotation",n),(this.hasWidth()&&this.hasHeight()||"lt"!==this.moverAnchor)&&d.setProperty(this,"anchorRotation",0),new BoxGeometry(d,this)}setNobsPropertyWithStyleCheck(e,t,o){const i=this.styleControlledProperties.get(t);i&&("height"!==t&&"bottom"!==t||"autoSize"!==i.origin)||e.replaceObject(this[t],o)}static from_cm(e){return 37.7952755906*e}includeStyle(e,t,o){let i=new Nobs;const r=new Map;if(e){let s=this.anchorTop,n=this.anchorBottom,a=this.anchorLeft,l=this.anchorRight;const c=scope().getStyleProperty(e,"left",void 0,void 0,o),d=scope().getStyleProperty(e,"top",void 0,void 0,o),h=scope().getStyleProperty(e,"bottom",void 0,void 0,o),p=scope().getStyleProperty(e,"right",void 0,void 0,o),u=scope().getStyleProperty(e,"width",void 0,void 0,o),m=scope().getStyleProperty(e,"height",void 0,void 0,o),f=scope().getStyleProperty(e,"rotation",void 0,void 0,o),g=scope().getStyleProperty(e,"anchorRotation",void 0,void 0,o);c&&("width"!==t||a&&!l)&&(i.setProperty(this,"left",c.value),r.set("left",{selector:c.selector,origin:"class"})),p&&("width"!==t||l&&!a)&&(i.setProperty(this,"right",p.value),r.set("right",{selector:p.selector,origin:"class"})),d&&("height"!==t||s&&!n)&&(i.setProperty(this,"top",d.value),r.set("top",{selector:d.selector,origin:"class"})),h&&("height"!==t||n&&!s)&&(i.setProperty(this,"bottom",h.value),r.set("bottom",{selector:h.selector,origin:"class"})),u&&"width"!==t&&(i.setProperty(this,"width",u.value),r.set("width",{selector:u.selector,origin:"class"})),m&&"height"!==t&&(i.setProperty(this,"height",m.value),r.set("height",{selector:m.selector,origin:"class"})),f&&(i.setProperty(this,"rotation",f.value),r.set("rotation",{selector:f.selector,origin:"class"})),g&&(i.setProperty(this,"anchorRotation",g.value),r.set("anchorRotation",{selector:g.selector,origin:"class"})),c&&(a=!0,r.set("anchorLeft",{selector:c.selector,origin:"class"})),p&&(l=!0,r.set("anchorRight",{selector:p.selector,origin:"class"})),c&&u&&(l=!1,r.set("anchorRight",{selector:c.selector+"/"+u.selector,origin:"class"})),p&&u&&!c&&(a=!1,r.set("anchorLeft",{selector:p.selector+"/"+u.selector,origin:"class"})),d&&(s=!0,r.set("anchorTop",{selector:d.selector,origin:"class"})),h&&(n=!0,r.set("anchorBottom",{selector:h.selector,origin:"class"})),d&&m&&(n=!1,r.set("anchorBottom",{selector:d.selector+"/"+m.selector,origin:"class"})),h&&m&&!d&&(s=!1,r.set("anchorTop",{selector:h.selector+"/"+m.selector,origin:"class"})),i.setProperty(this,"anchorLeft",a),i.setProperty(this,"anchorTop",s),i.setProperty(this,"anchorBottom",n),i.setProperty(this,"anchorRight",l)}"off"!==t&&("width"===t&&(r.set("width",{selector:"[auto-size]",origin:"autoSize"}),r.set("anchorLeft",{selector:"[auto-size]",origin:"autoSize"}),r.set("anchorRight",{selector:"[auto-size]",origin:"autoSize"}),i.setProperty(this,"anchorLeft",!0),i.setProperty(this,"anchorRight",!1)),"height"===t&&(r.set("height",{selector:"[auto-size]",origin:"autoSize"}),r.set("anchorTop",{selector:"[auto-size]",origin:"autoSize"}),r.set("anchorBottom",{selector:"[auto-size]",origin:"autoSize"}),i.setProperty(this,"anchorTop",!0),i.setProperty(this,"anchorBottom",!1))),r.size&&i.setProperty(this,"styleControlledProperties",r);let s=new BoxGeometry(i,this);return!s.rotation||s.hasWidth()&&s.hasHeight()||(i=(new Nobs).setProperty(s,"rotation",0),s=new BoxGeometry(i,s)),s}static getRotationPositionX(e){let t=.5;const o=e instanceof BoxGeometry?e.moverAnchor:e;return"l"===o.substr(0,1)&&(t=0),"r"===o.substr(0,1)&&(t=1),t}static getRotationPositionY(e){let t=.5;const o=e instanceof BoxGeometry?e.moverAnchor:e;return"t"===o.substr(1,1)&&(t=0),"b"===o.substr(1,1)&&(t=1),t}get moverAnchorNameX(){return"l"===this.moverAnchor.substr(0,1)?"left":"r"===this.moverAnchor.substr(0,1)?"right":"center"}get moverAnchorNameY(){return"t"===this.moverAnchor.substr(1,1)?"top":"b"===this.moverAnchor.substr(1,1)?"bottom":"middle"}cssRotation(e,t=!1,o,i,r=!1,s=!1){const n=o?this.includeStyle(o,i):this;e=!(!e||t||!n.hasAnchorRotation());let a="",l=BoxGeometry.getRotationPositionX(n),c=BoxGeometry.getRotationPositionY(n),d="0deg",h="";return r&&(h+=" scaleX(-1)"),s&&(h+=" scaleY(-1)"),e?d=n.anchorRotation+"deg":n.rotation&&!t&&(d=n.rotation+"deg"),"0deg"!==d?(!0===this.rotateAroundCenter&&(l=.5,c=.5,a+="transform-origin: 50% 50%;"),r&&(0===l&&(h+=" translateX(-100%)"),1===l&&(h+=" translateX(100%)")),s&&(0===c&&(h+=" translateY(-100%)"),1===c&&(h+=" translateY(100%)")),a+=`transform-origin: ${100*l}% ${100*c}%; transform: rotate(${d})${h}; `):h&&(a+="transform:"+h+";"),a}css(e,t,o,i=!1,r,s,n="includeRotation",a=!1,l=!1,c=!1){let d,h,p,u,m,f;const g=r?this.includeStyle(r,s):this;if(o=!(!o||i||!g.hasAnchorRotation()),!e||!t)throw new Error("get css: no page-width or page-height was set");{const i=this.toPixel(e,t,o);d=i.left+"px",u=i.top+"px",f=i.width+"px",m=i.height+"px",h=null,p=null}let y="position: absolute; ";if(null!==d&&(y+="left: "+d+"; "),null!==h&&(y+="right: "+h+"; "),null!==p&&(y+="bottom: "+p+"; "),null!==u&&(y+="top: "+u+"; "),null!==m&&(y+="height: "+m+"; "),null!==f&&(y+="width: "+f+"; "),"includeRotation"==n)y+=this.cssRotation(o,i,r,s,a,l);else{let e="";a&&(e+=" scaleX(-1)"),l&&(e+=" scaleY(-1)"),e&&(y+="transform:"+e+";")}return y}isYAxisControlledByStyle(e,t=null){let o=!1;return"top"===e&&(o=o||this.has("top",t),o=o||this.has("height",t)),"bottom"===e&&(o=o||this.has("bottom",t),o=o||this.has("height",t)),o}isXAxisControlledByStyle(e,t=null){let o=!1;return"left"===e&&(o=o||this.has("left",t),o=o||this.has("width",t)),"right"===e&&(o=o||this.has("right",t),o=o||this.has("width",t)),o}moveXLocked(){let e=!1;return e=e||this.has("left",null)||this.has("right",null),e}moveYLocked(){let e=!1;return e=e||this.has("top",null)||this.has("bottom",null),e}has(e,t){const o=this.styleControlledProperties.get(e);if(o){if(null===t)return!!o;if(!0===t&&"autoSize"===o.origin)return!0;if(!1==!t&&"autoSize"!==o.origin)return!0}return!1}serialize(){return{l:this.left.serialize(),t:this.top.serialize(),b:this.bottom.serialize(),r:this.right.serialize(),w:this.width.serialize(),h:this.height.serialize(),a:this.rotation,al:this.anchorLeft,ar:this.anchorRight,at:this.anchorTop,ab:this.anchorBottom,ma:this.moverAnchor,arot:this.anchorRotation}}}class SnippetCluster extends NobsBase{constructor(e,t){if(super(e,t),this.canEdit=()=>!0,this.canRemove=()=>!0,this.canMove=()=>!0,!(e instanceof Nobs||t instanceof SnippetCluster)){const e=t;this.id=e.id||generateDBID(),this.name=e.na||"New Snippet Group",this.tags=e.tags||[]}}serializeSimple(){return{id:this.id,na:this.name,tags:this.tags}}serialize(e,t){return{id:e?generateDBID():this.id,data:this.serializeSimple(),parentId:"not-in-use",scopeId:scope().id,type:"snippet-group"}}}function getClonedFrameData(e){const t={id:e.id,left:e.left,top:e.top,width:e.width,height:e.height,rotation:e.rotation,zindex:e.zindex,layer:e.layer,parent:e.parent,rotationPositionX:e.rotationPositionX,rotationPositionY:e.rotationPositionY,children:[]},o=e.children.length;for(let i=0;i<o;i++)t.children.push(getClonedFrameData(e.children[i])),t.children[i].parent=t;return t}function transformFrame(e,t,o=null){o||((o=getClonedFrameData(t)).children=[],o.parent=null,o.id=e.id);const i=e.children.length||0;if(i>0){let r=1,s=1;0!=e.width&&0!=e.height&&(r=t.width/e.width,s=t.height/e.height),console_log("transformFrame: "+r+"/"+s);for(let t=0;t<i;t++){const i=e.children[t];let n=getScaledPolygon(i,r,s);const a=new Point(n.points[2]).getAngle(n.points[1]);n=getScaledPolygon(i,r,s,i.rotation+a);const l=n.getInnerBox();if(l){const e=getClonedFrameData(i);e.children=[],e.parent=o,e.left=l.left,e.top=l.top,e.width=l.width,e.height=l.height,e.rotation=e.rotation+a,e.rotation>=360&&(e.rotation-=360),o.children.push(e),i.children.length>0&&transformFrame(i,e,e)}else console.error("innerBox is empty, transform failed")}}return o}function getScaledPolygon(e,t,o,i=0){i=i||e.rotation;const r=getLocalRotationMatrix(e);r.scale(t,o);const s=getUnrotatedBox(e);let n=s.toPolygon(r);const a=r.GetNewPoint(new Point(s.left+s.width/2,s.top+s.height/2)),l=new Matrix;return l.translate(-a.x,-a.y),l.rotate(-i),l.translate(a.x,a.y),n=n.transform(l),n}function hitTest(e,t,o=!1){const i=new Rect(e.left,e.top,e.width,e.height);o=o||!1;const r=[];if(t){const e=t.length||0;if(e>0)for(let s=0;s<e;s++){const e=t[s],n=getRotatedWorldPolygon(e);if(i.isPolygonInside(n))r.push(e);else if(!o){i.toPolygon().testForOverlap(n)&&r.push(e)}}}return r}function group(e){let t=new Rect,o=0,i="";const r=[];if(e){let s=e.length||0;if(s>0){for(let n=0;n<s;n++)if(void 0===e[n].parent||null==e[n].parent){const s=getRotatedWorldPolygon(e[n]).getBoundingBox();0==r.length?(t=s,o=e[n].zindex||0,i=e[n].layer):(t=t.getCombinedBox(s),o<e[n].zindex&&(o=e[n].zindex,i=e[n].layer)),r.push(getClonedFrameData(e[n]))}if(!t)return null;s=r.length;const n={id:null,left:t.left,top:t.top,width:t.width,height:t.height,rotation:0,zindex:0,rotationPositionX:.5,rotationPositionY:.5,layer:"",parent:null,children:[]};for(let e=0;e<s;e++)r[e].parent=n,r[e].left-=t.left,r[e].top-=t.top,r[e].zindex=o,r[e].layer=i;return n.children=r,n.zindex=o,n.layer=i,n}}return null}function ungroup(e){const t=e.children.length||0;if(0==t)return[e];{const o=[];for(let i=0;i<t;i++){const t=getClonedFrameData(e.children[i]),r=getWorldUnrotatedBox(t),s=getWorldRotation(t);t.left=r.left,t.top=r.top,t.width=r.width,t.height=r.height,t.rotation=s,t.parent=null,o.push(t)}return o}}function getBoundingBox(e){return getRotatedWorldPolygon(e).getBoundingBox()}function getBoundingBoxFromSelection(e){let t=new Rect;if(e){const o=e.length||0;if(o>0)for(let i=0;i<o;i++)t=0==i?getBoundingBox(e[i]):t.getCombinedBox(getBoundingBox(e[i]))}return t}function getToWorldMatrix(e){if(void 0!==e.parent&&null!=e.parent){const t=new Matrix;return t.translate(-e.parent.width/2,-e.parent.height/2),t.rotate(e.parent.rotation),t.translate(e.parent.width/2,e.parent.height/2),t.translate(e.parent.left,e.parent.top),t.multiply(getToWorldMatrix(e.parent)),t}return new Matrix}function getUnrotatedBox(e){return new Rect(e.left,e.top,e.width,e.height)}function getWorldUnrotatedBox(e){const t=getToWorldMatrix(e),o=-(getWorldRotation(e)-e.rotation),i=new Matrix;i.translate(-(e.left+e.width/2),-(e.top+e.height/2)),i.rotate(o),i.translate(e.left+e.width/2,e.top+e.height/2);const r=i.multiply(t),s=r.GetNewPoint(new Point(e.left,e.top)),n=r.GetNewPoint(new Point(e.left+e.width,e.top+e.height));return new Rect(s.x,s.y,n.x-s.x,n.y-s.y)}function getFullToWorldMatrix(e){return getLocalRotationMatrix(e).multiply(getToWorldMatrix(e))}function getRotatedWorldPolygon(e){return getUnrotatedBox(e).toPolygon(getFullToWorldMatrix(e))}function getWorldRotation(e){return e.parent&&void 0!==e.parent?getWorldRotation(e.parent)+e.rotation:e.rotation}function getLocalRotationMatrix(e){if(0==e.rotation)return new Matrix;{const t=new Matrix;return t.translate(-(e.left+e.width*e.rotationPositionX),-(e.top+e.height*e.rotationPositionY)),t.rotate(e.rotation),t.translate(e.left+e.width*e.rotationPositionX,e.top+e.height*e.rotationPositionY),t}}class Spread extends NobsBase{constructor(e,t,o,i){if(super(e,t),this.frameDimensionCache=new Map,this.groupDimensionCache=new Map,this.snapLinesX=new Map,this.snapLinesY=new Map,this.snapLinesXByPos=[],this.snapLinesYByPos=[],e instanceof Doc){if(this.id="string"==typeof t?t:generateDBID(),this.pages=[],this.boxes=new Map,this.name="",this.boxOrderHasChanged=!1,this.groupSnippets=[],this.layoutSnippets=[],o){for(const e of o.ps)this.pages.push(new BoxGeometry(e));o.boxes&&alert("Invalid incoming data. Boxes collection has values but should not have."),o.na&&(this.name=o.na),o.lsl&&(this.layoutSnippets=o.lsl.map((e=>new SnippetCluster(e.id,e)))),o.gsl&&(this.groupSnippets=o.gsl.map((e=>new SnippetCluster(e.id,e))))}if(i||0!==this.pages.length||(i=1),i&&i>0)for(let t=0;t<i;t++){const t=e.pageWidth*this.pages.length;this.pages.push(new BoxGeometry(t,0,e.pageWidth,e.pageHeight,0))}}const r=new Set,s=new Set;for(const e of this.groupSnippets)for(const t of e.tags)r.add(t);for(const e of this.layoutSnippets)for(const t of e.tags)s.add(t);this.groupTags=Array.from(r),this.layoutTags=Array.from(s)}static setBoxOffsetInCache(e,t,o){const i=scope().getBoxParent(e);if(i){const r=i.spread.frameDimensionCache.get(e.id);r&&(r[t]=o)}}initSpreadSnapLines(e){const t=this.width(),o=this.height();this.snapLinesX.clear(),this.snapLinesY.clear(),this.snapLinesXByPos=[],this.snapLinesYByPos=[];const i={left:0,top:0,width:t,height:o};if(SnapLine.add(this,"Doc","x",0,"start",i),SnapLine.add(this,"Doc","x",t/2,"center",i),SnapLine.add(this,"Doc","x",t,"end",i),SnapLine.add(this,"Doc","y",0,"start",i),SnapLine.add(this,"Doc","y",o/2,"center",i),SnapLine.add(this,"Doc","y",o,"end",i),e.showBleed){const i={left:-this.bleedLeft,width:t+this.bleedLeft+this.bleedRight,top:-e.bleedTop,height:o+e.bleedBottom+e.bleedBottom};SnapLine.add(this,"Bleed","x",i.left,"start",i),SnapLine.add(this,"Bleed","x",i.left+i.width,"end",i),SnapLine.add(this,"Bleed","y",i.top,"start",i),SnapLine.add(this,"Bleed","y",i.top+i.height,"end",i)}if(e.showBleed&&e.showSaveZone){const i={left:this.bleedLeft,width:t-this.bleedLeft-this.bleedRight,top:e.bleedTop,height:o-e.bleedBottom-e.bleedBottom};SnapLine.add(this,"Save","x",i.left,"start",i),SnapLine.add(this,"Save","x",i.left+i.width,"end",i),SnapLine.add(this,"Save","y",i.top,"start",i),SnapLine.add(this,"Save","y",i.top+i.height,"end",i)}if(e.showMargins){const e=this.marginPosition(0);if(SnapLine.add(this,"MarginP0","x",e.left,"start",e),SnapLine.add(this,"MarginP0","x",e.left+e.width,"end",e),SnapLine.add(this,"MarginP0","y",e.top,"start",e),SnapLine.add(this,"MarginP0","y",e.top+e.height,"end",e),2===this.pages.length){const e=this.marginPosition(1);e.left+=t/2,SnapLine.add(this,"MarginP1","x",e.left,"start",e),SnapLine.add(this,"MarginP1","x",e.left+e.width,"end",e),SnapLine.add(this,"MarginP1","y",e.top,"start",e),SnapLine.add(this,"MarginP1","y",e.top+e.height,"end",e)}}}serialize(e,t=!1,o=!1,i=!1,r=!1,s){const n={id:this.id,na:this.name,ps:this.pages.map((e=>e.serialize())),gsl:this.groupSnippets.map((e=>e.serializeSimple())),lsl:this.layoutSnippets.map((e=>e.serializeSimple()))};return t&&(n.boxes=Array.from(this.boxes.values()).map((t=>t.serialize(this.id,e,o,i,void 0,r,s)))),n}highestOrder(){if(this.boxes.size>0){const e=Array.from(this.boxes.values()).sort(((e,t)=>e.order-t.order));return e[e.length-1].order}return 0}lowestOrder(){if(this.boxes.size>0){return Array.from(this.boxes.values()).sort(((e,t)=>e.order-t.order))[0].order}return.5}boxesByLayer(e,t){return"top-down"===t?Array.from(this.boxes.values()).filter((t=>e===t.layerId)).sort(((e,t)=>t.order-e.order)):Array.from(this.boxes.values()).filter((t=>e===t.layerId)).sort(((e,t)=>e.order-t.order))}reOrderBox(e,t){let o=0,i=1,r=null,s=null;const n=this.boxesByLayer(e,"top-down");if("start"===t)i=1,o=n.length?n[0].order:.01,r=n.length?n[0]:null;else{const e=Spread.itemIndex(n,t);e>=0&&(i=n[e].order,s=n[e]),e<n.length-1&&(o=n[e+1].order,r=n[e+1])}scope().selection.setNewOrder(o,r,i,s,e)}static itemIndex(e,t){for(let o=0;o<e.length;o++)if(e[o].id===t)return o;return-1}firstPageLeftOffsetPx(){const e=scope().getSpread(this.id);return e&&e.doc.facingPages&&this.id===e.doc.firstSpread().id&&e.doc.spreads.size>1?e.doc.pageWidth:0}lastPageWidthOffsetPx(){const e=scope().getSpread(this.id);return e&&e.doc.facingPages&&this.id===e.doc.lastSpread().id&&e.doc.spreads.size>1?e.doc.pageWidth:0}getBox(e){return this.boxes.get(e)}caption(){let e=0;const t=scope().getSpread(this.id);if(t)for(const o of t.doc.spreads.values()){if(o===this)break;e+=o.pages.length}return 1===this.pages.length?(e+1).toString():e+1+"-"+(e+this.pages.length)}width(){let e=0;for(const t of this.pages)e+=t.width.value;return e}height(){let e=0;for(const t of this.pages)e=Math.max(t.height.value,e);return e}left(){const e=scope().getSpread(this.id);return e?e.doc.pasteBoardLeft+this.pages[0].left.value+this.firstPageLeftOffsetPx():0}top(){let e=0;const t=scope().getSpread(this.id);if(t)for(const o of t.doc.spreads.values()){if(e+=t.doc.pasteBoardTop,o.id===this.id)break;e+=o.height()+t.doc.pasteBoardBottom+t.doc.verticalSpaceBetweenPasteboards}return e}pasteboardPosition(){const e=new Rect(0,0,0,0),t=scope().getSpread(this.id);if(t){for(const o of t.doc.spreads.values()){if(o===this)break;e.top+=o.height()+t.doc.pasteBoardTop+t.doc.pasteBoardBottom+t.doc.verticalSpaceBetweenPasteboards}e.width=this.width()+this.firstPageLeftOffsetPx()+this.lastPageWidthOffsetPx()+t.doc.pasteBoardLeft+t.doc.pasteBoardRight,e.height=this.height()+t.doc.pasteBoardTop+t.doc.pasteBoardBottom}return e}isInView(){const e=getCurrentScrollPosition(),t=scope().getSpread(this.id);if(t&&t.doc===scope().currentDoc){const o=this.pasteboardPosition(),i=o.top+t.doc.pasteBoardTop,r=o.top+o.height-t.doc.pasteBoardTop-t.doc.pasteBoardBottom,s=e.modelY,n=e.modelY+appHeight()/zoomFactor();if(i>=s&&r<=n)return"full";if(i<=s&&r>=s)return"top";if(i<=n&&r>=s)return"bottom"}return"none"}spreadPosition(){const e=new Rect(0,0,0,0),t=scope().getSpread(this.id);return t&&(e.left=t.doc.pasteBoardLeft+this.firstPageLeftOffsetPx(),e.top=t.doc.pasteBoardTop,e.width=this.width(),e.height=this.height()),e}marginPosition(e){const t=scope().currentDoc;let o=t.marginInside,i=t.marginOutside;return t.facingPages&&(1===this.pages.length?t.getSpreadIndex(this.id)===t.spreads.size-1&&(o=t.marginOutside,i=t.marginInside):0===e&&(o=t.marginOutside,i=t.marginInside)),{left:o,top:t.marginTop,width:t.pageWidth-o-i,height:t.pageHeight-t.marginBottom-t.marginTop}}bleedPosition(){const e=new Rect(0,0,0,0),t=scope().currentDoc,o=scope().getSpread(this.id);return o&&(e.left=o.doc.pasteBoardLeft+this.firstPageLeftOffsetPx()-this.bleedLeft,e.top=o.doc.pasteBoardTop-t.bleedTop,e.width=this.width()+this.bleedLeft+this.bleedRight,e.height=this.height()+t.bleedBottom+t.bleedTop),e}saveZonePosition(){const e=new Rect(0,0,0,0),t=scope().currentDoc,o=scope().getSpread(this.id);return o&&(e.left=o.doc.pasteBoardLeft+this.firstPageLeftOffsetPx()+this.bleedLeft,e.top=o.doc.pasteBoardTop+t.bleedTop,e.width=this.width()-this.bleedLeft-this.bleedRight,e.height=this.height()-t.bleedBottom-t.bleedTop),e}get bleedLeft(){const e=scope().currentDoc;return 0!==e.getSpreadIndex(this.id)&&e.facingPages?e.bleedOutside:e.bleedInside}get bleedRight(){const e=scope().currentDoc;return e.getSpreadIndex(this.id)===e.spreads.size-1&&e.facingPages?e.bleedInside:e.bleedOutside}spreadThumbnailPosition(e=1){const t=new Rect(0,0,0,0);return scope().getSpread(this.id)&&(isMobile()?(t.left=0,t.top=0,t.width=this.width()*e,t.height=this.height()*e):(t.left=this.firstPageLeftOffsetPx()*e,t.top=0,t.width=this.width()*e,t.height=this.height()*e)),t}spreadPositionCss(e=1){const t=this.spreadPosition();return`left: ${t.left*e}px; top: ${t.top*e}px; width: ${t.width*e}px; height: ${t.height*e}px;`}bleedPositionCss(e=1){const t=this.bleedPosition();return`left: ${t.left*e}px; top: ${t.top*e}px; width: ${t.width*e}px; height: ${t.height*e}px;`}saveZonePositionCss(e=1){const t=this.saveZonePosition();return`left: ${t.left*e}px; top: ${t.top*e}px; width: ${t.width*e}px; height: ${t.height*e}px;`}marginPositionCss(e,t=1){const o=this.marginPosition(e);return`left: ${o.left*t}px; top: ${o.top*t}px; width: ${o.width*t}px; height: ${o.height*t}px;`}spreadThumbnailPositionCss(e=1){const t=this.spreadThumbnailPosition(1);return`padding-left: ${t.left*e}px; top: ${t.top*e}px; width: ${(t.left+t.width)*e}px; height: ${t.height*e}px;`}pasteboardPositionCss(){const e=this.pasteboardPosition();return`left: ${e.left}px; top: ${e.top}px; width: ${e.width}px; height: ${e.height}px;`}getSelectableBoxes(){const e=[];for(const t of this.boxes.values())(!config.isBuyer&&!config.isMobile||t.lock.hasFrameAllows(t))&&e.push(t);return e}toHitTestFrames(e=!1){const t=[],o=new Set,i=scope().currentDoc;for(const r of i.layers.values())if(r.isCurrentlyVisible()){const i=Array.from(this.boxes.values()).filter((e=>e.layerId===r.id)).sort(((e,t)=>t.order-e.order));for(const s of i)if((!1===s.basics.lockBox||e&&s.lock.isUiElement)&&!0===s.basics.visible){const i=config.isBuyer||config.isMobile,n=s.lock.hasFrameAllows(s,e);let a=!1;if(a=i?n:e?r.lock||s.basics.lockBox:!s.basics.lockBox,a&&r.isCurrentlyVisible()&&(!1===r.lock||s.lock.isClickableUi)){const i=s.boxGroupId?this.groupDimensionCache.get(s.boxGroupId):null;if(i&&!e)o.has(s.boxGroupId)||(o.add(s.boxGroupId),t.push({left:i.left,top:i.top,width:i.width,height:i.height,zindex:i.order,id:"",groupId:i.groupId,rotation:0,rotationPositionX:0,rotationPositionY:0,children:[],parent:null,layer:"",groupMemberBoxIds:i.boxIds}));else{const e=this.frameDimensionCache.get(s.id);e&&t.push({left:e.left+e.offsetLeft,top:e.top+e.offsetTop,width:e.width-e.offsetLeft-e.offsetRight,height:e.height-e.offsetTop-e.offsetBottom,zindex:e.order,id:e.id,groupId:e.groupId,rotation:e.rotation,rotationPositionX:e.rotationPositionX,rotationPositionY:e.rotationPositionY,children:[],parent:null,layer:""})}}}}return t}fillHitTestChache(e){this.frameDimensionCache.clear(),this.groupDimensionCache.clear(),this.initSpreadSnapLines(e);for(const e of this.boxes.values()){const t=e.getOffsets(),o=e.boxGeometry.toFrame(this.width(),this.height(),e.id);o.rotation||SnapLine.addBox(this,e.id,o);const i={left:o.left,top:o.top,width:o.width,height:o.height,offsetLeft:t.left,offsetTop:t.top,offsetBottom:t.bottom,offsetRight:t.right,rotation:o.rotation,rotationPositionX:o.rotationPositionX,rotationPositionY:o.rotationPositionY,order:e.order,groupId:e.boxGroupId,id:e.id};if(i.width<1&&(i.width=1),i.height<1&&(i.height=1),e.boxGroupId){let r=getBoundingBox({left:o.left+t.left,top:o.top+t.top,width:i.width-t.left-t.right,height:i.height-t.top-t.bottom,rotation:o.rotation,rotationPositionX:o.rotationPositionX,rotationPositionY:o.rotationPositionY,zindex:i.order,groupId:e.boxGroupId,id:e.id,parent:null,layer:"",children:[]}),s=[e.id],n=e.order;const a=this.groupDimensionCache.get(e.boxGroupId);if(a){s=[...a.boxIds,e.id],n=Math.max(a.order,e.order);const t=new Rect(a.left,a.top,a.width,a.height);r=r.getCombinedBox(t),s.push(e.id)}const l={left:r.left,top:r.top,width:r.width,height:r.height,boxIds:s,groupId:e.boxGroupId,order:n};this.groupDimensionCache.set(e.boxGroupId,l)}else this.frameDimensionCache.set(e.id,i)}this.snapLinesXByPos=Array.from(this.snapLinesX.values()).sort(((e,t)=>e.position-t.position)),this.snapLinesYByPos=Array.from(this.snapLinesY.values()).sort(((e,t)=>e.position-t.position))}getSnapLinesByPosition(e,t,o){const i=("x"===e?this.snapLinesXByPos:this.snapLinesYByPos).filter((e=>!e.boxId||!scope().selection.has(e.boxId)));let r=0;r="x"===e?"start"===t?o.left:"center"===t?o.left+o.width/2:o.left+o.width:"start"===t?o.top:"center"===t?o.top+o.height/2:o.top+o.height;let s=this.findSnapLineIndexByPosition(i,r);const n=[];if(s>=0&&s<i.length){s<i.length-1&&Math.abs(r-i[s+1].position)<Math.abs(r-i[s].position)&&(s+=1);const e=SnapLine.threshold,o=Math.abs(r-i[s].position);if(o<e){n.push(i[s]);const e=i[s].position;for(let t=s-1;t>=0&&e===i[t].position;t--)n.push(i[t]);for(let t=s+1;t<i.length&&e===i[t].position;t++)n.push(i[t]);return{dif:o,snaps:n,where:t}}}return null}findSnapLineIndexByPosition(e,t){let o=0,i=e.length-1;for(;o<=i;){const r=Math.floor((o+i)/2);if(e[r].position===t)return r;t>e[r].position&&(o=r+1),t<e[r].position&&(i=r-1)}return Math.min(Math.max(0,Math.floor((o+i)/2)),e.length-1)}getBoxesByGroupId(e,t,o){const i=[];for(const r of this.boxes.values())if(r.boxGroupId===e&&r.id!==t)if(void 0!==o&&o>0){r.boxGeometry.toPixel(this.width(),this.height()).top>o&&i.push(r)}else i.push(r);return i}boxesAsIStoreObjects(){const e=[],t=scope().getSpread(this.id);if(!t)throw"Can't serialize spread boxes, can't find spreadRef. spreadId="+this.id;for(const o of this.boxes.values())e.push(o.serialize(t.spread.id,t.doc.id));return e}}class Colors extends NobsBase{constructor(e,t){if(super(e,t),this.id=generateDBID(),!e||!t){const e=new Map;this.fallbackColor=new Color(255,255,255,0,0,0,0,100,0,0,"[None]","none","process","readonly",!1,"[None]",0),e.set("[None]",this.fallbackColor),e.set("[Registration]",new Color(0,0,0,100,100,100,100,0,1,0,"[Registration]","cmyk","process","readonly",!1,"[Registration]",0)),e.set("[Paper]",new Color(255,255,255,0,0,0,0,100,0,0,"[Paper]","cmyk","process","readonlyName",!1,"[Paper]",0)),e.set("[Black]",new Color(0,0,0,0,0,0,100,12,1,0,"[Black]","cmyk","process","readonly",!1,"[Black]",0)),this.namedColors=e}const o=new Map;for(const e of this.namedColors.values())if(e.name){let t=o.get(e.name);t||o.set(e.name,t=[]),t.push(e)}this.colorsByNameCache=o;const i=Array.from(this.namedColors.values()),r=i.filter((e=>!e.group)),s=i.filter((e=>!!e.group)),n=new Map;for(const e of s.sort(((e,t)=>e.order-t.order)))e.group&&(n.has(e.group)||n.set(e.group,{name:e.group,order:e.order,color:e.toCssColor(100,100)}));this.groups=n;const a=r.sort(((e,t)=>e.order-t.order));for(const e of n.values())for(const t of s.filter((t=>t.group===e.name)).sort(((e,t)=>e.order-t.order)))a.push(t);this.namedColorsSorted=a}static getDefaultColors(){const e=[];let t=1e-4;for(const o of config.rgbColors){t+=1e-5;const i=Color.parseRgbColor(o.value,o.name,"Buyer Colors",t);i&&e.push(i)}return e}getSwatches(){return Array.from(this.namedColorsSorted.values())}getSwatchByName(e){if(e){const t=this.colorsByNameCache.get(e);if(t&&t.length){const e=[];for(const o of t)o.group===scope().colorScheme&&e.push(o);if(1===e.length)return e[0];if(e.length>1)return e[0];for(const e of t)if(""===e.group)return e;return t[0]}}}getSwatchById(e){for(const[t,o]of this.namedColors)if(t===e)return o}getMaxOrder(){return Array.from(this.namedColors.values()).reduce(((e,t)=>t.order>e?t.order:e),0)}hasNamedColor(e){return!!e&&!!this.getSwatchByName(e)}getNewSwatchName(e){return getNewName(e,"New Color",(e=>scope().colors.namedColors.has(e)))}getCollection(){return this.namedColors}getFallbackColor(){return this.fallbackColor}getOrReplaceAllBoxesWithSwatch(e,t){var o;const i=new Map;let r;for(const s of scope().docs.values())for(const n of s.spreads.values())for(const a of n.boxes.values()){r=[];for(const o of Object.keys(a)){const i=a[o];if(i instanceof NobsBase)for(const o of Object.keys(i)){const s=i[o];s&&s instanceof ColorRef&&(t?s.replaceColorName(e,t)&&r.push(s):s.hasColorName(e)&&r.push(s))}}const l={box:a,spread:n,doc:s};(r.length>0||a.storyRef&&(null===(o=a.storyRef.story)||void 0===o?void 0:o.hasColorName(e)))&&i.set(l,r)}return i}notifySwatchChange(e){var t;const o=new Set,i=this.getOrReplaceAllBoxesWithSwatch(e);for(const e of i.keys()){const i=scope().docUi.getWcBox(e.box.id);if(i){if(e.box.storyRef){const i=e.box.storyRef.story;i&&!o.has(i)&&(null===(t=e.box.storyRef.story)||void 0===t||t.resetStoryCache(),o.add(i))}i.requestUpdate()}}}}class ColorRef extends NobsBase{constructor(e,t=100,o=100,i={m:"inactive",h:0,l:0,s:0}){if(super(e,t),e instanceof Color){const r=e;t>=0&&(this.tint=t),this.opacity=o,this.modifier=i,scope().colors.getSwatchById(r.id)?(this.colorId=r.id,this.colorName=r.name):this.colorObject=r}else if("string"==typeof e&&"number"==typeof t){this.tint=t,this.opacity=o,this.modifier=i;const r=scope().colors.getSwatchByName(e);this.colorName=r?e:"[Black]"}else if("string"==typeof e&&"object"==typeof t){const o=e,i=t;this.tint=100,this.colorId=o,i.tint>=0&&(this.tint=i.tint),void 0!==i.op&&(this.opacity=i.op),void 0!==i.mo&&(this.modifier=i.mo);const r=scope().colors.getSwatchById(o);if(r)this.colorName=r.name;else if(i.color.na){const e=scope().colors.getSwatchByName(i.color.na);e?(this.colorName=i.color.na,this.colorId=e.id):(create([new Color(this.colorId,i.color).serialize()]),this.colorName=i.color.na)}else this.colorObject=new Color(this.colorId,i.color)}this.colorId||(this.colorId=""),void 0===this.tint&&(this.tint=100),void 0===this.opacity&&(this.opacity=100),void 0===this.modifier&&(this.modifier={m:"inactive",h:0,l:0,s:0}),this.colorName||(this.colorName=""),this.colorObject||(this.colorObject=null)}get uiColorName(){const e=this.color.name;return e!==this.colorName?"not found: ("+this.colorName+")":e}replaceColorName(e,t){return this.colorName===e&&(this.colorName=t,!0)}hasColorName(e){return this.colorName===e}get color(){if(this.colorObject)return this.colorObject;if(this.colorName){const e=scope().colors.getSwatchByName(this.colorName);if(e)return e}if(this.colorId){const e=scope().colors.getSwatchById(this.colorId);if(e){const t=scope().colors.getSwatchByName(e.name);return t||e}}return scope().colors.getFallbackColor()}toCssColor(){return this.color.toCssColor(this.tint,this.opacity,this.modifier)}toInverseCssColor(e=!1,t=0){return this.color.toInverseCssColor(e,t)}toSelectedCssColor(){return this.color.toSelectedCssColor()}toRgbHexColor(){return this.color.toRgbHexColor()}toPrintColor(){return this.color.toPrintColor(this.tint,this.opacity,this.modifier)}serialize(){const e=this.color;return{id:e.id,tint:this.tint,color:e.serialize(!1).data,mo:this.modifier,op:this.opacity}}hash(){return[JSON.stringify(this.color.serialize(!1).data),this.tint.toString(),this.opacity.toString(),JSON.stringify(this.modifier)].join("|")}equals(e){return!(this.hash()!==e.hash())}static None_Color(){return new ColorRef("[None]")}static Black_Color(){return new ColorRef("[Black]")}static Gray_Color(){return new ColorRef(new Color(160,160,160,40,32,33,1,66,0,0,"gray 40%","rgb","process","write",!0,void 0,.001))}static Paper_Color(){return new ColorRef("[Paper]")}static Some_Color(){return new ColorRef(new Color)}static ShapeColor(){return new ColorRef(new Color(60,60,60))}static Null_Color(){return new Color(100,100,100,0,0,0,40,44,-15,-50,"[null]","rgb","process","readonly",!1,void 0,0)}}class Color extends NobsBase{constructor(e=203,t=211,o=54,i=25,r=4,s=97,n=0,a=82,l=-17,c=71,d="",h="rgb",p="process",u="write",m=!0,f,g,y){if(super(e,t),"string"==typeof e&&"object"==typeof t){this.id=e;const o=t;this.name=o.na,this.mode=o.mo,this.group=o.gr||"",this.type=o.ty,this.access=o.ac,this.autoName=o.an,this.name?void 0===o.or?scope().resourcesColorsUi?this.order=getOrder(scope().colors.getMaxOrder(),1):this.order=Math.random():this.order=o.or:this.order=0,this.r=o.r,this.g=o.g,this.b=o.b,this.c=o.c,this.m=o.m,this.y=o.y,this.k=o.k,this.L=o.L,this.A=o.A,this.B=o.B}else if("number"==typeof e&&"number"==typeof t)this.id=f||generateDBID(),this.name=d,this.mode=h,this.type=p,this.group=y||"",this.access=u,this.autoName=m,this.name?void 0!==g?this.order=g:scope().resourcesColorsUi?this.order=getOrder(scope().colors.getMaxOrder(),1):this.order=Math.random():this.order=0,this.r=e,this.g=t,this.b=o,this.c=i,this.m=r,this.y=s,this.k=n,this.L=a,this.A=l,this.B=c;else if(!(e instanceof Nobs&&t instanceof Color))throw new Error("Color Constructor: Type Error")}serialize(e=!1,t=0,o=!1,i){const r={na:o?"":this.name,mo:this.mode,ac:i||this.access,an:this.autoName,ty:this.type,or:t||this.order,gr:this.group,r:this.r,g:this.g,b:this.b,c:this.c,m:this.m,y:this.y,k:this.k,L:this.L,A:this.A,B:this.B};return{type:"color",id:e?generateDBID():this.id,scopeId:scope().id,parentId:scope().id,data:r}}static parseRgbColor(e,t,o,i=5e-4){let r=0,s=0,n=0;if("transparent"===e||!e)return new ColorRef("[None]").color;{const t=e.match(/^#([0-9a-f]{6})$/i);if(t&&t.length>0)r=parseInt(t[1].substr(0,2),16),s=parseInt(t[1].substr(2,2),16),n=parseInt(t[1].substr(4,2),16);else if(e&&(e.startsWith("rgba(")||e.startsWith("rgb("))&&e.indexOf(")")>0){const t=e.replace("rgba(","").replace("rgb(","").replace(")","").split(",");if(!(t.length>=3))return null;r=parseInt(t[0])||0,s=parseInt(t[1])||0,n=parseInt(t[2])||0}}if(t&&o){const e=Color.rgbToCmykSync(r,s,n),a=Color.rgbToLabSync(r,s,n);return new Color(r,s,n,e.c,e.m,e.y,e.k,a.L,a.A,a.B,t,"rgb","process","write",!1,generateDBID(),i,o)}return new Color(r,s,n,0,0,0,0,0,0,0,"","rgb","process","write",!0)}isSwatch(){return!!this.name}isEditableSwatch(){return this.isSwatch()&&"write"===this.access||"readonlyName"===this.access}canEdit(){return this.isEditableSwatch()}canRemove(){return"write"===this.access}canMove(){return"write"===this.access}toString(){return this.name?this.name:this.toPrintColor(100,100)}toAutoName(e){let t="";return t="spot"===this.type?"SPOT "+this.name:"rgb"===this.mode?"R="+this.r+" G="+this.g+" B="+this.b:"cmyk"===this.mode?"C="+this.c+" M="+this.m+" Y="+this.y+" K="+this.k:"LAB"===this.mode?"L="+this.L+" A="+this.A+" B="+this.B:this.name?this.name:this.toPrintColor(100,100,{m:"inactive",s:0,l:0,h:0}),t!==e?scope().colors.getNewSwatchName(t):t}toInverseCssColor(e=!1,t=0){if(e)return.299*this.r+.587*this.g+.114*this.b>186?`rgba(0,0,0,${t})`:`rgba(255,255,255,${t})`;return`rgba(${(255-this.r).toString(16)},${(255-this.g).toString(16)},${(255-this.b).toString(16)},${t})`}toSelectedCssColor(){return`rgb(${this.r>125?this.r-40:this.r+40},${this.g>125?this.g-40:this.g+40},${this.b>125?this.b-60:this.b+40})`}toSimpleRgbColor(){return"[None]"===this.name?"transparent":`rgb(${this.r},${this.g},${this.b})`}toRgbHexColor(){return"#"+[this.r,this.g,this.b].map((e=>{const t=e.toString(16);return 1===t.length?"0"+t:t})).join("")}toCssColor(e,t,o){let i=this.r,r=this.g,s=this.b,n=1;if("[None]"===this.name)return"transparent";if(this.canHaveTint()&&e<100&&e>=0){const t=1-e/100;i+=(255-i)*t,r+=(255-r)*t,s+=(255-s)*t}if(this.canHaveOpacity()&&t<100&&t>=0&&(n=t/100),o&&this.canHaveLightnessOrSaturation&&("hlsAbsolute"===o.m||"hlsRelative"===o.m)){const e=Color.rgbToHls(i,r,s);if("hlsAbsolute"===o.m){0!==o.h&&(e.h=(e.h+o.h)%360);const t=Math.abs(o.l)/200;o.l<0?e.l=Math.max(0,.5-t):e.l=Math.min(1,.5+t);const i=Math.abs(o.s)/200;o.s<0?e.s=Math.max(0,.5-i):e.s=Math.min(1,.5+i)}else{if(0!==o.h&&(e.h=(e.h+o.h)%360),0!==o.l){const t=o.l/100;e.l+=t<0?e.l*t:(1-e.l)*t}if(0!==o.s){const t=o.s/100;e.s+=t<0?e.s*t:(1-e.s)*t}}const t=Color.hlsToRgb(e.h,e.l,e.s);i=t.r,r=t.g,s=t.b}return n>=0&&n<1?"rgba("+i+","+r+","+s+","+n+")":"rgb("+i+","+r+","+s+")"}canHaveTint(){return"[null]"!==this.name&&"spot"===this.type}canHaveOpacity(){return"[null]"!==this.name&&"spot"!==this.type}canHaveLightnessOrSaturation(){return"[null]"!==this.name&&("spot"!==this.type&&"rgb"===this.mode)}equals(e){return this.mode===e.mode&&(!(e.name&&!this.name||this.name&&!e.name||this.name!==e.name)&&(e.r===this.r&&e.g===this.g&&e.b===this.b&&e.c===this.c&&e.m===this.m&&e.y===this.y&&e.k===this.k&&e.type===this.type))}toPrintColor(e,t,o){return this.toCssColor(e,t,o)}static hlsToRgb(e,t,o){const i=(e,t,o)=>(o<0&&(o+=6),o>=6&&(o-=6),o<1?(t-e)*o+e:o<3?t:o<4?(t-e)*(4-o)+e:e);let r;r=t<=.5?t*(o+1):t+o-t*o;const s=2*t-r;return{r:255*i(s,r,(e/=60)+2),g:255*i(s,r,e),b:255*i(s,r,e-2)}}static rgbToHls(e,t,o){let i,r,s,n,a,l;const c=[e/255,t/255,o/255];for(i=c[0],r=c[0],a=0,s=0;s<c.length-1;s++)c[s+1]<=i&&(i=c[s+1]),c[s+1]>=r&&(r=c[s+1],a=s+1);0==a&&(l=(c[1]-c[2])/(r-i)),1==a&&(l=2+(c[2]-c[0])/(r-i)),2==a&&(l=4+(c[0]-c[1])/(r-i)),(void 0===l||isNaN(l))&&(l=0),l*=60,l<0&&(l+=360);const d=(i+r)/2;return n=i==r?0:d<.5?(r-i)/(r+i):(r-i)/(2-r-i),{h:l,s:n,l:d}}static cmykToRgb(e,t,o,i,r){i>100?i=100:(e>100&&(e=100),t>100&&(t=100),o>100&&(o=100)),e<0&&(e=0),t<0&&(t=0),o<0&&(o=0),i<0&&(i=0);const s=1-i/100;r({r:Math.ceil(255*(1-e/100)*s),g:Math.ceil(255*(1-t/100)*s),b:Math.ceil(255*(1-o/100)*s)})}static rgbToCmyk(e,t,o,i){i(Color.rgbToCmykSync(e,t,o))}static rgbToCmykSync(e,t,o){e>255&&(e=255),t>255&&(t=255),o>255&&(o=255),e<0&&(e=0),t<0&&(t=0),o<0&&(o=0);let i=255,r=255,s=255;i=e/255,r=t/255,s=o/255;const n=1-Math.max(i,r,s);let a=1-n;0===a&&(a=1);const l=(1-i-n)/a,c=(1-r-n)/a,d=(1-s-n)/a;return{c:Math.round(100*l),m:Math.round(100*c),y:Math.round(100*d),k:Math.round(100*n)}}static labToRgb(e,t,o,i){let r,s,n,a=(e+16)/116,l=t/500+a,c=a-o/200;l=.95047*(l*l*l>.008856?l*l*l:(l-16/116)/7.787),a=1*(a*a*a>.008856?a*a*a:(a-16/116)/7.787),c=1.08883*(c*c*c>.008856?c*c*c:(c-16/116)/7.787),r=3.2406*l+-1.5372*a+-.4986*c,s=-.9689*l+1.8758*a+.0415*c,n=.0557*l+-.204*a+1.057*c,r=r>.0031308?1.055*Math.pow(r,1/2.4)-.055:12.92*r,s=s>.0031308?1.055*Math.pow(s,1/2.4)-.055:12.92*s,n=n>.0031308?1.055*Math.pow(n,1/2.4)-.055:12.92*n,i({r:Math.round(255*Math.max(0,Math.min(1,r))),g:Math.round(255*Math.max(0,Math.min(1,s))),b:Math.round(255*Math.max(0,Math.min(1,n)))})}static rgbToLab(e,t,o,i){i(this.rgbToLabSync(e,t,o))}static rgbToLabSync(e,t,o){t/=255,o/=255;let i=(.4124*(e=(e/=255)>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92)+.3576*(t=t>.04045?Math.pow((t+.055)/1.055,2.4):t/12.92)+.1805*(o=o>.04045?Math.pow((o+.055)/1.055,2.4):o/12.92))/.95047,r=(.2126*e+.7152*t+.0722*o)/1,s=(.0193*e+.1192*t+.9505*o)/1.08883;return i=i>.008856?Math.pow(i,1/3):7.787*i+16/116,r=r>.008856?Math.pow(r,1/3):7.787*r+16/116,s=s>.008856?Math.pow(s,1/3):7.787*s+16/116,{L:Math.round(116*r)-16,A:Math.round(500*(i-r)),B:Math.round(200*(r-s))}}}const imageDimensionsCache=new Map;class Image$1 extends NobsBase{constructor(e,t,o="",i=0,r=0,s="uploaded",n,a,l){if(super(e,t),"string"==typeof e&&"string"==typeof t){const c=t;if("dataurl"===s)this.name=o?"["+o+"]":"Data Url";else if(o)this.name=o;else if(c&&!c.startsWith("data:")){const e=c.split("/");e.length>0&&(this.name=e[e.length-1])}this.id=e,this.url=c,this.type=s,this.width=i,this.height=r,this.scales=n||[],this.order=l||0,this.group=a||""}else if(!(e instanceof Nobs)){const o=t;this.id=e,this.type=o.t,this.url=o.u,this.width=o.w||i,this.height=o.h||r,this.name=o.na,this.order=o.or,this.group=o.g,o.sc?this.scales=o.sc.map((e=>({id:e.id,url:e.u,userState:e.us,height:e.h,width:e.w}))).sort(((e,t)=>t.width-e.width)):this.scales=[]}if(void 0===this.id&&(this.id=generateDBID()),this.name||(this.name="New Image"),this.group||(this.group=""),this.order||(this.type,"dataurl"===this.type||"fallback"===this.type||"external"===this.type?this.order=0:this.order=Math.random()),"external"===this.type)if(this.width&&this.height)imageDimensionsCache.set(this.url,{width:this.width,height:this.height});else{const e=imageDimensionsCache.get(this.url);e&&(this.width=e.width,this.height=e.height)}}getConfigurationBasedImage(){return this}getConfigurationBasedImageUrl(){return this.getConfigurationBasedImage().url}canEdit(){return!1}canRemove(){return!0}canMove(){return!0}src(){return this.toString()}thumbNailUrl(){let e=this.url;return this.scales.length&&(e=this.scales[this.scales.length-1].url),e}thumbNailCssUrl(){let e=this.url;return this.scales.length&&(e=this.scales[this.scales.length-1].url),e?"url('"+e+"')":"none"}cssUrl(){return this.toString()?"url('"+this.toString()+"')":"none"}css(){return this.toString()?`background-image: url('${this.toString()}'); background-size: cover; background-position: 50% 50%; background-repeat: no-repeat;`:""}thumbNailCss(){return this.toString()?`background-image: ${this.thumbNailCssUrl()}; background-size: cover; background-position: 50% 50%; background-repeat: no-repeat;`:""}toString(){return this.url}serializeSimple(e=!1,t=0){const o={t:this.type,u:this.url,w:this.width,h:this.height,or:t||this.order,g:this.group,na:this.name};return this.scales.length&&(o.sc=this.scales.map((t=>({id:e?generateDBID():t.id,u:t.url,w:t.width,h:t.height,us:t.userState})))),o}serialize(e=!1,t=0){return{type:"image",id:e?generateDBID():this.id,scopeId:scope().id,parentId:scope().id,data:this.serializeSimple(e,t)}}static anyImage(){return new Image$1("fallback","printess-editor/img/default.svg","Placeholder Image",2e3,1333,"fallback")}static maskImage(){return new Image$1("fallbackImageMask","printess-editor/img/sample-image-mask.png","Placeholder Image",300,300,"fallback")}}
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const isCEPolyfill=void 0!==window.customElements&&void 0!==window.customElements.polyfillWrapFlushCallback,reparentNodes=(e,t,o=null,i=null)=>{for(;t!==o;){const o=t.nextSibling;e.insertBefore(t,i),t=o}},removeNodes=(e,t,o=null)=>{for(;t!==o;){const o=t.nextSibling;e.removeChild(t),t=o}},marker=`{{lit-${String(Math.random()).slice(2)}}}`,nodeMarker=`\x3c!--${marker}--\x3e`,markerRegex=new RegExp(`${marker}|${nodeMarker}`),boundAttributeSuffix="$lit$";class Template$1{constructor(e,t){this.parts=[],this.element=t;const o=[],i=[],r=document.createTreeWalker(t.content,133,null,!1);let s=0,n=-1,a=0;const{strings:l,values:{length:c}}=e;for(;a<c;){const e=r.nextNode();if(null!==e){if(n++,1===e.nodeType){if(e.hasAttributes()){const t=e.attributes,{length:o}=t;let i=0;for(let e=0;e<o;e++)endsWith(t[e].name,"$lit$")&&i++;for(;i-- >0;){const t=l[a],o=lastAttributeNameRegex.exec(t)[2],i=o.toLowerCase()+"$lit$",r=e.getAttribute(i);e.removeAttribute(i);const s=r.split(markerRegex);this.parts.push({type:"attribute",index:n,name:o,strings:s}),a+=s.length-1}}"TEMPLATE"===e.tagName&&(i.push(e),r.currentNode=e.content)}else if(3===e.nodeType){const t=e.data;if(t.indexOf(marker)>=0){const i=e.parentNode,r=t.split(markerRegex),s=r.length-1;for(let t=0;t<s;t++){let o,s=r[t];if(""===s)o=createMarker();else{const e=lastAttributeNameRegex.exec(s);null!==e&&endsWith(e[2],"$lit$")&&(s=s.slice(0,e.index)+e[1]+e[2].slice(0,-"$lit$".length)+e[3]),o=document.createTextNode(s)}i.insertBefore(o,e),this.parts.push({type:"node",index:++n})}""===r[s]?(i.insertBefore(createMarker(),e),o.push(e)):e.data=r[s],a+=s}}else if(8===e.nodeType)if(e.data===marker){const t=e.parentNode;null!==e.previousSibling&&n!==s||(n++,t.insertBefore(createMarker(),e)),s=n,this.parts.push({type:"node",index:n}),null===e.nextSibling?e.data="":(o.push(e),n--),a++}else{let t=-1;for(;-1!==(t=e.data.indexOf(marker,t+1));)this.parts.push({type:"node",index:-1}),a++}}else r.currentNode=i.pop()}for(const e of o)e.parentNode.removeChild(e)}}const endsWith=(e,t)=>{const o=e.length-t.length;return o>=0&&e.slice(o)===t},isTemplatePartActive=e=>-1!==e.index,createMarker=()=>document.createComment(""),lastAttributeNameRegex=/([ \x09\x0a\x0c\x0d])([^\0-\x1F\x7F-\x9F "'>=/]+)([ \x09\x0a\x0c\x0d]*=[ \x09\x0a\x0c\x0d]*(?:[^ \x09\x0a\x0c\x0d"'`<>=]*|"[^"]*|'[^']*))$/,walkerNodeFilter=133;function removeNodesFromTemplate(e,t){const{element:{content:o},parts:i}=e,r=document.createTreeWalker(o,133,null,!1);let s=nextActiveIndexInTemplateParts(i),n=i[s],a=-1,l=0;const c=[];let d=null;for(;r.nextNode();){a++;const e=r.currentNode;for(e.previousSibling===d&&(d=null),t.has(e)&&(c.push(e),null===d&&(d=e)),null!==d&&l++;void 0!==n&&n.index===a;)n.index=null!==d?-1:n.index-l,s=nextActiveIndexInTemplateParts(i,s),n=i[s]}c.forEach((e=>e.parentNode.removeChild(e)))}const countNodes=e=>{let t=11===e.nodeType?0:1;const o=document.createTreeWalker(e,133,null,!1);for(;o.nextNode();)t++;return t},nextActiveIndexInTemplateParts=(e,t=-1)=>{for(let o=t+1;o<e.length;o++){const t=e[o];if(isTemplatePartActive(t))return o}return-1};function insertNodeIntoTemplate(e,t,o=null){const{element:{content:i},parts:r}=e;if(null==o)return void i.appendChild(t);const s=document.createTreeWalker(i,133,null,!1);let n=nextActiveIndexInTemplateParts(r),a=0,l=-1;for(;s.nextNode();){l++;for(s.currentNode===o&&(a=countNodes(t),o.parentNode.insertBefore(t,o));-1!==n&&r[n].index===l;){if(a>0){for(;-1!==n;)r[n].index+=a,n=nextActiveIndexInTemplateParts(r,n);return}n=nextActiveIndexInTemplateParts(r,n)}}}
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const directives=new WeakMap,directive=e=>(...t)=>{const o=e(...t);return directives.set(o,!0),o},isDirective=e=>"function"==typeof e&&directives.has(e),noChange={},nothing={};
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class TemplateInstance{constructor(e,t,o){this.__parts=[],this.template=e,this.processor=t,this.options=o}update(e){let t=0;for(const o of this.__parts)void 0!==o&&o.setValue(e[t]),t++;for(const e of this.__parts)void 0!==e&&e.commit()}_clone(){const e=isCEPolyfill?this.template.element.content.cloneNode(!0):document.importNode(this.template.element.content,!0),t=[],o=this.template.parts,i=document.createTreeWalker(e,133,null,!1);let r,s=0,n=0,a=i.nextNode();for(;s<o.length;)if(r=o[s],isTemplatePartActive(r)){for(;n<r.index;)n++,"TEMPLATE"===a.nodeName&&(t.push(a),i.currentNode=a.content),null===(a=i.nextNode())&&(i.currentNode=t.pop(),a=i.nextNode());if("node"===r.type){const e=this.processor.handleTextExpression(this.options);e.insertAfterNode(a.previousSibling),this.__parts.push(e)}else this.__parts.push(...this.processor.handleAttributeExpressions(a,r.name,r.strings,this.options));s++}else this.__parts.push(void 0),s++;return isCEPolyfill&&(document.adoptNode(e),customElements.upgrade(e)),e}}
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const commentMarker=` ${marker} `;class TemplateResult{constructor(e,t,o,i){this.strings=e,this.values=t,this.type=o,this.processor=i}getHTML(){const e=this.strings.length-1;let t="",o=!1;for(let i=0;i<e;i++){const e=this.strings[i],r=e.lastIndexOf("\x3c!--");o=(r>-1||o)&&-1===e.indexOf("--\x3e",r+1);const s=lastAttributeNameRegex.exec(e);t+=null===s?e+(o?commentMarker:nodeMarker):e.substr(0,s.index)+s[1]+s[2]+"$lit$"+s[3]+marker}return t+=this.strings[e],t}getTemplateElement(){const e=document.createElement("template");return e.innerHTML=this.getHTML(),e}}class SVGTemplateResult extends TemplateResult{getHTML(){return`<svg>${super.getHTML()}</svg>`}getTemplateElement(){const e=super.getTemplateElement(),t=e.content,o=t.firstChild;return t.removeChild(o),reparentNodes(t,o.firstChild),e}}
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const isPrimitive=e=>null===e||!("object"==typeof e||"function"==typeof e),isIterable=e=>Array.isArray(e)||!(!e||!e[Symbol.iterator]);class AttributeCommitter{constructor(e,t,o){this.dirty=!0,this.element=e,this.name=t,this.strings=o,this.parts=[];for(let e=0;e<o.length-1;e++)this.parts[e]=this._createPart()}_createPart(){return new AttributePart(this)}_getValue(){const e=this.strings,t=e.length-1;let o="";for(let i=0;i<t;i++){o+=e[i];const t=this.parts[i];if(void 0!==t){const e=t.value;if(isPrimitive(e)||!isIterable(e))o+="string"==typeof e?e:String(e);else for(const t of e)o+="string"==typeof t?t:String(t)}}return o+=e[t],o}commit(){this.dirty&&(this.dirty=!1,this.element.setAttribute(this.name,this._getValue()))}}class AttributePart{constructor(e){this.value=void 0,this.committer=e}setValue(e){e===noChange||isPrimitive(e)&&e===this.value||(this.value=e,isDirective(e)||(this.committer.dirty=!0))}commit(){for(;isDirective(this.value);){const e=this.value;this.value=noChange,e(this)}this.value!==noChange&&this.committer.commit()}}class NodePart{constructor(e){this.value=void 0,this.__pendingValue=void 0,this.options=e}appendInto(e){this.startNode=e.appendChild(createMarker()),this.endNode=e.appendChild(createMarker())}insertAfterNode(e){this.startNode=e,this.endNode=e.nextSibling}appendIntoPart(e){e.__insert(this.startNode=createMarker()),e.__insert(this.endNode=createMarker())}insertAfterPart(e){e.__insert(this.startNode=createMarker()),this.endNode=e.endNode,e.endNode=this.startNode}setValue(e){this.__pendingValue=e}commit(){for(;isDirective(this.__pendingValue);){const e=this.__pendingValue;this.__pendingValue=noChange,e(this)}const e=this.__pendingValue;e!==noChange&&(isPrimitive(e)?e!==this.value&&this.__commitText(e):e instanceof TemplateResult?this.__commitTemplateResult(e):e instanceof Node?this.__commitNode(e):isIterable(e)?this.__commitIterable(e):e===nothing?(this.value=nothing,this.clear()):this.__commitText(e))}__insert(e){this.endNode.parentNode.insertBefore(e,this.endNode)}__commitNode(e){this.value!==e&&(this.clear(),this.__insert(e),this.value=e)}__commitText(e){const t=this.startNode.nextSibling,o="string"==typeof(e=null==e?"":e)?e:String(e);t===this.endNode.previousSibling&&3===t.nodeType?t.data=o:this.__commitNode(document.createTextNode(o)),this.value=e}__commitTemplateResult(e){const t=this.options.templateFactory(e);if(this.value instanceof TemplateInstance&&this.value.template===t)this.value.update(e.values);else{const o=new TemplateInstance(t,e.processor,this.options),i=o._clone();o.update(e.values),this.__commitNode(i),this.value=o}}__commitIterable(e){Array.isArray(this.value)||(this.value=[],this.clear());const t=this.value;let o,i=0;for(const r of e)o=t[i],void 0===o&&(o=new NodePart(this.options),t.push(o),0===i?o.appendIntoPart(this):o.insertAfterPart(t[i-1])),o.setValue(r),o.commit(),i++;i<t.length&&(t.length=i,this.clear(o&&o.endNode))}clear(e=this.startNode){removeNodes(this.startNode.parentNode,e.nextSibling,this.endNode)}}class BooleanAttributePart{constructor(e,t,o){if(this.value=void 0,this.__pendingValue=void 0,2!==o.length||""!==o[0]||""!==o[1])throw new Error("Boolean attributes can only contain a single expression");this.element=e,this.name=t,this.strings=o}setValue(e){this.__pendingValue=e}commit(){for(;isDirective(this.__pendingValue);){const e=this.__pendingValue;this.__pendingValue=noChange,e(this)}if(this.__pendingValue===noChange)return;const e=!!this.__pendingValue;this.value!==e&&(e?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name),this.value=e),this.__pendingValue=noChange}}class PropertyCommitter extends AttributeCommitter{constructor(e,t,o){super(e,t,o),this.single=2===o.length&&""===o[0]&&""===o[1]}_createPart(){return new PropertyPart(this)}_getValue(){return this.single?this.parts[0].value:super._getValue()}commit(){this.dirty&&(this.dirty=!1,this.element[this.name]=this._getValue())}}class PropertyPart extends AttributePart{}let eventOptionsSupported=!1;try{const e={get capture(){return eventOptionsSupported=!0,!1}};window.addEventListener("test",e,e),window.removeEventListener("test",e,e)}catch(e){}class EventPart{constructor(e,t,o){this.value=void 0,this.__pendingValue=void 0,this.element=e,this.eventName=t,this.eventContext=o,this.__boundHandleEvent=e=>this.handleEvent(e)}setValue(e){this.__pendingValue=e}commit(){for(;isDirective(this.__pendingValue);){const e=this.__pendingValue;this.__pendingValue=noChange,e(this)}if(this.__pendingValue===noChange)return;const e=this.__pendingValue,t=this.value,o=null==e||null!=t&&(e.capture!==t.capture||e.once!==t.once||e.passive!==t.passive),i=null!=e&&(null==t||o);o&&this.element.removeEventListener(this.eventName,this.__boundHandleEvent,this.__options),i&&(this.__options=getOptions(e),this.element.addEventListener(this.eventName,this.__boundHandleEvent,this.__options)),this.value=e,this.__pendingValue=noChange}handleEvent(e){"function"==typeof this.value?this.value.call(this.eventContext||this.element,e):this.value.handleEvent(e)}}const getOptions=e=>e&&(eventOptionsSupported?{capture:e.capture,passive:e.passive,once:e.once}:e.capture)
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */;function templateFactory(e){let t=templateCaches.get(e.type);void 0===t&&(t={stringsArray:new WeakMap,keyString:new Map},templateCaches.set(e.type,t));let o=t.stringsArray.get(e.strings);if(void 0!==o)return o;const i=e.strings.join(marker);return o=t.keyString.get(i),void 0===o&&(o=new Template$1(e,e.getTemplateElement()),t.keyString.set(i,o)),t.stringsArray.set(e.strings,o),o}const templateCaches=new Map,parts=new WeakMap,render=(e,t,o)=>{let i=parts.get(t);void 0===i&&(removeNodes(t,t.firstChild),parts.set(t,i=new NodePart(Object.assign({templateFactory:templateFactory},o))),i.appendInto(t)),i.setValue(e),i.commit()};
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
class DefaultTemplateProcessor{handleAttributeExpressions(e,t,o,i){const r=t[0];if("."===r){return new PropertyCommitter(e,t.slice(1),o).parts}if("@"===r)return[new EventPart(e,t.slice(1),i.eventContext)];if("?"===r)return[new BooleanAttributePart(e,t.slice(1),o)];return new AttributeCommitter(e,t,o).parts}handleTextExpression(e){return new NodePart(e)}}const defaultTemplateProcessor=new DefaultTemplateProcessor;
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */(window.litHtmlVersions||(window.litHtmlVersions=[])).push("1.1.2");const html=(e,...t)=>new TemplateResult(e,t,"html",defaultTemplateProcessor),svg=(e,...t)=>new SVGTemplateResult(e,t,"svg",defaultTemplateProcessor)
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */,getTemplateCacheKey=(e,t)=>`${e}--${t}`;let compatibleShadyCSSVersion=!0;void 0===window.ShadyCSS?compatibleShadyCSSVersion=!1:void 0===window.ShadyCSS.prepareTemplateDom&&(console.warn("Incompatible ShadyCSS version detected. Please update to at least @webcomponents/webcomponentsjs@2.0.2 and @webcomponents/shadycss@1.3.1."),compatibleShadyCSSVersion=!1);const shadyTemplateFactory=e=>t=>{const o=getTemplateCacheKey(t.type,e);let i=templateCaches.get(o);void 0===i&&(i={stringsArray:new WeakMap,keyString:new Map},templateCaches.set(o,i));let r=i.stringsArray.get(t.strings);if(void 0!==r)return r;const s=t.strings.join(marker);if(r=i.keyString.get(s),void 0===r){const o=t.getTemplateElement();compatibleShadyCSSVersion&&window.ShadyCSS.prepareTemplateDom(o,e),r=new Template$1(t,o),i.keyString.set(s,r)}return i.stringsArray.set(t.strings,r),r},TEMPLATE_TYPES=["html","svg"],removeStylesFromLitTemplates=e=>{TEMPLATE_TYPES.forEach((t=>{const o=templateCaches.get(getTemplateCacheKey(t,e));void 0!==o&&o.keyString.forEach((e=>{const{element:{content:t}}=e,o=new Set;Array.from(t.querySelectorAll("style")).forEach((e=>{o.add(e)})),removeNodesFromTemplate(e,o)}))}))},shadyRenderSet=new Set,prepareTemplateStyles=(e,t,o)=>{shadyRenderSet.add(e);const i=o?o.element:document.createElement("template"),r=t.querySelectorAll("style"),{length:s}=r;if(0===s)return void window.ShadyCSS.prepareTemplateStyles(i,e);const n=document.createElement("style");for(let e=0;e<s;e++){const t=r[e];t.parentNode.removeChild(t),n.textContent+=t.textContent}removeStylesFromLitTemplates(e);const a=i.content;o?insertNodeIntoTemplate(o,n,a.firstChild):a.insertBefore(n,a.firstChild),window.ShadyCSS.prepareTemplateStyles(i,e);const l=a.querySelector("style");if(window.ShadyCSS.nativeShadow&&null!==l)t.insertBefore(l.cloneNode(!0),t.firstChild);else if(o){a.insertBefore(n,a.firstChild);const e=new Set;e.add(n),removeNodesFromTemplate(o,e)}},render$1=(e,t,o)=>{if(!o||"object"!=typeof o||!o.scopeName)throw new Error("The `scopeName` option is required.");const i=o.scopeName,r=parts.has(t),s=compatibleShadyCSSVersion&&11===t.nodeType&&!!t.host,n=s&&!shadyRenderSet.has(i),a=n?document.createDocumentFragment():t;if(render(e,a,Object.assign({templateFactory:shadyTemplateFactory(i)},o)),n){const e=parts.get(a);parts.delete(a);const o=e.value instanceof TemplateInstance?e.value.template:void 0;prepareTemplateStyles(i,a,o),removeNodes(t,t.firstChild),t.appendChild(a),parts.set(t,e)}!r&&s&&window.ShadyCSS.styleElement(t.host)};
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
var _a;window.JSCompiler_renameProperty=(e,t)=>e;const defaultConverter={toAttribute(e,t){switch(t){case Boolean:return e?"":null;case Object:case Array:return null==e?e:JSON.stringify(e)}return e},fromAttribute(e,t){switch(t){case Boolean:return null!==e;case Number:return null===e?null:Number(e);case Object:case Array:return JSON.parse(e)}return e}},notEqual=(e,t)=>t!==e&&(t==t||e==e),defaultPropertyDeclaration={attribute:!0,type:String,converter:defaultConverter,reflect:!1,hasChanged:notEqual},STATE_HAS_UPDATED=1,STATE_UPDATE_REQUESTED=4,STATE_IS_REFLECTING_TO_ATTRIBUTE=8,STATE_IS_REFLECTING_TO_PROPERTY=16,finalized="finalized";class UpdatingElement extends HTMLElement{constructor(){super(),this._updateState=0,this._instanceProperties=void 0,this._updatePromise=new Promise((e=>this._enableUpdatingResolver=e)),this._changedProperties=new Map,this._reflectingProperties=void 0,this.initialize()}static get observedAttributes(){this.finalize();const e=[];return this._classProperties.forEach(((t,o)=>{const i=this._attributeNameForProperty(o,t);void 0!==i&&(this._attributeToPropertyMap.set(i,o),e.push(i))})),e}static _ensureClassProperties(){if(!this.hasOwnProperty(JSCompiler_renameProperty("_classProperties",this))){this._classProperties=new Map;const e=Object.getPrototypeOf(this)._classProperties;void 0!==e&&e.forEach(((e,t)=>this._classProperties.set(t,e)))}}static createProperty(e,t=defaultPropertyDeclaration){if(this._ensureClassProperties(),this._classProperties.set(e,t),t.noAccessor||this.prototype.hasOwnProperty(e))return;const o="symbol"==typeof e?Symbol():`__${e}`,i=this.getPropertyDescriptor(e,o,t);void 0!==i&&Object.defineProperty(this.prototype,e,i)}static getPropertyDescriptor(e,t,o){return{get(){return this[t]},set(o){const i=this[e];this[t]=o,this._requestUpdate(e,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this._classProperties&&this._classProperties.get(e)||defaultPropertyDeclaration}static finalize(){const e=Object.getPrototypeOf(this);if(e.hasOwnProperty(finalized)||e.finalize(),this.finalized=!0,this._ensureClassProperties(),this._attributeToPropertyMap=new Map,this.hasOwnProperty(JSCompiler_renameProperty("properties",this))){const e=this.properties,t=[...Object.getOwnPropertyNames(e),..."function"==typeof Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(e):[]];for(const o of t)this.createProperty(o,e[o])}}static _attributeNameForProperty(e,t){const o=t.attribute;return!1===o?void 0:"string"==typeof o?o:"string"==typeof e?e.toLowerCase():void 0}static _valueHasChanged(e,t,o=notEqual){return o(e,t)}static _propertyValueFromAttribute(e,t){const o=t.type,i=t.converter||defaultConverter,r="function"==typeof i?i:i.fromAttribute;return r?r(e,o):e}static _propertyValueToAttribute(e,t){if(void 0===t.reflect)return;const o=t.type,i=t.converter;return(i&&i.toAttribute||defaultConverter.toAttribute)(e,o)}initialize(){this._saveInstanceProperties(),this._requestUpdate()}_saveInstanceProperties(){this.constructor._classProperties.forEach(((e,t)=>{if(this.hasOwnProperty(t)){const e=this[t];delete this[t],this._instanceProperties||(this._instanceProperties=new Map),this._instanceProperties.set(t,e)}}))}_applyInstanceProperties(){this._instanceProperties.forEach(((e,t)=>this[t]=e)),this._instanceProperties=void 0}connectedCallback(){this.enableUpdating()}enableUpdating(){void 0!==this._enableUpdatingResolver&&(this._enableUpdatingResolver(),this._enableUpdatingResolver=void 0)}disconnectedCallback(){}attributeChangedCallback(e,t,o){t!==o&&this._attributeToProperty(e,o)}_propertyToAttribute(e,t,o=defaultPropertyDeclaration){const i=this.constructor,r=i._attributeNameForProperty(e,o);if(void 0!==r){const e=i._propertyValueToAttribute(t,o);if(void 0===e)return;this._updateState=8|this._updateState,null==e?this.removeAttribute(r):this.setAttribute(r,e),this._updateState=-9&this._updateState}}_attributeToProperty(e,t){if(8&this._updateState)return;const o=this.constructor,i=o._attributeToPropertyMap.get(e);if(void 0!==i){const e=o.getPropertyOptions(i);this._updateState=16|this._updateState,this[i]=o._propertyValueFromAttribute(t,e),this._updateState=-17&this._updateState}}_requestUpdate(e,t){let o=!0;if(void 0!==e){const i=this.constructor,r=i.getPropertyOptions(e);i._valueHasChanged(this[e],t,r.hasChanged)?(this._changedProperties.has(e)||this._changedProperties.set(e,t),!0!==r.reflect||16&this._updateState||(void 0===this._reflectingProperties&&(this._reflectingProperties=new Map),this._reflectingProperties.set(e,r))):o=!1}!this._hasRequestedUpdate&&o&&(this._updatePromise=this._enqueueUpdate())}requestUpdate(e,t){return this._requestUpdate(e,t),this.updateComplete}async _enqueueUpdate(){this._updateState=4|this._updateState;try{await this._updatePromise}catch(e){}const e=this.performUpdate();return null!=e&&await e,!this._hasRequestedUpdate}get _hasRequestedUpdate(){return 4&this._updateState}get hasUpdated(){return 1&this._updateState}performUpdate(){this._instanceProperties&&this._applyInstanceProperties();let e=!1;const t=this._changedProperties;try{e=this.shouldUpdate(t),e?this.update(t):this._markUpdated()}catch(t){throw e=!1,this._markUpdated(),t}e&&(1&this._updateState||(this._updateState=1|this._updateState,this.firstUpdated(t)),this.updated(t))}_markUpdated(){this._changedProperties=new Map,this._updateState=-5&this._updateState}get updateComplete(){return this._getUpdateComplete()}_getUpdateComplete(){return this._updatePromise}shouldUpdate(e){return!0}update(e){void 0!==this._reflectingProperties&&this._reflectingProperties.size>0&&(this._reflectingProperties.forEach(((e,t)=>this._propertyToAttribute(t,this[t],e))),this._reflectingProperties=void 0),this._markUpdated()}updated(e){}firstUpdated(e){}}UpdatingElement[_a=finalized]=!0;
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
const legacyCustomElement=(e,t)=>(window.customElements.define(e,t),t),standardCustomElement=(e,t)=>{const{kind:o,elements:i}=t;return{kind:o,elements:i,finisher(t){window.customElements.define(e,t)}}},customElement=e=>t=>"function"==typeof t?legacyCustomElement(e,t):standardCustomElement(e,t),standardProperty=(e,t)=>"method"===t.kind&&t.descriptor&&!("value"in t.descriptor)?Object.assign(Object.assign({},t),{finisher(o){o.createProperty(t.key,e)}}):{kind:"field",key:Symbol(),placement:"own",descriptor:{},initializer(){"function"==typeof t.initializer&&(this[t.key]=t.initializer.call(this))},finisher(o){o.createProperty(t.key,e)}},legacyProperty=(e,t,o)=>{t.constructor.createProperty(o,e)};function property(e){return(t,o)=>void 0!==o?legacyProperty(e,t,o):standardProperty(e,t)}function query(e){return(t,o)=>{const i={get(){return this.renderRoot.querySelector(e)},enumerable:!0,configurable:!0};return void 0!==o?legacyQuery(i,t,o):standardQuery(i,t)}}const legacyQuery=(e,t,o)=>{Object.defineProperty(t,o,e)},standardQuery=(e,t)=>({kind:"method",placement:"prototype",key:t.key,descriptor:e})
/**
@license
Copyright (c) 2019 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at
http://polymer.github.io/LICENSE.txt The complete set of authors may be found at
http://polymer.github.io/AUTHORS.txt The complete set of contributors may be
found at http://polymer.github.io/CONTRIBUTORS.txt Code distributed by Google as
part of the polymer project is also subject to an additional IP rights grant
found at http://polymer.github.io/PATENTS.txt
*/,supportsAdoptingStyleSheets="adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,constructionToken=Symbol();class CSSResult{constructor(e,t){if(t!==constructionToken)throw new Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e}get styleSheet(){return void 0===this._styleSheet&&(supportsAdoptingStyleSheets?(this._styleSheet=new CSSStyleSheet,this._styleSheet.replaceSync(this.cssText)):this._styleSheet=null),this._styleSheet}toString(){return this.cssText}}const textFromCSSResult=e=>{if(e instanceof CSSResult)return e.cssText;if("number"==typeof e)return e;throw new Error(`Value passed to 'css' function must be a 'css' function result: ${e}. Use 'unsafeCSS' to pass non-literal values, but\n            take care to ensure page security.`)},css=(e,...t)=>{const o=t.reduce(((t,o,i)=>t+textFromCSSResult(o)+e[i+1]),e[0]);return new CSSResult(o,constructionToken)};
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
(window.litElementVersions||(window.litElementVersions=[])).push("2.3.1");const renderNotImplemented={};class LitElement extends UpdatingElement{static getStyles(){return this.styles}static _getUniqueStyles(){if(this.hasOwnProperty(JSCompiler_renameProperty("_styles",this)))return;const e=this.getStyles();if(void 0===e)this._styles=[];else if(Array.isArray(e)){const t=(e,o)=>e.reduceRight(((e,o)=>Array.isArray(o)?t(o,e):(e.add(o),e)),o),o=t(e,new Set),i=[];o.forEach((e=>i.unshift(e))),this._styles=i}else this._styles=[e]}initialize(){super.initialize(),this.constructor._getUniqueStyles(),this.renderRoot=this.createRenderRoot(),window.ShadowRoot&&this.renderRoot instanceof window.ShadowRoot&&this.adoptStyles()}createRenderRoot(){return this.attachShadow({mode:"open"})}adoptStyles(){const e=this.constructor._styles;0!==e.length&&(void 0===window.ShadyCSS||window.ShadyCSS.nativeShadow?supportsAdoptingStyleSheets?this.renderRoot.adoptedStyleSheets=e.map((e=>e.styleSheet)):this._needsShimAdoptedStyleSheets=!0:window.ShadyCSS.ScopingShim.prepareAdoptedCssText(e.map((e=>e.cssText)),this.localName))}connectedCallback(){super.connectedCallback(),this.hasUpdated&&void 0!==window.ShadyCSS&&window.ShadyCSS.styleElement(this)}update(e){const t=this.render();super.update(e),t!==renderNotImplemented&&this.constructor.render(t,this.renderRoot,{scopeName:this.localName,eventContext:this}),this._needsShimAdoptedStyleSheets&&(this._needsShimAdoptedStyleSheets=!1,this.constructor._styles.forEach((e=>{const t=document.createElement("style");t.textContent=e.cssText,this.renderRoot.appendChild(t)})))}render(){return renderNotImplemented}}LitElement.finalized=!0,LitElement.render=render$1;class Lumo extends HTMLElement{static get version(){return"1.6.0"}}customElements.define("vaadin-lumo-styles",Lumo);
/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/
let resolveFn,readyPromise=null,whenReady=window.HTMLImports&&window.HTMLImports.whenReady||null;function documentWait(e){requestAnimationFrame((function(){whenReady?whenReady(e):(readyPromise||(readyPromise=new Promise((e=>{resolveFn=e})),"complete"===document.readyState?resolveFn():document.addEventListener("readystatechange",(()=>{"complete"===document.readyState&&resolveFn()}))),readyPromise.then((function(){e&&e()})))}))}
/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/const SEEN_MARKER="__seenByShadyCSS",CACHED_STYLE="__shadyCSSCachedStyle";let transformFn=null,validateFn=null;class CustomStyleInterface{constructor(){this.customStyles=[],this.enqueued=!1,documentWait((()=>{window.ShadyCSS.flushCustomStyles&&window.ShadyCSS.flushCustomStyles()}))}enqueueDocumentValidation(){!this.enqueued&&validateFn&&(this.enqueued=!0,documentWait(validateFn))}addCustomStyle(e){e[SEEN_MARKER]||(e[SEEN_MARKER]=!0,this.customStyles.push(e),this.enqueueDocumentValidation())}getStyleForCustomStyle(e){if(e[CACHED_STYLE])return e[CACHED_STYLE];let t;return t=e.getStyle?e.getStyle():e,t}processStyles(){const e=this.customStyles;for(let t=0;t<e.length;t++){const o=e[t];if(o[CACHED_STYLE])continue;const i=this.getStyleForCustomStyle(o);if(i){const e=i.__appliedElement||i;transformFn&&transformFn(e),o[CACHED_STYLE]=e}}return e}}CustomStyleInterface.prototype.addCustomStyle=CustomStyleInterface.prototype.addCustomStyle,CustomStyleInterface.prototype.getStyleForCustomStyle=CustomStyleInterface.prototype.getStyleForCustomStyle,CustomStyleInterface.prototype.processStyles=CustomStyleInterface.prototype.processStyles,Object.defineProperties(CustomStyleInterface.prototype,{transformCallback:{get:()=>transformFn,set(e){transformFn=e}},validateCallback:{get:()=>validateFn,set(e){let t=!1;validateFn||(t=!0),validateFn=e,t&&this.enqueueDocumentValidation()}}});
/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/
const VAR_ASSIGN=/(?:^|[;\s{]\s*)(--[\w-]*?)\s*:\s*(?:((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};{])+)|\{([^}]*)\}(?:(?=[;\s}])|$))/gi,MIXIN_MATCH=/(?:^|\W+)@apply\s*\(?([^);\n]*)\)?/gi,MEDIA_MATCH=/@media\s(.*)/;
/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/
function updateNativeProperties(e,t){for(let o in t)null===o?e.style.removeProperty(o):e.style.setProperty(o,t[o])}function getComputedStyleValue(e,t){const o=window.getComputedStyle(e).getPropertyValue(t);return o?o.trim():""}function detectMixin(e){const t=MIXIN_MATCH.test(e)||VAR_ASSIGN.test(e);return MIXIN_MATCH.lastIndex=0,VAR_ASSIGN.lastIndex=0,t}
/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/const nativeShadow=!(window.ShadyDOM&&window.ShadyDOM.inUse);let nativeCssVariables_,cssBuild;function calcCssVariables(e){nativeCssVariables_=(!e||!e.shimcssproperties)&&(nativeShadow||Boolean(!navigator.userAgent.match(/AppleWebKit\/601|Edge\/15/)&&window.CSS&&CSS.supports&&CSS.supports("box-shadow","0 0 0 var(--foo)")))}window.ShadyCSS&&void 0!==window.ShadyCSS.cssBuild&&(cssBuild=window.ShadyCSS.cssBuild);const disableRuntime=Boolean(window.ShadyCSS&&window.ShadyCSS.disableRuntime);window.ShadyCSS&&void 0!==window.ShadyCSS.nativeCss?nativeCssVariables_=window.ShadyCSS.nativeCss:window.ShadyCSS?(calcCssVariables(window.ShadyCSS),window.ShadyCSS=void 0):calcCssVariables(window.WebComponents&&window.WebComponents.flags);const nativeCssVariables=nativeCssVariables_,customStyleInterface=new CustomStyleInterface;
/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/window.ShadyCSS||(window.ShadyCSS={prepareTemplate(e,t,o){},prepareTemplateDom(e,t){},prepareTemplateStyles(e,t,o){},styleSubtree(e,t){customStyleInterface.processStyles(),updateNativeProperties(e,t)},styleElement(e){customStyleInterface.processStyles()},styleDocument(e){customStyleInterface.processStyles(),updateNativeProperties(document.body,e)},getComputedStyleValue:(e,t)=>getComputedStyleValue(e,t),flushCustomStyles(){},nativeCss:nativeCssVariables,nativeShadow:nativeShadow,cssBuild:cssBuild,disableRuntime:disableRuntime}),window.ShadyCSS.CustomStyleInterface=customStyleInterface,
/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/
window.JSCompiler_renameProperty=function(e,t){return e};
/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/
let workingURL,resolveDoc,CSS_URL_RX=/(url\()([^)]*)(\))/g,ABS_URL=/(^\/[^\/])|(^#)|(^[\w-\d]*:)/;function resolveUrl(e,t){if(e&&ABS_URL.test(e))return e;if("//"===e)return e;if(void 0===workingURL){workingURL=!1;try{const e=new URL("b","http://a");e.pathname="c%20d",workingURL="http://a/c%20d"===e.href}catch(e){}}if(t||(t=document.baseURI||window.location.href),workingURL)try{return new URL(e,t).href}catch(t){return e}return resolveDoc||(resolveDoc=document.implementation.createHTMLDocument("temp"),resolveDoc.base=resolveDoc.createElement("base"),resolveDoc.head.appendChild(resolveDoc.base),resolveDoc.anchor=resolveDoc.createElement("a"),resolveDoc.body.appendChild(resolveDoc.anchor)),resolveDoc.base.href=t,resolveDoc.anchor.href=e,resolveDoc.anchor.href||e}function resolveCss(e,t){return e.replace(CSS_URL_RX,(function(e,o,i,r){return o+"'"+resolveUrl(i.replace(/["']/g,""),t)+"'"+r}))}function pathFromUrl(e){return e.substring(0,e.lastIndexOf("/")+1)}
/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/const useShadow=!window.ShadyDOM,useNativeCSSProperties=Boolean(!window.ShadyCSS||window.ShadyCSS.nativeCss);let rootPath=pathFromUrl(document.baseURI||window.location.href),sanitizeDOMValue=window.Polymer&&window.Polymer.sanitizeDOMValue||void 0,passiveTouchGestures=!1,strictTemplatePolicy=!1,modules={},lcModules={};function setModule(e,t){modules[e]=lcModules[e.toLowerCase()]=t}function findModule(e){return modules[e]||lcModules[e.toLowerCase()]}function styleOutsideTemplateCheck(e){e.querySelector("style")&&console.warn("dom-module %s has style outside template",e.id)}class DomModule extends HTMLElement{static get observedAttributes(){return["id"]}static import(e,t){if(e){let o=findModule(e);return o&&t?o.querySelector(t):o}return null}attributeChangedCallback(e,t,o,i){t!==o&&this.register()}get assetpath(){if(!this.__assetpath){const e=window.HTMLImports&&HTMLImports.importForElement?HTMLImports.importForElement(this)||document:this.ownerDocument,t=resolveUrl(this.getAttribute("assetpath")||"",e.baseURI);this.__assetpath=pathFromUrl(t)}return this.__assetpath}register(e){(e=e||this.id)&&(this.id=e,setModule(e,this),styleOutsideTemplateCheck(this))}}DomModule.prototype.modules=modules,customElements.define("dom-module",DomModule);
/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/
const MODULE_STYLE_LINK_SELECTOR="link[rel=import][type~=css]",INCLUDE_ATTR="include",SHADY_UNSCOPED_ATTR="shady-unscoped";function importModule(e){return DomModule.import(e)}function styleForImport(e){const t=resolveCss((e.body?e.body:e).textContent,e.baseURI),o=document.createElement("style");return o.textContent=t,o}function stylesFromModules(e){const t=e.trim().split(/\s+/),o=[];for(let e=0;e<t.length;e++)o.push(...stylesFromModule(t[e]));return o}function stylesFromModule(e){const t=importModule(e);if(!t)return console.warn("Could not find style data in module named",e),[];if(void 0===t._styles){const e=[];e.push(..._stylesFromModuleImports(t));const o=t.querySelector("template");o&&e.push(...stylesFromTemplate(o,t.assetpath)),t._styles=e}return t._styles}function stylesFromTemplate(e,t){if(!e._styles){const o=[],i=e.content.querySelectorAll("style");for(let e=0;e<i.length;e++){let r=i[e],s=r.getAttribute("include");s&&o.push(...stylesFromModules(s).filter((function(e,t,o){return o.indexOf(e)===t}))),t&&(r.textContent=resolveCss(r.textContent,t)),o.push(r)}e._styles=o}return e._styles}function stylesFromModuleImports(e){let t=importModule(e);return t?_stylesFromModuleImports(t):[]}function _stylesFromModuleImports(e){const t=[],o=e.querySelectorAll(MODULE_STYLE_LINK_SELECTOR);for(let e=0;e<o.length;e++){let i=o[e];if(i.import){const e=i.import,o=i.hasAttribute("shady-unscoped");if(o&&!e._unscopedStyle){const t=styleForImport(e);t.setAttribute("shady-unscoped",""),e._unscopedStyle=t}else e._style||(e._style=styleForImport(e));t.push(o?e._unscopedStyle:e._style)}}return t}function cssFromModules(e){let t=e.trim().split(/\s+/),o="";for(let e=0;e<t.length;e++)o+=cssFromModule(t[e]);return o}function cssFromModule(e){let t=importModule(e);if(t&&void 0===t._cssText){let e=_cssFromModuleImports(t),o=t.querySelector("template");o&&(e+=cssFromTemplate(o,t.assetpath)),t._cssText=e||null}return t||console.warn("Could not find style data in module named",e),t&&t._cssText||""}function cssFromTemplate(e,t){let o="";const i=stylesFromTemplate(e,t);for(let e=0;e<i.length;e++){let t=i[e];t.parentNode&&t.parentNode.removeChild(t),o+=t.textContent}return o}function _cssFromModuleImports(e){let t="",o=_stylesFromModuleImports(e);for(let e=0;e<o.length;e++)t+=o[e].textContent;return t}
/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/const attr="include",CustomStyleInterface$1=window.ShadyCSS.CustomStyleInterface;class CustomStyle extends HTMLElement{constructor(){super(),this._style=null,CustomStyleInterface$1.addCustomStyle(this)}getStyle(){if(this._style)return this._style;const e=this.querySelector("style");if(!e)return null;this._style=e;const t=e.getAttribute(attr);return t&&(e.removeAttribute(attr),e.textContent=cssFromModules(t)+e.textContent),this.ownerDocument!==window.document&&window.document.head.appendChild(this),this._style}}window.customElements.define("custom-style",CustomStyle);const $_documentContainer=document.createElement("template");$_documentContainer.innerHTML='<custom-style>\n  <style>\n    html {\n      /* Base (background) */\n      --lumo-base-color: #FFF;\n\n      /* Tint */\n      --lumo-tint-5pct: hsla(0, 0%, 100%, 0.3);\n      --lumo-tint-10pct: hsla(0, 0%, 100%, 0.37);\n      --lumo-tint-20pct: hsla(0, 0%, 100%, 0.44);\n      --lumo-tint-30pct: hsla(0, 0%, 100%, 0.5);\n      --lumo-tint-40pct: hsla(0, 0%, 100%, 0.57);\n      --lumo-tint-50pct: hsla(0, 0%, 100%, 0.64);\n      --lumo-tint-60pct: hsla(0, 0%, 100%, 0.7);\n      --lumo-tint-70pct: hsla(0, 0%, 100%, 0.77);\n      --lumo-tint-80pct: hsla(0, 0%, 100%, 0.84);\n      --lumo-tint-90pct: hsla(0, 0%, 100%, 0.9);\n      --lumo-tint: #FFF;\n\n      /* Shade */\n      --lumo-shade-5pct: hsla(214, 61%, 25%, 0.05);\n      --lumo-shade-10pct: hsla(214, 57%, 24%, 0.1);\n      --lumo-shade-20pct: hsla(214, 53%, 23%, 0.16);\n      --lumo-shade-30pct: hsla(214, 50%, 22%, 0.26);\n      --lumo-shade-40pct: hsla(214, 47%, 21%, 0.38);\n      --lumo-shade-50pct: hsla(214, 45%, 20%, 0.5);\n      --lumo-shade-60pct: hsla(214, 43%, 19%, 0.61);\n      --lumo-shade-70pct: hsla(214, 42%, 18%, 0.72);\n      --lumo-shade-80pct: hsla(214, 41%, 17%, 0.83);\n      --lumo-shade-90pct: hsla(214, 40%, 16%, 0.94);\n      --lumo-shade: hsl(214, 35%, 15%);\n\n      /* Contrast */\n      --lumo-contrast-5pct: var(--lumo-shade-5pct);\n      --lumo-contrast-10pct: var(--lumo-shade-10pct);\n      --lumo-contrast-20pct: var(--lumo-shade-20pct);\n      --lumo-contrast-30pct: var(--lumo-shade-30pct);\n      --lumo-contrast-40pct: var(--lumo-shade-40pct);\n      --lumo-contrast-50pct: var(--lumo-shade-50pct);\n      --lumo-contrast-60pct: var(--lumo-shade-60pct);\n      --lumo-contrast-70pct: var(--lumo-shade-70pct);\n      --lumo-contrast-80pct: var(--lumo-shade-80pct);\n      --lumo-contrast-90pct: var(--lumo-shade-90pct);\n      --lumo-contrast: var(--lumo-shade);\n\n      /* Text */\n      --lumo-header-text-color: var(--lumo-contrast);\n      --lumo-body-text-color: var(--lumo-contrast-90pct);\n      --lumo-secondary-text-color: var(--lumo-contrast-70pct);\n      --lumo-tertiary-text-color: var(--lumo-contrast-50pct);\n      --lumo-disabled-text-color: var(--lumo-contrast-30pct);\n\n      /* Primary */\n      --lumo-primary-color: hsl(214, 90%, 52%);\n      --lumo-primary-color-50pct: hsla(214, 90%, 52%, 0.5);\n      --lumo-primary-color-10pct: hsla(214, 90%, 52%, 0.1);\n      --lumo-primary-text-color: var(--lumo-primary-color);\n      --lumo-primary-contrast-color: #FFF;\n\n      /* Error */\n      --lumo-error-color: hsl(3, 100%, 61%);\n      --lumo-error-color-50pct: hsla(3, 100%, 60%, 0.5);\n      --lumo-error-color-10pct: hsla(3, 100%, 60%, 0.1);\n      --lumo-error-text-color: hsl(3, 92%, 53%);\n      --lumo-error-contrast-color: #FFF;\n\n      /* Success */\n      --lumo-success-color: hsl(145, 80%, 42%); /* hsl(144,82%,37%); */\n      --lumo-success-color-50pct: hsla(145, 76%, 44%, 0.55);\n      --lumo-success-color-10pct: hsla(145, 76%, 44%, 0.12);\n      --lumo-success-text-color: hsl(145, 100%, 32%);\n      --lumo-success-contrast-color: #FFF;\n    }\n  </style>\n</custom-style><dom-module id="lumo-color">\n  <template>\n    <style>\n      [theme~="dark"] {\n        /* Base (background) */\n        --lumo-base-color: hsl(214, 35%, 21%);\n\n        /* Tint */\n        --lumo-tint-5pct: hsla(214, 65%, 85%, 0.06);\n        --lumo-tint-10pct: hsla(214, 60%, 80%, 0.14);\n        --lumo-tint-20pct: hsla(214, 64%, 82%, 0.23);\n        --lumo-tint-30pct: hsla(214, 69%, 84%, 0.32);\n        --lumo-tint-40pct: hsla(214, 73%, 86%, 0.41);\n        --lumo-tint-50pct: hsla(214, 78%, 88%, 0.5);\n        --lumo-tint-60pct: hsla(214, 82%, 90%, 0.6);\n        --lumo-tint-70pct: hsla(214, 87%, 92%, 0.7);\n        --lumo-tint-80pct: hsla(214, 91%, 94%, 0.8);\n        --lumo-tint-90pct: hsla(214, 96%, 96%, 0.9);\n        --lumo-tint: hsl(214, 100%, 98%);\n\n        /* Shade */\n        --lumo-shade-5pct: hsla(214, 0%, 0%, 0.07);\n        --lumo-shade-10pct: hsla(214, 4%, 2%, 0.15);\n        --lumo-shade-20pct: hsla(214, 8%, 4%, 0.23);\n        --lumo-shade-30pct: hsla(214, 12%, 6%, 0.32);\n        --lumo-shade-40pct: hsla(214, 16%, 8%, 0.41);\n        --lumo-shade-50pct: hsla(214, 20%, 10%, 0.5);\n        --lumo-shade-60pct: hsla(214, 24%, 12%, 0.6);\n        --lumo-shade-70pct: hsla(214, 28%, 13%, 0.7);\n        --lumo-shade-80pct: hsla(214, 32%, 13%, 0.8);\n        --lumo-shade-90pct: hsla(214, 33%, 13%, 0.9);\n        --lumo-shade: hsl(214, 33%, 13%);\n\n        /* Contrast */\n        --lumo-contrast-5pct: var(--lumo-tint-5pct);\n        --lumo-contrast-10pct: var(--lumo-tint-10pct);\n        --lumo-contrast-20pct: var(--lumo-tint-20pct);\n        --lumo-contrast-30pct: var(--lumo-tint-30pct);\n        --lumo-contrast-40pct: var(--lumo-tint-40pct);\n        --lumo-contrast-50pct: var(--lumo-tint-50pct);\n        --lumo-contrast-60pct: var(--lumo-tint-60pct);\n        --lumo-contrast-70pct: var(--lumo-tint-70pct);\n        --lumo-contrast-80pct: var(--lumo-tint-80pct);\n        --lumo-contrast-90pct: var(--lumo-tint-90pct);\n        --lumo-contrast: var(--lumo-tint);\n\n        /* Text */\n        --lumo-header-text-color: var(--lumo-contrast);\n        --lumo-body-text-color: var(--lumo-contrast-90pct);\n        --lumo-secondary-text-color: var(--lumo-contrast-70pct);\n        --lumo-tertiary-text-color: var(--lumo-contrast-50pct);\n        --lumo-disabled-text-color: var(--lumo-contrast-30pct);\n\n        /* Primary */\n        --lumo-primary-color: hsl(214, 86%, 55%);\n        --lumo-primary-color-50pct: hsla(214, 86%, 55%, 0.5);\n        --lumo-primary-color-10pct: hsla(214, 90%, 63%, 0.1);\n        --lumo-primary-text-color: hsl(214, 100%, 70%);\n        --lumo-primary-contrast-color: #FFF;\n\n        /* Error */\n        --lumo-error-color: hsl(3, 90%, 63%);\n        --lumo-error-color-50pct: hsla(3, 90%, 63%, 0.5);\n        --lumo-error-color-10pct: hsla(3, 90%, 63%, 0.1);\n        --lumo-error-text-color: hsl(3, 100%, 67%);\n\n        /* Success */\n        --lumo-success-color: hsl(145, 65%, 42%);\n        --lumo-success-color-50pct: hsla(145, 65%, 42%, 0.5);\n        --lumo-success-color-10pct: hsla(145, 65%, 42%, 0.1);\n        --lumo-success-text-color: hsl(145, 85%, 47%);\n      }\n\n      html {\n        color: var(--lumo-body-text-color);\n        background-color: var(--lumo-base-color);\n      }\n\n      [theme~="dark"] {\n        color: var(--lumo-body-text-color);\n        background-color: var(--lumo-base-color);\n      }\n\n      h1,\n      h2,\n      h3,\n      h4,\n      h5,\n      h6 {\n        color: var(--lumo-header-text-color);\n      }\n\n      a {\n        color: var(--lumo-primary-text-color);\n      }\n\n      blockquote {\n        color: var(--lumo-secondary-text-color);\n      }\n\n      code,\n      pre {\n        background-color: var(--lumo-contrast-10pct);\n        border-radius: var(--lumo-border-radius-m);\n      }\n    </style>\n  </template>\n</dom-module><dom-module id="lumo-color-legacy">\n  <template>\n    <style include="lumo-color">\n      :host {\n        color: var(--lumo-body-text-color) !important;\n        background-color: var(--lumo-base-color) !important;\n      }\n    </style>\n  </template>\n</dom-module>',document.head.appendChild($_documentContainer.content);const $_documentContainer$1=document.createElement("template");$_documentContainer$1.innerHTML="<custom-style>\n  <style>\n    html {\n      /* Square */\n      --lumo-space-xs: 0.25rem;\n      --lumo-space-s: 0.5rem;\n      --lumo-space-m: 1rem;\n      --lumo-space-l: 1.5rem;\n      --lumo-space-xl: 2.5rem;\n\n      /* Wide */\n      --lumo-space-wide-xs: calc(var(--lumo-space-xs) / 2) var(--lumo-space-xs);\n      --lumo-space-wide-s: calc(var(--lumo-space-s) / 2) var(--lumo-space-s);\n      --lumo-space-wide-m: calc(var(--lumo-space-m) / 2) var(--lumo-space-m);\n      --lumo-space-wide-l: calc(var(--lumo-space-l) / 2) var(--lumo-space-l);\n      --lumo-space-wide-xl: calc(var(--lumo-space-xl) / 2) var(--lumo-space-xl);\n\n      /* Tall */\n      --lumo-space-tall-xs: var(--lumo-space-xs) calc(var(--lumo-space-xs) / 2);\n      --lumo-space-tall-s: var(--lumo-space-s) calc(var(--lumo-space-s) / 2);\n      --lumo-space-tall-m: var(--lumo-space-m) calc(var(--lumo-space-m) / 2);\n      --lumo-space-tall-l: var(--lumo-space-l) calc(var(--lumo-space-l) / 2);\n      --lumo-space-tall-xl: var(--lumo-space-xl) calc(var(--lumo-space-xl) / 2);\n    }\n  </style>\n</custom-style>",document.head.appendChild($_documentContainer$1.content);const $_documentContainer$2=document.createElement("template");$_documentContainer$2.innerHTML="<custom-style>\n  <style>\n    html {\n      /* Border radius */\n      --lumo-border-radius-s: 0.25em; /* Checkbox, badge, date-picker year indicator, etc */\n      --lumo-border-radius-m: var(--lumo-border-radius, 0.25em); /* Button, text field, menu overlay, etc */\n      --lumo-border-radius-l: 0.5em; /* Dialog, notification, etc */\n      --lumo-border-radius: 0.25em; /* Deprecated */\n\n      /* Shadow */\n      --lumo-box-shadow-xs: 0 1px 4px -1px var(--lumo-shade-50pct);\n      --lumo-box-shadow-s: 0 2px 4px -1px var(--lumo-shade-20pct), 0 3px 12px -1px var(--lumo-shade-30pct);\n      --lumo-box-shadow-m: 0 2px 6px -1px var(--lumo-shade-20pct), 0 8px 24px -4px var(--lumo-shade-40pct);\n      --lumo-box-shadow-l: 0 3px 18px -2px var(--lumo-shade-20pct), 0 12px 48px -6px var(--lumo-shade-40pct);\n      --lumo-box-shadow-xl: 0 4px 24px -3px var(--lumo-shade-20pct), 0 18px 64px -8px var(--lumo-shade-40pct);\n\n      /* Clickable element cursor */\n      --lumo-clickable-cursor: default;\n    }\n  </style>\n</custom-style>",document.head.appendChild($_documentContainer$2.content);const $_documentContainer$3=document.createElement("template");$_documentContainer$3.innerHTML='<custom-style>\n  <style>\n    html {\n      /* Font families */\n      --lumo-font-family: -apple-system, BlinkMacSystemFont, "Roboto", "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";\n\n      /* Font sizes */\n      --lumo-font-size-xxs: .75rem;\n      --lumo-font-size-xs: .8125rem;\n      --lumo-font-size-s: .875rem;\n      --lumo-font-size-m: 1rem;\n      --lumo-font-size-l: 1.125rem;\n      --lumo-font-size-xl: 1.375rem;\n      --lumo-font-size-xxl: 1.75rem;\n      --lumo-font-size-xxxl: 2.5rem;\n\n      /* Line heights */\n      --lumo-line-height-xs: 1.25;\n      --lumo-line-height-s: 1.375;\n      --lumo-line-height-m: 1.625;\n    }\n\n  </style>\n</custom-style><dom-module id="lumo-typography">\n  <template>\n    <style>\n      html {\n        font-family: var(--lumo-font-family);\n        font-size: var(--lumo-font-size, var(--lumo-font-size-m));\n        line-height: var(--lumo-line-height-m);\n        -webkit-text-size-adjust: 100%;\n        -webkit-font-smoothing: antialiased;\n        -moz-osx-font-smoothing: grayscale;\n      }\n\n      /* Cant combine with the above selector because that doesnt work in browsers without native shadow dom */\n      :host {\n        font-family: var(--lumo-font-family);\n        font-size: var(--lumo-font-size, var(--lumo-font-size-m));\n        line-height: var(--lumo-line-height-m);\n        -webkit-text-size-adjust: 100%;\n        -webkit-font-smoothing: antialiased;\n        -moz-osx-font-smoothing: grayscale;\n      }\n\n      small,\n      [theme~="font-size-s"] {\n        font-size: var(--lumo-font-size-s);\n        line-height: var(--lumo-line-height-s);\n      }\n\n      [theme~="font-size-xs"] {\n        font-size: var(--lumo-font-size-xs);\n        line-height: var(--lumo-line-height-xs);\n      }\n\n      h1,\n      h2,\n      h3,\n      h4,\n      h5,\n      h6 {\n        font-weight: 600;\n        line-height: var(--lumo-line-height-xs);\n        margin-top: 1.25em;\n      }\n\n      h1 {\n        font-size: var(--lumo-font-size-xxxl);\n        margin-bottom: 0.75em;\n      }\n\n      h2 {\n        font-size: var(--lumo-font-size-xxl);\n        margin-bottom: 0.5em;\n      }\n\n      h3 {\n        font-size: var(--lumo-font-size-xl);\n        margin-bottom: 0.5em;\n      }\n\n      h4 {\n        font-size: var(--lumo-font-size-l);\n        margin-bottom: 0.5em;\n      }\n\n      h5 {\n        font-size: var(--lumo-font-size-m);\n        margin-bottom: 0.25em;\n      }\n\n      h6 {\n        font-size: var(--lumo-font-size-xs);\n        margin-bottom: 0;\n        text-transform: uppercase;\n        letter-spacing: 0.03em;\n      }\n\n      p,\n      blockquote {\n        margin-top: 0.5em;\n        margin-bottom: 0.75em;\n      }\n\n      a {\n        text-decoration: none;\n      }\n\n      a:hover {\n        text-decoration: underline;\n      }\n\n      hr {\n        display: block;\n        align-self: stretch;\n        height: 1px;\n        border: 0;\n        padding: 0;\n        margin: var(--lumo-space-s) calc(var(--lumo-border-radius-m) / 2);\n        background-color: var(--lumo-contrast-10pct);\n      }\n\n      blockquote {\n        border-left: 2px solid var(--lumo-contrast-30pct);\n      }\n\n      b,\n      strong {\n        font-weight: 600;\n      }\n\n      /* RTL specific styles */\n\n      blockquote[dir="rtl"] {\n        border-left: none;\n        border-right: 2px solid var(--lumo-contrast-30pct);\n      }\n\n    </style>\n  </template>\n</dom-module>',document.head.appendChild($_documentContainer$3.content);const $_documentContainer$4=document.createElement("template");$_documentContainer$4.innerHTML='<dom-module id="lumo-overlay">\n  <template>\n    <style>\n      :host {\n        top: var(--lumo-space-m);\n        right: var(--lumo-space-m);\n        bottom: var(--lumo-space-m);\n        left: var(--lumo-space-m);\n        /* Workaround for Edge issue (only on Surface), where an overflowing vaadin-list-box inside vaadin-select-overlay makes the overlay transparent */\n        /* stylelint-disable-next-line */\n        outline: 0px solid transparent;\n      }\n\n      [part="overlay"] {\n        background-color: var(--lumo-base-color);\n        background-image: linear-gradient(var(--lumo-tint-5pct), var(--lumo-tint-5pct));\n        border-radius: var(--lumo-border-radius-m);\n        box-shadow: 0 0 0 1px var(--lumo-shade-5pct), var(--lumo-box-shadow-m);\n        color: var(--lumo-body-text-color);\n        font-family: var(--lumo-font-family);\n        font-size: var(--lumo-font-size-m);\n        font-weight: 400;\n        line-height: var(--lumo-line-height-m);\n        letter-spacing: 0;\n        text-transform: none;\n        -webkit-text-size-adjust: 100%;\n        -webkit-font-smoothing: antialiased;\n        -moz-osx-font-smoothing: grayscale;\n      }\n\n      [part="content"] {\n        padding: var(--lumo-space-xs);\n      }\n\n      [part="backdrop"] {\n        background-color: var(--lumo-shade-20pct);\n        animation: 0.2s lumo-overlay-backdrop-enter both;\n        will-change: opacity;\n      }\n\n      @keyframes lumo-overlay-backdrop-enter {\n        0% {\n          opacity: 0;\n        }\n      }\n\n      :host([closing]) [part="backdrop"] {\n        animation: 0.2s lumo-overlay-backdrop-exit both;\n      }\n\n      @keyframes lumo-overlay-backdrop-exit {\n        100% {\n          opacity: 0;\n        }\n      }\n\n      @keyframes lumo-overlay-dummy-animation {\n        0% { opacity: 1; }\n        100% { opacity: 1; }\n      }\n    </style>\n  </template>\n</dom-module>',document.head.appendChild($_documentContainer$4.content);
/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/
class LiteralString{constructor(e){this.value=e.toString()}toString(){return this.value}}function literalValue(e){if(e instanceof LiteralString)return e.value;throw new Error(`non-literal value passed to Polymer's htmlLiteral function: ${e}`)}function htmlValue(e){if(e instanceof HTMLTemplateElement)return e.innerHTML;if(e instanceof LiteralString)return literalValue(e);throw new Error(`non-template value passed to Polymer's html function: ${e}`)}const html$1=function(e,...t){const o=document.createElement("template");return o.innerHTML=t.reduce(((t,o,i)=>t+htmlValue(o)+e[i+1]),e[0]),o},$_documentContainer$5=html$1`<dom-module id="lumo-vaadin-overlay" theme-for="vaadin-overlay">
  <template>
    <style include="lumo-overlay">
      /* stylelint-disable no-empty-source */
    </style>
  </template>
</dom-module>`;document.head.appendChild($_documentContainer$5.content);
/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/
let dedupeId=0;const dedupingMixin=function(e){let t=e.__mixinApplications;t||(t=new WeakMap,e.__mixinApplications=t);let o=dedupeId++;return function(i){let r=i.__mixinSet;if(r&&r[o])return i;let s=t,n=s.get(i);n||(n=e(i),s.set(i,n));let a=Object.create(n.__mixinSet||r||null);return a[o]=!0,n.__mixinSet=a,n}},wrap=window.ShadyDOM&&window.ShadyDOM.noPatch&&window.ShadyDOM.wrap?window.ShadyDOM.wrap:window.ShadyDOM?e=>ShadyDOM.patch(e):e=>e;
/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/
/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/
function isPath(e){return e.indexOf(".")>=0}function root(e){let t=e.indexOf(".");return-1===t?e:e.slice(0,t)}function isAncestor(e,t){return 0===e.indexOf(t+".")}function isDescendant(e,t){return 0===t.indexOf(e+".")}function translate(e,t,o){return t+o.slice(e.length)}function matches(e,t){return e===t||isAncestor(e,t)||isDescendant(e,t)}function normalize(e){if(Array.isArray(e)){let t=[];for(let o=0;o<e.length;o++){let i=e[o].toString().split(".");for(let e=0;e<i.length;e++)t.push(i[e])}return t.join(".")}return e}function split(e){return Array.isArray(e)?normalize(e).split("."):e.toString().split(".")}function get(e,t,o){let i=e,r=split(t);for(let e=0;e<r.length;e++){if(!i)return;i=i[r[e]]}return o&&(o.path=r.join(".")),i}function set(e,t,o){let i=e,r=split(t),s=r[r.length-1];if(r.length>1){for(let e=0;e<r.length-1;e++){if(i=i[r[e]],!i)return}i[s]=o}else i[t]=o;return r.join(".")}
/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/const caseMap={},DASH_TO_CAMEL=/-[a-z]/g,CAMEL_TO_DASH=/([A-Z])/g;function dashToCamelCase(e){return caseMap[e]||(caseMap[e]=e.indexOf("-")<0?e:e.replace(DASH_TO_CAMEL,(e=>e[1].toUpperCase())))}function camelToDashCase(e){return caseMap[e]||(caseMap[e]=e.replace(CAMEL_TO_DASH,"-$1").toLowerCase())}
/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/let microtaskCurrHandle=0,microtaskLastHandle=0,microtaskCallbacks=[],microtaskNodeContent=0,microtaskNode=document.createTextNode("");function microtaskFlush(){const e=microtaskCallbacks.length;for(let t=0;t<e;t++){let e=microtaskCallbacks[t];if(e)try{e()}catch(e){setTimeout((()=>{throw e}))}}microtaskCallbacks.splice(0,e),microtaskLastHandle+=e}new window.MutationObserver(microtaskFlush).observe(microtaskNode,{characterData:!0});const timeOut={after:e=>({run:t=>window.setTimeout(t,e),cancel(e){window.clearTimeout(e)}}),run:(e,t)=>window.setTimeout(e,t),cancel(e){window.clearTimeout(e)}},animationFrame={run:e=>window.requestAnimationFrame(e),cancel(e){window.cancelAnimationFrame(e)}},idlePeriod={run:e=>window.requestIdleCallback?window.requestIdleCallback(e):window.setTimeout(e,16),cancel(e){window.cancelIdleCallback?window.cancelIdleCallback(e):window.clearTimeout(e)}},microTask={run:e=>(microtaskNode.textContent=microtaskNodeContent++,microtaskCallbacks.push(e),microtaskCurrHandle++),cancel(e){const t=e-microtaskLastHandle;if(t>=0){if(!microtaskCallbacks[t])throw new Error("invalid async handle: "+e);microtaskCallbacks[t]=null}}},microtask=microTask,PropertiesChanged=dedupingMixin((e=>class extends e{static createProperties(e){const t=this.prototype;for(let o in e)o in t||t._createPropertyAccessor(o)}static attributeNameForProperty(e){return e.toLowerCase()}static typeForProperty(e){}_createPropertyAccessor(e,t){this._addPropertyToAttributeMap(e),this.hasOwnProperty(JSCompiler_renameProperty("__dataHasAccessor",this))||(this.__dataHasAccessor=Object.assign({},this.__dataHasAccessor)),this.__dataHasAccessor[e]||(this.__dataHasAccessor[e]=!0,this._definePropertyAccessor(e,t))}_addPropertyToAttributeMap(e){if(this.hasOwnProperty(JSCompiler_renameProperty("__dataAttributes",this))||(this.__dataAttributes=Object.assign({},this.__dataAttributes)),!this.__dataAttributes[e]){const t=this.constructor.attributeNameForProperty(e);this.__dataAttributes[t]=e}}_definePropertyAccessor(e,t){Object.defineProperty(this,e,{get(){return this._getProperty(e)},set:t?function(){}:function(t){this._setProperty(e,t)}})}constructor(){super(),this.__dataEnabled=!1,this.__dataReady=!1,this.__dataInvalid=!1,this.__data={},this.__dataPending=null,this.__dataOld=null,this.__dataInstanceProps=null,this.__serializing=!1,this._initializeProperties()}ready(){this.__dataReady=!0,this._flushProperties()}_initializeProperties(){for(let e in this.__dataHasAccessor)this.hasOwnProperty(e)&&(this.__dataInstanceProps=this.__dataInstanceProps||{},this.__dataInstanceProps[e]=this[e],delete this[e])}_initializeInstanceProperties(e){Object.assign(this,e)}_setProperty(e,t){this._setPendingProperty(e,t)&&this._invalidateProperties()}_getProperty(e){return this.__data[e]}_setPendingProperty(e,t,o){let i=this.__data[e],r=this._shouldPropertyChange(e,t,i);return r&&(this.__dataPending||(this.__dataPending={},this.__dataOld={}),this.__dataOld&&!(e in this.__dataOld)&&(this.__dataOld[e]=i),this.__data[e]=t,this.__dataPending[e]=t),r}_invalidateProperties(){!this.__dataInvalid&&this.__dataReady&&(this.__dataInvalid=!0,microtask.run((()=>{this.__dataInvalid&&(this.__dataInvalid=!1,this._flushProperties())})))}_enableProperties(){this.__dataEnabled||(this.__dataEnabled=!0,this.__dataInstanceProps&&(this._initializeInstanceProperties(this.__dataInstanceProps),this.__dataInstanceProps=null),this.ready())}_flushProperties(){const e=this.__data,t=this.__dataPending,o=this.__dataOld;this._shouldPropertiesChange(e,t,o)&&(this.__dataPending=null,this.__dataOld=null,this._propertiesChanged(e,t,o))}_shouldPropertiesChange(e,t,o){return Boolean(t)}_propertiesChanged(e,t,o){}_shouldPropertyChange(e,t,o){return o!==t&&(o==o||t==t)}attributeChangedCallback(e,t,o,i){t!==o&&this._attributeToProperty(e,o),super.attributeChangedCallback&&super.attributeChangedCallback(e,t,o,i)}_attributeToProperty(e,t,o){if(!this.__serializing){const i=this.__dataAttributes,r=i&&i[e]||e;this[r]=this._deserializeValue(t,o||this.constructor.typeForProperty(r))}}_propertyToAttribute(e,t,o){this.__serializing=!0,o=arguments.length<3?this[e]:o,this._valueToNodeAttribute(this,o,t||this.constructor.attributeNameForProperty(e)),this.__serializing=!1}_valueToNodeAttribute(e,t,o){const i=this._serializeValue(t);"class"!==o&&"name"!==o&&"slot"!==o||(e=wrap(e)),void 0===i?e.removeAttribute(o):e.setAttribute(o,i)}_serializeValue(e){switch(typeof e){case"boolean":return e?"":void 0;default:return null!=e?e.toString():void 0}}_deserializeValue(e,t){switch(t){case Boolean:return null!==e;case Number:return Number(e);default:return e}}})),nativeProperties={};let proto=HTMLElement.prototype;for(;proto;){let e=Object.getOwnPropertyNames(proto);for(let t=0;t<e.length;t++)nativeProperties[e[t]]=!0;proto=Object.getPrototypeOf(proto)}function saveAccessorValue(e,t){if(!nativeProperties[t]){let o=e[t];void 0!==o&&(e.__data?e._setPendingProperty(t,o):(e.__dataProto?e.hasOwnProperty(JSCompiler_renameProperty("__dataProto",e))||(e.__dataProto=Object.create(e.__dataProto)):e.__dataProto={},e.__dataProto[t]=o))}}const PropertyAccessors=dedupingMixin((e=>{const t=PropertiesChanged(e);return class extends t{static createPropertiesForAttributes(){let e=this.observedAttributes;for(let t=0;t<e.length;t++)this.prototype._createPropertyAccessor(dashToCamelCase(e[t]))}static attributeNameForProperty(e){return camelToDashCase(e)}_initializeProperties(){this.__dataProto&&(this._initializeProtoProperties(this.__dataProto),this.__dataProto=null),super._initializeProperties()}_initializeProtoProperties(e){for(let t in e)this._setProperty(t,e[t])}_ensureAttribute(e,t){const o=this;o.hasAttribute(e)||this._valueToNodeAttribute(o,t,e)}_serializeValue(e){switch(typeof e){case"object":if(e instanceof Date)return e.toString();if(e)try{return JSON.stringify(e)}catch(e){return""}default:return super._serializeValue(e)}}_deserializeValue(e,t){let o;switch(t){case Object:try{o=JSON.parse(e)}catch(t){o=e}break;case Array:try{o=JSON.parse(e)}catch(t){o=null,console.warn(`Polymer::Attributes: couldn't decode Array as JSON: ${e}`)}break;case Date:o=isNaN(e)?String(e):Number(e),o=new Date(o);break;default:o=super._deserializeValue(e,t)}return o}_definePropertyAccessor(e,t){saveAccessorValue(this,e),super._definePropertyAccessor(e,t)}_hasAccessor(e){return this.__dataHasAccessor&&this.__dataHasAccessor[e]}_isPropertyPending(e){return Boolean(this.__dataPending&&e in this.__dataPending)}}})),templateExtensions={"dom-if":!0,"dom-repeat":!0};
/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/let placeholderBugDetect=!1,placeholderBug=!1;function hasPlaceholderBug(){if(!placeholderBugDetect){placeholderBugDetect=!0;const e=document.createElement("textarea");e.placeholder="a",placeholderBug=e.placeholder===e.textContent}return placeholderBug}function fixPlaceholder(e){hasPlaceholderBug()&&"textarea"===e.localName&&e.placeholder&&e.placeholder===e.textContent&&(e.textContent=null)}function wrapTemplateExtension(e){let t=e.getAttribute("is");if(t&&templateExtensions[t]){let o=e;for(o.removeAttribute("is"),e=o.ownerDocument.createElement(t),o.parentNode.replaceChild(e,o),e.appendChild(o);o.attributes.length;)e.setAttribute(o.attributes[0].name,o.attributes[0].value),o.removeAttribute(o.attributes[0].name)}return e}function findTemplateNode(e,t){let o=t.parentInfo&&findTemplateNode(e,t.parentInfo);if(!o)return e;for(let e=o.firstChild,i=0;e;e=e.nextSibling)if(t.parentIndex===i++)return e}function applyIdToMap(e,t,o,i){i.id&&(t[i.id]=o)}function applyEventListener(e,t,o){if(o.events&&o.events.length)for(let i,r=0,s=o.events;r<s.length&&(i=s[r]);r++)e._addMethodEventListenerToNode(t,i.name,i.value,e)}function applyTemplateContent(e,t,o){o.templateInfo&&(t._templateInfo=o.templateInfo)}function createNodeEventHandler(e,t,o){e=e._methodHost||e;return function(t){e[o]?e[o](t,t.detail):console.warn("listener method `"+o+"` not defined")}}const TemplateStamp=dedupingMixin((e=>class extends e{static _parseTemplate(e,t){if(!e._templateInfo){let o=e._templateInfo={};o.nodeInfoList=[],o.stripWhiteSpace=t&&t.stripWhiteSpace||e.hasAttribute("strip-whitespace"),this._parseTemplateContent(e,o,{parent:null})}return e._templateInfo}static _parseTemplateContent(e,t,o){return this._parseTemplateNode(e.content,t,o)}static _parseTemplateNode(e,t,o){let i=!1,r=e;return"template"!=r.localName||r.hasAttribute("preserve-content")?"slot"===r.localName&&(t.hasInsertionPoint=!0):i=this._parseTemplateNestedTemplate(r,t,o)||i,fixPlaceholder(r),r.firstChild&&this._parseTemplateChildNodes(r,t,o),r.hasAttributes&&r.hasAttributes()&&(i=this._parseTemplateNodeAttributes(r,t,o)||i),i}static _parseTemplateChildNodes(e,t,o){if("script"!==e.localName&&"style"!==e.localName)for(let i,r=e.firstChild,s=0;r;r=i){if("template"==r.localName&&(r=wrapTemplateExtension(r)),i=r.nextSibling,r.nodeType===Node.TEXT_NODE){let o=i;for(;o&&o.nodeType===Node.TEXT_NODE;)r.textContent+=o.textContent,i=o.nextSibling,e.removeChild(o),o=i;if(t.stripWhiteSpace&&!r.textContent.trim()){e.removeChild(r);continue}}let n={parentIndex:s,parentInfo:o};this._parseTemplateNode(r,t,n)&&(n.infoIndex=t.nodeInfoList.push(n)-1),r.parentNode&&s++}}static _parseTemplateNestedTemplate(e,t,o){let i=e,r=this._parseTemplate(i,t);return(r.content=i.content.ownerDocument.createDocumentFragment()).appendChild(i.content),o.templateInfo=r,!0}static _parseTemplateNodeAttributes(e,t,o){let i=!1,r=Array.from(e.attributes);for(let s,n=r.length-1;s=r[n];n--)i=this._parseTemplateNodeAttribute(e,t,o,s.name,s.value)||i;return i}static _parseTemplateNodeAttribute(e,t,o,i,r){return"on-"===i.slice(0,3)?(e.removeAttribute(i),o.events=o.events||[],o.events.push({name:i.slice(3),value:r}),!0):"id"===i&&(o.id=r,!0)}static _contentForTemplate(e){let t=e._templateInfo;return t&&t.content||e.content}_stampTemplate(e){e&&!e.content&&window.HTMLTemplateElement&&HTMLTemplateElement.decorate&&HTMLTemplateElement.decorate(e);let t=this.constructor._parseTemplate(e),o=t.nodeInfoList,i=t.content||e.content,r=document.importNode(i,!0);r.__noInsertionPoint=!t.hasInsertionPoint;let s=r.nodeList=new Array(o.length);r.$={};for(let e,t=0,i=o.length;t<i&&(e=o[t]);t++){let o=s[t]=findTemplateNode(r,e);applyIdToMap(this,r.$,o,e),applyTemplateContent(this,o,e),applyEventListener(this,o,e)}return r=r,r}_addMethodEventListenerToNode(e,t,o,i){let r=createNodeEventHandler(i=i||e,t,o);return this._addEventListenerToNode(e,t,r),r}_addEventListenerToNode(e,t,o){e.addEventListener(t,o)}_removeEventListenerFromNode(e,t,o){e.removeEventListener(t,o)}}));
/**
 * @fileoverview
 * @suppress {checkPrototypalTypes}
 * @license Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt The complete set of authors may be found
 * at http://polymer.github.io/AUTHORS.txt The complete set of contributors may
 * be found at http://polymer.github.io/CONTRIBUTORS.txt Code distributed by
 * Google as part of the polymer project is also subject to an additional IP
 * rights grant found at http://polymer.github.io/PATENTS.txt
 */let dedupeId$1=0;const TYPES={COMPUTE:"__computeEffects",REFLECT:"__reflectEffects",NOTIFY:"__notifyEffects",PROPAGATE:"__propagateEffects",OBSERVE:"__observeEffects",READ_ONLY:"__readOnly"},capitalAttributeRegex=/[A-Z]/;function ensureOwnEffectMap(e,t){let o=e[t];if(o){if(!e.hasOwnProperty(t)){o=e[t]=Object.create(e[t]);for(let e in o){let t=o[e],i=o[e]=Array(t.length);for(let e=0;e<t.length;e++)i[e]=t[e]}}}else o=e[t]={};return o}function runEffects(e,t,o,i,r,s){if(t){let n=!1,a=dedupeId$1++;for(let l in o)runEffectsForProperty(e,t,a,l,o,i,r,s)&&(n=!0);return n}return!1}function runEffectsForProperty(e,t,o,i,r,s,n,a){let l=!1,c=t[n?root(i):i];if(c)for(let t,d=0,h=c.length;d<h&&(t=c[d]);d++)t.info&&t.info.lastRun===o||n&&!pathMatchesTrigger(i,t.trigger)||(t.info&&(t.info.lastRun=o),t.fn(e,i,r,s,t.info,n,a),l=!0);return l}function pathMatchesTrigger(e,t){if(t){let o=t.name;return o==e||!(!t.structured||!isAncestor(o,e))||!(!t.wildcard||!isDescendant(o,e))}return!0}function runObserverEffect(e,t,o,i,r){let s="string"==typeof r.method?e[r.method]:r.method,n=r.property;s?s.call(e,e.__data[n],i[n]):r.dynamicFn||console.warn("observer method `"+r.method+"` not defined")}function runNotifyEffects(e,t,o,i,r){let s,n,a=e[TYPES.NOTIFY],l=dedupeId$1++;for(let n in t)t[n]&&(a&&runEffectsForProperty(e,a,l,n,o,i,r)||r&&notifyPath(e,n,o))&&(s=!0);s&&(n=e.__dataHost)&&n._invalidateProperties&&n._invalidateProperties()}function notifyPath(e,t,o){let i=root(t);if(i!==t){return dispatchNotifyEvent(e,camelToDashCase(i)+"-changed",o[t],t),!0}return!1}function dispatchNotifyEvent(e,t,o,i){let r={value:o,queueProperty:!0};i&&(r.path=i),wrap(e).dispatchEvent(new CustomEvent(t,{detail:r}))}function runNotifyEffect(e,t,o,i,r,s){let n=(s?root(t):t)!=t?t:null,a=n?get(e,n):e.__data[t];n&&void 0===a&&(a=o[t]),dispatchNotifyEvent(e,r.eventName,a,n)}function handleNotification(e,t,o,i,r){let s,n=e.detail,a=n&&n.path;a?(i=translate(o,i,a),s=n&&n.value):s=e.currentTarget[o],s=r?!s:s,t[TYPES.READ_ONLY]&&t[TYPES.READ_ONLY][i]||!t._setPendingPropertyOrPath(i,s,!0,Boolean(a))||n&&n.queueProperty||t._invalidateProperties()}function runReflectEffect(e,t,o,i,r){let s=e.__data[t];sanitizeDOMValue&&(s=sanitizeDOMValue(s,r.attrName,"attribute",e)),e._propertyToAttribute(t,r.attrName,s)}function runComputedEffects(e,t,o,i){let r=e[TYPES.COMPUTE];if(r){let s=t;for(;runEffects(e,r,s,o,i);)Object.assign(o,e.__dataOld),Object.assign(t,e.__dataPending),s=e.__dataPending,e.__dataPending=null}}function runComputedEffect(e,t,o,i,r){let s=runMethodEffect(e,t,o,i,r),n=r.methodInfo;e.__dataHasAccessor&&e.__dataHasAccessor[n]?e._setPendingProperty(n,s,!0):e[n]=s}function computeLinkedPaths(e,t,o){let i=e.__dataLinkedPaths;if(i){let r;for(let s in i){let n=i[s];isDescendant(s,t)?(r=translate(s,n,t),e._setPendingPropertyOrPath(r,o,!0,!0)):isDescendant(n,t)&&(r=translate(n,s,t),e._setPendingPropertyOrPath(r,o,!0,!0))}}}function addBinding(e,t,o,i,r,s,n){o.bindings=o.bindings||[];let a={kind:i,target:r,parts:s,literal:n,isCompound:1!==s.length};if(o.bindings.push(a),shouldAddListener(a)){let{event:e,negate:t}=a.parts[0];a.listenerEvent=e||camelToDashCase(r)+"-changed",a.listenerNegate=t}let l=t.nodeInfoList.length;for(let o=0;o<a.parts.length;o++){let i=a.parts[o];i.compoundIndex=o,addEffectForBindingPart(e,t,a,i,l)}}function addEffectForBindingPart(e,t,o,i,r){if(!i.literal)if("attribute"===o.kind&&"-"===o.target[0])console.warn("Cannot set attribute "+o.target+' because "-" is not a valid attribute starting character');else{let s=i.dependencies,n={index:r,binding:o,part:i,evaluator:e};for(let o=0;o<s.length;o++){let i=s[o];"string"==typeof i&&(i=parseArg(i),i.wildcard=!0),e._addTemplatePropertyEffect(t,i.rootProperty,{fn:runBindingEffect,info:n,trigger:i})}}}function runBindingEffect(e,t,o,i,r,s,n){let a=n[r.index],l=r.binding,c=r.part;if(s&&c.source&&t.length>c.source.length&&"property"==l.kind&&!l.isCompound&&a.__isPropertyEffectsClient&&a.__dataHasAccessor&&a.__dataHasAccessor[l.target]){let i=o[t];t=translate(c.source,l.target,t),a._setPendingPropertyOrPath(t,i,!1,!0)&&e._enqueueClient(a)}else{applyBindingValue(e,a,l,c,r.evaluator._evaluateBinding(e,c,t,o,i,s))}}function applyBindingValue(e,t,o,i,r){if(r=computeBindingValue(t,r,o,i),sanitizeDOMValue&&(r=sanitizeDOMValue(r,o.target,o.kind,t)),"attribute"==o.kind)e._valueToNodeAttribute(t,r,o.target);else{let i=o.target;t.__isPropertyEffectsClient&&t.__dataHasAccessor&&t.__dataHasAccessor[i]?t[TYPES.READ_ONLY]&&t[TYPES.READ_ONLY][i]||t._setPendingProperty(i,r)&&e._enqueueClient(t):e._setUnmanagedPropertyToNode(t,i,r)}}function computeBindingValue(e,t,o,i){if(o.isCompound){let r=e.__dataCompoundStorage[o.target];r[i.compoundIndex]=t,t=r.join("")}return"attribute"!==o.kind&&("textContent"!==o.target&&("value"!==o.target||"input"!==e.localName&&"textarea"!==e.localName)||(t=null==t?"":t)),t}function shouldAddListener(e){return Boolean(e.target)&&"attribute"!=e.kind&&"text"!=e.kind&&!e.isCompound&&"{"===e.parts[0].mode}function setupBindings(e,t){let{nodeList:o,nodeInfoList:i}=t;if(i.length)for(let t=0;t<i.length;t++){let r=i[t],s=o[t],n=r.bindings;if(n)for(let t=0;t<n.length;t++){let o=n[t];setupCompoundStorage(s,o),addNotifyListener(s,e,o)}s.__dataHost=e}}function setupCompoundStorage(e,t){if(t.isCompound){let o=e.__dataCompoundStorage||(e.__dataCompoundStorage={}),i=t.parts,r=new Array(i.length);for(let e=0;e<i.length;e++)r[e]=i[e].literal;let s=t.target;o[s]=r,t.literal&&"property"==t.kind&&("className"===s&&(e=wrap(e)),e[s]=t.literal)}}function addNotifyListener(e,t,o){if(o.listenerEvent){let i=o.parts[0];e.addEventListener(o.listenerEvent,(function(e){handleNotification(e,t,o.target,i.source,i.negate)}))}}function createMethodEffect(e,t,o,i,r,s){s=t.static||s&&("object"!=typeof s||s[t.methodName]);let n={methodName:t.methodName,args:t.args,methodInfo:r,dynamicFn:s};for(let r,s=0;s<t.args.length&&(r=t.args[s]);s++)r.literal||e._addPropertyEffect(r.rootProperty,o,{fn:i,info:n,trigger:r});s&&e._addPropertyEffect(t.methodName,o,{fn:i,info:n})}function runMethodEffect(e,t,o,i,r){let s=e._methodHost||e,n=s[r.methodName];if(n){let i=e._marshalArgs(r.args,t,o);return n.apply(s,i)}r.dynamicFn||console.warn("method `"+r.methodName+"` not defined")}const emptyArray=[],IDENT="(?:[a-zA-Z_$][\\w.:$\\-*]*)",NUMBER="(?:[-+]?[0-9]*\\.?[0-9]+(?:[eE][-+]?[0-9]+)?)",SQUOTE_STRING="(?:'(?:[^'\\\\]|\\\\.)*')",DQUOTE_STRING='(?:"(?:[^"\\\\]|\\\\.)*")',STRING="(?:"+SQUOTE_STRING+"|"+DQUOTE_STRING+")",ARGUMENT="(?:("+IDENT+"|"+NUMBER+"|"+STRING+")\\s*)",ARGUMENTS="(?:"+ARGUMENT+"(?:,\\s*"+ARGUMENT+")*)",ARGUMENT_LIST="(?:\\(\\s*(?:"+ARGUMENTS+"?)\\)\\s*)",BINDING="("+IDENT+"\\s*"+ARGUMENT_LIST+"?)",OPEN_BRACKET="(\\[\\[|{{)\\s*",CLOSE_BRACKET="(?:]]|}})",NEGATE="(?:(!)\\s*)?",EXPRESSION=OPEN_BRACKET+NEGATE+BINDING+"(?:]]|}})",bindingRegex=new RegExp(EXPRESSION,"g");function literalFromParts(e){let t="";for(let o=0;o<e.length;o++){t+=e[o].literal||""}return t}function parseMethod(e){let t=e.match(/([^\s]+?)\(([\s\S]*)\)/);if(t){let e={methodName:t[1],static:!0,args:emptyArray};if(t[2].trim()){return parseArgs(t[2].replace(/\\,/g,"&comma;").split(","),e)}return e}return null}function parseArgs(e,t){return t.args=e.map((function(e){let o=parseArg(e);return o.literal||(t.static=!1),o}),this),t}function parseArg(e){let t=e.trim().replace(/&comma;/g,",").replace(/\\(.)/g,"$1"),o={name:t,value:"",literal:!1},i=t[0];switch("-"===i&&(i=t[1]),i>="0"&&i<="9"&&(i="#"),i){case"'":case'"':o.value=t.slice(1,-1),o.literal=!0;break;case"#":o.value=Number(t),o.literal=!0}return o.literal||(o.rootProperty=root(t),o.structured=isPath(t),o.structured&&(o.wildcard=".*"==t.slice(-2),o.wildcard&&(o.name=t.slice(0,-2)))),o}function getArgValue(e,t,o){let i=get(e,o);return void 0===i&&(i=t[o]),i}function notifySplices(e,t,o,i){e.notifyPath(o+".splices",{indexSplices:i}),e.notifyPath(o+".length",t.length)}function notifySplice(e,t,o,i,r,s){notifySplices(e,t,o,[{index:i,addedCount:r,removed:s,object:t,type:"splice"}])}function upper(e){return e[0].toUpperCase()+e.substring(1)}const PropertyEffects=dedupingMixin((e=>{const t=TemplateStamp(PropertyAccessors(e));return class extends t{constructor(){super(),this.__isPropertyEffectsClient=!0,this.__dataCounter=0,this.__dataClientsReady,this.__dataPendingClients,this.__dataToNotify,this.__dataLinkedPaths,this.__dataHasPaths,this.__dataCompoundStorage,this.__dataHost,this.__dataTemp,this.__dataClientsInitialized,this.__data,this.__dataPending,this.__dataOld,this.__computeEffects,this.__reflectEffects,this.__notifyEffects,this.__propagateEffects,this.__observeEffects,this.__readOnly,this.__templateInfo}get PROPERTY_EFFECT_TYPES(){return TYPES}_initializeProperties(){super._initializeProperties(),hostStack.registerHost(this),this.__dataClientsReady=!1,this.__dataPendingClients=null,this.__dataToNotify=null,this.__dataLinkedPaths=null,this.__dataHasPaths=!1,this.__dataCompoundStorage=this.__dataCompoundStorage||null,this.__dataHost=this.__dataHost||null,this.__dataTemp={},this.__dataClientsInitialized=!1}_initializeProtoProperties(e){this.__data=Object.create(e),this.__dataPending=Object.create(e),this.__dataOld={}}_initializeInstanceProperties(e){let t=this[TYPES.READ_ONLY];for(let o in e)t&&t[o]||(this.__dataPending=this.__dataPending||{},this.__dataOld=this.__dataOld||{},this.__data[o]=this.__dataPending[o]=e[o])}_addPropertyEffect(e,t,o){this._createPropertyAccessor(e,t==TYPES.READ_ONLY);let i=ensureOwnEffectMap(this,t)[e];i||(i=this[t][e]=[]),i.push(o)}_removePropertyEffect(e,t,o){let i=ensureOwnEffectMap(this,t)[e],r=i.indexOf(o);r>=0&&i.splice(r,1)}_hasPropertyEffect(e,t){let o=this[t];return Boolean(o&&o[e])}_hasReadOnlyEffect(e){return this._hasPropertyEffect(e,TYPES.READ_ONLY)}_hasNotifyEffect(e){return this._hasPropertyEffect(e,TYPES.NOTIFY)}_hasReflectEffect(e){return this._hasPropertyEffect(e,TYPES.REFLECT)}_hasComputedEffect(e){return this._hasPropertyEffect(e,TYPES.COMPUTE)}_setPendingPropertyOrPath(e,t,o,i){if(i||root(Array.isArray(e)?e[0]:e)!==e){if(!i){let o=get(this,e);if(!(e=set(this,e,t))||!super._shouldPropertyChange(e,t,o))return!1}if(this.__dataHasPaths=!0,this._setPendingProperty(e,t,o))return computeLinkedPaths(this,e,t),!0}else{if(this.__dataHasAccessor&&this.__dataHasAccessor[e])return this._setPendingProperty(e,t,o);this[e]=t}return!1}_setUnmanagedPropertyToNode(e,t,o){o===e[t]&&"object"!=typeof o||("className"===t&&(e=wrap(e)),e[t]=o)}_setPendingProperty(e,t,o){let i=this.__dataHasPaths&&isPath(e),r=i?this.__dataTemp:this.__data;return!!this._shouldPropertyChange(e,t,r[e])&&(this.__dataPending||(this.__dataPending={},this.__dataOld={}),e in this.__dataOld||(this.__dataOld[e]=this.__data[e]),i?this.__dataTemp[e]=t:this.__data[e]=t,this.__dataPending[e]=t,(i||this[TYPES.NOTIFY]&&this[TYPES.NOTIFY][e])&&(this.__dataToNotify=this.__dataToNotify||{},this.__dataToNotify[e]=o),!0)}_setProperty(e,t){this._setPendingProperty(e,t,!0)&&this._invalidateProperties()}_invalidateProperties(){this.__dataReady&&this._flushProperties()}_enqueueClient(e){this.__dataPendingClients=this.__dataPendingClients||[],e!==this&&this.__dataPendingClients.push(e)}_flushProperties(){this.__dataCounter++,super._flushProperties(),this.__dataCounter--}_flushClients(){this.__dataClientsReady?this.__enableOrFlushClients():(this.__dataClientsReady=!0,this._readyClients(),this.__dataReady=!0)}__enableOrFlushClients(){let e=this.__dataPendingClients;if(e){this.__dataPendingClients=null;for(let t=0;t<e.length;t++){let o=e[t];o.__dataEnabled?o.__dataPending&&o._flushProperties():o._enableProperties()}}}_readyClients(){this.__enableOrFlushClients()}setProperties(e,t){for(let o in e)!t&&this[TYPES.READ_ONLY]&&this[TYPES.READ_ONLY][o]||this._setPendingPropertyOrPath(o,e[o],!0);this._invalidateProperties()}ready(){this._flushProperties(),this.__dataClientsReady||this._flushClients(),this.__dataPending&&this._flushProperties()}_propertiesChanged(e,t,o){let i=this.__dataHasPaths;this.__dataHasPaths=!1,runComputedEffects(this,t,o,i);let r=this.__dataToNotify;this.__dataToNotify=null,this._propagatePropertyChanges(t,o,i),this._flushClients(),runEffects(this,this[TYPES.REFLECT],t,o,i),runEffects(this,this[TYPES.OBSERVE],t,o,i),r&&runNotifyEffects(this,r,t,o,i),1==this.__dataCounter&&(this.__dataTemp={})}_propagatePropertyChanges(e,t,o){this[TYPES.PROPAGATE]&&runEffects(this,this[TYPES.PROPAGATE],e,t,o);let i=this.__templateInfo;for(;i;)runEffects(this,i.propertyEffects,e,t,o,i.nodeList),i=i.nextTemplateInfo}linkPaths(e,t){e=normalize(e),t=normalize(t),this.__dataLinkedPaths=this.__dataLinkedPaths||{},this.__dataLinkedPaths[e]=t}unlinkPaths(e){e=normalize(e),this.__dataLinkedPaths&&delete this.__dataLinkedPaths[e]}notifySplices(e,t){let o={path:""};notifySplices(this,get(this,e,o),o.path,t)}get(e,t){return get(t||this,e)}set(e,t,o){o?set(o,e,t):this[TYPES.READ_ONLY]&&this[TYPES.READ_ONLY][e]||this._setPendingPropertyOrPath(e,t,!0)&&this._invalidateProperties()}push(e,...t){let o={path:""},i=get(this,e,o),r=i.length,s=i.push(...t);return t.length&&notifySplice(this,i,o.path,r,t.length,[]),s}pop(e){let t={path:""},o=get(this,e,t),i=Boolean(o.length),r=o.pop();return i&&notifySplice(this,o,t.path,o.length,0,[r]),r}splice(e,t,o,...i){let r,s={path:""},n=get(this,e,s);return t<0?t=n.length-Math.floor(-t):t&&(t=Math.floor(t)),r=2===arguments.length?n.splice(t):n.splice(t,o,...i),(i.length||r.length)&&notifySplice(this,n,s.path,t,i.length,r),r}shift(e){let t={path:""},o=get(this,e,t),i=Boolean(o.length),r=o.shift();return i&&notifySplice(this,o,t.path,0,0,[r]),r}unshift(e,...t){let o={path:""},i=get(this,e,o),r=i.unshift(...t);return t.length&&notifySplice(this,i,o.path,0,t.length,[]),r}notifyPath(e,t){let o;if(1==arguments.length){let i={path:""};t=get(this,e,i),o=i.path}else o=Array.isArray(e)?normalize(e):e;this._setPendingPropertyOrPath(o,t,!0,!0)&&this._invalidateProperties()}_createReadOnlyProperty(e,t){this._addPropertyEffect(e,TYPES.READ_ONLY),t&&(this["_set"+upper(e)]=function(t){this._setProperty(e,t)})}_createPropertyObserver(e,t,o){let i={property:e,method:t,dynamicFn:Boolean(o)};this._addPropertyEffect(e,TYPES.OBSERVE,{fn:runObserverEffect,info:i,trigger:{name:e}}),o&&this._addPropertyEffect(t,TYPES.OBSERVE,{fn:runObserverEffect,info:i,trigger:{name:t}})}_createMethodObserver(e,t){let o=parseMethod(e);if(!o)throw new Error("Malformed observer expression '"+e+"'");createMethodEffect(this,o,TYPES.OBSERVE,runMethodEffect,null,t)}_createNotifyingProperty(e){this._addPropertyEffect(e,TYPES.NOTIFY,{fn:runNotifyEffect,info:{eventName:camelToDashCase(e)+"-changed",property:e}})}_createReflectedProperty(e){let t=this.constructor.attributeNameForProperty(e);"-"===t[0]?console.warn("Property "+e+" cannot be reflected to attribute "+t+' because "-" is not a valid starting attribute name. Use a lowercase first letter for the property instead.'):this._addPropertyEffect(e,TYPES.REFLECT,{fn:runReflectEffect,info:{attrName:t}})}_createComputedProperty(e,t,o){let i=parseMethod(t);if(!i)throw new Error("Malformed computed expression '"+t+"'");createMethodEffect(this,i,TYPES.COMPUTE,runComputedEffect,e,o)}_marshalArgs(e,t,o){const i=this.__data,r=[];for(let s=0,n=e.length;s<n;s++){let{name:n,structured:a,wildcard:l,value:c,literal:d}=e[s];if(!d)if(l){const e=isDescendant(n,t),r=getArgValue(i,o,e?t:n);c={path:e?t:n,value:r,base:e?get(i,n):r}}else c=a?getArgValue(i,o,n):i[n];r[s]=c}return r}static addPropertyEffect(e,t,o){this.prototype._addPropertyEffect(e,t,o)}static createPropertyObserver(e,t,o){this.prototype._createPropertyObserver(e,t,o)}static createMethodObserver(e,t){this.prototype._createMethodObserver(e,t)}static createNotifyingProperty(e){this.prototype._createNotifyingProperty(e)}static createReadOnlyProperty(e,t){this.prototype._createReadOnlyProperty(e,t)}static createReflectedProperty(e){this.prototype._createReflectedProperty(e)}static createComputedProperty(e,t,o){this.prototype._createComputedProperty(e,t,o)}static bindTemplate(e){return this.prototype._bindTemplate(e)}_bindTemplate(e,t){let o=this.constructor._parseTemplate(e),i=this.__templateInfo==o;if(!i)for(let e in o.propertyEffects)this._createPropertyAccessor(e);if(t&&(o=Object.create(o),o.wasPreBound=i,!i&&this.__templateInfo)){let e=this.__templateInfoLast||this.__templateInfo;return this.__templateInfoLast=e.nextTemplateInfo=o,o.previousTemplateInfo=e,o}return this.__templateInfo=o}static _addTemplatePropertyEffect(e,t,o){(e.hostProps=e.hostProps||{})[t]=!0;let i=e.propertyEffects=e.propertyEffects||{};(i[t]=i[t]||[]).push(o)}_stampTemplate(e){hostStack.beginHosting(this);let t=super._stampTemplate(e);hostStack.endHosting(this);let o=this._bindTemplate(e,!0);if(o.nodeList=t.nodeList,!o.wasPreBound){let e=o.childNodes=[];for(let o=t.firstChild;o;o=o.nextSibling)e.push(o)}return t.templateInfo=o,setupBindings(this,o),this.__dataReady&&runEffects(this,o.propertyEffects,this.__data,null,!1,o.nodeList),t}_removeBoundDom(e){let t=e.templateInfo;t.previousTemplateInfo&&(t.previousTemplateInfo.nextTemplateInfo=t.nextTemplateInfo),t.nextTemplateInfo&&(t.nextTemplateInfo.previousTemplateInfo=t.previousTemplateInfo),this.__templateInfoLast==t&&(this.__templateInfoLast=t.previousTemplateInfo),t.previousTemplateInfo=t.nextTemplateInfo=null;let o=t.childNodes;for(let e=0;e<o.length;e++){let t=o[e];t.parentNode.removeChild(t)}}static _parseTemplateNode(e,o,i){let r=t._parseTemplateNode.call(this,e,o,i);if(e.nodeType===Node.TEXT_NODE){let t=this._parseBindings(e.textContent,o);t&&(e.textContent=literalFromParts(t)||" ",addBinding(this,o,i,"text","textContent",t),r=!0)}return r}static _parseTemplateNodeAttribute(e,o,i,r,s){let n=this._parseBindings(s,o);if(n){let t=r,s="property";capitalAttributeRegex.test(r)?s="attribute":"$"==r[r.length-1]&&(r=r.slice(0,-1),s="attribute");let a=literalFromParts(n);return a&&"attribute"==s&&("class"==r&&e.hasAttribute("class")&&(a+=" "+e.getAttribute(r)),e.setAttribute(r,a)),"input"===e.localName&&"value"===t&&e.setAttribute(t,""),e.removeAttribute(t),"property"===s&&(r=dashToCamelCase(r)),addBinding(this,o,i,s,r,n,a),!0}return t._parseTemplateNodeAttribute.call(this,e,o,i,r,s)}static _parseTemplateNestedTemplate(e,o,i){let r=t._parseTemplateNestedTemplate.call(this,e,o,i),s=i.templateInfo.hostProps;for(let e in s){addBinding(this,o,i,"property","_host_"+e,[{mode:"{",source:e,dependencies:[e]}])}return r}static _parseBindings(e,t){let o,i=[],r=0;for(;null!==(o=bindingRegex.exec(e));){o.index>r&&i.push({literal:e.slice(r,o.index)});let s=o[1][0],n=Boolean(o[2]),a=o[3].trim(),l=!1,c="",d=-1;"{"==s&&(d=a.indexOf("::"))>0&&(c=a.substring(d+2),a=a.substring(0,d),l=!0);let h=parseMethod(a),p=[];if(h){let{args:e,methodName:o}=h;for(let t=0;t<e.length;t++){let o=e[t];o.literal||p.push(o)}let i=t.dynamicFns;(i&&i[o]||h.static)&&(p.push(o),h.dynamicFn=!0)}else p.push(a);i.push({source:a,mode:s,negate:n,customEvent:l,signature:h,dependencies:p,event:c}),r=bindingRegex.lastIndex}if(r&&r<e.length){let t=e.substring(r);t&&i.push({literal:t})}return i.length?i:null}static _evaluateBinding(e,t,o,i,r,s){let n;return n=t.signature?runMethodEffect(e,o,i,r,t.signature):o!=t.source?get(e,t.source):s&&isPath(o)?get(e,o):e.__data[o],t.negate&&(n=!n),n}}}));class HostStack{constructor(){this.stack=[]}registerHost(e){if(this.stack.length){this.stack[this.stack.length-1]._enqueueClient(e)}}beginHosting(e){this.stack.push(e)}endHosting(e){let t=this.stack.length;t&&this.stack[t-1]==e&&this.stack.pop()}}const hostStack=new HostStack;
/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/function register(e){}
/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/function normalizeProperties(e){const t={};for(let o in e){const i=e[o];t[o]="function"==typeof i?{type:i}:i}return t}const PropertiesMixin=dedupingMixin((e=>{const t=PropertiesChanged(e);function o(e){const t=Object.getPrototypeOf(e);return t.prototype instanceof r?t:null}function i(e){if(!e.hasOwnProperty(JSCompiler_renameProperty("__ownProperties",e))){let t=null;if(e.hasOwnProperty(JSCompiler_renameProperty("properties",e))){const o=e.properties;o&&(t=normalizeProperties(o))}e.__ownProperties=t}return e.__ownProperties}class r extends t{static get observedAttributes(){if(!this.hasOwnProperty(JSCompiler_renameProperty("__observedAttributes",this))){register(this.prototype);const e=this._properties;this.__observedAttributes=e?Object.keys(e).map((e=>this.attributeNameForProperty(e))):[]}return this.__observedAttributes}static finalize(){if(!this.hasOwnProperty(JSCompiler_renameProperty("__finalized",this))){const e=o(this);e&&e.finalize(),this.__finalized=!0,this._finalizeClass()}}static _finalizeClass(){const e=i(this);e&&this.createProperties(e)}static get _properties(){if(!this.hasOwnProperty(JSCompiler_renameProperty("__properties",this))){const e=o(this);this.__properties=Object.assign({},e&&e._properties,i(this))}return this.__properties}static typeForProperty(e){const t=this._properties[e];return t&&t.type}_initializeProperties(){this.constructor.finalize(),super._initializeProperties()}connectedCallback(){super.connectedCallback&&super.connectedCallback(),this._enableProperties()}disconnectedCallback(){super.disconnectedCallback&&super.disconnectedCallback()}}return r})),version="3.3.1",builtCSS=window.ShadyCSS&&window.ShadyCSS.cssBuild,ElementMixin=dedupingMixin((e=>{const t=PropertiesMixin(PropertyEffects(e));function o(e,t,o,i){o.computed&&(o.readOnly=!0),o.computed&&(e._hasReadOnlyEffect(t)?console.warn(`Cannot redefine computed property '${t}'.`):e._createComputedProperty(t,o.computed,i)),o.readOnly&&!e._hasReadOnlyEffect(t)?e._createReadOnlyProperty(t,!o.computed):!1===o.readOnly&&e._hasReadOnlyEffect(t)&&console.warn(`Cannot make readOnly property '${t}' non-readOnly.`),o.reflectToAttribute&&!e._hasReflectEffect(t)?e._createReflectedProperty(t):!1===o.reflectToAttribute&&e._hasReflectEffect(t)&&console.warn(`Cannot make reflected property '${t}' non-reflected.`),o.notify&&!e._hasNotifyEffect(t)?e._createNotifyingProperty(t):!1===o.notify&&e._hasNotifyEffect(t)&&console.warn(`Cannot make notify property '${t}' non-notify.`),o.observer&&e._createPropertyObserver(t,o.observer,i[o.observer]),e._addPropertyToAttributeMap(t)}return class extends t{static get polymerElementVersion(){return"3.3.1"}static _finalizeClass(){t._finalizeClass.call(this);const e=((o=this).hasOwnProperty(JSCompiler_renameProperty("__ownObservers",o))||(o.__ownObservers=o.hasOwnProperty(JSCompiler_renameProperty("observers",o))?o.observers:null),o.__ownObservers);var o;e&&this.createObservers(e,this._properties),this._prepareTemplate()}static _prepareTemplate(){let e=this.template;e&&("string"==typeof e?(console.error("template getter must return HTMLTemplateElement"),e=null):e=e.cloneNode(!0)),this.prototype._template=e}static createProperties(e){for(let t in e)o(this.prototype,t,e[t],e)}static createObservers(e,t){const o=this.prototype;for(let i=0;i<e.length;i++)o._createMethodObserver(e[i],t)}static get template(){return this.hasOwnProperty(JSCompiler_renameProperty("_template",this))||(this._template=this.prototype.hasOwnProperty(JSCompiler_renameProperty("_template",this.prototype))?this.prototype._template:function(e){let t=null;return e&&!strictTemplatePolicy&&(t=DomModule.import(e,"template")),t}(this.is)||Object.getPrototypeOf(this.prototype).constructor.template),this._template}static set template(e){this._template=e}static get importPath(){if(!this.hasOwnProperty(JSCompiler_renameProperty("_importPath",this))){const e=this.importMeta;if(e)this._importPath=pathFromUrl(e.url);else{const e=DomModule.import(this.is);this._importPath=e&&e.assetpath||Object.getPrototypeOf(this.prototype).constructor.importPath}}return this._importPath}constructor(){super(),this._template,this._importPath,this.rootPath,this.importPath,this.root,this.$}_initializeProperties(){this.constructor.finalize(),this.constructor._finalizeTemplate(this.localName),super._initializeProperties(),this.rootPath=rootPath,this.importPath=this.constructor.importPath;let e=function(e){if(!e.hasOwnProperty(JSCompiler_renameProperty("__propertyDefaults",e))){e.__propertyDefaults=null;let t=e._properties;for(let o in t){let i=t[o];"value"in i&&(e.__propertyDefaults=e.__propertyDefaults||{},e.__propertyDefaults[o]=i)}}return e.__propertyDefaults}(this.constructor);if(e)for(let t in e){let o=e[t];if(!this.hasOwnProperty(t)){let e="function"==typeof o.value?o.value.call(this):o.value;this._hasAccessor(t)?this._setPendingProperty(t,e,!0):this[t]=e}}}static _processStyleText(e,t){return resolveCss(e,t)}static _finalizeTemplate(e){const t=this.prototype._template;if(t&&!t.__polymerFinalized){t.__polymerFinalized=!0;const o=this.importPath;!function(e,t,o,i){if(!builtCSS){const r=t.content.querySelectorAll("style"),s=stylesFromTemplate(t),n=stylesFromModuleImports(o),a=t.content.firstElementChild;for(let o=0;o<n.length;o++){let r=n[o];r.textContent=e._processStyleText(r.textContent,i),t.content.insertBefore(r,a)}let l=0;for(let t=0;t<s.length;t++){let o=s[t],n=r[l];n!==o?(o=o.cloneNode(!0),n.parentNode.insertBefore(o,n)):l++,o.textContent=e._processStyleText(o.textContent,i)}}window.ShadyCSS&&window.ShadyCSS.prepareTemplate(t,o)}(this,t,e,o?resolveUrl(o):""),this.prototype._bindTemplate(t)}}connectedCallback(){window.ShadyCSS&&this._template&&window.ShadyCSS.styleElement(this),super.connectedCallback()}ready(){this._template&&(this.root=this._stampTemplate(this._template),this.$=this.root.$),super.ready()}_readyClients(){this._template&&(this.root=this._attachDom(this.root)),super._readyClients()}_attachDom(e){const t=wrap(this);if(t.attachShadow)return e?(t.shadowRoot||(t.attachShadow({mode:"open",shadyUpgradeFragment:e}),t.shadowRoot.appendChild(e)),t.shadowRoot):null;throw new Error("ShadowDOM not available. PolymerElement can create dom as children instead of in ShadowDOM by setting `this.root = this;` before `ready`.")}updateStyles(e){window.ShadyCSS&&window.ShadyCSS.styleSubtree(this,e)}resolveUrl(e,t){return!t&&this.importPath&&(t=resolveUrl(this.importPath)),resolveUrl(e,t)}static _parseTemplateContent(e,o,i){return o.dynamicFns=o.dynamicFns||this._properties,t._parseTemplateContent.call(this,e,o,i)}static _addTemplatePropertyEffect(e,o,i){return t._addTemplatePropertyEffect.call(this,e,o,i)}}})),PolymerElement=ElementMixin(HTMLElement);
/**
 * @fileoverview
 * @suppress {checkPrototypalTypes}
 * @license Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt The complete set of authors may be found
 * at http://polymer.github.io/AUTHORS.txt The complete set of contributors may
 * be found at http://polymer.github.io/CONTRIBUTORS.txt Code distributed by
 * Google as part of the polymer project is also subject to an additional IP
 * rights grant found at http://polymer.github.io/PATENTS.txt
 */
/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/
function mutablePropertyChange(e,t,o,i,r){let s;r&&(s="object"==typeof o&&null!==o,s&&(i=e.__dataTemp[t]));let n=i!==o&&(i==i||o==o);return s&&n&&(e.__dataTemp[t]=o),n}const MutableData=dedupingMixin((e=>class extends e{_shouldPropertyChange(e,t,o){return mutablePropertyChange(this,e,t,o,!0)}})),OptionalMutableData=dedupingMixin((e=>class extends e{static get properties(){return{mutableData:Boolean}}_shouldPropertyChange(e,t,o){return mutablePropertyChange(this,e,t,o,this.mutableData)}}));MutableData._mutablePropertyChange=mutablePropertyChange;
/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/
let newInstance=null;function HTMLTemplateElementExtension(){return newInstance}HTMLTemplateElementExtension.prototype=Object.create(HTMLTemplateElement.prototype,{constructor:{value:HTMLTemplateElementExtension,writable:!0}});const DataTemplate=PropertyEffects(HTMLTemplateElementExtension),MutableDataTemplate=MutableData(DataTemplate);function upgradeTemplate(e,t){newInstance=e,Object.setPrototypeOf(e,t.prototype),new t,newInstance=null}const templateInstanceBase=PropertyEffects(class{});class TemplateInstanceBase extends templateInstanceBase{constructor(e){super(),this._configureProperties(e),this.root=this._stampTemplate(this.__dataHost);let t=[];this.children=t;for(let e=this.root.firstChild;e;e=e.nextSibling)t.push(e),e.__templatizeInstance=this;this.__templatizeOwner&&this.__templatizeOwner.__hideTemplateChildren__&&this._showHideChildren(!0);let o=this.__templatizeOptions;(e&&o.instanceProps||!o.instanceProps)&&this._enableProperties()}_configureProperties(e){if(this.__templatizeOptions.forwardHostProp)for(let e in this.__hostProps)this._setPendingProperty(e,this.__dataHost["_host_"+e]);for(let t in e)this._setPendingProperty(t,e[t])}forwardHostProp(e,t){this._setPendingPropertyOrPath(e,t,!1,!0)&&this.__dataHost._enqueueClient(this)}_addEventListenerToNode(e,t,o){if(this._methodHost&&this.__templatizeOptions.parentModel)this._methodHost._addEventListenerToNode(e,t,(e=>{e.model=this,o(e)}));else{let i=this.__dataHost.__dataHost;i&&i._addEventListenerToNode(e,t,o)}}_showHideChildren(e){let t=this.children;for(let o=0;o<t.length;o++){let i=t[o];if(Boolean(e)!=Boolean(i.__hideTemplateChildren__))if(i.nodeType===Node.TEXT_NODE)e?(i.__polymerTextContent__=i.textContent,i.textContent=""):i.textContent=i.__polymerTextContent__;else if("slot"===i.localName)if(e)i.__polymerReplaced__=document.createComment("hidden-slot"),wrap(wrap(i).parentNode).replaceChild(i.__polymerReplaced__,i);else{const e=i.__polymerReplaced__;e&&wrap(wrap(e).parentNode).replaceChild(i,e)}else i.style&&(e?(i.__polymerDisplay__=i.style.display,i.style.display="none"):i.style.display=i.__polymerDisplay__);i.__hideTemplateChildren__=e,i._showHideChildren&&i._showHideChildren(e)}}_setUnmanagedPropertyToNode(e,t,o){e.__hideTemplateChildren__&&e.nodeType==Node.TEXT_NODE&&"textContent"==t?e.__polymerTextContent__=o:super._setUnmanagedPropertyToNode(e,t,o)}get parentModel(){let e=this.__parentModel;if(!e){let t;e=this;do{e=e.__dataHost.__dataHost}while((t=e.__templatizeOptions)&&!t.parentModel);this.__parentModel=e}return e}dispatchEvent(e){return!0}}const MutableTemplateInstanceBase=MutableData(TemplateInstanceBase);function findMethodHost(e){let t=e.__dataHost;return t&&t._methodHost||t}function createTemplatizerClass(e,t,o){let i=o.mutableData?MutableTemplateInstanceBase:TemplateInstanceBase;templatize.mixin&&(i=templatize.mixin(i));let r=class extends i{};return r.prototype.__templatizeOptions=o,r.prototype._bindTemplate(e),addNotifyEffects(r,e,t,o),r}function addPropagateEffects(e,t,o){let i=o.forwardHostProp;if(i&&t.hasHostProps){let r=t.templatizeTemplateClass;if(!r){let e=o.mutableData?MutableDataTemplate:DataTemplate;r=t.templatizeTemplateClass=class extends e{};let s=t.hostProps;for(let e in s)r.prototype._addPropertyEffect("_host_"+e,r.prototype.PROPERTY_EFFECT_TYPES.PROPAGATE,{fn:createForwardHostPropEffect(e,i)}),r.prototype._createNotifyingProperty("_host_"+e)}upgradeTemplate(e,r),e.__dataProto&&Object.assign(e.__data,e.__dataProto),e.__dataTemp={},e.__dataPending=null,e.__dataOld=null,e._enableProperties()}}function createForwardHostPropEffect(e,t){return function(e,o,i){t.call(e.__templatizeOwner,o.substring("_host_".length),i[o])}}function addNotifyEffects(e,t,o,i){let r=o.hostProps||{};for(let t in i.instanceProps){delete r[t];let o=i.notifyInstanceProp;o&&e.prototype._addPropertyEffect(t,e.prototype.PROPERTY_EFFECT_TYPES.NOTIFY,{fn:createNotifyInstancePropEffect(t,o)})}if(i.forwardHostProp&&t.__dataHost)for(let t in r)o.hasHostProps||(o.hasHostProps=!0),e.prototype._addPropertyEffect(t,e.prototype.PROPERTY_EFFECT_TYPES.NOTIFY,{fn:createNotifyHostPropEffect()})}function createNotifyInstancePropEffect(e,t){return function(e,o,i){t.call(e.__templatizeOwner,e,o,i[o])}}function createNotifyHostPropEffect(){return function(e,t,o){e.__dataHost._setPendingPropertyOrPath("_host_"+t,o[t],!0,!0)}}function templatize(e,t,o){if(o=o||{},e.__templatizeOwner)throw new Error("A <template> can only be templatized once");e.__templatizeOwner=t;let i=(t?t.constructor:TemplateInstanceBase)._parseTemplate(e),r=i.templatizeInstanceClass;r||(r=createTemplatizerClass(e,i,o),i.templatizeInstanceClass=r),addPropagateEffects(e,i,o);let s=class extends r{};return s.prototype._methodHost=findMethodHost(e),s.prototype.__dataHost=e,s.prototype.__templatizeOwner=t,s.prototype.__hostProps=i.hostProps,s=s,s}function modelForElement(e,t){let o;for(;t;)if(o=t.__templatizeInstance){if(o.__dataHost==e)return o;t=o.__dataHost}else t=wrap(t).parentNode;return null}
/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/let scheduled=!1,beforeRenderQueue=[],afterRenderQueue=[];function schedule(){scheduled=!0,requestAnimationFrame((function(){scheduled=!1,flushQueue(beforeRenderQueue),setTimeout((function(){runQueue(afterRenderQueue)}))}))}function flushQueue(e){for(;e.length;)callMethod(e.shift())}function runQueue(e){for(let t=0,o=e.length;t<o;t++)callMethod(e.shift())}function callMethod(e){const t=e[0],o=e[1],i=e[2];try{o.apply(t,i)}catch(e){setTimeout((()=>{throw e}))}}function afterNextRender(e,t,o){scheduled||schedule(),afterRenderQueue.push([e,t,o])}
/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/function newSplice(e,t,o){return{index:e,removed:t,addedCount:o}}const EDIT_LEAVE=0,EDIT_UPDATE=1,EDIT_ADD=2,EDIT_DELETE=3;function calcEditDistances(e,t,o,i,r,s){let n=s-r+1,a=o-t+1,l=new Array(n);for(let e=0;e<n;e++)l[e]=new Array(a),l[e][0]=e;for(let e=0;e<a;e++)l[0][e]=e;for(let o=1;o<n;o++)for(let s=1;s<a;s++)if(equals(e[t+s-1],i[r+o-1]))l[o][s]=l[o-1][s-1];else{let e=l[o-1][s]+1,t=l[o][s-1]+1;l[o][s]=e<t?e:t}return l}function spliceOperationsFromEditDistances(e){let t=e.length-1,o=e[0].length-1,i=e[t][o],r=[];for(;t>0||o>0;){if(0==t){r.push(2),o--;continue}if(0==o){r.push(3),t--;continue}let s,n=e[t-1][o-1],a=e[t-1][o],l=e[t][o-1];s=a<l?a<n?a:n:l<n?l:n,s==n?(n==i?r.push(0):(r.push(1),i=n),t--,o--):s==a?(r.push(3),t--,i=a):(r.push(2),o--,i=l)}return r.reverse(),r}function calcSplices(e,t,o,i,r,s){let n,a=0,l=0,c=Math.min(o-t,s-r);if(0==t&&0==r&&(a=sharedPrefix(e,i,c)),o==e.length&&s==i.length&&(l=sharedSuffix(e,i,c-a)),r+=a,s-=l,(o-=l)-(t+=a)==0&&s-r==0)return[];if(t==o){for(n=newSplice(t,[],0);r<s;)n.removed.push(i[r++]);return[n]}if(r==s)return[newSplice(t,[],o-t)];let d=spliceOperationsFromEditDistances(calcEditDistances(e,t,o,i,r,s));n=void 0;let h=[],p=t,u=r;for(let e=0;e<d.length;e++)switch(d[e]){case 0:n&&(h.push(n),n=void 0),p++,u++;break;case 1:n||(n=newSplice(p,[],0)),n.addedCount++,p++,n.removed.push(i[u]),u++;break;case 2:n||(n=newSplice(p,[],0)),n.addedCount++,p++;break;case 3:n||(n=newSplice(p,[],0)),n.removed.push(i[u]),u++}return n&&h.push(n),h}function sharedPrefix(e,t,o){for(let i=0;i<o;i++)if(!equals(e[i],t[i]))return i;return o}function sharedSuffix(e,t,o){let i=e.length,r=t.length,s=0;for(;s<o&&equals(e[--i],t[--r]);)s++;return s}function calculateSplices(e,t){return calcSplices(e,0,e.length,t,0,t.length)}function equals(e,t){return e===t}
/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/function isSlot(e){return"slot"===e.localName}let FlattenedNodesObserver=class{static getFlattenedNodes(e){const t=wrap(e);return isSlot(e)?(e=e,t.assignedNodes({flatten:!0})):Array.from(t.childNodes).map((e=>isSlot(e)?wrap(e=e).assignedNodes({flatten:!0}):[e])).reduce(((e,t)=>e.concat(t)),[])}constructor(e,t){this._shadyChildrenObserver=null,this._nativeChildrenObserver=null,this._connected=!1,this._target=e,this.callback=t,this._effectiveNodes=[],this._observer=null,this._scheduled=!1,this._boundSchedule=()=>{this._schedule()},this.connect(),this._schedule()}connect(){isSlot(this._target)?this._listenSlots([this._target]):wrap(this._target).children&&(this._listenSlots(wrap(this._target).children),window.ShadyDOM?this._shadyChildrenObserver=window.ShadyDOM.observeChildren(this._target,(e=>{this._processMutations(e)})):(this._nativeChildrenObserver=new MutationObserver((e=>{this._processMutations(e)})),this._nativeChildrenObserver.observe(this._target,{childList:!0}))),this._connected=!0}disconnect(){isSlot(this._target)?this._unlistenSlots([this._target]):wrap(this._target).children&&(this._unlistenSlots(wrap(this._target).children),window.ShadyDOM&&this._shadyChildrenObserver?(window.ShadyDOM.unobserveChildren(this._shadyChildrenObserver),this._shadyChildrenObserver=null):this._nativeChildrenObserver&&(this._nativeChildrenObserver.disconnect(),this._nativeChildrenObserver=null)),this._connected=!1}_schedule(){this._scheduled||(this._scheduled=!0,microTask.run((()=>this.flush())))}_processMutations(e){this._processSlotMutations(e),this.flush()}_processSlotMutations(e){if(e)for(let t=0;t<e.length;t++){let o=e[t];o.addedNodes&&this._listenSlots(o.addedNodes),o.removedNodes&&this._unlistenSlots(o.removedNodes)}}flush(){if(!this._connected)return!1;window.ShadyDOM&&ShadyDOM.flush(),this._nativeChildrenObserver?this._processSlotMutations(this._nativeChildrenObserver.takeRecords()):this._shadyChildrenObserver&&this._processSlotMutations(this._shadyChildrenObserver.takeRecords()),this._scheduled=!1;let e={target:this._target,addedNodes:[],removedNodes:[]},t=this.constructor.getFlattenedNodes(this._target),o=calculateSplices(t,this._effectiveNodes);for(let t,i=0;i<o.length&&(t=o[i]);i++)for(let o,i=0;i<t.removed.length&&(o=t.removed[i]);i++)e.removedNodes.push(o);for(let i,r=0;r<o.length&&(i=o[r]);r++)for(let o=i.index;o<i.index+i.addedCount;o++)e.addedNodes.push(t[o]);this._effectiveNodes=t;let i=!1;return(e.addedNodes.length||e.removedNodes.length)&&(i=!0,this.callback.call(this._target,e)),i}_listenSlots(e){for(let t=0;t<e.length;t++){let o=e[t];isSlot(o)&&o.addEventListener("slotchange",this._boundSchedule)}}_unlistenSlots(e){for(let t=0;t<e.length;t++){let o=e[t];isSlot(o)&&o.removeEventListener("slotchange",this._boundSchedule)}}};const ThemePropertyMixin=e=>class extends e{static get properties(){return{theme:{type:String,readOnly:!0}}}attributeChangedCallback(e,t,o){super.attributeChangedCallback(e,t,o),"theme"===e&&this._setTheme(o)}},ThemableMixin=e=>class extends(ThemePropertyMixin(e)){static finalize(){super.finalize();const e=this.prototype._template,t=this.template&&this.template.parentElement&&this.template.parentElement.id===this.is,o=Object.getPrototypeOf(this.prototype)._template;o&&!t&&Array.from(o.content.querySelectorAll("style[include]")).forEach((t=>{this._includeStyle(t.getAttribute("include"),e)})),this._includeMatchingThemes(e)}static _includeMatchingThemes(e){const t=DomModule.prototype.modules;let o=!1;const i=this.is+"-default-theme";Object.keys(t).sort(((e,t)=>{const o=0===e.indexOf("vaadin-"),i=0===t.indexOf("vaadin-"),r=["lumo-","material-"],s=r.filter((t=>0===e.indexOf(t))).length>0,n=r.filter((e=>0===t.indexOf(e))).length>0;return o!==i?o?-1:1:s!==n?s?-1:1:0})).forEach((r=>{if(r!==i){const i=t[r].getAttribute("theme-for");i&&i.split(" ").forEach((t=>{new RegExp("^"+t.split("*").join(".*")+"$").test(this.is)&&(o=!0,this._includeStyle(r,e))}))}})),!o&&t[i]&&this._includeStyle(i,e)}static _includeStyle(e,t){if(t&&!t.content.querySelector(`style[include="${e}"]`)){const o=document.createElement("style");o.setAttribute("include",e),t.content.appendChild(o)}}},directionSubscribers=[],directionUpdater=function(){const e=getDocumentDir();directionSubscribers.forEach((t=>{alignDirs(t,e)}))},directionObserver=new MutationObserver(directionUpdater);directionObserver.observe(document.documentElement,{attributes:!0,attributeFilter:["dir"]});const alignDirs=function(e,t){t?e.setAttribute("dir",t):e.removeAttribute("dir")},getDocumentDir=function(){return document.documentElement.getAttribute("dir")},DirMixin=e=>class extends e{static get properties(){return{dir:{type:String,readOnly:!0}}}connectedCallback(){super.connectedCallback(),this.hasAttribute("dir")||(this.__subscribe(),alignDirs(this,getDocumentDir()))}attributeChangedCallback(e,t,o){if(super.attributeChangedCallback(e,t,o),"dir"!==e)return;const i=o===getDocumentDir()&&-1===directionSubscribers.indexOf(this),r=!o&&t&&-1===directionSubscribers.indexOf(this),s=o!==getDocumentDir()&&t===getDocumentDir();i||r?(this.__subscribe(),alignDirs(this,getDocumentDir())):s&&this.__subscribe(!1)}disconnectedCallback(){super.disconnectedCallback(),this.__subscribe(!1)}__subscribe(e=!0){e?-1===directionSubscribers.indexOf(this)&&directionSubscribers.push(this):directionSubscribers.indexOf(this)>-1&&directionSubscribers.splice(directionSubscribers.indexOf(this),1)}},p=Element.prototype,matches$1=p.matches||p.matchesSelector||p.mozMatchesSelector||p.msMatchesSelector||p.oMatchesSelector||p.webkitMatchesSelector,FocusablesHelper={getTabbableNodes:function(e){const t=[];return this._collectTabbableNodes(e,t)?this._sortByTabIndex(t):t},isFocusable:function(e){return matches$1.call(e,"input, select, textarea, button, object")?matches$1.call(e,":not([disabled])"):matches$1.call(e,"a[href], area[href], iframe, [tabindex], [contentEditable]")},isTabbable:function(e){return this.isFocusable(e)&&matches$1.call(e,':not([tabindex="-1"])')&&this._isVisible(e)},_normalizedTabIndex:function(e){if(this.isFocusable(e)){const t=e.getAttribute("tabindex")||0;return Number(t)}return-1},_collectTabbableNodes:function(e,t){if(e.nodeType!==Node.ELEMENT_NODE||!this._isVisible(e))return!1;const o=e,i=this._normalizedTabIndex(o);let r,s=i>0;if(i>=0&&t.push(o),r="slot"===o.localName?o.assignedNodes({flatten:!0}):(o.shadowRoot||o).children,r)for(let e=0;e<r.length;e++)s=this._collectTabbableNodes(r[e],t)||s;return s},_isVisible:function(e){let t=e.style;return"hidden"!==t.visibility&&"none"!==t.display&&(t=window.getComputedStyle(e),"hidden"!==t.visibility&&"none"!==t.display)},_sortByTabIndex:function(e){const t=e.length;if(t<2)return e;const o=Math.ceil(t/2),i=this._sortByTabIndex(e.slice(0,o)),r=this._sortByTabIndex(e.slice(o));return this._mergeSortByTabIndex(i,r)},_mergeSortByTabIndex:function(e,t){const o=[];for(;e.length>0&&t.length>0;)this._hasLowerTabOrder(e[0],t[0])?o.push(t.shift()):o.push(e.shift());return o.concat(e,t)},_hasLowerTabOrder:function(e,t){const o=Math.max(e.tabIndex,0),i=Math.max(t.tabIndex,0);return 0===o||0===i?i>o:o>i}};
/**
@license
Copyright (c) 2017 Vaadin Ltd.
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
*/
let overlayContentCounter=0;const overlayContentCache={},createOverlayContent=e=>{const t=overlayContentCache[e]||processOverlayStyles(e);return document.createElement(t)},processOverlayStyles=e=>{overlayContentCounter++;const t=`vaadin-overlay-content-${overlayContentCounter}`,o=document.createElement("template"),i=document.createElement("style");i.textContent=":host { display: block; }"+e,o.content.appendChild(i),window.ShadyCSS&&window.ShadyCSS.prepareTemplate(o,t);const r=class extends HTMLElement{static get is(){return t}constructor(){super(),this.shadowRoot||(this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(document.importNode(o.content,!0)))}connectedCallback(){window.ShadyCSS&&window.ShadyCSS.styleElement(this)}};return customElements.define(r.is,r),overlayContentCache[e]=t,t};class OverlayElement extends(ThemableMixin(DirMixin(PolymerElement))){static get template(){return html$1`
    <style>
      :host {
        z-index: 200;
        position: fixed;

        /*
          Despite of what the names say, <vaadin-overlay> is just a container
          for position/sizing/alignment. The actual overlay is the overlay part.
        */

        /*
          Default position constraints: the entire viewport. Note: themes can
          override this to introduce gaps between the overlay and the viewport.
        */
        top: 0;
        right: 0;
        bottom: var(--vaadin-overlay-viewport-bottom);
        left: 0;

        /* Use flexbox alignment for the overlay part. */
        display: flex;
        flex-direction: column; /* makes dropdowns sizing easier */
        /* Align to center by default. */
        align-items: center;
        justify-content: center;

        /* Allow centering when max-width/max-height applies. */
        margin: auto;

        /* The host is not clickable, only the overlay part is. */
        pointer-events: none;

        /* Remove tap highlight on touch devices. */
        -webkit-tap-highlight-color: transparent;

        /* CSS API for host */
        --vaadin-overlay-viewport-bottom: 0;
      }

      :host([hidden]),
      :host(:not([opened]):not([closing])) {
        display: none !important;
      }

      [part="overlay"] {
        -webkit-overflow-scrolling: touch;
        overflow: auto;
        pointer-events: auto;

        /* Prevent overflowing the host in MSIE 11 */
        max-width: 100%;
        box-sizing: border-box;

        -webkit-tap-highlight-color: initial; /* reenable tap highlight inside */
      }

      [part="backdrop"] {
        z-index: -1;
        content: "";
        background: rgba(0, 0, 0, 0.5);
        position: fixed;
        top: 0;
        left: 0;
        bottom: 0;
        right: 0;
        pointer-events: auto;
      }
    </style>

    <div id="backdrop" part="backdrop" hidden\$="{{!withBackdrop}}"></div>
    <div part="overlay" id="overlay" tabindex="0">
      <div part="content" id="content">
        <slot></slot>
      </div>
    </div>
`}static get is(){return"vaadin-overlay"}static get properties(){return{opened:{type:Boolean,notify:!0,observer:"_openedChanged",reflectToAttribute:!0},owner:Element,renderer:Function,template:{type:Object,notify:!0},instanceProps:{type:Object},content:{type:Object,notify:!0},withBackdrop:{type:Boolean,value:!1,reflectToAttribute:!0},model:Object,modeless:{type:Boolean,value:!1,reflectToAttribute:!0,observer:"_modelessChanged"},hidden:{type:Boolean,reflectToAttribute:!0,observer:"_hiddenChanged"},focusTrap:{type:Boolean,value:!1},restoreFocusOnClose:{type:Boolean,value:!1},_mouseDownInside:{type:Boolean},_mouseUpInside:{type:Boolean},_instance:{type:Object},_originalContentPart:Object,_contentNodes:Array,_oldOwner:Element,_oldModel:Object,_oldTemplate:Object,_oldInstanceProps:Object,_oldRenderer:Object,_oldOpened:Boolean}}static get observers(){return["_templateOrRendererChanged(template, renderer, owner, model, instanceProps, opened)"]}constructor(){super(),this._boundMouseDownListener=this._mouseDownListener.bind(this),this._boundMouseUpListener=this._mouseUpListener.bind(this),this._boundOutsideClickListener=this._outsideClickListener.bind(this),this._boundKeydownListener=this._keydownListener.bind(this),this._observer=new FlattenedNodesObserver(this,(e=>{this._setTemplateFromNodes(e.addedNodes)})),this._boundIronOverlayCanceledListener=this._ironOverlayCanceled.bind(this),/iPad|iPhone|iPod/.test(navigator.userAgent)&&(this._boundIosResizeListener=()=>this._detectIosNavbar())}ready(){super.ready(),this._observer.flush(),this.addEventListener("click",(()=>{})),this.$.backdrop.addEventListener("click",(()=>{}))}_detectIosNavbar(){if(!this.opened)return;const e=window.innerHeight,t=window.innerWidth>e,o=document.documentElement.clientHeight;t&&o>e?this.style.setProperty("--vaadin-overlay-viewport-bottom",o-e+"px"):this.style.setProperty("--vaadin-overlay-viewport-bottom","0")}_setTemplateFromNodes(e){this.template=e.filter((e=>e.localName&&"template"===e.localName))[0]||this.template}close(e){var t=new CustomEvent("vaadin-overlay-close",{bubbles:!0,cancelable:!0,detail:{sourceEvent:e}});this.dispatchEvent(t),t.defaultPrevented||(this.opened=!1)}connectedCallback(){super.connectedCallback(),this._boundIosResizeListener&&(this._detectIosNavbar(),window.addEventListener("resize",this._boundIosResizeListener))}disconnectedCallback(){super.disconnectedCallback(),this._boundIosResizeListener&&window.removeEventListener("resize",this._boundIosResizeListener)}_ironOverlayCanceled(e){e.preventDefault()}_mouseDownListener(e){this._mouseDownInside=e.composedPath().indexOf(this.$.overlay)>=0}_mouseUpListener(e){this._mouseUpInside=e.composedPath().indexOf(this.$.overlay)>=0}_outsideClickListener(e){if(-1!==e.composedPath().indexOf(this.$.overlay)||this._mouseDownInside||this._mouseUpInside)return this._mouseDownInside=!1,void(this._mouseUpInside=!1);if(!this._last)return;const t=new CustomEvent("vaadin-overlay-outside-click",{bubbles:!0,cancelable:!0,detail:{sourceEvent:e}});this.dispatchEvent(t),this.opened&&!t.defaultPrevented&&this.close(e)}_keydownListener(e){if(this._last)if("Tab"===e.key&&this.focusTrap&&!e.defaultPrevented)this._cycleTab(e.shiftKey?-1:1),e.preventDefault();else if("Escape"===e.key||"Esc"===e.key){const t=new CustomEvent("vaadin-overlay-escape-press",{bubbles:!0,cancelable:!0,detail:{sourceEvent:e}});this.dispatchEvent(t),this.opened&&!t.defaultPrevented&&this.close(e)}}_ensureTemplatized(){this._setTemplateFromNodes(Array.from(this.children))}_openedChanged(e,t){this._instance||this._ensureTemplatized(),e?(this.__restoreFocusNode=this._getActiveElement(),this._animatedOpening(),afterNextRender(this,(()=>{this.focusTrap&&!this.contains(document._activeElement||document.activeElement)&&this._cycleTab(0,0);const e=new CustomEvent("vaadin-overlay-open",{bubbles:!0});this.dispatchEvent(e)})),this.modeless||this._addGlobalListeners()):t&&(this._animatedClosing(),this.modeless||this._removeGlobalListeners())}_hiddenChanged(e){e&&this.hasAttribute("closing")&&this._flushAnimation("closing")}_shouldAnimate(){const e=getComputedStyle(this).getPropertyValue("animation-name");return!("none"===getComputedStyle(this).getPropertyValue("display"))&&e&&"none"!=e}_enqueueAnimation(e,t){const o=`__${e}Handler`,i=()=>{t(),this.removeEventListener("animationend",i),delete this[o]};this[o]=i,this.addEventListener("animationend",i)}_flushAnimation(e){const t=`__${e}Handler`;"function"==typeof this[t]&&this[t]()}_animatedOpening(){this.parentNode===document.body&&this.hasAttribute("closing")&&this._flushAnimation("closing"),this._attachOverlay(),this.setAttribute("opening","");const e=()=>{this.removeAttribute("opening"),document.addEventListener("iron-overlay-canceled",this._boundIronOverlayCanceledListener),this.modeless||this._enterModalState()};this._shouldAnimate()?this._enqueueAnimation("opening",e):e()}_attachOverlay(){this._placeholder=document.createComment("vaadin-overlay-placeholder"),this.parentNode.insertBefore(this._placeholder,this),document.body.appendChild(this),this.bringToFront()}_animatedClosing(){if(this.hasAttribute("opening")&&this._flushAnimation("opening"),this._placeholder){this.setAttribute("closing","");const e=()=>{if(this.shadowRoot.querySelector('[part="overlay"]').style.removeProperty("pointer-events"),this._exitModalState(),document.removeEventListener("iron-overlay-canceled",this._boundIronOverlayCanceledListener),this._detachOverlay(),this.removeAttribute("closing"),this.restoreFocusOnClose&&this.__restoreFocusNode){const e=this._getActiveElement();(e===document.body||this._deepContains(e))&&this.__restoreFocusNode.focus(),this.__restoreFocusNode=null}};this._shouldAnimate()?this._enqueueAnimation("closing",e):e()}}_detachOverlay(){this._placeholder.parentNode.insertBefore(this,this._placeholder),this._placeholder.parentNode.removeChild(this._placeholder)}static get __attachedInstances(){return Array.from(document.body.children).filter((e=>e instanceof OverlayElement)).sort(((e,t)=>e.__zIndex-t.__zIndex||0))}get _last(){return this===OverlayElement.__attachedInstances.pop()}_modelessChanged(e){e?(this._removeGlobalListeners(),this._exitModalState()):this.opened&&(this._addGlobalListeners(),this._enterModalState())}_addGlobalListeners(){document.addEventListener("mousedown",this._boundMouseDownListener),document.addEventListener("mouseup",this._boundMouseUpListener),document.documentElement.addEventListener("click",this._boundOutsideClickListener,!0),document.addEventListener("keydown",this._boundKeydownListener)}_enterModalState(){"none"!==document.body.style.pointerEvents&&(this._previousDocumentPointerEvents=document.body.style.pointerEvents,document.body.style.pointerEvents="none"),OverlayElement.__attachedInstances.forEach((e=>{e===this||e.hasAttribute("opening")||e.hasAttribute("closing")||(e.shadowRoot.querySelector('[part="overlay"]').style.pointerEvents="none")}))}_removeGlobalListeners(){document.removeEventListener("mousedown",this._boundMouseDownListener),document.removeEventListener("mouseup",this._boundMouseUpListener),document.documentElement.removeEventListener("click",this._boundOutsideClickListener,!0),document.removeEventListener("keydown",this._boundKeydownListener)}_exitModalState(){void 0!==this._previousDocumentPointerEvents&&(document.body.style.pointerEvents=this._previousDocumentPointerEvents,delete this._previousDocumentPointerEvents);const e=OverlayElement.__attachedInstances;let t;for(;(t=e.pop())&&(t===this||(t.shadowRoot.querySelector('[part="overlay"]').style.removeProperty("pointer-events"),t.modeless)););}_removeOldContent(){this.content&&this._contentNodes&&(this._observer.disconnect(),this._contentNodes.forEach((e=>{e.parentNode===this.content&&this.content.removeChild(e)})),this._originalContentPart&&(this.$.content.parentNode.replaceChild(this._originalContentPart,this.$.content),this.$.content=this._originalContentPart,this._originalContentPart=void 0),this._observer.connect(),this._contentNodes=void 0,this.content=void 0)}_stampOverlayTemplate(e,t){this._removeOldContent(),e._Templatizer||(e._Templatizer=templatize(e,this,{instanceProps:t,forwardHostProp:function(e,t){this._instance&&this._instance.forwardHostProp(e,t)}})),this._instance=new e._Templatizer({}),this._contentNodes=Array.from(this._instance.root.childNodes);const o=e._templateRoot||(e._templateRoot=e.getRootNode());if(o!==document){const e=window.ShadyCSS&&!window.ShadyCSS.nativeShadow;this.$.content.shadowRoot||this.$.content.attachShadow({mode:"open"});let t=Array.from(o.querySelectorAll("style")).reduce(((e,t)=>e+t.textContent),"");if(e){const e=window.ShadyCSS.ScopingShim._styleInfoForNode(o.host);e&&(t+=e._getStyleRules().parsedCssText,t+="}")}if(t=t.replace(/:host/g,":host-nomatch"),t)if(e){const e=createOverlayContent(t);e.id="content",e.setAttribute("part","content"),this.$.content.parentNode.replaceChild(e,this.$.content),e.className=this.$.content.className,this._originalContentPart=this.$.content,this.$.content=e}else{const e=document.createElement("style");e.textContent=t,this.$.content.shadowRoot.appendChild(e),this._contentNodes.unshift(e)}this.$.content.shadowRoot.appendChild(this._instance.root),this.content=this.$.content.shadowRoot}else this.appendChild(this._instance.root),this.content=this}_removeNewRendererOrTemplate(e,t,o,i){e!==t?this.template=void 0:o!==i&&(this.renderer=void 0)}render(){this.renderer&&this.renderer.call(this.owner,this.content,this.owner,this.model)}_templateOrRendererChanged(e,t,o,i,r,s){if(e&&t)throw this._removeNewRendererOrTemplate(e,this._oldTemplate,t,this._oldRenderer),new Error("You should only use either a renderer or a template for overlay content");const n=this._oldOwner!==o||this._oldModel!==i;this._oldModel=i,this._oldOwner=o;const a=this._oldInstanceProps!==r||this._oldTemplate!==e;this._oldInstanceProps=r,this._oldTemplate=e;const l=this._oldRenderer!==t;this._oldRenderer=t;const c=this._oldOpened!==s;if(this._oldOpened=s,e&&a)this._stampOverlayTemplate(e,r);else if(t&&(l||c||n)){if(this.content=this,l)for(;this.content.firstChild;)this.content.removeChild(this.content.firstChild);s&&this.render()}}_isFocused(e){return e&&e.getRootNode().activeElement===e}_focusedIndex(e){return(e=e||this._getFocusableElements()).indexOf(e.filter(this._isFocused).pop())}_cycleTab(e,t){const o=this._getFocusableElements();void 0===t&&(t=this._focusedIndex(o)),(t+=e)>=o.length?t=0:t<0&&(t=o.length-1),o[t].focus()}_getFocusableElements(){return FocusablesHelper.getTabbableNodes(this.$.overlay)}_getActiveElement(){let e=document._activeElement||document.activeElement;for(e&&e!==document.documentElement&&e instanceof Element!=!1||(e=document.body);e.shadowRoot&&e.shadowRoot.activeElement;)e=e.shadowRoot.activeElement;return e}_deepContains(e){if(this.contains(e))return!0;let t=e;const o=e.ownerDocument;for(;t&&t!==o&&t!==this;)t=t.parentNode||t.host;return t===this}bringToFront(){let e="";const t=OverlayElement.__attachedInstances.filter((e=>e!==this)).pop();if(t){e=t.__zIndex+1}this.style.zIndex=e,this.__zIndex=e||parseFloat(getComputedStyle(this).zIndex)}}customElements.define(OverlayElement.is,OverlayElement);const $_documentContainer$6=document.createElement("template");$_documentContainer$6.innerHTML='<dom-module id="lumo-menu-overlay-core">\n  <template>\n    <style>\n      :host([opening]),\n      :host([closing]) {\n        animation: 0.14s lumo-overlay-dummy-animation;\n      }\n\n      [part="overlay"] {\n        will-change: opacity, transform;\n      }\n\n      :host([opening]) [part="overlay"] {\n        animation: 0.1s lumo-menu-overlay-enter ease-out both;\n      }\n\n      @keyframes lumo-menu-overlay-enter {\n        0% {\n          opacity: 0;\n          transform: translateY(-4px);\n        }\n      }\n\n      :host([closing]) [part="overlay"] {\n        animation: 0.1s lumo-menu-overlay-exit both;\n      }\n\n      @keyframes lumo-menu-overlay-exit {\n        100% {\n          opacity: 0;\n        }\n      }\n    </style>\n  </template>\n</dom-module><dom-module id="lumo-menu-overlay">\n  <template>\n    <style include="lumo-overlay lumo-menu-overlay-core">\n      /* Small viewport (bottom sheet) styles */\n      /* Use direct media queries instead of the state attributes (`[phone]` and `[fullscreen]`) provided by the elements */\n      @media (max-width: 420px), (max-height: 420px) {\n        :host {\n          top: 0 !important;\n          right: 0 !important;\n          bottom: var(--vaadin-overlay-viewport-bottom, 0) !important;\n          left: 0 !important;\n          align-items: stretch !important;\n          justify-content: flex-end !important;\n        }\n\n        [part="overlay"] {\n          max-height: 50vh;\n          width: 100vw;\n          border-radius: 0;\n          box-shadow: var(--lumo-box-shadow-xl);\n        }\n\n        /* The content part scrolls instead of the overlay part, because of the gradient fade-out */\n        [part="content"] {\n          padding: 30px var(--lumo-space-m);\n          max-height: inherit;\n          box-sizing: border-box;\n          -webkit-overflow-scrolling: touch;\n          overflow: auto;\n          -webkit-mask-image: linear-gradient(transparent, #000 40px, #000 calc(100% - 40px), transparent);\n          mask-image: linear-gradient(transparent, #000 40px, #000 calc(100% - 40px), transparent);\n        }\n\n        [part="backdrop"] {\n          display: block;\n        }\n\n        /* Animations */\n\n        :host([opening]) [part="overlay"] {\n          animation: 0.2s lumo-mobile-menu-overlay-enter cubic-bezier(.215, .61, .355, 1) both;\n        }\n\n        :host([closing]),\n        :host([closing]) [part="backdrop"] {\n          animation-delay: 0.14s;\n        }\n\n        :host([closing]) [part="overlay"] {\n          animation: 0.14s 0.14s lumo-mobile-menu-overlay-exit cubic-bezier(.55, .055, .675, .19) both;\n        }\n      }\n\n      @keyframes lumo-mobile-menu-overlay-enter {\n        0% {\n          transform: translateY(150%);\n        }\n      }\n\n      @keyframes lumo-mobile-menu-overlay-exit {\n        100% {\n          transform: translateY(150%);\n        }\n      }\n    </style>\n  </template>\n</dom-module>',document.head.appendChild($_documentContainer$6.content);const $_documentContainer$7=html$1`<dom-module id="lumo-combo-box-overlay" theme-for="vaadin-combo-box-overlay">
  <template>
    <style include="lumo-overlay lumo-menu-overlay-core">
      [part="content"] {
        padding: 0;
      }

      :host {
        /* TODO: using a legacy mixin (unsupported) */
        --iron-list-items-container: {
          border-width: var(--lumo-space-xs);
          border-style: solid;
          border-color: transparent;
        };
      }

      /* TODO: workaround ShadyCSS issue when using inside of the dom-if */
      :host([opened]) {
        --iron-list-items-container_-_border-width: var(--lumo-space-xs);
        --iron-list-items-container_-_border-style: solid;
        --iron-list-items-container_-_border-color: transparent;
      }

      /* Loading state */

      /* When items are empty, the sinner needs some room */
      :host(:not([closing])) [part~="content"] {
        min-height: calc(2 * var(--lumo-space-s) + var(--lumo-icon-size-s));
      }

      [part~="overlay"] {
        position: relative;
      }

      :host([loading]) [part~="loader"] {
        box-sizing: border-box;
        width: var(--lumo-icon-size-s);
        height: var(--lumo-icon-size-s);
        position: absolute;
        z-index: 1;
        left: var(--lumo-space-s);
        right: var(--lumo-space-s);
        top: var(--lumo-space-s);
        margin-left: auto;
        margin-inline-start: auto;
        margin-inline-end: 0;
        border: 2px solid transparent;
        border-color:
          var(--lumo-primary-color-50pct)
          var(--lumo-primary-color-50pct)
          var(--lumo-primary-color)
          var(--lumo-primary-color);
        border-radius: calc(0.5 * var(--lumo-icon-size-s));
        opacity: 0;
        animation:
          1s linear infinite lumo-combo-box-loader-rotate,
          .3s .1s lumo-combo-box-loader-fade-in both;
        pointer-events: none;
      }

      @keyframes lumo-combo-box-loader-fade-in {
        0% {
          opacity: 0;
        }

        100% {
          opacity: 1;
        }
      }

      @keyframes lumo-combo-box-loader-rotate {
        0% {
          transform: rotate(0deg);
        }

        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </template>
</dom-module>`;document.head.appendChild($_documentContainer$7.content);const $_documentContainer$8=document.createElement("template");$_documentContainer$8.innerHTML='<custom-style>\n  <style>\n    @font-face {\n      font-family: \'lumo-icons\';\n      src: url(data:application/font-woff;charset=utf-8;base64,d09GRgABAAAAABEgAAsAAAAAIiwAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABCAAAADsAAABUIIslek9TLzIAAAFEAAAAQwAAAFZAIUuKY21hcAAAAYgAAAD4AAADrsCU8d5nbHlmAAACgAAAC2MAABd4h9To2WhlYWQAAA3kAAAAMQAAADYSnCkuaGhlYQAADhgAAAAdAAAAJAbpA35obXR4AAAOOAAAABAAAACspBAAAGxvY2EAAA5IAAAAWAAAAFh55IAsbWF4cAAADqAAAAAfAAAAIAFKAXBuYW1lAAAOwAAAATEAAAIuUUJZCHBvc3QAAA/0AAABKwAAAelm8SzVeJxjYGRgYOBiMGCwY2BycfMJYeDLSSzJY5BiYGGAAJA8MpsxJzM9kYEDxgPKsYBpDiBmg4gCACY7BUgAeJxjYGS+yDiBgZWBgamKaQ8DA0MPhGZ8wGDIyAQUZWBlZsAKAtJcUxgcXjG+0mIO+p/FEMUcxDANKMwIkgMABn8MLQB4nO3SWW6DMABF0UtwCEnIPM/zhLK8LqhfXRybSP14XUYtHV9hGYQwQBNIo3cUIPkhQeM7rib1ekqnXg981XuC1qvy84lzojleh3puxL0hPjGjRU473teloEefAUNGjJkwZcacBUtWrNmwZceeA0dOnLlw5cadB09elPGhGf+j0NTI/65KfXerT6JhqKnpRKtgOpuqaTrtKjPUlqHmhto21I7pL6i6hlqY3q7qGWrfUAeGOjTUkaGODXViqFNDnRnq3FAXhro01JWhrg11Y6hbQ90Z6t5QD4Z6NNSToZ4N9WKoV0O9GerdUB+G+jTUl6GWRvkL24BkEXictVh9bFvVFb/nxvbz+7Rf/N6zHcd2bCfP+Wgc1Z9N0jpNnEL6kbRVS6HA2hQYGh9TGR1CbCqa2rXrWOkQE/sHNJgmtZvoVNZqE1B1DNHxzTQxCehUTYiJTQyENui0qSLezr3PduyQfgmRWOfde8+9551z7rnn/O4jLoJ/bRP0UaKQMLFJjpBAvphLZC3Dk0ok7WBzR2/upJs7Ryw/nfFbln/uuN/apCvwrKLrSvUqRufbm5pn0fs0w4gYxnGVP6qHnO4bWiDQGQgwtS6lm3lB3QoX1M2vwEmuzirF39y+Es2+DJ8d1pkyqBIqoze3D1+Zz4DrFoazxI8dWwMrDlZ2DMqQAR9AROsJU+2cmlTPazTco52F1xTa2a2+K8vvq92dVHmtLoPeQX/AZPRYGthDYOeZjBjKoFsVGulR3lWU95WeCK44qHU7MhWUGUKZDT3oKUcG2GWuh+EDDfUYA/jhAhl0TOsJNYSEu7mQmi3UzfXwZKA4BsVsHLXQYGgRW95uEtpJ1Vfn9XiLriRBlFEqxsDjA09yCNUoQxxwd7KWSTt2y3GTKiflqHRSoWZc3m11Wa/fJdFgXD4sSYfleJBKd8GMz7J8dZn/cGRCcKGDnA2Ge3fKzcvlnTDNthGWLXzX/WaXtUAmRgeLlHSr30r0G9UTXMb0AtmwzOoy73fkSlHZkduw/TYuU9cAD4YutPoxTTsA3797wVr4Z/1NC5zARHr4vtxJjxIfiZMhMkbWk+14BnJZKwqGZwDfswLyxWDSg11rFLJF7Nopxjd1h1/QOT+oezgfu3Yq+Hk+duf5x+40o1GTkaIgikK/IEnC6aYxCUBaZJSN4XTYFjU/YMNIKqJwhDGOCCI8FDXnXmXjtGhGJyShqjAOnBOkW2JG9S7GgYeMWAU5JzhnWmBOaOM+CKEPoqSfFDC2Unq+DLlUgUVUFFLZGJg6jtlojsdsa8kPObPuJdi5dnBdBsLJMGTWDa4t2JvtwuPo9s+Y86suv/W33QG1rAaOAUV+vx4K6f2D04PVKlC7WLSrZzAi45ZV6lIC7WoXqmRyvUqoVwrzUoVsIjeTXWQv+RH5GTlBXiB/In8ln0IbBCAFOajAJrgZYyOHWqOfUe/aHjI12R6OQo1jCgt215l+4f6XPb+0MNou0V+43n2F77tSfRb24d7zitgnKmvYHs69zugaPvBwv6ioXkb2LdL65Atw51uLkXlu1bhMMRcXSPcYoqKIRlh34lQP8/5JbuUFye4vxD6/6MxFF11C0uVLr9Ulgw44tS3pMViNLUExbycFgLIct+QDMibRimx1ydUz8FXZiuOIDBOMVX2nUZc+huNE5XUJ81uiJoiabwqaVF0uacKbau/pl4R2VW0XXlJra6boVrYG646TF5NYzwy4vjENVrDlcNpZPl8DH6XX8XWCx0mvWVZY6KFLrvsY66/zPict5FnxaNUR/juvZCM3TvD60E2W1tZizbXTPDuabcm0nbbzpWKpmA1ayBQ8giedLUM+A0kNjBjQjmuYz7YrgIXYvmF63ZLBwSXrpn9Tb9wwdd/U1H0PMQK3XcO8ul3WT7PyPPdpy0TemKxNRcJNauiXJnnUDpUppQWs4SnUIy0EESGYqJYQLGHxzaGWwVIaS6Y7mQFM8ZjYDQ3axjf61SWjU33JwOZA1pwaG1L9mzf71aHRdX1JHw6Fp0aXhNwbqyeGNg4NbdzGCBxoz4ZXjy4Nu69Zr6sDY6vMrLU5nA1P8JkbdWXJ6ERfMryvNh1JfQ9+T4dIhGvK9w3dxjBBzatsQ/MlOHVIDnYpDz6odAXlQ01t2Pa5Iafd8MMpxAeDKP0C6CjgVLT5osB6icUx01lWjXxzT/GyRF2welEM5Z/7jG3VjQ1SrNn5IbyzOG5dobB3/QHxyZvsXcoz8IoEwS7plCg+zxHQk424q9BfEpkESJbFHQusDBSWFkuBkoPO0kLKwRVYjxGXlHTcTDQMJ/H6TX9afkO7mnraTO1feTnZAXLu4cp7HAXMmNG1yeFk9TgS/NHhZR/4QoBTr/ZB+6hCgyl15Nq1UbN6nE1/ZnP1U2cizCBpvs8cJQZJ4LkYx5N/yZPAUZNQQ0V4f3BQllWrK3YRzl30dOT6RVn2upNur6woSa8CqpdT/aKnBM4o3jNur9d9xqtUT6veBEt9Ca9at+ERzEEhUkR8sa5mQ4aVvJoVeEA8zI4ei5mULXFGyU7z/6TAeYLVcpzSWZY8PYYF5yrTV60sT0+XV141vX++Wf16V2bFeGVPZXxFpkvyeKTWLlzfW0mnKxsY6Y3294/0998SCfX1blm5pbcvFGlq/r07MRAMhYIDiW5JFKWW3vdrEpCsZSJG+om7Zu/PSScZJhNkLbmW5Wsr12pWqW5zKtlwRS4bFOxUw17mCzy6lskCDl1WYOGWDYrADrMA7BDDweWWNd5koiJnR1dz+ytLP2q0SqPB1lnK2ccB7RYe4FSoPks3iB3t4txTSHctb2sy1ivk0pvHuCNm6w1f6wxv3+OCgN78LqdQnUVh7R0oTAp0zOf2rbW770Vu5C2dIyGdTnHo8zSji7dppj0USoVCz+lhRMTh53Teq9VbGfbjuSbAooSdXayY4PYHg374C6f7gl1B/DXuJ4/QXxOBdJFJspFsI3egpoWUUCjlTIFnNYNl+ZyZKmBeYKGHkD1QyDlhaKbKwKcIJqJ4TLJ2OmdY/JWXae4DdGBw8HZ7eXcgFF2zr2SoalDry5iKqoa0Puhe3hPQ2s3elTYM+MI+n3rK0KgL7/La3GeMLt6m7u912vGnvtORiIa0qBmhqVi+XW9XNBmqb8eVgKzIHfGI5bNoG7X0UCzeISmqIcO/nY8FH7U8avX9fx/ST+hx0sezPw9Qy8Mum3GWf2N4Uy/yIYGVBXbJHWIZp7dfTcptdMTr9Qmq7DaiK/ukqCL4kt4RUfS5XPnMtmT22/mQFqF7emSqtrlu8SVElxDRJrZODkpuwe0VfTfjdEp1f7A7v+fozNBXUJ/6WTuK2TtFlpFVZAZ3LcFvUi1Z2p2YT+EMAkGJVStOzLTAPg4IqWIAlzRSjOBkl2zxj3TKycpzT/MnvX3uaSMWM+gU0rkXjohhefVRMaps3/kLMSKv23lT23uxQrkQjyOJleMDsdhAnD6ZGElWZ5MjCXzCE/hkWX+WF4knzGhVOyK2eQZekV3eyo0zL8kuYWCnDCvjjhAkcTPOBDXVdoav3HVcFnQjLvtV9S2p0zA6JegPwMQxt+yFb3ll9zGlq/5dRKb3cEyQYoaNYpharJ7xCB7AWxsLY3jjZXY0XsZj0Wjwc9I6PP/dKABnCZaqHpaZEACxk4ZeLZSKNgZABl+lYQX1sJQOSX3n6r410evcoud5JeAGUXVP9H1tZOKejTq4Ono0z0erro1FrnOpohva1d/hTdtVsQdKN5W9RlT3NjD0nznyKNTgKAMfWNWcyodV0IGLPIHOF0o4JyqufaK4z6WIIzuGh3d8c8cwQg8ER+OVxyrjdm8vNuhts4LoOihGxIMuUdgzwiYN7xhh1+oZnJNuTG7gQZvu4XWZ9GAZZjGEubwePqYhtKDTH+9VQkl17/iGybsnJ+8+sKtyPrcll9ty65Zsdst/9iqpEKh7M5VdBxh3csOdNc6tW3I1uyM1PzOXegSOrLFsFNI2O27M+TF2ApnN9MUv5ud6LjxIvEQnHRzxIu4IsA9MLFkJn2tcZoZ7ON7dXe7ujrc8HrusPKamlqXwd77lQUuLpilau4PUMapueBb7irU4RoUXEYXuVuIGlRGmOp+2lNkaRPVziOqmlaZvaqG4dFgSj0jxEJWrv12IUWntmw+rfQarRE0Aph4ocI6nlUlGqs+u3/+T/ethW62PpHp2eHbZstnh/wOO95yDAHicY2BkYGAAYi2NOJ94fpuvDNzML4AiDNc/fzqEoP+/Zp7KdAvI5WBgAokCAGkcDfgAAAB4nGNgZGBgDvqfBSRfMAAB81QGRgZUoA0AVvYDbwAAAHicY2BgYGB+MTQwAM8EJo8AAAAAAE4AmgDoAQoBLAFOAXABmgHEAe4CGgKcAugEmgS8BNYE8gUOBSoFegXQBf4GRAZmBrYHGAeQCBgIUghqCP4JRgm+CdoKBAo8CoIKuArwC1ALlgu8eJxjYGRgYNBmTGEQZQABJiDmAkIGhv9gPgMAGJQBvAB4nG2RPU7DMBiG3/QP0UoIBGJh8QILavozdmRo9w7d09RpUzlx5LgVvQMn4BAcgoEzcAgOwVvzSZVQbcnf48fvFysJgGt8IcJxROiG9TgauODuj5ukG+EW+UG4jR4ehTv0Q+EunjER7uEWmk+IWpc0d3gVbuAKb8JN+nfhFvlDuI17fAp36L+Fu1jgR7iHp+jF7Arbz1Nb1nO93pnEncSJFtrVuS3VKB6e5EyX2iVer9TyoOr9eux9pjJnCzW1pdfGWFU5u9WpjzfeV5PBIBMfp7aAwQ4FLPrIkbKWqDHn+67pDRK4s4lzbsEux5qHvcIIMb/nueSMyTKkE3jWFdNLHLjW2PPmMa1Hxn3GjGW/wjT0HtOG09JU4WxLk9LH2ISuiv9twJn9y8fh9uIXI+BknAAAAHicbY7ZboMwEEW5CVBCSLrv+76kfJRjTwHFsdGAG+Xvy5JUfehIHp0rnxmNN/D6ir3/a4YBhvARIMQOIowQY4wEE0yxiz3s4wCHOMIxTnCKM5zjApe4wjVucIs73OMBj3jCM17wije84wMzfHqJ0EVmUkmmJo77oOmrHvfIRZbXsTCZplTZldlgb3TYGVHProwFs11t1A57tcON2rErR3PBqcwF1/6ctI6k0GSU4JHMSS6WghdJQ99sTbfuN7QLJ9vQ37dNrgyktnIxlDYLJNuqitpRbYWKFNuyDT6pog6oOYKHtKakeakqKjHXpPwlGRcsC+OqxLIiJpXqoqqDMreG2l5bv9Ri3TRX+c23DZna9WFFgmXuO6Ps1Jm/w6ErW8N3FbHn/QC444j0AA==) format(\'woff\');\n      font-weight: normal;\n      font-style: normal;\n    }\n\n    html {\n      --lumo-icons-align-center: "\\ea01";\n      --lumo-icons-align-left: "\\ea02";\n      --lumo-icons-align-right: "\\ea03";\n      --lumo-icons-angle-down: "\\ea04";\n      --lumo-icons-angle-left: "\\ea05";\n      --lumo-icons-angle-right: "\\ea06";\n      --lumo-icons-angle-up: "\\ea07";\n      --lumo-icons-arrow-down: "\\ea08";\n      --lumo-icons-arrow-left: "\\ea09";\n      --lumo-icons-arrow-right: "\\ea0a";\n      --lumo-icons-arrow-up: "\\ea0b";\n      --lumo-icons-bar-chart: "\\ea0c";\n      --lumo-icons-bell: "\\ea0d";\n      --lumo-icons-calendar: "\\ea0e";\n      --lumo-icons-checkmark: "\\ea0f";\n      --lumo-icons-chevron-down: "\\ea10";\n      --lumo-icons-chevron-left: "\\ea11";\n      --lumo-icons-chevron-right: "\\ea12";\n      --lumo-icons-chevron-up: "\\ea13";\n      --lumo-icons-clock: "\\ea14";\n      --lumo-icons-cog: "\\ea15";\n      --lumo-icons-cross: "\\ea16";\n      --lumo-icons-download: "\\ea17";\n      --lumo-icons-dropdown: "\\ea18";\n      --lumo-icons-edit: "\\ea19";\n      --lumo-icons-error: "\\ea1a";\n      --lumo-icons-eye: "\\ea1b";\n      --lumo-icons-eye-disabled: "\\ea1c";\n      --lumo-icons-menu: "\\ea1d";\n      --lumo-icons-minus: "\\ea1e";\n      --lumo-icons-ordered-list: "\\ea1f";\n      --lumo-icons-phone: "\\ea20";\n      --lumo-icons-photo: "\\ea21";\n      --lumo-icons-play: "\\ea22";\n      --lumo-icons-plus: "\\ea23";\n      --lumo-icons-redo: "\\ea24";\n      --lumo-icons-reload: "\\ea25";\n      --lumo-icons-search: "\\ea26";\n      --lumo-icons-undo: "\\ea27";\n      --lumo-icons-unordered-list: "\\ea28";\n      --lumo-icons-upload: "\\ea29";\n      --lumo-icons-user: "\\ea2a";\n    }\n  </style>\n</custom-style>',document.head.appendChild($_documentContainer$8.content);const $_documentContainer$9=document.createElement("template");$_documentContainer$9.innerHTML="<custom-style>\n  <style>\n    html {\n      --lumo-size-xs: 1.625rem;\n      --lumo-size-s: 1.875rem;\n      --lumo-size-m: 2.25rem;\n      --lumo-size-l: 2.75rem;\n      --lumo-size-xl: 3.5rem;\n\n      /* Icons */\n      --lumo-icon-size-s: 1.25em;\n      --lumo-icon-size-m: 1.5em;\n      --lumo-icon-size-l: 2.25em;\n      /* For backwards compatibility */\n      --lumo-icon-size: var(--lumo-icon-size-m);\n    }\n  </style>\n</custom-style>",document.head.appendChild($_documentContainer$9.content);const $_documentContainer$a=html$1`<dom-module id="lumo-item" theme-for="vaadin-item">
  <template>
    <style>
      :host {
        display: flex;
        align-items: center;
        box-sizing: border-box;
        font-family: var(--lumo-font-family);
        font-size: var(--lumo-font-size-m);
        line-height: var(--lumo-line-height-xs);
        padding: 0.5em 1em;
        min-height: var(--lumo-size-m);
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        -webkit-tap-highlight-color: transparent;
      }

      /* Selectable items have a checkmark icon */
      :host([tabindex])::before {
        display: var(--_lumo-item-selected-icon-display, none);
        content: var(--lumo-icons-checkmark);
        font-family: lumo-icons;
        font-size: var(--lumo-icon-size-m);
        line-height: 1;
        font-weight: normal;
        width: 1em;
        height: 1em;
        margin: calc((1 - var(--lumo-line-height-xs)) * var(--lumo-font-size-m) / 2) 0;
        color: var(--lumo-primary-text-color);
        flex: none;
        opacity: 0;
        transition: transform 0.2s cubic-bezier(.12, .32, .54, 2), opacity 0.1s;
      }

      :host([selected])::before {
        opacity: 1;
      }

      :host([active]:not([selected]))::before {
        transform: scale(0.8);
        opacity: 0;
        transition-duration: 0s;
      }

      [part="content"] {
        flex: auto;
      }

      /* Disabled item */

      :host([disabled]) {
        color: var(--lumo-disabled-text-color);
        cursor: default;
        pointer-events: none;
      }

      /* Slotted icons */

      :host ::slotted(iron-icon) {
        width: var(--lumo-icon-size-m);
        height: var(--lumo-icon-size-m);
      }
    </style>
  </template>
</dom-module>`;document.head.appendChild($_documentContainer$a.content);
/**
@license
Copyright (c) 2017 Vaadin Ltd.
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
*/
const ItemMixin=e=>class extends e{static get properties(){return{_hasVaadinItemMixin:{value:!0},disabled:{type:Boolean,value:!1,observer:"_disabledChanged",reflectToAttribute:!0},selected:{type:Boolean,value:!1,reflectToAttribute:!0,observer:"_selectedChanged"},_value:String}}get value(){return void 0!==this._value?this._value:this.textContent.trim()}set value(e){this._value=e}ready(){super.ready();const e=this.getAttribute("value");null!==e&&(this.value=e),this.addEventListener("focus",(e=>this._setFocused(!0)),!0),this.addEventListener("blur",(e=>this._setFocused(!1)),!0),this.addEventListener("mousedown",(e=>{this._setActive(this._mousedown=!0);const t=()=>{this._setActive(this._mousedown=!1),document.removeEventListener("mouseup",t)};document.addEventListener("mouseup",t)})),this.addEventListener("keydown",(e=>this._onKeydown(e))),this.addEventListener("keyup",(e=>this._onKeyup(e)))}disconnectedCallback(){super.disconnectedCallback(),this.hasAttribute("active")&&this._setFocused(!1)}_selectedChanged(e){this.setAttribute("aria-selected",e)}_disabledChanged(e){e?(this.selected=!1,this.setAttribute("aria-disabled","true"),this.blur()):this.removeAttribute("aria-disabled")}_setFocused(e){e?(this.setAttribute("focused",""),this._mousedown||this.setAttribute("focus-ring","")):(this.removeAttribute("focused"),this.removeAttribute("focus-ring"),this._setActive(!1))}_setActive(e){e?this.setAttribute("active",""):this.removeAttribute("active")}_onKeydown(e){/^( |SpaceBar|Enter)$/.test(e.key)&&!e.defaultPrevented&&(e.preventDefault(),this._setActive(!0))}_onKeyup(e){this.hasAttribute("active")&&(this._setActive(!1),this.click())}}
/**
@license
Copyright (c) 2017 Vaadin Ltd.
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
*/;class ItemElement extends(ItemMixin(ThemableMixin(PolymerElement))){static get template(){return html$1`
    <style>
      :host {
        display: inline-block;
      }

      :host([hidden]) {
        display: none !important;
      }
    </style>
    <div part="content">
      <slot></slot>
    </div>
`}static get is(){return"vaadin-item"}static get version(){return"2.1.1"}constructor(){super(),this.value}}customElements.define(ItemElement.is,ItemElement);const $_documentContainer$b=html$1`<dom-module id="lumo-combo-box-item" theme-for="vaadin-combo-box-item">
  <template>
    <style include="lumo-item">
      /* TODO partly duplicated from vaadin-list-box styles. Should find a way to make it DRY */

      :host {
        cursor: default;
        -webkit-tap-highlight-color: var(--lumo-primary-color-10pct);
        padding-left: calc(var(--lumo-border-radius) / 4);
        padding-right: calc(var(--lumo-space-l) + var(--lumo-border-radius) / 4);
        transition: background-color 100ms;
        border-radius: var(--lumo-border-radius);
        overflow: hidden;
        --_lumo-item-selected-icon-display: block;
      }

      /* ShadyCSS workaround (show the selected item checkmark) */
      :host::before {
        display: block;
      }

      :host(:hover) {
        background-color: var(--lumo-primary-color-10pct);
      }

      :host([focused]:not([disabled])) {
        box-shadow: inset 0 0 0 2px var(--lumo-primary-color-50pct);
      }

      @media (pointer: coarse) {
        :host(:hover) {
          background-color: transparent;
        }

        :host([focused]:not([disabled])) {
          box-shadow: none;
        }
      }
    </style>
  </template>
</dom-module>`;document.head.appendChild($_documentContainer$b.content);const $_documentContainer$c=document.createElement("template");$_documentContainer$c.innerHTML='<dom-module id="lumo-field-button">\n  <template>\n    <style>\n      [part$="button"] {\n        flex: none;\n        width: 1em;\n        height: 1em;\n        line-height: 1;\n        font-size: var(--lumo-icon-size-m);\n        text-align: center;\n        color: var(--lumo-contrast-60pct);\n        transition: 0.2s color;\n        cursor: var(--lumo-clickable-cursor);\n      }\n\n      :host(:not([readonly])) [part$="button"]:hover {\n        color: var(--lumo-contrast-90pct);\n      }\n\n      :host([disabled]) [part$="button"],\n      :host([readonly]) [part$="button"] {\n        color: var(--lumo-contrast-20pct);\n      }\n\n      [part$="button"]::before {\n        font-family: "lumo-icons";\n        display: block;\n      }\n    </style>\n  </template>\n</dom-module>',document.head.appendChild($_documentContainer$c.content);const $_documentContainer$d=document.createElement("template");$_documentContainer$d.innerHTML='<dom-module id="lumo-required-field">\n  <template>\n    <style>\n      [part="label"] {\n        align-self: flex-start;\n        color: var(--lumo-secondary-text-color);\n        font-weight: 500;\n        font-size: var(--lumo-font-size-s);\n        margin-left: calc(var(--lumo-border-radius-m) / 4);\n        transition: color 0.2s;\n        line-height: 1;\n        padding-bottom: 0.5em;\n        overflow: hidden;\n        white-space: nowrap;\n        text-overflow: ellipsis;\n        position: relative;\n        max-width: 100%;\n        box-sizing: border-box;\n      }\n\n      :host([has-label])::before {\n        margin-top: calc(var(--lumo-font-size-s) * 1.5);\n      }\n\n      :host([has-label]) {\n        padding-top: var(--lumo-space-m);\n      }\n\n      :host([required]) [part="label"] {\n        padding-right: 1em;\n      }\n\n      [part="label"]::after {\n        content: var(--lumo-required-field-indicator, "");\n        transition: opacity 0.2s;\n        opacity: 0;\n        color: var(--lumo-primary-text-color);\n        position: absolute;\n        right: 0;\n        width: 1em;\n        text-align: center;\n      }\n\n      :host([required]:not([has-value])) [part="label"]::after {\n        opacity: 1;\n      }\n\n      :host([invalid]) [part="label"]::after {\n        color: var(--lumo-error-text-color);\n      }\n\n      [part="error-message"] {\n        margin-left: calc(var(--lumo-border-radius-m) / 4);\n        font-size: var(--lumo-font-size-xs);\n        line-height: var(--lumo-line-height-xs);\n        color: var(--lumo-error-text-color);\n        will-change: max-height;\n        transition: 0.4s max-height;\n        max-height: 5em;\n      }\n\n      /* Margin that doesnt reserve space when theres no error message */\n      [part="error-message"]:not(:empty)::before,\n      [part="error-message"]:not(:empty)::after {\n        content: "";\n        display: block;\n        height: 0.4em;\n      }\n\n      :host(:not([invalid])) [part="error-message"] {\n        max-height: 0;\n        overflow: hidden;\n      }\n\n      /* RTL specific styles */\n\n      :host([dir="rtl"]) [part="label"] {\n        margin-left: 0;\n        margin-right: calc(var(--lumo-border-radius-m) / 4);\n      }\n\n      :host([required][dir="rtl"]) [part="label"] {\n        padding-left: 1em;\n        padding-right: 0;\n      }\n\n      :host([dir="rtl"]) [part="label"]::after {\n        right: auto;\n        left: 0;\n      }\n\n      :host([dir="rtl"]) [part="error-message"] {\n        margin-left: 0;\n        margin-right: calc(var(--lumo-border-radius-m) / 4);\n      }\n\n    </style>\n  </template>\n</dom-module>',document.head.appendChild($_documentContainer$d.content);const $_documentContainer$e=html$1`<dom-module id="lumo-text-field" theme-for="vaadin-text-field">
  <template>
    <style include="lumo-required-field lumo-field-button">
      :host {
        --lumo-text-field-size: var(--lumo-size-m);
        color: var(--lumo-body-text-color);
        font-size: var(--lumo-font-size-m);
        font-family: var(--lumo-font-family);
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        -webkit-tap-highlight-color: transparent;
        padding: var(--lumo-space-xs) 0;
      }

      :host::before {
        height: var(--lumo-text-field-size);
        box-sizing: border-box;
        display: inline-flex;
        align-items: center;
      }

      :host([focused]:not([readonly])) [part="label"] {
        color: var(--lumo-primary-text-color);
      }

      [part="value"],
      [part="input-field"] ::slotted(input),
      [part="input-field"] ::slotted(textarea),
      /* Slotted by vaadin-select-text-field */
      [part="input-field"] ::slotted([part="value"]) {
        cursor: inherit;
        min-height: var(--lumo-text-field-size);
        padding: 0 0.25em;
        --_lumo-text-field-overflow-mask-image: linear-gradient(to left, transparent, #000 1.25em);
        -webkit-mask-image: var(--_lumo-text-field-overflow-mask-image);
      }

      [part="value"]:focus,
      :host([focused]) [part="input-field"] ::slotted(input),
      :host([focused]) [part="input-field"] ::slotted(textarea) {
        -webkit-mask-image: none;
        mask-image: none;
      }

      /*
        TODO: CSS custom property in \`mask-image\` causes crash in Edge
        see https://developer.microsoft.com/en-us/microsoft-edge/platform/issues/15415089/
      */
      @-moz-document url-prefix() {
        [part="value"],
        [part="input-field"] ::slotted(input),
        [part="input-field"] ::slotted(textarea),
        [part="input-field"] ::slotted([part="value"]) {
          mask-image: var(--_lumo-text-field-overflow-mask-image);
        }
      }

      [part="value"]::-webkit-input-placeholder {
        color: inherit;
        transition: opacity 0.175s 0.05s;
        opacity: 0.5;
      }

      [part="value"]:-ms-input-placeholder {
        color: inherit;
        opacity: 0.5;
      }

      [part="value"]::-moz-placeholder {
        color: inherit;
        transition: opacity 0.175s 0.05s;
        opacity: 0.5;
      }

      [part="value"]::placeholder {
        color: inherit;
        transition: opacity 0.175s 0.1s;
        opacity: 0.5;
      }

      [part="input-field"] {
        border-radius: var(--lumo-border-radius);
        background-color: var(--lumo-contrast-10pct);
        padding: 0 calc(0.375em + var(--lumo-border-radius) / 4 - 1px);
        font-weight: 500;
        line-height: 1;
        position: relative;
        cursor: text;
        box-sizing: border-box;
      }

      /* Used for hover and activation effects */
      [part="input-field"]::after {
        content: "";
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        border-radius: inherit;
        pointer-events: none;
        background-color: var(--lumo-contrast-50pct);
        opacity: 0;
        transition: transform 0.15s, opacity 0.2s;
        transform-origin: 100% 0;
      }

      /* Hover */

      :host(:hover:not([readonly]):not([focused])) [part="label"] {
        color: var(--lumo-body-text-color);
      }

      :host(:hover:not([readonly]):not([focused])) [part="input-field"]::after {
        opacity: 0.1;
      }

      /* Touch device adjustment */
      @media (pointer: coarse) {
        :host(:hover:not([readonly]):not([focused])) [part="label"] {
          color: var(--lumo-secondary-text-color);
        }

        :host(:hover:not([readonly]):not([focused])) [part="input-field"]::after {
          opacity: 0;
        }

        :host(:active:not([readonly]):not([focused])) [part="input-field"]::after {
          opacity: 0.2;
        }
      }

      /* Trigger when not focusing using the keyboard */
      :host([focused]:not([focus-ring]):not([readonly])) [part="input-field"]::after {
        transform: scaleX(0);
        transition-duration: 0.15s, 1s;
      }

      /* Focus-ring */

      :host([focus-ring]) [part="input-field"] {
        box-shadow: 0 0 0 2px var(--lumo-primary-color-50pct);
      }

      /* Read-only and disabled */
      :host([readonly]) [part="value"]::-webkit-input-placeholder,
      :host([disabled]) [part="value"]::-webkit-input-placeholder {
        opacity: 0;
      }

      :host([readonly]) [part="value"]:-ms-input-placeholder,
      :host([disabled]) [part="value"]:-ms-input-placeholder {
        opacity: 0;
      }

      :host([readonly]) [part="value"]::-moz-placeholder,
      :host([disabled]) [part="value"]::-moz-placeholder {
        opacity: 0;
      }

      :host([readonly]) [part="value"]::placeholder,
      :host([disabled]) [part="value"]::placeholder {
        opacity: 0;
      }

      /* Read-only */

      :host([readonly]) [part="input-field"] {
        color: var(--lumo-secondary-text-color);
        background-color: transparent;
        cursor: default;
      }

      :host([readonly]) [part="input-field"]::after {
        background-color: transparent;
        opacity: 1;
        border: 1px dashed var(--lumo-contrast-30pct);
      }

      /* Disabled style */

      :host([disabled]) {
        pointer-events: none;
      }

      :host([disabled]) [part="input-field"] {
        background-color: var(--lumo-contrast-5pct);
      }

      :host([disabled]) [part="label"],
      :host([disabled]) [part="value"],
      :host([disabled]) [part="input-field"] ::slotted(*) {
        color: var(--lumo-disabled-text-color);
        -webkit-text-fill-color: var(--lumo-disabled-text-color);
      }

      /* Invalid style */

      :host([invalid]) [part="input-field"] {
        background-color: var(--lumo-error-color-10pct);
      }

      :host([invalid]) [part="input-field"]::after {
        background-color: var(--lumo-error-color-50pct);
      }

      :host([invalid][focus-ring]) [part="input-field"] {
        box-shadow: 0 0 0 2px var(--lumo-error-color-50pct);
      }

      :host([input-prevented]) [part="input-field"] {
        color: var(--lumo-error-text-color);
      }

      /* Small theme */

      :host([theme~="small"]) {
        font-size: var(--lumo-font-size-s);
        --lumo-text-field-size: var(--lumo-size-s);
      }

      :host([theme~="small"][has-label]) [part="label"] {
        font-size: var(--lumo-font-size-xs);
      }

      :host([theme~="small"][has-label]) [part="error-message"] {
        font-size: var(--lumo-font-size-xxs);
      }

      /* Text align */

      :host([theme~="align-center"]) [part="value"] {
        text-align: center;
        --_lumo-text-field-overflow-mask-image: none;
      }

      :host([theme~="align-right"]) [part="value"] {
        text-align: right;
        --_lumo-text-field-overflow-mask-image: none;
      }

      @-moz-document url-prefix() {
        /* Firefox is smart enough to align overflowing text to right */
        :host([theme~="align-right"]) [part="value"] {
          --_lumo-text-field-overflow-mask-image: linear-gradient(to right, transparent 0.25em, #000 1.5em);
        }
      }

      /* Slotted content */

      [part="input-field"] ::slotted(:not([part]):not(iron-icon):not(input):not(textarea)) {
        color: var(--lumo-secondary-text-color);
        font-weight: 400;
      }

      /* Slotted icons */

      [part="input-field"] ::slotted(iron-icon) {
        color: var(--lumo-contrast-60pct);
        width: var(--lumo-icon-size-m);
        height: var(--lumo-icon-size-m);
      }

      /* Vaadin icons are based on a 16x16 grid (unlike Lumo and Material icons with 24x24), so they look too big by default */
      [part="input-field"] ::slotted(iron-icon[icon^="vaadin:"]) {
        padding: 0.25em;
        box-sizing: border-box !important;
      }

      [part="clear-button"]::before {
        content: var(--lumo-icons-cross);
      }
    </style>
  </template>
</dom-module>`;document.head.appendChild($_documentContainer$e.content);
/**
@license
Copyright (c) 2017 Vaadin Ltd.
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
*/
const TabIndexMixin=e=>class extends e{static get properties(){var e={tabindex:{type:Number,value:0,reflectToAttribute:!0,observer:"_tabindexChanged"}};return window.ShadyDOM&&(e.tabIndex=e.tabindex),e}},ControlStateMixin=e=>class extends(TabIndexMixin(e)){static get properties(){return{autofocus:{type:Boolean},_previousTabIndex:{type:Number},disabled:{type:Boolean,observer:"_disabledChanged",reflectToAttribute:!0},_isShiftTabbing:{type:Boolean}}}ready(){this.addEventListener("focusin",(e=>{e.composedPath()[0]===this?this._focus(e):-1===e.composedPath().indexOf(this.focusElement)||this.disabled||this._setFocused(!0)})),this.addEventListener("focusout",(e=>this._setFocused(!1))),super.ready();const e=e=>{e.composed||e.target.dispatchEvent(new CustomEvent(e.type,{bubbles:!0,composed:!0,cancelable:!1}))};this.shadowRoot.addEventListener("focusin",e),this.shadowRoot.addEventListener("focusout",e),this.addEventListener("keydown",(e=>{if(!e.defaultPrevented&&9===e.keyCode)if(e.shiftKey)this._isShiftTabbing=!0,HTMLElement.prototype.focus.apply(this),this._setFocused(!1),setTimeout((()=>this._isShiftTabbing=!1),0);else{const e=window.navigator.userAgent.match(/Firefox\/(\d\d\.\d)/);if(e&&parseFloat(e[1])>=63&&parseFloat(e[1])<66&&this.parentNode&&this.nextSibling){const e=document.createElement("input");e.style.position="absolute",e.style.opacity=0,e.tabIndex=this.tabIndex,this.parentNode.insertBefore(e,this.nextSibling),e.focus(),e.addEventListener("focusout",(()=>this.parentNode.removeChild(e)))}}})),!this.autofocus||this.focused||this.disabled||window.requestAnimationFrame((()=>{this._focus(),this._setFocused(!0),this.setAttribute("focus-ring","")})),this._boundKeydownListener=this._bodyKeydownListener.bind(this),this._boundKeyupListener=this._bodyKeyupListener.bind(this)}connectedCallback(){super.connectedCallback(),document.body.addEventListener("keydown",this._boundKeydownListener,!0),document.body.addEventListener("keyup",this._boundKeyupListener,!0)}disconnectedCallback(){super.disconnectedCallback(),document.body.removeEventListener("keydown",this._boundKeydownListener,!0),document.body.removeEventListener("keyup",this._boundKeyupListener,!0),this.hasAttribute("focused")&&this._setFocused(!1)}_setFocused(e){e?this.setAttribute("focused",""):this.removeAttribute("focused"),e&&this._tabPressed?this.setAttribute("focus-ring",""):this.removeAttribute("focus-ring")}_bodyKeydownListener(e){this._tabPressed=9===e.keyCode}_bodyKeyupListener(){this._tabPressed=!1}get focusElement(){return window.console.warn(`Please implement the 'focusElement' property in <${this.localName}>`),this}_focus(e){this._isShiftTabbing||(this.focusElement.focus(),this._setFocused(!0))}focus(){this.focusElement&&!this.disabled&&(this.focusElement.focus(),this._setFocused(!0))}blur(){this.focusElement.blur(),this._setFocused(!1)}_disabledChanged(e){this.focusElement.disabled=e,e?(this.blur(),this._previousTabIndex=this.tabindex,this.tabindex=-1,this.setAttribute("aria-disabled","true")):(void 0!==this._previousTabIndex&&(this.tabindex=this._previousTabIndex),this.removeAttribute("aria-disabled"))}_tabindexChanged(e){void 0!==e&&(this.focusElement.tabIndex=e),this.disabled&&this.tabindex&&(-1!==this.tabindex&&(this._previousTabIndex=this.tabindex),this.tabindex=e=void 0),window.ShadyDOM&&this.setProperties({tabIndex:e,tabindex:e})}click(){this.disabled||super.click()}}
/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/;class Debouncer{constructor(){this._asyncModule=null,this._callback=null,this._timer=null}setConfig(e,t){this._asyncModule=e,this._callback=t,this._timer=this._asyncModule.run((()=>{this._timer=null,debouncerQueue.delete(this),this._callback()}))}cancel(){this.isActive()&&(this._cancelAsync(),debouncerQueue.delete(this))}_cancelAsync(){this.isActive()&&(this._asyncModule.cancel(this._timer),this._timer=null)}flush(){this.isActive()&&(this.cancel(),this._callback())}isActive(){return null!=this._timer}static debounce(e,t,o){return e instanceof Debouncer?e._cancelAsync():e=new Debouncer,e.setConfig(t,o),e}}let debouncerQueue=new Set;const enqueueDebouncer=function(e){debouncerQueue.add(e)},flushDebouncers=function(){const e=Boolean(debouncerQueue.size);return debouncerQueue.forEach((e=>{try{e.flush()}catch(e){setTimeout((()=>{throw e}))}})),e},$_documentContainer$f=document.createElement("template");$_documentContainer$f.innerHTML='<dom-module id="vaadin-text-field-shared-styles">\n  <template>\n    <style>\n      :host {\n        display: inline-flex;\n        outline: none;\n      }\n\n      :host::before {\n        content: "\\2003";\n        width: 0;\n        display: inline-block;\n        /* Size and position this element on the same vertical position as the input-field element\n           to make vertical align for the host element work as expected */\n      }\n\n      :host([hidden]) {\n        display: none !important;\n      }\n\n      .vaadin-text-field-container,\n      .vaadin-text-area-container {\n        display: flex;\n        flex-direction: column;\n        min-width: 100%;\n        max-width: 100%;\n        width: var(--vaadin-text-field-default-width, 12em);\n      }\n\n      [part="label"]:empty {\n        display: none;\n      }\n\n      [part="input-field"] {\n        display: flex;\n        align-items: center;\n        flex: auto;\n      }\n\n      .vaadin-text-field-container [part="input-field"] {\n        flex-grow: 0;\n      }\n\n      /* Reset the native input styles */\n      [part="value"],\n      [part="input-field"] ::slotted(input),\n      [part="input-field"] ::slotted(textarea) {\n        -webkit-appearance: none;\n        -moz-appearance: none;\n        outline: none;\n        margin: 0;\n        padding: 0;\n        border: 0;\n        border-radius: 0;\n        min-width: 0;\n        font: inherit;\n        font-size: 1em;\n        line-height: normal;\n        color: inherit;\n        background-color: transparent;\n        /* Disable default invalid style in Firefox */\n        box-shadow: none;\n      }\n\n      [part="input-field"] ::slotted(*) {\n        flex: none;\n      }\n\n      [part="value"],\n      [part="input-field"] ::slotted(input),\n      [part="input-field"] ::slotted(textarea),\n      /* Slotted by vaadin-select-text-field */\n      [part="input-field"] ::slotted([part="value"]) {\n        flex: auto;\n        white-space: nowrap;\n        overflow: hidden;\n        width: 100%;\n        height: 100%;\n      }\n\n      [part="input-field"] ::slotted(textarea) {\n        resize: none;\n      }\n\n      [part="value"]::-ms-clear,\n      [part="input-field"] ::slotted(input)::-ms-clear {\n        display: none;\n      }\n\n      [part="clear-button"] {\n        cursor: default;\n      }\n\n      [part="clear-button"]::before {\n        content: "";\n      }\n    </style>\n  </template>\n</dom-module>',document.head.appendChild($_documentContainer$f.content);const HOST_PROPS={default:["list","autofocus","pattern","autocapitalize","autocorrect","maxlength","minlength","name","placeholder","autocomplete","title"],accessible:["disabled","readonly","required","invalid"]},PROP_TYPE={DEFAULT:"default",ACCESSIBLE:"accessible"},TextFieldMixin=e=>class extends(ControlStateMixin(e)){static get properties(){return{autocomplete:{type:String},autocorrect:{type:String},autocapitalize:{type:String},autoselect:{type:Boolean,value:!1},clearButtonVisible:{type:Boolean,value:!1},errorMessage:{type:String,value:""},i18n:{type:Object,value:()=>({clear:"Clear"})},label:{type:String,value:"",observer:"_labelChanged"},maxlength:{type:Number},minlength:{type:Number},name:{type:String},placeholder:{type:String},readonly:{type:Boolean,reflectToAttribute:!0},required:{type:Boolean,reflectToAttribute:!0},value:{type:String,value:"",observer:"_valueChanged",notify:!0},invalid:{type:Boolean,reflectToAttribute:!0,notify:!0,value:!1},hasValue:{type:Boolean,reflectToAttribute:!0},preventInvalidInput:{type:Boolean},_enabledCharPattern:String,_labelId:String,_errorId:String,_inputId:String}}static get observers(){return["_stateChanged(disabled, readonly, clearButtonVisible, hasValue)","_hostPropsChanged("+HOST_PROPS.default.join(", ")+")","_hostAccessiblePropsChanged("+HOST_PROPS.accessible.join(", ")+")","_getActiveErrorId(invalid, errorMessage, _errorId)","_getActiveLabelId(label, _labelId, _inputId)","__observeOffsetHeight(errorMessage, invalid, label)","__enabledCharPatternChanged(_enabledCharPattern)"]}get focusElement(){if(!this.shadowRoot)return;const e=this.querySelector(`${this._slottedTagName}[slot="${this._slottedTagName}"]`);return e||this.shadowRoot.querySelector('[part="value"]')}get inputElement(){return this.focusElement}get _slottedTagName(){return"input"}_createConstraintsObserver(){this._createMethodObserver("_constraintsChanged(required, minlength, maxlength, pattern)")}_onInput(e){if(this.__preventInput)return e.stopImmediatePropagation(),void(this.__preventInput=!1);if(this.preventInvalidInput){const e=this.inputElement;if(e.value.length>0&&!this.checkValidity())return e.value=this.value||"",this.setAttribute("input-prevented",""),void(this._inputDebouncer=Debouncer.debounce(this._inputDebouncer,timeOut.after(200),(()=>{this.removeAttribute("input-prevented")})))}e.__fromClearButton||(this.__userInput=!0),this.value=e.target.value}_stateChanged(e,t,o,i){!e&&!t&&o&&i?this.$.clearButton.removeAttribute("hidden"):this.$.clearButton.setAttribute("hidden",!0)}_onChange(e){if(this._valueClearing)return;const t=new CustomEvent("change",{detail:{sourceEvent:e},bubbles:e.bubbles,cancelable:e.cancelable});this.dispatchEvent(t)}_valueChanged(e,t){""===e&&void 0===t||(this.hasValue=""!==e&&null!=e,this.__userInput?this.__userInput=!1:(void 0!==e?this.inputElement.value=e:this.value=this.inputElement.value="",this.invalid&&this.validate()))}_labelChanged(e){""!==e&&null!=e?this.setAttribute("has-label",""):this.removeAttribute("has-label")}_onSlotChange(){const e=this.querySelector(`${this._slottedTagName}[slot="${this._slottedTagName}"]`);this.value&&(this.inputElement.value=this.value,this.validate()),e&&!this._slottedInput?(this._validateSlottedValue(e),this._addInputListeners(e),this._addIEListeners(e),this._slottedInput=e):!e&&this._slottedInput&&(this._removeInputListeners(this._slottedInput),this._removeIEListeners(this._slottedInput),this._slottedInput=void 0),Object.keys(PROP_TYPE).map((e=>PROP_TYPE[e])).forEach((e=>this._propagateHostAttributes(HOST_PROPS[e].map((e=>this[e])),e)))}_hostPropsChanged(...e){this._propagateHostAttributes(e,PROP_TYPE.DEFAULT)}_hostAccessiblePropsChanged(...e){this._propagateHostAttributes(e,PROP_TYPE.ACCESSIBLE)}_validateSlottedValue(e){e.value!==this.value&&(console.warn("Please define value on the vaadin-text-field component!"),e.value="")}_propagateHostAttributes(e,t){const o=this.inputElement,i=HOST_PROPS[t];"accessible"===t?i.forEach(((t,i)=>{this._setOrToggleAttribute(t,e[i],o),this._setOrToggleAttribute(`aria-${t}`,e[i],o)})):i.forEach(((t,i)=>{this._setOrToggleAttribute(t,e[i],o)}))}_setOrToggleAttribute(e,t,o){e&&o&&(t?o.setAttribute(e,"boolean"==typeof t?"":t):o.removeAttribute(e))}_constraintsChanged(e,t,o,i){this.invalid&&(e||t||o||i?this.validate():this.invalid=!1)}checkValidity(){return this.required||this.pattern||this.maxlength||this.minlength||this.__forceCheckValidity?this.inputElement.checkValidity():!this.invalid}_addInputListeners(e){e.addEventListener("input",this._boundOnInput),e.addEventListener("change",this._boundOnChange),e.addEventListener("blur",this._boundOnBlur),e.addEventListener("focus",this._boundOnFocus),e.addEventListener("paste",this._boundOnPaste),e.addEventListener("drop",this._boundOnDrop),e.addEventListener("beforeinput",this._boundOnBeforeInput)}_removeInputListeners(e){e.removeEventListener("input",this._boundOnInput),e.removeEventListener("change",this._boundOnChange),e.removeEventListener("blur",this._boundOnBlur),e.removeEventListener("focus",this._boundOnFocus),e.removeEventListener("paste",this._boundOnPaste),e.removeEventListener("drop",this._boundOnDrop),e.removeEventListener("beforeinput",this._boundOnBeforeInput)}ready(){super.ready(),this._createConstraintsObserver(),this._boundOnInput=this._onInput.bind(this),this._boundOnChange=this._onChange.bind(this),this._boundOnBlur=this._onBlur.bind(this),this._boundOnFocus=this._onFocus.bind(this),this._boundOnPaste=this._onPaste.bind(this),this._boundOnDrop=this._onDrop.bind(this),this._boundOnBeforeInput=this._onBeforeInput.bind(this);const e=this.shadowRoot.querySelector('[part="value"]');this._slottedInput=this.querySelector(`${this._slottedTagName}[slot="${this._slottedTagName}"]`),this._addInputListeners(e),this._addIEListeners(e),this._slottedInput&&(this._addIEListeners(this._slottedInput),this._addInputListeners(this._slottedInput)),this.shadowRoot.querySelector('[name="input"], [name="textarea"]').addEventListener("slotchange",this._onSlotChange.bind(this)),window.ShadyCSS&&window.ShadyCSS.nativeCss||this.updateStyles(),this.$.clearButton.addEventListener("mousedown",(()=>this._valueClearing=!0)),this.$.clearButton.addEventListener("mouseleave",(()=>this._valueClearing=!1)),this.$.clearButton.addEventListener("click",this._onClearButtonClick.bind(this)),this.addEventListener("keydown",this._onKeyDown.bind(this));var t=TextFieldMixin._uniqueId=1+TextFieldMixin._uniqueId||0;this._errorId=`${this.constructor.is}-error-${t}`,this._labelId=`${this.constructor.is}-label-${t}`,this._inputId=`${this.constructor.is}-input-${t}`,this.shadowRoot.querySelector('[part="error-message"]').addEventListener("transitionend",(()=>{this.__observeOffsetHeight()}))}validate(){return!(this.invalid=!this.checkValidity())}clear(){this.value=""}_onBlur(){this.validate()}_onFocus(){this.autoselect&&(this.inputElement.select(),setTimeout((()=>{try{this.inputElement.setSelectionRange(0,9999)}catch(e){}})))}_onClearButtonClick(e){e.preventDefault(),this.inputElement.focus(),this.clear(),this._valueClearing=!1,navigator.userAgent.match(/Trident/)&&(this.__preventInput=!1);const t=new Event("input",{bubbles:!0,composed:!0});t.__fromClearButton=!0;const o=new Event("change",{bubbles:!this._slottedInput});o.__fromClearButton=!0,this.inputElement.dispatchEvent(t),this.inputElement.dispatchEvent(o)}_onKeyDown(e){if(27===e.keyCode&&this.clearButtonVisible){const e=!!this.value;this.clear(),e&&this.inputElement.dispatchEvent(new Event("change",{bubbles:!this._slottedInput}))}this._enabledCharPattern&&!this.__shouldAcceptKey(e)&&e.preventDefault()}__shouldAcceptKey(e){return e.metaKey||e.ctrlKey||!e.key||1!==e.key.length||this.__enabledCharRegExp.test(e.key)}_onPaste(e){if(this._enabledCharPattern){const t=(e.clipboardData||window.clipboardData).getData("text");this.__enabledTextRegExp.test(t)||e.preventDefault()}}_onDrop(e){if(this._enabledCharPattern){const t=e.dataTransfer.getData("text");this.__enabledTextRegExp.test(t)||e.preventDefault()}}_onBeforeInput(e){this._enabledCharPattern&&e.data&&!this.__enabledTextRegExp.test(e.data)&&e.preventDefault()}__enabledCharPatternChanged(e){this.__enabledCharRegExp=e&&new RegExp("^"+e+"$"),this.__enabledTextRegExp=e&&new RegExp("^"+e+"*$")}_addIEListeners(e){navigator.userAgent.match(/Trident/)&&(this._shouldPreventInput=()=>{this.__preventInput=!0,requestAnimationFrame((()=>{this.__preventInput=!1}))},e.addEventListener("focusin",this._shouldPreventInput),e.addEventListener("focusout",this._shouldPreventInput),this._createPropertyObserver("placeholder",this._shouldPreventInput))}_removeIEListeners(e){navigator.userAgent.match(/Trident/)&&(e.removeEventListener("focusin",this._shouldPreventInput),e.removeEventListener("focusout",this._shouldPreventInput))}_getActiveErrorId(e,t,o){this._setOrToggleAttribute("aria-describedby",t&&e?o:void 0,this.focusElement)}_getActiveLabelId(e,t,o){let i=o;e&&(i=`${t} ${o}`),this.focusElement.setAttribute("aria-labelledby",i)}_getErrorMessageAriaHidden(e,t,o){return(!(t&&e?o:void 0)).toString()}_dispatchIronResizeEventIfNeeded(e,t){const o="__previous"+e;void 0!==this[o]&&this[o]!==t&&this.dispatchEvent(new CustomEvent("iron-resize",{bubbles:!0})),this[o]=t}__observeOffsetHeight(){this._dispatchIronResizeEventIfNeeded("Height",this.offsetHeight)}attributeChangedCallback(e,t,o){super.attributeChangedCallback(e,t,o),window.ShadyCSS&&window.ShadyCSS.nativeCss||!/^(focused|focus-ring|invalid|disabled|placeholder|has-value)$/.test(e)||this.updateStyles();if(/^((?!chrome|android).)*safari/i.test(navigator.userAgent)&&this.root){const e="-webkit-backface-visibility";this.root.querySelectorAll("*").forEach((t=>{t.style[e]="visible",t.style[e]=""}))}}}
/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/,flush=function(){let e,t;do{e=window.ShadyDOM&&ShadyDOM.flush(),window.ShadyCSS&&window.ShadyCSS.ScopingShim&&window.ShadyCSS.ScopingShim.flush(),t=flushDebouncers()}while(e||t)};let statsJob;window.Vaadin||(window.Vaadin={}),window.Vaadin.registrations=window.Vaadin.registrations||[],window.Vaadin.developmentModeCallback=window.Vaadin.developmentModeCallback||{},window.Vaadin.developmentModeCallback["vaadin-usage-statistics"]=function(){};const registered=new Set,ElementMixin$1=e=>class extends(DirMixin(e)){static finalize(){super.finalize();const{is:e}=this;e&&!registered.has(e)&&(window.Vaadin.registrations.push(this),registered.add(e),window.Vaadin.developmentModeCallback&&(statsJob=Debouncer.debounce(statsJob,idlePeriod,(()=>{window.Vaadin.developmentModeCallback["vaadin-usage-statistics"]()})),enqueueDebouncer(statsJob)))}constructor(){super(),null===document.doctype&&console.warn('Vaadin components require the "standards mode" declaration. Please add <!DOCTYPE html> to the HTML document.')}}
/**
@license
Copyright (c) 2017 Vaadin Ltd.
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
*/;class TextFieldElement extends(ElementMixin$1(TextFieldMixin(ThemableMixin(PolymerElement)))){static get template(){return html$1`
    <style include="vaadin-text-field-shared-styles">
      /* polymer-cli linter breaks with empty line */
    </style>

    <div class="vaadin-text-field-container">

      <label part="label" on-click="focus" id="[[_labelId]]">[[label]]</label>

      <div part="input-field" id="[[_inputId]]">

        <slot name="prefix"></slot>

        <slot name="input">
          <input part="value">
        </slot>

        <div part="clear-button" id="clearButton" role="button" aria-label\$="[[i18n.clear]]"></div>
        <slot name="suffix"></slot>

      </div>

      <div part="error-message" id="[[_errorId]]" aria-live="assertive" aria-hidden\$="[[_getErrorMessageAriaHidden(invalid, errorMessage, _errorId)]]">[[errorMessage]]</div>

    </div>
`}static get is(){return"vaadin-text-field"}static get version(){return"2.5.4"}static get properties(){return{list:{type:String},pattern:{type:String},title:{type:String}}}}customElements.define(TextFieldElement.is,TextFieldElement);const $_documentContainer$g=html$1`<dom-module id="lumo-combo-box" theme-for="vaadin-combo-box">
  <template>
    <style include="lumo-field-button">
      :host {
        outline: none;
      }

      [part="toggle-button"]::before {
        content: var(--lumo-icons-dropdown);
      }
    </style>
  </template>
</dom-module>`;document.head.appendChild($_documentContainer$g.content);
/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/
class StyleNode{constructor(){this.start=0,this.end=0,this.previous=null,this.parent=null,this.rules=null,this.parsedCssText="",this.cssText="",this.atRule=!1,this.type=0,this.keyframesName="",this.selector="",this.parsedSelector=""}}function parse(e){return parseCss(lex(e=clean(e)),e)}function clean(e){return e.replace(RX.comments,"").replace(RX.port,"")}function lex(e){let t=new StyleNode;t.start=0,t.end=e.length;let o=t;for(let i=0,r=e.length;i<r;i++)if(e[i]===OPEN_BRACE){o.rules||(o.rules=[]);let e=o,t=e.rules[e.rules.length-1]||null;o=new StyleNode,o.start=i+1,o.parent=e,o.previous=t,e.rules.push(o)}else e[i]===CLOSE_BRACE&&(o.end=i+1,o=o.parent||t);return t}function parseCss(e,t){let o=t.substring(e.start,e.end-1);if(e.parsedCssText=e.cssText=o.trim(),e.parent){let i=e.previous?e.previous.end:e.parent.start;o=t.substring(i,e.start-1),o=_expandUnicodeEscapes(o),o=o.replace(RX.multipleSpaces," "),o=o.substring(o.lastIndexOf(";")+1);let r=e.parsedSelector=e.selector=o.trim();e.atRule=0===r.indexOf(AT_START),e.atRule?0===r.indexOf(MEDIA_START)?e.type=types.MEDIA_RULE:r.match(RX.keyframesRule)&&(e.type=types.KEYFRAMES_RULE,e.keyframesName=e.selector.split(RX.multipleSpaces).pop()):0===r.indexOf(VAR_START)?e.type=types.MIXIN_RULE:e.type=types.STYLE_RULE}let i=e.rules;if(i)for(let e,o=0,r=i.length;o<r&&(e=i[o]);o++)parseCss(e,t);return e}function _expandUnicodeEscapes(e){return e.replace(/\\([0-9a-f]{1,6})\s/gi,(function(){let e=arguments[1],t=6-e.length;for(;t--;)e="0"+e;return"\\"+e}))}function stringify(e,t,o=""){let i="";if(e.cssText||e.rules){let o=e.rules;if(o&&!_hasMixinRules(o))for(let e,r=0,s=o.length;r<s&&(e=o[r]);r++)i=stringify(e,t,i);else i=t?e.cssText:removeCustomProps(e.cssText),i=i.trim(),i&&(i="  "+i+"\n")}return i&&(e.selector&&(o+=e.selector+" "+OPEN_BRACE+"\n"),o+=i,e.selector&&(o+=CLOSE_BRACE+"\n\n")),o}function _hasMixinRules(e){let t=e[0];return Boolean(t)&&Boolean(t.selector)&&0===t.selector.indexOf(VAR_START)}function removeCustomProps(e){return removeCustomPropApply(e=removeCustomPropAssignment(e))}function removeCustomPropAssignment(e){return e.replace(RX.customProp,"").replace(RX.mixinProp,"")}function removeCustomPropApply(e){return e.replace(RX.mixinApply,"").replace(RX.varApply,"")}const types={STYLE_RULE:1,KEYFRAMES_RULE:7,MEDIA_RULE:4,MIXIN_RULE:1e3},OPEN_BRACE="{",CLOSE_BRACE="}",RX={comments:/\/\*[^*]*\*+([^/*][^*]*\*+)*\//gim,port:/@import[^;]*;/gim,customProp:/(?:^[^;\-\s}]+)?--[^;{}]*?:[^{};]*?(?:[;\n]|$)/gim,mixinProp:/(?:^[^;\-\s}]+)?--[^;{}]*?:[^{};]*?{[^}]*?}(?:[;\n]|$)?/gim,mixinApply:/@apply\s*\(?[^);]*\)?\s*(?:[;\n]|$)?/gim,varApply:/[^;:]*?:[^;]*?var\([^;]*\)(?:[;\n]|$)?/gim,keyframesRule:/^@[^\s]*keyframes/,multipleSpaces:/\s+/g},VAR_START="--",MEDIA_START="@media",AT_START="@",styleTextSet=new Set,scopingAttribute="shady-unscoped";function processUnscopedStyle(e){const t=e.textContent;if(!styleTextSet.has(t)){styleTextSet.add(t);const e=document.createElement("style");e.setAttribute("shady-unscoped",""),e.textContent=t,document.head.appendChild(e)}}function isUnscopedStyle(e){return e.hasAttribute("shady-unscoped")}
/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/function toCssText(e,t){return e?("string"==typeof e&&(e=parse(e)),t&&forEachRule(e,t),stringify(e,nativeCssVariables)):""}function rulesForStyle(e){return!e.__cssRules&&e.textContent&&(e.__cssRules=parse(e.textContent)),e.__cssRules||null}function forEachRule(e,t,o,i){if(!e)return;let r=!1,s=e.type;if(i&&s===types.MEDIA_RULE){let t=e.selector.match(MEDIA_MATCH);t&&(window.matchMedia(t[1]).matches||(r=!0))}s===types.STYLE_RULE?t(e):o&&s===types.KEYFRAMES_RULE?o(e):s===types.MIXIN_RULE&&(r=!0);let n=e.rules;if(n&&!r)for(let e,r=0,s=n.length;r<s&&(e=n[r]);r++)forEachRule(e,t,o,i)}function findMatchingParen(e,t){let o=0;for(let i=t,r=e.length;i<r;i++)if("("===e[i])o++;else if(")"===e[i]&&0==--o)return i;return-1}function processVariableAndFallback(e,t){let o=e.indexOf("var(");if(-1===o)return t(e,"","","");let i=findMatchingParen(e,o+3),r=e.substring(o+4,i),s=e.substring(0,o),n=processVariableAndFallback(e.substring(i+1),t),a=r.indexOf(",");return-1===a?t(s,r.trim(),"",n):t(s,r.substring(0,a).trim(),r.substring(a+1).trim(),n)}const wrap$1=window.ShadyDOM&&window.ShadyDOM.wrap||(e=>e);function getIsExtends(e){let t=e.localName,o="",i="";return t?t.indexOf("-")>-1?o=t:(i=t,o=e.getAttribute&&e.getAttribute("is")||""):(o=e.is,i=e.extends),{is:o,typeExtension:i}}function gatherStyleText(e){const t=[],o=e.querySelectorAll("style");for(let e=0;e<o.length;e++){const i=o[e];isUnscopedStyle(i)?nativeShadow||(processUnscopedStyle(i),i.parentNode.removeChild(i)):(t.push(i.textContent),i.parentNode.removeChild(i))}return t.join("").trim()}const CSS_BUILD_ATTR="css-build";function getCssBuild(e){if(void 0!==cssBuild)return cssBuild;if(void 0===e.__cssBuild){const t=e.getAttribute("css-build");if(t)e.__cssBuild=t;else{const t=getBuildComment(e);""!==t&&removeBuildComment(e),e.__cssBuild=t}}return e.__cssBuild||""}function elementHasBuiltCss(e){return""!==getCssBuild(e)}function getBuildComment(e){const t="template"===e.localName?e.content.firstChild:e.firstChild;if(t instanceof Comment){const e=t.textContent.trim().split(":");if("css-build"===e[0])return e[1]}return""}function removeBuildComment(e){const t="template"===e.localName?e.content.firstChild:e.firstChild;t.parentNode.removeChild(t)}
/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/const APPLY_NAME_CLEAN=/;\s*/m,INITIAL_INHERIT=/^\s*(initial)|(inherit)\s*$/,IMPORTANT=/\s*!important/,MIXIN_VAR_SEP="_-_";class MixinMap{constructor(){this._map={}}set(e,t){e=e.trim(),this._map[e]={properties:t,dependants:{}}}get(e){return e=e.trim(),this._map[e]||null}}let invalidCallback=null;class ApplyShim{constructor(){this._currentElement=null,this._measureElement=null,this._map=new MixinMap}detectMixin(e){return detectMixin(e)}gatherStyles(e){const t=gatherStyleText(e.content);if(t){const o=document.createElement("style");return o.textContent=t,e.content.insertBefore(o,e.content.firstChild),o}return null}transformTemplate(e,t){void 0===e._gatheredStyle&&(e._gatheredStyle=this.gatherStyles(e));const o=e._gatheredStyle;return o?this.transformStyle(o,t):null}transformStyle(e,t=""){let o=rulesForStyle(e);return this.transformRules(o,t),e.textContent=toCssText(o),o}transformCustomStyle(e){let t=rulesForStyle(e);return forEachRule(t,(e=>{":root"===e.selector&&(e.selector="html"),this.transformRule(e)})),e.textContent=toCssText(t),t}transformRules(e,t){this._currentElement=t,forEachRule(e,(e=>{this.transformRule(e)})),this._currentElement=null}transformRule(e){e.cssText=this.transformCssText(e.parsedCssText,e),":root"===e.selector&&(e.selector=":host > *")}transformCssText(e,t){return e=e.replace(VAR_ASSIGN,((e,o,i,r)=>this._produceCssProperties(e,o,i,r,t))),this._consumeCssProperties(e,t)}_getInitialValueForProperty(e){return this._measureElement||(this._measureElement=document.createElement("meta"),this._measureElement.setAttribute("apply-shim-measure",""),this._measureElement.style.all="initial",document.head.appendChild(this._measureElement)),window.getComputedStyle(this._measureElement).getPropertyValue(e)}_fallbacksFromPreviousRules(e){let t=e;for(;t.parent;)t=t.parent;const o={};let i=!1;return forEachRule(t,(t=>{i=i||t===e,i||t.selector===e.selector&&Object.assign(o,this._cssTextToMap(t.parsedCssText))})),o}_consumeCssProperties(e,t){let o=null;for(;o=MIXIN_MATCH.exec(e);){let i=o[0],r=o[1],s=o.index,n=s+i.indexOf("@apply"),a=s+i.length,l=e.slice(0,n),c=e.slice(a),d=t?this._fallbacksFromPreviousRules(t):{};Object.assign(d,this._cssTextToMap(l));let h=this._atApplyToCssProperties(r,d);e=`${l}${h}${c}`,MIXIN_MATCH.lastIndex=s+h.length}return e}_atApplyToCssProperties(e,t){e=e.replace(APPLY_NAME_CLEAN,"");let o=[],i=this._map.get(e);if(i||(this._map.set(e,{}),i=this._map.get(e)),i){let r,s,n;this._currentElement&&(i.dependants[this._currentElement]=!0);const a=i.properties;for(r in a)n=t&&t[r],s=[r,": var(",e,"_-_",r],n&&s.push(",",n.replace(IMPORTANT,"")),s.push(")"),IMPORTANT.test(a[r])&&s.push(" !important"),o.push(s.join(""))}return o.join("; ")}_replaceInitialOrInherit(e,t){let o=INITIAL_INHERIT.exec(t);return o&&(t=o[1]?this._getInitialValueForProperty(e):"apply-shim-inherit"),t}_cssTextToMap(e,t=!1){let o,i,r=e.split(";"),s={};for(let e,n,a=0;a<r.length;a++)e=r[a],e&&(n=e.split(":"),n.length>1&&(o=n[0].trim(),i=n.slice(1).join(":"),t&&(i=this._replaceInitialOrInherit(o,i)),s[o]=i));return s}_invalidateMixinEntry(e){if(invalidCallback)for(let t in e.dependants)t!==this._currentElement&&invalidCallback(t)}_produceCssProperties(e,t,o,i,r){if(o&&processVariableAndFallback(o,((e,t)=>{t&&this._map.get(t)&&(i=`@apply ${t};`)})),!i)return e;let s=this._consumeCssProperties(""+i,r),n=e.slice(0,e.indexOf("--")),a=this._cssTextToMap(s,!0),l=a,c=this._map.get(t),d=c&&c.properties;d?l=Object.assign(Object.create(d),a):this._map.set(t,l);let h,p,u=[],m=!1;for(h in l)p=a[h],void 0===p&&(p="initial"),d&&!(h in d)&&(m=!0),u.push(`${t}_-_${h}: ${p}`);return m&&this._invalidateMixinEntry(c),c&&(c.properties=l),o&&(n=`${e};${n}`),`${n}${u.join("; ")};`}}ApplyShim.prototype.detectMixin=ApplyShim.prototype.detectMixin,ApplyShim.prototype.transformStyle=ApplyShim.prototype.transformStyle,ApplyShim.prototype.transformCustomStyle=ApplyShim.prototype.transformCustomStyle,ApplyShim.prototype.transformRules=ApplyShim.prototype.transformRules,ApplyShim.prototype.transformRule=ApplyShim.prototype.transformRule,ApplyShim.prototype.transformTemplate=ApplyShim.prototype.transformTemplate,ApplyShim.prototype._separator="_-_",Object.defineProperty(ApplyShim.prototype,"invalidCallback",{get:()=>invalidCallback,set(e){invalidCallback=e}});
/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/
const templateMap={},CURRENT_VERSION="_applyShimCurrentVersion",NEXT_VERSION="_applyShimNextVersion",VALIDATING_VERSION="_applyShimValidatingVersion",promise=Promise.resolve();
/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/function invalidate(e){let t=templateMap[e];t&&invalidateTemplate(t)}function invalidateTemplate(e){e[CURRENT_VERSION]=e[CURRENT_VERSION]||0,e[VALIDATING_VERSION]=e[VALIDATING_VERSION]||0,e[NEXT_VERSION]=(e[NEXT_VERSION]||0)+1}function templateIsValid(e){return e[CURRENT_VERSION]===e[NEXT_VERSION]}function templateIsValidating(e){return!templateIsValid(e)&&e[VALIDATING_VERSION]===e[NEXT_VERSION]}function startValidatingTemplate(e){e[VALIDATING_VERSION]=e[NEXT_VERSION],e._validating||(e._validating=!0,promise.then((function(){e[CURRENT_VERSION]=e[NEXT_VERSION],e._validating=!1})))}
/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/const applyShim=new ApplyShim;class ApplyShimInterface{constructor(){this.customStyleInterface=null,applyShim.invalidCallback=invalidate}ensure(){this.customStyleInterface||window.ShadyCSS.CustomStyleInterface&&(this.customStyleInterface=window.ShadyCSS.CustomStyleInterface,this.customStyleInterface.transformCallback=e=>{applyShim.transformCustomStyle(e)},this.customStyleInterface.validateCallback=()=>{requestAnimationFrame((()=>{this.customStyleInterface.enqueued&&this.flushCustomStyles()}))})}prepareTemplate(e,t){if(this.ensure(),elementHasBuiltCss(e))return;templateMap[t]=e;let o=applyShim.transformTemplate(e,t);e._styleAst=o}flushCustomStyles(){if(this.ensure(),!this.customStyleInterface)return;let e=this.customStyleInterface.processStyles();if(this.customStyleInterface.enqueued){for(let t=0;t<e.length;t++){let o=e[t],i=this.customStyleInterface.getStyleForCustomStyle(o);i&&applyShim.transformCustomStyle(i)}this.customStyleInterface.enqueued=!1}}styleSubtree(e,t){if(this.ensure(),t&&updateNativeProperties(e,t),e.shadowRoot){this.styleElement(e);let t=e.shadowRoot.children||e.shadowRoot.childNodes;for(let e=0;e<t.length;e++)this.styleSubtree(t[e])}else{let t=e.children||e.childNodes;for(let e=0;e<t.length;e++)this.styleSubtree(t[e])}}styleElement(e){this.ensure();let{is:t}=getIsExtends(e),o=templateMap[t];if((!o||!elementHasBuiltCss(o))&&o&&!templateIsValid(o)){templateIsValidating(o)||(this.prepareTemplate(o,t),startValidatingTemplate(o));let i=e.shadowRoot;if(i){let e=i.querySelector("style");e&&(e.__cssRules=o._styleAst,e.textContent=toCssText(o._styleAst))}}}styleDocument(e){this.ensure(),this.styleSubtree(document.body,e)}}if(!window.ShadyCSS||!window.ShadyCSS.ScopingShim){const e=new ApplyShimInterface;let t=window.ShadyCSS&&window.ShadyCSS.CustomStyleInterface;window.ShadyCSS={prepareTemplate(t,o,i){e.flushCustomStyles(),e.prepareTemplate(t,o)},prepareTemplateStyles(e,t,o){window.ShadyCSS.prepareTemplate(e,t,o)},prepareTemplateDom(e,t){},styleSubtree(t,o){e.flushCustomStyles(),e.styleSubtree(t,o)},styleElement(t){e.flushCustomStyles(),e.styleElement(t)},styleDocument(t){e.flushCustomStyles(),e.styleDocument(t)},getComputedStyleValue:(e,t)=>getComputedStyleValue(e,t),flushCustomStyles(){e.flushCustomStyles()},nativeCss:nativeCssVariables,nativeShadow:nativeShadow,cssBuild:cssBuild,disableRuntime:disableRuntime},t&&(window.ShadyCSS.CustomStyleInterface=t)}window.ShadyCSS.ApplyShim=applyShim;
/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/
let HAS_NATIVE_TA="string"==typeof document.head.style.touchAction,GESTURE_KEY="__polymerGestures",HANDLED_OBJ="__polymerGesturesHandled",TOUCH_ACTION="__polymerGesturesTouchAction",TAP_DISTANCE=25,TRACK_DISTANCE=5,TRACK_LENGTH=2,MOUSE_TIMEOUT=2500,MOUSE_EVENTS=["mousedown","mousemove","mouseup","click"],MOUSE_WHICH_TO_BUTTONS=[0,1,4,2],MOUSE_HAS_BUTTONS=function(){try{return 1===new MouseEvent("test",{buttons:1}).buttons}catch(e){return!1}}();function isMouseEvent(e){return MOUSE_EVENTS.indexOf(e)>-1}let supportsPassive=!1;function PASSIVE_TOUCH(e){if(!isMouseEvent(e)&&"touchend"!==e)return HAS_NATIVE_TA&&supportsPassive&&passiveTouchGestures?{passive:!0}:void 0}!function(){try{let e=Object.defineProperty({},"passive",{get(){supportsPassive=!0}});window.addEventListener("test",null,e),window.removeEventListener("test",null,e)}catch(e){}}();let IS_TOUCH_ONLY=navigator.userAgent.match(/iP(?:[oa]d|hone)|Android/);const clickedLabels=[],labellable={button:!0,input:!0,keygen:!0,meter:!0,output:!0,textarea:!0,progress:!0,select:!0},canBeDisabled={button:!0,command:!0,fieldset:!0,input:!0,keygen:!0,optgroup:!0,option:!0,select:!0,textarea:!0};function canBeLabelled(e){return labellable[e.localName]||!1}function matchingLabels(e){let t=Array.prototype.slice.call(e.labels||[]);if(!t.length){t=[];let o=e.getRootNode();if(e.id){let i=o.querySelectorAll(`label[for = ${e.id}]`);for(let e=0;e<i.length;e++)t.push(i[e])}}return t}let mouseCanceller=function(e){let t=e.sourceCapabilities;if((!t||t.firesTouchEvents)&&(e[HANDLED_OBJ]={skip:!0},"click"===e.type)){let t=!1,o=getComposedPath(e);for(let e=0;e<o.length;e++){if(o[e].nodeType===Node.ELEMENT_NODE)if("label"===o[e].localName)clickedLabels.push(o[e]);else if(canBeLabelled(o[e])){let i=matchingLabels(o[e]);for(let e=0;e<i.length;e++)t=t||clickedLabels.indexOf(i[e])>-1}if(o[e]===POINTERSTATE.mouse.target)return}if(t)return;e.preventDefault(),e.stopPropagation()}};function setupTeardownMouseCanceller(e){let t=IS_TOUCH_ONLY?["click"]:MOUSE_EVENTS;for(let o,i=0;i<t.length;i++)o=t[i],e?(clickedLabels.length=0,document.addEventListener(o,mouseCanceller,!0)):document.removeEventListener(o,mouseCanceller,!0)}function ignoreMouse(e){POINTERSTATE.mouse.mouseIgnoreJob||setupTeardownMouseCanceller(!0);POINTERSTATE.mouse.target=getComposedPath(e)[0],POINTERSTATE.mouse.mouseIgnoreJob=Debouncer.debounce(POINTERSTATE.mouse.mouseIgnoreJob,timeOut.after(MOUSE_TIMEOUT),(function(){setupTeardownMouseCanceller(),POINTERSTATE.mouse.target=null,POINTERSTATE.mouse.mouseIgnoreJob=null}))}function hasLeftMouseButton(e){let t=e.type;if(!isMouseEvent(t))return!1;if("mousemove"===t){let t=void 0===e.buttons?1:e.buttons;return e instanceof window.MouseEvent&&!MOUSE_HAS_BUTTONS&&(t=MOUSE_WHICH_TO_BUTTONS[e.which]||0),Boolean(1&t)}return 0===(void 0===e.button?0:e.button)}function isSyntheticClick(e){if("click"===e.type){if(0===e.detail)return!0;let t=_findOriginalTarget(e);if(!t.nodeType||t.nodeType!==Node.ELEMENT_NODE)return!0;let o=t.getBoundingClientRect(),i=e.pageX,r=e.pageY;return!(i>=o.left&&i<=o.right&&r>=o.top&&r<=o.bottom)}return!1}let POINTERSTATE={mouse:{target:null,mouseIgnoreJob:null},touch:{x:0,y:0,id:-1,scrollDecided:!1}};function firstTouchAction(e){let t="auto",o=getComposedPath(e);for(let e,i=0;i<o.length;i++)if(e=o[i],e[TOUCH_ACTION]){t=e[TOUCH_ACTION];break}return t}function trackDocument(e,t,o){e.movefn=t,e.upfn=o,document.addEventListener("mousemove",t),document.addEventListener("mouseup",o)}function untrackDocument(e){document.removeEventListener("mousemove",e.movefn),document.removeEventListener("mouseup",e.upfn),e.movefn=null,e.upfn=null}document.addEventListener("touchend",ignoreMouse,!!supportsPassive&&{passive:!0});const getComposedPath=window.ShadyDOM&&window.ShadyDOM.noPatch?window.ShadyDOM.composedPath:e=>e.composedPath&&e.composedPath()||[],gestures={},recognizers=[];function deepTargetFind(e,t){let o=document.elementFromPoint(e,t),i=o;for(;i&&i.shadowRoot&&!window.ShadyDOM;){let r=i;if(i=i.shadowRoot.elementFromPoint(e,t),r===i)break;i&&(o=i)}return o}function _findOriginalTarget(e){const t=getComposedPath(e);return t.length>0?t[0]:e.target}function _handleNative(e){let t,o=e.type,i=e.currentTarget[GESTURE_KEY];if(!i)return;let r=i[o];if(r){if(!e[HANDLED_OBJ]&&(e[HANDLED_OBJ]={},"touch"===o.slice(0,5))){let t=(e=e).changedTouches[0];if("touchstart"===o&&1===e.touches.length&&(POINTERSTATE.touch.id=t.identifier),POINTERSTATE.touch.id!==t.identifier)return;HAS_NATIVE_TA||"touchstart"!==o&&"touchmove"!==o||_handleTouchAction(e)}if(t=e[HANDLED_OBJ],!t.skip){for(let o,i=0;i<recognizers.length;i++)o=recognizers[i],r[o.name]&&!t[o.name]&&o.flow&&o.flow.start.indexOf(e.type)>-1&&o.reset&&o.reset();for(let i,s=0;s<recognizers.length;s++)i=recognizers[s],r[i.name]&&!t[i.name]&&(t[i.name]=!0,i[o](e))}}}function _handleTouchAction(e){let t=e.changedTouches[0],o=e.type;if("touchstart"===o)POINTERSTATE.touch.x=t.clientX,POINTERSTATE.touch.y=t.clientY,POINTERSTATE.touch.scrollDecided=!1;else if("touchmove"===o){if(POINTERSTATE.touch.scrollDecided)return;POINTERSTATE.touch.scrollDecided=!0;let o=firstTouchAction(e),i=!1,r=Math.abs(POINTERSTATE.touch.x-t.clientX),s=Math.abs(POINTERSTATE.touch.y-t.clientY);e.cancelable&&("none"===o?i=!0:"pan-x"===o?i=s>r:"pan-y"===o&&(i=r>s)),i?e.preventDefault():prevent("track")}}function addListener(e,t,o){return!!gestures[t]&&(_add(e,t,o),!0)}function removeListener(e,t,o){return!!gestures[t]&&(_remove(e,t,o),!0)}function _add(e,t,o){let i=gestures[t],r=i.deps,s=i.name,n=e[GESTURE_KEY];n||(e[GESTURE_KEY]=n={});for(let t,o,i=0;i<r.length;i++)t=r[i],IS_TOUCH_ONLY&&isMouseEvent(t)&&"click"!==t||(o=n[t],o||(n[t]=o={_count:0}),0===o._count&&e.addEventListener(t,_handleNative,PASSIVE_TOUCH(t)),o[s]=(o[s]||0)+1,o._count=(o._count||0)+1);e.addEventListener(t,o),i.touchAction&&setTouchAction(e,i.touchAction)}function _remove(e,t,o){let i=gestures[t],r=i.deps,s=i.name,n=e[GESTURE_KEY];if(n)for(let t,o,i=0;i<r.length;i++)t=r[i],o=n[t],o&&o[s]&&(o[s]=(o[s]||1)-1,o._count=(o._count||1)-1,0===o._count&&e.removeEventListener(t,_handleNative,PASSIVE_TOUCH(t)));e.removeEventListener(t,o)}function register$1(e){recognizers.push(e);for(let t=0;t<e.emits.length;t++)gestures[e.emits[t]]=e}function _findRecognizerByEvent(e){for(let t,o=0;o<recognizers.length;o++){t=recognizers[o];for(let o,i=0;i<t.emits.length;i++)if(o=t.emits[i],o===e)return t}return null}function setTouchAction(e,t){HAS_NATIVE_TA&&e instanceof HTMLElement&&microTask.run((()=>{e.style.touchAction=t})),e[TOUCH_ACTION]=t}function _fire(e,t,o){let i=new Event(t,{bubbles:!0,cancelable:!0,composed:!0});if(i.detail=o,wrap(e).dispatchEvent(i),i.defaultPrevented){let e=o.preventer||o.sourceEvent;e&&e.preventDefault&&e.preventDefault()}}function prevent(e){let t=_findRecognizerByEvent(e);t.info&&(t.info.prevent=!0)}function downupFire(e,t,o,i){t&&_fire(t,e,{x:o.clientX,y:o.clientY,sourceEvent:o,preventer:i,prevent:function(e){return prevent(e)}})}function trackHasMovedEnough(e,t,o){if(e.prevent)return!1;if(e.started)return!0;let i=Math.abs(e.x-t),r=Math.abs(e.y-o);return i>=TRACK_DISTANCE||r>=TRACK_DISTANCE}function trackFire(e,t,o){if(!t)return;let i,r=e.moves[e.moves.length-2],s=e.moves[e.moves.length-1],n=s.x-e.x,a=s.y-e.y,l=0;r&&(i=s.x-r.x,l=s.y-r.y),_fire(t,"track",{state:e.state,x:o.clientX,y:o.clientY,dx:n,dy:a,ddx:i,ddy:l,sourceEvent:o,hover:function(){return deepTargetFind(o.clientX,o.clientY)}})}function trackForward(e,t,o){let i=Math.abs(t.clientX-e.x),r=Math.abs(t.clientY-e.y),s=_findOriginalTarget(o||t);!s||canBeDisabled[s.localName]&&s.hasAttribute("disabled")||(isNaN(i)||isNaN(r)||i<=TAP_DISTANCE&&r<=TAP_DISTANCE||isSyntheticClick(t))&&(e.prevent||_fire(s,"tap",{x:t.clientX,y:t.clientY,sourceEvent:t,preventer:o}))}
/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/register$1({name:"downup",deps:["mousedown","touchstart","touchend"],flow:{start:["mousedown","touchstart"],end:["mouseup","touchend"]},emits:["down","up"],info:{movefn:null,upfn:null},reset:function(){untrackDocument(this.info)},mousedown:function(e){if(!hasLeftMouseButton(e))return;let t=_findOriginalTarget(e),o=this;trackDocument(this.info,(function(e){hasLeftMouseButton(e)||(downupFire("up",t,e),untrackDocument(o.info))}),(function(e){hasLeftMouseButton(e)&&downupFire("up",t,e),untrackDocument(o.info)})),downupFire("down",t,e)},touchstart:function(e){downupFire("down",_findOriginalTarget(e),e.changedTouches[0],e)},touchend:function(e){downupFire("up",_findOriginalTarget(e),e.changedTouches[0],e)}}),register$1({name:"track",touchAction:"none",deps:["mousedown","touchstart","touchmove","touchend"],flow:{start:["mousedown","touchstart"],end:["mouseup","touchend"]},emits:["track"],info:{x:0,y:0,state:"start",started:!1,moves:[],addMove:function(e){this.moves.length>TRACK_LENGTH&&this.moves.shift(),this.moves.push(e)},movefn:null,upfn:null,prevent:!1},reset:function(){this.info.state="start",this.info.started=!1,this.info.moves=[],this.info.x=0,this.info.y=0,this.info.prevent=!1,untrackDocument(this.info)},mousedown:function(e){if(!hasLeftMouseButton(e))return;let t=_findOriginalTarget(e),o=this,i=function(e){let i=e.clientX,r=e.clientY;trackHasMovedEnough(o.info,i,r)&&(o.info.state=o.info.started?"mouseup"===e.type?"end":"track":"start","start"===o.info.state&&prevent("tap"),o.info.addMove({x:i,y:r}),hasLeftMouseButton(e)||(o.info.state="end",untrackDocument(o.info)),t&&trackFire(o.info,t,e),o.info.started=!0)};trackDocument(this.info,i,(function(e){o.info.started&&i(e),untrackDocument(o.info)})),this.info.x=e.clientX,this.info.y=e.clientY},touchstart:function(e){let t=e.changedTouches[0];this.info.x=t.clientX,this.info.y=t.clientY},touchmove:function(e){let t=_findOriginalTarget(e),o=e.changedTouches[0],i=o.clientX,r=o.clientY;trackHasMovedEnough(this.info,i,r)&&("start"===this.info.state&&prevent("tap"),this.info.addMove({x:i,y:r}),trackFire(this.info,t,o),this.info.state="track",this.info.started=!0)},touchend:function(e){let t=_findOriginalTarget(e),o=e.changedTouches[0];this.info.started&&(this.info.state="end",this.info.addMove({x:o.clientX,y:o.clientY}),trackFire(this.info,t,o))}}),register$1({name:"tap",deps:["mousedown","click","touchstart","touchend"],flow:{start:["mousedown","touchstart"],end:["click","touchend"]},emits:["tap"],info:{x:NaN,y:NaN,prevent:!1},reset:function(){this.info.x=NaN,this.info.y=NaN,this.info.prevent=!1},mousedown:function(e){hasLeftMouseButton(e)&&(this.info.x=e.clientX,this.info.y=e.clientY)},click:function(e){hasLeftMouseButton(e)&&trackForward(this.info,e)},touchstart:function(e){const t=e.changedTouches[0];this.info.x=t.clientX,this.info.y=t.clientY},touchend:function(e){trackForward(this.info,e.changedTouches[0],e)}});const GestureEventListeners=dedupingMixin((e=>class extends e{_addEventListenerToNode(e,t,o){addListener(e,t,o)||super._addEventListenerToNode(e,t,o)}_removeEventListenerFromNode(e,t,o){removeListener(e,t,o)||super._removeEventListenerFromNode(e,t,o)}})),HOST_DIR=/:host\(:dir\((ltr|rtl)\)\)/g,HOST_DIR_REPLACMENT=':host([dir="$1"])',EL_DIR=/([\s\w-#\.\[\]\*]*):dir\((ltr|rtl)\)/g,EL_DIR_REPLACMENT=':host([dir="$2"]) $1',DIR_CHECK=/:dir\((?:ltr|rtl)\)/,SHIM_SHADOW=Boolean(window.ShadyDOM&&window.ShadyDOM.inUse),DIR_INSTANCES=[];
/**
 * @fileoverview
 * @suppress {checkPrototypalTypes}
 * @license Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt The complete set of authors may be found
 * at http://polymer.github.io/AUTHORS.txt The complete set of contributors may
 * be found at http://polymer.github.io/CONTRIBUTORS.txt Code distributed by
 * Google as part of the polymer project is also subject to an additional IP
 * rights grant found at http://polymer.github.io/PATENTS.txt
 */let observer=null,documentDir="";function getRTL(){documentDir=document.documentElement.getAttribute("dir")}function setRTL(e){if(!e.__autoDirOptOut){e.setAttribute("dir",documentDir)}}function updateDirection(){getRTL(),documentDir=document.documentElement.getAttribute("dir");for(let e=0;e<DIR_INSTANCES.length;e++)setRTL(DIR_INSTANCES[e])}function takeRecords(){observer&&observer.takeRecords().length&&updateDirection()}const DirMixin$1=dedupingMixin((e=>{SHIM_SHADOW||observer||(getRTL(),observer=new MutationObserver(updateDirection),observer.observe(document.documentElement,{attributes:!0,attributeFilter:["dir"]}));const t=PropertyAccessors(e);class o extends t{static _processStyleText(e,o){return e=t._processStyleText.call(this,e,o),!SHIM_SHADOW&&DIR_CHECK.test(e)&&(e=this._replaceDirInCssText(e),this.__activateDir=!0),e}static _replaceDirInCssText(e){let t=e;return t=t.replace(HOST_DIR,':host([dir="$1"])'),t=t.replace(EL_DIR,EL_DIR_REPLACMENT),t}constructor(){super(),this.__autoDirOptOut=!1}ready(){super.ready(),this.__autoDirOptOut=this.hasAttribute("dir")}connectedCallback(){t.prototype.connectedCallback&&super.connectedCallback(),this.constructor.__activateDir&&(takeRecords(),DIR_INSTANCES.push(this),setRTL(this))}disconnectedCallback(){if(t.prototype.disconnectedCallback&&super.disconnectedCallback(),this.constructor.__activateDir){const e=DIR_INSTANCES.indexOf(this);e>-1&&DIR_INSTANCES.splice(e,1)}}}return o.__activateDir=!1,o}));
/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/function resolve(){document.body.removeAttribute("unresolved")}"interactive"===document.readyState||"complete"===document.readyState?resolve():window.addEventListener("DOMContentLoaded",resolve)
/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/;const p$1=Element.prototype,normalizedMatchesSelector=p$1.matches||p$1.matchesSelector||p$1.mozMatchesSelector||p$1.msMatchesSelector||p$1.oMatchesSelector||p$1.webkitMatchesSelector,matchesSelector=function(e,t){return normalizedMatchesSelector.call(e,t)};class DomApiNative{constructor(e){window.ShadyDOM&&window.ShadyDOM.inUse&&window.ShadyDOM.patch(e),this.node=e}observeNodes(e){return new FlattenedNodesObserver(this.node,e)}unobserveNodes(e){e.disconnect()}notifyObserver(){}deepContains(e){if(wrap(this.node).contains(e))return!0;let t=e,o=e.ownerDocument;for(;t&&t!==o&&t!==this.node;)t=wrap(t).parentNode||wrap(t).host;return t===this.node}getOwnerRoot(){return wrap(this.node).getRootNode()}getDistributedNodes(){return"slot"===this.node.localName?wrap(this.node).assignedNodes({flatten:!0}):[]}getDestinationInsertionPoints(){let e=[],t=wrap(this.node).assignedSlot;for(;t;)e.push(t),t=wrap(t).assignedSlot;return e}importNode(e,t){let o=this.node instanceof Document?this.node:this.node.ownerDocument;return wrap(o).importNode(e,t)}getEffectiveChildNodes(){return FlattenedNodesObserver.getFlattenedNodes(this.node)}queryDistributedElements(e){let t=this.getEffectiveChildNodes(),o=[];for(let i,r=0,s=t.length;r<s&&(i=t[r]);r++)i.nodeType===Node.ELEMENT_NODE&&matchesSelector(i,e)&&o.push(i);return o}get activeElement(){let e=this.node;return void 0!==e._activeElement?e._activeElement:e.activeElement}}function forwardMethods(e,t){for(let o=0;o<t.length;o++){let i=t[o];e[i]=function(){return this.node[i].apply(this.node,arguments)}}}function forwardReadOnlyProperties(e,t){for(let o=0;o<t.length;o++){let i=t[o];Object.defineProperty(e,i,{get:function(){return this.node[i]},configurable:!0})}}function forwardProperties(e,t){for(let o=0;o<t.length;o++){let i=t[o];Object.defineProperty(e,i,{get:function(){return this.node[i]},set:function(e){this.node[i]=e},configurable:!0})}}class EventApi{constructor(e){this.event=e}get rootTarget(){return this.path[0]}get localTarget(){return this.event.target}get path(){return this.event.composedPath()}}let DomApiImpl=DomApiNative;if(window.ShadyDOM&&window.ShadyDOM.inUse&&window.ShadyDOM.noPatch&&window.ShadyDOM.Wrapper){class e extends window.ShadyDOM.Wrapper{}Object.getOwnPropertyNames(DomApiNative.prototype).forEach((t=>{"activeElement"!=t&&(e.prototype[t]=DomApiNative.prototype[t])})),forwardReadOnlyProperties(e.prototype,["classList"]),DomApiImpl=e,Object.defineProperties(EventApi.prototype,{localTarget:{get(){const e=this.event.currentTarget,t=e&&dom(e).getOwnerRoot(),o=this.path;for(let e=0;e<o.length;e++){const i=o[e];if(dom(i).getOwnerRoot()===t)return i}},configurable:!0},path:{get(){return window.ShadyDOM.composedPath(this.event)},configurable:!0}})}else forwardMethods(DomApiNative.prototype,["cloneNode","appendChild","insertBefore","removeChild","replaceChild","setAttribute","removeAttribute","querySelector","querySelectorAll"]),forwardReadOnlyProperties(DomApiNative.prototype,["parentNode","firstChild","lastChild","nextSibling","previousSibling","firstElementChild","lastElementChild","nextElementSibling","previousElementSibling","childNodes","children","classList"]),forwardProperties(DomApiNative.prototype,["textContent","innerHTML","className"]);const dom=function(e){if((e=e||document)instanceof DomApiImpl)return e;if(e instanceof EventApi)return e;let t=e.__domApi;return t||(t=e instanceof Event?new EventApi(e):new DomApiImpl(e),e.__domApi=t),t},ShadyDOM$1=window.ShadyDOM,ShadyCSS=window.ShadyCSS;
/**
@license
Copyright (c) 2019 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/function sameScope(e,t){return wrap(e).getRootNode()===t}function scopeSubtree(e,t=!1){if(!ShadyDOM$1||!ShadyCSS)return null;if(!ShadyDOM$1.handlesDynamicScoping)return null;const o=ShadyCSS.ScopingShim;if(!o)return null;const i=o.scopeForNode(e),r=wrap(e).getRootNode(),s=e=>{if(!sameScope(e,r))return;const t=Array.from(ShadyDOM$1.nativeMethods.querySelectorAll.call(e,"*"));t.push(e);for(let e=0;e<t.length;e++){const s=t[e];if(!sameScope(s,r))continue;const n=o.currentScopeForNode(s);n!==i&&(""!==n&&o.unscopeNode(s,n),o.scopeNode(s,i))}};if(s(e),t){const t=new MutationObserver((e=>{for(let t=0;t<e.length;t++){const o=e[t];for(let e=0;e<o.addedNodes.length;e++){const t=o.addedNodes[e];t.nodeType===Node.ELEMENT_NODE&&s(t)}}}));return t.observe(e,{childList:!0,subtree:!0}),t}return null}
/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/let styleInterface=window.ShadyCSS;const LegacyElementMixin=dedupingMixin((e=>{const t=DirMixin$1(GestureEventListeners(ElementMixin(e))),o={x:"pan-x",y:"pan-y",none:"none",all:"auto"};class i extends t{constructor(){super(),this.isAttached,this.__boundListeners,this._debouncers}static get importMeta(){return this.prototype.importMeta}created(){}connectedCallback(){super.connectedCallback(),this.isAttached=!0,this.attached()}attached(){}disconnectedCallback(){super.disconnectedCallback(),this.isAttached=!1,this.detached()}detached(){}attributeChangedCallback(e,t,o,i){t!==o&&(super.attributeChangedCallback(e,t,o,i),this.attributeChanged(e,t,o))}attributeChanged(e,t,o){}_initializeProperties(){let e=Object.getPrototypeOf(this);e.hasOwnProperty(JSCompiler_renameProperty("__hasRegisterFinished",e))||(this._registered(),e.__hasRegisterFinished=!0),super._initializeProperties(),this.root=this,this.created(),this._applyListeners()}_registered(){}ready(){this._ensureAttributes(),super.ready()}_ensureAttributes(){}_applyListeners(){}serialize(e){return this._serializeValue(e)}deserialize(e,t){return this._deserializeValue(e,t)}reflectPropertyToAttribute(e,t,o){this._propertyToAttribute(e,t,o)}serializeValueToAttribute(e,t,o){this._valueToNodeAttribute(o||this,e,t)}extend(e,t){if(!e||!t)return e||t;let o=Object.getOwnPropertyNames(t);for(let i,r=0;r<o.length&&(i=o[r]);r++){let o=Object.getOwnPropertyDescriptor(t,i);o&&Object.defineProperty(e,i,o)}return e}mixin(e,t){for(let o in t)e[o]=t[o];return e}chainObject(e,t){return e&&t&&e!==t&&(e.__proto__=t),e}instanceTemplate(e){let t=this.constructor._contentForTemplate(e);return document.importNode(t,!0)}fire(e,t,o){o=o||{},t=null==t?{}:t;let i=new Event(e,{bubbles:void 0===o.bubbles||o.bubbles,cancelable:Boolean(o.cancelable),composed:void 0===o.composed||o.composed});i.detail=t;let r=o.node||this;return wrap(r).dispatchEvent(i),i}listen(e,t,o){e=e||this;let i=this.__boundListeners||(this.__boundListeners=new WeakMap),r=i.get(e);r||(r={},i.set(e,r));let s=t+o;r[s]||(r[s]=this._addMethodEventListenerToNode(e,t,o,this))}unlisten(e,t,o){e=e||this;let i=this.__boundListeners&&this.__boundListeners.get(e),r=t+o,s=i&&i[r];s&&(this._removeEventListenerFromNode(e,t,s),i[r]=null)}setScrollDirection(e,t){setTouchAction(t||this,o[e]||"auto")}$$(e){return this.root.querySelector(e)}get domHost(){let e=wrap(this).getRootNode();return e instanceof DocumentFragment?e.host:e}distributeContent(){const e=dom(this);window.ShadyDOM&&e.shadowRoot&&ShadyDOM.flush()}getEffectiveChildNodes(){return dom(this).getEffectiveChildNodes()}queryDistributedElements(e){return dom(this).queryDistributedElements(e)}getEffectiveChildren(){return this.getEffectiveChildNodes().filter((function(e){return e.nodeType===Node.ELEMENT_NODE}))}getEffectiveTextContent(){let e=this.getEffectiveChildNodes(),t=[];for(let o,i=0;o=e[i];i++)o.nodeType!==Node.COMMENT_NODE&&t.push(o.textContent);return t.join("")}queryEffectiveChildren(e){let t=this.queryDistributedElements(e);return t&&t[0]}queryAllEffectiveChildren(e){return this.queryDistributedElements(e)}getContentChildNodes(e){let t=this.root.querySelector(e||"slot");return t?dom(t).getDistributedNodes():[]}getContentChildren(e){return this.getContentChildNodes(e).filter((function(e){return e.nodeType===Node.ELEMENT_NODE}))}isLightDescendant(e){const t=this;return t!==e&&wrap(t).contains(e)&&wrap(t).getRootNode()===wrap(e).getRootNode()}isLocalDescendant(e){return this.root===wrap(e).getRootNode()}scopeSubtree(e,t=!1){return scopeSubtree(e,t)}getComputedStyleValue(e){return styleInterface.getComputedStyleValue(this,e)}debounce(e,t,o){return this._debouncers=this._debouncers||{},this._debouncers[e]=Debouncer.debounce(this._debouncers[e],o>0?timeOut.after(o):microTask,t.bind(this))}isDebouncerActive(e){this._debouncers=this._debouncers||{};let t=this._debouncers[e];return!(!t||!t.isActive())}flushDebouncer(e){this._debouncers=this._debouncers||{};let t=this._debouncers[e];t&&t.flush()}cancelDebouncer(e){this._debouncers=this._debouncers||{};let t=this._debouncers[e];t&&t.cancel()}async(e,t){return t>0?timeOut.run(e.bind(this),t):~microTask.run(e.bind(this))}cancelAsync(e){e<0?microTask.cancel(~e):timeOut.cancel(e)}create(e,t){let o=document.createElement(e);if(t)if(o.setProperties)o.setProperties(t);else for(let e in t)o[e]=t[e];return o}elementMatches(e,t){return matchesSelector(t||this,e)}toggleAttribute(e,t){let o=this;return 3===arguments.length&&(o=arguments[2]),1==arguments.length&&(t=!o.hasAttribute(e)),t?(wrap(o).setAttribute(e,""),!0):(wrap(o).removeAttribute(e),!1)}toggleClass(e,t,o){o=o||this,1==arguments.length&&(t=!o.classList.contains(e)),t?o.classList.add(e):o.classList.remove(e)}transform(e,t){(t=t||this).style.webkitTransform=e,t.style.transform=e}translate3d(e,t,o,i){i=i||this,this.transform("translate3d("+e+","+t+","+o+")",i)}arrayDelete(e,t){let o;if(Array.isArray(e)){if(o=e.indexOf(t),o>=0)return e.splice(o,1)}else{if(o=get(this,e).indexOf(t),o>=0)return this.splice(e,o,1)}return null}_logger(e,t){switch(Array.isArray(t)&&1===t.length&&Array.isArray(t[0])&&(t=t[0]),e){case"log":case"warn":case"error":console[e](...t)}}_log(...e){this._logger("log",e)}_warn(...e){this._logger("warn",e)}_error(...e){this._logger("error",e)}_logf(e,...t){return["[%s::%s]",this.is,e,...t]}}return i.prototype.is="",i})),lifecycleProps={attached:!0,detached:!0,ready:!0,created:!0,beforeRegister:!0,registered:!0,attributeChanged:!0,listeners:!0,hostAttributes:!0},excludeOnInfo={attached:!0,detached:!0,ready:!0,created:!0,beforeRegister:!0,registered:!0,attributeChanged:!0,behaviors:!0,_noAccessors:!0},excludeOnBehaviors=Object.assign({listeners:!0,hostAttributes:!0,properties:!0,observers:!0},excludeOnInfo);
/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/function copyProperties(e,t,o){const i=e._noAccessors,r=Object.getOwnPropertyNames(e);for(let s=0;s<r.length;s++){let n=r[s];if(!(n in o))if(i)t[n]=e[n];else{let o=Object.getOwnPropertyDescriptor(e,n);o&&(o.configurable=!0,Object.defineProperty(t,n,o))}}}function mixinBehaviors(e,t){return GenerateClassFromInfo({},LegacyElementMixin(t),e)}function applyBehaviors(e,t,o){for(let i=0;i<t.length;i++)applyInfo(e,t[i],o,excludeOnBehaviors)}function applyInfo(e,t,o,i){copyProperties(t,e,i);for(let e in lifecycleProps)t[e]&&(o[e]=o[e]||[],o[e].push(t[e]))}function flattenBehaviors(e,t,o){t=t||[];for(let i=e.length-1;i>=0;i--){let r=e[i];r?Array.isArray(r)?flattenBehaviors(r,t):t.indexOf(r)<0&&(!o||o.indexOf(r)<0)&&t.unshift(r):console.warn("behavior is null, check for missing or 404 import")}return t}function mergeProperties(e,t){for(const o in t){const i=e[o],r=t[o];e[o]=!("value"in r)&&i&&"value"in i?Object.assign({value:i.value},r):r}}function GenerateClassFromInfo(e,t,o){let i;const r={};class s extends t{static _finalizeClass(){if(this.hasOwnProperty(JSCompiler_renameProperty("generatedFrom",this))){if(i)for(let e,t=0;t<i.length;t++)e=i[t],e.properties&&this.createProperties(e.properties),e.observers&&this.createObservers(e.observers,e.properties);e.properties&&this.createProperties(e.properties),e.observers&&this.createObservers(e.observers,e.properties),this._prepareTemplate()}else t._finalizeClass.call(this)}static get properties(){const t={};if(i)for(let e=0;e<i.length;e++)mergeProperties(t,i[e].properties);return mergeProperties(t,e.properties),t}static get observers(){let t=[];if(i)for(let e,o=0;o<i.length;o++)e=i[o],e.observers&&(t=t.concat(e.observers));return e.observers&&(t=t.concat(e.observers)),t}created(){super.created();const e=r.created;if(e)for(let t=0;t<e.length;t++)e[t].call(this)}_registered(){const e=s.prototype;if(!e.hasOwnProperty(JSCompiler_renameProperty("__hasRegisterFinished",e))){e.__hasRegisterFinished=!0,super._registered();const t=Object.getPrototypeOf(this);let o=r.beforeRegister;if(o)for(let e=0;e<o.length;e++)o[e].call(t);if(o=r.registered,o)for(let e=0;e<o.length;e++)o[e].call(t)}}_applyListeners(){super._applyListeners();const e=r.listeners;if(e)for(let t=0;t<e.length;t++){const o=e[t];if(o)for(let e in o)this._addMethodEventListenerToNode(this,e,o[e])}}_ensureAttributes(){const e=r.hostAttributes;if(e)for(let t=e.length-1;t>=0;t--){const o=e[t];for(let e in o)this._ensureAttribute(e,o[e])}super._ensureAttributes()}ready(){super.ready();let e=r.ready;if(e)for(let t=0;t<e.length;t++)e[t].call(this)}attached(){super.attached();let e=r.attached;if(e)for(let t=0;t<e.length;t++)e[t].call(this)}detached(){super.detached();let e=r.detached;if(e)for(let t=0;t<e.length;t++)e[t].call(this)}attributeChanged(e,t,o){super.attributeChanged();let i=r.attributeChanged;if(i)for(let r=0;r<i.length;r++)i[r].call(this,e,t,o)}}if(o){Array.isArray(o)||(o=[o]);let e=t.prototype.behaviors;i=flattenBehaviors(o,null,e),s.prototype.behaviors=e?e.concat(o):i}return(t=>{i&&applyBehaviors(t,i,r),applyInfo(t,e,r,excludeOnInfo)})(s.prototype),s.generatedFrom=e,s}const Class=function(e,t){e||console.warn("Polymer.Class requires `info` argument");let o=t?t(LegacyElementMixin(HTMLElement)):LegacyElementMixin(HTMLElement);return o=GenerateClassFromInfo(e,o,e.behaviors),o.is=o.prototype.is=e.is,o},Polymer=function(e){let t;return t="function"==typeof e?e:Polymer.Class(e),customElements.define(t.is,t),t};
/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/Polymer.Class=Class;
/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/
const Templatizer={templatize(e,t){this._templatizerTemplate=e,this.ctor=templatize(e,this,{mutableData:Boolean(t),parentModel:this._parentModel,instanceProps:this._instanceProps,forwardHostProp:this._forwardHostPropV2,notifyInstanceProp:this._notifyInstancePropV2})},stamp(e){return new this.ctor(e)},modelForElement(e){return modelForElement(this._templatizerTemplate,e)}};
/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/function hideElementsGlobally(){return!1}
/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/const domBindBase=GestureEventListeners(OptionalMutableData(PropertyEffects(HTMLElement)));class DomBind extends domBindBase{static get observedAttributes(){return["mutable-data"]}constructor(){super(),this.root=null,this.$=null,this.__children=null}attributeChangedCallback(e,t,o,i){this.mutableData=!0}connectedCallback(){hideElementsGlobally()||(this.style.display="none"),this.render()}disconnectedCallback(){this.__removeChildren()}__insertChildren(){wrap(wrap(this).parentNode).insertBefore(this.root,this)}__removeChildren(){if(this.__children)for(let e=0;e<this.__children.length;e++)this.root.appendChild(this.__children[e])}render(){let e;if(!this.__children){if(e=e||this.querySelector("template"),!e){let t=new MutationObserver((()=>{if(e=this.querySelector("template"),!e)throw new Error("dom-bind requires a <template> child");t.disconnect(),this.render()}));return void t.observe(this,{childList:!0})}this.root=this._stampTemplate(e),this.$=this.root.$,this.__children=[];for(let e=this.root.firstChild;e;e=e.nextSibling)this.__children[this.__children.length]=e;this._enableProperties()}this.__insertChildren(),this.dispatchEvent(new CustomEvent("dom-change",{bubbles:!0,composed:!0}))}}customElements.define("dom-bind",DomBind);
/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/
const domRepeatBase=OptionalMutableData(PolymerElement);class DomRepeat extends domRepeatBase{static get is(){return"dom-repeat"}static get template(){return null}static get properties(){return{items:{type:Array},as:{type:String,value:"item"},indexAs:{type:String,value:"index"},itemsIndexAs:{type:String,value:"itemsIndex"},sort:{type:Function,observer:"__sortChanged"},filter:{type:Function,observer:"__filterChanged"},observe:{type:String,observer:"__observeChanged"},delay:Number,renderedItemCount:{type:Number,notify:!0,readOnly:!0},initialCount:{type:Number,observer:"__initializeChunking"},targetFramerate:{type:Number,value:20},_targetFrameTime:{type:Number,computed:"__computeFrameTime(targetFramerate)"}}}static get observers(){return["__itemsChanged(items.*)"]}constructor(){super(),this.__instances=[],this.__limit=1/0,this.__pool=[],this.__renderDebouncer=null,this.__itemsIdxToInstIdx={},this.__chunkCount=null,this.__lastChunkTime=null,this.__sortFn=null,this.__filterFn=null,this.__observePaths=null,this.__ctor=null,this.__isDetached=!0,this.template=null}disconnectedCallback(){super.disconnectedCallback(),this.__isDetached=!0;for(let e=0;e<this.__instances.length;e++)this.__detachInstance(e)}connectedCallback(){if(super.connectedCallback(),hideElementsGlobally()||(this.style.display="none"),this.__isDetached){this.__isDetached=!1;let e=wrap(wrap(this).parentNode);for(let t=0;t<this.__instances.length;t++)this.__attachInstance(t,e)}}__ensureTemplatized(){if(!this.__ctor){let e=this.template=this.querySelector("template");if(!e){let e=new MutationObserver((()=>{if(!this.querySelector("template"))throw new Error("dom-repeat requires a <template> child");e.disconnect(),this.__render()}));return e.observe(this,{childList:!0}),!1}let t={};t[this.as]=!0,t[this.indexAs]=!0,t[this.itemsIndexAs]=!0,this.__ctor=templatize(e,this,{mutableData:this.mutableData,parentModel:!0,instanceProps:t,forwardHostProp:function(e,t){let o=this.__instances;for(let i,r=0;r<o.length&&(i=o[r]);r++)i.forwardHostProp(e,t)},notifyInstanceProp:function(e,t,o){if(matches(this.as,t)){let i=e[this.itemsIndexAs];t==this.as&&(this.items[i]=o);let r=translate(this.as,`${JSCompiler_renameProperty("items",this)}.${i}`,t);this.notifyPath(r,o)}}})}return!0}__getMethodHost(){return this.__dataHost._methodHost||this.__dataHost}__functionFromPropertyValue(e){if("string"==typeof e){let t=e,o=this.__getMethodHost();return function(){return o[t].apply(o,arguments)}}return e}__sortChanged(e){this.__sortFn=this.__functionFromPropertyValue(e),this.items&&this.__debounceRender(this.__render)}__filterChanged(e){this.__filterFn=this.__functionFromPropertyValue(e),this.items&&this.__debounceRender(this.__render)}__computeFrameTime(e){return Math.ceil(1e3/e)}__initializeChunking(){this.initialCount&&(this.__limit=this.initialCount,this.__chunkCount=this.initialCount,this.__lastChunkTime=performance.now())}__tryRenderChunk(){this.items&&this.__limit<this.items.length&&this.__debounceRender(this.__requestRenderChunk)}__requestRenderChunk(){requestAnimationFrame((()=>this.__renderChunk()))}__renderChunk(){let e=performance.now(),t=this._targetFrameTime/(e-this.__lastChunkTime);this.__chunkCount=Math.round(this.__chunkCount*t)||1,this.__limit+=this.__chunkCount,this.__lastChunkTime=e,this.__debounceRender(this.__render)}__observeChanged(){this.__observePaths=this.observe&&this.observe.replace(".*",".").split(" ")}__itemsChanged(e){this.items&&!Array.isArray(this.items)&&console.warn("dom-repeat expected array for `items`, found",this.items),this.__handleItemPath(e.path,e.value)||(this.__initializeChunking(),this.__debounceRender(this.__render))}__handleObservedPaths(e){if(this.__sortFn||this.__filterFn)if(e){if(this.__observePaths){let t=this.__observePaths;for(let o=0;o<t.length;o++)0===e.indexOf(t[o])&&this.__debounceRender(this.__render,this.delay)}}else this.__debounceRender(this.__render,this.delay)}__debounceRender(e,t=0){this.__renderDebouncer=Debouncer.debounce(this.__renderDebouncer,t>0?timeOut.after(t):microTask,e.bind(this)),enqueueDebouncer(this.__renderDebouncer)}render(){this.__debounceRender(this.__render),flush()}__render(){this.__ensureTemplatized()&&(this.__applyFullRefresh(),this.__pool.length=0,this._setRenderedItemCount(this.__instances.length),this.dispatchEvent(new CustomEvent("dom-change",{bubbles:!0,composed:!0})),this.__tryRenderChunk())}__applyFullRefresh(){let e=this.items||[],t=new Array(e.length);for(let o=0;o<e.length;o++)t[o]=o;this.__filterFn&&(t=t.filter(((t,o,i)=>this.__filterFn(e[t],o,i)))),this.__sortFn&&t.sort(((t,o)=>this.__sortFn(e[t],e[o])));const o=this.__itemsIdxToInstIdx={};let i=0;const r=Math.min(t.length,this.__limit);for(;i<r;i++){let r=this.__instances[i],s=t[i],n=e[s];o[s]=i,r?(r._setPendingProperty(this.as,n),r._setPendingProperty(this.indexAs,i),r._setPendingProperty(this.itemsIndexAs,s),r._flushProperties()):this.__insertInstance(n,i,s)}for(let e=this.__instances.length-1;e>=i;e--)this.__detachAndRemoveInstance(e)}__detachInstance(e){let t=this.__instances[e];const o=wrap(t.root);for(let e=0;e<t.children.length;e++){let i=t.children[e];o.appendChild(i)}return t}__attachInstance(e,t){let o=this.__instances[e];t.insertBefore(o.root,this)}__detachAndRemoveInstance(e){let t=this.__detachInstance(e);t&&this.__pool.push(t),this.__instances.splice(e,1)}__stampInstance(e,t,o){let i={};return i[this.as]=e,i[this.indexAs]=t,i[this.itemsIndexAs]=o,new this.__ctor(i)}__insertInstance(e,t,o){let i=this.__pool.pop();i?(i._setPendingProperty(this.as,e),i._setPendingProperty(this.indexAs,t),i._setPendingProperty(this.itemsIndexAs,o),i._flushProperties()):i=this.__stampInstance(e,t,o);let r=this.__instances[t+1],s=r?r.children[0]:this;return wrap(wrap(this).parentNode).insertBefore(i.root,s),this.__instances[t]=i,i}_showHideChildren(e){for(let t=0;t<this.__instances.length;t++)this.__instances[t]._showHideChildren(e)}__handleItemPath(e,t){let o=e.slice(6),i=o.indexOf("."),r=i<0?o:o.substring(0,i);if(r==parseInt(r,10)){let e=i<0?"":o.substring(i+1);this.__handleObservedPaths(e);let s=this.__itemsIdxToInstIdx[r],n=this.__instances[s];if(n){let o=this.as+(e?"."+e:"");n._setPendingPropertyOrPath(o,t,!1,!0),n._flushProperties()}return!0}}itemForElement(e){let t=this.modelForElement(e);return t&&t[this.as]}indexForElement(e){let t=this.modelForElement(e);return t&&t[this.indexAs]}modelForElement(e){return modelForElement(this.template,e)}}customElements.define(DomRepeat.is,DomRepeat);
/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/
class DomIf extends PolymerElement{static get is(){return"dom-if"}static get template(){return null}static get properties(){return{if:{type:Boolean,observer:"__debounceRender"},restamp:{type:Boolean,observer:"__debounceRender"}}}constructor(){super(),this.__renderDebouncer=null,this.__invalidProps=null,this.__instance=null,this._lastIf=!1,this.__ctor=null,this.__hideTemplateChildren__=!1}__debounceRender(){this.__renderDebouncer=Debouncer.debounce(this.__renderDebouncer,microTask,(()=>this.__render())),enqueueDebouncer(this.__renderDebouncer)}disconnectedCallback(){super.disconnectedCallback();const e=wrap(this).parentNode;e&&(e.nodeType!=Node.DOCUMENT_FRAGMENT_NODE||wrap(e).host)||this.__teardownInstance()}connectedCallback(){super.connectedCallback(),hideElementsGlobally()||(this.style.display="none"),this.if&&this.__debounceRender()}render(){flush()}__render(){if(this.if){if(!this.__ensureInstance())return;this._showHideChildren()}else this.restamp&&this.__teardownInstance();!this.restamp&&this.__instance&&this._showHideChildren(),this.if!=this._lastIf&&(this.dispatchEvent(new CustomEvent("dom-change",{bubbles:!0,composed:!0})),this._lastIf=this.if)}__ensureInstance(){let e=wrap(this).parentNode;if(e){if(!this.__ctor){let e=wrap(this).querySelector("template");if(!e){let e=new MutationObserver((()=>{if(!wrap(this).querySelector("template"))throw new Error("dom-if requires a <template> child");e.disconnect(),this.__render()}));return e.observe(this,{childList:!0}),!1}this.__ctor=templatize(e,this,{mutableData:!0,forwardHostProp:function(e,t){this.__instance&&(this.if?this.__instance.forwardHostProp(e,t):(this.__invalidProps=this.__invalidProps||Object.create(null),this.__invalidProps[root(e)]=!0))}})}if(this.__instance){this.__syncHostProperties();let t=this.__instance.children;if(t&&t.length){if(wrap(this).previousSibling!==t[t.length-1])for(let o,i=0;i<t.length&&(o=t[i]);i++)wrap(e).insertBefore(o,this)}}else this.__instance=new this.__ctor,wrap(e).insertBefore(this.__instance.root,this)}return!0}__syncHostProperties(){let e=this.__invalidProps;if(e){for(let t in e)this.__instance._setPendingProperty(t,this.__dataHost[t]);this.__invalidProps=null,this.__instance._flushProperties()}}__teardownInstance(){if(this.__instance){let e=this.__instance.children;if(e&&e.length){let t=wrap(e[0]).parentNode;if(t){t=wrap(t);for(let o,i=0;i<e.length&&(o=e[i]);i++)t.removeChild(o)}}this.__instance=null,this.__invalidProps=null}}_showHideChildren(){let e=this.__hideTemplateChildren__||!this.if;this.__instance&&this.__instance._showHideChildren(e)}}customElements.define(DomIf.is,DomIf);
/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/
let mutablePropertyChange$1,ArraySelectorMixin=dedupingMixin((e=>{let t=ElementMixin(e);return class extends t{static get properties(){return{items:{type:Array},multi:{type:Boolean,value:!1},selected:{type:Object,notify:!0},selectedItem:{type:Object,notify:!0},toggle:{type:Boolean,value:!1}}}static get observers(){return["__updateSelection(multi, items.*)"]}constructor(){super(),this.__lastItems=null,this.__lastMulti=null,this.__selectedMap=null}__updateSelection(e,t){let o=t.path;if(o==JSCompiler_renameProperty("items",this)){let o=t.base||[],i=this.__lastItems;if(e!==this.__lastMulti&&this.clearSelection(),i){let e=calculateSplices(o,i);this.__applySplices(e)}this.__lastItems=o,this.__lastMulti=e}else if(t.path==`${JSCompiler_renameProperty("items",this)}.splices`)this.__applySplices(t.value.indexSplices);else{let e=o.slice(`${JSCompiler_renameProperty("items",this)}.`.length),t=parseInt(e,10);e.indexOf(".")<0&&e==t&&this.__deselectChangedIdx(t)}}__applySplices(e){let t=this.__selectedMap;for(let o=0;o<e.length;o++){let i=e[o];t.forEach(((e,o)=>{e<i.index||(e>=i.index+i.removed.length?t.set(o,e+i.addedCount-i.removed.length):t.set(o,-1))}));for(let e=0;e<i.addedCount;e++){let o=i.index+e;t.has(this.items[o])&&t.set(this.items[o],o)}}this.__updateLinks();let o=0;t.forEach(((e,i)=>{e<0?(this.multi?this.splice(JSCompiler_renameProperty("selected",this),o,1):this.selected=this.selectedItem=null,t.delete(i)):o++}))}__updateLinks(){if(this.__dataLinkedPaths={},this.multi){let e=0;this.__selectedMap.forEach((t=>{t>=0&&this.linkPaths(`${JSCompiler_renameProperty("items",this)}.${t}`,`${JSCompiler_renameProperty("selected",this)}.${e++}`)}))}else this.__selectedMap.forEach((e=>{this.linkPaths(JSCompiler_renameProperty("selected",this),`${JSCompiler_renameProperty("items",this)}.${e}`),this.linkPaths(JSCompiler_renameProperty("selectedItem",this),`${JSCompiler_renameProperty("items",this)}.${e}`)}))}clearSelection(){this.__dataLinkedPaths={},this.__selectedMap=new Map,this.selected=this.multi?[]:null,this.selectedItem=null}isSelected(e){return this.__selectedMap.has(e)}isIndexSelected(e){return this.isSelected(this.items[e])}__deselectChangedIdx(e){let t=this.__selectedIndexForItemIndex(e);if(t>=0){let e=0;this.__selectedMap.forEach(((o,i)=>{t==e++&&this.deselect(i)}))}}__selectedIndexForItemIndex(e){let t=this.__dataLinkedPaths[`${JSCompiler_renameProperty("items",this)}.${e}`];if(t)return parseInt(t.slice(`${JSCompiler_renameProperty("selected",this)}.`.length),10)}deselect(e){let t=this.__selectedMap.get(e);if(t>=0){let o;this.__selectedMap.delete(e),this.multi&&(o=this.__selectedIndexForItemIndex(t)),this.__updateLinks(),this.multi?this.splice(JSCompiler_renameProperty("selected",this),o,1):this.selected=this.selectedItem=null}}deselectIndex(e){this.deselect(this.items[e])}select(e){this.selectIndex(this.items.indexOf(e))}selectIndex(e){let t=this.items[e];this.isSelected(t)?this.toggle&&this.deselectIndex(e):(this.multi||this.__selectedMap.clear(),this.__selectedMap.set(t,e),this.__updateLinks(),this.multi?this.push(JSCompiler_renameProperty("selected",this),t):this.selected=this.selectedItem=t)}}})),baseArraySelector=ArraySelectorMixin(PolymerElement);class ArraySelector extends baseArraySelector{static get is(){return"array-selector"}static get template(){return null}}customElements.define(ArraySelector.is,ArraySelector),mutablePropertyChange$1=MutableData._mutablePropertyChange;const OptionalMutableDataBehavior={properties:{mutableData:Boolean},_shouldPropertyChange(e,t,o){return mutablePropertyChange$1(this,e,t,o,this.mutableData)}},Base=LegacyElementMixin(HTMLElement).prototype,IronA11yAnnouncer=Polymer({_template:html$1`
    <style>
      :host {
        display: inline-block;
        position: fixed;
        clip: rect(0px,0px,0px,0px);
      }
    </style>
    <div aria-live$="[[mode]]">[[_text]]</div>
`,is:"iron-a11y-announcer",properties:{mode:{type:String,value:"polite"},_text:{type:String,value:""}},created:function(){IronA11yAnnouncer.instance||(IronA11yAnnouncer.instance=this),document.body.addEventListener("iron-announce",this._onIronAnnounce.bind(this))},announce:function(e){this._text="",this.async((function(){this._text=e}),100)},_onIronAnnounce:function(e){e.detail&&e.detail.text&&this.announce(e.detail.text)}});
/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/IronA11yAnnouncer.instance=null,IronA11yAnnouncer.requestAvailability=function(){IronA11yAnnouncer.instance||(IronA11yAnnouncer.instance=document.createElement("iron-a11y-announcer")),document.body.appendChild(IronA11yAnnouncer.instance)};
/**
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at
http://polymer.github.io/LICENSE.txt The complete set of authors may be found at
http://polymer.github.io/AUTHORS.txt The complete set of contributors may be
found at http://polymer.github.io/CONTRIBUTORS.txt Code distributed by Google as
part of the polymer project is also subject to an additional IP rights grant
found at http://polymer.github.io/PATENTS.txt
*/
var KEY_IDENTIFIER={"U+0008":"backspace","U+0009":"tab","U+001B":"esc","U+0020":"space","U+007F":"del"},KEY_CODE={8:"backspace",9:"tab",13:"enter",27:"esc",33:"pageup",34:"pagedown",35:"end",36:"home",32:"space",37:"left",38:"up",39:"right",40:"down",46:"del",106:"*"},MODIFIER_KEYS={shift:"shiftKey",ctrl:"ctrlKey",alt:"altKey",meta:"metaKey"},KEY_CHAR=/[a-z0-9*]/,IDENT_CHAR=/U\+/,ARROW_KEY=/^arrow/,SPACE_KEY=/^space(bar)?/,ESC_KEY=/^escape$/;function transformKey(e,t){var o="";if(e){var i=e.toLowerCase();" "===i||SPACE_KEY.test(i)?o="space":ESC_KEY.test(i)?o="esc":1==i.length?t&&!KEY_CHAR.test(i)||(o=i):o=ARROW_KEY.test(i)?i.replace("arrow",""):"multiply"==i?"*":i}return o}function transformKeyIdentifier(e){var t="";return e&&(e in KEY_IDENTIFIER?t=KEY_IDENTIFIER[e]:IDENT_CHAR.test(e)?(e=parseInt(e.replace("U+","0x"),16),t=String.fromCharCode(e).toLowerCase()):t=e.toLowerCase()),t}function transformKeyCode(e){var t="";return Number(e)&&(t=e>=65&&e<=90?String.fromCharCode(32+e):e>=112&&e<=123?"f"+(e-112+1):e>=48&&e<=57?String(e-48):e>=96&&e<=105?String(e-96):KEY_CODE[e]),t}function normalizedKeyForEvent(e,t){return e.key?transformKey(e.key,t):e.detail&&e.detail.key?transformKey(e.detail.key,t):transformKeyIdentifier(e.keyIdentifier)||transformKeyCode(e.keyCode)||""}function keyComboMatchesEvent(e,t){return normalizedKeyForEvent(t,e.hasModifiers)===e.key&&(!e.hasModifiers||!!t.shiftKey==!!e.shiftKey&&!!t.ctrlKey==!!e.ctrlKey&&!!t.altKey==!!e.altKey&&!!t.metaKey==!!e.metaKey)}function parseKeyComboString(e){return 1===e.length?{combo:e,key:e,event:"keydown"}:e.split("+").reduce((function(e,t){var o=t.split(":"),i=o[0],r=o[1];return i in MODIFIER_KEYS?(e[MODIFIER_KEYS[i]]=!0,e.hasModifiers=!0):(e.key=i,e.event=r||"keydown"),e}),{combo:e.split(":").shift()})}function parseEventString(e){return e.trim().split(" ").map((function(e){return parseKeyComboString(e)}))}const IronA11yKeysBehavior={properties:{keyEventTarget:{type:Object,value:function(){return this}},stopKeyboardEventPropagation:{type:Boolean,value:!1},_boundKeyHandlers:{type:Array,value:function(){return[]}},_imperativeKeyBindings:{type:Object,value:function(){return{}}}},observers:["_resetKeyEventListeners(keyEventTarget, _boundKeyHandlers)"],keyBindings:{},registered:function(){this._prepKeyBindings()},attached:function(){this._listenKeyEventListeners()},detached:function(){this._unlistenKeyEventListeners()},addOwnKeyBinding:function(e,t){this._imperativeKeyBindings[e]=t,this._prepKeyBindings(),this._resetKeyEventListeners()},removeOwnKeyBindings:function(){this._imperativeKeyBindings={},this._prepKeyBindings(),this._resetKeyEventListeners()},keyboardEventMatchesKeys:function(e,t){for(var o=parseEventString(t),i=0;i<o.length;++i)if(keyComboMatchesEvent(o[i],e))return!0;return!1},_collectKeyBindings:function(){var e=this.behaviors.map((function(e){return e.keyBindings}));return-1===e.indexOf(this.keyBindings)&&e.push(this.keyBindings),e},_prepKeyBindings:function(){for(var e in this._keyBindings={},this._collectKeyBindings().forEach((function(e){for(var t in e)this._addKeyBinding(t,e[t])}),this),this._imperativeKeyBindings)this._addKeyBinding(e,this._imperativeKeyBindings[e]);for(var t in this._keyBindings)this._keyBindings[t].sort((function(e,t){var o=e[0].hasModifiers;return o===t[0].hasModifiers?0:o?-1:1}))},_addKeyBinding:function(e,t){parseEventString(e).forEach((function(e){this._keyBindings[e.event]=this._keyBindings[e.event]||[],this._keyBindings[e.event].push([e,t])}),this)},_resetKeyEventListeners:function(){this._unlistenKeyEventListeners(),this.isAttached&&this._listenKeyEventListeners()},_listenKeyEventListeners:function(){this.keyEventTarget&&Object.keys(this._keyBindings).forEach((function(e){var t=this._keyBindings[e],o=this._onKeyBindingEvent.bind(this,t);this._boundKeyHandlers.push([this.keyEventTarget,e,o]),this.keyEventTarget.addEventListener(e,o)}),this)},_unlistenKeyEventListeners:function(){for(var e,t,o,i;this._boundKeyHandlers.length;)t=(e=this._boundKeyHandlers.pop())[0],o=e[1],i=e[2],t.removeEventListener(o,i)},_onKeyBindingEvent:function(e,t){if(this.stopKeyboardEventPropagation&&t.stopPropagation(),!t.defaultPrevented)for(var o=0;o<e.length;o++){var i=e[o][0],r=e[o][1];if(keyComboMatchesEvent(i,t)&&(this._triggerKeyHandler(i,r,t),t.defaultPrevented))return}},_triggerKeyHandler:function(e,t,o){var i=Object.create(e);i.keyboardEvent=o;var r=new CustomEvent(e.event,{detail:i,cancelable:!0});this[t].call(this,r),r.defaultPrevented&&o.preventDefault()}},ComboBoxPlaceholder=class{toString(){return""}},ComboBoxMixin=e=>class extends e{static get properties(){return{opened:{type:Boolean,notify:!0,value:!1,reflectToAttribute:!0,observer:"_openedChanged"},disabled:{type:Boolean,value:!1,reflectToAttribute:!0},readonly:{type:Boolean,value:!1,reflectToAttribute:!0},renderer:Function,items:{type:Array,observer:"_itemsChanged"},allowCustomValue:{type:Boolean,value:!1},filteredItems:{type:Array},value:{type:String,observer:"_valueChanged",notify:!0,value:""},_lastCommittedValue:String,loading:{type:Boolean,value:!1,reflectToAttribute:!0},_focusedIndex:{type:Number,value:-1},filter:{type:String,value:"",notify:!0},selectedItem:{type:Object,notify:!0},itemLabelPath:{type:String,value:"label",observer:"_itemLabelPathChanged"},itemValuePath:{type:String,value:"value"},itemIdPath:String,name:{type:String},invalid:{type:Boolean,reflectToAttribute:!0,notify:!0,value:!1},_toggleElement:Object,_clearElement:Object,_inputElementValue:String,_closeOnBlurIsPrevented:Boolean,_previousDocumentPointerEvents:String,_itemTemplate:Object}}static get observers(){return["_filterChanged(filter, itemValuePath, itemLabelPath)","_itemsOrPathsChanged(items.*, itemValuePath, itemLabelPath)","_filteredItemsChanged(filteredItems.*, itemValuePath, itemLabelPath)","_templateOrRendererChanged(_itemTemplate, renderer)","_loadingChanged(loading)","_selectedItemChanged(selectedItem, itemLabelPath)","_toggleElementChanged(_toggleElement)"]}constructor(){super(),this._boundOnFocusout=this._onFocusout.bind(this),this._boundOverlaySelectedItemChanged=this._overlaySelectedItemChanged.bind(this),this._boundClose=this.close.bind(this),this._boundOnOpened=this._onOpened.bind(this),this._boundOnKeyDown=this._onKeyDown.bind(this),this._boundOnClick=this._onClick.bind(this),this._boundOnOverlayTouchAction=this._onOverlayTouchAction.bind(this),this._boundOnTouchend=this._onTouchend.bind(this)}ready(){super.ready(),this.addEventListener("focusout",this._boundOnFocusout),this._lastCommittedValue=this.value,IronA11yAnnouncer.requestAvailability(),this.$.overlay.addEventListener("selection-changed",this._boundOverlaySelectedItemChanged),this.addEventListener("vaadin-combo-box-dropdown-closed",this._boundClose),this.addEventListener("vaadin-combo-box-dropdown-opened",this._boundOnOpened),this.addEventListener("keydown",this._boundOnKeyDown),this.addEventListener("click",this._boundOnClick),this.$.overlay.addEventListener("vaadin-overlay-touch-action",this._boundOnOverlayTouchAction),this.addEventListener("touchend",this._boundOnTouchend),this._observer=new FlattenedNodesObserver(this,(e=>{this._setTemplateFromNodes(e.addedNodes)}))}render(){this.$.overlay._selector&&this.$.overlay._selector.querySelectorAll("vaadin-combo-box-item").forEach((e=>e._render()))}_setTemplateFromNodes(e){this._itemTemplate=e.filter((e=>e.localName&&"template"===e.localName))[0]||this._itemTemplate}_removeNewRendererOrTemplate(e,t,o,i){e!==t?this._itemTemplate=void 0:o!==i&&(this.renderer=void 0)}_templateOrRendererChanged(e,t){if(e&&t)throw this._removeNewRendererOrTemplate(e,this._oldTemplate,t,this._oldRenderer),new Error("You should only use either a renderer or a template for combo box items");this._oldTemplate=e,this._oldRenderer=t}open(){this.disabled||this.readonly||(this.opened=!0)}close(){this.opened=!1}_openedChanged(e,t){void 0!==t&&(this.opened?(this._openedWithFocusRing=this.hasAttribute("focus-ring")||this.focusElement&&this.focusElement.hasAttribute("focus-ring"),this.hasAttribute("focused")||this.$.overlay.touchDevice||this.focus()):(this._onClosed(),this._openedWithFocusRing&&this.hasAttribute("focused")&&this.focusElement.setAttribute("focus-ring","")))}_onOverlayTouchAction(e){this._closeOnBlurIsPrevented=!0,this.inputElement.blur(),this._closeOnBlurIsPrevented=!1}_onClick(e){this._closeOnBlurIsPrevented=!0;const t=e.composedPath();-1!==t.indexOf(this._clearElement)||"clear-button"===t[0].getAttribute("part")?(this._clear(),this.focus()):-1!==t.indexOf(this.inputElement)&&(t.indexOf(this._toggleElement)>-1&&this.opened?this.close():this.open()),this._closeOnBlurIsPrevented=!1}_onKeyDown(e){this._isEventKey(e,"down")?(this._closeOnBlurIsPrevented=!0,this._onArrowDown(),this._closeOnBlurIsPrevented=!1,e.preventDefault()):this._isEventKey(e,"up")?(this._closeOnBlurIsPrevented=!0,this._onArrowUp(),this._closeOnBlurIsPrevented=!1,e.preventDefault()):this._isEventKey(e,"enter")?this._onEnter(e):this._isEventKey(e,"esc")&&this._onEscape(e)}_isEventKey(e,t){return IronA11yKeysBehavior.keyboardEventMatchesKeys(e,t)}_getItemLabel(e){return this.$.overlay.getItemLabel(e)}_getItemValue(e){let t=e&&this.itemValuePath?this.get(this.itemValuePath,e):void 0;return void 0===t&&(t=e?e.toString():""),t}_onArrowDown(){this.opened?this.$.overlay._items&&(this._focusedIndex=Math.min(this.$.overlay._items.length-1,this._focusedIndex+1),this._prefillFocusedItemLabel()):this.open()}_onArrowUp(){this.opened?(this._focusedIndex>-1?this._focusedIndex=Math.max(0,this._focusedIndex-1):this.$.overlay._items&&(this._focusedIndex=this.$.overlay._items.length-1),this._prefillFocusedItemLabel()):this.open()}_prefillFocusedItemLabel(){this._focusedIndex>-1&&(this._inputElementValue="",setTimeout((()=>{this._inputElementValue=this._getItemLabel(this.$.overlay._focusedItem),this._markAllSelectionRange()}),1))}_setSelectionRange(e,t){const o=this._nativeInput||this.inputElement;if(this.hasAttribute("focused")&&o&&o.setSelectionRange)try{o.setSelectionRange(e,t)}catch(e){}}_markAllSelectionRange(){void 0!==this._inputElementValue&&this._setSelectionRange(0,this._inputElementValue.length)}_clearSelectionRange(){if(void 0!==this._inputElementValue){const e=this._inputElementValue?this._inputElementValue.length:0;this._setSelectionRange(e,e)}}_onEnter(e){this.opened&&(this.allowCustomValue||""===this._inputElementValue||this._focusedIndex>-1)&&(this.close(),e.preventDefault(),e.stopPropagation())}_onEscape(e){this.opened&&(this._stopPropagation(e),this._focusedIndex>-1?(this._focusedIndex=-1,this._revertInputValue()):this.cancel())}_toggleElementChanged(e){e&&(e.addEventListener("mousedown",(e=>e.preventDefault())),e.addEventListener("click",(e=>{this.$.overlay.touchDevice&&!this.hasAttribute("focused")&&document.activeElement.blur()})))}_clear(){this.selectedItem=null,this.allowCustomValue&&(this.value=""),this._detectAndDispatchChange()}cancel(){this._revertInputValueToValue(),this._lastCommittedValue=this.value,this.close()}_onOpened(){flush(),this.$.overlay.ensureItemsRendered(),this.$.overlay._selector.toggleScrollListener(!0),this.$.overlay.updateViewportBoundaries(),this.$.overlay._selector._increasePoolIfNeeded(),setTimeout((()=>this._resizeDropdown()),1),window.requestAnimationFrame((()=>this.$.overlay.adjustScrollPosition())),this._lastCommittedValue=this.value}_onClosed(){if(this.opened&&this.close(),this.$.overlay._items&&this._focusedIndex>-1){const e=this.$.overlay._items[this._focusedIndex];this.selectedItem!==e&&(this.selectedItem=e),this._inputElementValue=this._getItemLabel(this.selectedItem)}else if(""===this._inputElementValue||void 0===this._inputElementValue)this.selectedItem=null,this.allowCustomValue&&(this.value="");else if(!this.allowCustomValue||this.filteredItems&&this.filteredItems.filter((e=>this._getItemLabel(e)===this._inputElementValue)).length)this._inputElementValue=this.selectedItem?this._getItemLabel(this.selectedItem):this.value||"";else{const e=new CustomEvent("custom-value-set",{detail:this._inputElementValue,composed:!0,cancelable:!0,bubbles:!0});if(this.dispatchEvent(e),!e.defaultPrevented){const e=this._inputElementValue;this._selectItemForValue(e),this.value=e}}this._detectAndDispatchChange(),this._clearSelectionRange(),this.dataProvider||(this.filter="")}get _propertyForValue(){return"value"}_inputValueChanged(e){-1!==e.composedPath().indexOf(this.inputElement)&&(this._inputElementValue=this.inputElement[this._propertyForValue],this._filterFromInput(e))}_filterFromInput(e){this.opened||e.__fromClearButton||this.open(),this.filter===this._inputElementValue?this._filterChanged(this.filter,this.itemValuePath,this.itemLabelPath):this.filter=this._inputElementValue}_itemLabelPathChanged(e,t){"string"!=typeof e&&console.error("You should set itemLabelPath to a valid string")}_filterChanged(e,t,o){void 0!==e&&(this.items?this.filteredItems=this._filterItems(this.items,e):this._filteredItemsChanged({path:"filteredItems",value:this.filteredItems},t,o))}_loadingChanged(e){e&&(this._focusedIndex=-1)}_revertInputValue(){""!==this.filter?this._inputElementValue=this.filter:this._revertInputValueToValue(),this._clearSelectionRange()}_revertInputValueToValue(){this.allowCustomValue&&!this.selectedItem?this._inputElementValue=this.value:this._inputElementValue=this._getItemLabel(this.selectedItem)}_resizeDropdown(){this.$.overlay.$.dropdown.notifyResize()}_updateHasValue(e){e?this.setAttribute("has-value",""):this.removeAttribute("has-value")}_selectedItemChanged(e,t){if(null==e)this.filteredItems&&(this.allowCustomValue||(this.value=""),this._updateHasValue(""!==this.value),this._inputElementValue=this.value);else{const t=this._getItemValue(e);if(this.value!==t&&(this.value=t,this.value!==t))return;this._updateHasValue(!0),this._inputElementValue=this._getItemLabel(e),this.inputElement&&(this.inputElement[this._propertyForValue]=this._inputElementValue)}this.$.overlay._selectedItem=e,this.filteredItems&&this.$.overlay._items&&(this._focusedIndex=this.filteredItems.indexOf(e))}_valueChanged(e,t){if(""!==e||void 0!==t){if(this._isValidValue(e)){let t;this._getItemValue(this.selectedItem)!==e?this._selectItemForValue(e):t=this.selectedItem,!t&&this.allowCustomValue&&(this._inputElementValue=e),this._updateHasValue(""!==this.value)}else this.selectedItem=null;this._lastCommittedValue=void 0}}_detectAndDispatchChange(){this.value!==this._lastCommittedValue&&(this.dispatchEvent(new CustomEvent("change",{bubbles:!0})),this._lastCommittedValue=this.value)}_itemsChanged(e,t){this._ensureItemsOrDataProvider((()=>{this.items=t}))}_itemsOrPathsChanged(e,t,o){if(void 0!==e.value&&("items"===e.path||"items.splices"===e.path)){this.filteredItems=this.items?this.items.slice(0):this.items;const e=this._indexOfValue(this.value,this.items);this._focusedIndex=e;const t=e>-1&&this.items[e];t&&(this.selectedItem=t)}}_filteredItemsChanged(e,t,o){void 0!==e.value&&("filteredItems"!==e.path&&"filteredItems.splices"!==e.path||(this._setOverlayItems(this.filteredItems),this._focusedIndex=this.opened?this.$.overlay.indexOfLabel(this.filter):this._indexOfValue(this.value,this.filteredItems),this.opened&&this._repositionOverlay()))}_filterItems(e,t){return e?e.filter((e=>(t=t?t.toString().toLowerCase():"",this._getItemLabel(e).toString().toLowerCase().indexOf(t)>-1))):e}_selectItemForValue(e){const t=this._indexOfValue(e,this.filteredItems),o=this.selectedItem;this.selectedItem=t>=0?this.filteredItems[t]:this.dataProvider&&void 0===this.selectedItem?void 0:null,null===this.selectedItem&&null===o&&this._selectedItemChanged(this.selectedItem)}_setOverlayItems(e){this.$.overlay.set("_items",e)}_repositionOverlay(){this.__repositionOverlayDebouncer=Debouncer.debounce(this.__repositionOverlayDebouncer,timeOut.after(500),(()=>{const e=this.$.overlay._selector;e._isClientFull()||e._resetScrollPosition(e._physicalTop),this._resizeDropdown(),this.$.overlay.updateViewportBoundaries(),this.$.overlay.ensureItemsRendered(),e.notifyResize(),flush()}))}_indexOfValue(e,t){if(t&&this._isValidValue(e))for(let o=0;o<t.length;o++)if(this._getItemValue(t[o])===e)return o;return-1}_isValidValue(e){return null!=e}_overlaySelectedItemChanged(e){e.stopPropagation(),e.detail.item instanceof ComboBoxPlaceholder||(this.opened?(this._focusedIndex=this.filteredItems.indexOf(e.detail.item),this.close()):this.selectedItem!==e.detail.item&&(this.selectedItem=e.detail.item,this._detectAndDispatchChange()))}_onFocusout(e){const t=this.$.overlay.$.dropdown;t&&t.$&&e.relatedTarget===t.$.overlay?e.composedPath()[0].focus():this._closeOnBlurIsPrevented||this.close()}_onTouchend(e){this._clearElement&&e.composedPath()[0]===this._clearElement&&(e.preventDefault(),this._clear())}validate(){return!(this.invalid=!this.checkValidity())}checkValidity(){if(this.inputElement.validate)return this.inputElement.validate()}get _instanceProps(){return{item:!0,index:!0,selected:!0,focused:!0}}_ensureTemplatized(){if(!this._TemplateClass){const e=this._itemTemplate||this._getRootTemplate();e&&(this._TemplateClass=templatize(e,this,{instanceProps:this._instanceProps,forwardHostProp:function(e,t){const o=this.$.overlay._selector.querySelectorAll("vaadin-combo-box-item");Array.prototype.forEach.call(o,(o=>{o._itemTemplateInstance&&(o._itemTemplateInstance.set(e,t),o._itemTemplateInstance.notifyPath(e,t,!0))}))}}))}}_getRootTemplate(){return Array.prototype.filter.call(this.children,(e=>"TEMPLATE"===e.tagName))[0]}_preventInputBlur(){this._toggleElement&&this._toggleElement.addEventListener("click",this._preventDefault),this._clearElement&&this._clearElement.addEventListener("click",this._preventDefault)}_restoreInputBlur(){this._toggleElement&&this._toggleElement.removeEventListener("click",this._preventDefault),this._clearElement&&this._clearElement.removeEventListener("click",this._preventDefault)}_preventDefault(e){e.preventDefault()}_stopPropagation(e){e.stopPropagation()}}
/**
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at
http://polymer.github.io/LICENSE.txt The complete set of authors may be found at
http://polymer.github.io/AUTHORS.txt The complete set of contributors may be
found at http://polymer.github.io/CONTRIBUTORS.txt Code distributed by Google as
part of the polymer project is also subject to an additional IP rights grant
found at http://polymer.github.io/PATENTS.txt
*/;
/**
@license
Copyright (c) 2018 Vaadin Ltd.
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
*/var ORPHANS=new Set;const IronResizableBehavior={properties:{_parentResizable:{type:Object,observer:"_parentResizableChanged"},_notifyingDescendant:{type:Boolean,value:!1}},listeners:{"iron-request-resize-notifications":"_onIronRequestResizeNotifications"},created:function(){this._interestedResizables=[],this._boundNotifyResize=this.notifyResize.bind(this),this._boundOnDescendantIronResize=this._onDescendantIronResize.bind(this)},attached:function(){this._requestResizeNotifications()},detached:function(){this._parentResizable?this._parentResizable.stopResizeNotificationsFor(this):(ORPHANS.delete(this),window.removeEventListener("resize",this._boundNotifyResize)),this._parentResizable=null},notifyResize:function(){this.isAttached&&(this._interestedResizables.forEach((function(e){this.resizerShouldNotify(e)&&this._notifyDescendant(e)}),this),this._fireResize())},assignParentResizable:function(e){this._parentResizable&&this._parentResizable.stopResizeNotificationsFor(this),this._parentResizable=e,e&&-1===e._interestedResizables.indexOf(this)&&(e._interestedResizables.push(this),e._subscribeIronResize(this))},stopResizeNotificationsFor:function(e){var t=this._interestedResizables.indexOf(e);t>-1&&(this._interestedResizables.splice(t,1),this._unsubscribeIronResize(e))},_subscribeIronResize:function(e){e.addEventListener("iron-resize",this._boundOnDescendantIronResize)},_unsubscribeIronResize:function(e){e.removeEventListener("iron-resize",this._boundOnDescendantIronResize)},resizerShouldNotify:function(e){return!0},_onDescendantIronResize:function(e){this._notifyingDescendant?e.stopPropagation():useShadow||this._fireResize()},_fireResize:function(){this.fire("iron-resize",null,{node:this,bubbles:!1})},_onIronRequestResizeNotifications:function(e){var t=dom(e).rootTarget;t!==this&&(t.assignParentResizable(this),this._notifyDescendant(t),e.stopPropagation())},_parentResizableChanged:function(e){e&&window.removeEventListener("resize",this._boundNotifyResize)},_notifyDescendant:function(e){this.isAttached&&(this._notifyingDescendant=!0,e.notifyResize(),this._notifyingDescendant=!1)},_requestResizeNotifications:function(){if(this.isAttached)if("loading"===document.readyState){var e=this._requestResizeNotifications.bind(this);document.addEventListener("readystatechange",(function t(){document.removeEventListener("readystatechange",t),e()}))}else this._findParent(),this._parentResizable?this._parentResizable._interestedResizables.forEach((function(e){e!==this&&e._findParent()}),this):(ORPHANS.forEach((function(e){e!==this&&e._findParent()}),this),window.addEventListener("resize",this._boundNotifyResize),this.notifyResize())},_findParent:function(){this.assignParentResizable(null),this.fire("iron-request-resize-notifications",null,{node:this,bubbles:!0,cancelable:!0}),this._parentResizable?ORPHANS.delete(this):ORPHANS.add(this)}},IronScrollTargetBehavior={properties:{scrollTarget:{type:HTMLElement,value:function(){return this._defaultScrollTarget}}},observers:["_scrollTargetChanged(scrollTarget, isAttached)"],_shouldHaveListener:!0,_scrollTargetChanged:function(e,t){if(this._oldScrollTarget&&(this._toggleScrollListener(!1,this._oldScrollTarget),this._oldScrollTarget=null),t)if("document"===e)this.scrollTarget=this._doc;else if("string"==typeof e){var o=this.domHost;this.scrollTarget=o&&o.$?o.$[e]:dom(this.ownerDocument).querySelector("#"+e)}else this._isValidScrollTarget()&&(this._oldScrollTarget=e,this._toggleScrollListener(this._shouldHaveListener,e))},_scrollHandler:function(){},get _defaultScrollTarget(){return this._doc},get _doc(){return this.ownerDocument.documentElement},get _scrollTop(){return this._isValidScrollTarget()?this.scrollTarget===this._doc?window.pageYOffset:this.scrollTarget.scrollTop:0},get _scrollLeft(){return this._isValidScrollTarget()?this.scrollTarget===this._doc?window.pageXOffset:this.scrollTarget.scrollLeft:0},set _scrollTop(e){this.scrollTarget===this._doc?window.scrollTo(window.pageXOffset,e):this._isValidScrollTarget()&&(this.scrollTarget.scrollTop=e)},set _scrollLeft(e){this.scrollTarget===this._doc?window.scrollTo(e,window.pageYOffset):this._isValidScrollTarget()&&(this.scrollTarget.scrollLeft=e)},scroll:function(e,t){var o;"object"==typeof e?(o=e.left,t=e.top):o=e,o=o||0,t=t||0,this.scrollTarget===this._doc?window.scrollTo(o,t):this._isValidScrollTarget()&&(this.scrollTarget.scrollLeft=o,this.scrollTarget.scrollTop=t)},get _scrollTargetWidth(){return this._isValidScrollTarget()?this.scrollTarget===this._doc?window.innerWidth:this.scrollTarget.offsetWidth:0},get _scrollTargetHeight(){return this._isValidScrollTarget()?this.scrollTarget===this._doc?window.innerHeight:this.scrollTarget.offsetHeight:0},_isValidScrollTarget:function(){return this.scrollTarget instanceof HTMLElement},_toggleScrollListener:function(e,t){var o=t===this._doc?window:t;e?this._boundScrollHandler||(this._boundScrollHandler=this._scrollHandler.bind(this),o.addEventListener("scroll",this._boundScrollHandler)):this._boundScrollHandler&&(o.removeEventListener("scroll",this._boundScrollHandler),this._boundScrollHandler=null)},toggleScrollListener:function(e){this._shouldHaveListener=e,this._toggleScrollListener(e,this.scrollTarget)}};
/**
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at
http://polymer.github.io/LICENSE.txt The complete set of authors may be found at
http://polymer.github.io/AUTHORS.txt The complete set of contributors may be
found at http://polymer.github.io/CONTRIBUTORS.txt Code distributed by Google as
part of the polymer project is also subject to an additional IP rights grant
found at http://polymer.github.io/PATENTS.txt
*/
/**
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at
http://polymer.github.io/LICENSE.txt The complete set of authors may be found at
http://polymer.github.io/AUTHORS.txt The complete set of contributors may be
found at http://polymer.github.io/CONTRIBUTORS.txt Code distributed by Google as
part of the polymer project is also subject to an additional IP rights grant
found at http://polymer.github.io/PATENTS.txt
*/
var IOS=navigator.userAgent.match(/iP(?:hone|ad;(?: U;)? CPU) OS (\d+)/),IOS_TOUCH_SCROLLING=IOS&&IOS[1]>=8,DEFAULT_PHYSICAL_COUNT=3,HIDDEN_Y="-10000px",SECRET_TABINDEX=-100;Polymer({_template:html$1`
    <style>
      :host {
        display: block;
      }

      @media only screen and (-webkit-max-device-pixel-ratio: 1) {
        :host {
          will-change: transform;
        }
      }

      #items {
        @apply --iron-list-items-container;
        position: relative;
      }

      :host(:not([grid])) #items > ::slotted(*) {
        width: 100%;
      }

      #items > ::slotted(*) {
        box-sizing: border-box;
        margin: 0;
        position: absolute;
        top: 0;
        will-change: transform;
      }
    </style>

    <array-selector id="selector" items="{{items}}" selected="{{selectedItems}}" selected-item="{{selectedItem}}"></array-selector>

    <div id="items">
      <slot></slot>
    </div>
`,is:"iron-list",properties:{items:{type:Array},as:{type:String,value:"item"},indexAs:{type:String,value:"index"},selectedAs:{type:String,value:"selected"},grid:{type:Boolean,value:!1,reflectToAttribute:!0,observer:"_gridChanged"},selectionEnabled:{type:Boolean,value:!1},selectedItem:{type:Object,notify:!0},selectedItems:{type:Object,notify:!0},multiSelection:{type:Boolean,value:!1},scrollOffset:{type:Number,value:0}},observers:["_itemsChanged(items.*)","_selectionEnabledChanged(selectionEnabled)","_multiSelectionChanged(multiSelection)","_setOverflow(scrollTarget, scrollOffset)"],behaviors:[Templatizer,IronResizableBehavior,IronScrollTargetBehavior,OptionalMutableDataBehavior],_ratio:.5,_scrollerPaddingTop:0,_scrollPosition:0,_physicalSize:0,_physicalAverage:0,_physicalAverageCount:0,_physicalTop:0,_virtualCount:0,_estScrollHeight:0,_scrollHeight:0,_viewportHeight:0,_viewportWidth:0,_physicalItems:null,_physicalSizes:null,_firstVisibleIndexVal:null,_lastVisibleIndexVal:null,_maxPages:2,_focusedItem:null,_focusedVirtualIndex:-1,_focusedPhysicalIndex:-1,_offscreenFocusedItem:null,_focusBackfillItem:null,_itemsPerRow:1,_itemWidth:0,_rowHeight:0,_templateCost:0,_parentModel:!0,get _physicalBottom(){return this._physicalTop+this._physicalSize},get _scrollBottom(){return this._scrollPosition+this._viewportHeight},get _virtualEnd(){return this._virtualStart+this._physicalCount-1},get _hiddenContentSize(){return(this.grid?this._physicalRows*this._rowHeight:this._physicalSize)-this._viewportHeight},get _itemsParent(){return dom(dom(this._userTemplate).parentNode)},get _maxScrollTop(){return this._estScrollHeight-this._viewportHeight+this._scrollOffset},get _maxVirtualStart(){var e=this._convertIndexToCompleteRow(this._virtualCount);return Math.max(0,e-this._physicalCount)},set _virtualStart(e){e=this._clamp(e,0,this._maxVirtualStart),this.grid&&(e-=e%this._itemsPerRow),this._virtualStartVal=e},get _virtualStart(){return this._virtualStartVal||0},set _physicalStart(e){(e%=this._physicalCount)<0&&(e=this._physicalCount+e),this.grid&&(e-=e%this._itemsPerRow),this._physicalStartVal=e},get _physicalStart(){return this._physicalStartVal||0},get _physicalEnd(){return(this._physicalStart+this._physicalCount-1)%this._physicalCount},set _physicalCount(e){this._physicalCountVal=e},get _physicalCount(){return this._physicalCountVal||0},get _optPhysicalSize(){return 0===this._viewportHeight?1/0:this._viewportHeight*this._maxPages},get _isVisible(){return Boolean(this.offsetWidth||this.offsetHeight)},get firstVisibleIndex(){var e=this._firstVisibleIndexVal;if(null==e){var t=this._physicalTop+this._scrollOffset;e=this._iterateItems((function(e,o){return(t+=this._getPhysicalSizeIncrement(e))>this._scrollPosition?this.grid?o-o%this._itemsPerRow:o:this.grid&&this._virtualCount-1===o?o-o%this._itemsPerRow:void 0}))||0,this._firstVisibleIndexVal=e}return e},get lastVisibleIndex(){var e=this._lastVisibleIndexVal;if(null==e){if(this.grid)e=Math.min(this._virtualCount,this.firstVisibleIndex+this._estRowsInView*this._itemsPerRow-1);else{var t=this._physicalTop+this._scrollOffset;this._iterateItems((function(o,i){t<this._scrollBottom&&(e=i),t+=this._getPhysicalSizeIncrement(o)}))}this._lastVisibleIndexVal=e}return e},get _defaultScrollTarget(){return this},get _virtualRowCount(){return Math.ceil(this._virtualCount/this._itemsPerRow)},get _estRowsInView(){return Math.ceil(this._viewportHeight/this._rowHeight)},get _physicalRows(){return Math.ceil(this._physicalCount/this._itemsPerRow)},get _scrollOffset(){return this._scrollerPaddingTop+this.scrollOffset},ready:function(){this.addEventListener("focus",this._didFocus.bind(this),!0)},attached:function(){this._debounce("_render",this._render,animationFrame),this.listen(this,"iron-resize","_resizeHandler"),this.listen(this,"keydown","_keydownHandler")},detached:function(){this.unlisten(this,"iron-resize","_resizeHandler"),this.unlisten(this,"keydown","_keydownHandler")},_setOverflow:function(e){this.style.webkitOverflowScrolling=e===this?"touch":"",this.style.overflowY=e===this?"auto":"",this._lastVisibleIndexVal=null,this._firstVisibleIndexVal=null,this._debounce("_render",this._render,animationFrame)},updateViewportBoundaries:function(){var e=window.getComputedStyle(this);this._scrollerPaddingTop=this.scrollTarget===this?0:parseInt(e["padding-top"],10),this._isRTL=Boolean("rtl"===e.direction),this._viewportWidth=this.$.items.offsetWidth,this._viewportHeight=this._scrollTargetHeight,this.grid&&this._updateGridMetrics()},_scrollHandler:function(){var e=Math.max(0,Math.min(this._maxScrollTop,this._scrollTop)),t=e-this._scrollPosition,o=t>=0;if(this._scrollPosition=e,this._firstVisibleIndexVal=null,this._lastVisibleIndexVal=null,Math.abs(t)>this._physicalSize&&this._physicalSize>0){t-=this._scrollOffset;var i=Math.round(t/this._physicalAverage)*this._itemsPerRow;this._virtualStart=this._virtualStart+i,this._physicalStart=this._physicalStart+i,this._physicalTop=Math.min(Math.floor(this._virtualStart/this._itemsPerRow)*this._physicalAverage,this._scrollPosition),this._update()}else if(this._physicalCount>0){var r=this._getReusables(o);o?(this._physicalTop=r.physicalTop,this._virtualStart=this._virtualStart+r.indexes.length,this._physicalStart=this._physicalStart+r.indexes.length):(this._virtualStart=this._virtualStart-r.indexes.length,this._physicalStart=this._physicalStart-r.indexes.length),this._update(r.indexes,o?null:r.indexes),this._debounce("_increasePoolIfNeeded",this._increasePoolIfNeeded.bind(this,0),microTask)}},_getReusables:function(e){var t,o,i,r=[],s=this._hiddenContentSize*this._ratio,n=this._virtualStart,a=this._virtualEnd,l=this._physicalCount,c=this._physicalTop+this._scrollOffset,d=this._physicalBottom+this._scrollOffset,h=this._scrollPosition,p=this._scrollBottom;for(e?(t=this._physicalStart,this._physicalEnd,o=h-c):(t=this._physicalEnd,this._physicalStart,o=d-p);o-=i=this._getPhysicalSizeIncrement(t),!(r.length>=l||o<=s);)if(e){if(a+r.length+1>=this._virtualCount)break;if(c+i>=h-this._scrollOffset)break;r.push(t),c+=i,t=(t+1)%l}else{if(n-r.length<=0)break;if(c+this._physicalSize-i<=p)break;r.push(t),c-=i,t=0===t?l-1:t-1}return{indexes:r,physicalTop:c-this._scrollOffset}},_update:function(e,t){if(!(e&&0===e.length||0===this._physicalCount)){if(this._manageFocus(),this._assignModels(e),this._updateMetrics(e),t)for(;t.length;){var o=t.pop();this._physicalTop-=this._getPhysicalSizeIncrement(o)}this._positionItems(),this._updateScrollerSize()}},_createPool:function(e){var t,o;this._ensureTemplatized();var i=new Array(e);for(t=0;t<e;t++)o=this.stamp(null),i[t]=o.root.querySelector("*"),this._itemsParent.appendChild(o.root);return i},_isClientFull:function(){return 0!=this._scrollBottom&&this._physicalBottom-1>=this._scrollBottom&&this._physicalTop<=this._scrollPosition},_increasePoolIfNeeded:function(e){var t=this._clamp(this._physicalCount+e,DEFAULT_PHYSICAL_COUNT,this._virtualCount-this._virtualStart);if(t=this._convertIndexToCompleteRow(t),this.grid){var o=t%this._itemsPerRow;o&&t-o<=this._physicalCount&&(t+=this._itemsPerRow),t-=o}var i=t-this._physicalCount,r=Math.round(.5*this._physicalCount);if(!(i<0)){if(i>0){var s=window.performance.now();[].push.apply(this._physicalItems,this._createPool(i));for(var n=0;n<i;n++)this._physicalSizes.push(0);this._physicalCount=this._physicalCount+i,this._physicalStart>this._physicalEnd&&this._isIndexRendered(this._focusedVirtualIndex)&&this._getPhysicalIndex(this._focusedVirtualIndex)<this._physicalEnd&&(this._physicalStart=this._physicalStart+i),this._update(),this._templateCost=(window.performance.now()-s)/i,r=Math.round(.5*this._physicalCount)}this._virtualEnd>=this._virtualCount-1||0===r||(this._isClientFull()?this._physicalSize<this._optPhysicalSize&&this._debounce("_increasePoolIfNeeded",this._increasePoolIfNeeded.bind(this,this._clamp(Math.round(50/this._templateCost),1,r)),idlePeriod):this._debounce("_increasePoolIfNeeded",this._increasePoolIfNeeded.bind(this,r),microTask))}},_render:function(){if(this.isAttached&&this._isVisible)if(0!==this._physicalCount){var e=this._getReusables(!0);this._physicalTop=e.physicalTop,this._virtualStart=this._virtualStart+e.indexes.length,this._physicalStart=this._physicalStart+e.indexes.length,this._update(e.indexes),this._update(),this._increasePoolIfNeeded(0)}else this._virtualCount>0&&(this.updateViewportBoundaries(),this._increasePoolIfNeeded(DEFAULT_PHYSICAL_COUNT))},_ensureTemplatized:function(){if(!this.ctor){this._userTemplate=this.queryEffectiveChildren("template"),this._userTemplate||console.warn("iron-list requires a template to be provided in light-dom");var e={__key__:!0};e[this.as]=!0,e[this.indexAs]=!0,e[this.selectedAs]=!0,e.tabIndex=!0,this._instanceProps=e,this.templatize(this._userTemplate,this.mutableData)}},_gridChanged:function(e,t){void 0!==t&&(this.notifyResize(),flush(),e&&this._updateGridMetrics())},_itemsChanged:function(e){if("items"===e.path)this._virtualStart=0,this._physicalTop=0,this._virtualCount=this.items?this.items.length:0,this._physicalIndexForKey={},this._firstVisibleIndexVal=null,this._lastVisibleIndexVal=null,this._physicalCount=this._physicalCount||0,this._physicalItems=this._physicalItems||[],this._physicalSizes=this._physicalSizes||[],this._physicalStart=0,this._scrollTop>this._scrollOffset&&this._resetScrollPosition(0),this._removeFocusedItem(),this._debounce("_render",this._render,animationFrame);else if("items.splices"===e.path){if(this._adjustVirtualIndex(e.value.indexSplices),this._virtualCount=this.items?this.items.length:0,e.value.indexSplices.some((function(e){return e.addedCount>0||e.removed.length>0}))){var t=this._getActiveElement();this.contains(t)&&t.blur()}var o=e.value.indexSplices.some((function(e){return e.index+e.addedCount>=this._virtualStart&&e.index<=this._virtualEnd}),this);this._isClientFull()&&!o||this._debounce("_render",this._render,animationFrame)}else"items.length"!==e.path&&this._forwardItemPath(e.path,e.value)},_forwardItemPath:function(e,t){var o,i,r,s=(e=e.slice(6)).indexOf(".");-1===s&&(s=e.length);var n=this.modelForElement(this._offscreenFocusedItem),a=parseInt(e.substring(0,s),10);(o=this._isIndexRendered(a))?(i=this._getPhysicalIndex(a),r=this.modelForElement(this._physicalItems[i])):n&&(r=n),r&&r[this.indexAs]===a&&(e=e.substring(s+1),e=this.as+(e?"."+e:""),r._setPendingPropertyOrPath(e,t,!1,!0),r._flushProperties&&r._flushProperties(),o&&(this._updateMetrics([i]),this._positionItems(),this._updateScrollerSize()))},_adjustVirtualIndex:function(e){e.forEach((function(e){if(e.removed.forEach(this._removeItem,this),e.index<this._virtualStart){var t=Math.max(e.addedCount-e.removed.length,e.index-this._virtualStart);this._virtualStart=this._virtualStart+t,this._focusedVirtualIndex>=0&&(this._focusedVirtualIndex=this._focusedVirtualIndex+t)}}),this)},_removeItem:function(e){this.$.selector.deselect(e),this._focusedItem&&this.modelForElement(this._focusedItem)[this.as]===e&&this._removeFocusedItem()},_iterateItems:function(e,t){var o,i,r,s;if(2===arguments.length&&t){for(s=0;s<t.length;s++)if(o=t[s],i=this._computeVidx(o),null!=(r=e.call(this,o,i)))return r}else{for(o=this._physicalStart,i=this._virtualStart;o<this._physicalCount;o++,i++)if(null!=(r=e.call(this,o,i)))return r;for(o=0;o<this._physicalStart;o++,i++)if(null!=(r=e.call(this,o,i)))return r}},_computeVidx:function(e){return e>=this._physicalStart?this._virtualStart+(e-this._physicalStart):this._virtualStart+(this._physicalCount-this._physicalStart)+e},_assignModels:function(e){this._iterateItems((function(e,t){var o=this._physicalItems[e],i=this.items&&this.items[t];if(null!=i){var r=this.modelForElement(o);r.__key__=null,this._forwardProperty(r,this.as,i),this._forwardProperty(r,this.selectedAs,this.$.selector.isSelected(i)),this._forwardProperty(r,this.indexAs,t),this._forwardProperty(r,"tabIndex",this._focusedVirtualIndex===t?0:-1),this._physicalIndexForKey[r.__key__]=e,r._flushProperties&&r._flushProperties(!0),o.removeAttribute("hidden")}else o.setAttribute("hidden","")}),e)},_updateMetrics:function(e){flush();var t=0,o=0,i=this._physicalAverageCount,r=this._physicalAverage;this._iterateItems((function(e,i){o+=this._physicalSizes[e],this._physicalSizes[e]=this._physicalItems[e].offsetHeight,t+=this._physicalSizes[e],this._physicalAverageCount+=this._physicalSizes[e]?1:0}),e),this.grid?(this._updateGridMetrics(),this._physicalSize=Math.ceil(this._physicalCount/this._itemsPerRow)*this._rowHeight):(o=1===this._itemsPerRow?o:Math.ceil(this._physicalCount/this._itemsPerRow)*this._rowHeight,this._physicalSize=this._physicalSize+t-o,this._itemsPerRow=1),this._physicalAverageCount!==i&&(this._physicalAverage=Math.round((r*i+t)/this._physicalAverageCount))},_updateGridMetrics:function(){this._itemWidth=this._physicalCount>0?this._physicalItems[0].getBoundingClientRect().width:200,this._rowHeight=this._physicalCount>0?this._physicalItems[0].offsetHeight:200,this._itemsPerRow=this._itemWidth?Math.floor(this._viewportWidth/this._itemWidth):this._itemsPerRow},_positionItems:function(){this._adjustScrollPosition();var e=this._physicalTop;if(this.grid){var t=this._itemsPerRow*this._itemWidth,o=(this._viewportWidth-t)/2;this._iterateItems((function(t,i){var r=i%this._itemsPerRow,s=Math.floor(r*this._itemWidth+o);this._isRTL&&(s*=-1),this.translate3d(s+"px",e+"px",0,this._physicalItems[t]),this._shouldRenderNextRow(i)&&(e+=this._rowHeight)}))}else{const t=[];this._iterateItems((function(o,i){const r=this._physicalItems[o];this.translate3d(0,e+"px",0,r),e+=this._physicalSizes[o];const s=r.id;s&&t.push(s)})),t.length&&this.setAttribute("aria-owns",t.join(" "))}},_getPhysicalSizeIncrement:function(e){return this.grid?this._computeVidx(e)%this._itemsPerRow!=this._itemsPerRow-1?0:this._rowHeight:this._physicalSizes[e]},_shouldRenderNextRow:function(e){return e%this._itemsPerRow==this._itemsPerRow-1},_adjustScrollPosition:function(){var e=0===this._virtualStart?this._physicalTop:Math.min(this._scrollPosition+this._physicalTop,0);if(0!==e){this._physicalTop=this._physicalTop-e;var t=this._scrollPosition;!IOS_TOUCH_SCROLLING&&t>0&&this._resetScrollPosition(t-e)}},_resetScrollPosition:function(e){this.scrollTarget&&e>=0&&(this._scrollTop=e,this._scrollPosition=this._scrollTop)},_updateScrollerSize:function(e){this.grid?this._estScrollHeight=this._virtualRowCount*this._rowHeight:this._estScrollHeight=this._physicalBottom+Math.max(this._virtualCount-this._physicalCount-this._virtualStart,0)*this._physicalAverage,((e=(e=(e=e||0===this._scrollHeight)||this._scrollPosition>=this._estScrollHeight-this._physicalSize)||this.grid&&this.$.items.style.height<this._estScrollHeight)||Math.abs(this._estScrollHeight-this._scrollHeight)>=this._viewportHeight)&&(this.$.items.style.height=this._estScrollHeight+"px",this._scrollHeight=this._estScrollHeight)},scrollToItem:function(e){return this.scrollToIndex(this.items.indexOf(e))},scrollToIndex:function(e){if(!("number"!=typeof e||e<0||e>this.items.length-1)&&(flush(),0!==this._physicalCount)){e=this._clamp(e,0,this._virtualCount-1),(!this._isIndexRendered(e)||e>=this._maxVirtualStart)&&(this._virtualStart=this.grid?e-2*this._itemsPerRow:e-1),this._manageFocus(),this._assignModels(),this._updateMetrics(),this._physicalTop=Math.floor(this._virtualStart/this._itemsPerRow)*this._physicalAverage;for(var t=this._physicalStart,o=this._virtualStart,i=0,r=this._hiddenContentSize;o<e&&i<=r;)i+=this._getPhysicalSizeIncrement(t),t=(t+1)%this._physicalCount,o++;this._updateScrollerSize(!0),this._positionItems(),this._resetScrollPosition(this._physicalTop+this._scrollOffset+i),this._increasePoolIfNeeded(0),this._firstVisibleIndexVal=null,this._lastVisibleIndexVal=null}},_resetAverage:function(){this._physicalAverage=0,this._physicalAverageCount=0},_resizeHandler:function(){this._debounce("_render",(function(){this._firstVisibleIndexVal=null,this._lastVisibleIndexVal=null,this._isVisible?(this.updateViewportBoundaries(),this.toggleScrollListener(!0),this._resetAverage(),this._render()):this.toggleScrollListener(!1)}),animationFrame)},selectItem:function(e){return this.selectIndex(this.items.indexOf(e))},selectIndex:function(e){if(!(e<0||e>=this._virtualCount)){if(!this.multiSelection&&this.selectedItem&&this.clearSelection(),this._isIndexRendered(e)){var t=this.modelForElement(this._physicalItems[this._getPhysicalIndex(e)]);t&&(t[this.selectedAs]=!0),this.updateSizeForIndex(e)}this.$.selector.selectIndex(e)}},deselectItem:function(e){return this.deselectIndex(this.items.indexOf(e))},deselectIndex:function(e){if(!(e<0||e>=this._virtualCount)){if(this._isIndexRendered(e))this.modelForElement(this._physicalItems[this._getPhysicalIndex(e)])[this.selectedAs]=!1,this.updateSizeForIndex(e);this.$.selector.deselectIndex(e)}},toggleSelectionForItem:function(e){return this.toggleSelectionForIndex(this.items.indexOf(e))},toggleSelectionForIndex:function(e){(this.$.selector.isIndexSelected?this.$.selector.isIndexSelected(e):this.$.selector.isSelected(this.items[e]))?this.deselectIndex(e):this.selectIndex(e)},clearSelection:function(){this._iterateItems((function(e,t){this.modelForElement(this._physicalItems[e])[this.selectedAs]=!1})),this.$.selector.clearSelection()},_selectionEnabledChanged:function(e){(e?this.listen:this.unlisten).call(this,this,"tap","_selectionHandler")},_selectionHandler:function(e){var t=this.modelForElement(e.target);if(t){var o,i,r=dom(e).path[0],s=this._getActiveElement(),n=this._physicalItems[this._getPhysicalIndex(t[this.indexAs])];"input"!==r.localName&&"button"!==r.localName&&"select"!==r.localName&&(o=t.tabIndex,t.tabIndex=SECRET_TABINDEX,i=s?s.tabIndex:-1,t.tabIndex=o,s&&n!==s&&n.contains(s)&&i!==SECRET_TABINDEX||this.toggleSelectionForItem(t[this.as]))}},_multiSelectionChanged:function(e){this.clearSelection(),this.$.selector.multi=e},updateSizeForItem:function(e){return this.updateSizeForIndex(this.items.indexOf(e))},updateSizeForIndex:function(e){return this._isIndexRendered(e)?(this._updateMetrics([this._getPhysicalIndex(e)]),this._positionItems(),null):null},_manageFocus:function(){var e=this._focusedVirtualIndex;e>=0&&e<this._virtualCount?this._isIndexRendered(e)?this._restoreFocusedItem():this._createFocusBackfillItem():this._virtualCount>0&&this._physicalCount>0&&(this._focusedPhysicalIndex=this._physicalStart,this._focusedVirtualIndex=this._virtualStart,this._focusedItem=this._physicalItems[this._physicalStart])},_convertIndexToCompleteRow:function(e){return this._itemsPerRow=this._itemsPerRow||1,this.grid?Math.ceil(e/this._itemsPerRow)*this._itemsPerRow:e},_isIndexRendered:function(e){return e>=this._virtualStart&&e<=this._virtualEnd},_isIndexVisible:function(e){return e>=this.firstVisibleIndex&&e<=this.lastVisibleIndex},_getPhysicalIndex:function(e){return(this._physicalStart+(e-this._virtualStart))%this._physicalCount},focusItem:function(e){this._focusPhysicalItem(e)},_focusPhysicalItem:function(e){if(!(e<0||e>=this._virtualCount)){this._restoreFocusedItem(),this._isIndexRendered(e)||this.scrollToIndex(e);var t,o=this._physicalItems[this._getPhysicalIndex(e)],i=this.modelForElement(o);i.tabIndex=SECRET_TABINDEX,o.tabIndex===SECRET_TABINDEX&&(t=o),t||(t=dom(o).querySelector('[tabindex="'+SECRET_TABINDEX+'"]')),i.tabIndex=0,this._focusedVirtualIndex=e,t&&t.focus()}},_removeFocusedItem:function(){this._offscreenFocusedItem&&this._itemsParent.removeChild(this._offscreenFocusedItem),this._offscreenFocusedItem=null,this._focusBackfillItem=null,this._focusedItem=null,this._focusedVirtualIndex=-1,this._focusedPhysicalIndex=-1},_createFocusBackfillItem:function(){var e=this._focusedPhysicalIndex;if(!(this._offscreenFocusedItem||this._focusedVirtualIndex<0)){if(!this._focusBackfillItem){var t=this.stamp(null);this._focusBackfillItem=t.root.querySelector("*"),this._itemsParent.appendChild(t.root)}this._offscreenFocusedItem=this._physicalItems[e],this.modelForElement(this._offscreenFocusedItem).tabIndex=0,this._physicalItems[e]=this._focusBackfillItem,this._focusedPhysicalIndex=e,this.translate3d(0,HIDDEN_Y,0,this._offscreenFocusedItem)}},_restoreFocusedItem:function(){if(this._offscreenFocusedItem&&!(this._focusedVirtualIndex<0)){this._assignModels();var e=this._focusedPhysicalIndex=this._getPhysicalIndex(this._focusedVirtualIndex),t=this._physicalItems[e];if(t){var o=this.modelForElement(t),i=this.modelForElement(this._offscreenFocusedItem);o[this.as]===i[this.as]?(this._focusBackfillItem=t,o.tabIndex=-1,this._physicalItems[e]=this._offscreenFocusedItem,this.translate3d(0,HIDDEN_Y,0,this._focusBackfillItem)):(this._removeFocusedItem(),this._focusBackfillItem=null),this._offscreenFocusedItem=null}}},_didFocus:function(e){var t=this.modelForElement(e.target),o=this.modelForElement(this._focusedItem),i=null!==this._offscreenFocusedItem,r=this._focusedVirtualIndex;t&&(o===t?this._isIndexVisible(r)||this.scrollToIndex(r):(this._restoreFocusedItem(),o&&(o.tabIndex=-1),t.tabIndex=0,r=t[this.indexAs],this._focusedVirtualIndex=r,this._focusedPhysicalIndex=this._getPhysicalIndex(r),this._focusedItem=this._physicalItems[this._focusedPhysicalIndex],i&&!this._offscreenFocusedItem&&this._update()))},_keydownHandler:function(e){switch(e.keyCode){case 40:this._focusedVirtualIndex<this._virtualCount-1&&e.preventDefault(),this._focusPhysicalItem(this._focusedVirtualIndex+(this.grid?this._itemsPerRow:1));break;case 39:this.grid&&this._focusPhysicalItem(this._focusedVirtualIndex+(this._isRTL?-1:1));break;case 38:this._focusedVirtualIndex>0&&e.preventDefault(),this._focusPhysicalItem(this._focusedVirtualIndex-(this.grid?this._itemsPerRow:1));break;case 37:this.grid&&this._focusPhysicalItem(this._focusedVirtualIndex+(this._isRTL?1:-1));break;case 13:this._focusPhysicalItem(this._focusedVirtualIndex),this.selectionEnabled&&this._selectionHandler(e)}},_clamp:function(e,t,o){return Math.min(o,Math.max(t,e))},_debounce:function(e,t,o){this._debouncers=this._debouncers||{},this._debouncers[e]=Debouncer.debounce(this._debouncers[e],o,t.bind(this)),enqueueDebouncer(this._debouncers[e])},_forwardProperty:function(e,t,o){e._setPendingProperty(t,o)},_forwardHostPropV2:function(e,t){(this._physicalItems||[]).concat([this._offscreenFocusedItem,this._focusBackfillItem]).forEach((function(o){o&&this.modelForElement(o).forwardHostProp(e,t)}),this)},_notifyInstancePropV2:function(e,t,o){if(matches(this.as,t)){var i=e[this.indexAs];t==this.as&&(this.items[i]=o),this.notifyPath(translate(this.as,"items."+i,t),o)}},_getStampedChildren:function(){return this._physicalItems},_forwardInstancePath:function(e,t,o){0===t.indexOf(this.as+".")&&this.notifyPath("items."+e.__key__+"."+t.slice(this.as.length+1),o)},_forwardParentPath:function(e,t){(this._physicalItems||[]).concat([this._offscreenFocusedItem,this._focusBackfillItem]).forEach((function(o){o&&this.modelForElement(o).notifyPath(e,t)}),this)},_forwardParentProp:function(e,t){(this._physicalItems||[]).concat([this._offscreenFocusedItem,this._focusBackfillItem]).forEach((function(o){o&&(this.modelForElement(o)[e]=t)}),this)},_getActiveElement:function(){var e=this._itemsParent.node.domHost;return dom(e?e.root:document).activeElement}});
/**
@license
Copyright (c) 2017 Vaadin Ltd.
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
*/
class ComboBoxItemElement extends(ThemableMixin(PolymerElement)){static get template(){return html$1`
    <style>
      :host {
        display: block;
      }

      :host([hidden]) {
         display: none;
      }
    </style>
    <div part="content" id="content"></div>
`}static get is(){return"vaadin-combo-box-item"}static get properties(){return{index:Number,item:Object,label:String,selected:{type:Boolean,value:!1,reflectToAttribute:!0},focused:{type:Boolean,value:!1,reflectToAttribute:!0},_itemTemplateInstance:Object,renderer:Function,_oldRenderer:Function}}static get observers(){return["_rendererOrItemChanged(renderer, index, item.*)","_updateLabel(label, _itemTemplateInstance)",'_updateTemplateInstanceVariable("index", index, _itemTemplateInstance)','_updateTemplateInstanceVariable("item", item, _itemTemplateInstance)','_updateTemplateInstanceVariable("selected", selected, _itemTemplateInstance)','_updateTemplateInstanceVariable("focused", focused, _itemTemplateInstance)']}connectedCallback(){if(super.connectedCallback(),!this._itemTemplateInstance){const e=this.getRootNode().host.getRootNode().host.__dataHost.getRootNode().host;this._comboBox=e.getRootNode().host,this._comboBox._ensureTemplatized(),this._comboBox._TemplateClass&&(this._itemTemplateInstance=new this._comboBox._TemplateClass({}),this.$.content.textContent="",this.$.content.appendChild(this._itemTemplateInstance.root))}}_render(){if(!this.renderer)return;const e={index:this.index,item:this.item};this.renderer(this.$.content,this._comboBox,e)}_rendererOrItemChanged(e,t,o){void 0!==o&&void 0!==t&&(this._oldRenderer!==e&&(this.$.content.innerHTML=""),e&&(this._oldRenderer=e,this._render()))}_updateLabel(e,t){void 0===t&&this.$.content&&!this.renderer&&(this.$.content.textContent=e)}_updateTemplateInstanceVariable(e,t,o){void 0!==e&&void 0!==t&&void 0!==o&&(o[e]=t)}}customElements.define(ComboBoxItemElement.is,ComboBoxItemElement);
/**
 * @fileoverview
 * @suppress {checkPrototypalTypes}
 * @license Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt The complete set of authors may be found
 * at http://polymer.github.io/AUTHORS.txt The complete set of contributors may
 * be found at http://polymer.github.io/CONTRIBUTORS.txt Code distributed by
 * Google as part of the polymer project is also subject to an additional IP
 * rights grant found at http://polymer.github.io/PATENTS.txt
 */
const DISABLED_ATTR="disable-upgrade",DisableUpgradeMixin=dedupingMixin((e=>{const t=ElementMixin(e);return class extends t{static get observedAttributes(){return super.observedAttributes.concat(DISABLED_ATTR)}attributeChangedCallback(e,t,o,i){e==DISABLED_ATTR?!this.__dataEnabled&&null==o&&this.isConnected&&super.connectedCallback():super.attributeChangedCallback(e,t,o,i)}_initializeProperties(){}connectedCallback(){!this.__dataEnabled&&this.hasAttribute(DISABLED_ATTR)||super.connectedCallback()}_enableProperties(){this.hasAttribute(DISABLED_ATTR)||(this.__dataEnabled||super._initializeProperties(),super._enableProperties())}disconnectedCallback(){this.__dataEnabled&&super.disconnectedCallback()}}}));
/**
@license
Copyright (c) 2017 Vaadin Ltd.
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
*/
class ComboBoxOverlayElement extends OverlayElement{static get is(){return"vaadin-combo-box-overlay"}ready(){super.ready();const e=document.createElement("div");e.setAttribute("part","loader");const t=this.shadowRoot.querySelector('[part~="content"]');t.parentNode.insertBefore(e,t)}}customElements.define(ComboBoxOverlayElement.is,ComboBoxOverlayElement);class ComboBoxDropdownElement extends(DisableUpgradeMixin(mixinBehaviors(IronResizableBehavior,PolymerElement))){static get template(){return html$1`
    <style>
      :host {
        display: block;
      }

      :host > #overlay {
        display: none;
      }
    </style>
    <vaadin-combo-box-overlay id="overlay" hidden\$="[[hidden]]" opened="[[opened]]" template="{{template}}" style="align-items: stretch; margin: 0;" theme\$="[[theme]]">
      <slot></slot>
    </vaadin-combo-box-overlay>
`}static get is(){return"vaadin-combo-box-dropdown"}static get properties(){return{opened:{type:Boolean,observer:"_openedChanged"},template:{type:Object,notify:!0},positionTarget:{type:Object},alignedAbove:{type:Boolean,value:!1},theme:String}}constructor(){super(),this._boundSetPosition=this._setPosition.bind(this),this._boundOutsideClickListener=this._outsideClickListener.bind(this)}connectedCallback(){super.connectedCallback(),this.addEventListener("iron-resize",this._boundSetPosition)}ready(){super.ready(),this.$.overlay.addEventListener("vaadin-overlay-outside-click",(e=>{e.preventDefault()}))}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("iron-resize",this._boundSetPosition),this.opened=!1}notifyResize(){super.notifyResize(),this.positionTarget&&this.opened&&(this._setPosition(),requestAnimationFrame(this._setPosition.bind(this)))}_openedChanged(e,t){!!e!=!!t&&(e?(this.$.overlay.style.position=this._isPositionFixed(this.positionTarget)?"fixed":"absolute",this._setPosition(),window.addEventListener("scroll",this._boundSetPosition,!0),document.addEventListener("click",this._boundOutsideClickListener,!0),this.dispatchEvent(new CustomEvent("vaadin-combo-box-dropdown-opened",{bubbles:!0,composed:!0}))):(window.removeEventListener("scroll",this._boundSetPosition,!0),document.removeEventListener("click",this._boundOutsideClickListener,!0),this.dispatchEvent(new CustomEvent("vaadin-combo-box-dropdown-closed",{bubbles:!0,composed:!0}))))}_outsideClickListener(e){const t=e.composedPath();t.indexOf(this.positionTarget)<0&&t.indexOf(this.$.overlay)<0&&(this.opened=!1)}_isPositionFixed(e){const t=this._getOffsetParent(e);return"fixed"===window.getComputedStyle(e).position||t&&this._isPositionFixed(t)}_getOffsetParent(e){if(e.assignedSlot)return e.assignedSlot.parentElement;if(e.parentElement)return e.offsetParent;const t=e.parentNode;return t&&11===t.nodeType&&t.host?t.host:void 0}_verticalOffset(e,t){return this.alignedAbove?-e.height:t.height}_shouldAlignAbove(e){return(window.innerHeight-e.bottom-Math.min(document.body.scrollTop,0))/window.innerHeight<.3}_setPosition(e){if(this.hidden)return;if(e&&e.target){const t=e.target===document?document.body:e.target,o=this.$.overlay.parentElement;if(!t.contains(this.$.overlay)&&!t.contains(this.positionTarget)||o!==document.body)return}const t=this.positionTarget.getBoundingClientRect();this.alignedAbove=this._shouldAlignAbove(t);const o=this.$.overlay.getBoundingClientRect();this._translateX=t.left-o.left+(this._translateX||0),this._translateY=t.top-o.top+(this._translateY||0)+this._verticalOffset(o,t);const i=window.devicePixelRatio||1;this._translateX=Math.round(this._translateX*i)/i,this._translateY=Math.round(this._translateY*i)/i,this.$.overlay.style.transform=`translate3d(${this._translateX}px, ${this._translateY}px, 0)`,this.$.overlay.style.width=this.positionTarget.clientWidth+"px",this.$.overlay.style.justifyContent=this.alignedAbove?"flex-end":"flex-start",this.dispatchEvent(new CustomEvent("position-changed"))}}customElements.define(ComboBoxDropdownElement.is,ComboBoxDropdownElement);
/**
@license
Copyright (c) 2017 Vaadin Ltd.
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
*/
const TOUCH_DEVICE=(()=>{try{return document.createEvent("TouchEvent"),!0}catch(e){return!1}})();class ComboBoxDropdownWrapperElement extends class extends PolymerElement{}{static get template(){return html$1`
    <vaadin-combo-box-dropdown id="dropdown" hidden="[[_hidden(_items.*, loading)]]" position-target="[[positionTarget]]" on-template-changed="_templateChanged" on-position-changed="_setOverlayHeight" disable-upgrade="" theme="[[theme]]">
      <template>
        <style>
          #scroller {
            overflow: auto;

            /* Fixes item background from getting on top of scrollbars on Safari */
            transform: translate3d(0, 0, 0);

            /* Enable momentum scrolling on iOS (iron-list v1.2+ no longer does it for us) */
            -webkit-overflow-scrolling: touch;

            /* Fixes scrollbar disappearing when 'Show scroll bars: Always' enabled in Safari */
            box-shadow: 0 0 0 white;
          }
        </style>
        <div id="scroller" on-click="_stopPropagation">
          <iron-list id="selector" role="listbox" items="[[_getItems(opened, _items)]]" scroll-target="[[_scroller]]">
            <template>
              <vaadin-combo-box-item on-click="_onItemClick" index="[[__requestItemByIndex(item, index)]]" item="[[item]]" label="[[getItemLabel(item, _itemLabelPath)]]" selected="[[_isItemSelected(item, _selectedItem, _itemIdPath)]]" renderer="[[renderer]]" role\$="[[_getAriaRole(index)]]" aria-selected\$="[[_getAriaSelected(_focusedIndex,index)]]" focused="[[_isItemFocused(_focusedIndex,index)]]" tabindex="-1" theme\$="[[theme]]">
              </vaadin-combo-box-item>
            </template>
          </iron-list>
        </div>
      </template>
    </vaadin-combo-box-dropdown>
`}static get is(){return"vaadin-combo-box-dropdown-wrapper"}static get properties(){return{touchDevice:{type:Boolean,value:TOUCH_DEVICE},opened:Boolean,positionTarget:{type:Object},renderer:Function,loading:{type:Boolean,value:!1,reflectToAttribute:!0,observer:"_setOverlayHeight"},theme:String,_selectedItem:{type:Object},_items:{type:Object},_focusedIndex:{type:Number,value:-1,observer:"_focusedIndexChanged"},_focusedItem:{type:String,computed:"_getFocusedItem(_focusedIndex)"},_itemLabelPath:{type:String,value:"label"},_itemValuePath:{type:String,value:"value"},_selector:Object,_itemIdPath:String}}static get observers(){return["_selectorChanged(_selector)","_loadingChanged(loading)","_openedChanged(opened, _items, loading)"]}_fireTouchAction(e){this.dispatchEvent(new CustomEvent("vaadin-overlay-touch-action",{detail:{sourceEvent:e}}))}_getItems(e,t){return e?t:[]}_openedChanged(e,t,o){if(this.$.dropdown.hasAttribute("disable-upgrade")){if(!e)return;this._initDropdown()}this.$.dropdown.opened=!(!e||!(o||this.$.dropdown.opened||t&&t.length))}_initDropdown(){this.$.dropdown.removeAttribute("disable-upgrade"),this._templateChanged(),this._loadingChanged(this.loading),this.$.dropdown.$.overlay.addEventListener("touchend",(e=>this._fireTouchAction(e))),this.$.dropdown.$.overlay.addEventListener("touchmove",(e=>this._fireTouchAction(e))),this.$.dropdown.$.overlay.addEventListener("mousedown",(e=>e.preventDefault())),/Trident/.test(navigator.userAgent)&&this._scroller.setAttribute("unselectable","on")}_templateChanged(e){this.$.dropdown.hasAttribute("disable-upgrade")||(this._selector=this.$.dropdown.$.overlay.content.querySelector("#selector"),this._scroller=this.$.dropdown.$.overlay.content.querySelector("#scroller"))}_loadingChanged(e){this.$.dropdown.hasAttribute("disable-upgrade")||(e?this.$.dropdown.$.overlay.setAttribute("loading",""):this.$.dropdown.$.overlay.removeAttribute("loading"))}_selectorChanged(e){this._patchWheelOverScrolling()}_setOverlayHeight(){if(!this.opened||!this.positionTarget||!this._selector)return;const e=this.positionTarget.getBoundingClientRect();this._scroller.style.maxHeight=(window.ShadyCSS?window.ShadyCSS.getComputedStyleValue(this,"--vaadin-combo-box-overlay-max-height"):getComputedStyle(this).getPropertyValue("--vaadin-combo-box-overlay-max-height"))||"65vh";const t=this._maxOverlayHeight(e);this.$.dropdown.$.overlay.style.maxHeight=t,this._selector.style.maxHeight=t,this.updateViewportBoundaries()}_maxOverlayHeight(e){return this.$.dropdown.alignedAbove?Math.max(e.top-8+Math.min(document.body.scrollTop,0),116)+"px":Math.max(document.documentElement.clientHeight-e.bottom-8,116)+"px"}_getFocusedItem(e){if(e>=0)return this._items[e]}_isItemSelected(e,t,o){return!(e instanceof ComboBoxPlaceholder)&&(o&&void 0!==e&&void 0!==t?this.get(o,e)===this.get(o,t):e===t)}_onItemClick(e){e.detail&&e.detail.sourceEvent&&e.detail.sourceEvent.stopPropagation&&this._stopPropagation(e.detail.sourceEvent),this.dispatchEvent(new CustomEvent("selection-changed",{detail:{item:e.model.item}}))}indexOfLabel(e){if(this._items&&e)for(let t=0;t<this._items.length;t++)if(this.getItemLabel(this._items[t]).toString().toLowerCase()===e.toString().toLowerCase())return t;return-1}__requestItemByIndex(e,t){return e instanceof ComboBoxPlaceholder&&void 0!==t&&this.dispatchEvent(new CustomEvent("index-requested",{detail:{index:t}})),t}getItemLabel(e,t){t=t||this._itemLabelPath;let o=e&&t?this.get(t,e):void 0;return null==o&&(o=e?e.toString():""),o}_isItemFocused(e,t){return e==t}_getAriaSelected(e,t){return this._isItemFocused(e,t).toString()}_getAriaRole(e){return void 0!==e&&"option"}_focusedIndexChanged(e){e>=0&&this._scrollIntoView(e)}_scrollIntoView(e){if(!(this.opened&&e>=0))return;const t=this._visibleItemsCount();if(void 0===t)return;let o=e;e>this._selector.lastVisibleIndex-1?(this._selector.scrollToIndex(e),o=e-t+1):e>this._selector.firstVisibleIndex&&(o=this._selector.firstVisibleIndex),this._selector.scrollToIndex(Math.max(0,o));const i=this._selector._getPhysicalIndex(e),r=this._selector._physicalItems[i];if(!r)return;const s=r.getBoundingClientRect(),n=this._scroller.getBoundingClientRect(),a=s.bottom-n.bottom+this._viewportTotalPaddingBottom;a>0&&(this._scroller.scrollTop+=a)}ensureItemsRendered(){this._selector._render()}adjustScrollPosition(){this.opened&&this._items&&this._scrollIntoView(this._focusedIndex)}_patchWheelOverScrolling(){const e=this._selector;e.addEventListener("wheel",(t=>{const o=e._scroller||e.scrollTarget,i=0===o.scrollTop,r=o.scrollHeight-o.scrollTop-o.clientHeight<=1;(i&&t.deltaY<0||r&&t.deltaY>0)&&t.preventDefault()}))}updateViewportBoundaries(){this._cachedViewportTotalPaddingBottom=void 0,this._selector.updateViewportBoundaries()}get _viewportTotalPaddingBottom(){if(void 0===this._cachedViewportTotalPaddingBottom){const e=window.getComputedStyle(this._selector.$.items);this._cachedViewportTotalPaddingBottom=[e.paddingBottom,e.borderBottomWidth].map((e=>parseInt(e,10))).reduce(((e,t)=>e+t))}return this._cachedViewportTotalPaddingBottom}_visibleItemsCount(){if(this._selector)return this._selector.flushDebouncer("_debounceTemplate"),this._selector.scrollToIndex(this._selector.firstVisibleIndex),this.updateViewportBoundaries(),this._selector.lastVisibleIndex-this._selector.firstVisibleIndex+1}_selectItem(e){e="number"==typeof e?this._items[e]:e,this._selector.selectedItem!==e&&this._selector.selectItem(e)}_preventDefault(e){e.cancelable&&e.preventDefault()}_stopPropagation(e){e.stopPropagation()}_hidden(e){return!(this.loading||this._items&&this._items.length)}}customElements.define(ComboBoxDropdownWrapperElement.is,ComboBoxDropdownWrapperElement);
/**
@license
Copyright (c) 2018 Vaadin Ltd.
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
*/
const ComboBoxDataProviderMixin=e=>class extends e{static get properties(){return{pageSize:{type:Number,value:50,observer:"_pageSizeChanged"},size:{type:Number,observer:"_sizeChanged"},dataProvider:{type:Object,observer:"_dataProviderChanged"},_pendingRequests:{value:()=>({})},__placeHolder:{value:new ComboBoxPlaceholder}}}static get observers(){return["_dataProviderFilterChanged(filter, dataProvider)","_dataProviderClearFilter(dataProvider, opened, value)","_warnDataProviderValue(dataProvider, value)","_ensureFirstPage(opened)"]}_dataProviderClearFilter(e,t,o){e&&this.filter&&(this.size=void 0,this._pendingRequests={},this.filter="",this.clearCache())}ready(){super.ready(),this.clearCache(),this.$.overlay.addEventListener("index-requested",(e=>{const t=e.detail.index;if(void 0!==t){const e=this._getPageForIndex(t);this._shouldLoadPage(e)&&this._loadPage(e)}}))}_dataProviderFilterChanged(){this.dataProvider&&this.opened&&(this.size=void 0,this._pendingRequests={},this.clearCache())}_ensureFirstPage(e){e&&this._shouldLoadPage(0)&&this._loadPage(0)}_shouldLoadPage(e){if(!this.filteredItems||this._forceNextRequest)return this._forceNextRequest=!1,!0;const t=this.filteredItems[e*this.pageSize];return void 0!==t?t instanceof ComboBoxPlaceholder:void 0===this.size}_loadPage(e){if(!this._pendingRequests[e]&&this.dataProvider){this.loading=!0;const t={page:e,pageSize:this.pageSize,filter:this.filter},o=(i,r)=>{if(this._pendingRequests[e]===o){if(this.filteredItems)this.splice("filteredItems",t.page*t.pageSize,i.length,...i);else{const e=[];e.splice(t.page*t.pageSize,i.length,...i),this.filteredItems=e}this._isValidValue(this.value)&&this._getItemValue(this.selectedItem)!==this.value&&this._selectItemForValue(this.value),this.size=r,delete this._pendingRequests[e],0===Object.keys(this._pendingRequests).length&&(this.loading=!1),0===e&&this.__repositionOverlayDebouncer&&i.length>(this.__maxRenderedItems||0)&&(setTimeout((()=>this.__repositionOverlayDebouncer.flush())),this.__maxRenderedItems=i.length)}};this._pendingRequests[e]=o,this.dataProvider(t,o)}}_getPageForIndex(e){return Math.floor(e/this.pageSize)}clearCache(){if(!this.dataProvider)return;this._pendingRequests={};const e=[];for(let t=0;t<(this.size||0);t++)e.push(this.__placeHolder);this.filteredItems=e,this.opened?this._loadPage(0):this._forceNextRequest=!0}_sizeChanged(e=0){const t=(this.filteredItems||[]).slice(0,e);for(let o=0;o<e;o++)t[o]=void 0!==t[o]?t[o]:this.__placeHolder;this.filteredItems=t}_pageSizeChanged(e,t){if(Math.floor(e)!==e||e<1)throw this.pageSize=t,new Error("`pageSize` value must be an integer > 0");this.clearCache()}_dataProviderChanged(e,t){this._ensureItemsOrDataProvider((()=>{this.dataProvider=t}))}_ensureItemsOrDataProvider(e){if(void 0!==this.items&&void 0!==this.dataProvider)throw e(),new Error("Using `items` and `dataProvider` together is not supported");this.dataProvider&&!this.filteredItems&&(this.filteredItems=[])}_warnDataProviderValue(e,t){if(e&&""!==t&&(void 0===this.selectedItem||null===this.selectedItem)){const e=this._indexOfValue(t,this.filteredItems);(e<0||!this._getItemLabel(this.filteredItems[e]))&&console.warn("Warning: unable to determine the label for the provided `value`. Nothing to display in the text field. This usually happens when setting an initial `value` before any items are returned from the `dataProvider` callback. Consider setting `selectedItem` instead of `value`")}}}
/**
@license
Copyright (c) 2017 Vaadin Ltd.
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
*/;class ComboBoxElement extends(ElementMixin$1(ControlStateMixin(ThemePropertyMixin(ThemableMixin(ComboBoxDataProviderMixin(ComboBoxMixin(PolymerElement))))))){static get template(){return html$1`
    <style>
      :host {
        display: inline-block;
      }

      :host([hidden]) {
        display: none !important;
      }

      :host([opened]) {
        pointer-events: auto;
      }

      [part="text-field"] {
        width: 100%;
        min-width: 0;
      }
    </style>

    <vaadin-text-field part="text-field" id="input" pattern="[[pattern]]" prevent-invalid-input="[[preventInvalidInput]]" value="{{_inputElementValue}}" autocomplete="off" invalid="[[invalid]]" label="[[label]]" name="[[name]]" placeholder="[[placeholder]]" required="[[required]]" disabled="[[disabled]]" readonly="[[readonly]]" error-message="[[errorMessage]]" autocapitalize="none" autofocus="[[autofocus]]" on-change="_stopPropagation" on-input="_inputValueChanged" clear-button-visible="[[clearButtonVisible]]" theme\$="[[theme]]">
      <slot name="prefix" slot="prefix"></slot>

      <div part="toggle-button" id="toggleButton" slot="suffix" role="button" aria-label="Toggle"></div>

    </vaadin-text-field>

    <vaadin-combo-box-dropdown-wrapper id="overlay" opened="[[opened]]" renderer="[[renderer]]" position-target="[[_getPositionTarget()]]" _focused-index="[[_focusedIndex]]" _item-id-path="[[itemIdPath]]" _item-label-path="[[itemLabelPath]]" loading="[[loading]]" theme="[[theme]]">
    </vaadin-combo-box-dropdown-wrapper>
`}constructor(){super(),this.theme}static get is(){return"vaadin-combo-box"}static get version(){return"5.0.10"}static get properties(){return{label:{type:String,reflectToAttribute:!0},required:{type:Boolean,value:!1},disabled:{type:Boolean,value:!1},preventInvalidInput:{type:Boolean},pattern:{type:String},errorMessage:{type:String},autofocus:{type:Boolean},placeholder:{type:String,value:""},readonly:{type:Boolean,value:!1},clearButtonVisible:{type:Boolean,value:!1}}}static get observers(){return["_updateAriaExpanded(opened)"]}attributeChanged(e,t){/^((?!chrome|android).)*safari/i.test(navigator.userAgent)&&this.root&&Array.prototype.forEach.call(this.root.querySelectorAll("*"),(e=>{e.style["-webkit-backface-visibility"]="visible",e.style["-webkit-backface-visibility"]=""}))}ready(){super.ready(),this._nativeInput=this.inputElement.focusElement,this._toggleElement=this.$.toggleButton,this._clearElement=this.inputElement.shadowRoot.querySelector('[part="clear-button"]'),this.inputElement.addEventListener("keydown",(e=>{this._isEventKey(e,"esc")&&(this._stopPropagation(e),this._onEscape(e))}),!0),this._nativeInput.setAttribute("role","combobox"),this._nativeInput.setAttribute("aria-autocomplete","list"),this._updateAriaExpanded()}connectedCallback(){super.connectedCallback(),this._preventInputBlur()}disconnectedCallback(){super.disconnectedCallback(),this._restoreInputBlur()}_getPositionTarget(){return this.$.input}_updateAriaExpanded(){this._nativeInput&&(this._nativeInput.setAttribute("aria-expanded",this.opened),this._toggleElement.setAttribute("aria-expanded",this.opened))}get inputElement(){return this.$.input}get focusElement(){return this.inputElement||this}}customElements.define(ComboBoxElement.is,ComboBoxElement);
/**
@license
Copyright (c) 2017 Vaadin Ltd.
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
*/
class ComboBoxLightElement extends(ThemePropertyMixin(ThemableMixin(ComboBoxDataProviderMixin(ComboBoxMixin(PolymerElement))))){static get template(){return html$1`
    <style>
      :host([opened]) {
        pointer-events: auto;
      }
    </style>

    <slot></slot>

    <vaadin-combo-box-dropdown-wrapper id="overlay" opened="[[opened]]" position-target="[[inputElement]]" renderer="[[renderer]]" _focused-index="[[_focusedIndex]]" _item-id-path="[[itemIdPath]]" _item-label-path="[[itemLabelPath]]" loading="[[loading]]" theme="[[theme]]">
    </vaadin-combo-box-dropdown-wrapper>
`}static get is(){return"vaadin-combo-box-light"}static get properties(){return{attrForValue:{type:String,value:"value"},inputElement:{type:Element,readOnly:!0}}}constructor(){super(),this._boundInputValueChanged=this._inputValueChanged.bind(this),this.__boundInputValueCommitted=this.__inputValueCommitted.bind(this)}ready(){super.ready(),this._toggleElement=this.querySelector(".toggle-button"),this._clearElement=this.querySelector(".clear-button"),this._clearElement&&this._clearElement.addEventListener("mousedown",(e=>{e.preventDefault(),(this.inputElement._focusableElement||this.inputElement).focus()}))}get focused(){return this.getRootNode().activeElement===this.inputElement}connectedCallback(){super.connectedCallback();this._setInputElement(this.querySelector("vaadin-text-field,iron-input,paper-input,.paper-input-input,.input")),this._revertInputValue(),this.inputElement.addEventListener("input",this._boundInputValueChanged),this.inputElement.addEventListener("change",this.__boundInputValueCommitted),this._preventInputBlur()}disconnectedCallback(){super.disconnectedCallback(),this.inputElement.removeEventListener("input",this._boundInputValueChanged),this.inputElement.removeEventListener("change",this.__boundInputValueCommitted),this._restoreInputBlur()}__inputValueCommitted(e){e.__fromClearButton&&this._clear()}get _propertyForValue(){return dashToCamelCase(this.attrForValue)}get _inputElementValue(){return this.inputElement&&this.inputElement[this._propertyForValue]}set _inputElementValue(e){this.inputElement&&(this.inputElement[this._propertyForValue]=e)}}customElements.define(ComboBoxLightElement.is,ComboBoxLightElement);const $_documentContainer$h=html$1`<dom-module id="lumo-number-field" theme-for="vaadin-number-field">
  <template>
    <style include="lumo-field-button">
      :host {
        width: 8em;
      }

      :host([has-controls]:not([theme~="align-right"])) [part="value"] {
        text-align: center;
      }

      [part="decrease-button"][disabled],
      [part="increase-button"][disabled] {
        opacity: 0.2;
      }

      :host([has-controls]) [part="input-field"] {
        padding: 0;
      }

      [part="decrease-button"],
      [part="increase-button"] {
        cursor: pointer;
        font-size: var(--lumo-icon-size-s);
        width: 1.6em;
        height: 1.6em;
      }

      [part="decrease-button"]::before,
      [part="increase-button"]::before {
        margin-top: 0.2em;
      }
    </style>
  </template>
</dom-module>`;document.head.appendChild($_documentContainer$h.content);
/**
@license
Copyright (c) 2017 Vaadin Ltd.
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
*/
const $_documentContainer$i=document.createElement("template");let memoizedTemplate;$_documentContainer$i.innerHTML='<dom-module id="vaadin-number-field-template">\n  <template>\n    <style>\n      :host([readonly]) [part$="button"] {\n        pointer-events: none;\n      }\n\n      [part="decrease-button"]::before {\n        content: "";\n      }\n\n      [part="increase-button"]::before {\n        content: "+";\n      }\n\n      [part="decrease-button"],\n      [part="increase-button"] {\n        -webkit-user-select: none;\n        -moz-user-select: none;\n        -ms-user-select: none;\n        user-select: none;\n      }\n\n      /* Hide the native arrow icons */\n      [part="value"]::-webkit-outer-spin-button,\n      [part="value"]::-webkit-inner-spin-button {\n        -webkit-appearance: none;\n        margin: 0;\n      }\n\n      [part="value"] {\n        /* Older Firefox versions (v47.0) requires !important */\n        -moz-appearance: textfield !important;\n      }\n    </style>\n\n    <div disabled$="[[!_allowed(-1, value, min, max, step)]]" part="decrease-button" on-click="_decreaseValue" on-touchend="_decreaseButtonTouchend" hidden$="[[!hasControls]]">\n    </div>\n\n    <div disabled$="[[!_allowed(1, value, min, max, step)]]" part="increase-button" on-click="_increaseValue" on-touchend="_increaseButtonTouchend" hidden$="[[!hasControls]]">\n    </div>\n  </template>\n\n  \n</dom-module>',document.head.appendChild($_documentContainer$i.content);class NumberFieldElement extends TextFieldElement{static get is(){return"vaadin-number-field"}static get version(){return"2.5.4"}static get properties(){return{hasControls:{type:Boolean,value:!1,reflectToAttribute:!0},min:{type:Number,reflectToAttribute:!0,observer:"_minChanged"},max:{type:Number,reflectToAttribute:!0,observer:"_maxChanged"},step:{type:Number,value:1,observer:"_stepChanged"}}}ready(){super.ready(),this.__previousValidInput=this.value||"",this.inputElement.type="number",this.inputElement.addEventListener("change",this.__onInputChange.bind(this))}_decreaseButtonTouchend(e){e.preventDefault(),this._decreaseValue()}_increaseButtonTouchend(e){e.preventDefault(),this._increaseValue()}static get template(){if(!memoizedTemplate){memoizedTemplate=super.template.cloneNode(!0);const e=DomModule.import(this.is+"-template","template"),t=e.content.querySelector('[part="decrease-button"]'),o=e.content.querySelector('[part="increase-button"]'),i=e.content.querySelector("style"),r=memoizedTemplate.content.querySelector('[part="input-field"]'),s=memoizedTemplate.content.querySelector('[name="prefix"]');r.insertBefore(t,s),r.appendChild(o),memoizedTemplate.content.appendChild(i)}return memoizedTemplate}_createConstraintsObserver(){this._createMethodObserver("_constraintsChanged(required, minlength, maxlength, pattern, min, max, step)")}_constraintsChanged(e,t,o,i,r,s,n){if(!this.invalid)return;const a=e=>!e&&0!==e;a(r)&&a(s)?super._constraintsChanged(e,t,o,i):this.validate()}_decreaseValue(){this._incrementValue(-1)}_increaseValue(){this._incrementValue(1)}_incrementValue(e){if(this.disabled||this.readonly)return;let t=parseFloat(this.value);this.value?t<this.min?(e=0,t=this.min):t>this.max&&(e=0,t=this.max):0==this.min&&e<0||0==this.max&&e>0||0==this.max&&0==this.min?(e=0,t=0):(null==this.max||this.max>=0)&&(null==this.min||this.min<=0)?t=0:this.min>0?(t=this.min,this.max<0&&e<0&&(t=this.max),e=0):this.max<0&&(t=this.max,e<0?e=0:this._getIncrement(1,t-this.step)>this.max?t-=2*this.step:t-=this.step);const o=this._getIncrement(e,t);this.value&&0!=e&&!this._incrementIsInsideTheLimits(e,t)||this._setValue(o)}_setValue(e){this.value=this.inputElement.value=String(parseFloat(e)),this.dispatchEvent(new CustomEvent("change",{bubbles:!0}))}_getIncrement(e,t){let o=this.step||1,i=this.min||0;const r=Math.max(this._getMultiplier(t),this._getMultiplier(o),this._getMultiplier(i));o*=r,i*=r;const s=((t=Math.round(t*r))-i)%o;return e>0?(t-s+o)/r:e<0?(t-(s||o))/r:t/r}_getDecimalCount(e){const t=String(e),o=t.indexOf(".");return-1===o?1:t.length-o-1}_getMultiplier(e){if(!isNaN(e))return Math.pow(10,this._getDecimalCount(e))}_incrementIsInsideTheLimits(e,t){return e<0?null==this.min||this._getIncrement(e,t)>=this.min:e>0?null==this.max||this._getIncrement(e,t)<=this.max:this._getIncrement(e,t)<=this.max&&this._getIncrement(e,t)>=this.min}_allowed(e){const t=e*(this.step||1),o=parseFloat(this.value);return!this.value||!this.disabled&&this._incrementIsInsideTheLimits(t,o)}_stepChanged(e){this.__validateByStep=this.__stepChangedCalled||null!==this.getAttribute("step"),this.inputElement.step=this.__validateByStep?e:"any",this.__stepChangedCalled=!0,this.setAttribute("step",e)}_minChanged(e){this.inputElement.min=e}_maxChanged(e){this.inputElement.max=e}_valueChanged(e,t){e&&isNaN(parseFloat(e))?this.value="":"string"!=typeof this.value&&(this.value=String(this.value)),super._valueChanged(this.value,t)}_onKeyDown(e){38==e.keyCode?(e.preventDefault(),this._increaseValue()):40==e.keyCode&&(e.preventDefault(),this._decreaseValue()),super._onKeyDown(e)}__onInputChange(){this.validate()}checkValidity(){return void 0!==this.min||void 0!==this.max||this.__validateByStep?this.inputElement.checkValidity():super.checkValidity()}}window.customElements.define(NumberFieldElement.is,NumberFieldElement);const $_documentContainer$j=html$1`<dom-module id="lumo-text-area" theme-for="vaadin-text-area">
  <template>
    <style include="lumo-text-field">
      [part="input-field"],
      [part="input-field"] ::slotted(textarea) {
        /* Equal to the implicit padding in vaadin-text-field */
        padding-top: calc((var(--lumo-text-field-size) - 1em * var(--lumo-line-height-s)) / 2);
        padding-bottom: calc((var(--lumo-text-field-size) - 1em * var(--lumo-line-height-s)) / 2);
        height: auto;
        box-sizing: border-box;
        transition: background-color 0.1s;
        line-height: var(--lumo-line-height-s);
      }

      :host(:not([readonly])) [part="input-field"]::after {
        display: none;
      }

      :host([readonly]) [part="input-field"] {
        border: 1px dashed var(--lumo-contrast-30pct);
      }

      :host([readonly]) [part="input-field"]::after {
        border: none;
      }

      :host(:hover:not([readonly]):not([focused])) [part="input-field"] {
        background-color: var(--lumo-contrast-20pct);
      }

      @media (pointer: coarse) {
        :host(:hover:not([readonly]):not([focused])) [part="input-field"] {
          background-color: var(--lumo-contrast-10pct);
        }

        :host(:active:not([readonly]):not([focused])) [part="input-field"] {
          background-color: var(--lumo-contrast-20pct);
        }
      }

      [part="value"],
      [part="input-field"] ::slotted(textarea) {
        line-height: inherit;
        --_lumo-text-field-overflow-mask-image: none;
      }

      /* Vertically align icon prefix/suffix with the first line of text */
      [part="input-field"] ::slotted(iron-icon) {
        margin-top: calc((var(--lumo-icon-size-m) - 1em * var(--lumo-line-height-s)) / -2);
      }

      [part="input-field"] [part="value"],
      [part="input-field"] ::slotted(textarea) {
        white-space: pre-wrap; /* override \`nowrap\` from <vaadin-text-field> */
        align-self: stretch; /* override \`baseline\` from <vaadin-text-field> */
      }
    </style>
  </template>
</dom-module>`;document.head.appendChild($_documentContainer$j.content);
/**
@license
Copyright (c) 2017 Vaadin Ltd.
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
*/
class TextAreaElement extends(ElementMixin$1(TextFieldMixin(ThemableMixin(PolymerElement)))){static get template(){return html$1`
    <style include="vaadin-text-field-shared-styles">
      .vaadin-text-area-container {
        flex: auto;
        max-height: inherit; /* MSIE 11 */
        min-height: inherit; /* MSIE 11 */
      }

      /* The label and the error message should neither grow nor shrink. */
      [part="label"],
      [part="error-message"] {
        flex: none;
      }

      [part="input-field"] {
        overflow: auto;
        -webkit-overflow-scrolling: touch;
      }

      [part="value"] {
        resize: none;
      }

      [part="value"],
      [part="input-field"] ::slotted(*) {
        align-self: flex-start;
      }

      @keyframes vaadin-text-area-appear {
        to {
          opacity: 1;
        }
      }

      :host {
        animation: 1ms vaadin-text-area-appear;
      }
    </style>

    <div class="vaadin-text-area-container">

      <label part="label" on-click="focus" id="[[_labelId]]">[[label]]</label>

      <div part="input-field" id="[[_inputId]]">

        <slot name="prefix"></slot>

        <slot name="textarea">
          <textarea part="value"></textarea>
        </slot>

        <div part="clear-button" id="clearButton" role="button" aria-label\$="[[i18n.clear]]"></div>
        <slot name="suffix"></slot>

      </div>

      <div part="error-message" id="[[_errorId]]" aria-live="assertive" aria-hidden\$="[[_getErrorMessageAriaHidden(invalid, errorMessage, _errorId)]]">[[errorMessage]]</div>

    </div>
`}static get is(){return"vaadin-text-area"}static get version(){return"2.5.4"}static get observers(){return["_textAreaValueChanged(value)"]}ready(){super.ready(),this._updateHeight(),this.addEventListener("animationend",this._onAnimationEnd)}_onAnimationEnd(e){0===e.animationName.indexOf("vaadin-text-area-appear")&&this._updateHeight()}get _slottedTagName(){return"textarea"}_textAreaValueChanged(e){this._updateHeight()}_updateHeight(){const e=this.root.querySelector("[part=input-field]"),t=e.scrollTop,o=this.inputElement,i=getComputedStyle(o).width,r=this.value?this.value.length:0;this._oldValueLength>=r&&(o.style.maxWidth=i,o.style.height="auto",e.style.display="block"),this._oldValueLength=r;const s=o.scrollHeight;s>o.clientHeight&&(o.style.height=s+"px"),o.style.removeProperty("max-width"),e.style.removeProperty("display"),e.scrollTop=t,this._dispatchIronResizeEventIfNeeded("InputHeight",s)}}customElements.define(TextAreaElement.is,TextAreaElement);var __decorate=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n};let WcNumberBox=(()=>{var e;let t=e=class extends LitElement{constructor(){super(...arguments),this.mode="both",this.sliderImmediateUpdate=!1,this.updateWcBox=!0,this.selection=null,this.feature=null,this.property=null,this.label=null,this.suffix=null,this.origin=null,this.selector=null,this.value=null,this.callback=null,this.previewCallback=null,this.textLengthProperty=null,this.customMin=0,this.customMax=100,this.customMeta=null,this._uiSliderValue=null,this.startClientX=0,this.sliderMoves="not",this.percentX=30,this.newPercent=0,this.newSliderValue=0,this.sliderStartPercent=0,this.mouseMoveDelegate=e=>this.sliderMove(e),this.mouseUpDelegate=e=>this.sliderUp(e)}static get moverSize(){return isMobile()?15:10}get uiSliderValue(){return null===this._uiSliderValue?this.uiValue||0:this._uiSliderValue}set uiSliderValue(e){this._uiSliderValue=e,this.requestUpdate()}static get styles(){return css`
            
            :host, :host * {
                box-sizing: border-box;
                
            }

            :host {
                width: 100%;
                position: relative;
                
                --printess-mover-size: ${this.moverSize}px;
                --printess-slider-height: ${this.moverSize+2}px;
                display: block; 
              
              
            }

           
            
            vaadin-number-field {
                width: 100%;
            }
            .slider-height {
              height:  var(--printess-slider-height);
            }
            .slider {
               /* width: calc(100% - var(--printess-mover-size));*/
                /*padding-left: calc(var(--printess-mover-size) / 2);*/ 
                left: calc(var(--printess-mover-size) / 2); 
                right: calc(var(--printess-mover-size) / 2); 
                height: var(--printess-slider-height);
                position: absolute;
               
            }
            .rail {
                position:absolute;
                width: 100%;
                top: 50%;
                transform: translateY(-50%);
                transform-origin: 50% 50%;
                height: 2px; 
                background-color: var(--printess-slider-rail);
            }
            .start {
                position: absolute;
                top: 50%; 
                left: 30%;
                transform: translate(-50%, -50%);
                transform-origin: 50% 50%;
                background-color: var(--printess-headlineColor);
                width: var(--printess-mover-size);
                height:  var(--printess-mover-size);
                border-radius: 50%;
                cursor: pointer;
            }
            .start:after {
                content: "";
                position: absolute;
                left: -5px;
                right: -5px;
                top: -5px;
                bottom: -5px;
                background-color: transparent; /*rgba(255,0,0,0.3);*/
               }
            .start.out-of-bounds {
                background-color: gray;
            }
            @media (max-width:  ${config.mobileDeviceWidth}px) {
                 
                 .start {
                    background-color: white;
                 }
                 :host {
                    
                    --printess-slider-height: 30px;
                    --printess-mover-size: 15px;
                   /* width: calc(100% - 70px);/ /* for reset button */
                }
                vaadin-number-field {
                  display: block;
                }
                
            }
        `}render(){return"slider"===this.mode?html`<div class="slider"  @touchstart="${e=>this.railStartMouseTouch(e)}"  @mousedown="${e=>this.railStartMouseTouch(e)}">   
                    <div class="rail"></div>
                    <div class="start ${this.sliderOutOfBounds?"out-of-bounds":""}"  @touchstart="${e=>this.sliderStartTouch(e)}" @mousedown="${e=>this.sliderStartDown(e)}" style="left: 30%"></div>
                </div><div class="slider-height"></div>`:"input"===this.mode?html`
         
            <vaadin-number-field   theme="small"    ?disabled=${this.uiDisabled}  
                @change=${e=>this.uiValue=e.currentTarget?parseFloat(e.currentTarget.value):null}  
                label="${this.uiLabel}"   suffix="${this.meta.postfix}" 
                .value=${this.uiValue} ?has-controls="${this.uiHasControls}" min="${this.uiMin}" max="${this.uiMax}" step="${this.uiStep}"
               >
            </vaadin-number-field>
                                
        `:html`
            <vaadin-number-field   theme="small"  ?disabled=${this.uiDisabled}  
                @change=${e=>this.uiValue=e.currentTarget?parseFloat(e.currentTarget.value):null}  
                label="${this.uiLabel}"   suffix="${this.meta.postfix}" 
                .value=${this.uiSliderValue} ?has-controls="${this.uiHasControls}" min="${this.uiMin}" max="${this.uiMax}" step="${this.uiStep}"
               >
            </vaadin-number-field>
            <div class="slider" @touchstart="${e=>this.railStartMouseTouch(e)}"  @mousedown="${e=>this.railStartMouseTouch(e)}">   
                <div class="rail"></div>
                <div class="start ${this.sliderOutOfBounds?"out-of-bounds":""}"  @touchstart="${e=>this.sliderStartTouch(e)}" @mousedown="${e=>this.sliderStartDown(e)}" style="left: 30%"></div>
            </div><div class="slider-height"></div>
         
                                
        `}get sliderPercent(){const e=this.meta,t=this.ui(e.min),o=this.ui(e.max),i=this.uiValue||0;let r=0;return o>t&&(r=(i-t)/(o-t)*100),Math.min(100,Math.max(0,r))}set sliderPercent(e){const t=this.meta,o=this.ui(t.min),i=this.ui(t.max);if(i>o){let r=e/100*(i-o)+o;if(t.step>0){r=Math.round(r/t.step)*t.step;const e=Math.pow(10,t.digits);r=Math.round(r*e)/e}this.sliderImmediateUpdate?(this.uiValue=r,this.uiSliderValue=r):(this.uiSliderValue=r,this.setUIValue(r,!0))}}get sliderOutOfBounds(){const e=this.uiMin,t=this.uiMax,o=this.uiValue||0;let i=0;return t>e&&(i=(o-e)/(t-e)*100),i<0||i>100}updated(e){if(this.shadowRoot&&(e.has("value")||e.has("selection")||e.has("property"))){const e=this.shadowRoot.querySelector(".start");e&&"not"===this.sliderMoves&&(e.style.left=this.sliderPercent+"%",this.updateComplete.then((()=>{this.uiSliderValue=this.uiValue||0})))}}railStartMouseTouch(e){if(e.preventDefault(),e.target&&!e.target.classList.contains("start")){let t=0;t=e.touches?e.touches[0].clientX:e.clientX,t-=getElementOffset$1(e.target,"offsetLeft"),t=Math.min(this.width(),Math.max(0,t)),this.sliderPercent=t/this.width()*100,this.sliderImmediateUpdate||(this.uiValue=this.uiSliderValue)}}sliderStartTouch(e){e.preventDefault(),e.target&&e.target.classList.contains("start")&&(this.startClientX=e.touches[0].clientX,this.sliderStartPercent=this.sliderPercent,this.sliderMoves="touch",document.addEventListener("touchmove",this.mouseMoveDelegate,{passive:!1}),document.addEventListener("touchend",this.mouseUpDelegate,{passive:!1}))}sliderStartDown(e){e.preventDefault(),e.target&&e.target.classList.contains("start")&&(this.startClientX=e.clientX,this.sliderStartPercent=this.sliderPercent,this.sliderMoves="mouse",document.addEventListener("mousemove",this.mouseMoveDelegate),document.addEventListener("mouseup",this.mouseUpDelegate))}sliderMove(e){if(e.preventDefault(),e.stopImmediatePropagation(),this.shadowRoot){let t=0;t=e.touches?e.touches[0].clientX:e.clientX;const o=t-this.startClientX,i=this.shadowRoot.querySelector(".start");i&&(this.newPercent=this.sliderStartPercent+o/this.width()*100,this.newPercent=Math.min(Math.max(0,this.newPercent),100),i.style.left=this.newPercent+"%",this.sliderPercent=this.newPercent)}}sliderUp(e){e.preventDefault(),e.stopPropagation(),"mouse"===this.sliderMoves?(document.removeEventListener("mousemove",this.mouseMoveDelegate),document.removeEventListener("mouseup",this.mouseUpDelegate)):(document.removeEventListener("touchmove",this.mouseMoveDelegate),document.removeEventListener("touchend",this.mouseUpDelegate)),this.sliderMoves="not",this.sliderImmediateUpdate||this.setUIValue(this.uiSliderValue,!1)}width(){return this.shadowRoot?this.shadowRoot.host.getBoundingClientRect().width-e.moverSize:100}get uiHasStyleSelector(){return!this.extendedValue.selector}get uiHasControls(){return this.meta.restrictStep||!1}get meta(){return this.customMeta?this.customMeta:e.getNumberMeta(this.property,this.textLengthProperty,this.customMin,this.customMax)}static getNumberMeta(e,t=null,o=0,i=100){let r=0,s=100,n=1,a=0;switch(e){case"rotation":return{min:-360,max:360,step:5,digits:2,postfix:""};case"hueRotate":return{min:0,max:360,step:5,digits:2,postfix:""};case"colorTint":case"colorOpacity":case"opacity":return{min:0,max:100,step:1,digits:0,postfix:"%",restrictStep:!1,restrictRange:!0};case"colorLightness":case"colorSaturation":return{min:-100,max:100,step:1,digits:0,postfix:"%",restrictStep:!1,restrictRange:!0};case"colorHue":return{min:-180,max:180,step:1,digits:0,postfix:"",restrictStep:!0,restrictRange:!0};case"maxLetterWidth":case"minLetterWidth":return{min:70,max:200,step:1,digits:0,postfix:"%",restrictStep:!1,restrictRange:!1};case"maxLetterSpacing":case"minLetterSpacing":return{min:80,max:300,step:1,digits:0,postfix:"%",restrictStep:!1,restrictRange:!1};case"startX":return{min:0,max:100,step:1,digits:0,postfix:"%",restrictStep:!1,restrictRange:!0};case"warpCupPhi":return{min:90,max:180,step:1,digits:0,postfix:"",restrictStep:!1,restrictRange:!0};case"warpArchPhi":return{min:0,max:180,step:1,digits:0,postfix:"",restrictStep:!1,restrictRange:!0,uiOffset:-90};case"warpCustomBottomWaves":case"warpCustomTopWaves":case"warpFishWaves":case"warpFlagWaves":return{min:1,max:50,step:.5,digits:1,postfix:"waves",restrictStep:!0};case"warpCustomTopPhase":case"warpCustomBottomPhase":case"warpFlagPhase":return{min:0,max:Math.ceil(1e3*Math.PI)/1e3,step:Math.round(Math.PI/8*1e3)/1e3,digits:3,postfix:"",restrictRange:!0};case"warpCustomTopHeightFraction":case"warpCustomBottomHeightFraction":case"warpPitHeightFraction":return{min:-1,max:1,step:.01,digits:2,postfix:""};case"warpArcHeightFraction":return{min:-1,max:3,step:.01,digits:2,postfix:""};case"warpFlagHeightFraction":case"warpFishHeightFraction":return{min:-.5,max:1,step:.01,digits:2,postfix:""};case"tracking":return{min:-500,max:2500,step:50,digits:0,postfix:"",restrictStep:!1,restrictRange:!1};case"warpCupY":return{min:-100,max:100,step:1,digits:0,postfix:"",restrictStep:!1,restrictRange:!0};case"blurIntensity":return{min:0,max:20,step:.2,digits:1,postfix:"",restrictStep:!1,restrictRange:!0};case"maxCharacters":return{min:0,max:100,step:1,digits:1,postfix:"",restrictStep:!0,restrictRange:!0};case"turbulenceFrequency":case"distortFrequency":return{min:.1,max:30,step:.1,digits:1,postfix:"",restrictStep:!1,restrictRange:!1};case"turbulenceOctaves":case"distortOctaves":return{min:1,max:4,step:1,digits:0,postfix:"",restrictStep:!1,restrictRange:!0};case"turbulenceScale":case"distortScale":return{min:10,max:90,step:.5,digits:1,postfix:"",restrictStep:!0,restrictRange:!0};case"bevelSurfaceScale":return{min:1,max:10,step:.2,digits:1,postfix:"",restrictStep:!0,restrictRange:!0};case"bevelSpecularConstant":return{min:.1,max:1,step:.01,digits:2,postfix:"",restrictStep:!1,restrictRange:!1};case"wrapAscenderDiminisher":return{min:0,max:1,step:.01,digits:2,postfix:"",restrictStep:!0,restrictRange:!0};case"bevelspecularExponent":return{min:0,max:100,step:1,digits:0,postfix:"",restrictStep:!1,restrictRange:!1};case"bevelPointLightX":case"bevelPointLightY":return{min:-1e4,max:1e4,step:10,digits:0,postfix:"",restrictStep:!1,restrictRange:!1};case"bevelPointLightZ":return{min:0,max:6e3,step:10,digits:0,postfix:"",restrictStep:!1,restrictRange:!1};case"brightness":case"contrast":case"saturate":case"bulletShift":return{min:-100,max:100,step:1,digits:0,postfix:"%",restrictStep:!1,restrictRange:!0};case"bulletSize":return{min:-50,max:100,step:1,digits:0,postfix:"%",restrictStep:!1,restrictRange:!0};case"grayscale":case"sepia":case"invert":return{min:0,max:100,step:1,digits:0,postfix:"%",restrictStep:!1,restrictRange:!0};case"genericPtProperty":return r=3,s=180,"baselineShift"===t&&(r=-80),"spaceAfterParagraph"!==t&&"spaceBeforeParagraph"!==t&&"leftIndent"!==t&&"rightIndent"!==t&&"firstLineIndent"!==t||(r=0),"fontSize"===t&&(s=90),{min:r,max:s,step:1,digits:0,postfix:"pt",restrictStep:!1,restrictRange:!1};case"genericPxProperty":return"strokeWidth"===t?{min:0,max:200,step:1,digits:0,postfix:"px",restrictStep:!1,restrictRange:!1}:"fontStrokeWidth"===t||"pathTextStrokeWidth"===t?{min:0,max:20,step:.1,digits:1,postfix:"px",restrictStep:!1,restrictRange:!1}:(null==t?void 0:t.startsWith("padding"))||"wrapShapeOffset"===t||"wrapObjectOffset"===t?{min:0,max:200,step:1,digits:1,postfix:"px",restrictStep:!1,restrictRange:!1}:"inShadowSpreadRadius"==t||"dropSpreadRadius"==t||"inGlowSpreadRadius"==t||"outGlowSpreadRadius"==t||"inShadowBlurRadius"==t||"dropBlurRadius"==t||"inGlowBlurRadius"==t||"bevelBlur"==t||"outGlowBlurRadius"==t?{min:0,max:20,step:.2,digits:1,postfix:"px",restrictStep:!1,restrictRange:!1}:(r=3,"baselineShift"===t||"distance"===t?r=-100:"leftIndent"!==t&&"rightIndent"!==t&&"firstLineIndent"!==t||(r=0),{min:r,max:100,step:1,digits:0,postfix:"px",restrictStep:!1,restrictRange:!1});case"percent":return{min:0,max:100,step:1,digits:0,postfix:"%",restrictStep:!0,restrictRange:!0};case"genericPercentProperty":return r=0,s=200,n=5,"baselineShift"===t&&(r=-200),"fontSize"===t&&(r=1,s=30,n=1),"distance"===t&&(r=0,s=30,n=.1,a=1),"fontStrokeWidth"!==t&&"pathTextStrokeWidth"!==t||(r=0,s=10,n=.1,a=1),"strokeWidth"===t&&(r=0,s=50,n=.1,a=1),((null==t?void 0:t.startsWith("padding"))||"wrapShapeOffset"===t||"wrapObjectOffset"===t)&&(r=0,s=50,n=.1,a=1),"dropXoffset"!=t&&"dropYoffset"!=t&&"inGlowXoffset"!=t&&"inGlowYoffset"!=t&&"outGlowXoffset"!=t&&"outGlowYoffset"!=t&&"inShadowXoffset"!=t&&"inShadowYoffset"!=t&&"strokeXoffset"!=t&&"strokeYoffset"!=t||(r=-20,s=20,n=1),"leftIndent"!=t&&"rightIndent"!=t&&"firstLineIndent"!=t||(r=0,s=50,n=.2),"spaceAfterParagraph"!=t&&"spaceBeforeParagraph"!=t||(r=0,s=200,n=1),"inShadowSpreadRadius"!=t&&"dropSpreadRadius"!=t&&"inGlowSpreadRadius"!=t&&"outGlowSpreadRadius"!=t&&"strokeSpreadRadius"!=t&&"inShadowBlurRadius"!=t&&"dropBlurRadius"!=t&&"inGlowBlurRadius"!=t&&"outGlowBlurRadius"!=t&&"strokeBlurRadius"!=t||(r=0,s=10,n=.1,a=1),"bevelBlur"==t&&(r=1,s=10,n=.1,a=1),{min:r,max:s,step:n,digits:a,postfix:"%",restrictStep:!1,restrictRange:!1};case"meshColumns":case"meshRows":return{min:3,max:50,step:1,digits:0,postfix:"",restrictStep:!0,restrictRange:!0};case"corners":return{min:2,max:30,step:1,digits:0,postfix:"",restrictStep:!0,restrictRange:!0};case"customStrictStep1":return{min:o,max:i,step:1,digits:0,postfix:"",restrictStep:!0,restrictRange:!0};case"customMinMax":return{min:o,max:i,step:(i-o)/100,digits:3,postfix:"",restrictStep:!1,restrictRange:!0};case"innerRadius":return{min:5,max:95,step:1,digits:0,postfix:"",restrictStep:!0,restrictRange:!0};case"strokeGapFactor":case"strokeDashFactor":case"fontStrokeDashFactor":case"fontStrokeGapFactor":return{min:.05,max:10,step:.01,digits:2,postfix:"",restrictStep:!1,restrictRange:!1};case"transformTopLeftX":case"transformTopLeftY":case"transformTopRightX":case"transformTopRightY":case"transformBottomRightX":case"transformBottomRightY":case"transformBottomLeftX":case"transformBottomLeftY":case"imageXPosition":case"imageYPosition":case"imageWidthScale":case"imageHeightScale":case"docXPosition":case"docYPosition":case"docWidthScale":case"docHeightScale":case"verticalFocalPoint":case"horizontalFocalPoint":case"verticalFocalPointDocument":case"horizontalFocalPointDocument":case null:case"customMeta":return{min:0,max:1e4,step:100,digits:0,postfix:""};default:assertNever$1(e)}}get uiOffset(){return this.meta.uiOffset||0}get uiMultiplier(){return this.meta.uiMultiplier||1}ui(e){return e*this.uiMultiplier+this.uiOffset}model(e){return(e-this.uiOffset)/this.uiMultiplier}get uiMin(){return!0===this.meta.restrictRange?this.ui(this.meta.min):-1/0}get uiMax(){return!0===this.meta.restrictRange?this.ui(this.meta.max):1e9}get uiStep(){return!0===this.meta.restrictStep?this.meta.step:1e-4}get uiDisabled(){return isInactive(this.extendedValue)}set uiValue(e){null!==e&&e!==this.uiValue&&this.setUIValue(e,!1)}get uiValue(){let e=null;if(this.selection&&this.property&&this.feature){if(!isNumberProperty(this.property))throw new Error(this.property+"-property can't be used on selection.");e=this.selection.getValueExtended(this.feature,this.property).value}else e=this.value;return null===e?null:this.ui(e)}setUIValue(e,t){const o=this.model(e);if(!t||this.updateWcBox){if(this.selection&&this.property&&this.feature){if(!isNumberProperty(this.property))throw new Error(this.property+"-property can't be used on selection.");"wrapAscenderDiminisher"===this.property?this.selection.setValue(this.feature,this.property,o,!1).then((()=>{var e;(null===(e=this.property)||void 0===e?void 0:e.startsWith("padding"))&&scope().eddiRefreshActiveFrameInfos(),this.requestUpdate()})):this.selection.setValue(this.feature,this.property,o,t)}this.callback&&this.callback(o,t)}else this.previewCallback&&this.previewCallback(o,!0)}get extendedValue(){if(this.selection&&this.property&&this.feature){if(isNumberProperty(this.property))return this.selection.getValueExtended(this.feature,this.property);throw new Error(this.property+"-property can't be used on selection.")}return{value:this.value,selector:this.selector,origin:this.origin}}get uiLabel(){if(this.label)return this.label;let e="Number";if(this.property)switch(this.property){case"warpCustomTopHeightFraction":case"warpCustomBottomHeightFraction":case"warpArcHeightFraction":case"warpFishHeightFraction":case"warpFlagHeightFraction":case"warpPitHeightFraction":e="Height Fraction";break;case"tracking":e="Tracking";break;case"startX":e="Position on path";break;case"rotation":e="Rotation";break;case"warpCustomBottomWaves":case"warpCustomTopWaves":case"warpFishWaves":case"warpFlagWaves":e="Wave Count";break;case"warpCustomTopPhase":case"warpCustomBottomPhase":case"warpFlagPhase":e="Phase Shift";break;case"warpCupPhi":case"warpArchPhi":e="Angle";break;case"warpCupY":e="Offset Y";break;case"meshRows":e="Rows";break;case"blurIntensity":e="Intensity";break;case"turbulenceFrequency":case"distortFrequency":e="Frequency";break;case"turbulenceOctaves":case"distortOctaves":e="Octave";break;case"turbulenceScale":case"distortScale":e="Scale";break;case"meshColumns":e="Columns";break;case"colorTint":e="Tint";break;case"opacity":case"colorOpacity":e="Opacity";break;case"colorLightness":e="Lightness";break;case"colorHue":e="Hue";break;case"colorSaturation":e="Saturation";break;case"brightness":case"contrast":case"hueRotate":case"saturate":case"grayscale":case"sepia":case"invert":e=this.property;break;case"bevelPointLightZ":e="Elevation";break;case"strokeGapFactor":case"fontStrokeGapFactor":e="Gap Size";break;case"strokeDashFactor":case"fontStrokeDashFactor":e="Dash Size";break;case"bevelspecularExponent":case"bevelSurfaceScale":case"bevelSpecularConstant":case"bevelPointLightX":case"bevelPointLightY":e=this.property;break;case"maxLetterSpacing":e="Max Spacing";break;case"minLetterSpacing":e="Min Spacing";break;case"maxLetterWidth":e="Max Letter Width";break;case"minLetterWidth":e="Min Letter Width";break;case"corners":e="Corners";break;case"customStrictStep1":e=this.label||"Set label on wc-number";break;case"innerRadius":e="Inner Radius";break;case"bulletShift":e="Bullet Shift";break;case"bulletSize":e="Bullet Size";break;case"maxCharacters":e="Max. Chars";break;case"wrapAscenderDiminisher":e="Ascender Reduction";break;case"transformTopLeftX":case"transformTopLeftY":case"transformTopRightX":case"transformTopRightY":case"transformBottomRightX":case"transformBottomRightY":case"transformBottomLeftX":case"transformBottomLeftY":case"imageXPosition":case"imageYPosition":case"imageWidthScale":case"imageHeightScale":case"docXPosition":case"docYPosition":case"docWidthScale":case"docHeightScale":case"verticalFocalPoint":case"horizontalFocalPoint":case"verticalFocalPointDocument":case"horizontalFocalPointDocument":case"customMinMax":case"genericPtProperty":case"genericPxProperty":case"genericPercentProperty":case"percent":case"customMeta":e="not in use in ui";break;default:assertNever$1(this.property)}return augmentLabel(e,this.extendedValue)}};return __decorate([property()],t.prototype,"mode",void 0),__decorate([property({type:Boolean})],t.prototype,"sliderImmediateUpdate",void 0),__decorate([property({type:Boolean})],t.prototype,"updateWcBox",void 0),__decorate([property({attribute:!1,type:Object})],t.prototype,"selection",void 0),__decorate([property()],t.prototype,"feature",void 0),__decorate([property()],t.prototype,"property",void 0),__decorate([property()],t.prototype,"label",void 0),__decorate([property()],t.prototype,"suffix",void 0),__decorate([property()],t.prototype,"origin",void 0),__decorate([property()],t.prototype,"selector",void 0),__decorate([property({attribute:!1})],t.prototype,"value",void 0),__decorate([property({attribute:!1})],t.prototype,"callback",void 0),__decorate([property({attribute:!1})],t.prototype,"previewCallback",void 0),__decorate([property({type:String})],t.prototype,"textLengthProperty",void 0),__decorate([property({type:Number})],t.prototype,"customMin",void 0),__decorate([property({type:Number})],t.prototype,"customMax",void 0),__decorate([property({type:Object})],t.prototype,"customMeta",void 0),t=e=__decorate([customElement("wc-number-box")],t),t})();
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const _state=new WeakMap,_infinity=2147483647,until=directive(((...e)=>t=>{let o=_state.get(t);void 0===o&&(o={lastRenderedIndex:_infinity,values:[]},_state.set(t,o));const i=o.values;let r=i.length;o.values=e;for(let s=0;s<e.length&&!(s>o.lastRenderedIndex);s++){const n=e[s];if(isPrimitive(n)||"function"!=typeof n.then){t.setValue(n),o.lastRenderedIndex=s;break}s<r&&n===i[s]||(o.lastRenderedIndex=_infinity,r=0,Promise.resolve(n).then((e=>{const i=o.values.indexOf(n);i>-1&&i<o.lastRenderedIndex&&(o.lastRenderedIndex=i,t.setValue(e),t.commit())})))}}));var __awaiter$5=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};function loadBlobAsDataUrl(e){return new Promise(((t,o)=>{const i=new FileReader;i.onload=function(){t(i.result)},i.onerror=function(e){o(e)},i.readAsDataURL(e)}))}function scaleDown(e,t){const o=document.createElement("canvas"),i=t/e.width,r=i<.1;r?(o.width=.1*e.width,o.height=.1*e.height):(o.width=t,o.height=Math.ceil(e.height*i));const s=o.getContext("2d");if(!s)throw o.width=0,o.height=0,"Cannot create 2d canvas context.";if(s.drawImage(e,0,0,o.width,o.height),r)try{return scaleDown(o,t)}finally{o.width=0,o.height=0}return o}function scaleImage(e,t){return new Promise(((o,i)=>{const r=scaleDown(e,t);r.toBlob((e=>{try{if(!e)return void i("Could not create blob of canvas.");const t={width:r.width,height:r.height,blob:e};o(t)}finally{r.width=0,r.height=0}}))}))}function withPngExtension(e){const t=["jpg","jpeg","webp","bmp","gif"],o=e.toLowerCase();for(const i of t)if(o.endsWith("."+i))return e.substr(0,o.length-i.length-1)+".png";return e}function loadBlobAsArrayBuffer(e){return new Promise(((t,o)=>{const i=new FileReader;i.onload=function(){t(i.result)},i.onerror=function(e){o(e)},i.readAsArrayBuffer(e)}))}class TheUploader{constructor(e,t){this.uploadOriginal=!0,this.provider=e,this.uploadProgressCallback=t,this.uploadStati=new Map}fireUploadProgress(){if(!this.uploadProgressCallback)return;if(0===this.uploadStati.size)return void this.uploadProgressCallback(1);let e=0;for(const t of this.uploadStati.values())e+=t;e/=this.uploadStati.size,this.uploadProgressCallback(e)}setUploadProgress(e,t){this.uploadStati.set(e,t),this.fireUploadProgress()}onUploadProgress(e,t,o){const i=t/o;this.setUploadProgress(e,i)}calculateImageTargetWidth(e,t){const o=[];for(const t of[1600,800,400,200])1.25*t<e&&o.push(t);return o}uploadImage(e){var t,o;return __awaiter$5(this,void 0,void 0,(function*(){const i=yield loadImage(yield loadBlobAsDataUrl(e)),r=this.calculateImageTargetWidth(i.width,i.height),s=[];let n;if(null!==r&&r.length>0)for(const t of r){const o=withPngExtension(t+"_"+e.name);this.uploadStati.set(o,0)}const a=yield this.provider.upload(BlobToFormData(e.name,e,null===(t=this.provider.beforeAddingFormData)||void 0===t?void 0:t.bind(this.provider)),this.onUploadProgress.bind(this,e.name)),l={id:a.id,width:i.width,height:i.height,url:a.url,userState:a.userState};this.setUploadProgress(e.name,1);const c=l;if(null!==r&&r.length>0)for(const t of r){const r=yield scaleImage(i,t),n=withPngExtension(t+"_"+e.name),a=yield this.provider.upload(BlobToFormData(n,r.blob,null===(o=this.provider.beforeAddingFormData)||void 0===o?void 0:o.bind(this.provider)),this.onUploadProgress.bind(this,n)),l={id:a.id,width:r.width,height:r.height,url:a.url,userState:a.userState};this.setUploadProgress(n,1),s.push(l)}return n=s.length>0?{fileName:e.name,original:c,scaledVersions:s}:{fileName:e.name,original:c},this.uploadStati.clear(),n}))}uploadImages(e){var t;return __awaiter$5(this,void 0,void 0,(function*(){const o=[],i=!0===this.uploadOriginal,r=[];if(e&&e.length>0){for(const t of e)i&&(this.uploadStati.set(t.name,0),r.push(t.name));for(const s of e){const e=yield loadImage(yield loadBlobAsDataUrl(s)),n=this.calculateImageTargetWidth(e.width,e.height),a=null!==n&&n.length>0;let l,c=[],d=null;const h=!i&&!a;if(null!==n&&n.length>0)for(const e of n){const t=withPngExtension(e+"_"+s.name);this.uploadStati.set(t,0),r.push(t)}if(i||h){const o=yield this.provider.upload(BlobToFormData(s.name,s,null===(t=this.provider.beforeAddingFormData)||void 0===t?void 0:t.bind(this.provider)),this.onUploadProgress.bind(this,s.name)),i={id:o.id,width:e.width,height:e.height,url:o.url,userState:o.userState};this.setUploadProgress(s.name,1),d=i}if(null!==n&&n.length>0){const t=[];for(const o of n)t.push(scaleImage(e,o).then((e=>__awaiter$5(this,void 0,void 0,(function*(){var t;const i=withPngExtension(o+"_"+s.name),r=yield this.provider.upload(BlobToFormData(i,e.blob,null===(t=this.provider.beforeAddingFormData)||void 0===t?void 0:t.bind(this.provider)),this.onUploadProgress.bind(this,i)),n={id:r.id,width:e.width,height:e.height,url:r.url,userState:r.userState};return this.setUploadProgress(i,1),n})))));const o=yield Promise.all(t);for(const e of o)c.push(e);d||(d=c[0],c=c.slice(1))}if(!d)throw"No image to upload.";c.length>0?(l={fileName:s.name,original:d,scaledVersions:c},o.push(l)):(l={fileName:s.name,original:d},o.push(l))}}for(const e of r)this.uploadStati.delete(e);return this.fireUploadProgress(),o}))}processFont(e,t,o){var i,r;return __awaiter$5(this,void 0,void 0,(function*(){const s=100,n=hb.Printess.Font.loadFontInfoFromArrayBuffer(t),a=hb.Printess.Font.loadFontSvgFromArrayBuffer(t),l=yield this.provider.upload(BlobToFormData(n.uniqueName+".svg",new Blob([a],{type:"text/plain"}),null===(i=this.provider.beforeAddingFormData)||void 0===i?void 0:i.bind(this.provider))),c=yield this.provider.upload(BlobToFormData(o,e,null===(r=this.provider.beforeAddingFormData)||void 0===r?void 0:r.bind(this.provider)),this.onUploadProgress.bind(this,o)),d={id:c.id,url:c.url,family:n.familyName,face:n.faceName,upem:n.unitsPerEm,width:n.width,weight:n.weight,ascender:n.ascender*s/n.unitsPerEm,descender:n.descender*s/n.unitsPerEm,leading:n.leading*s/n.unitsPerEm,spaceWidth:n.spaceWidth*s/n.unitsPerEm,lineHeight:0,svgUrl:l.url,svgId:l.id};return d.lineHeight=d.ascender+d.descender+d.leading,d}))}uploadFonts(e){return __awaiter$5(this,void 0,void 0,(function*(){const t=[];if(e&&e.length>0){for(const t of e)this.uploadStati.set(t.name,0);for(const o of e){const e=yield loadBlobAsArrayBuffer(o),i=yield this.processFont(o,e,o.name);t.push(i)}for(const t of e)this.uploadStati.delete(t.name)}return this.fireUploadProgress(),t}))}uploadFontsFromUrls(e){return __awaiter$5(this,void 0,void 0,(function*(){const t=[];if(e.size>0){for(const t of e)this.uploadStati.set(t[0],0);for(const[o,i]of e){const e=yield fetch(o),r=yield e.blob(),s=yield loadBlobAsArrayBuffer(r),n=yield this.processFont(r,s,i);t.push(n)}for(const t of e)this.uploadStati.delete(t[0])}return this.fireUploadProgress(),t}))}}function scaleAllLengthValues(e,t){for(const o of Object.keys(e)){const i=e[o];if(i&&Object.prototype.hasOwnProperty.call(i,"u")){const e=i;"px"!==e.u&&"cm"!==e.u&&"inch"!==e.u&&"pt"!==e.u||(e.v=e.v*t)}else i&&"object"==typeof i&&scaleAllLengthValues(i,t)}}function translateLeftTopLengthValues(e,t,o){for(const i of Object.keys(e)){const r=e[i];if(r&&Object.prototype.hasOwnProperty.call(r,"u")){const e=r;"px"!==e.u&&"cm"!==e.u&&"inch"!==e.u&&"pt"!==e.u||("l"===i?(e.v=Length.deserialize(e).toPixel(100,100)+t,e.u="px"):"t"===i&&(e.v=Length.deserialize(e).toPixel(100,100)+o,e.u="px"))}else"object"==typeof r&&r&&translateLeftTopLengthValues(r,t,o)}}function scaleUnitsInString(e,t){let o=e;return o=e.replace(/(\d+\.*\d*)(cm|pt|inch|px)/gm,(e=>{const o=new Length(e);return o.value*t+o.unit})),o}function replaceAllColorNames(e,t,o,i){let r=!1;for(const s of Object.keys(e)){const n=e[s];if(n&&Object.prototype.hasOwnProperty.call(n,"color")&&Object.prototype.hasOwnProperty.call(n,"tint")){const e=n;e.color.na!==o&&e.id!==t||(i&&(e.color.na=i),r=!0)}else"object"==typeof n&&n&&replaceAllColorNames(n,t,o,i)&&(r=!0)}return r}class Span{constructor(e,t,o,i){this.parentWord=e,this.chars=t||"",this.dx=i,this.textStyle=o;const r=this.textStyle.getTrackingInPx(this);this.extraWidth=r;const s=[];let n="",a=0,l=0;for(let e=0;e<this.chars.length;e++){n+=this.chars[e];const t=this.textStyle.textWidth(this,n)-a;a+=t,s.push(t+r),l+=t+r}this.charWidth=s,this.width=l}get spanClasses(){return this.textStyle.properties.class?(new Set).add(this.textStyle.properties.class):new Set}get length(){return this.chars.length}insertChars(e,t){const o=this.chars.substr(0,e),i=this.chars.substr(e);return new Span(this.parentWord,o+t+i,this.textStyle,this.dx)}render(e=!1,t=0){let o=this.chars;e&&(o+="-");const i=document.createElementNS("http://www.w3.org/2000/svg","tspan");i.textContent=o;const r=o.length>1?this.textStyle.getTrackingInPx(this):0;if(r||this.dx||this.parentWord.justifyCharSpacing){let e=(t+this.dx).toString();for(let t=1;t<o.length;t++)e+=" "+(r+this.parentWord.justifyCharSpacing);i.setAttributeNS(null,"dx",e)}i.setAttributeNS(null,"style",this.textStyle.css(TextStyle.getFrameWidth(this),this));const s=this.textStyle.getY(this);return i.setAttributeNS(null,"y",s.toString()),i.setAttributeNS(null,"text-rendering","geometricPrecision"),i}serialize(){const e={t:this.chars};return Object.keys(this.textStyle.properties).length&&(e.s=this.textStyle.serialize()),e}static Deserialize(e,t,o){const i=TextStyle.deserialize(e.s);return new Span(t,e.t,i,o)}}const canvas=document.createElement("canvas"),contextTemp=canvas.getContext("2d");if(!contextTemp)throw"Canvas Context could not be created in TextStyle";let baseStylePropsCache,baseStylePropsCache$1;function baseStyleProps(){return baseStylePropsCache||(baseStylePropsCache={font:new FontRef("Noto Sans"),fontSize:new Length(12,"pt"),fontColor:ColorRef.Black_Color(),tracking:0,baselineShift:new Length(0,"px"),lineHeight:new Length(120,"%"),class:""}),baseStylePropsCache}function baseTextStyleProps(){return baseStyleProps()}class TextStyle{constructor(e,t){this.properties=e||{},this.temporaryProperties=t||{}}serialize(){const e={},t=this.properties;return t.class&&(e.c=t.class),t.fontColor&&(t.fontColor instanceof ColorRef?e.fc=t.fontColor.serialize():e.fc=t.fontColor),t.fontSize&&(e.fs=t.fontSize.serialize()),t.baselineShift&&(e.y=t.baselineShift.serialize()),t.lineHeight&&(e.lh=t.lineHeight.serialize()),t.tracking&&(e.tk=t.tracking),t.font&&(e.fn=t.font.serialize()),e}static deserialize(e){const t={};return e&&(e.fn&&(t.font=new FontRef(e.fn.id,e.fn)),e.fs&&(t.fontSize=Length.deserialize(e.fs)),e.fc&&("object"==typeof e.fc?t.fontColor=new ColorRef(e.fc.id,e.fc):t.fontColor=e.fc),e.y&&(t.baselineShift=Length.deserialize(e.y)),e.lh&&(t.lineHeight=Length.deserialize(e.lh)),e.tk&&(t.tracking=e.tk),e.c&&(t.class=e.c)),new TextStyle(t)}static getClassByContext(e){return e instanceof Eddi?e.class||"":e.textStyle.properties.class||""}static getEddiByContext(e){return e instanceof Span?e.parentWord.parentParagraph.parentEddi:e instanceof Paragraph?e.parentEddi:e instanceof Eddi?e:void 0}getTextStyleProperty(e,t){let o=this.temporaryProperties[t];if(void 0===o){const i=TextStyle.getStyleSheetPropertyFromClass(e,t);i&&i.value&&(o=i.value)}return void 0===o&&(o=this.properties[t]),void 0!==o?o:e instanceof Span?e.parentWord.parentParagraph.textStyle.getTextStyleProperty(e.parentWord.parentParagraph,t):TextStyle.getBaseStyleProperty(this.getEddi(e),t)}getTextStylePropertyExtended(e,t){let o=this.temporaryProperties[t],i="",r=TextStyle.getOrigin(e);if(void 0===o){const s=TextStyle.getStyleSheetPropertyFromClass(e,t);s&&s.value&&(o=s.value,i=s.selector||"",r=s.origin)}if(void 0===o&&(o=this.properties[t]),void 0!==o)return{value:o,selector:i,origin:r};if(e instanceof Span)return e.parentWord.parentParagraph.textStyle.getTextStylePropertyExtended(e.parentWord.parentParagraph,t);{const o=this.getEddi(e);if(o.class){const i=TextStyle._getStyleSheetPropertyFromClass(e,t,o.parentBoxIdForEvaluation);if(i)return{value:i,selector:o.class,origin:"Frame"}}return{value:TextStyle.getBaseStyleProperty(o,t),selector:"",origin:"Base"}}}static getBaseStyleProperty(e,t){if(e.class){const o=TextStyle._getStyleSheetPropertyFromClass(e,t,e.parentBoxIdForEvaluation);if(o)return o}const o=e.config.textStyleProperties[t];return o||baseStyleProps()[t]}getImmediateTextStyleProperty(e,t){let o;if(o=this.temporaryProperties[t],!o){const i=TextStyle.getStyleSheetPropertyFromClass(e,t);i&&i.value&&(o=i.value)}if(o||(o=this.properties[t]),o)return o;if(e instanceof Span){const o=e.parentWord.parentParagraph;return o.textStyle.getImmediateTextStyleProperty(o,t)}return null}static _getStyleSheetPropertyFromClass(e,t,o){const i=TextStyle.getClassByContext(e);if(i){const r=TextStyle.getEddiByContext(e);if(r&&r.config.getStyleProperty){let e={docWidth:1e3,docHeight:1e3};r.config.getDocDimensions&&(e=r.config.getDocDimensions());const s=r.config.getStyleProperty(i,t,e.docWidth,e.docHeight,o);if(s)return s.value}}return null}static getOrigin(e){return e instanceof Span?"Span":e instanceof Paragraph?"Paragraph":"Frame"}static getStyleSheetPropertyFromClass(e,t){var o;if(e.textStyle.properties.class){const i=this.getEddiByContext(e),r=TextStyle._getStyleSheetPropertyFromClass(e,t,null!==(o=null==i?void 0:i.parentBoxIdForEvaluation)&&void 0!==o?o:null);if(null!=r)return{origin:e instanceof Span?"Span":"Paragraph",value:r,selector:e.textStyle.properties.class}}return e instanceof Span&&e.parentWord.parentParagraph.textStyle.properties.class?TextStyle.getStyleSheetPropertyFromClass(e.parentWord.parentParagraph,t):null}static getTextStylePropertyFromSpans(e,t){let o;for(const i of e){let e;if("class"===t)throw new Error("Please use other method to retrieve 'class' property");e=i.textStyle.getTextStylePropertyExtended(i,t);let r=!1;if(void 0===o?o=e:r=o.value instanceof FontRef&&e.value instanceof FontRef||o.value instanceof ColorRef&&e.value instanceof ColorRef?!o.value.equals(e.value):o.value instanceof Length&&e.value instanceof Length?o.value.toString()!==e.value.toString():o.value!==e.value,r)return{value:null,selector:o.selector,origin:o.origin}}if(o)return o;throw"getTextStylePropertyFromSpans has no span in spans list"}static getClassPropertyFromSpans(e){const t=new Set;for(const o of e)o.length&&TextStyle.addClassValue(t,o.textStyle.properties.class);return TextStyle.getExtendedInfoFromClasses(t,"Span")}static getClassPropertyFromParagraphs(e){const t=new Set;for(const o of e)TextStyle.addClassValue(t,o.textStyle.properties.class);return TextStyle.getExtendedInfoFromClasses(t,"Paragraph")}static addClassValue(e,t){t&&e.add(t)}static getExtendedInfoFromClasses(e,t){let o;return o=e.size>1?"["+Array.from(e).map((e=>""===e?"none":e)).join(",")+"]":1===e.size?e.values().next().value:"",{value:o,selector:"",origin:t}}textWidth(e,t){const o=this.getEddi(e);let i=null;if(o.config.codeMode){const o=this.getEddi(e).codeModeTextWidthCache.get(t);if(o)return o;i=getMonoSpacedFont()}else{let t=this.getTextStyleProperty(e,"font");if(t||(t=baseStyleProps().font),!t)throw"textWidth -> No fontRef found.";i=t.font}const r=harfBuzzFonts.get(i.name);if(!r)throw"textWidth -> Cannot find harfbuzz font.";const s=getWidth(t,r,this.getFontSize(e));return o.config.codeMode&&o.codeModeTextWidthCache.set(t,s),s}static getFrameWidth(e,t){let o=111;if(!t||"%"===t.unit||"%%"===t.unit){let i;i=e instanceof Span?e.parentWord.parentParagraph:e instanceof Paragraph?e:e.firstParagraph,o="%%"===(null==t?void 0:t.unit)?i.parentEddi.frames[i.lastStartFrameIndex>0?i.lastStartFrameIndex:0].height:i.parentEddi.frames[i.lastStartFrameIndex>0?i.lastStartFrameIndex:0].width}return o}spaceWidth(e){const t=this.getFontSize(e),o=this.getFont(e),i=this.getTrackingInPx(e);return t/100*o.spaceWidth+i}getFontSize(e){const t=this.getTextStyleProperty(e,"fontSize");if(void 0===t)throw"FontSize is undefined, this should never happen";return t.toPixel_1Axis(TextStyle.getFrameWidth(e,t))}getFontSizeAslength(e){const t=this.getTextStyleProperty(e,"fontSize");if(void 0===t)throw"FontSize is undefined, this should never happen";return t}static getBaseFontSize(e){const t=TextStyle.getBaseStyleProperty(e,"fontSize");if(void 0===t)throw"Base FontSize is undefined, this should never happen";return t.toPixel_1Axis(TextStyle.getFrameWidth(e,t))}getY(e){const t=this.getTextStyleProperty(e,"baselineShift");if(void 0===t)throw"Baseline Shift is undefined, this should never happen";return t.toPixel_1Axis(TextStyle.getFrameWidth(e,t))}getCssColor(e){const t=this.getTextStyleProperty(e,"fontColor");if(void 0===t)throw"Color is undefined, this should never happen";return t instanceof ColorRef?t.toCssColor():t}getColorRef(e){const t=this.getTextStyleProperty(e,"fontColor");return t instanceof ColorRef?t:null}static getBaseCssColor(e){const t=TextStyle.getBaseStyleProperty(e,"fontColor");if(void 0===t)throw"Color is undefined, this should never happen";return t instanceof ColorRef?t.toCssColor():t}getTrackingInPx(e){const t=this.getTextStyleProperty(e,"tracking");if(t){return this.getFontSize(e)/2e3*t}return 0}getFont(e){if(this.getEddi(e).config.codeMode)return this.getEddi(e).config.codeModeFont.font;const t=this.getTextStyleProperty(e,"font");if(t)return t.font;throw"TextStyle getFont - Font not found!"}getEddi(e){return e instanceof Eddi?e:e instanceof Paragraph?e.parentEddi:e.parentWord.parentParagraph.parentEddi}getLineHeight(e){if(this.getEddi(e).config.codeMode)return this.getEddi(e).config.codeModeLineHeight;let t=1.2;const o=this.getTextStyleProperty(e,"lineHeight");if("%"===o.unit||"%%"===o.unit){const i=this.getFontSize(e);t=o.value/100*i,t<=0&&(t=.1)}else t=o.toPixel_1Axis(111);return t}getFontLineHeight(e){if(this.getEddi(e).config.codeMode)return this.getEddi(e).config.codeModeLineHeight;const t=this.getFontSize(e);return this.getFont(e).lineHeight/100*t}getLeading(e){if(this.getEddi(e).config.codeMode)return this.getEddi(e).config.codeModeAscender;const t=this.getFontSize(e),o=this.getFont(e);return(o.lineHeight-o.ascender-o.descender)/100*t}getAscender(e){if(this.getEddi(e).config.codeMode)return this.getEddi(e).config.codeModeAscender;const t=this.getFontSize(e);return this.getFont(e).ascender/100*t}getDescender(e){if(this.getEddi(e).config.codeMode)return this.getEddi(e).config.codeModeDescender;const t=this.getFontSize(e);return this.getFont(e).descender/100*t}css(e,t){let o="white-space:pre;";const i=this.getImmediateTextStyleProperty(t,"font");i&&(o+="font-family: "+i.font.cssName+";");const r=this.getImmediateTextStyleProperty(t,"fontSize");r&&(o+="font-size:"+r.toPixel_1Axis(e)+"px;");const s=this.getImmediateTextStyleProperty(t,"fontColor");return s&&(o+="fill:"+(s instanceof ColorRef?s.toCssColor():s)+";"),o}static baseCss(e,t){let o="white-space:pre;";const i=TextStyle.getBaseStyleProperty(t,"font");i&&(o+="font-family:"+i.font.cssName+";");const r=TextStyle.getBaseStyleProperty(t,"fontSize");r&&(o+="font-size:"+r.toPixel_1Axis(e)+"px;");const s=TextStyle.getBaseStyleProperty(t,"fontColor");return s&&(o+="fill:"+(s instanceof ColorRef?s.toCssColor():s)+";"),o}fullCss(e){return`font-family:${this.getTextStyleProperty(e,"font").font.cssName}; font-size:${this.getFontSize(e)}px; fill:${this.getCssColor(e)}; white-space:pre;`}static baseFullCss(e){return`font-family:${TextStyle.getBaseStyleProperty(e,"font").font.cssName}; font-size:${TextStyle.getBaseFontSize(e)}px; fill:${TextStyle.getBaseCssColor(e)}; white-space:pre;`}fullStyle(e){return{font:this.getTextStyleProperty(e,"font"),fontSize:this.getTextStyleProperty(e,"fontSize"),fontColor:this.getTextStyleProperty(e,"fontColor"),tracking:this.getTextStyleProperty(e,"tracking"),baselineShift:this.getTextStyleProperty(e,"baselineShift"),lineHeight:new Length(this.getLineHeight(e),"px"),class:this.getTextStyleProperty(e,"class")}}isEqual(e){if(this===e)return!0;for(const t of Object.keys(baseStyleProps())){if(this.properties[t]!==e.properties[t])return!1;if(this.temporaryProperties[t]!==e.temporaryProperties[t])return!1}for(const t of Object.keys(this.temporaryProperties))if(this.temporaryProperties[t]!==e.temporaryProperties[t])return!1;for(const t of Object.keys(e.temporaryProperties))if(this.temporaryProperties[t]!==e.temporaryProperties[t])return!1;return!0}}function baseStyleProps$1(){return baseStylePropsCache$1||(baseStylePropsCache$1={horizontalTextAlign:"left",spaceAfterParagraph:new Length(10,"pt"),spaceBeforeParagraph:new Length(0,"pt"),leftIndent:new Length(0,"pt"),rightIndent:new Length(0,"pt"),firstLineIndent:new Length(0,"pt"),bulletMode:"none",bulletSize:0,bulletShift:0,bulletShape:"Circle",bulletColor:ColorRef.Black_Color(),tabs:"",tabSize:new Length(150,"%"),tabLineColor:ColorRef.Black_Color(),tabLineType:"dotted",tabLineHeight:new Length(1,"pt")}),baseStylePropsCache$1}function baseParagraphStyleProps(){return baseStyleProps$1()}class ParagraphStyle{constructor(e){this.properties=e||{}}serialize(){const e={},t=this.properties;return t.horizontalTextAlign&&(e.ha=t.horizontalTextAlign),t.spaceAfterParagraph&&(e.sap=t.spaceAfterParagraph.serialize()),t.spaceBeforeParagraph&&(e.sbp=t.spaceBeforeParagraph.serialize()),t.leftIndent&&(e.lin=t.leftIndent.serialize()),t.rightIndent&&(e.rin=t.rightIndent.serialize()),t.firstLineIndent&&(e.fli=t.firstLineIndent.serialize()),t.bulletMode&&(e.bum=t.bulletMode),t.bulletColor&&(e.bcol=t.bulletColor.serialize()),t.bulletShape&&(e.bshp=t.bulletShape),t.bulletShift&&(e.bshi=t.bulletShift),t.bulletSize&&(e.bsiz=t.bulletSize),t.tabs&&(e.tabs=t.tabs),t.tabSize&&(e.tsiz=t.tabSize.serialize()),t.tabLineColor&&(e.tlco=t.tabLineColor.serialize()),t.tabLineType&&(e.tlty=t.tabLineType),t.tabLineHeight&&(e.tlwi=t.tabLineHeight.serialize()),e}static deserialize(e){const t={};return e&&(e.ha&&(t.horizontalTextAlign=e.ha),e.sap&&(t.spaceAfterParagraph=Length.deserialize(e.sap)),e.sbp&&(t.spaceBeforeParagraph=Length.deserialize(e.sbp)),e.lin&&(t.leftIndent=Length.deserialize(e.lin)),e.rin&&(t.rightIndent=Length.deserialize(e.rin)),e.fli&&(t.firstLineIndent=Length.deserialize(e.fli)),e.bum&&(t.bulletMode=e.bum),e.bshi&&(t.bulletShift=e.bshi),e.bsiz&&(t.bulletSize=e.bsiz),e.bcol&&(t.bulletColor=new ColorRef(generateDBID(),e.bcol)),e.bshp&&(t.bulletShape=e.bshp),e.tabs&&(t.tabs=e.tabs),e.tsiz&&(t.tabSize=Length.deserialize(e.tsiz)),e.tlco&&(t.tabLineColor=new ColorRef(generateDBID(),e.tlco)),e.tlwi&&(t.tabLineHeight=Length.deserialize(e.tlwi)),e.tlty&&(t.tabLineType=e.tlty)),new ParagraphStyle(t)}static getBaseStyleProperty(e,t){if(e.class){const o=TextStyle._getStyleSheetPropertyFromClass(e,t,e.parentBoxIdForEvaluation);if(o)return o}return baseStyleProps$1()[t]}getParagraphStyleProperty(e,t){let o=this.properties[t];if(TextStyle.getClassByContext(e)){const i=ParagraphStyle.getStylePropertyFromClass(e,t,e.parentEddi.parentBoxIdForEvaluation);i&&(o=i)}return void 0!==o?o:e.parentEddi.config.paragraphStyleProperties[t]?e.parentEddi.config.paragraphStyleProperties[t]:ParagraphStyle.getBaseStyleProperty(e.parentEddi,t)}getParagraphStylePropertyExtended(e,t){let o=this.properties[t],i="";const r=TextStyle.getClassByContext(e);if(r){const s=ParagraphStyle.getStylePropertyFromClass(e,t,e.parentEddi.parentBoxIdForEvaluation);s&&(o=s,i=r)}return void 0!==o?{value:o,origin:"Paragraph",selector:i}:e.parentEddi.config.codeMode&&e.parentEddi.config.paragraphStyleProperties[t]?{value:e.parentEddi.config.paragraphStyleProperties[t],origin:"Config",selector:i}:{value:ParagraphStyle.getBaseStyleProperty(e.parentEddi,t),selector:i,origin:"Base"}}static getStylePropertyFromClass(e,t,o){const i=TextStyle._getStyleSheetPropertyFromClass(e,t,o);return null!=i?i:null}static getParagraphStylePropertyFromParagraphs(e,t){let o;for(const i of e){const e=i.paragraphStyle.getParagraphStylePropertyExtended(i,t);let r=!1;if(void 0===o?o=e:r=o.value instanceof FontRef&&e.value instanceof FontRef||o.value instanceof ColorRef&&e.value instanceof ColorRef?!o.value.equals(e.value):o.value instanceof Length&&e.value instanceof Length?o.value.toString()!==e.value.toString():o.value!==e.value,r)return{value:null,selector:o.selector,origin:o.origin}}if(o)return o;throw"getTextStylePropertyFromParagraphs has no Ps in Ps list"}hasBullet(e){return"bullet"===this.getParagraphStyleProperty(e,"horizontalTextAlign")}getFrameWidth(e){return e.parentEddi.frames[e.lastStartFrameIndex>0?e.lastStartFrameIndex:0].width}getBulletShift(e){return(e.paragraphStyle.getParagraphStyleProperty(e,"bulletShift")+80)/100-1}getBulletAutoLeftIndent(e){return 2*this.getBulletSize(e)}getBulletSize(e){const t=e.paragraphStyle.getParagraphStyleProperty(e,"bulletSize");return e.textStyle.getFontSize(e.firstSpan||e)/1.5*((t+60)/100)}static getTabStops(e){const t=[];if(e){const o=e.split(" ");for(const e of o){const o=e.trim(),i={align:"left",hasLine:!1,pos:new Length(0,"%"),alignChar:"."};if(o.length>1){const e=o.substr(0,1);switch(e){case"C":i.align="center";break;case"R":i.align="right";break;case"L":i.align="left";break;default:i.align="char",i.alignChar=e}let r=o.substring(1);"_"===o.substr(1,1)&&(r=o.substring(2),i.hasLine=!0),i.pos=new Length(r),t.push(i)}}}return t.length?t:null}getLeftIndent(e){const t=this.getParagraphStyleProperty(e,"leftIndent");if(void 0===t)throw"Indent is undefined, this should never happen";const o=t.toPixel_1Axis(this.getFrameWidth(e));return 0===o&&this.hasBullet(e)?this.getBulletAutoLeftIndent(e):o}getRightIndent(e){const t=this.getParagraphStyleProperty(e,"rightIndent");if(void 0===t)throw"Indent is undefined, this should never happen";return t.toPixel_1Axis(this.getFrameWidth(e))}getFirstLineIndent(e){const t=this.getParagraphStyleProperty(e,"firstLineIndent");if(void 0===t)throw"Indent is undefined, this should never happen";const o=t.toPixel_1Axis(this.getFrameWidth(e));return 0===o&&this.hasBullet(e)?this.getBulletAutoLeftIndent(e):o}getSpaceBeforeParagraph(e){const t=this.getParagraphStyleProperty(e,"spaceBeforeParagraph");if(void 0===t)throw"spaceBeforeParagraph is undefined, this should never happen";return t.toPixel_1Axis(this.getFrameWidth(e))}css(){return""}}class Flowi{constructor(e){this.previous=null,this.next=null,this.parent=null,this.id=e,this.parent=null}get previousWord(){if(this.previous)return this.previous;if(this.parent){if(this.parent.previous)return this.parent.previous.lastWord;if(this.parent.parent&&this.parent.parent.previous&&this.parent.parent.previous.lastLine)return this.parent.parent.previous.lastLine.lastWord}return null}get nextWord(){if(this.next)return this.next;if(this.parent){if(this.parent.next)return this.parent.next.firstWord;if(this.parent.parent&&this.parent.parent.next&&this.parent.parent.next.firstLine)return this.parent.parent.next.firstLine.firstWord}return null}toDebugString(e=!1){let t="";if(this instanceof Word){const e="";t=this.id+e+" ["+this.toString()+"] "}return e&&(this.previous&&(t=t+" <<<"+this.previous.toDebugString()),this.next&&(t=t+" >>>"+this.next.toDebugString())),t}toAnnotationDebugString(){if(this instanceof Word){const e=[];for(const t of this.spans)e.length&&e.push("\n"),e.push("["+t.chars+"]  RULE:"+t.textStyle.temporaryProperties.annotationRule+"  NEXT:"+t.textStyle.temporaryProperties.annotationNextRule);return e}return[]}}function setPreviousNextPointers(e){if(e.length>1){for(let t=1;t<e.length-1;t++)e[t].previous=e[t-1],e[t].next=e[t+1];e[e.length-1].previous=e[e.length-2],e[e.length-1].next=null,e[0].next=e[1],e[0].previous=null}else e.length>0&&(e[0].previous=null,e[0].next=null)}function getElementOffset(e,t){if("offsetLeft"===t||"offsetTop"===t){let o=e[t],i=e.offsetParent;for(;null!=i;)o+=i[t],i=i.offsetParent;return o}return"offsetHeight"===t||"offsetWidth"===t?e[t]:0}let id=0;function newId(e){return e+id++}function documentReady(e){"complete"===document.readyState||"loading"!==document.readyState&&!document.documentElement.doScroll?e():document.addEventListener("DOMContentLoaded",e)}const isSafari=function(){const e=window.navigator.userAgent,t=!!e.match(/iP(ad|od|hone)/i),o=!!e.match(/Safari/i),i=!e.match(/Chrome|CriOS|OPiOS|mercury|FxiOS|Firefox/i);let r=!1;if(t){r=!!e.match(/WebKit/i)&&o&&i}else r=void 0!==window.safari||o&&i;return r}();function evaluatedIText(e,t){const o=new Map,i=new Map,r={a:[]};let s=null;for(const i of e.a){const e={w:[],p:i.p,s:i.s};for(const r of i.w)if("object"==typeof r&&!0===r.e&&"W"===r.k&&r.s){const i=r.s[0].s,n=evaluateText(t,r.s[0].t);if(n.text){const t=evaluatStringToSerializedFormat(n.text.replace(/\\t/g,"\t").replace(/\\n/g,"\n").replace(/\\f/g,"\f"),i);if(t.ws?e.w=[...e.w,...t.ws]:t.ps&&(s=t.ps),n.fields)for(const[e,t]of n.fields)o.set(e,t)}else e.w.push({k:"W",e:!0,s:[{t:n.errors.join(", "),s:{fc:"red"}}]})}else e.w.push(r);s?(r.a.push(...s),s=null):r.a.push(e)}return{text:r,formFields:o,dataFields:i,classNames:Story.getAllClassNames(r)}}function evaluatStringToSerializedFormat(e,t){if(e.indexOf("<p:")>=0){const o=/<p:[^>]*>/gm,i=e.split(o),r=[];let s,n=0;for(;null!==(s=o.exec(e));){s.index===o.lastIndex&&o.lastIndex++;const e=s[0].replace("<p:","").replace(">",""),a=i[n+1]||"";r.push({w:readIWords(a,t),s:{c:e}}),n++}return{ps:r}}return{ws:readIWords(e,t)}}function getIWordStyle(e,t){return e&&t?Object.assign(Object.assign({},e),{c:t}):e||(t?{c:t}:void 0)}function readIWords(e,t){const o=[],i=e.split(/\n/);let r="";for(let e=0;e<i.length;e++){const s=i[e];if(s){const n=s.split("\t");for(const e of n){const i=e.split(" ");for(const s of i){const i=s.indexOf("<w:"),a=s.indexOf(">");if(a>i&&i>=0){r=s.substr(i+3,a-i-3);const e=i>0?s.substr(0,i):"";let n=s.substr(a+1),l="";const c=n.split("<w:>");c.length>1&&(n=c[0],l=c[1]),e&&o.push({k:"W",s:[{t:e,s:t}]}),n&&o.push({k:"W",s:[{t:n,s:getIWordStyle(t,r)}]}),l&&o.push({k:"W",s:[{t:l,s:t}]}),c.length>1&&(r="")}else(r||t)&&o.push({k:"W",s:[{t:s,s:getIWordStyle(t,r)}]});e!==n[n.length-1]&&o.push({k:"T"})}}e!==i.length-1&&o.push({k:"B"})}}return o}function createHyphenator(){var e="debug",t="hyphenChar",o="object"==typeof global?global:"object"==typeof window?window:"object"==typeof this?this:{};function i(e){var t={};for(var o in e)t[o]=e[o];return t}function r(e,t,o){return t in e?e[t]:o}function s(e,t){return e.exceptions.reduce((function(e,o){return e[o.replace(/\-/g,"")]=o.replace(/\-/g,t),e}),{})}function n(e,t,o,i){for(var r,s=new Array(e.length+1),n=e.toLocaleLowerCase(),a=[],l=0,c=s.length;c--;)s[c]=0;for(;r=t[l++];)for(var d=0,h=!1;!h;){var p=n.indexOf(r.text,d);if(p>-1&&(!r.stickToLeft||0===p)&&(!r.stickToRight||p+r.text.length===e.length)){a.push(r.pattern+">"+r.levels.join(""));for(c=0;c<r.levels.length;c++)s[p+c]=Math.max(r.levels[c],s[p+c])}p>-1&&r.text.length>0?d=p+r.text.length+1:h=!0}s[0]=s[1]=s[s.length-1]=s[s.length-2]=0;var u="",m="",f="";for(c=0;c<s.length;c++)u+=(s[c]%2==1?i:"")+e.charAt(c),f+=(s[c]%2==1?"-":"")+e.charAt(c),m+=(s[c]>0?s[c]:"")+e.charAt(c);return o&&console.log.apply(console,[e,"->"].concat(a).concat(["->"]).concat(s).concat(["->",m]).concat(["->",f])),u}function a(e){for(var t,o=0,i={pattern:e,text:"",levels:[],stickToLeft:0,stickToRight:0},r=1,s=2,n=3,a=4;t=e.charAt(o++);){var l="."===t,c=!l&&/\d/.test(t);switch(l?o-1==0?n:a:c?s:r){case r:!d&&i.levels.push(0),i.text+=t;break;case s:i.levels.push(parseInt(t));break;case n:i.stickToLeft=!0;break;case a:i.stickToRight=!0}var d=c}return i}return function(l,c){var d=r(c=c||{},"async",false),h={},p=r(c,e,false),u={},m=r(c,t,""),f=l.patterns.map(a),g=Math.max(c.minWordLength>>0,5),y=r(c,"html",false),b=m+g;if(u[b]=s(l,m),h[b]=i(u[b]),d&&!("Promise"in o))throw new Error("Failed to create hyphenator: Could not find global Promise object, needed for hyphenator to work in async mode");return function(o,a){var c=r(a=a||{},e,p),b=r(a,t,m),v=Math.max(a.minWordLength>>0,g),x=b+v;return u[x]||(u[x]=s(l,b)),h[x]||(h[x]=i(u[x])),function(e,t,o,i,r,s,a,l){function c(){b=new Date-b,x(h),i&&(console.log("----------------\nHyphenation stats: "+g+" text chunks processed, "+y+" words hyphenated"),console.log("Work time: "+v/1e3),console.log("Wait time: "+(b-v)/1e3),console.log("All time: "+b/1e3))}var d,h="",p=function(e,t,o,i){function r(){var r="";n=void 0;e:for(;c<=e.length;){var s=e.charAt(c++),g=!!s&&!/\s|[\!-\@\[-\`\{-\~\u2013-\u203C]/.test(s),y="<"===s,b=">"===s,v=s===t;do{if(a===p){b&&(a=m);break}if(v){n=h,a=u;break}if(g){a=u;break}if(a===u){a=f,n=n||r.length>=i&&d;break}n=h,a=m}while(0);switch(y&&a!==f&&o&&!l(e.charAt(c))&&(n=h,a=p),a){case p:case u:r+=s;break;case m:r+=s;break e;case f:c--;break e}}return r||void 0}function s(){return n===d}var n,a,l=RegExp.prototype.test.bind(/\s/),c=0,d=1,h=2,p=1,u=2,m=3,f=4;return[r,s]}(e,r,s,a),u=p[0],m=p[1],f={hyphenateWord:1,concatenate:2},g=0,y=0,b=new Date,v=0,x=function(){};function w(){for(var e=new Date;(!l||new Date-e<10)&&(d=u());){switch(m()?f.hyphenateWord:f.concatenate){case f.hyphenateWord:o[d]||(o[d]=n(d,t,i,r)),d!==o[d]&&y++,d=o[d];case f.concatenate:h+=d}g++}v+=new Date-e,d?setTimeout(w):c()}return l?(setTimeout(w),new Promise((function(e){x=e}))):(w(),h)}(o,f,h[x],c,b,y,v,d)}}}var __awaiter$6=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};const loadedPatterns=new Map,hyphenators=new Map;function loadHyphenationPattern(e){return __awaiter$6(this,void 0,void 0,(function*(){if("off"===e)throw"Can't load hyphenation pattern named 'off'";const t=getHyphenationPattern(e);if(t)return t;try{const t=yield fetch("./printess-editor/hyphenation-patterns/"+e+".json"),o=yield t.json();loadedPatterns.set(e,o);const i=createHyphenator()(o,{});return hyphenators.set(e,i),o}catch(t){throw alert("Can't load hyphenation for "+e),"Can't load hyphenation for "+e}}))}function getHyphenationPattern(e){return loadedPatterns.get(e)||null}function getHyphenator(e){return hyphenators.get(e)}const hyphenationCache=new Map;class Word extends Flowi{constructor(e,t,o,i,r){super(t),this.x=0,this.justifyCharSpacing=0,this.justifyWordSpacing=0,this.offsetToNextTabStop=0,this.forcedBreaks=[],this.parentParagraph=e,this.x=0,this.subWordPos=i||null,this.spans=this.readSpans(o,r),this.spanClasses=new Set;for(const e of this.spans)e.textStyle.properties.class&&this.spanClasses.add(e.textStyle.properties.class);const s=this.parentParagraph.parentEddi.config;if(s.codeMode)this.maxFontSize=s.codeModeFontSize,this.lineHeight=s.codeModeLineHeight,this.fontLineHeight=s.codeModeLineHeight,this.ascender=s.codeModeAscender,this.descender=s.codeModeDescender;else{this.maxFontSize=this.spans.map((e=>e.textStyle.getFontSize(e))).reduce(((e,t)=>Math.max(e,t)),0),this.lineHeight=this.spans.map((e=>e.textStyle.getLineHeight(e))).reduce(((e,t)=>Math.max(e,t)),0),this.ascender=this.spans.map((e=>e.textStyle.getAscender(e))).reduce(((e,t)=>Math.max(e,t)),0),this.descender=this.spans.map((e=>e.textStyle.getDescender(e))).reduce(((e,t)=>Math.max(e,t)),0);let e=0;for(const t of this.spans){const o=t.textStyle.getFontLineHeight(t)-t.textStyle.getAscender(t);e<o&&(e=o)}this.fontLineHeight=e+this.ascender}this.width=0,this.length=0,this.zigZagColor=null;for(const e of this.spans)this.width+=e.width,this.length+=e.length,e.textStyle.temporaryProperties.annotationZigzag&&(this.zigZagColor=e.textStyle.temporaryProperties.annotationZigzag);if(!0===o.e&&(this.zigZagColor="green"),this.hasSpace=!(this.subWordPos&&!this.subWordPos.isLastPartOfBreak),this.spaceWidth=this.hasSpace?this.lastSpan.textStyle.spaceWidth(this.lastSpan):0,this.totalWidth=this.width+this.spaceWidth,this.hyphenWidth=0,this.subWordPos&&this.subWordPos.needsHyphen){const e=new TextStyle(Object.assign(Object.assign({},this.lastSpan.textStyle.properties),{tracking:0})),t=new Span(this,"-",e,0);this.hyphenWidth=.7*t.width}e.idLookUp[this.id]=this}get paragraphClasses(){var e;const t=null===(e=this.parentParagraph)||void 0===e?void 0:e.textStyle.properties.class;return t?(new Set).add(t):new Set}get isEmpty(){return 1===this.spans.length&&""===this.spans[0].chars}get hyphenationPoints(){if(this.subWordPos)return[];const e=this.parentParagraph.parentEddi.hyphenationLanguage,t=this.toString();let o;if("off"===e)o=[];else if(o=hyphenationCache.get(e+"|"+t),!o){const i=Word.readHyphenationPoints(t,e);i?(o=i,hyphenationCache.set(e+"|"+t,o)):o=[]}if(this.forcedBreaks.length>0){const e=[];for(const t of this.forcedBreaks)e.push({needsHyphen:!1,pos:t});o=[...o,...e].sort(((e,t)=>e.pos-t.pos))}return o}get hyphenationPointsIncludeForceBreaks(){let e=this.hyphenationPoints;if(this.forcedBreaks.length>0){const t=[];for(const e of this.forcedBreaks)t.push({needsHyphen:!1,pos:e});e=[...e,...t].sort(((e,t)=>e.pos-t.pos))}return e}addForcedBreakAndGetSplitPos(e){let t,o,i=1,r=this.charWidth[0];for(let t=1;t<this.length;t++)r+=this.charWidth[t],r<=e&&(i=t);if(this.subWordPos){if(t=this.parentParagraph.idLookUp[this.id.split("-")[0]],!t)throw"Add forced break can't retrieve original word!";o=this.subWordPos.startOffSet+i}else t=this,o=i;return t.forcedBreaks=[...t.forcedBreaks,o].sort(),i}static readHyphenationPoints(e,t){const o=[];let i;if(e.indexOf("-")>=0){const t=/\w([-])\w/gm;for(;null!==(i=t.exec(e));)i.index===t.lastIndex&&t.lastIndex++,o.push({pos:i.index+2,needsHyphen:!1})}else if(e.length>4){const i=getHyphenator(t);if(!i)return null;const r=e.substr(e.length-1);".;,:'\"".indexOf(r)>=0&&(e=e.substr(0,e.length-1));const s=i(e).split("");let n=0;for(const e of s)n+=e.length,o.push({pos:n,needsHyphen:!0})}return o}readSpans(e,t=new TextStyle){let o=[];if("string"==typeof e)o=[new Span(this,e,t,0)];else if(Array.isArray(e)){let t=0;this.parentParagraph.parentEddi.config.codeMode||e.length>1&&(e=Word.consolidateSpans(this,e));for(const i of e){const e=new Span(this,i.chars,i.textStyle,t);o.push(e),t=e.extraWidth}}else{let t=0;const i=e;if("W"===i.k&&i.s)for(const e of i.s){const i=Span.Deserialize(e,this,t);o.push(i),t=i.extraWidth}}return 0===o.length&&(o=[new Span(this,"",t,0)]),o}get pureId(){return this.id.split("-")[0]}break(){const e=[];let t,o=0;if(this.hyphenationPoints.length>0){for(let i=0;i<this.hyphenationPoints.length;i++){t=this.hyphenationPoints[i];const r=this.getSpans(o,t.pos);e.push(new Word(this.parentParagraph,this.id+"-"+i,r,{startOffSet:o,isFirstPartOfBreak:0===o,isLastPartOfBreak:!1,needsHyphen:t.needsHyphen,isForced:!1})),o=t.pos}const i=this.hyphenationPoints.length;t=this.hyphenationPoints[i-1];const r=this.getSpans(t.pos,this.length),s=e.length>0?e[e.length-1].lastSpan.textStyle:void 0;return e.push(new Word(this.parentParagraph,this.id+"-"+i,r,{startOffSet:o,isFirstPartOfBreak:!1,isLastPartOfBreak:!0,needsHyphen:!1,isForced:!1},s)),e}return[this]}static consolidateSpans(e,t){let o=null,i="";const r=[];for(let s=1;s<t.length;s++)t[s-1].textStyle.isEqual(t[s].textStyle)?o?i+=t[s].chars:(o=new Span(e,"",t[s-1].textStyle,0),i=t[s-1].chars+t[s].chars):o?(i&&(r.push(new Span(e,i,o.textStyle,0)),i=""),o=null):t[s-1].length&&r.push(t[s-1]);return o?i&&r.push(new Span(e,i,o.textStyle,0)):t[t.length-1].length&&r.push(t[t.length-1]),r}get charWidth(){let e=[];for(const t of this.spans)e=[...e,...t.charWidth.map((e=>e+this.justifyCharSpacing))];return this.hasSpace&&e.push(this.spaceWidth),e}get lastTextStyle(){return this.lastSpan.textStyle}get lastSpan(){return this.spans[this.spans.length-1]}get lastChar(){const e=this.lastSpan.chars;return e.substr(e.length-1)}toString(){return this.spans.map((e=>e.chars)).reduce(((e,t)=>e+t),"")}renderWordRect(){const e=document.createElementNS("http://www.w3.org/2000/svg","rect"),t=document.createElementNS("http://www.w3.org/2000/svg","g");if(this.subWordPos?e.setAttributeNS(null,"stroke","blue"):e.setAttributeNS(null,"stroke","orange"),e.setAttributeNS(null,"height","20"),e.setAttributeNS(null,"width",this.width.toString()),e.setAttributeNS(null,"fill","none"),e.setAttributeNS(null,"stroke-width","0.3px"),e.setAttributeNS(null,"x",this.x.toString()),e.setAttributeNS(null,"y","-20"),t.appendChild(e),this.spans.length>1){let e=this.x;for(const o of this.spans){const i=document.createElementNS("http://www.w3.org/2000/svg","rect");i.setAttributeNS(null,"stroke","green"),i.setAttributeNS(null,"height","24"),i.setAttributeNS(null,"width",o.width.toString()),i.setAttributeNS(null,"fill","none"),i.setAttributeNS(null,"stroke-width","0.3px"),i.setAttributeNS(null,"x",e.toString()),i.setAttributeNS(null,"y","-22"),t.appendChild(i),e+=o.width}}return t}render(e){let t;const o=document.createElementNS("http://www.w3.org/2000/svg","text"),i=this.spans.length-1;for(let r=0;r<=i;r++){t=!!(e&&this.subWordPos&&r===i&&this.subWordPos.needsHyphen);const s=r>0?this.justifyCharSpacing:0,n=this.spans[r].render(t,s);o.appendChild(n)}return o.setAttributeNS(null,"text-rendering","geometricPrecision"),o.setAttributeNS(null,"id",this.id),this.x&&o.setAttributeNS(null,"x",this.x.toString()),o}renderZigZagLine(e){const t=document.createElementNS("http://www.w3.org/2000/svg","polyline"),o=this.lineHeight/10,i=[];let r=o;for(let e=0;e<this.width;e+=o)i.push(e+this.x+","+(r+o/2)),r=r===o?0:o;return t.setAttributeNS(null,"points",i.join(" ")),t.setAttributeNS(null,"fill","none"),t.setAttributeNS(null,"stroke",e),t}getClassBadge(e){let t="";for(const e of this.spans)e.textStyle&&e.textStyle.properties.class&&(t=e.textStyle.properties.class.split(" ")[0]);if(!t)return null;let o="red";for(const e of scope().styles_all){const i=e.classNameColorLookUp.get(t);i&&(o=i)}t=t.substr(0,10);const i=document.createElementNS("http://www.w3.org/2000/svg","g"),r=document.createElementNS("http://www.w3.org/2000/svg","rect");r.setAttributeNS(null,"x","0"),r.setAttributeNS(null,"y","0"),r.setAttributeNS(null,"width","35"),r.setAttributeNS(null,"height","12"),r.setAttributeNS(null,"fill",o),i.appendChild(r);const s=7*t.length+4,n=document.createElementNS("http://www.w3.org/2000/svg","text");return n.setAttributeNS(null,"style","fill: white; font-size: 10px; font-family: monospace"),n.setAttributeNS(null,"x","1"),n.setAttributeNS(null,"y","10"),r.setAttributeNS(null,"width",s.toString()),r.setAttributeNS(null,"height","12"),n.innerHTML=t,i.appendChild(n),i.setAttributeNS(null,"transform","translate("+this.x+" "+(2-e)+")"),i}static getDashArray(e,t){const o=Math.ceil(t);if("solid"===e)return"";if("dotted"===e)return"0 "+2*t;{const t=e.replace("dashed ","");return"n"===t?"1 "+o:(parseInt(t)-1)*o+" "+o*(parseInt(t)+1)}}renderTabLine(e,t,o){const i=document.createElementNS("http://www.w3.org/2000/svg","line");let r=this.x-this.offsetToNextTabStop-this.spaceWidth/2,s=this.x-this.spaceWidth/2;""===this.toString()&&(s+=this.spaceWidth),r<0&&(r=0);const n=-t/2;return i.setAttributeNS(null,"x1",r.toString()),i.setAttributeNS(null,"x2",s.toString()),i.setAttributeNS(null,"y1",n.toString()),i.setAttributeNS(null,"y2",n.toString()),i.setAttributeNS(null,"fill","none"),i.setAttributeNS(null,"stroke",e),i.setAttributeNS(null,"stroke-width",t.toString()),i.setAttributeNS(null,"stroke-linecap",o.startsWith("dotted")?"round":"square"),i.setAttributeNS(null,"stroke-dasharray",Word.getDashArray(o,t)),i}getSpanByPos(e){let t=0;for(const o of this.spans){if(e>=t&&e<=t+o.length)return o;t+=o.length}return this.lastSpan}insertChars(e,t){const o=this.getSpanByPos(e);let i=0;for(const e of this.spans){if(e===o)break;i+=e.length}const r=this.spans.map((r=>o===r?o.insertChars(e-i,t):r));return new Word(this.parentParagraph,this.id,r)}static getContent(e){let t="";for(const o of e)t+=o.chars;return t}getSpans(e,t,o=!1){let i=0;const r=[];for(const s of this.spans){if(e<=i&&i+s.length<=t)(o||s.length)&&r.push(s);else if(e>=i&&e<i+s.length){let o=s.chars.substr(e-i);t-e<s.length&&(o=o.substr(0,t-e)),o&&r.push(new Span(this,o,s.textStyle,s.dx))}else if(t>i&&t<i+s.length){const e=s.chars.substr(0,t-i);e&&r.push(new Span(this,e,s.textStyle,s.dx))}i+=s.length}return r}getSpan(e){let t=0;for(const o of this.spans){if(e>=t&&e<=t+o.length)return o;t+=o.length}return e<0?this.spans[0]:this.lastSpan}split(e,t,o=!1,i=newId("W")){const r=e,s=t||r,n=this.getSpans(0,r),a=this.getSpans(s,this.length),l={first:null,second:null,sel:null};0===r==(s===this.length)&&(l.first=this,l.sel={wordPos:0,wordId:this.id,paragraphId:this.parentParagraph.id,joinWithPreviousUndo:!1});const c=n.length&&Word.getContent(n)||o,d=a.length&&Word.getContent(a)||o;return c&&(l.first=new Word(this.parentParagraph,this.id,n)),d&&(l.first?l.second=new Word(this.parentParagraph,i,a):l.second=new Word(this.parentParagraph,this.id,a)),l.first?l.sel={wordPos:l.first.length,wordId:l.first.id,paragraphId:l.first.parentParagraph.id,joinWithPreviousUndo:!1}:l.second&&(l.sel={wordPos:0,wordId:l.second.id,paragraphId:l.second.parentParagraph.id,joinWithPreviousUndo:!1}),l}join(e){return new Word(this.parentParagraph,this.id,[...this.spans,...e.spans])}removeChars(e,t,o,i){const r=e,s=t,n=this.getSpans(0,r),a=this.getSpans(s,this.length),l={first:null,second:null,sel:null};let c;return c=n.length?n[0].textStyle:a.length?a[0].textStyle:this.spans[0].textStyle,o&&(i&&(c=new TextStyle(c.properties,{fontColor:"tomato"})),n.push(new Span(this,o,c,0))),0===n.length&&0===a.length?l.first=new Word(this.parentParagraph,this.id,[],void 0,c):l.first=new Word(this.parentParagraph,this.id,[...n,...a]),l.sel={wordId:this.id,wordPos:n.map((e=>e.length)).reduce(((e,t)=>e+t),0),paragraphId:this.parentParagraph.id,joinWithPreviousUndo:!1},l}setTextStyle(e,t,o,i,r=!0,s=!1){let n,a,l;if(e===t){if(0!==e||0!==this.length)return this;n=[],a=[...this.spans],l=[]}else n=this.getSpans(0,e),a=this.getSpans(e,t),l=this.getSpans(t,this.length);const c=[];for(const e of a){const t=r?e.textStyle.properties:{};if(s){for(const e of Object.keys(t))void 0===t[e]&&delete t[e];c.push(new Span(this,e.chars,new TextStyle(Object.assign(Object.assign({},o),t),Object.assign(Object.assign({},e.textStyle.temporaryProperties),i)),0))}else c.push(new Span(this,e.chars,new TextStyle(Object.assign(Object.assign({},t),o),Object.assign(Object.assign({},e.textStyle.temporaryProperties),i)),0))}return new Word(this.parentParagraph,this.id,[...n,...c,...l])}removeTextStyleProperties(e,t=!1){const o=[];let i;for(const r of this.spans){if(t)i={};else{i=Object.assign({},r.textStyle.properties);for(const t of Object.keys(e))Object.prototype.hasOwnProperty.call(i,t)&&delete i[t]}o.push(new Span(this,r.chars,new TextStyle(i),0))}return new Word(this.parentParagraph,this.id,o)}serialize(){if(1===this.spans.length){const e=this.spans[0];if(0===Object.keys(e.textStyle.properties).length)return e.chars}return{k:"W",s:this.spans.map((e=>e.serialize()))}}static Deserialize(e,t){return new Word(t,newId("W"),e)}}const $_documentContainer$k=html$1`<dom-module id="lumo-button" theme-for="vaadin-button">
  <template>
    <style>
      :host {
        /* Sizing */
        --lumo-button-size: var(--lumo-size-m);
        min-width: calc(var(--lumo-button-size) * 2);
        height: var(--lumo-button-size);
        padding: 0 calc(var(--lumo-button-size) / 3 + var(--lumo-border-radius) / 2);
        margin: var(--lumo-space-xs) 0;
        box-sizing: border-box;
        /* Style */
        font-family: var(--lumo-font-family);
        font-size: var(--lumo-font-size-m);
        font-weight: 500;
        color: var(--_lumo-button-color, var(--lumo-primary-text-color));
        background-color: var(--_lumo-button-background-color, var(--lumo-contrast-5pct));
        border-radius: var(--lumo-border-radius);
        cursor: default;
        -webkit-tap-highlight-color: transparent;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      /* Set only for the internal parts so we dont affect the host vertical alignment */
      [part="label"],
      [part="prefix"],
      [part="suffix"] {
        line-height: var(--lumo-line-height-xs);
      }

      [part="label"] {
        padding: calc(var(--lumo-button-size) / 6) 0;
      }

      :host([theme~="small"]) {
        font-size: var(--lumo-font-size-s);
        --lumo-button-size: var(--lumo-size-s);
      }

      :host([theme~="large"]) {
        font-size: var(--lumo-font-size-l);
        --lumo-button-size: var(--lumo-size-l);
      }

      /* This needs to be the last selector for it to take priority */
      :host([disabled][disabled]) {
        pointer-events: none;
        color: var(--lumo-disabled-text-color);
        background-color: var(--lumo-contrast-5pct);
      }

      /* For interaction states */
      :host::before,
      :host::after {
        content: "";
        /* We rely on the host always being relative */
        position: absolute;
        z-index: 1;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        background-color: currentColor;
        border-radius: inherit;
        opacity: 0;
        transition: opacity 0.2s;
        pointer-events: none;
      }

      /* Hover */

      :host(:hover)::before {
        opacity: 0.05;
      }

      /* Disable hover for touch devices */
      @media (pointer: coarse) {
        :host(:not([active]):hover)::before {
          opacity: 0;
        }
      }

      /* Active */

      :host::after {
        transition: opacity 1.4s, transform 0.1s;
        filter: blur(8px);
      }

      :host([active])::before {
        opacity: 0.1;
        transition-duration: 0s;
      }

      :host([active])::after {
        opacity: 0.1;
        transition-duration: 0s, 0s;
        transform: scale(0);
      }

      /* Keyboard focus */

      :host([focus-ring]) {
        box-shadow: 0 0 0 2px var(--lumo-primary-color-50pct);
      }

      /* Types (primary, tertiary, tertiary-inline */

      :host([theme~="tertiary"]),
      :host([theme~="tertiary-inline"]) {
        background-color: transparent !important;
        transition: opacity 0.2s;
        min-width: 0;
      }

      :host([theme~="tertiary"])::before,
      :host([theme~="tertiary-inline"])::before {
        display: none;
      }

      :host([theme~="tertiary"]) {
        padding: 0 calc(var(--lumo-button-size) / 6);
      }

      @media (hover: hover) {
        :host([theme*="tertiary"]:not([active]):hover) {
          opacity: 0.8;
        }
      }

      :host([theme~="tertiary"][active]),
      :host([theme~="tertiary-inline"][active]) {
        opacity: 0.5;
        transition-duration: 0s;
      }

      :host([theme~="tertiary-inline"]) {
        margin: 0;
        height: auto;
        padding: 0;
        line-height: inherit;
        font-size: inherit;
      }

      :host([theme~="tertiary-inline"]) [part="label"] {
        padding: 0;
        overflow: visible;
        line-height: inherit;
      }

      :host([theme~="primary"]) {
        background-color: var(--_lumo-button-primary-background-color, var(--lumo-primary-color));
        color: var(--_lumo-button-primary-color, var(--lumo-primary-contrast-color));
        font-weight: 600;
        min-width: calc(var(--lumo-button-size) * 2.5);
      }

      :host([theme~="primary"][disabled]) {
        background-color: var(--lumo-primary-color-50pct);
        color: var(--lumo-primary-contrast-color);
      }

      :host([theme~="primary"]:hover)::before {
        opacity: 0.1;
      }

      :host([theme~="primary"][active])::before {
        background-color: var(--lumo-shade-20pct);
      }

      @media (pointer: coarse) {
        :host([theme~="primary"][active])::before {
          background-color: var(--lumo-shade-60pct);
        }

        :host([theme~="primary"]:not([active]):hover)::before {
          opacity: 0;
        }
      }

      :host([theme~="primary"][active])::after {
        opacity: 0.2;
      }

      /* Colors (success, error, contrast) */

      :host([theme~="success"]) {
        color: var(--lumo-success-text-color);
      }

      :host([theme~="success"][theme~="primary"]) {
        background-color: var(--lumo-success-color);
        color: var(--lumo-success-contrast-color);
      }

      :host([theme~="success"][theme~="primary"][disabled]) {
        background-color: var(--lumo-success-color-50pct);
      }

      :host([theme~="error"]) {
        color: var(--lumo-error-text-color);
      }

      :host([theme~="error"][theme~="primary"]) {
        background-color: var(--lumo-error-color);
        color: var(--lumo-error-contrast-color);
      }

      :host([theme~="error"][theme~="primary"][disabled]) {
        background-color: var(--lumo-error-color-50pct);
      }

      :host([theme~="contrast"]) {
        color: var(--lumo-contrast);
      }

      :host([theme~="contrast"][theme~="primary"]) {
        background-color: var(--lumo-contrast);
        color: var(--lumo-base-color);
      }

      :host([theme~="contrast"][theme~="primary"][disabled]) {
        background-color: var(--lumo-contrast-50pct);
      }

      /* Icons */

      [part] ::slotted(iron-icon) {
        display: inline-block;
        width: var(--lumo-icon-size-m);
        height: var(--lumo-icon-size-m);
      }

      /* Vaadin icons are based on a 16x16 grid (unlike Lumo and Material icons with 24x24), so they look too big by default */
      [part] ::slotted(iron-icon[icon^="vaadin:"]) {
        padding: 0.25em;
        box-sizing: border-box !important;
      }

      [part="prefix"] {
        margin-left: -0.25em;
        margin-right: 0.25em;
      }

      [part="suffix"] {
        margin-left: 0.25em;
        margin-right: -0.25em;
      }

      /* Icon-only */

      :host([theme~="icon"]:not([theme~="tertiary-inline"])) {
        min-width: var(--lumo-button-size);
        padding-left: calc(var(--lumo-button-size) / 4);
        padding-right: calc(var(--lumo-button-size) / 4);
      }

      :host([theme~="icon"]) [part="prefix"],
      :host([theme~="icon"]) [part="suffix"] {
        margin-left: 0;
        margin-right: 0;
      }
    </style>
  </template>
</dom-module>`;document.head.appendChild($_documentContainer$k.content);
/**
@license
Copyright (c) 2017 Vaadin Ltd.
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
*/
class ButtonElement extends(ElementMixin$1(ControlStateMixin(ThemableMixin(GestureEventListeners(PolymerElement))))){static get template(){return html$1`
    <style>
      :host {
        display: inline-block;
        position: relative;
        outline: none;
        white-space: nowrap;
      }

      :host([hidden]) {
        display: none !important;
      }

      /* Ensure the button is always aligned on the baseline */
      .vaadin-button-container::before {
        content: "\\2003";
        display: inline-block;
        width: 0;
      }

      .vaadin-button-container {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        width: 100%;
        height: 100%;
        min-height: inherit;
        text-shadow: inherit;
        -webkit-user-select: none;
        -moz-user-select: none;
        user-select: none;
      }

      [part="prefix"],
      [part="suffix"] {
        flex: none;
      }

      [part="label"] {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      #button {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        opacity: 0;
        cursor: inherit;
      }
    </style>
    <div class="vaadin-button-container">
      <div part="prefix">
        <slot name="prefix"></slot>
      </div>
      <div part="label">
        <slot></slot>
      </div>
      <div part="suffix">
        <slot name="suffix"></slot>
      </div>
    </div>
    <button id="button" type="button"></button>
`}static get is(){return"vaadin-button"}static get version(){return"2.2.2"}ready(){super.ready(),this.setAttribute("role","button"),this.$.button.setAttribute("role","presentation"),this._addActiveListeners(),window.ShadyDOM&&window.ShadyDOM.flush()}disconnectedCallback(){super.disconnectedCallback(),this.hasAttribute("active")&&this.removeAttribute("active")}_addActiveListeners(){addListener(this,"down",(()=>!this.disabled&&this.setAttribute("active",""))),addListener(this,"up",(()=>this.removeAttribute("active"))),this.addEventListener("keydown",(e=>!this.disabled&&[13,32].indexOf(e.keyCode)>=0&&this.setAttribute("active",""))),this.addEventListener("keyup",(()=>this.removeAttribute("active"))),this.addEventListener("blur",(()=>this.removeAttribute("active")))}get focusElement(){return this.$.button}}customElements.define(ButtonElement.is,ButtonElement);const $_documentContainer$l=html$1`<dom-module id="lumo-checkbox" theme-for="vaadin-checkbox">
  <template>
    <style include="lumo-checkbox-style lumo-checkbox-effects">
      /* IE11 only */
      ::-ms-backdrop,
      [part="checkbox"] {
        line-height: 1;
      }
    </style>
  </template>
</dom-module><dom-module id="lumo-checkbox-style">
  <template>
    <style>
      :host {
        -webkit-tap-highlight-color: transparent;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        cursor: default;
        outline: none;
      }

      [part="label"]:not([empty]) {
        margin: 0.1875em 0.875em 0.1875em 0.375em;
      }

      [part="checkbox"] {
        width: calc(1em + 2px);
        height: calc(1em + 2px);
        margin: 0.1875em;
        position: relative;
        border-radius: var(--lumo-border-radius);
        background-color: var(--lumo-contrast-20pct);
        transition: transform 0.2s cubic-bezier(.12, .32, .54, 2), background-color 0.15s;
        pointer-events: none;
        line-height: 1.2;
      }

      :host([indeterminate]) [part="checkbox"],
      :host([checked]) [part="checkbox"] {
        background-color: var(--lumo-primary-color);
      }

      /* Needed to align the checkbox nicely on the baseline */
      [part="checkbox"]::before {
        content: "\\2003";
      }

      /* Checkmark */
      [part="checkbox"]::after {
        content: "";
        display: inline-block;
        width: 0;
        height: 0;
        border: 0 solid var(--lumo-primary-contrast-color);
        border-width: 0.1875em 0 0 0.1875em;
        box-sizing: border-box;
        transform-origin: 0 0;
        position: absolute;
        top: 0.8125em;
        left: 0.5em;
        transform: scale(0.55) rotate(-135deg);
        opacity: 0;
      }

      :host([checked]) [part="checkbox"]::after {
        opacity: 1;
        width: 0.625em;
        height: 1.0625em;
      }

      /* Indeterminate checkmark */

      :host([indeterminate]) [part="checkbox"]::after {
        transform: none;
        opacity: 1;
        top: 45%;
        height: 10%;
        left: 22%;
        right: 22%;
        width: auto;
        border: 0;
        background-color: var(--lumo-primary-contrast-color);
        transition: opacity 0.25s;
      }

      /* Focus ring */

      :host([focus-ring]) [part="checkbox"] {
        box-shadow: 0 0 0 3px var(--lumo-primary-color-50pct);
      }

      /* Disabled */

      :host([disabled]) {
        pointer-events: none;
        color: var(--lumo-disabled-text-color);
      }

      :host([disabled]) [part="label"] ::slotted(*) {
        color: inherit;
      }

      :host([disabled]) [part="checkbox"] {
        background-color: var(--lumo-contrast-10pct);
      }

      :host([disabled]) [part="checkbox"]::after {
        border-color: var(--lumo-contrast-30pct);
      }

      :host([indeterminate][disabled]) [part="checkbox"]::after {
        background-color: var(--lumo-contrast-30pct);
      }
    </style>
  </template>
</dom-module><dom-module id="lumo-checkbox-effects">
  <template>
    <style>
      /* Transition the checkmark if activated with the mouse (disabled for grid select-all this way) */
      :host(:hover) [part="checkbox"]::after {
        transition: width 0.1s, height 0.25s;
      }

      /* Used for activation "halo" */
      [part="checkbox"]::before {
        color: transparent;
        display: inline-block;
        width: 100%;
        height: 100%;
        border-radius: inherit;
        background-color: inherit;
        transform: scale(1.4);
        opacity: 0;
        transition: transform 0.1s, opacity 0.8s;
      }

      /* Hover */

      :host(:not([checked]):not([indeterminate]):not([disabled]):hover) [part="checkbox"] {
        background-color: var(--lumo-contrast-30pct);
      }

      /* Disable hover for touch devices */
      @media (pointer: coarse) {
        :host(:not([checked]):not([indeterminate]):not([disabled]):hover) [part="checkbox"] {
          background-color: var(--lumo-contrast-20pct);
        }
      }

      /* Active */

      :host([active]) [part="checkbox"] {
        transform: scale(0.9);
        transition-duration: 0.05s;
      }

      :host([active][checked]) [part="checkbox"] {
        transform: scale(1.1);
      }

      :host([active]:not([checked])) [part="checkbox"]::before {
        transition-duration: 0.01s, 0.01s;
        transform: scale(0);
        opacity: 0.4;
      }
    </style>
  </template>
</dom-module>`;document.head.appendChild($_documentContainer$l.content);
/**
@license
Copyright (c) 2017 Vaadin Ltd.
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
*/
class CheckboxElement extends(ElementMixin$1(ControlStateMixin(ThemableMixin(GestureEventListeners(PolymerElement))))){static get template(){return html$1`
    <style>
      :host {
        display: inline-block;
      }

      :host([hidden]) {
        display: none !important;
      }

      label {
        display: inline-flex;
        align-items: baseline;
        outline: none;
      }

      [part="checkbox"] {
        position: relative;
        display: inline-block;
        flex: none;
      }

      input[type="checkbox"] {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        opacity: 0;
        cursor: inherit;
        margin: 0;
      }

      :host([disabled]) {
        -webkit-tap-highlight-color: transparent;
      }
    </style>

    <label>
      <span part="checkbox">
        <input type="checkbox" checked="{{checked::change}}" disabled\$="[[disabled]]" indeterminate="{{indeterminate::change}}" role="presentation" tabindex="-1">
      </span>

      <span part="label">
        <slot></slot>
      </span>
    </label>
`}static get is(){return"vaadin-checkbox"}static get version(){return"2.2.12"}static get properties(){return{checked:{type:Boolean,value:!1,notify:!0,observer:"_checkedChanged",reflectToAttribute:!0},indeterminate:{type:Boolean,notify:!0,observer:"_indeterminateChanged",reflectToAttribute:!0,value:!1},value:{type:String,value:"on"},_nativeCheckbox:{type:Object}}}constructor(){super(),this.name}get name(){return this.checked?this._storedName:""}set name(e){this._storedName=e}ready(){super.ready(),this.setAttribute("role","checkbox"),this._nativeCheckbox=this.shadowRoot.querySelector('input[type="checkbox"]'),this.addEventListener("click",this._handleClick.bind(this)),this._addActiveListeners();const e=this.getAttribute("name");e&&(this.name=e),this.shadowRoot.querySelector('[part~="label"]').querySelector("slot").addEventListener("slotchange",this._updateLabelAttribute.bind(this)),this._updateLabelAttribute()}_updateLabelAttribute(){const e=this.shadowRoot.querySelector('[part~="label"]'),t=e.firstElementChild.assignedNodes();this._isAssignedNodesEmpty(t)?e.setAttribute("empty",""):e.removeAttribute("empty")}_isAssignedNodesEmpty(e){return 0===e.length||1==e.length&&e[0].nodeType==Node.TEXT_NODE&&""===e[0].textContent.trim()}_checkedChanged(e){this.indeterminate?this.setAttribute("aria-checked","mixed"):this.setAttribute("aria-checked",e)}_indeterminateChanged(e){e?this.setAttribute("aria-checked","mixed"):this.setAttribute("aria-checked",this.checked)}_addActiveListeners(){this._addEventListenerToNode(this,"down",(e=>{this.__interactionsAllowed(e)&&this.setAttribute("active","")})),this._addEventListenerToNode(this,"up",(()=>this.removeAttribute("active"))),this.addEventListener("keydown",(e=>{this.__interactionsAllowed(e)&&32===e.keyCode&&(e.preventDefault(),this.setAttribute("active",""))})),this.addEventListener("keyup",(e=>{this.__interactionsAllowed(e)&&32===e.keyCode&&(e.preventDefault(),this._toggleChecked(),this.removeAttribute("active"),this.indeterminate&&(this.indeterminate=!1))}))}get focusElement(){return this.shadowRoot.querySelector("input")}__interactionsAllowed(e){return!this.disabled&&"a"!==e.target.localName}_handleClick(e){this.__interactionsAllowed(e)&&(this.indeterminate?(this.indeterminate=!1,e.preventDefault(),this._toggleChecked()):e.composedPath()[0]!==this._nativeCheckbox&&(e.preventDefault(),this._toggleChecked()))}_toggleChecked(){this.checked=!this.checked,this.dispatchEvent(new CustomEvent("change",{composed:!1,bubbles:!0}))}}customElements.define(CheckboxElement.is,CheckboxElement);const $_documentContainer$m=html$1`<dom-module id="lumo-radio-button" theme-for="vaadin-radio-button">
  <template>
    <style>
      :host {
        -webkit-tap-highlight-color: transparent;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        cursor: default;
        outline: none;
      }

      [part="label"]:not([empty]) {
        margin: 0.1875em 0.875em 0.1875em 0.375em;
      }

      [part="radio"] {
        width: calc(1em + 2px);
        height: calc(1em + 2px);
        margin: 0.1875em;
        position: relative;
        border-radius: 50%;
        background-color: var(--lumo-contrast-20pct);
        transition: transform 0.2s cubic-bezier(.12, .32, .54, 2), background-color 0.15s;
        pointer-events: none;
        will-change: transform;
        line-height: 1.2;
        transform: translateZ(0); /* Workaround IE11 jumpiness */
      }

      /* Used for activation "halo" */
      [part="radio"]::before {
        /* Needed to align the radio-button nicely on the baseline */
        content: "\\2003";
        color: transparent;
        display: inline-block;
        width: 100%;
        height: 100%;
        border-radius: inherit;
        background-color: inherit;
        transform: scale(1.4);
        opacity: 0;
        transition: transform 0.1s, opacity 0.8s;
        will-change: transform, opacity;
      }

      /* Used for the dot */
      [part="radio"]::after {
        content: "";
        width: 0;
        height: 0;
        border: 3px solid var(--lumo-primary-contrast-color);
        border-radius: 50%;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0);
        transition: 0.25s transform;
        will-change: transform;
        background-clip: content-box;
      }

      :host([checked]) [part="radio"] {
        background-color: var(--lumo-primary-color);
      }

      :host([checked]) [part="radio"]::after {
        transform: translate(-50%, -50%) scale(1);
      }

      :host(:not([checked]):not([indeterminate]):not([disabled]):hover) [part="radio"] {
        background-color: var(--lumo-contrast-30pct);
      }

      :host([active]) [part="radio"] {
        transform: scale(0.9);
        transition-duration: 0.05s;
      }

      :host([active][checked]) [part="radio"] {
        transform: scale(1.1);
      }

      :host([active]:not([checked])) [part="radio"]::before {
        transition-duration: 0.01s, 0.01s;
        transform: scale(0);
        opacity: 0.4;
      }

      :host([focus-ring]) [part="radio"] {
        box-shadow: 0 0 0 3px var(--lumo-primary-color-50pct);
      }

      :host([disabled]) {
        pointer-events: none;
        color: var(--lumo-disabled-text-color);
      }

      :host([disabled]) ::slotted(*) {
        color: inherit;
      }

      :host([disabled]) [part="radio"] {
        background-color: var(--lumo-contrast-10pct);
      }

      :host([disabled]) [part="radio"]::after {
        border-color: var(--lumo-contrast-30pct);
      }

      /* IE11 only */
      ::-ms-backdrop,
      [part="radio"] {
        line-height: 1;
      }
    </style>
  </template>
</dom-module>`;document.head.appendChild($_documentContainer$m.content);
/**
@license
Copyright (c) 2017 Vaadin Ltd.
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
*/
class RadioButtonElement extends(ElementMixin$1(ControlStateMixin(ThemableMixin(GestureEventListeners(PolymerElement))))){static get template(){return html$1`
    <style>
      :host {
        display: inline-block;
      }

      label {
        display: inline-flex;
        align-items: baseline;
        outline: none;
      }

      [part="radio"] {
        position: relative;
        display: inline-block;
        flex: none;
      }

      input[type="radio"] {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        opacity: 0;
        cursor: inherit;
        margin: 0;
      }

      :host([disabled]) {
        -webkit-tap-highlight-color: transparent;
      }
    </style>

    <label>
      <span part="radio">
        <input type="radio" checked="{{checked::change}}" disabled\$="[[disabled]]" role="presentation" on-change="_onChange" tabindex="-1">
      </span>

      <span part="label">
        <slot></slot>
      </span>
    </label>
`}static get is(){return"vaadin-radio-button"}static get version(){return"1.2.4"}static get properties(){return{checked:{type:Boolean,value:!1,notify:!0,observer:"_checkedChanged",reflectToAttribute:!0},name:String,value:{type:String,value:"on"}}}get name(){return this.checked?this._storedName:""}set name(e){this._storedName=e}attributeChangedCallback(e,t,o){if(super.attributeChangedCallback(e,t,o),/^(disabled|checked)$/.test(e)){if(/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream&&this.shadowRoot&&parseInt(navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/)[1],10)){const e="-webkit-backface-visibility";this.shadowRoot.querySelectorAll("*").forEach((t=>{t.style[e]="visible",t.style[e]=""}))}}}ready(){super.ready(),this.setAttribute("role","radio"),this._addListeners();const e=this.getAttribute("name");e&&(this.name=e),this.shadowRoot.querySelector('[part~="label"]').querySelector("slot").addEventListener("slotchange",this._updateLabelAttribute.bind(this)),this._updateLabelAttribute()}_updateLabelAttribute(){const e=this.shadowRoot.querySelector('[part~="label"]'),t=e.firstElementChild.assignedNodes();this._isAssignedNodesEmpty(t)?e.setAttribute("empty",""):e.removeAttribute("empty")}_isAssignedNodesEmpty(e){return 0===e.length||1==e.length&&e[0].nodeType==Node.TEXT_NODE&&""===e[0].textContent.trim()}_checkedChanged(e){this.setAttribute("aria-checked",e)}_addListeners(){this._addEventListenerToNode(this,"down",(e=>{this.disabled||this.setAttribute("active","")})),this._addEventListenerToNode(this,"up",(e=>{this.removeAttribute("active"),this.checked||this.disabled||this.click()})),this.addEventListener("keydown",(e=>{this.disabled||32!==e.keyCode||(e.preventDefault(),this.setAttribute("active",""))})),this.addEventListener("keyup",(e=>{this.disabled||32!==e.keyCode||(e.preventDefault(),this.click(),this.removeAttribute("active"))}))}click(){this.shadowRoot.querySelector("input").click()}get focusElement(){return this.shadowRoot.querySelector("input")}_onChange(e){const t=new CustomEvent("change",{detail:{sourceEvent:e},bubbles:e.bubbles,cancelable:e.cancelable});this.dispatchEvent(t)}}customElements.define(RadioButtonElement.is,RadioButtonElement);const $_documentContainer$n=html$1`<dom-module id="lumo-radio-group" theme-for="vaadin-radio-group">
  <template>
    <style include="lumo-required-field">
      :host {
        color: var(--lumo-body-text-color);
        font-size: var(--lumo-font-size-m);
        font-family: var(--lumo-font-family);
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        -webkit-tap-highlight-color: transparent;
        padding: var(--lumo-space-xs) 0;
      }

      :host::before {
        height: var(--lumo-size-m);
        box-sizing: border-box;
        display: inline-flex;
        align-items: center;
      }

      :host([theme~="vertical"]) [part="group-field"] {
        display: flex;
        flex-direction: column;
      }

      [part="label"] {
        padding-bottom: 0.7em;
      }

      :host([focused]:not([readonly])) [part="label"] {
        color: var(--lumo-primary-text-color);
      }

      :host(:hover:not([readonly]):not([focused])) [part="label"] {
        color: var(--lumo-body-text-color);
      }

      /* Touch device adjustment */
      @media (pointer: coarse) {
        :host(:hover:not([readonly]):not([focused])) [part="label"] {
          color: var(--lumo-secondary-text-color);
        }
      }
    </style>
  </template>
</dom-module>`;document.head.appendChild($_documentContainer$n.content);
/**
@license
Copyright (c) 2017 Vaadin Ltd.
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
*/
class RadioGroupElement extends(ThemableMixin(PolymerElement)){static get template(){return html$1`
    <style>
      :host {
        display: inline-flex;

        /* Prevent horizontal overflow in IE 11 instead of wrapping radios */
        max-width: 100%;
      }

      :host::before {
        content: "\\2003";
        width: 0;
        display: inline-block;
      }

      :host([hidden]) {
        display: none !important;
      }

      .vaadin-group-field-container {
        display: flex;
        flex-direction: column;

        /* Prevent horizontal overflow in IE 11 instead of wrapping radios */
        width: 100%;
      }

      [part="label"]:empty {
        display: none;
      }
    </style>

    <div class="vaadin-group-field-container">
      <label part="label">[[label]]</label>

      <div part="group-field">
        <slot id="slot"></slot>
      </div>

      <div part="error-message" id="[[_errorId]]" aria-live="assertive" aria-hidden\$="[[_getErrorMessageAriaHidden(invalid, errorMessage, _errorId)]]">[[errorMessage]]</div>
    </div>
`}static get is(){return"vaadin-radio-group"}static get properties(){return{disabled:{type:Boolean,reflectToAttribute:!0,observer:"_disabledChanged"},readonly:{type:Boolean,reflectToAttribute:!0,observer:"_readonlyChanged"},invalid:{type:Boolean,reflectToAttribute:!0,notify:!0,value:!1},required:{type:Boolean,reflectToAttribute:!0},errorMessage:{type:String,value:""},_errorId:{type:String},_checkedButton:{type:Object},label:{type:String,value:"",observer:"_labelChanged"},value:{type:String,notify:!0,observer:"_valueChanged"}}}ready(){super.ready(),this._addListeners(),this._observer=new FlattenedNodesObserver(this,(e=>{const t=e=>{e.target.checked&&this._changeSelectedButton(e.target)};this._filterRadioButtons(e.addedNodes).reverse().forEach((e=>{e.addEventListener("checked-changed",t),this.disabled&&(e.disabled=!0),e.checked&&this._changeSelectedButton(e)})),this._filterRadioButtons(e.removedNodes).forEach((e=>{e.removeEventListener("checked-changed",t),e.checked&&(this.value=void 0)}))})),this._radioButtons.length&&this._setFocusable(0),this.setAttribute("role","radiogroup");const e=RadioGroupElement._uniqueId=1+RadioGroupElement._uniqueId||0;this._errorId=`${this.constructor.is}-error-${e}`}get _radioButtons(){return this._filterRadioButtons(this.querySelectorAll("*"))}_setFocused(e){e?this.setAttribute("focused",""):this.removeAttribute("focused")}_filterRadioButtons(e){return Array.from(e).filter((e=>e instanceof RadioButtonElement))}_disabledChanged(e){this.setAttribute("aria-disabled",e),this._updateDisableButtons()}_updateDisableButtons(){this._radioButtons.forEach((e=>{this.disabled?e.disabled=!0:this.readonly?e.disabled=e!==this._checkedButton&&this.readonly:e.disabled=!1}))}_readonlyChanged(e,t){(e||t)&&this._updateDisableButtons()}_addListeners(){this.addEventListener("keydown",(e=>{var t=e.target==this?this._checkedButton:e.target;37!==e.keyCode&&38!==e.keyCode||(e.preventDefault(),this._selectPreviousButton(t)),39!==e.keyCode&&40!==e.keyCode||(e.preventDefault(),this._selectNextButton(t))})),this.addEventListener("focusin",(()=>this._setFocused(this._containsFocus()))),this.addEventListener("focusout",(e=>{e.composed&&this.validate(),this._setFocused(!1)}))}_selectButton(e,t){this._containsFocus()&&(e.focus(),t&&e.setAttribute("focus-ring","")),this._changeSelectedButton(e,t)}_containsFocus(){const e=this.getRootNode(),t=void 0!==e._activeElement?e._activeElement:e.activeElement;return this.contains(t)}_hasEnabledButtons(){return!this._radioButtons.every((e=>e.disabled))}_selectNextButton(e){if(this._hasEnabledButtons()){var t=e.nextElementSibling||this.firstElementChild;t.disabled?this._selectNextButton(t):this._selectButton(t,!0)}}_selectPreviousButton(e){if(this._hasEnabledButtons()){var t=e.previousElementSibling||this.lastElementChild;t.disabled?this._selectPreviousButton(t):this._selectButton(t,!0)}}_changeSelectedButton(e,t){this._checkedButton!==e&&(this._checkedButton=e,this._radioButtons.forEach((e=>{e===this._checkedButton?t?e.click():e.checked=!0:e.checked=!1})),this._checkedButton&&(this.value=this._checkedButton.value),this.validate(),this.readonly&&this._updateDisableButtons(),e&&this._setFocusable(this._radioButtons.indexOf(e)))}_valueChanged(e,t){if(t&&(""===e||null==e))return this._changeSelectedButton(null),void this.removeAttribute("has-value");if(!this._checkedButton||e!=this._checkedButton.value){const t=this._radioButtons.filter((t=>t.value==e))[0];t?(this._selectButton(t),this.setAttribute("has-value","")):console.warn(`No <vaadin-radio-button> with value ${e} found.`)}}validate(){return!(this.invalid=!this.checkValidity())}checkValidity(){return!this.required||!!this.value}_setFocusable(e){const t=this._radioButtons;t.forEach((o=>o.tabindex=o===t[e]?0:-1))}_labelChanged(e){e?this.setAttribute("has-label",""):this.removeAttribute("has-label")}_getActiveErrorId(e,t,o){return t&&e?o:void 0}_getErrorMessageAriaHidden(e,t,o){return(!this._getActiveErrorId(e,t,o)).toString()}}customElements.define(RadioGroupElement.is,RadioGroupElement),
/*!
 * iro.js v4.5.1
 * 2016-2019 James Daniel
 * Licensed under MPL 2.0
 * github.com/jaames/iro.js
 */
function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.iro=t()}(window,(function(){var e=function(){},t={},o=[],i=[];function r(t,r){var s,n,a,l,c=arguments,d=i;for(l=arguments.length;l-- >2;)o.push(c[l]);for(r&&null!=r.children&&(o.length||o.push(r.children),delete r.children);o.length;)if((n=o.pop())&&void 0!==n.pop)for(l=n.length;l--;)o.push(n[l]);else"boolean"==typeof n&&(n=null),(a="function"!=typeof t)&&(null==n?n="":"number"==typeof n?n=String(n):"string"!=typeof n&&(a=!1)),a&&s?d[d.length-1]+=n:d===i?d=[n]:d.push(n),s=a;var h=new e;return h.nodeName=t,h.children=d,h.attributes=null==r?void 0:r,h.key=null==r?void 0:r.key,h}function s(e,t){for(var o in t)e[o]=t[o];return e}function n(e,t){null!=e&&("function"==typeof e?e(t):e.current=t)}var a="function"==typeof Promise?Promise.resolve().then.bind(Promise.resolve()):setTimeout,l=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,c=[];function d(e){!e._dirty&&(e._dirty=!0)&&1==c.push(e)&&a(h)}function h(){for(var e;e=c.pop();)e._dirty&&R(e)}function p(e,t,o){return"string"==typeof t||"number"==typeof t?void 0!==e.splitText:"string"==typeof t.nodeName?!e._componentConstructor&&u(e,t.nodeName):o||e._componentConstructor===t.nodeName}function u(e,t){return e.normalizedNodeName===t||e.nodeName.toLowerCase()===t.toLowerCase()}function m(e){var t=s({},e.attributes);t.children=e.children;var o=e.nodeName.defaultProps;if(void 0!==o)for(var i in o)void 0===t[i]&&(t[i]=o[i]);return t}function f(e){var t=e.parentNode;t&&t.removeChild(e)}function g(e,t,o,i,r){if("className"===t&&(t="class"),"key"===t);else if("ref"===t)n(o,null),n(i,e);else if("class"!==t||r)if("style"===t){if(i&&"string"!=typeof i&&"string"!=typeof o||(e.style.cssText=i||""),i&&"object"==typeof i){if("string"!=typeof o)for(var s in o)s in i||(e.style[s]="");for(var s in i)e.style[s]="number"==typeof i[s]&&!1===l.test(s)?i[s]+"px":i[s]}}else if("dangerouslySetInnerHTML"===t)i&&(e.innerHTML=i.__html||"");else if("o"==t[0]&&"n"==t[1]){var a=t!==(t=t.replace(/Capture$/,""));t=t.toLowerCase().substring(2),i?o||e.addEventListener(t,y,a):e.removeEventListener(t,y,a),(e._listeners||(e._listeners={}))[t]=i}else if("list"!==t&&"type"!==t&&!r&&t in e){try{e[t]=null==i?"":i}catch(e){}null!=i&&!1!==i||"spellcheck"==t||e.removeAttribute(t)}else{var c=r&&t!==(t=t.replace(/^xlink:?/,""));null==i||!1===i?c?e.removeAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase()):e.removeAttribute(t):"function"!=typeof i&&(c?e.setAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase(),i):e.setAttribute(t,i))}else e.className=i||""}function y(e){return this._listeners[e.type](e)}var b=[],v=0,x=!1,w=!1;function _(){for(var e;e=b.shift();)e.componentDidMount&&e.componentDidMount()}function S(e,t,o,i,r,s){v++||(x=null!=r&&void 0!==r.ownerSVGElement,w=null!=e&&!("__preactattr_"in e));var n=P(e,t,o,i,s);return r&&n.parentNode!==r&&r.appendChild(n),--v||(w=!1,s||_()),n}function P(e,t,o,i,r){var s=e,n=x;if(null!=t&&"boolean"!=typeof t||(t=""),"string"==typeof t||"number"==typeof t)return e&&void 0!==e.splitText&&e.parentNode&&(!e._component||r)?e.nodeValue!=t&&(e.nodeValue=t):(s=document.createTextNode(t),e&&(e.parentNode&&e.parentNode.replaceChild(s,e),C(e,!0))),s.__preactattr_=!0,s;var a,l,c=t.nodeName;if("function"==typeof c)return function(e,t,o,i){var r=e&&e._component,s=r,n=e,a=r&&e._componentConstructor===t.nodeName,l=a,c=m(t);for(;r&&!l&&(r=r._parentComponent);)l=r.constructor===t.nodeName;r&&l&&(!i||r._component)?(I(r,c,3,o,i),e=r.base):(s&&!a&&(O(s),e=n=null),r=E(t.nodeName,c,o),e&&!r.nextBase&&(r.nextBase=e,n=null),I(r,c,1,o,i),e=r.base,n&&e!==n&&(n._component=null,C(n,!1)));return e}(e,t,o,i);if(x="svg"===c||"foreignObject"!==c&&x,c=String(c),(!e||!u(e,c))&&(a=c,(l=x?document.createElementNS("http://www.w3.org/2000/svg",a):document.createElement(a)).normalizedNodeName=a,s=l,e)){for(;e.firstChild;)s.appendChild(e.firstChild);e.parentNode&&e.parentNode.replaceChild(s,e),C(e,!0)}var d=s.firstChild,h=s.__preactattr_,y=t.children;if(null==h){h=s.__preactattr_={};for(var b=s.attributes,v=b.length;v--;)h[b[v].name]=b[v].value}return!w&&y&&1===y.length&&"string"==typeof y[0]&&null!=d&&void 0!==d.splitText&&null==d.nextSibling?d.nodeValue!=y[0]&&(d.nodeValue=y[0]):(y&&y.length||null!=d)&&function(e,t,o,i,r){var s,n,a,l,c,d=e.childNodes,h=[],u={},m=0,g=0,y=d.length,b=0,v=t?t.length:0;if(0!==y)for(var x=0;x<y;x++){var w=d[x],_=w.__preactattr_;null!=(S=v&&_?w._component?w._component.__key:_.key:null)?(m++,u[S]=w):(_||(void 0!==w.splitText?!r||w.nodeValue.trim():r))&&(h[b++]=w)}if(0!==v)for(x=0;x<v;x++){var S;if(c=null,null!=(S=(l=t[x]).key))m&&void 0!==u[S]&&(c=u[S],u[S]=void 0,m--);else if(g<b)for(s=g;s<b;s++)if(void 0!==h[s]&&p(n=h[s],l,r)){c=n,h[s]=void 0,s===b-1&&b--,s===g&&g++;break}c=P(c,l,o,i),a=d[x],c&&c!==e&&c!==a&&(null==a?e.appendChild(c):c===a.nextSibling?f(a):e.insertBefore(c,a))}if(m)for(var x in u)void 0!==u[x]&&C(u[x],!1);for(;g<=b;)void 0!==(c=h[b--])&&C(c,!1)}(s,y,o,i,w||null!=h.dangerouslySetInnerHTML),function(e,t,o){var i;for(i in o)t&&null!=t[i]||null==o[i]||g(e,i,o[i],o[i]=void 0,x);for(i in t)"children"===i||"innerHTML"===i||i in o&&t[i]===("value"===i||"checked"===i?e[i]:o[i])||g(e,i,o[i],o[i]=t[i],x)}(s,t.attributes,h),x=n,s}function C(e,t){var o=e._component;o?O(o):(null!=e.__preactattr_&&n(e.__preactattr_.ref,null),!1!==t&&null!=e.__preactattr_||f(e),T(e))}function T(e){for(e=e.lastChild;e;){var t=e.previousSibling;C(e,!0),e=t}}var A=[];function E(e,t,o){var i,r=A.length;for(e.prototype&&e.prototype.render?(i=new e(t,o),M.call(i,t,o)):((i=new M(t,o)).constructor=e,i.render=k);r--;)if(A[r].constructor===e)return i.nextBase=A[r].nextBase,A.splice(r,1),i;return i}function k(e,t,o){return this.constructor(e,o)}function I(e,o,i,r,s){e._disable||(e._disable=!0,e.__ref=o.ref,e.__key=o.key,delete o.ref,delete o.key,void 0===e.constructor.getDerivedStateFromProps&&(!e.base||s?e.componentWillMount&&e.componentWillMount():e.componentWillReceiveProps&&e.componentWillReceiveProps(o,r)),r&&r!==e.context&&(e.prevContext||(e.prevContext=e.context),e.context=r),e.prevProps||(e.prevProps=e.props),e.props=o,e._disable=!1,0!==i&&(1!==i&&!1===t.syncComponentUpdates&&e.base?d(e):R(e,1,s)),n(e.__ref,e))}function R(e,t,o,i){if(!e._disable){var r,n,a,l=e.props,c=e.state,d=e.context,h=e.prevProps||l,p=e.prevState||c,u=e.prevContext||d,f=e.base,g=e.nextBase,y=f||g,x=e._component,w=!1,P=u;if(e.constructor.getDerivedStateFromProps&&(c=s(s({},c),e.constructor.getDerivedStateFromProps(l,c)),e.state=c),f&&(e.props=h,e.state=p,e.context=u,2!==t&&e.shouldComponentUpdate&&!1===e.shouldComponentUpdate(l,c,d)?w=!0:e.componentWillUpdate&&e.componentWillUpdate(l,c,d),e.props=l,e.state=c,e.context=d),e.prevProps=e.prevState=e.prevContext=e.nextBase=null,e._dirty=!1,!w){r=e.render(l,c,d),e.getChildContext&&(d=s(s({},d),e.getChildContext())),f&&e.getSnapshotBeforeUpdate&&(P=e.getSnapshotBeforeUpdate(h,p));var T,A,k=r&&r.nodeName;if("function"==typeof k){var M=m(r);(n=x)&&n.constructor===k&&M.key==n.__key?I(n,M,1,d,!1):(T=n,e._component=n=E(k,M,d),n.nextBase=n.nextBase||g,n._parentComponent=e,I(n,M,0,d,!1),R(n,1,o,!0)),A=n.base}else a=y,(T=x)&&(a=e._component=null),(y||1===t)&&(a&&(a._component=null),A=S(a,r,d,o||!f,y&&y.parentNode,!0));if(y&&A!==y&&n!==x){var B=y.parentNode;B&&A!==B&&(B.replaceChild(A,y),T||(y._component=null,C(y,!1)))}if(T&&O(T),e.base=A,A&&!i){for(var D=e,F=e;F=F._parentComponent;)(D=F).base=A;A._component=D,A._componentConstructor=D.constructor}}for(!f||o?b.push(e):w||e.componentDidUpdate&&e.componentDidUpdate(h,p,P);e._renderCallbacks.length;)e._renderCallbacks.pop().call(e);v||i||_()}}function O(e){var t=e.base;e._disable=!0,e.componentWillUnmount&&e.componentWillUnmount(),e.base=null;var o=e._component;o?O(o):t&&(null!=t.__preactattr_&&n(t.__preactattr_.ref,null),e.nextBase=t,f(t),A.push(e),T(t)),n(e.__ref,null)}function M(e,t){this._dirty=!0,this.context=t,this.props=e,this.state=this.state||{},this._renderCallbacks=[]}function B(e,t,o,i){void 0===i&&(i={});for(var r=0;r<t.length;r++)e.addEventListener(t[r],o,i)}function D(e,t,o,i){void 0===i&&(i={});for(var r=0;r<t.length;r++)e.removeEventListener(t[r],o,i)}s(M.prototype,{setState:function(e,t){this.prevState||(this.prevState=this.state),this.state=s(s({},this.state),"function"==typeof e?e(this.state,this.props):e),t&&this._renderCallbacks.push(t),d(this)},forceUpdate:function(e){e&&this._renderCallbacks.push(e),R(this,2)},render:function(){}});var F="mousedown",L="mousemove",z="mouseup",N="touchstart",$="touchmove",U="touchend",G=function(e){function t(t){e.call(this,t),this.uid=(Math.random()+1).toString(36).substring(5)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.componentDidMount=function(){B(this.base,[F,N],this,{passive:!1})},t.prototype.componentWillUnmount=function(){D(this.base,[F,N],this)},t.prototype.handleEvent=function(e){e.preventDefault();var t=e.touches?e.changedTouches[0]:e,o=t.clientX,i=t.clientY,r=this.base.getBoundingClientRect();switch(e.type){case F:case N:B(document,[L,$,z,U],this,{passive:!1}),this.handleInput(o,i,r,"START");break;case L:case $:this.handleInput(o,i,r,"MOVE");break;case z:case U:this.handleInput(o,i,r,"END"),D(document,[L,$,z,U],this,{passive:!1})}},t}(M);function W(e){var t=window.navigator.userAgent,o=/^((?!chrome|android).)*safari/i.test(t),i=/iPhone|iPod|iPad/i.test(t),r=window.location;return o||i?r.protocol+"//"+r.host+r.pathname+r.search+e:e}function V(e,t,o,i,r){var s=r-i<=180?0:1;return i*=Math.PI/180,r*=Math.PI/180,"M "+(e+o*Math.cos(r))+" "+(t+o*Math.sin(r))+" A "+o+" "+o+" 0 "+s+" 0 "+(e+o*Math.cos(i))+" "+(t+o*Math.sin(i))}function H(e){var t=e.r,o=e.url;return r("svg",{class:"iro__handle",x:e.x,y:e.y,style:{overflow:"visible"}},o&&r("use",Object.assign({},{xlinkHref:W(o)},e.origin)),!o&&r("circle",{class:"iro__handle__inner",r:t,fill:"none","stroke-width":2,stroke:"#000"}),!o&&r("circle",{class:"iro__handle__outer",r:t-2,fill:"none","stroke-width":2,stroke:"#fff"}))}H.defaultProps={x:0,y:0,r:8,url:null,origin:{x:0,y:0}};var j=Array.apply(null,{length:360}).map((function(e,t){return t})),q=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype._transformAngle=function(e,t){var o=this.props.wheelAngle;return((e="clockwise"===this.props.wheelDirection?-360+e-(t?-o:o):o-e)%360+360)%360},t.prototype.render=function(e){var t=this,o=e.width,i=e.borderWidth,s=e.handleRadius,n=e.color.hsv,a=o/2-i,l=this._transformAngle(n.h,!0)*(Math.PI/180),c=n.s/100*(a-e.padding-s-i),d=a+i,h=a+i;return r("svg",{class:"iro__wheel",width:o,height:o,style:{overflow:"visible",display:"block"}},r("defs",null,r("radialGradient",{id:this.uid},r("stop",{offset:"0%","stop-color":"#fff"}),r("stop",{offset:"100%","stop-color":"#fff","stop-opacity":"0"}))),r("g",{class:"iro__wheel__hue","stroke-width":a,fill:"none"},j.map((function(e){return r("path",{key:e,d:V(d,h,a/2,e,e+1.5),stroke:"hsl("+t._transformAngle(e)+", 100%, 50%)"})}))),r("circle",{class:"iro__wheel__saturation",cx:d,cy:h,r:a,fill:"url("+W("#"+this.uid)+")"}),e.wheelLightness&&r("circle",{class:"iro__wheel__lightness",cx:d,cy:h,r:a,fill:"#000",opacity:1-n.v/100}),r("circle",{class:"iro__wheel__border",cx:d,cy:h,r:a,fill:"none",stroke:e.borderColor,"stroke-width":i}),r(H,{r:s,url:e.handleSvg,origin:e.handleOrigin,x:d+c*Math.cos(l),y:h+c*Math.sin(l)}))},t.prototype.handleInput=function(e,t,o,i){var r=o.left,s=o.top,n=this.props,a=n.width/2,l=a-n.padding-n.handleRadius-n.borderWidth;e=a-(e-r),t=a-(t-s);var c=Math.atan2(t,e),d=this._transformAngle(Math.round(c*(180/Math.PI))+180),h=Math.min(Math.sqrt(e*e+t*t),l);n.onInput(i,{h:d,s:Math.round(100/l*h)})},t}(G);function X(e,t){var o=e.indexOf("%")>-1,i=parseFloat(e);return o?t/100*i:i}function Y(e){return parseInt(e,16)}function Z(e){return e.toString(16).padStart(2,"0")}var Q="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)",J="[\\s|\\(]+("+Q+")[,|\\s]+("+Q+")[,|\\s]+("+Q+")\\s*\\)?",K="[\\s|\\(]+("+Q+")[,|\\s]+("+Q+")[,|\\s]+("+Q+")[,|\\s]+("+Q+")\\s*\\)?",ee=new RegExp("rgb"+J),te=new RegExp("rgba"+K),oe=new RegExp("hsl"+J),ie=new RegExp("hsla"+K),re="^(?:#?|0x?)",se="([0-9a-fA-F]{1})",ne="([0-9a-fA-F]{2})",ae=new RegExp(""+re+se+se+se+"$"),le=new RegExp(""+re+se+se+se+se+"$"),ce=new RegExp(""+re+ne+ne+ne+"$"),de=new RegExp(""+re+ne+ne+ne+ne+"$"),he=function(e){this._onChange=!1,this._value={h:0,s:0,v:0,a:1},e&&this.set(e)},pe={hsv:{configurable:!0},rgb:{configurable:!0},hsl:{configurable:!0},rgbString:{configurable:!0},hexString:{configurable:!0},hslString:{configurable:!0}};he.prototype.set=function(e){var t="string"==typeof e,o="object"==typeof e;if(t&&/^(?:#?|0x?)[0-9a-fA-F]{3,8}$/.test(e))this.hexString=e;else if(t&&/^rgba?/.test(e))this.rgbString=e;else if(t&&/^hsla?/.test(e))this.hslString=e;else if(o&&e instanceof he)this.hsv=e.hsv;else if(o&&"r"in e&&"g"in e&&"b"in e)this.rgb=e;else if(o&&"h"in e&&"s"in e&&"v"in e)this.hsv=e;else{if(!(o&&"h"in e&&"s"in e&&"l"in e))throw new Error("invalid color value");this.hsl=e}},he.prototype.setChannel=function(e,t,o){var i;this[e]=Object.assign({},this[e],((i={})[t]=o,i))},he.prototype.clone=function(){return new he(this)},he.hsvToRgb=function(e){var t=e.h/60,o=e.s/100,i=e.v/100,r=Math.floor(t),s=t-r,n=i*(1-o),a=i*(1-s*o),l=i*(1-(1-s)*o),c=r%6;return{r:255*[i,a,n,n,l,i][c],g:255*[l,i,i,a,n,n][c],b:255*[n,n,l,i,i,a][c]}},he.rgbToHsv=function(e){var t,o=e.r/255,i=e.g/255,r=e.b/255,s=Math.max(o,i,r),n=Math.min(o,i,r),a=s-n,l=s,c=0===s?0:a/s;switch(s){case n:t=0;break;case o:t=(i-r)/a+(i<r?6:0);break;case i:t=(r-o)/a+2;break;case r:t=(o-i)/a+4}return{h:60*t,s:100*c,v:100*l}},he.hsvToHsl=function(e){var t=e.s/100,o=e.v/100,i=(2-t)*o,r=i<=1?i:2-i,s=r<1e-9?0:t*o/r;return{h:e.h,s:100*s,l:50*i}},he.hslToHsv=function(e){var t=2*e.l,o=e.s*(t<=100?t:200-t)/100,i=t+o<1e-9?0:2*o/(t+o);return{h:e.h,s:100*i,v:(t+o)/2}},pe.hsv.get=function(){var e=this._value;return{h:e.h,s:e.s,v:e.v}},pe.hsv.set=function(e){var t=this._value;if(e=Object.assign({},t,e),this._onChange){var o={};for(var i in t)o[i]=e[i]!=t[i];this._value=e,(o.h||o.s||o.v||o.a)&&this._onChange(this,o)}else this._value=e},pe.rgb.get=function(){var e=he.hsvToRgb(this._value),t=e.r,o=e.g,i=e.b;return{r:Math.round(t),g:Math.round(o),b:Math.round(i)}},pe.rgb.set=function(e){this.hsv=Object.assign({},he.rgbToHsv(e),{a:void 0===e.a?1:e.a})},pe.hsl.get=function(){var e=he.hsvToHsl(this._value),t=e.h,o=e.s,i=e.l;return{h:Math.round(t),s:Math.round(o),l:Math.round(i)}},pe.hsl.set=function(e){this.hsv=Object.assign({},he.hslToHsv(e),{a:void 0===e.a?1:e.a})},pe.rgbString.get=function(){var e=this.rgb;return"rgb("+e.r+", "+e.g+", "+e.b+")"},pe.rgbString.set=function(e){var t,o,i,r,s=1;if((t=ee.exec(e))?(o=X(t[1],255),i=X(t[2],255),r=X(t[3],255)):(t=te.exec(e))&&(o=X(t[1],255),i=X(t[2],255),r=X(t[3],255),s=X(t[4],1)),!t)throw new Error("invalid rgb string");this.rgb={r:o,g:i,b:r,a:s}},pe.hexString.get=function(){var e=this.rgb;return"#"+Z(e.r)+Z(e.g)+Z(e.b)},pe.hexString.set=function(e){var t,o,i,r,s=255;if((t=ae.exec(e))?(o=17*Y(t[1]),i=17*Y(t[2]),r=17*Y(t[3])):(t=le.exec(e))?(o=17*Y(t[1]),i=17*Y(t[2]),r=17*Y(t[3]),s=17*Y(t[4])):(t=ce.exec(e))?(o=Y(t[1]),i=Y(t[2]),r=Y(t[3])):(t=de.exec(e))&&(o=Y(t[1]),i=Y(t[2]),r=Y(t[3]),s=Y(t[4])),!t)throw new Error("invalid hex string");this.rgb={r:o,g:i,b:r,a:s/255}},pe.hslString.get=function(){var e=this.hsl;return"hsl("+e.h+", "+e.s+"%, "+e.l+"%)"},pe.hslString.set=function(e){var t,o,i,r,s=1;if((t=oe.exec(e))?(o=X(t[1],360),i=X(t[2],100),r=X(t[3],100)):(t=ie.exec(e))&&(o=X(t[1],360),i=X(t[2],100),r=X(t[3],100),s=X(t[4],1)),!t)throw new Error("invalid hsl string");this.hsl={h:o,s:i,l:r,a:s}},Object.defineProperties(he.prototype,pe);var ue=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.renderGradient=function(e){var t=e.color.hsv,o=[];switch(e.sliderType){case"hue":o=[{offset:"0",color:"#f00"},{offset:"16.666",color:"#ff0"},{offset:"33.333",color:"#0f0"},{offset:"50",color:"#0ff"},{offset:"66.666",color:"#00f"},{offset:"83.333",color:"#f0f"},{offset:"100",color:"#f00"}];break;case"saturation":var i=he.hsvToHsl({h:t.h,s:0,v:t.v}),s=he.hsvToHsl({h:t.h,s:100,v:t.v});o=[{offset:"0",color:"hsl("+i.h+", "+i.s+"%, "+i.l+"%)"},{offset:"100",color:"hsl("+s.h+", "+s.s+"%, "+s.l+"%)"}];break;case"value":default:var n=he.hsvToHsl({h:t.h,s:t.s,v:100});o=[{offset:"0",color:"#000"},{offset:"100",color:"hsl("+n.h+", "+n.s+"%, "+n.l+"%)"}]}return r("linearGradient",{id:this.uid},o.map((function(e){return r("stop",{offset:e.offset+"%","stop-color":e.color})})))},t.prototype.render=function(e){var t=e.width,o=e.sliderHeight,i=e.borderWidth,s=e.handleRadius;o=o||2*e.padding+2*s+2*i,this.width=t,this.height=o;var n,a=o/2,l=t-2*a,c=e.color.hsv;switch(e.sliderType){case"hue":n=c.h/=3.6;break;case"saturation":n=c.s;break;case"value":default:n=c.v}return r("svg",{class:"iro__slider",width:t,height:o,style:{marginTop:e.sliderMargin,overflow:"visible",display:"block"}},r("defs",null,this.renderGradient(e)),r("rect",{class:"iro__slider__value",rx:a,ry:a,x:i/2,y:i/2,width:t-i,height:o-i,"stroke-width":i,stroke:e.borderColor,fill:"url("+W("#"+this.uid)+")"}),r(H,{r:s,url:e.handleSvg,origin:e.handleOrigin,x:a+n/100*l,y:o/2}))},t.prototype.getValueFromPoint=function(e,t,o){var i=o.left,r=this.width-this.height;e-=i+this.height/2;var s=Math.max(Math.min(e,r),0);return Math.round(100/r*s)},t.prototype.handleInput=function(e,t,o,i){var r,s,n=this.getValueFromPoint(e,t,o);switch(this.props.sliderType){case"hue":s="h",n*=3.6;break;case"saturation":s="s";break;case"value":default:s="v"}this.props.onInput(i,((r={})[s]=n,r))},t}(G);var me=function(e){function t(t){e.call(this,t),this.emitHook("init:before"),this._events={},this._deferredEvents={},this._colorUpdateActive=!1,this._colorUpdateSrc=null,this.id=t.id,this.color=new he(t.color),this.deferredEmit("color:init",this.color,{h:!1,s:!1,v:!1,a:!1}),this.color._onChange=this.updateColor.bind(this),this.state=Object.assign({},t,{color:this.color,ref:void 0}),this.emitHook("init:state"),t.layout?this.layout=t.layout:this.layout=[{component:q,options:{}},{component:ue,options:{}}],this.emitHook("init:after")}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.on=function(e,t){var o=this,i=this._events;(Array.isArray(e)?e:[e]).forEach((function(e){o.emitHook("event:on",e,t),(i[e]||(i[e]=[])).push(t),o._deferredEvents[e]&&(o._deferredEvents[e].forEach((function(e){t.apply(null,e)})),o._deferredEvents[e]=[])}))},t.prototype.off=function(e,t){var o=this;(Array.isArray(e)?e:[e]).forEach((function(e){var i=o._events[e];o.emitHook("event:off",e,t),i&&i.splice(i.indexOf(t),1)}))},t.prototype.emit=function(e){for(var t,o=[],i=arguments.length-1;i-- >0;)o[i]=arguments[i+1];(t=this).emitHook.apply(t,[e].concat(o));for(var r=this._events[e]||[],s=0;s<r.length;s++)r[s].apply(this,o)},t.prototype.deferredEmit=function(e){for(var t,o=[],i=arguments.length-1;i-- >0;)o[i]=arguments[i+1];var r=this._deferredEvents;(t=this).emit.apply(t,[e].concat(o)),(r[e]||(r[e]=[])).push(o)},t.prototype.resize=function(e){this.setState({width:e})},t.prototype.reset=function(){this.color.set(this.props.color)},t.addHook=function(e,o){var i=t.pluginHooks;(i[e]||(i[e]=[])).push(o)},t.prototype.emitHook=function(e){for(var o=[],i=arguments.length-1;i-- >0;)o[i]=arguments[i+1];for(var r=t.pluginHooks[e]||[],s=0;s<r.length;s++)r[s].apply(this,o)},t.prototype.onMount=function(e){this.el=e,this.deferredEmit("mount",this)},t.prototype.updateColor=function(e,t){this.emitHook("color:beforeUpdate",e,t),this.setState({color:e}),this.emitHook("color:afterUpdate",e,t),this._colorUpdateActive||(this._colorUpdateActive=!0,"input"==this._colorUpdateSrc&&this.emit("input:change",e,t),this.emit("color:change",e,t),this._colorUpdateActive=!1)},t.prototype.handleInput=function(e,t){"START"===e&&this.emit("input:start",this.color),"MOVE"===e&&this.emit("input:move",this.color),this._colorUpdateSrc="input",this.color.hsv=t,"END"===e&&this.emit("input:end",this.color),this._colorUpdateSrc=null},t.prototype.render=function(e,t){var o=this;return r("div",{class:"iro__colorPicker",id:e.id,style:{display:t.display,width:t.width}},this.layout.map((function(e){var i=e.component,s=e.options;return r(i,Object.assign({},t,s,{onInput:function(e,t){return o.handleInput(e,t)},parent:o}))})))},t}(M);me.pluginHooks={},me.defaultProps={width:300,height:300,handleRadius:8,handleSvg:null,handleOrigin:{x:0,y:0},color:"#fff",borderColor:"#fff",borderWidth:0,display:"block",id:null,wheelLightness:!0,wheelAngle:0,wheelDirection:"anticlockwise",sliderHeight:null,sliderMargin:12,padding:6,layout:null};var fe,ge,ye,be,ve=((ge=function(e,t){var o,i=null,s=document.createElement("div");return function(e,t,o){S(o,e,{},!1,t,!1)}(r(fe,Object.assign({},{ref:function(e){return i=e}},t)),s),o=function(){var t=e instanceof Element?e:document.querySelector(e);t.appendChild(i.base),i.onMount(t)},"loading"!==document.readyState?o():B(document,["DOMContentLoaded"],o),i}).prototype=(fe=me).prototype,Object.assign(ge,fe),ge.__component=fe,ge);return be=[],(ye={Color:he,ColorPicker:ve,ui:{h:r,Component:G,Handle:H,Slider:ue,Wheel:q},util:{resolveUrl:W,createArcPath:V,parseUnit:X,parseHexInt:Y,intToHex:Z},version:"4.5.1"}).use=function(e,t){void 0===t&&(t={}),be.indexOf(e)>-1||(e(ye,t),be.push(e))},ye.installedPlugins=be,ye}));const $_documentContainer$o=html$1`<dom-module id="lumo-dialog" theme-for="vaadin-dialog-overlay">
  <template>
    <style include="lumo-overlay">
      /* Optical centering */
      :host::before,
      :host::after {
        content: "";
        flex-basis: 0;
        flex-grow: 1;
      }

      :host::after {
        flex-grow: 1.1;
      }

      [part="overlay"] {
        box-shadow: 0 0 0 1px var(--lumo-shade-5pct), var(--lumo-box-shadow-xl);
        background-image: none;
        outline: none;
        -webkit-tap-highlight-color: transparent;
      }

      [part="content"] {
        padding: var(--lumo-space-l);
      }

      /* Animations */

      :host([opening]),
      :host([closing]) {
        animation: 0.25s lumo-overlay-dummy-animation;
      }

      :host([opening]) [part="overlay"] {
        animation: 0.12s 0.05s vaadin-dialog-enter cubic-bezier(.215, .61, .355, 1) both;
      }

      @keyframes vaadin-dialog-enter {
        0% {
          opacity: 0;
          transform: scale(0.95);
        }
      }

      :host([closing]) [part="overlay"] {
        animation: 0.1s 0.03s vaadin-dialog-exit cubic-bezier(.55, .055, .675, .19) both;
      }

      :host([closing]) [part="backdrop"] {
        animation-delay: 0.05s;
      }

      @keyframes vaadin-dialog-exit {
        100% {
          opacity: 0;
          transform: scale(1.02);
        }
      }
    </style>
  </template>
</dom-module>`;document.head.appendChild($_documentContainer$o.content);
/**
@license
Copyright (c) 2017 Vaadin Ltd.
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
*/
const $_documentContainer$p=document.createElement("template");$_documentContainer$p.innerHTML='<dom-module id="vaadin-dialog-overlay-styles" theme-for="vaadin-dialog-overlay">\n  <template>\n    <style>\n      /*\n        NOTE(platosha): Make some min-width to prevent collapsing of the content\n        taking the parent width, e. g., <vaadin-grid> and such.\n      */\n      [part="content"] {\n        min-width: 12em; /* matches the default <vaadin-text-field> width */\n      }\n    </style>\n  </template>\n</dom-module>',document.head.appendChild($_documentContainer$p.content);class DialogOverlayElement extends OverlayElement{static get is(){return"vaadin-dialog-overlay"}}customElements.define(DialogOverlayElement.is,DialogOverlayElement);class DialogElement extends(ThemePropertyMixin(ElementMixin$1(PolymerElement))){static get template(){return html$1`
    <style>
      :host {
        display: none;
      }
    </style>

    <vaadin-dialog-overlay id="overlay" on-opened-changed="_onOverlayOpened" with-backdrop="" theme\$="[[theme]]" focus-trap="">
    </vaadin-dialog-overlay>
`}static get is(){return"vaadin-dialog"}static get version(){return"2.2.1"}static get properties(){return{opened:{type:Boolean,value:!1,notify:!0},noCloseOnOutsideClick:{type:Boolean,value:!1},noCloseOnEsc:{type:Boolean,value:!1},ariaLabel:{type:String},theme:String,_contentTemplate:Object,renderer:Function,_oldTemplate:Object,_oldRenderer:Object}}static get observers(){return["_openedChanged(opened)","_ariaLabelChanged(ariaLabel)","_templateOrRendererChanged(_contentTemplate, renderer)"]}ready(){super.ready(),this.$.overlay.setAttribute("role","dialog"),this.$.overlay.addEventListener("vaadin-overlay-outside-click",this._handleOutsideClick.bind(this)),this.$.overlay.addEventListener("vaadin-overlay-escape-press",this._handleEscPress.bind(this)),this._observer=new FlattenedNodesObserver(this,(e=>{this._setTemplateFromNodes(e.addedNodes)}))}_setTemplateFromNodes(e){this._contentTemplate=e.filter((e=>e.localName&&"template"===e.localName))[0]||this._contentTemplate}_removeNewRendererOrTemplate(e,t,o,i){e!==t?this._contentTemplate=void 0:o!==i&&(this.renderer=void 0)}render(){this.$.overlay.render()}_templateOrRendererChanged(e,t){if(e&&t)throw this._removeNewRendererOrTemplate(e,this._oldTemplate,t,this._oldRenderer),new Error("You should only use either a renderer or a template for dialog content");this._oldTemplate=e,this._oldRenderer=t,t&&this.$.overlay.setProperties({owner:this,renderer:t})}disconnectedCallback(){super.disconnectedCallback(),this.opened=!1}_openedChanged(e){e&&(this.$.overlay.template=this.querySelector("template")),this.$.overlay.opened=e}_ariaLabelChanged(e){null!=e?this.$.overlay.setAttribute("aria-label",e):this.$.overlay.removeAttribute("aria-label")}_onOverlayOpened(e){!1===e.detail.value&&(this.opened=!1)}_handleOutsideClick(e){this.noCloseOnOutsideClick&&e.preventDefault()}_handleEscPress(e){this.noCloseOnEsc&&e.preventDefault()}}customElements.define(DialogElement.is,DialogElement);class WcBackdrop extends LitElement{constructor(){super()}static get styles(){return css`
            :host, :host * {
                box-sizing: border-box;
            }
            :host  {
                position: absolute;
                left:0;
                top:0;
                width: 100vw;
                height: 100vh;
                background: rgba(0,0,0,0.5);
                z-index: 89;
            }
        `}render(){return html``}}customElements.define("wc-backdrop",WcBackdrop);const dialogStyles=css`
  :host, :host * {
    box-sizing: border-box; 
  }
  :host  {
    position: absolute;
    background-color: var(--printess-panelBackground);
    box-shadow: black 0 0 10px;
    left: 50%;
    top: 50%;
    transform: translateX(-50%) translateY(-50%);
    overflow: auto;
    max-height: 100vh;
    max-width: 100vw;

    
    font-family: Lato, sans-serif; 
    font-size: var(--printess-textSize);
    color:  var(--printess-textColor); 

    display: grid;
    width: fit-content;
    grid-template-rows: 1fr auto;
    z-index: 100;
}

  .content {
    padding: var(--printess-dialog-padding);
    overflow: auto;
  }

  .footer {                
    display: grid;
    grid-template-columns: 2fr 1fr 1fr;
    column-gap: calc(var(--printess-dialog-padding) / 2);
    padding: var(--printess-dialog-padding);
    border-top: 1px solid var(--printess-textColorDisabled);
  }

  .header {                
    display: grid;
    grid-template-columns: 2fr 1fr 1fr;
    padding: var(--printess-dialog-padding);
    padding-bottom: 25px;
    border-bottom: 1px solid var(--printess-textColorDisabled);
    font-size: var(--printess-headlineSize);
    color: var(--printess-headlineColor);
    
  }

  h1 {
    font-size: var(--printess-headlineSize);
    color: var(--printess-headlineColor);
    margin-top: 20px;
    margin-bottom: 10px;
  }

  p {
    font-size: var(--printess-textSize);
    line-height: 1.4;
    color: var(--printess-textColor);
    margin-top: 10px;
    margin-bottom: 20px;
  }

  p > b {
    color: var(--printess-headlineColor);
  }
`,desktopPropertyStyles=css`
  
    :host {
      display: block;
      width: 100%;
      overflow: hidden; 
    } 

     

   /* :host > *:not(.seperator) {*/
    :host > *:not(.two-cols) {
      /*border-bottom: 20px solid yellow;*/
        margin-bottom: 7px;
    }
    .two-cols > * {
      margin-bottom: 7px;
    }
    .seperator {
      height: 0px;
      opacity: 0.5;
      border-bottom: dashed 1px var(--printess-textColorDisabled);
    }
    p {
      font-size: 12px;
      color: var(--printess-textColor);
      margin: 0px;
      margin-bottom: 3px;
    }
    b {
      background-color: var(--printess-headlineColor);
      color: white;
      padding: 2px;
      padding-left: 6px;
      padding-right: 6px;
      border-radius: 15%;
      box-shadow: 1px 1px 2px 0px rgba(0,0,0,0.75);
      margin-right: 3px;
      margin-left: 3px;

    }
    h5 {
      font-size: 14px;
      color: var(--printess-textColor);
      margin-bottom: 3px;
      margin-top: 2px;
    }
    .section-head {
        font-size: var(--printess-labelSize);
        margin: 0;
        margin-bottom: 10px;
    }
    .two-cols {
      display: grid;
      grid-template-columns: 1fr 1fr;
      grid-column-gap: 5px;
  }
  .two-cols.uneven {
      grid-template-columns: auto 1fr;
      
  }
    .buyer-properties-devider {
        margin-top: 20px;
        margin-bottom: 5px;
        background: var(--printess-headlineColor);
        color:  var(--printess-headlineColorInverse);
        padding: 4px;
        font-size: var(--printess-textSize); /* 16px; */
        text-transform: uppercase;
        letter-spacing: 2px;
    }
    .admin-properties-devider {
        position: relative;
        margin-top: 20px;
        margin-bottom: 5px;
        background: var(--printess-headlineColor);
        color:  var(--printess-headlineColorInverse);
        padding: 2px;
        padding-bottom: 3px;
        font-size: var(--printess-labelSize);  
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    .anchor-grid {
      display: grid;
            
      align-items: stretch;
      align-content: stretch;
      grid-gap: 8px 8px;
      grid-template-rows:   var(--printess-anchor-size)  var(--printess-anchor-size)  var(--printess-anchor-size) ;
      grid-template-columns:    var(--printess-anchor-size)  var(--printess-anchor-size)  var(--printess-anchor-size) ;
                  
      grid-template-areas:  "m_lt m_ct m_rt"
                            "m_lm m_cm m_rm"
                            "m_lb m_cb m_rb";

      margin-top: 10px;                        
    }
    
    .anchor-box {
        grid-column-start: m_lt; 
        grid-column-end: m_rb;
        grid-row-start: m_lt; 
        grid-row-end: m_rb;
        padding: calc(var(--printess-anchor-size) / 2);
    }
    .anchor-box > div {
        border: 1px solid var(--printess-headlineColor); 
        height: 100%;
    }
    .anchor-grid > .checker {
        border: var(--printess-headlineColor) 1px solid;
      border-radius: 10%;
      transition: border-color;
      transition-duration: 0.7s;
      cursor: pointer;
    }
    .anchor-grid > .checker:hover {
         background-color: white;
    }
    
    .anchor-grid >  .on {
        background-color: var(--printess-headlineColor);
    }
    .anchor-grid >  .off {
        background-color: #eee;
    }
    
    .anchor-grid > .checker.on:hover {
        background-color: var(--printess-headlineColorHover);
    }
    
    .anchor-grid > .mixed {
        background-color: #ddd;
    }
    .anchor-grid > .null {
        background-color: yellow;
    }
`,desktopBuyerGroupStyles=css`
  
    :host {
      display: block;
      width: 100%;
      overflow: hidden; 
    } 
   /* :host > *:not(.seperator) {*/
    :host > *:not(.two-cols) {
      /*border-bottom: 20px solid yellow;*/
        margin-bottom: 7px;
    }
    .two-cols > * {
      margin-bottom: 7px;
    }
    .seperator {
      height: 0px;
      opacity: 0.5;
      border-bottom: dashed 1px var(--printess-textColorDisabled);
    }
    p {
      font-size: 12px;
      color: var(--printess-textColor);
      margin: 0px;
      margin-bottom: 3px;
    }
    b {
      background-color: var(--printess-headlineColor);
      color: white;
      padding: 2px;
      padding-left: 6px;
      padding-right: 6px;
      border-radius: 15%;
      box-shadow: 1px 1px 2px 0px rgba(0,0,0,0.75);
      margin-right: 3px;
      margin-left: 3px;

    }
    h5 {
      font-size: 14px;
      color: var(--printess-textColor);
      margin-bottom: 3px;
      margin-top: 2px;
    }
    .section-head {
        font-size: var(--printess-labelSize);
        margin: 0;
        margin-bottom: 10px;
    }
    .two-cols {
      display: grid;
      grid-template-columns: 1fr 1fr;
      grid-column-gap: 5px;
  }
    .two-cols.uneven {
      grid-template-columns: auto 1fr;
      
  }
    .header-bar {
        display: grid;
        grid-template-columns: auto 1fr auto;
        align-items: center;

        margin-top: 20px;
        margin-bottom: 5px;
        background: var(--printess-headlineColor);
       
        padding: 4px;
       
    }
    .header-bar-title {
      font-size: var(--printess-textSize); /* 16px; */
      text-transform: none;
      letter-spacing: 0px;
      color: var(--printess-headlineColorInverse);
    }
    .header-button {
      grid-column: 3;
      border: 1px solid var(--printess-headlineColorInverse);
      cursor: pointer;
      display: flex;
      align-items: center;
      flex-direction: row;
    } 
    .header-button:hover {
      background-color: rgba(0,0,0,0.1);
    }
    .header-button-icon {
      padding: 2px;
      width: 24px;
      height: 24px;
      font-size: var(--printess-textSize); /* 16px; */
      text-transform: uppercase;
      color:  var(--printess-headlineColorInverse);
    }
    .header-button-text {
      padding: 2px 6px;
      font-size: var(--printess-textSize); /* 16px; */
      text-transform: none;
      letter-spacing: 0px;
      color:  var(--printess-headlineColorInverse);
    }


    /****** IMAGE PROPERTIES ******/

    .image-property-grid {
      display: grid;
      grid-template-columns: auto 1fr;
      grid-column-gap: 15px;
      align-items: center;
    }
    
    .image-property-caption {
      color: var(--printess-headlineColor);
      font-size: 14px; 
      font-weight: bold;
    }

    .image-property-container {
      display: flex;
      flex-wrap: wrap;
    }

    .image-property-button {
      margin: 5px;
      padding: 3px;
      background-color:  var( --printess-fatButtonBackgroundSelected);
      color:  var(--printess-fatButtonForeground);
      border-radius: 2px;
      cursor: pointer;
      display: flex;
      align-items: center;
      flex-direction: row;
    } 
    
    .image-property-button-icon {
      padding: 2px;
      width: 24px;
      height: 24px;
      font-size: var(--printess-textSize); /* 16px; */
      fill:  var(--printess-fatButtonForeground);
    }
    .image-property-button-text {
      padding: 2px 6px;
      font-size: var(--printess-textSize); /* 16px; */
      text-transform: none;
      letter-spacing: 0px;
      color:  var( --printess-fatButtonForeground);
    } 

    .image-property-button.sepia > * {
      color: #a39775;
      fill: #a39775;
    }
    .image-property-button.enhance > * {
      color: #7b658b;
      fill: #7b658b;
    }


    .image-property-button:hover {
      background-color: var(--printess-headlineColor);
    }
    .image-property-button:hover > * {
      color: var(--printess-headlineColorInverse);
      fill: var(--printess-headlineColorInverse);
    }
    
   /* .image-property-button.sepia:hover > * {
      color: #746b53;
      fill: #746b53;
    }*/
  
   /* .image-property-button.enhance:hover > * {
      color: #544560;
      fill: #544560;
    }*/
   
    


    .color-list {
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;
    }
    .color-list > * {
      margin: 4px;
    }
    
    .admin-properties-devider {
        position: relative;
        margin-top: 20px;
        margin-bottom: 5px;
        background: var(--printess-headlineColor);
        color:  var(--printess-headlineColorInverse);
        padding: 2px;
        padding-bottom: 3px;
        font-size: var(--printess-labelSize);  
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    .anchor-grid {
      display: grid;
            
      align-items: stretch;
      align-content: stretch;
      grid-gap: 8px 8px;
      grid-template-rows:   var(--printess-anchor-size)  var(--printess-anchor-size)  var(--printess-anchor-size) ;
      grid-template-columns:    var(--printess-anchor-size)  var(--printess-anchor-size)  var(--printess-anchor-size) ;
                  
      grid-template-areas:  "m_lt m_ct m_rt"
                            "m_lm m_cm m_rm"
                            "m_lb m_cb m_rb";

      margin-top: 10px;                        
    }
    
    .anchor-box {
        grid-column-start: m_lt; 
        grid-column-end: m_rb;
        grid-row-start: m_lt; 
        grid-row-end: m_rb;
        padding: calc(var(--printess-anchor-size) / 2);
    }
    .anchor-box > div {
        border: 1px solid var(--printess-headlineColor); 
        height: 100%;
    }
    .anchor-grid > .checker {
        border: var(--printess-headlineColor) 1px solid;
      border-radius: 10%;
      transition: border-color;
      transition-duration: 0.7s;
      cursor: pointer;
    }
    .anchor-grid > .checker:hover {
         background-color: white;
    }
    
    .anchor-grid >  .on {
        background-color: var(--printess-headlineColor);
    }
    .anchor-grid >  .off {
        background-color: #eee;
    }
    
    .anchor-grid > .checker.on:hover {
        background-color: var(--printess-headlineColorHover);
    }
    
    .anchor-grid > .mixed {
        background-color: #ddd;
    }
    .anchor-grid > .null {
        background-color: yellow;
    }


    .imageListWrapper {
        display: block;
        width: 100%;
        overflow-x: auto;
        padding-bottom: 22px; /* because of scrollbar */
    }
    .imageList {
        display: flex;
        flex-direction: row;
        flex-wrap: nowrap;
        margin: -2px;
    }
    .imageItem {
        display: grid;
        grid-template-columns: 70px;
        grid-template-rows: 70px;
        margin: 2px;
        cursor: pointer;
    }

    .small-image-list {
        height: 70px;
        overflow: hidden;
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
        margin: 2px;
    }
    .small-image-item {
        width: 33px;
        height: 33px;
        margin-right: 2px;
        margin-bottom: 2px;
        cursor: pointer;
    }
   
    .imageBox {
        width: 100%;  
        height: 100%;
      
        background-size: cover;
        border: 1px solid  var(--printess-textColor);
        border-radius: 3px;
        background-color: #bbb;
     } 
     .imageBox:hover {
      border: 1px solid  var(--printess-headlineColor);
     }
     .imageBox.selected {
        border: 2px solid  var(--printess-headlineColor);
    }
    .imageName {
        font-size: 9px;
        text-overflow: ellipsis;
        width: 100%;
        overflow:hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        text-align: center;
    }   

    .image-upload .progress {
      width: 250px; 
      border: 1px solid black; 
      height: 22px;
    }
    .image-upload-progress > div {
      background: var(--printess-headlineColor); 
      height: 100%; 
      color: var(--printess-headlineColorInverse);
      text-align: center;
      padding: 2px;
    }
    @media (max-width: ${config.mobileDeviceWidth}px) {
      .small-image-list {
        height: 70px;
        overflow: hidden;
        display: flex;
        flex-direction: row;
        flex-wrap: nowrap;
        margin: 2px;
      }
      .small-image-item {
          width: 60px;
          height: 60px;
          margin-right: 2px;
          margin-bottom: 2px;
          cursor: pointer;
      }
    }
`,masterStyles=css` 

:root {
    --printess-properties-width: 442px;
    --printess-resourcebar-width: 32px;
    --printess-toolbar-width: 38px;
    --printess-open-toolbar-width: 72px;
    --printess-top-tabs-height: 36px;
    --printess-dialog-padding: 20px;

    --printess-anchor-size: 10px; /* small boxes in anchor grid */

    /**** PATH EDITOR  ******/
    --printess-path-editor-cover-bg: rgba(0,0,0,0.1);
    --printess-path-editor-cover-border: 1px solid rgba(0,0,0,0.5);
    --printess-path-editor-path-color: #21b7ff;
    --printess-path-editor-disabled-path-color: #bbbbbb;

    /**** Z-INDEX *****/
    --printess-z-index-context-menu: 9990;
    --printess-z-index-box-drag: 9985;
    --printess-z-index-box-selection: 9980;
    --printess-z-index-click-action-boxes: 9975;
    --printess-z-index-page-border: 9970;
    --printess-z-index-pasteboard: 9960;
    --printess-z-index-bleed: 9962;
    
    

    /*** FRAME  ***/
    --printess-frame-mover-size: 5px;
    --printess-extra-mover-catch-offset: -14px;

    --printess-cropper-large-side: 15px;
    --printess-cropper-small-side: 5px;
    --printess-annotationColor: DarkSlateBlue;
    --printess-rubberBandColor: red;

    --printess-resource-toolbar-width: 32px;
    --printess-resource-panel-initial-width: 200px;

    /* Mobile buyer side */ 

    /***** FORM PADDING *****/
    --printess-input-top-padding: 0; /*8px;*/ 
 
    /***** TEXT SIZE *****/
    --printess-annotationSize: 10px;
    --printess-labelSize: 11px;
    --printess-inputSize: 12px;
    --printess-textSize: 14px;
    --printess-headlineSize: 20px;
 
    /****** HEAD-TOOLBAR *******/ 
    --printess-headToolbarColor: white;
    --printess-headToolbarColorHover: #eee;
    --printess-headToolbarBackgroundColor:   rgb(150, 150, 150);
    --printess-headToolbarBorderColor:   #444444; 


    /*** VAADIN COLOR MAPPING ***/
    --lumo-primary-text-color: var(--printess-headlineColor);
    --lumo-primary-color: var(--printess-headlineColor);
    --lumo-secondary-text-color: var(--printess-textColor) ;
    --lumo-disabled-text-color: var(--printess-textColorDisabled);  
    --lumo-body-text-color: var(--printess-inputColor);
    --lumo-base-color: var(--printess-panelBackground);
    --lumo-contrast-60pct: var(--printess-textColor);
    --lumo-contrast-5pct: var(--printess-inputBackgroundDisabled); /* input disabled background color */ 
    --lumo-contrast-10pct: var(--printess-inputBackground); /*rgba(255,255,255,0.2);*/ /* input background-color */
    --lumo-contrast-20pct: var(--printess-radioBackground); /*rgba(255,255,255,0.2);*/ /* input background-color used in radio buttons */
    --lumo-contrast-30pct: var(--printess-radioBackgroundHover); /*rgba(255,255,255,0.2);*/ /* input background-color used in radio buttons */

    --lumo-space-m: var(--printess-input-top-padding); /* padding-top of vaadin-text-box */
    --vaadin-text-field-default-width: 50px; /* make smaller to addopt to 100% later */

    /*input and button captions */ 
    --lumo-font-size-s: var(--printess-inputSize); /* input box size */
    --lumo-font-size-m:  var(--printess-inputSize); /* select-box does not react to theme=small */
    /*labels*/
    --lumo-font-size-xs:  var(--printess-labelSize); 

   



    /* MOBILE THEME DEFAULT */ 
    --printess-maxContrastColor: white;
    --printess-maxContrastColorInverse: black;
   
    /****** TEXT COLORS ********/
    --printess-headlineColor: #ff82d7;  
    --printess-headlineColorInverse: white;  
    --printess-headlineColorHover: #ffbeea;  

    --printess-textColor:#fff;
    --printess-textColorDisabled: #ddd;
    --printess-textColorHover: #fff;
    
    --printess-inputColor: white;
    --printess-inputColorLight: yellow; /*rgb(200,200,200); */
    --printess-inputBackground: rgba(255, 255, 255, 0.1);
    --printess-radioBackground: rgba(255, 255, 255, 0.2);
    --printess-radioBackgroundHover: rgba(255, 255, 255, 0.3);
    --printess-inputBackgroundDisabled: rgba(255, 255, 255, 0.05); 

    /****** FAT-BUTTON *****/
    --printess-fatButtonBackground: var(--printess-panelBackground);
    --printess-fatButtonBackgroundHover: var( --panelBackgroundHover:);
    --printess-fatButtonBackgroundSelected: var(--printess-panelBackgroundSelected);
    --printess-fatButtonForeground: var(--printess-textColor);
    --printess-fatButtonForegroundSelected: var(--printess-headlineColor);

     /****** SIDE-TOOLBARs *******/ 
    --printess-toolbarColor:  #fff;
    --printess-toolbarColorHover: #fff;
    --printess-toolbarBackgroundSelected: #000;
    --printess-toolbarBackground: #333; 
    --printess-toolbarBackgroundHover: #222;
    --printess-toolbarBorderColor:  Indigo; /* black */

     /*** PANEL COLORS ***/
    --printess-panelBackground: #15518e; //   hsl(214, 90%, 52%);  
    --printess-panelBackgroundSelected: #2a2a2a;
    --printess-panelAnchorMixed: #934a7c;
    --printess-panelBackgroundHover: #222;


    --printess-slider-rail: hsl(216, 85%, 68%);

    --printess-frameColor: #21b7ff;
    --printess-frameColorHover:  #1ca0df;
     
}



/* DESKTOP / TABLET STYLES */

@media (min-width:  ${config.mobileDeviceWidth+1}px)   {
  :root {
      --printess-extra-mover-catch-offset: -2;
      --printess-frame-mover-size: 4px; 
  }
}

@media (min-width:  ${config.mobileDeviceWidth+1}px) AND (prefers-color-scheme: dark) {
  :root {

      --printess-maxContrastColor: white;
      --printess-maxContrastColorInverse: black;
  
      /****** TEXT COLORS ********/
      --printess-headlineColor: #ff82d7;  
      --printess-headlineColorInverse: white;  
      --printess-headlineColorHover: #ffbeea;  

      --printess-textColor: #eee;
      --printess-textColorDisabled: #aaa;
      --printess-textColorHover: #fff;
      
      --printess-inputColor: white;
      --printess-inputColorLight: yellow; /*rgb(200,200,200); */
      --printess-inputBackground: rgba(255, 255, 255, 0.1);
      --printess-radioBackground: rgba(255, 255, 255, 0.2);
      --printess-radioBackgroundHover: rgba(255, 255, 255, 0.3);
      --printess-inputBackgroundDisabled: rgba(255, 255, 255, 0.05); 

      /****** FAT-BUTTON *****/
      --printess-fatButtonBackground: var(--printess-panelBackground);
      --printess-fatButtonBackgroundHover: var( --panelBackgroundHover:);
      --printess-fatButtonBackgroundSelected: var(--printess-panelBackgroundSelected);
      --printess-fatButtonForeground: var(--printess-textColor);
      --printess-fatButtonForegroundSelected: var(--printess-headlineColor);

       /****** SIDE-TOOLBARs *******/ 
      --printess-toolbarColor:  #aaa;
      --printess-toolbarColorHover: #ccc;
      --printess-toolbarBackgroundSelected: #000;
      --printess-toolbarBackground: #333; 
      --printess-toolbarBackgroundHover: #222;
      --printess-toolbarBorderColor:  Indigo; /* black */

       /*** PANEL COLORS ***/
      --printess-panelBackground: #444;
      --printess-panelBackgroundSelected: #2a2a2a;
      --printess-panelAnchorMixed: #934a7c;
      --printess-panelBackgroundHover: #222;
 
      --printess-slider-rail: var(--printess-textColor);
  }
 
}

@media (min-width:  ${config.mobileDeviceWidth+1}px) AND (prefers-color-scheme: light) {
  :root {

    --printess-maxContrastColor: black;
    --printess-maxContrastColorInverse: white;

    /****** TEXT COLORS ******* */
    --printess-headlineColor: #f22c87;  
    --printess-headlineColorInverse: white;  
    --printess-headlineColorHover: #a81f5e;  

    --printess-textColor:  rgba(27, 43, 65, 0.72); 
    --printess-textColorHover:  rgba(27, 43, 65, 0.85); 
    --printess-textColorDisabled:   rgba(27, 43, 65, 0.6); 
    --printess-textColorDisabledHover:   rgba(27, 43, 65, 0.75); 
    --printess-textColorLight:   rgba(27, 43, 65, 0.2); 
    --printess-textColorLightHover:   rgba(27, 43, 65, 0.35); 
    

    --printess-inputColor: black;
    --printess-inputColorLight: #444; 
    --printess-inputBackground: rgba(0, 0, 0, 0.10);
    --printess-radioBackground: rgba(0, 0, 0, 0.20);
    --printess-radioBackgroundHover: rgba(0, 0, 0, 0.30);
    --printess-inputBackgroundDisabled: rgba(0, 0, 0, 0.05);

    /****** FAT-BUTTON *****/
    --printess-fatButtonBackground: transparent;
    --printess-fatButtonBackgroundHover: rgba(255,255,255,0.5);
    --printess-fatButtonBackgroundSelected: rgba(255,255,255,1);
    --printess-fatButtonForeground: var(--printess-textColor);
    --printess-fatButtonForegroundSelected: var(--printess-headlineColor);

    /****** SIDE-TOOLBARs *******/ 
    --printess-toolbarColor:  #555;
    --printess-toolbarColorHover: #333;
    --printess-toolbarBackgroundSelected: white;;
    --printess-toolbarBackground:   #ddd;
    --printess-toolbarBackgroundHover: #eee;
    --printess-toolbarBorderColor:  black;
    --printess-toolbarButtonBackground:  rgb(141, 141, 141);
    --printess-toolbarButtonBackgroundHover:  #444;
    --printess-toolbarButtonText:   #fff;

    /*** PANEL COLORS ***/
    --printess-panelBackground:  #eee; 
    --printess-panelBackgroundSelected: #fff;
    --printess-panelAnchorMixed: #fd8cc0;
    --printess-panelBackgroundHover: #fff;
    --printess-panelBackgroundSelectedHover: #fef;
        
    --printess-slider-rail: var(--printess-textColor);
  }
}

  

*, *:before, *:after {
    box-sizing: border-box;
}
h1 {
  color: var(--printess-headlineColor);
}
h2 {
  color: red; 
}
#mainGrid {
    background: var(--printess-panelBackground); /* #727272;*/
    font-family: Lato, sans-serif; 
    font-size: var(--printess-textSize);
    overflow: hidden;
    margin: 0;
    padding: 0;
    color:  var(--printess-textColor); 
    opacity: 0; /* until loaded */
}

.printess-container-fullscreen {
  position: absolute !important;
  left: 0 !important;
  top: 0 !important;
  width: initial !important;
  height: initial !important;
  right: 0 !important;
  bottom: 0 !important;
}

#copyPasteIndicator {
    background-color: black;
    position: absolute;
    left: 0;
    top: 0;
    right: 0;
    bottom: 0;
    display: none;
    opacity: 0.25;
}

#clipboard-container {
    height: 16px;
    width: 50px;
    position: absolute;
   right: 100px;;
    top: 0
}
 


/*
 ************** MAIN LAYOUT GRID  *******************
 */


#mainGrid {
    transform: none;
    position: relative;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;

    /*width: 100vw;
    height: 100vh;*/
   /* background-color: transparent;*/
    display: grid;
    grid-gap: 0;
    grid-template-rows: 0px 36px auto 100px;
    grid-template-columns: 1fr;
    grid-template-areas: 'doc-selector' 'toolbar' 'stage' 'properties';
}

#mainGrid.hide-controls {
    grid-template-areas: 'stage';
    grid-template-rows: 1fr;
    grid-template-columns: 1fr;
}
#mainGrid.hide-controls > .doc-selector,
#mainGrid.hide-controls > .toolbar,
#mainGrid.hide-controls > .ressources,
#mainGrid.hide-controls > .properties,
#mainGrid.hide-controls > .buyerPages,
#mainGrid.hide-controls > .dataPanel,
#mainGrid.hide-controls > #footer,
#mainGrid.hide-controls > #resourcesSplitterBar,
#mainGrid.hide-controls > #propertiesSplitterBar
{
  display: none !important;
}

#dataPanel {
  border-top: 1px solid black;
  grid-area: data;
    height: inherit;
}

#resources {
    grid-area: resources;
    display: none;
    height: 100%;
    background: var(--printess-panelBackground);
}

#propertiesSplitterBar {
    grid-area: propertiesSplitterBar;
}

#resourcesSplitterBar {
    grid-area: resourcesSplitterBar;
    display: none;
}
#mainGrid.admin > #resourcesSplitterBar {
    display: block;
}

#resourcesSplitterBar, #propertiesSplitterBar {
    background-color: black; /* loooks better in dark and light mode var(--printess-maxContrastColor); */
    cursor: ew-resize;
    position: relative;
    display: none;
}

#resourcesSplitterBar::after, #propertiesSplitterBar::after {
    content: "";
    position: absolute;
    background-color: transparent;
    width: 7px;
    left: -3px;
    top: 0;
    bottom: 0;
    cursor: ew-resize;
}

#toolbar {
    grid-row: 2;
    height: 100%;
    width: 100%;
    grid-area: toolbar;
}
#docSelector {
    grid-row: 1;
    grid-area: doc-selector;
    display: none;
}

#stage {
    grid-area: stage;
    height: 100%;
    overflow: hidden;
    background: #4e4e50;
    position: relative;
}

#stage > .content {
    width: 1200px;
    height: 1200px;
    position: relative;
    /* background: white;*/
}


#properties {
    grid-area: properties;
    height: 100%;
    background: var(--printess-panelBackground);
    position: relative;
}

#buyerPages {
    grid-area: pages;
    height: 100%;
    display: none;
    background: var(--printess-panelBackground);
}
#mainGrid.buyer > #buyerPages {
    display: block;
}



#footer {
    background-color: lightblue;
    grid-area: footer;
}

@media (min-width:  ${config.mobileDeviceWidth+1}px) {
    #docSelector   {
        display: block;
    }

    #mainGrid.admin {
        grid-template-areas:
                'doc-selector doc-selector        doc-selector    doc-selector     doc-selector'
                'toolbar      toolbar     toolbar toolbar      toolbar'
                'resources resourcesSplitterBar stage propertiesSplitterBar properties'
                'data    data      data   data       data'
                'footer    footer      footer  footer       footer';

        grid-template-rows: 0px 36px auto 0px;
        grid-template-columns: 200px 1px 1fr 1px 200px;
    }
    
    #mainGrid.buyer {
        grid-template-areas:
                'doc-selector       doc-selector            doc-selector'
                'toolbar            toolbar                 toolbar'
                'stage              propertiesSplitterBar   properties'
                'pages              propertiesSplitterBar   properties'
                'footer             footer                  footer';

        grid-template-rows: 0px 36px auto 120px 0px;
        grid-template-columns: 200px 1px 1fr 1px 200px;
    }

   

    #mainGrid.admin > #resources, #mainGrid.admin > #resourcesSplitterBar {
        display: block;
    }
    #propertiesSplitterBar {
        display: block;
    }
}

 /*
 ******** SAFARI WEB APP NOTIFICATION 
 */
 #webAppNotification {
  z-index: 99999;
  display: none;
  position: absolute;
  bottom: 30px;
  left: 5%;
  right: 5%;
  height: 80px;
  padding: 7px;
  border-radius: 3px;
  background-color: #f7f8ef; /* ED6BB8FF*/ 
  color:  black;
  text-align: center;
  font-size: 14px;
  line-height: 1.2;
  box-shadow: 0px 5px 10px black;
} 

/* Triangle hack to make tooltip look like a speech bubble */
#webAppNotification:after {
  position: absolute;
  bottom: -20px;
  left: 50%;
  margin-left: -5px;
  width: 0;
  border-top: 20px solid #f7f8ef;
  border-right: 20px solid transparent;
  border-left: 20px solid transparent;
  content: " ";
  font-size: 0;
  line-height: 0;
  
}
#webAppNotification > .closeAppNotification {
  position: absolute;
  cursor: pointer;
  left: 4px;
  top: 4px;
  text-decoration: underline; 
  color: darkblue;
}
#webAppNotification > .closeAppNotification:hover {
  color: red;
}



/*
 ************** CONTEXT MENU AND TOAST************
 */



.toastwrp {
    position: absolute;
    top: 0px;
    right: 0px;
    left: 0px;
    bottom: 0px;
    overflow: hidden;
    z-index: -999;
}
.toast {
    position: absolute;
    border-radius: 3px;
    padding: 5px;
    background-color: rgba(0, 0, 0, 0.43);
    color: rgba(255, 255, 255, 0.84);
    animation-name: toast;
    animation-duration: 1s;
    animation-iteration-count: 1;
    transition-timing-function: cubic-bezier(0.27, 0.81, 0.86, 1.37);
}
@keyframes toast {
    0% {
        top: 100vh;
    }
    30% {
        top: 90vh;
    }
    80% {
        opacity: 1;
    }
    100% {
        opacity: 0;
        top: 90vh;
    }
}


/* BASIC MENU */
.ctxMenu, .revCtxMenu, .subMenu {
    cursor: pointer;
    position: absolute;
    border-radius: 2px;
    width: 150px;
    height: 200px;
    background-color: var(--printess-panelBackground);
    box-shadow: 0px 1px 3px rgba(0, 0, 0, 0.05) inset, 0px 0px 4px #555;
    animation-duration: 0.2s;
    animation-iteration-count: 1;
    transition: 0.2s;
    font-family: Lato, sans-serif; 
}
.ctxMenuItem {
    position: relative;
    display: grid;
    grid-template-columns: 24px 1fr 24px;
    grid-template-rows: 28px;
    list-style-type: none;
    align-items: stretch;
    justify-content: stretch;
    width: 100%;
  
}
.ctxMenuItemSeperator {
    display: block;
    width: 100%;
    height: 1px;
    background-color: var(--printess-textColorDisabled);
    margin-top: 3px;
    margin-bottom: 3px;
}

.ctxMenuItem > .ctxMenuCaption {
  color: var(--printess-textColor);
  white-space: nowrap;
  align-self: center;
  font-size: var(--printess-inputSize);
  padding-left: 10px;
}

.ctxMenuItem > wc-icon {
   width: 16px;
   height: 16px; 
   align-self: center;
   justify-self: center;
}
.ctxMenuItem > wc-icon.arrow {
   width: 14px;
   height: 14px;
   align-self: center;
   justify-self: center;
}
.ctxMenuItem > .color {
   width: 16px;
   height: 16px;
   align-self: center;
   justify-self: center;
}

.ctxMenuItem.disabled > .ctxMenuCaption{
    color: var(--printess-textColorDisabled);
}
.ctxMenuItem:hover {
    background-color: var(--printess-headlineColor);
}
.ctxMenuItem:hover > .ctxMenuCaption, .ctxMenuItem:hover > wc-icon {
    color: #fff;
}
 .ctxMenuItem.disabled:hover {
    background-color: transparent; 
    
}
 .ctxMenuItem.disabled:hover > .ctxMenuCaption{
     color: var(--printess-textColorDisabled);
}

.ctxMenu:hover, .revCtxMenu:hover, .subMenu:hover {
    box-shadow: 1px 2px 5px rgba(0, 0, 0, 0.05) inset, 0px 4px 8px #555;
}

ul {
    margin: 0;
    padding: 0;
    text-align: left;
}

.ctxMenu {
    animation-name: appear;
    z-index: var(--printess-z-index-context-menu);
}
.revCtxMenu {
    animation-name: revappear;
}
.subMenu {
    height: 175px;
    display: none;
    overflow: auto;
    box-shadow: 1px 2px 5px rgba(0, 0, 0, 0.05) inset, 0px 4px 8px #555;
}
.subMenu:hover {
    display: block;
}
.red-line {
    position: absolute;
    height: 3px;
    width: 25px;
    top: 12px;
    left: 1px;
    transform-origin: 50% 50%;
    transform: rotate(45deg);
    background-color: red;
}
@keyframes appear { 
    0% {
        transform: scale(0.1) translateX(-100px);
    }
    100% {
        transform: scale(1) translateX(0px);
    }
}
@keyframes revappear {
    0% {
        transform: scale(0.1) translateX(100px);
    }
    100% {
        transform: scale(1) translateX(0px);
    }
}
`;var __awaiter$7=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};class Point$1{constructor(e,t){this.x=e,this.y=t}add(e,t){return new Point$1(this.x+e,this.y+t)}multiply(e){return new Point$1(this.x*e,this.y*e)}}class Quadrangle{constructor(e,t,o,i){this.topLeft=e,this.topRight=t,this.bottomLeft=o,this.bottomRight=i}map(e,t){const o=this.topLeft.multiply((1-e)*(1-t)),i=this.topRight.multiply(e*(1-t)),r=this.bottomLeft.multiply((1-e)*t),s=this.bottomRight.multiply(e*t);return new Point$1(0,0).add(o.x,o.y).add(i.x,i.y).add(r.x,r.y).add(s.x,s.y)}static fromFourPoints(e){const t=e.map((e=>e/1e3)),o=t[0],i=t[1],r=t[2],s=t[3],n=t[4],a=t[5],l=t[6],c=t[7];return new Quadrangle(new Point$1(o,i),new Point$1(r,s),new Point$1(l,c),new Point$1(n,a))}}function getNewSpreads(e,t){const o=new Map;for(const i of scope().currentDoc.spreads.values()){const r=[];for(let o=0;o<i.pages.length;o++)r.push(new BoxGeometry(o*e,0,e,t));const s=new Spread((new Nobs).replaceCollection(i.pages,r),i);o.set(i.id,s)}return o}function setDocumentSize(e,t,o,i){const r=new Nobs;r.setProperty(e,"pageWidth",t),r.setProperty(e,"pageHeight",o),r.setProperty(e,"unit",i),r.replaceCollection(e.spreads,getNewSpreads(t,o));const s=new Doc(r,e);update([e.serialize(scope().id)],[s.serialize(scope().id)])}function setAnchorValue(e,t,o){if(!e)throw"setMoverAnchorValue: boxRef is null";const i=[],r=[],s="anchor"+t;let n=e.box;const a=new Nobs,l=e.box.boxGeometry.moverAnchor,c=l.substr(0,1),d=l.substr(1,1);let h=l.substr(0,1),p=l.substr(1,1),u=l.substr(0,1),m=l.substr(1,1);const f=o&&("Right"===t&&n.boxGeometry.anchorLeft||"Left"===t&&n.boxGeometry.anchorRight),g=o&&("Top"===t&&n.boxGeometry.anchorBottom||"Bottom"===t&&n.boxGeometry.anchorTop),y=!(o||"Right"!==t&&"Left"!==t||n.boxGeometry.hasWidth()),b=!(o||"Top"!==t&&"Bottom"!==t||n.boxGeometry.hasHeight()),v=!o&&"Right"===t&&n.boxGeometry.anchorRight,x=!o&&"Left"===t&&n.boxGeometry.anchorLeft,w=!o&&"Bottom"===t&&n.boxGeometry.anchorBottom;if(x&&("l"!==c&&(h="l"),u="r"),v&&!y&&("r"!==c&&(h="r"),u="l"),!o&&"Top"===t&&n.boxGeometry.anchorTop&&("t"!==d&&(p="t"),m="b"),w&&!b&&("b"!==d&&(p="b"),m="t"),f&&(n.boxGeometry.anchorRight&&"r"!==c&&(h="r"),n.boxGeometry.anchorLeft&&"l"!==c&&(h="l"),u="l"),g&&(n.boxGeometry.anchorBottom&&"b"!==d&&(p="b"),n.boxGeometry.anchorTop&&"t"!==d&&(p="t"),m="t"),l!==h+p){const t=BoxGeometry.getRotationPositionX(n.boxGeometry.moverAnchor),o=BoxGeometry.getRotationPositionY(n.boxGeometry.moverAnchor),i=BoxGeometry.getRotationPositionX(h+p),r=BoxGeometry.getRotationPositionY(h+p),s=0,a=changeAnchor(n.boxGeometry.toPixel(e.spread.width(),e.spread.height()),s,t,o,i,r),l=n.boxGeometry.fromPixel(e.spread.width(),e.spread.height(),a.left,a.top,a.width,a.height,s,!1),c=new Nobs;c.setProperty(n,"boxGeometry",l),n=new Box(c,n)}a.setProperty(n.boxGeometry,"moverAnchor",u+m),a.setProperty(n.boxGeometry,"rotation",0),(g||f)&&n.imageRef&&a.setProperty(n.imageRef,"imagePlacement","fill"),a.setProperty(n.boxGeometry,s,o),!1===o&&("Top"===t&&!1===n.boxGeometry.anchorBottom&&a.setProperty(n.boxGeometry,"anchorBottom",!0),"Bottom"===t&&!1===n.boxGeometry.anchorTop&&a.setProperty(n.boxGeometry,"anchorTop",!0),"Left"===t&&!1===n.boxGeometry.anchorRight&&a.setProperty(n.boxGeometry,"anchorRight",!0),"Right"===t&&!1===n.boxGeometry.anchorLeft&&a.setProperty(n.boxGeometry,"anchorLeft",!0));let _=new Box(a,n);return _.boxGeometry.anchorRotation&&!_.boxGeometry.hasAnchorRotation()&&(_=new Box((new Nobs).setProperty(_.boxGeometry,"anchorRotation",0),_)),i.push(e.box.serialize(e.spread.id,e.doc.id)),r.push(_.serialize(e.spread.id,e.doc.id)),update(i,r)}function addSimpleText(e,t,o,i,r,s,n){return __awaiter$7(this,void 0,void 0,(function*(){const a={left:e,top:t,width:o,height:i};yield scope().createNewBox(a,boxTypeE.text,void 0,void 0,r);const l=scope().lastCreatedBoxIds[0],c=scope().getBox(l),d=scope().fonts_get((e=>e.id==s));if(d&&c){const e=new Nobs,t=new FontRef(d);if(e.setProperty(c.box.simpleText,"font",t),n){const t=ImageRef.createImageRef(n,c.box.getImagePosition(n),"simpleText");e.setProperty(c.box,"imageRef",t)}const o=new Box(e,c.box);yield update([c.box.serialize(c.spread.id,c.doc.id)],[o.serialize(c.spread.id,c.doc.id)])}}))}function addImage(e,t){return __awaiter$7(this,void 0,void 0,(function*(){const o=new Image$1(generateDBID(),e.url,e.name,e.width,e.height,"uploaded",e.scaledImages,"design",t),i={left:0,top:0,width:e.width,height:e.height};yield scope().createNewBox(i,boxTypeE.image,void 0,void 0,void 0,void 0,o)}))}function sleep(e){return new Promise((t=>setTimeout(t,e)))}const blurMultiplier=.1,spreadMultiplier=.08;function go(e){return __awaiter$7(this,void 0,void 0,(function*(){if(e){const t=yield fetch("https://printess-dev.s3.eu-central-1.amazonaws.com/project1/replay/"+e+".json?_="+dateString()),o=yield t.json();let i=e,r=.001;const s={};{const e=new Nobs;e.setProperty(scope().docUi.doc.lock,"allowAdd",["images"]);const t=new Doc(e,scope().docUi.doc);yield update([scope().docUi.doc.serialize(scope().id)],[t.serialize(scope().id)]),yield sleep(0)}const n={},a={};for(const e of o)switch(yield sleep(0),e.command){case"info":console_log("source: "+e.name),i="ps_"+e.name;break;case"fgimage":case"bgimage":{const t="fgimage"==e.command?.4714:.4713;setDocumentSize(scope().currentDoc,e.width,e.height,"px"),yield addImage(e,t);const o=scope().lastCreatedBoxIds[0];yield setAnchorValue(scope().getBox(o),"Right",!0),yield setAnchorValue(scope().getBox(o),"Bottom",!0);const i=scope().getBox(o);if(i){const e=new Nobs;e.setProperty(i.box.basics,"lockBox",!0),e.setProperty(i.box.imageRef,"imagePlacement","fit"),e.setProperty(i.box.imageRef,"verticalFocalPoint",0),e.setProperty(i.box.imageRef,"horizontalFocalPoint",.5);const t=new Box(e,i.box);yield update([i.box.serialize(i.spread.id,i.doc.id)],[t.serialize(i.spread.id,i.doc.id)]),yield sleep(0)}}break;case"image":{const t=new Image$1(generateDBID(),e.image.url,e.image.name,e.image.width,e.image.height,"uploaded",e.image.scaledImages,"Placeholder Images",r);r+=.001;const o={left:e.left,top:e.top,width:e.width,height:e.height};yield scope().createNewBox(o,boxTypeE.image,void 0,void 0,void 0,void 0,t);const i=scope().lastCreatedBoxIds[0],s=scope().getBox(i),n=scope().docUi.getWcBox(i);if(s){const t=new Nobs;if(e.useGrid&&(t.setProperty(s.box.imageRef,"imagePlacement","crop"),t.setProperty(s.box.imageRef,"imageXPosition",e.image.left/e.width),t.setProperty(s.box.imageRef,"imageYPosition",e.image.top/e.height),t.setProperty(s.box.imageRef,"imageWidthScale",e.image.width/e.width),t.setProperty(s.box.imageRef,"imageHeightScale",e.image.height/e.height)),e.maskImage){const o=new Image$1(generateDBID(),e.maskImage.url,e.maskImage.name,e.maskImage.width,e.maskImage.height,"uploaded",e.maskImage.scaledImages,"Mask Images",r),i=scope().resourcesImagesUi.getWcList();i&&i.createItems([o]),t.setProperty(s.box.effect,"maskActive",!0),t.setProperty(s.box.effect,"maskChannel","image"),t.setProperty(s.box.effect,"maskInverse",!0),t.setProperty(s.box.effect,"maskImageId",o.id),r+=.001}const o=["content"];e.lockItem?t.setProperty(s.box.basics,"lockBox",!0):o.push("mandatory"),t.setProperty(s.box.lock,"allowImageGroups",["Buyer Upload"]),t.setProperty(s.box.lock,"allowImage",o);const i=new Box(t,s.box);yield update([s.box.serialize(s.spread.id,s.doc.id)],[i.serialize(s.spread.id,s.doc.id)]),yield sleep(0)}n&&(scope().clearSelection(),scope().addToSelection(n))}break;case"addFont":{const t=scope().resourcesFontsUi.getWcList();if(t){const o=new Font(e.fontId,e.font);yield t.createItems([o])}}break;case"simpleText":{let t;e.maskImageName&&e.maskImageUrl&&(s[e.maskImageName]?t=s[e.maskImageName]:(t=new Image$1(generateDBID(),e.maskImageUrl,e.maskImageName,e.maskImageWidth,e.maskImageHeight,"uploaded",e.scaledMaskImages,"Text Image Masks",r),r+=.001,s[e.maskImageName]=t));const o=e.classes||"",i=null!==o.match(/text-distribution-\d+(?!-)/),l=null!==o.match(/text-distribution-\d+-\w+/),c=o.match(/font-size-\d+/);let d=i?"":e.text,h=!1;console_log("isTextDistributionRoot="+i+", text="+d+", original="+e.text),yield addSimpleText(e.left,e.top,e.width,e.height,d,e.fontId,t),yield sleep(0);const p=scope().lastCreatedBoxIds[0],u=scope().docUi.getWcBox(p);if(i&&(n[p]=e.text),null!==c&&!i&&!l){const t=c[0];a[t]||(h=!0,d="",a[t]={boxId:p,text:e.text,lock:e.lockItem})}if(u){scope().clearSelection(),scope().addToSelection(u),yield sleep(0);const t=["content"];e.isMandatory&&t.push("mandatory");const o=[{feature:"basics",property:"paddingLeft",value:new Length(e.paddingLeft,"px")},{feature:"basics",property:"paddingRight",value:new Length(e.paddingRight,"px")},{feature:"basics",property:"paddingTop",value:new Length(e.paddingTop,"px")},{feature:"basics",property:"paddingBottom",value:new Length(e.paddingBottom,"px")},{feature:"lock",property:"allowText",value:t},{feature:"simpleText",property:"text",value:d},{feature:"simpleText",property:"maxCharacters",value:e.maxChars},{feature:"simpleText",property:"minLetterWidth",value:e.minGlyphWidth},{feature:"simpleText",property:"maxLetterWidth",value:e.maxGlyphWidth},{feature:"simpleText",property:"horizontalSimpleTextAlign",value:e.horizontalAlignment},{feature:"simpleText",property:"verticalSimpleTextAlign",value:e.verticalAlignment},{feature:"simpleText",property:"fontHeights",value:"font"},{feature:"simpleText",property:"textTransform",value:e.capitalize?"upper":"mixed"}];if(e.maskImageName&&e.maskImageUrl&&(o.push({feature:"imageRef",property:"imagePlacement",value:"crop"}),o.push({feature:"imageRef",property:"imageXPosition",value:-e.left/e.width}),o.push({feature:"imageRef",property:"imageYPosition",value:-e.top/e.height}),o.push({feature:"imageRef",property:"imageWidthScale",value:e.maskImageWidth/e.width}),o.push({feature:"imageRef",property:"imageHeightScale",value:e.maskImageHeight/e.height})),e.textBefore&&o.push({feature:"simpleText",property:"textBefore",value:e.textBefore}),e.textAfter&&o.push({feature:"simpleText",property:"textAfter",value:e.textAfter}),e.minSpacing>=100){const t=.05*(e.minSpacing-100)+100;o.push({feature:"simpleText",property:"minLetterSpacing",value:t})}if(e.maxSpacing>=100){const t=.05*(e.maxSpacing-100)+100;o.push({feature:"simpleText",property:"maxLetterSpacing",value:t})}if(e.classes&&o.push({feature:"basics",property:"class",value:e.classes}),e.dropShadowEffect){const t=Color.parseRgbColor(e.dropShadowEffect.rgbColor);if(t){const i=new ColorRef(t,100,e.dropShadowEffect.opacity);o.push({feature:"effect",property:"dropColor",value:i})}o.push({feature:"effect",property:"dropActive",value:!0}),o.push({feature:"effect",property:"dropOmits",value:"image"}),o.push({feature:"effect",property:"dropBlend",value:e.dropShadowEffect.blendMode}),o.push({feature:"effect",property:"dropBlurRadius",value:new Length(.1*e.dropShadowEffect.blur,"%")}),o.push({feature:"effect",property:"dropSpreadRadius",value:new Length(.08*e.dropShadowEffect.dilate,"%")});const i=e.dropShadowEffect.angle*Math.PI/180,r=.5*e.dropShadowEffect.distance*Math.cos(i),s=.5*e.dropShadowEffect.distance*Math.sin(i);o.push({feature:"effect",property:"dropXoffset",value:new Length(r,"%")}),o.push({feature:"effect",property:"dropYoffset",value:new Length(s,"%")})}if(e.innerShadowEffect){const t=Color.parseRgbColor(e.innerShadowEffect.rgbColor);if(t){const i=new ColorRef(t,100,e.innerShadowEffect.opacity);o.push({feature:"effect",property:"inShadowColor",value:i})}o.push({feature:"effect",property:"inShadowActive",value:!0}),o.push({feature:"effect",property:"inShadowArea",value:"fill"}),o.push({feature:"effect",property:"inShadowOmits",value:"image"}),o.push({feature:"effect",property:"inShadowBlend",value:e.innerShadowEffect.blendMode}),o.push({feature:"effect",property:"inShadowBlurRadius",value:new Length(.1*e.innerShadowEffect.blur,"%")}),o.push({feature:"effect",property:"inShadowSpreadRadius",value:new Length(.08*e.innerShadowEffect.dilate,"%")});const i=e.innerShadowEffect.angle*Math.PI/180,r=.5*e.innerShadowEffect.distance*Math.cos(i),s=.5*e.innerShadowEffect.distance*Math.sin(i);o.push({feature:"effect",property:"inShadowXoffset",value:new Length(r,"%")}),o.push({feature:"effect",property:"inShadowYoffset",value:new Length(s,"%")})}if(e.strokeEffect){const t=Color.parseRgbColor(e.strokeEffect.rgbColor);if(t){const i=new ColorRef(t,100,e.strokeEffect.opacity);o.push({feature:"effect",property:"strokeEffectColor",value:i})}o.push({feature:"effect",property:"strokeActive",value:!0}),o.push({feature:"effect",property:"strokeOmits",value:"image"}),o.push({feature:"effect",property:"strokeBlend",value:"normal"}),o.push({feature:"effect",property:"strokeBlurRadius",value:new Length("0%")}),o.push({feature:"effect",property:"strokeSpreadRadius",value:new Length(.08*e.strokeEffect.width,"%")})}if(e.outerGlowEffect){const t=Color.parseRgbColor(e.outerGlowEffect.rgbColor);if(t){const i=new ColorRef(t,100,e.outerGlowEffect.opacity);o.push({feature:"effect",property:"outGlowColor",value:i})}o.push({feature:"effect",property:"outGlowActive",value:!0}),o.push({feature:"effect",property:"outGlowOmits",value:"image"}),o.push({feature:"effect",property:"outGlowBlend",value:e.outerGlowEffect.blendMode}),o.push({feature:"effect",property:"outGlowBlurRadius",value:new Length(.1*e.outerGlowEffect.blur,"%")}),o.push({feature:"effect",property:"outGlowSpreadRadius",value:new Length(.08*e.outerGlowEffect.dilate,"%")})}if(e.innerGlowEffect){const t=Color.parseRgbColor(e.innerGlowEffect.rgbColor);if(t){const i=new ColorRef(t,100,e.innerGlowEffect.opacity);o.push({feature:"effect",property:"inGlowColor",value:i})}o.push({feature:"effect",property:"inGlowActive",value:!0}),o.push({feature:"effect",property:"inGlowArea",value:"fill"}),o.push({feature:"effect",property:"inGlowOmits",value:"image"}),o.push({feature:"effect",property:"inGlowBlend",value:e.innerGlowEffect.blendMode}),o.push({feature:"effect",property:"inGlowBlurRadius",value:new Length(.1*e.innerGlowEffect.blur,"%")}),o.push({feature:"effect",property:"inGlowSpreadRadius",value:new Length(.08*e.innerGlowEffect.dilate,"%")})}if(e.rgbFillColor){const t=Color.parseRgbColor(e.rgbFillColor);if(t){const e=new ColorRef(t);o.push({feature:"simpleText",property:"fontColor",value:e})}}e.rotation>0&&o.push({feature:"boxGeometry",property:"rotation",value:e.rotation}),e.lockItem&&!h&&o.push({feature:"basics",property:"lockBox",value:e.lockItem}),yield scope().selection.setMultipleValues(o),yield sleep(100);const i=scope().getBox(p);if(e.useGrid&&i){if(scope().selection.spread){const t=new Nobs,o=.01*e.transformPoints[8],r=Quadrangle.fromFourPoints(e.transformPoints),s=PathGeometry.createMappedGridPath(e.gridColumns,e.gridRows,((e,t)=>{const i=Math.sin(e*Math.PI+Math.PI)*o,s=r.map(e,t);return{x:s.x,y:s.y+i}}));e.gridPoints&&e.gridPoints.length>0&&e.gridPoints.forEach((t=>{const o=(t.indexY-1)*e.gridColumns+(t.indexX-1),i=s.path[o];i.x+=100*t.x/e.width,i.y+=100*t.y/e.height})),t.setProperty(i.box.transform,"meshColumns",e.gridColumns),t.setProperty(i.box.transform,"meshRows",e.gridRows),t.setProperty(i.box.transform,"meshGeometry",s),t.setProperty(i.box.transform,"meshOmits","image"),t.setProperty(i.box.transform,"meshActive",!0);const n=new Box(t,i.box);yield update([i.box.serialize(i.spread.id,i.doc.id)],[n.serialize(i.spread.id,i.doc.id)])}}}}}for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e)){const t=n[e],o=scope().docUi.getWcBox(e);if(o){scope().clearSelection(),scope().addToSelection(o),yield sleep(0);const e=[{feature:"simpleText",property:"text",value:t}];yield scope().selection.setMultipleValues(e),yield sleep(0),yield sleep(0),yield sleep(0),console_log("Set values")}}for(const e in a)if(Object.prototype.hasOwnProperty.call(a,e)){const t=a[e],o=t.boxId,i=t.text,r=t.lock,s=scope().docUi.getWcBox(o);if(s){scope().clearSelection(),scope().addToSelection(s),yield sleep(0);const e=[{feature:"simpleText",property:"text",value:i},{feature:"basics",property:"lockBox",value:r}];yield scope().selection.setMultipleValues(e),yield sleep(0),yield sleep(0),yield sleep(0),console_log("Set font size values")}}if(scope().id=i,yield sleep(0),scope().id=i,yield sleep(0),yield sleep(500),config.isDebugViewBkr)return}}))}function playerExecute(e){scopeReady((function(){go(e)}))}var __awaiter$8=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};class ProductMatrix{constructor(e){if(this.rulesCols=[],this.writesCols=[],this.layersCols=[],this.rows=[],e.rules)for(const t of e.rules)this.rulesCols.push(t);if(e.layers)for(const t of e.layers)this.layersCols.push(t);if(e.writes)for(const t of e.writes)this.writesCols.push(t);if(e.rows)for(const t of e.rows)this.rows.push(new ProductMatrixRow(t))}apply(e,t=!0){return __awaiter$8(this,void 0,void 0,(function*(){if("number"==typeof e){if(0===this.rows.length)return;e=e>=0&&e<this.rows.length?this.rows[e]:this.rows[0]}const o=[];for(const t of this.layersCols)!1===e.layers.get(t)?o.push({name:t,value:!1}):o.push({name:t,value:!0});yield scope().layersUi.setLayersVisibilities(o),t&&(yield scope().clearSelectionAndAllEditors(scope().docUi.currentSpread),scope().redrawAllItemsWithEmbeddedExpressions(),scope().redrawAllItemsWithClassesDebounced(50))}))}setDocProperty(e,t,o){const i=this.serialize(),r=this.rows[e];r&&(r[t]=o,update([i],[this.serialize()]))}setStringProperty(e,t,o){const i=this.serialize(),r=this.rows[e];r&&(r[t]=o),update([i],[this.serialize()])}addProductRow(){const e=this.serialize();this.rows.push(new ProductMatrixRow({na:"new product"})),update([e],[this.serialize()])}removeProductRow(e){if(this.rows.length>0&&this.rows.length>e){const t=this.serialize();this.rows=this.rows.filter((t=>t.index!==e)),update([t],[this.serialize()])}}setLayerValue(e,t,o){return __awaiter$8(this,void 0,void 0,(function*(){const i=this.serialize(),r=this.rows[e];r&&r.layers.set(t,o),yield update([i],[this.serialize()])}))}addLayer(e){if(e&&-1===this.layersCols.indexOf(e)){const t=this.serialize();this.layersCols.push(e),update([t],[this.serialize()])}}removeLayer(e){if(e&&this.layersCols.indexOf(e)>=0){const t=this.serialize();this.layersCols=this.layersCols.filter((t=>t!==e)),update([t],[this.serialize()])}}setRuleValue(e,t,o){const i=this.serialize(),r=this.rows[e];r&&r.rules.set(t,o),update([i],[this.serialize()])}addRule(e){if(e&&-1===this.rulesCols.indexOf(e)){const t=this.serialize();this.rulesCols.push(e),update([t],[this.serialize()])}}removeRule(e){if(e&&this.rulesCols.indexOf(e)>=0){const t=this.serialize();this.rulesCols=this.rulesCols.filter((t=>t!==e)),update([t],[this.serialize()])}}setWriteValue(e,t,o){const i=this.serialize(),r=this.rows[e];r&&r.writes.set(t,o),update([i],[this.serialize()])}addWrites(e){if(e&&-1===this.writesCols.indexOf(e)){const t=this.serialize();this.writesCols.push(e),update([t],[this.serialize()])}}removeWrite(e){if(e&&this.writesCols.indexOf(e)>=0){const t=this.serialize();this.writesCols=this.writesCols.filter((t=>t!==e)),update([t],[this.serialize()])}}serialize(){return{id:"PRODUCTMATRIX",scopeId:scope().id,parentId:scope().id,data:this.serializeSimple(),type:"matrix"}}serializeSimple(){const e=[];let t=0;for(const o of this.rows)e.push(o.serializeSimple(t)),t++;return{rules:this.rulesCols,layers:this.layersCols,writes:this.writesCols,rows:e}}}class ProductMatrixRow{constructor(e){if(this.index=e.idx||0,this.name=e.na||"Product Configuration",this.description=e.ds||"",this.supplierId=e.sId||"",this.supplierSKU=e.sku||"",this.rules=new Map,this.layers=new Map,this.writes=new Map,this.editDoc=e.edit||"",this.printDoc=e.print||"",this.previewDoc1=e.prev1||"",this.previewDoc2=e.prev2||"",this.previewDoc3=e.prev3||"",e.rules)for(const t of e.rules)this.rules.set(t.ffName,t.ffValue);if(e.writes)for(const t of e.writes)this.writes.set(t.ffName,t.ffValue);if(e.layers)for(const t of e.layers)this.layers.set(t.lName,t.on)}getLayerValue(e){return!1!==this.layers.get(e)}getRulesValue(e){return this.rules.get(e)||""}getWritesValue(e){return this.rules.get(e)||""}serializeSimple(e){return{idx:e,na:this.name,ds:this.description,sId:this.supplierId,sku:this.supplierSKU,edit:this.editDoc,print:this.printDoc,prev1:this.previewDoc1,prev2:this.previewDoc2,prev3:this.previewDoc3,rules:Array.from(this.rules).map((e=>({ffName:e[0],ffValue:e[1]}))),writes:Array.from(this.writes).map((e=>({ffName:e[0],ffValue:e[1]}))),layers:Array.from(this.layers).map((e=>({lName:e[0],on:e[1]})))}}}
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */const previousValues=new WeakMap,unsafeHTML=directive((e=>t=>{if(!(t instanceof NodePart))throw new Error("unsafeHTML can only be used in text bindings");const o=previousValues.get(t);if(void 0!==o&&isPrimitive(e)&&e===o.value&&t.value===o.fragment)return;const i=document.createElement("template");i.innerHTML=e;const r=document.importNode(i.content,!0);t.setValue(r),previousValues.set(t,{value:e,fragment:r})}));var __decorate$1=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n};const tipCounts=new Map;function getTipMeta(e){switch(e){case"addFeatureOrCreateBox":return{head:"Add Feature or Create new Frame?",image:"tip_addFeatureOrCreateBox.png",text:"Frames can have multiple features like an <b>image</b> and a <b>shape</b> and a <b>text</b>.<br/>You have the choice:<br/><b>Add</b> this feature to the selected frame or <b>Create</b> a new frame?",options:[{caption:"Cancel",token:"CANCEL"},{caption:"Create Frame",token:"addBox"},{caption:"Add Feature",token:"OK"}]};case"enterPercentUnits":return{head:"Percent units for flexible designs.",image:"tip_usingPercentUnits.png",text:"When setting the position or dimensions of a frame you can use percent values like <b>width: 50%</b> - which cause the frame to take up 50% of the documents width. \nYou also can use double percent <b>width: 50%%</b> which will cause the frame to take up 50% of the documents <b>height</b>. \n You can easily convert any frame between all units with the shortcut buttons beneath the position input.",count:3,options:[{caption:"OK",token:"OK"}]};case"textSelectAll":return{head:"Press CTRL + A to select all text",image:"tip_ctrl_a.png",text:"In Text edit mode [<b>T</b>] you can press <b>[CTRL]+[A]</b> to select the entire text. Even the invisible text which does not fit in the current frame. Once selected, you can change for example the font-size.",count:3,options:[{caption:"OK",token:"OK"}]};default:assertNever$1(e)}}function showTip(e){let t=tipCounts.get(e);t||(t=0),t++,tipCounts.set(e,t);const o=getTipMeta(e);return o.count&&o.count>t?new Promise((e=>e("OK"))):(tipCounts.set(e,0),(new WcTipDialog).showDialog(e))}let WcTipDialog=(()=>{let e=class extends LitElement{constructor(){super(),this.meta=getTipMeta("addFeatureOrCreateBox"),this.type="addFeatureOrCreateBox",this.backdrop=new WcBackdrop}showDialog(e){return this.meta=getTipMeta(e),this.type=e,this.skipDialog(e)||scope().isRecording||scope().isReplaying||config.isBuyer||config.isMobile?new Promise((e=>e("OK"))):new Promise((e=>{this._showDialog((t=>{e(t)}))}))}_showDialog(e){this.callback=e,document.body.appendChild(this.backdrop),document.body.appendChild(this)}skipDialog(e){return"SKIP"===localStorage.getItem("tip:"+e)}showAgain(e){localStorage.setItem("tip:"+this.type,e?"SKIP":"")}closeDialog(e){document.body.removeChild(this.backdrop),document.body.removeChild(this),this.callback&&this.callback(e)}static get styles(){return[dialogStyles,css`
   
        :host, :host * {
          box-sizing: border-box;
          
        }
        
        .content {
          max-width: 400px;
        }
        h1 {
          font-size: var(--printess-headlineSize);
          margin-top: 20px;
          margin-bottom: 0px;
        }
        p {
          
        }
      
      .image {
        display: block;
        background-size: contain;
        background-repeat: no-repeat;
        background-position: left top;
        height: 100px;
        margin-bottom: 25px;
        
      }

      label {
        font-size: var(--printess-labelSize);
        color: var(--printess-textColorDisabled);
      }
      
    `]}render(){var e;return html`
          
        <div class="content">
            
              ${this.meta.image?html`
                <div class="image" style="background-image: url('printess-editor/${this.meta.image}');"></div>
              `:""}
              <h1>${this.meta.head}</h1>
              ${unsafeHTML(this.text)} 
              <label>
                <input @click=${e=>e.target?this.showAgain(e.target.checked):""} id="again" type="checkbox"/>
                Don't show this dialog again
                </label>
        </div>
        
         <div class="footer" style="grid-template-columns: repeat(${this.meta.options.length}, auto)">
            ${null===(e=this.meta.options)||void 0===e?void 0:e.map((e=>html`
                <vaadin-button  @click=${()=>this.closeDialog(e.token)} theme="${"OK"===e.token?"primary":"secondary"}">${e.caption}</vaadin-button>
            `))}
         </div>
         
        `}get text(){return this.meta.text.split(/\n/g).map((e=>"<p>"+e+"</p>")).join("")}};return e=__decorate$1([customElement("wc-tip-dialog")],e),e})();var __awaiter$9=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};class DocRef extends NobsBase{constructor(e,t=""){if(super(e,t),"string"==typeof e&&"string"==typeof t)this.documentName=e,this.spreadName=t,this.formFieldValues=new Map,this.documentPlacement="fit",this.horizontalFocalPointDocument=.5,this.verticalFocalPointDocument=.5,this.hideNonPrintableLayers=!1;else if(!(e instanceof Nobs)){const t=e;if(this.documentName=t.na,this.spreadName=t.si,this.formFieldValues=new Map,"keepAspectRatio"===t.pl&&(t.pl="fill"),this.documentPlacement=t.pl||"fit",this.horizontalFocalPointDocument="number"==typeof t.fx?t.fx:.5,this.verticalFocalPointDocument="number"==typeof t.fy?t.fy:.5,this.hideNonPrintableLayers="boolean"==typeof t.hnp&&t.hnp,this.hasFormField="boolean"==typeof t.sff&&t.sff,this.docXPosition=t.px,this.docYPosition=t.py,this.docWidthScale=t.ws,this.docHeightScale=t.hs,t.ffv)for(const e in t.ffv)Object.prototype.hasOwnProperty.call(t.ffv,e)&&this.formFieldValues.set(e,t.ffv[e])}this.documentName||(this.documentName=""),this.spreadName||(this.spreadName=""),this.docXPosition||0===this.docXPosition||(this.docXPosition=0),this.docYPosition||0===this.docYPosition||(this.docYPosition=0),(!this.docWidthScale||this.docWidthScale<=0)&&(this.docWidthScale=1),(!this.docHeightScale||this.docHeightScale<=0)&&(this.docHeightScale=1)}setFormFieldValue(e,t,o){var i;return __awaiter$9(this,void 0,void 0,(function*(){if(this.formFieldValues.get(t)!==o){const r=new Map(this.formFieldValues);r.set(t,o);const s=scope().getBox(e);if(s){const t=(new Nobs).setProperty(s.box.docRef,"formFieldValues",r);yield update([s.box.serialize(s.spread.id,s.doc.id)],[new Box(t,s.box).serialize(s.spread.id,s.doc.id)]),null===(i=scope().docUi.getWcBox(e))||void 0===i||i.requestUpdate()}}}))}toString(){return this.documentName+" ("+this.spreadName+")"}serializeNewCrop(e,t,o,i){return{pl:this.documentPlacement,na:this.documentName,ws:o,hs:i,px:e,py:t,fx:this.horizontalFocalPointDocument,fy:this.verticalFocalPointDocument,ffv:DocRef.serializeFFVs(this.formFieldValues),hnp:this.showAsNonPrintableLayers,sff:this.hasFormField,si:this.spreadName}}static serializeFFVs(e){const t={};for(const[o,i]of e)t[o]=i;return t}serialize(){return{na:this.documentName,si:this.spreadName,ffv:DocRef.serializeFFVs(this.formFieldValues),pl:this.documentPlacement,fx:this.horizontalFocalPointDocument,fy:this.verticalFocalPointDocument,hnp:this.hideNonPrintableLayers,sff:this.hasFormField,px:this.docXPosition,py:this.docYPosition,ws:this.docWidthScale,hs:this.docHeightScale}}static serializeAsSubDocument(e){const t=e.getValue("docRef","documentName"),o=scope().getDocByName(t);return o?o.serialize(scope().id,!0,!1,!0,e.id):null}static getSelectedSpread(e){const t=e.getValue("docRef","documentName"),o=scope().getDocByName(t);if(!o)throw"getSelectedSpread: Document not found: "+t;let i=evaluateText(null,e.getValue("docRef","spreadName")).text;e.parentBoxIdForEvaluation&&(i=scope().getFormFieldValue("SUB_DOC_"+e.id,e.parentBoxIdForEvaluation));let r=o.spreads.values().next().value;if(i)for(const e of o.spreads.values())e.name==i&&(r=e);if(e.lock.isUiElement&&e.lock.hasClickAction){let t=!1;"COLOR_SCHEME"===e.lock.clickActionFormFieldName?t=e.lock.clickActionFormFieldValue===scope().colorScheme:scope().getFormFieldValue(e.lock.clickActionFormFieldName)===e.lock.clickActionFormFieldValue&&(t=!0);for(const e of o.spreads.values())"selected"==e.name&&t&&(r=e)}return r}static createOrAssignDoc(e){var t;scope().selection.getSelectedBoxes().length>0?(null===(t=scope().selection.getSingleSelection())||void 0===t?void 0:t.box.getFeature("docRef"))?scope().selection.assignDoc(e):(new WcTipDialog).showDialog("addFeatureOrCreateBox").then((t=>{"addBox"===t?scope().createNewBox("auto",boxTypeE.doc,void 0,void 0,void 0,void 0,void 0,void 0,void 0,e):"OK"===t&&scope().selection.assignDoc(e)})):scope().createNewBox("auto",boxTypeE.doc,void 0,void 0,void 0,void 0,void 0,void 0,void 0,e)}}function getBuildVersion(){return 1649}function getBuildDate(){return"2021-03-15 17:40:11+0100"}function getBuildHash(){return"bffbf36f2cdaa0a5c60d8850a64fcc4c7f79b088"}function getTokens(e,t=!0,o=!1){let i=[];if("root"===e)i=[{caption:".your-classname {}",value:".your-classname {\n",type:"P",postfix:"}"}];else if("colorProperty"===e)i=scope().colors.getSwatches().map((e=>({caption:e.name,value:e.name,type:"C",color:e.toCssColor(100,100),postfix:";"})));else if("fontProperty"===e)i=Array.from(scope().fonts.values()).map((e=>({caption:e.name,value:"'"+e.name+"'",type:"F",style:"font-family:"+e.name+";",postfix:";"})));else if("imageProperty"===e)i=[{name:"external (url)",url:"https://homepages.cae.wisc.edu/~ece533/images/cat.png"},...Array.from(scope().images.values())].map((e=>({caption:e.name,value:"external (url)"===e.name?e.url:e.name,type:"I",style:"height: 40px; padding-left: 65px; background-size: 60px auto; background-repeat: no-repeat; background-image: url('"+e.url+"');",postfix:";"})));else if("anchorProperty"===e||"booleanProperty"===e)i=["true","false"].map((e=>({caption:e,value:e,type:"P",postfix:";"})));else if("lengthProperty"===e)i=["2cm","1.5inch","10pt","12px","50%"].map((e=>({caption:e,value:e,type:"F",postfix:";"})));else if("tabsProperty"===e)i=["L1cm L3cm L5cm L7cm","L1cm ._10cm","L1cm C_3cm R5cm .7cm"].map((e=>({caption:e,value:e,type:"F",postfix:";"})));else if("selector"===e)i=allPropertyNamesForStyles.map((e=>{const t=propertyToFeatureIndex[e.name],o=t?t.features:void 0;return{caption:e.name,badges:o,value:e.name,type:"P",postfix:":"}}));else{const t=enums[getEnumByProperty(e.replace("Property",""))];Array.isArray(t)&&(i=t.map((e=>({caption:e,value:e,type:"P",postfix:";"}))))}const r=[];t&&(r.push(...Array.from(scope().getAllGlobalFormFields().values()).map((e=>({caption:"${form."+e.name+"}",value:"${form."+e.name+"}",type:"V",style:"font-style: italic;",color:"darkblue"})))),r.push(...scope().currentDoc.getAllDocFormFields(null).map((e=>({caption:"${form."+e.name+"}",value:"${form."+e.name+"}",type:"V",style:"font-style: italic;",color:"darkred"})))),o&&r.push(...Array.from(scope().currentDoc.boxIdByJsNameCache.keys()).map((e=>({caption:"${frame."+e+"[.left|.top|.width.|.height|.right|.bottom]}px",value:"${frame."+e+".left}px",type:"V",style:"font-style: italic;",color:"darkgreen"})))),r.push(...["FirstName","LastName","Phone","Address","City","Zahl"].sort(((e,t)=>e.localeCompare(t))).map((e=>({caption:"${data."+e+"}",value:"${data."+e+"}",type:"V",style:"font-style: italic;",color:"darkcyan"})))));const s=[...i,...r],n=new Set;for(const e of s)n.add(e.value.substr(0,1));return{tokens:s,igniteChars:n}}function getValueRexExFromArray(e){return new RegExp("^\\s*("+e.reduce(((e,t)=>e?e+"|"+t:t))+")\\s*$")}function getPropertyRexExFromArray(e){return new RegExp("("+e.reduce(((e,t)=>e?e+"|"+t:t))+")\\s*:")}function getLanguage(){const e=/("|')(?:\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/,t=new Map([["punctuation",{pattern:/[{}()]$/,style:{fontColor:"pink"}}],["keyword",{pattern:/\b(?:var|let|const|of|in|if|else|while|do|for|return|in|instanceof|function|new|try|throw|catch|finally|null|break|continue)\b/,style:{fontColor:"#8500ff"}}],["boolean",{pattern:/\b(?:true|false)\b/,style:{fontColor:"#8500ff"}}],["function",{pattern:/\w+(?=\()/,style:{fontColor:"#8500ff"}}],["number",{pattern:/\b0x[\da-f]+\b|(?:\b\d+\.?\d*|\B\.\d+)(?:e[+-]?\d+)?/i,style:{fontColor:"#396ee5"}}],["literal",{pattern:/".*?"/i,style:{fontColor:"#008000"}}],["operator",{pattern:/--?|\+\+?|!=?=?|<=?|>=?|==?=?|&&?|\|\|?|\?|\*|\/|~|\^|%/,style:{fontColor:"#9a8c7f"}}]]),o=new Map([["url",{pattern:RegExp("url\\((?:"+e.source+"|[^\n\r()]*)\\)","i"),style:{fontColor:"green"},inside:new Map([["function",{pattern:/^url/i,style:{fontColor:"green"}}],["punctuation",{pattern:/^\(|\)$/,style:{fontColor:"green"}}]])}],["lengthProperty",{pattern:new RegExp(getPropertyRexExFromArray(propertyNames.length)),style:{fontColor:"#ff00ff"},inside:new Map([["length",{pattern:/^\s*\d+\.*\d*(px|mm|cm|%|pt|inch)(;|\s)*$/,style:{fontColor:"#008000"}}],["noMatch",{pattern:/ignored/,style:{annotationZigzag:"red"}}]]),open:":",close:";"}],["numberProperty",{pattern:new RegExp(getPropertyRexExFromArray(propertyNames.number)),style:{fontColor:"#ff00ff"},inside:new Map([["number",{pattern:/^\s*\d+\.*\d*(;|\s)*$/i,style:{fontColor:"#008000"}}],["noMatch",{pattern:/ignored/,style:{annotationZigzag:"red"}}]]),open:":",close:";"}],["stringProperty",{pattern:new RegExp(getPropertyRexExFromArray(propertyNames.string)),style:{fontColor:"#ff00ff"},inside:new Map([["string",{pattern:/[^;]*/,style:{fontColor:"#008000"}}],["noMatch",{pattern:/ignored/,style:{annotationZigzag:"red"}}]]),open:":",close:";"}],["tabsProperty",{pattern:new RegExp(getPropertyRexExFromArray(propertyNames.tabs)),style:{fontColor:"#ff00ff"},inside:new Map([["string",{pattern:/[^;]*/,style:{fontColor:"#008000"}}],["noMatch",{pattern:/ignored/,style:{annotationZigzag:"red"}}]]),open:":",close:";"}],["anchorProperty",{pattern:new RegExp(getPropertyRexExFromArray(propertyNames.anchor)),style:{fontColor:"#ff00ff"},inside:new Map([["boolean",{pattern:/(true|false)/i,style:{fontColor:"#008000"}}],["noMatch",{pattern:/ignored/,style:{annotationZigzag:"red"}}]]),open:":",close:";"}],["booleanProperty",{pattern:new RegExp(getPropertyRexExFromArray(propertyNames.boolean)),style:{fontColor:"#ff00ff"},inside:new Map([["boolean",{pattern:/(true|false)/i,style:{fontColor:"#008000"}}],["noMatch",{pattern:/ignored/,style:{annotationZigzag:"red"}}]]),open:":",close:";"}],["colorProperty",{pattern:new RegExp(getPropertyRexExFromArray(propertyNames.color)),style:{fontColor:"#ff00ff"},inside:new Map([["color",{pattern:/^\s*#([0-9a-f]{6})\s*$/i,style:{fontColor:"#257a80"}}],["noMatch",{pattern:/ignored/,style:{annotationZigzag:"red"}}]]),open:":",close:";"}],["fontProperty",{pattern:new RegExp(getPropertyRexExFromArray(propertyNames.font)),style:{fontColor:"#ff00ff"},inside:new Map([["font",{pattern:/custom_evaluator/,style:{fontColor:"#257a80"}}],["noMatch",{pattern:/ignored/,style:{annotationZigzag:"red"}}]]),open:":",close:";"}],["imageProperty",{pattern:new RegExp(getPropertyRexExFromArray(propertyNames.image)),style:{fontColor:"#ff00ff"},inside:new Map([["url",{pattern:RegExp("url\\((?:"+e.source+"|[^\n\r()]*)\\)","i"),style:{fontColor:"green"}}],["image",{pattern:/custom_evaluator/,style:{fontColor:"#257a80"}}],["noMatch",{pattern:/ignored/,style:{annotationZigzag:"red"}}]]),open:":",close:";"}],["noMatch",{pattern:/ignored/,style:{annotationZigzag:"red"}}]]);for(const e of Object.keys(propertyNames))if(!o.has(e+"Property")){const t=propertyNames[e],i=enums[getEnumByProperty(e)],r=new Map;if(Array.isArray(t)&&Array.isArray(i)){for(const e of t)r.set(e,{pattern:getValueRexExFromArray(i),style:{fontColor:"#008000"}});r.set("noMatch",{pattern:/ignored/,style:{annotationZigzag:"red"}}),o.set(e+"Property",{pattern:new RegExp(getPropertyRexExFromArray(t)),style:{fontColor:"#ff00ff"},inside:r,open:":",close:";"})}}const i=new Map([["embedjs",{pattern:/\${/,style:{fontColor:"#da9931"},inside:t,open:"{",close:"}"}],["comment",{pattern:/\/\*[\s\S]*?\*\//,style:{fontColor:"gray"}}],["atrule",{pattern:/@[\w-]+[\s\S]*?{/,style:{fontColor:"green"},open:"{",close:"}"}],["selector",{pattern:/(^\.|^#)[\w-]+[\s\S]*?{/,style:{fontColor:"#b61b41"},inside:o,open:"{",close:"}",multiLine:!0}]]),r=i.get("atrule");return r&&(r.inside?r.inside=new Map([...r.inside,...i]):r.inside=i),{name:"custom-css",rules:i}}var __awaiter$a=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};class PathText extends NobsBase{constructor(e,t){if(super(e,t),this.usedFormFields=new Map,!(e instanceof Nobs)&&e){const t=e;this.textOnPath=t.txt,this.pathTextFont=new FontRef(t.fnt.id,t.fnt),t.hor&&(this.horizontalPathTextAlign=t.hor),t.stw&&(this.pathTextStrokeWidth=Length.deserialize(t.stw)),t.dis&&(this.distance=Length.deserialize(t.dis)),t.sta&&(this.pathTextStrokeAlign=t.sta),t.stj&&(this.pathTextStrokeJoin=t.stj),t.stc&&(this.pathTextStrokeColor=new ColorRef(t.stc.id,t.stc)),t.txc&&(this.pathTextFontColor=new ColorRef(t.txc.id,t.txc)),t.fs&&(this.pathTextFontSize=Length.deserialize(t.fs)),t.sx&&(this.startX=t.sx),this.hasFormField=!0===t.hff}this.pathTextFont||(this.pathTextFont=new FontRef("")),void 0===this.hasFormField&&(this.hasFormField=!1),void 0===this.textOnPath&&(this.textOnPath="This Text Follows the Path"),void 0===this.pathTextFontSize&&(this.pathTextFontSize=new Length(28,"pt")),this.pathTextFontColor||(this.pathTextFontColor=new ColorRef("[Black]")),this.pathTextStrokeColor||(this.pathTextStrokeColor=new ColorRef("[Black]")),this.pathTextStrokeWidth||(this.pathTextStrokeWidth=new Length(0,"%")),this.distance||(this.distance=new Length(0,"px")),this.horizontalPathTextAlign||(this.horizontalPathTextAlign="center"),void 0===this.startX&&(this.startX=0),this.pathTextStrokeAlign||(this.pathTextStrokeAlign="center"),this.pathTextStrokeJoin||(this.pathTextStrokeJoin="miter")}getHtml(e){var t,o,i;return __awaiter$a(this,void 0,void 0,(function*(){const r=e.getParentDimensions(),s=getOrCreateBoxCache(e.uniqueBoxId()),n=e.boxGeometry.toPixel(r.width,r.height,!0),a=e.box.getValue("pathText","pathTextFont").font,l=yield loadAndCacheFont(a.name,a.url);let c,d=!0;e.box.pathGeometry?(c=e.box.pathGeometry.serialize(1).p,d=e.box.pathGeometry.closed):c=PathGeometry.createBoxRectPath().serialize(1).p;let h=e.box.getValue("pathText","textOnPath",e),p=null;if(h.indexOf("${")>=0){const t=evaluateText(e.parentBoxIdForEvaluation,h);h=null===t.text?t.errors.join("\n"):t.text,p=t.fields}else if(e.parentBoxIdForEvaluation&&e.pathText&&e.pathText.hasFormField){const t=evaluateText(e.parentBoxIdForEvaluation,"${form.BOX_PTEXT_"+e.box.id+"}");h=null===t.text?t.errors.join("\n"):t.text,p=t.fields}e.box.simpleText&&p&&p.size>0&&(e.box.simpleText.usedFormFields=p);const u=new TextOnPathShaper(c,d,h,l,e.box.getValue("pathText","pathTextFontSize",e).toPixel_1Axis(r.width),n.width,n.height,e.box.getValue("pathText","horizontalPathTextAlign",e),.01*e.box.getValue("pathText","startX",e),e.box.getValue("pathText","pathTextStrokeWidth",e).toPixelOrPercent(),e.box.getValue("pathText","pathTextStrokeColor",e).toPrintColor(),e.box.getValue("pathText","pathTextFontColor",e).toPrintColor(),e.box.getValue("pathText","pathTextStrokeAlign",e),e.box.getValue("pathText","pathTextStrokeJoin",e),e.box.getValue("pathGeometry","strokeWidth",e).toPixelOrPercent(),e.box.getValue("pathGeometry","strokeColor",e).toPrintColor(),e.box.getValue("pathGeometry","fillColor",e).toPrintColor(),e.box.getValue("pathGeometry","strokeAlign",e),e.box.getValue("pathGeometry","strokeJoin",e),e.box.getValue("pathGeometry","strokeCap",e),!1,e.box.getValue("pathText","distance",e).toPixelOrPercent(),e.hasBoxOpacity());u.TaperTransform=e.box.taperTransform("ptxt"),u.MeshTransform=e.box.meshTransform("path"),u.WarpTransform=e.box.warpTransform(e,"ptxt"),e.setEffects("ptxt",u.effects,n);const m=u.getHash();if(m!==s.pathTextCacheHash){if(u.effects.resultsInVector()){const i=parseSvg(u.buildSvg());if(e.box.setOffsets("pathText",u.adjustmentLeft,u.adjustmentTop,u.adjustmentRight,u.adjustmentBottom),i.setAttribute("class","text-on-path"),i.style.position="absolute",i.style.left=u.adjustmentLeft+"px",i.style.top=u.adjustmentTop+"px",u.effects.hasOuterEffect()){const o=u.buildImage(!1),r=-o.left+"px",n=-o.top+"px";o.div=document.createElement("div"),o.dropShadowElement&&(o.div.appendChild(o.dropShadowElement),setAbsoluteTopLeftBlend(o.dropShadowElement,n,r,u.effects.dropShadowBlendMode)),o.outerGlowElement&&(o.div.appendChild(o.outerGlowElement),setAbsoluteTopLeftBlend(o.outerGlowElement,n,r,u.effects.outerGlowBlendMode)),o.strokeElement&&(o.div.appendChild(o.strokeElement),setAbsoluteTopLeftBlend(o.strokeElement,n,r,u.effects.strokeEffectBlendMode)),o.div.appendChild(i),s.pathTextCache=html`${o.div}`,null===(t=getWcBox(e.box.id,e.parentBoxIdForEvaluation))||void 0===t||t.requestUpdate()}else s.pathTextCache=html`${i}`,null===(o=getWcBox(e.box.id,e.parentBoxIdForEvaluation))||void 0===o||o.requestUpdate()}else{const t=u.buildImage();e.box.setOffsets("pathText",u.adjustmentLeft,u.adjustmentTop,u.adjustmentRight,u.adjustmentBottom),t.div.style.position="absolute",t.div.style.top=u.adjustmentTop.toString()+"px",t.div.style.left=u.adjustmentLeft.toString()+"px",s.pathTextCache=html`${t.div}`,null===(i=getWcBox(e.box.id,e.parentBoxIdForEvaluation))||void 0===i||i.requestUpdate()}s.pathTextCacheHash=m}return s.pathTextCache}))}toString(){return this.textOnPath}serialize(){return{txt:this.textOnPath,fnt:this.pathTextFont.serialize(),hor:this.horizontalPathTextAlign,fs:this.pathTextFontSize.serialize(),sx:this.startX,dis:this.distance.serialize(),txc:this.pathTextFontColor.serialize(),stc:this.pathTextStrokeColor.serialize(),stw:this.pathTextStrokeWidth.serialize(),sta:this.pathTextStrokeAlign,stj:this.pathTextStrokeJoin,hff:this.hasFormField}}}class Basics extends NobsBase{constructor(e,t){if(super(e,t),this.tempFlag_TextWrapModeChanged=!1,!(e instanceof Nobs)){let t={};"object"==typeof e&&(t=e),this.paddingLeft=t.l?Length.deserialize(t.l):new Length(0,"%"),this.paddingRight=t.r?Length.deserialize(t.r):new Length(0,"%"),this.paddingTop=t.t?Length.deserialize(t.t):new Length(0,"%"),this.paddingBottom=t.b?Length.deserialize(t.b):new Length(0,"%"),this.mirrorX=!!t.mx,this.mirrorY=!!t.my,this.textWrapMode=t.wm?t.wm:"do not wrap",this.wrapObjectOffset=t.woo?Length.deserialize(t.woo):new Length(0,"%"),this.class=t.cl?t.cl:"",this.lockAspectRatio=(!0===t.la||!1===t.la)&&t.la,this.lockBox=(!0===t.lp||!1===t.lp)&&t.lp,this.visible=!0!==t.vi&&!1!==t.vi||t.vi}}serialize(){return{wm:this.textWrapMode,cl:this.class,l:this.paddingLeft.serialize(),t:this.paddingTop.serialize(),r:this.paddingRight.serialize(),b:this.paddingBottom.serialize(),woo:this.wrapObjectOffset.serialize(),lp:this.lockBox,la:this.lockAspectRatio,vi:this.visible,mx:this.mirrorX,my:this.mirrorY}}}class Effect extends NobsBase{constructor(e,t){if(super(e,t),!(e instanceof Nobs)){let t={};"object"==typeof e&&(t=e),this.blurActive=t.blurA||!1,this.blurOmits=t.blurO||"",this.blurIntensity=t.blurI||0===t.blurI?t.blurI:5,this.blendMode=t.blendM||"normal",this.opacity=void 0!==t.opa&&t.opa>=0&&t.opa<=100?t.opa:100,this.maskActive=!0===t.maskA,this.maskOmits=t.maskO||"",this.maskInverse=!0===t.maskI,this.maskChannel=t.maskC||"image",t.maskImg&&"uploaded"===t.maskImg.t&&t.maskImgId?(this.maskImageId=t.maskImgId,scope().images.has(this.maskImageId)||create([new Image$1(this.maskImageId,t.maskImg).serialize()])):this.maskImageId="",this.brightness=t.bright||0,this.contrast=t.contrast||0,this.hueRotate=t.hue||0,this.saturate=t.sat||0,this.invert=t.invert||0,this.sepia=t.sepia||0,this.grayscale=t.gray||0,this.dropActive=t.dropA||!1,this.dropOmits=t.dropO||"",this.dropXoffset=t.dropX?Length.deserialize(t.dropX):new Length("4%"),this.dropYoffset=t.dropY?Length.deserialize(t.dropY):new Length("4%"),this.dropBlurRadius=t.dropBlur?Length.deserialize(t.dropBlur):new Length("5%"),this.dropSpreadRadius=t.dropSpread?Length.deserialize(t.dropSpread):new Length("0%"),this.dropColor=t.dropColor?new ColorRef(t.dropColor.id,t.dropColor):ColorRef.Black_Color(),this.dropBlend=t.dropBlend?t.dropBlend:"multiply",this.inShadowActive=t.inShadowA||!1,this.inShadowOmits=t.inShadowO||"",this.inShadowArea=t.inShadowArea||"combined",this.inShadowXoffset=t.inShadowX?Length.deserialize(t.inShadowX):new Length("4%"),this.inShadowYoffset=t.inShadowY?Length.deserialize(t.inShadowY):new Length("4%"),this.inShadowBlurRadius=t.inShadowBlur?Length.deserialize(t.inShadowBlur):new Length("5%"),this.inShadowSpreadRadius=t.inShadowSpread?Length.deserialize(t.inShadowSpread):new Length("0%"),this.inShadowColor=t.inShadowColor?new ColorRef(t.inShadowColor.id,t.inShadowColor):ColorRef.Black_Color(),this.inShadowBlend=t.inShadowBlend?t.inShadowBlend:"multiply",this.outGlowActive=t.outGlowA||!1,this.outGlowOmits=t.outGlowO||"",this.outGlowXoffset=t.outGlowX?Length.deserialize(t.outGlowX):new Length("0%"),this.outGlowYoffset=t.outGlowY?Length.deserialize(t.outGlowY):new Length("0%"),this.outGlowBlurRadius=t.outGlowBlur?Length.deserialize(t.outGlowBlur):new Length("5%"),this.outGlowSpreadRadius=t.outGlowSpread?Length.deserialize(t.outGlowSpread):new Length("0%"),this.outGlowColor=t.outGlowColor?new ColorRef(t.outGlowColor.id,t.outGlowColor):new ColorRef(new Color(255,255,0,0,0,100,0,95,-7,95,"C=0 M=0 Y=100 K=0","cmyk","process","write",!0,void 0,.004)),this.outGlowBlend=t.outGlowBlend?t.outGlowBlend:"screen",this.strokeActive=t.strokeA||!1,this.strokeOmits=t.strokeO||"",this.strokeXoffset=t.strokeX?Length.deserialize(t.strokeX):new Length("0%"),this.strokeYoffset=t.strokeY?Length.deserialize(t.strokeY):new Length("0%"),this.strokeBlurRadius=t.strokeBlur?Length.deserialize(t.strokeBlur):new Length("0%"),this.strokeSpreadRadius=t.strokeSpread?Length.deserialize(t.strokeSpread):new Length("2%"),this.strokeEffectColor=t.strokeColor?new ColorRef(t.strokeColor.id,t.strokeColor):ColorRef.Black_Color(),this.strokeBlend=t.strokeBlend?t.strokeBlend:"normal",this.inGlowActive=t.inGlowA||!1,this.inGlowOmits=t.inGlowO||"",this.inGlowArea=t.inGlowArea||"combined",this.inGlowXoffset=t.inGlowX?Length.deserialize(t.inGlowX):new Length("0%"),this.inGlowYoffset=t.inGlowY?Length.deserialize(t.inGlowY):new Length("0%"),this.inGlowBlurRadius=t.inGlowBlur?Length.deserialize(t.inGlowBlur):new Length("5%"),this.inGlowSpreadRadius=t.inGlowSpread?Length.deserialize(t.inGlowSpread):new Length("0%"),this.inGlowColor=t.inGlowColor?new ColorRef(t.inGlowColor.id,t.inGlowColor):new ColorRef(new Color(255,255,0,0,0,100,0,95,-7,95,"C=0 M=0 Y=100 K=0","cmyk","process","write",!0,void 0,.004)),this.inGlowBlend=t.inGlowBlend?t.inGlowBlend:"screen",this.turbulenceActive=t.turbA||!1,this.turbulenceOmits=t.turbO||"",this.turbulenceFrequency=t.turbF||2,this.turbulenceOctaves=t.turb8||1,this.turbulenceScale=t.turbS||25,this.bevelActive=t.bevelA||!1,this.bevelOmits=t.bevelO||"",this.bevelBlur="object"==typeof t.bevelB?Length.deserialize(t.bevelB):new Length(5,"%"),this.bevelPointLightX=t.bevelPLX||6100,this.bevelPointLightY=t.bevelPLY||-6300,this.bevelPointLightZ=t.bevelPLZ||1e3,this.bevelSurfaceScale=t.bevelSS||2,this.bevelSpecularConstant=t.bevelSC||.6,this.bevelspecularExponent=t.bevelSE||15,this.bevelLightColor=t.bevelColor?new ColorRef(t.bevelColor.id,t.bevelColor):ColorRef.Paper_Color()}}get maskImage(){const e=scope().images.get(this.maskImageId);return e||Image$1.maskImage()}serialize(){const e={};return this.blurActive&&(e.blurA=this.blurActive,e.blurO=this.blurOmits,e.blurI=this.blurIntensity),this.maskActive&&(e.maskA=this.maskActive,e.maskO=this.maskOmits,e.maskC=this.maskChannel,e.maskI=this.maskInverse,e.maskImgId=this.maskImageId,e.maskImg=this.maskImage.serialize().data),e.blendM=this.blendMode,e.opa=this.opacity,e.bright=this.brightness,e.contrast=this.contrast,e.hue=this.hueRotate,e.sat=this.saturate,e.invert=this.invert,e.sepia=this.sepia,e.gray=this.grayscale,this.dropActive&&(e.dropA=this.dropActive,e.dropO=this.dropOmits,e.dropX=this.dropXoffset.serialize(),e.dropY=this.dropYoffset.serialize(),e.dropBlur=this.dropBlurRadius.serialize(),e.dropSpread=this.dropSpreadRadius.serialize(),e.dropColor=this.dropColor.serialize(),e.dropBlend=this.dropBlend),this.outGlowActive&&(e.outGlowA=this.outGlowActive,e.outGlowO=this.outGlowOmits,e.outGlowX=this.outGlowXoffset.serialize(),e.outGlowY=this.outGlowYoffset.serialize(),e.outGlowBlur=this.outGlowBlurRadius.serialize(),e.outGlowSpread=this.outGlowSpreadRadius.serialize(),e.outGlowColor=this.outGlowColor.serialize(),e.outGlowBlend=this.outGlowBlend),this.strokeActive&&(e.strokeA=this.strokeActive,e.strokeO=this.strokeOmits,e.strokeX=this.strokeXoffset.serialize(),e.strokeY=this.strokeYoffset.serialize(),e.strokeBlur=this.strokeBlurRadius.serialize(),e.strokeSpread=this.strokeSpreadRadius.serialize(),e.strokeColor=this.strokeEffectColor.serialize(),e.strokeBlend=this.strokeBlend),this.inGlowActive&&(e.inGlowA=this.inGlowActive,e.inGlowO=this.inGlowOmits,e.inGlowArea=this.inGlowArea,e.inGlowX=this.inGlowXoffset.serialize(),e.inGlowY=this.inGlowYoffset.serialize(),e.inGlowBlur=this.inGlowBlurRadius.serialize(),e.inGlowSpread=this.inGlowSpreadRadius.serialize(),e.inGlowColor=this.inGlowColor.serialize(),e.inGlowBlend=this.inGlowBlend),this.inShadowActive&&(e.inShadowA=this.inShadowActive,e.inShadowO=this.inShadowOmits,e.inShadowArea=this.inShadowArea,e.inShadowX=this.inShadowXoffset.serialize(),e.inShadowY=this.inShadowYoffset.serialize(),e.inShadowBlur=this.inShadowBlurRadius.serialize(),e.inShadowSpread=this.inShadowSpreadRadius.serialize(),e.inShadowColor=this.inShadowColor.serialize(),e.inShadowBlend=this.inShadowBlend),this.turbulenceActive&&(e.turbA=!0,e.turbO=this.turbulenceOmits,e.turb8=this.turbulenceOctaves,e.turbF=this.turbulenceFrequency,e.turbS=this.turbulenceScale),this.bevelActive&&(e.bevelA=!0,e.bevelO=this.bevelOmits,e.bevelPLX=this.bevelPointLightX,e.bevelPLY=this.bevelPointLightY,e.bevelPLZ=this.bevelPointLightZ,e.bevelColor=this.bevelLightColor.serialize(),e.bevelB=this.bevelBlur.serialize(),e.bevelSC=this.bevelSpecularConstant,e.bevelSE=this.bevelspecularExponent,e.bevelSS=this.bevelSurfaceScale),e}}class Transform extends NobsBase{constructor(e,t){if(super(e,t),!(e instanceof Nobs)){let t={};"object"==typeof e&&(t=e),this.warpArchActive=t.archA||!1,this.warpArchOmits=t.archO||"",this.warpArchPhi=t.archP||0===t.archP?t.archP:150,this.warpArchPosition=t.archPos?t.archPos:"inner",this.warpArchMirror=t.archM?t.archM:"off",this.warpCupActive=t.cupA||!1,this.warpCupOmits=t.cupO||"",this.warpCupY=t.cupY||0,this.warpCupPhi=t.cupP||0===t.cupP?t.cupP:150,this.warpFishActive=t.fishA||!1,this.warpFishOmits=t.fishO||"",this.warpFishHeightFraction=t.fishH||0===t.fishH?t.fishH:.5,this.warpFishWaves=t.fishW||1,this.warpFlagActive=t.flagA||!1,this.warpFlagOmits=t.flagO||"",this.warpFlagHeightFraction=t.flagH||0===t.flagH?t.flagH:.5,this.warpFlagWaves=t.flagW||1,this.warpFlagPhase=t.flagP||0,this.warpArcActive=t.arcA||!1,this.warpArcOmits=t.arcO||"",this.warpArcPosition=t.arcP||"bulge",this.warpArcHeightFraction=t.arcH||0===t.arcH?t.arcH:.5,this.warpPitActive=t.pitA||!1,this.warpPitOmits=t.pitO||"",this.warpPitPosition=t.pitP||"squeeze",this.warpPitHeightFraction=t.pitH||0===t.pitH?t.pitH:.5,this.warpCustomActive=t.custA||!1,this.warpCustomOmits=t.custO||"",this.warpCustomTopTransform=t.custTT||"none",this.warpCustomTopWaves=t.custTW||1,this.warpCustomTopPhase=t.custTP||0,this.warpCustomTopHeightFraction=t.custTH||0,this.warpCustomBottomTransform=t.custBT||"none",this.warpCustomBottomWaves=t.custBW||1,this.warpCustomBottomPhase=t.custBP||0,this.warpCustomBottomHeightFraction=t.custBH||0,this.perspectiveActive=t.perpA||!1,this.perspectiveOmits=t.perpO||"",t.perp?this.perspectiveGeometry=new PathGeometry(t.perp):this.perspectiveGeometry=PathGeometry.createBoxRectPath(),this.meshActive=t.meshA||!1,this.meshOmits=t.meshO||"",this.meshColumns=t.meshC||8,this.meshRows=t.meshR||5,t.mesh?this.meshGeometry=new PathGeometry(t.mesh,this.meshColumns,this.meshRows):this.meshGeometry=PathGeometry.createGridPath(this.meshColumns,this.meshRows),this.distortActive=t.distortA||!1,this.distortOmits=t.distortO||"",this.distortFrequency=t.distortF||2,this.distortOctaves=t.distort8||1,this.distortScale=t.distortS||25}this.meshActive&&this.meshGeometry&&this.meshGeometry.path.length!==this.meshRows*this.meshColumns&&(this.meshGeometry=this.meshGeometry.getAdjustedGridPath(this.meshColumns,this.meshRows))}anyTransformActive(){return this.distortActive||this.perspectiveActive||this.meshActive||this.warpArcActive||this.warpCupActive||this.warpPitActive||this.warpArchActive||this.warpFishActive||this.warpFlagActive||this.warpCustomActive}serialize(){var e,t;const o={};return this.perspectiveActive&&(o.perpA=this.perspectiveActive,o.perpO=this.perspectiveOmits,o.perp=null===(e=this.perspectiveGeometry)||void 0===e?void 0:e.serialize()),this.meshActive&&(o.meshA=!0,o.meshO=this.meshOmits,o.meshC=this.meshColumns,o.meshR=this.meshRows,o.mesh=null===(t=this.meshGeometry)||void 0===t?void 0:t.serialize()),this.distortActive&&(o.distortA=!0,o.distortO=this.distortOmits,o.distort8=this.distortOctaves,o.distortF=this.distortFrequency,o.distortS=this.distortScale),this.warpArchActive&&(o.archA=!0,o.archO=this.warpArchOmits,o.archP=this.warpArchPhi,o.archPos=this.warpArchPosition,o.archM=this.warpArchMirror),this.warpCupActive&&(o.cupA=!0,o.cupO=this.warpCupOmits,o.cupY=this.warpCupY,o.cupP=this.warpCupPhi),this.warpFishActive&&(o.fishA=!0,o.fishO=this.warpFishOmits,o.fishW=this.warpFishWaves,o.fishH=this.warpFishHeightFraction),this.warpFlagActive&&(o.flagA=!0,o.flagO=this.warpFlagOmits,o.flagP=this.warpFlagPhase,o.flagW=this.warpFlagWaves,o.flagH=this.warpFlagHeightFraction),this.warpArcActive&&(o.arcA=!0,o.arcO=this.warpArcOmits,o.arcP=this.warpArcPosition,o.arcH=this.warpArcHeightFraction),this.warpPitActive&&(o.pitA=!0,o.pitO=this.warpPitOmits,o.pitP=this.warpPitPosition,o.pitH=this.warpPitHeightFraction),this.warpCustomActive&&(o.custA=!0,o.custO=this.warpCustomOmits,o.custTT=this.warpCustomTopTransform,o.custTH=this.warpCustomTopHeightFraction,o.custTP=this.warpCustomTopPhase,o.custTW=this.warpCustomTopWaves,o.custBT=this.warpCustomBottomTransform,o.custBH=this.warpCustomBottomHeightFraction,o.custBP=this.warpCustomBottomPhase,o.custBW=this.warpCustomBottomWaves),o}}class StoryRef extends NobsBase{constructor(e,t,o="height"){if(super(e,t),"string"==typeof e){if(this.storyId=e,"number"==typeof t)this.order=t;else{const e=scope().getStory(this.storyId);this.order=e?getOrder(e.getMaxOrder(),1):.2}o&&(this.autoTextMode=o)}else if(!(e instanceof Nobs)){const t=e;this.storyId=t.sId,this.order=t.or,this.frameRepeat=t.rep,t.miw&&(this.minWidth=Length.deserialize(t.miw)),t.mih&&(this.minHeight=Length.deserialize(t.mih)),t.maw&&(this.maxWidth=Length.deserialize(t.maw)),t.mah&&(this.maxHeight=Length.deserialize(t.mah)),t.atm&&(this.autoTextMode=t.atm),t.wof&&(this.wrapShapeOffset=Length.deserialize(t.wof)),t.wad||0===t.wad?this.wrapAscenderDiminisher=t.wad:this.wrapAscenderDiminisher=1,t.trans&&(this.textTransform=t.trans),t.va&&(this.verticalStoryTextAlign=t.va),!0===t.ubg?this.useBaselineGrid=!0:this.useBaselineGrid=!1,t.fbl&&(this.firstBaseline=t.fbl)}this.storyId||(this.storyId=""),this.frameRepeat||(this.frameRepeat="none"),void 0===this.useBaselineGrid&&(this.useBaselineGrid=!1),void 0===this.firstBaseline&&(this.firstBaseline="ascender"),this.order||(this.order=.5*Math.random()),this.minHeight||(this.minHeight=new Length(50,"px")),this.maxHeight||(this.maxHeight=new Length(80,"%")),this.minWidth||(this.minWidth=new Length(50,"px")),this.maxWidth||(this.maxWidth=new Length(80,"%")),this.autoTextMode||(this.autoTextMode="off"),this.verticalStoryTextAlign||(this.verticalStoryTextAlign="top"),this.textTransform||(this.textTransform="mixed"),this.wrapShapeOffset||(this.wrapShapeOffset=new Length("0px")),this.wrapAscenderDiminisher||0===this.wrapAscenderDiminisher||(this.wrapAscenderDiminisher=1)}get story(){return scope().getStory(this.storyId)}flowIndex(e){const t=this.story;if(t&&t.myBoxes.size>1){let o=0;for(const i of t.myBoxes.keys())if(o++,i===e)return o}return 0}toString(){return this.storyId}serialize(e=!1){const t={sId:this.storyId,or:this.order,rep:this.frameRepeat,miw:this.minWidth.serialize(),mih:this.minHeight.serialize(),mah:this.maxHeight.serialize(),maw:this.maxWidth.serialize(),atm:this.autoTextMode,wof:this.wrapShapeOffset.serialize(),wad:this.wrapAscenderDiminisher,ubg:this.useBaselineGrid,fbl:this.firstBaseline,trans:this.textTransform,va:this.verticalStoryTextAlign};if(e){const e=this.story;e&&(t.story=e.serialize(!0).data)}return t}}var __awaiter$b=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};const uploadedUrls=new Map;function parseFileNameFromUrl(e){const t=e.split("/");return t[t.length-1].split("?")[0]}function upload(e,t,o){var i;return __awaiter$b(this,void 0,void 0,(function*(){const r=uploadedUrls.get(e);if(r)return r;const s=yield fetch(e),n=yield s.blob(),a=yield o.upload(BlobToFormData(t,n,null===(i=o.beforeAddingFormData)||void 0===i?void 0:i.bind(o)));return uploadedUrls.set(e,a),a}))}function uploadImageStore(e,t){return __awaiter$b(this,void 0,void 0,(function*(){const o=yield upload(e.u,parseFileNameFromUrl(e.u),t);if(e.u=o.url,e.sc)for(let o=0;o<e.sc.length;o++){const i=e.sc[o],r=yield upload(i.u,parseFileNameFromUrl(i.u),t);i.u=r.url,i.id=r.id,r.userState?i.us=r.userState:i.us=""}return o.id}))}function uploadImage(e,t){return __awaiter$b(this,void 0,void 0,(function*(){e.id=yield uploadImageStore(e.data,t)}))}function uploadImageReference(e,t){return __awaiter$b(this,void 0,void 0,(function*(){e.id=yield uploadImageStore(e.im,t)}))}function uploadFontStore(e,t){return __awaiter$b(this,void 0,void 0,(function*(){const o=yield upload(e.u,parseFileNameFromUrl(e.u),t);if(e.u=o.url,e.tsu){const o=yield upload(e.tsu,parseFileNameFromUrl(e.tsu),t);e.tsu=o.url}return o.id}))}function uploadFont(e,t){return __awaiter$b(this,void 0,void 0,(function*(){e.id=yield uploadFontStore(e.data,t)}))}function uploadFontReference(e,t){return __awaiter$b(this,void 0,void 0,(function*(){e.id=yield uploadFontStore(e.fo,t)}))}function uploadSimpleTextResources(e,t){return __awaiter$b(this,void 0,void 0,(function*(){yield uploadFontReference(e.fnt,t)}))}function uploadPathTextResources(e,t){return __awaiter$b(this,void 0,void 0,(function*(){yield uploadFontReference(e.fnt,t)}))}function extractStoryFonts(e){const t=[];for(const o of e.stories)for(const e of o.data.txt.a){e.s&&e.s.fn&&t.push(e.s.fn);for(const o of e.w)if("string"!=typeof o&&o.s)for(const e of o.s)e.s&&e.s.fn&&t.push(e.s.fn)}return t}function transfer(e,t,o,i,r){return __awaiter$b(this,void 0,void 0,(function*(){const s=yield t.load(e);for(let e=0;e<s.images.length;e++){const t=s.images[e];yield uploadImage(t,r)}for(let e=0;e<s.fonts.length;e++){const t=s.fonts[e];yield uploadFont(t,r)}for(const e of s.stories)for(const t of e.data.txt.a){t.s&&t.s.fn&&uploadFontReference(t.s.fn,r);for(const e of t.w)if("string"!=typeof e&&e.s)for(const t of e.s)t.s&&t.s.fn&&uploadFontReference(t.s.fn,r)}for(const e of s.documents){for(const t of e.data.ffs)if(t.allImages)for(const e of t.allImages)yield uploadImageStore(e.data,r);for(const t of e.data.sps)if(t.boxes)for(const e of t.boxes)e.data.stxt&&(yield uploadSimpleTextResources(e.data.stxt,r)),e.data.ptxt&&(yield uploadPathTextResources(e.data.ptxt,r)),e.data.img&&(yield uploadImageReference(e.data.img,r)),e.data.effect&&e.data.effect.maskImg&&(yield uploadImageStore(e.data.effect.maskImg,r))}const n=JSON.stringify(s);yield i.save(o,n)}))}function transferScopeId(e){return __awaiter$b(this,void 0,void 0,(function*(){const t=createPrintessApiFromExternalConfig(),o=new ApiUploadProvider(t),i=new ApiDocumentProvider(t);return transfer(e,new DevDocumentProvider("https://dev-wand.printess.com"),e,i,o)}))}function transferToEagle(){return __awaiter$b(this,void 0,void 0,(function*(){const e="eyJhbGciOiJSUzI1NiIsImtpZCI6InByaW50ZXNzLXNhYXMtYWxwaGEiLCJ0eXAiOiJKV1QifQ.eyJzdWIiOiJmczIyQm9kYUw3UG9BaWJrUDRrTjBvejZsMDMzIiwianRpIjoiamRuaEtCeWhRUnluU3M3ekFFWFl1V0lPZFlQN0FPZ1giLCJuYmYiOjE2MTQ5NTQ1MzksImV4cCI6MTYxNTA0MDkzOSwiaWF0IjoxNjE0OTU0NTM5LCJpc3MiOiJQcmludGVzcyBHbWJIICYgQ28uS0ciLCJhdWQiOiJwcmludGVzcy1zYWFzIn0.T81acL8HU1A8u-r0ZK1mb3iwFpxOlFPfaoM35j1vXDCONHmDWUpbI8MlpB4JyiKRiXE01pm_ja8VDI-Y82ZsCeYmZPGtj_IcoQZ14L9kWMLL3WZABrEkUsjBJx2pkdVkrNOQlMqWecmdNyE2drqmAippQ8Y_C_G6NODO0UFHSbrJ9xCEra0XIqUy1ZIq0PizX0M_oZQHAjahZv4gxWsKxtd14JlYg2G6TCppHsmof3mqdNzDCzJHBEloJz6oWxgkiaJTPgWN1oUvlC8WLVeaDf2ykibi2qyoTOkSFxP8kIiTsXyeusjJz3xSUhtwumyJH7Hfv4aDYLWkqM9jcYMAEyWkptPZ5qaH07a_6hRWCFOakc_kLf32jz-1GMcAfSQ9Wnul3A205a-AXg1Ku31iyzHGzVxriG61vktEpyZi2uURFG-W1vPjr_0UITjwLEMI1yNdKi5j2vwpF1GZyc93w3J65NspJ8ey9FIjyU_Rbm4fBep0qQ_r2H4uJfvGJfUIvPheHyM1lFoVFpRQ7G80Sn5SxMfmhrrzDl4JE-hsQxqEXWn5ZbZ7Avo1yw0bRNC89pHQewvVZn7oLgxqfr3WnRKf2lrC7FrKj8aEe01Ba1CYyo5ZTuOBikXRSe2CHPSL3wzc-vvH0Xpx7XqL-nGwAk7VXFptoBDd271yH5TDfTs",t=new Api("dev-aws.printess.com",e),o=new ApiDocumentProvider(t),i=new Api("eagle.printess.com",e),r=new ApiDocumentProvider(i),s=new ApiUploadProvider(i),n=[];config.isAutomationMode=!0;for(let e=0;e<n.length;e++){const t=n[e],i=t.toLowerCase();yield transfer(i,o,t,r,s)}config.isAutomationMode=!1,alert("done")}))}function transferCurrentToEagle(){return __awaiter$b(this,void 0,void 0,(function*(){const e=createPrintessApiFromExternalConfig(),t=new ApiDocumentProvider(e),o=new Api("eagle.printess.com","eyJhbGciOiJSUzI1NiIsImtpZCI6InByaW50ZXNzLXNhYXMtYWxwaGEiLCJ0eXAiOiJKV1QifQ.eyJzdWIiOiJmczIyQm9kYUw3UG9BaWJrUDRrTjBvejZsMDMzIiwianRpIjoiN0lzSG90eGJSSF9lVUpCVVlRZkRTVk40eUlHZE9XamwiLCJyb2xlIjoicHJvZHVjZXIiLCJuYmYiOjE2MTUzNjk3NjcsImV4cCI6MTY0NjkwNTc2NywiaWF0IjoxNjE1MzY5NzY3LCJpc3MiOiJQcmludGVzcyBHbWJIICYgQ28uS0ciLCJhdWQiOiJwcmludGVzcy1zYWFzIn0.tSzB3VH5rfapNb_ZEgMmHhzVsBPEZfZy4vkkMY-P4jh9CjF4c9QVh7LzAvANzmpR4UMu7UbGmo2rL5Ya9wPQDbmT0ytSiZKaK-GnGq4rTNPSBLFDt4hX8FNy0nf5y8Ueuzi_rzs-2HN4QXODewWN8JSg8-kxGaDyeGCAOtqqVAseF8nnhPxgvLdyNmvtac1_DP5gRY0q0xQ_B6dpg9ozv6lFIhRwsBENxmqU8VVcPgNjgxKOqGs0MGtrdPtW2IJra16qHrcB_jqBOFyLt35cnDQUZM7d-ezD_XCIEM5K3B-bx3MNiVgYnWEn740TnsOOGvq9s6ZsTruGF0Kh8nV5X6xKV1c7id8blLQ67cDnMcOfBr6WWFf1l4IhuT27yb6-BHRvC40fQTcrsdsPtCnemRHNrmaDiqwPYnATDMDlR4CcZtrR6fI0lCDq_SGN63WRUVhCSCaJKarXFl6cISEXqpQPs8I9DbPS93iXyXZTtyu3ZdbG8PTd-meUHGEjpCUdYb_ALKbJRGbIbxk_zbLto0B10eZ5gcmg-2Ss3zrbNG9kG24av3YMjSuwzFDxqveJwR2bQuGNDA6Z5GiJ6nWd9TaqCgpOsvrirCb8GNjHG78jXoRwXKgMcYKxV-KBoMEfP239Ph9p_Dg0WpauaR8ls6dzayK0V3MMc2uLVU0BZ3g"),i=new ApiDocumentProvider(o),r=new ApiUploadProvider(o);config.isAutomationMode=!0;const s=scope().serializeAll(),n=s.template.id;i.save(n,JSON.stringify(s)),yield transfer(n,t,n,i,r),config.isAutomationMode=!1,alert("done")}))}var __awaiter$c=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};class TemplateProperties extends NobsBase{constructor(e,t){if(super(e,t),!(e instanceof Nobs)){const t=e;this.productMatrixRow=t.mpr||0,this.showStyleBadges=t.sb||!1,this.showGrid=t.sgr||!1,this.showSmartGuides="boolean"!=typeof t.smg||t.smg,this.gridSize=t.gsz||"1mm",this.colorScheme=t.cs||"",this.dataPanelHeight=t.dph||0,this.resourcesPanelWidth=t.rpw||0,this.propertiesPanelWidth=t.ppw||0,this.generatePageThumbnails=!1!==t.gpt,this.includeGlobalSnippets=!1!==t.igs,this.includeTemplateSnippets=!1!==t.its,this.showDocumentSizeFormField=!0===t.dsf}}serialize(){const e={mpr:this.productMatrixRow,mp:scope().matrixProduct,cs:this.colorScheme,sb:this.showStyleBadges,sgr:this.showGrid,smg:this.showSmartGuides,dph:this.dataPanelHeight,ppw:this.propertiesPanelWidth,rpw:this.resourcesPanelWidth,gsz:this.gridSize,gpt:this.generatePageThumbnails,igs:this.includeGlobalSnippets,its:this.includeTemplateSnippets,dsf:this.showDocumentSizeFormField};return{id:scope().id,scopeId:scope().id,parentId:null,type:"template",data:e}}applyCurrentSettings(){this.setDataPanelHeight(this.dataPanelHeight)}toggleStyleBadges(){return __awaiter$c(this,void 0,void 0,(function*(){const e=(new Nobs).setProperty(this,"showStyleBadges",!this.showStyleBadges),t=new TemplateProperties(e,this).serialize();yield update([this.serialize()],[t],void 0,!1),scope().reRenderAllStories(),scope().currentDoc.spreads.forEach((e=>e.boxOrderHasChanged=!0)),scope().docUi.resetCache=!0,yield scope().docUi.requestUpdate()}))}toggleSmartGuides(){return __awaiter$c(this,void 0,void 0,(function*(){const e=(new Nobs).setProperty(this,"showSmartGuides",!this.showSmartGuides),t=new TemplateProperties(e,this).serialize();yield update([this.serialize()],[t],void 0,!1)}))}togglePageThumbnails(){return __awaiter$c(this,void 0,void 0,(function*(){const e=(new Nobs).setProperty(scope().templateProperties,"generatePageThumbnails",!this.generatePageThumbnails),t=new TemplateProperties(e,scope().templateProperties);yield update([scope().templateProperties.serialize()],[t.serialize()]),scope().reRenderAllStories()}))}toggleIncludeGlobalSnippets(){return __awaiter$c(this,void 0,void 0,(function*(){const e=(new Nobs).setProperty(scope().templateProperties,"includeGlobalSnippets",!this.includeGlobalSnippets),t=new TemplateProperties(e,scope().templateProperties);yield update([scope().templateProperties.serialize()],[t.serialize()]),scope().resourcesSnippetsUi.reload()}))}toggleIncludeTemplateSnippets(){return __awaiter$c(this,void 0,void 0,(function*(){const e=(new Nobs).setProperty(scope().templateProperties,"includeTemplateSnippets",!this.includeTemplateSnippets),t=new TemplateProperties(e,scope().templateProperties);yield update([scope().templateProperties.serialize()],[t.serialize()]),scope().resourcesSnippetsUi.reload()}))}toggleShowDocumentSize(){return __awaiter$c(this,void 0,void 0,(function*(){const e=(new Nobs).setProperty(scope().templateProperties,"showDocumentSizeFormField",!this.showDocumentSizeFormField),t=new TemplateProperties(e,scope().templateProperties);yield update([scope().templateProperties.serialize()],[t.serialize()]),scope().resourcesFormFieldsUi.refreshGlobalList()}))}toggleDataPanel(){return __awaiter$c(this,void 0,void 0,(function*(){let e=200;scope().templateProperties.dataPanelHeight>0&&(e=0),this.setDataPanelHeight(e)}))}setDataPanelHeight(e){return __awaiter$c(this,void 0,void 0,(function*(){const t=(new Nobs).setProperty(scope().templateProperties,"dataPanelHeight",e),o=new TemplateProperties(t,scope().templateProperties);yield update([scope().templateProperties.serialize()],[o.serialize()]),setMainMobileGridRows(),scope().productMatrixUi.requestUpdate()}))}setGridSize(e){return __awaiter$c(this,void 0,void 0,(function*(){const t=scope().docUi.shadowRoot,o=(new Nobs).setProperty(scope().templateProperties,"gridSize",e),i=new TemplateProperties(o,scope().templateProperties);if(yield update([scope().templateProperties.serialize()],[i.serialize()]),t)for(const e of t.querySelectorAll("WC-SPREAD")){const t=e;t&&t.requestUpdate()}}))}get gridStepInPx(){const e=3.77952804;switch(this.gridSize){case"1mm":return e;case"5mm":return 5*e;case"1cm":return 10*e;case"10px":return 10;case"5px":return 5;case"4.5pt":return 1.3*4.5;case'0.25" / 18pt':return 19.3;case'0.125" / 9pt':return 1.3*9;default:assertNever$1(this.gridSize)}}}var __awaiter$d=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};function typeNumber(e){switch(e){case"design":return 0;case"published":return 1;default:assertNever$1(e)}}function thumbnailId(e,t,o,i){return`doc_si_${t}_pi_${o}_tn_${typeNumber(i)}_${e}`}function thumbnailBackgroundId(e,t,o,i){return`doc_si_${t}_pi_${o}_tn_${typeNumber(i)}_${e}_bg`}function saveTemplateThumbnails(e,t,o,i,r){var s;return __awaiter$d(this,void 0,void 0,(function*(){let n=0;const a=[],l=new FormData;let c=null;l.append("id",t.scopeId),l.append("tid",null!==(s=t.userId)&&void 0!==s?s:"");for(const e of o.documents)if(e.data.thu){c=thumbnailId(e.id,0,0,i);break}if(!c)for(const e of o.documents)if(e.data.pri){c=thumbnailId(e.id,0,0,i);break}try{try{const t={};for(let e=0;e<o.documents.length;e++){const s=o.documents[e];if(t[s.id]=s.data.na,0==s.data.sps.length){r&&(n+=1/(o.documents.length+1),r(n));continue}const d=s.data.sps;for(let e=0;e<d.length;e++){const t=d[e];c||(c=thumbnailId(s.id,e,0,i)),s.data.sps=[t];const r=yield hb.Printess.renderDocumentImagesAsInMemoryData(o,s.data.na,200,200,!1);a.push(...r);for(let t=0;t<r.length;t++){const o=r[t],n=new Uint8Array(hb.heapu8().buffer,o.address,o.length),a=new Blob([n]);l.append(thumbnailId(s.id,e,t,i),a),l.append(thumbnailBackgroundId(s.id,e,t,i),hb.Printess.getCssColor(s.data.bg))}}r&&(n+=1/(o.documents.length+1),r(n))}l.append("pt",null!=c?c:""),l.append("di",JSON.stringify(t)),yield e.saveTemplateThumbnails(l)}finally{a.forEach((e=>hb.free(e.address)))}}catch(e){console.error("Could not generate thumbnails: "+e)}finally{r&&r(1)}}))}function multiSleepZero(e){return __awaiter$d(this,void 0,void 0,(function*(){for(let t=0;t<e;t++)yield sleep(0)}))}function toCase(e,t){switch(t){case"lower":return e.toLowerCase();case"normal":return e;default:assertNever$1(t)}}function go$1(e,t,o,i){return __awaiter$d(this,void 0,void 0,(function*(){for(const r of t)try{const t=yield e.loadTemplateFromUser(toCase(r.scopeId,o),r.userId);removeUnusedStories(t),yield loadScope(t),yield multiSleepZero(5);const s=scope().serializeAll(!0);yield e.saveTemplate(r.scopeId,JSON.stringify(s),r.userId),"generateThumbnails"===i&&(yield saveTemplateThumbnails(e,r,s,"design"))}catch(e){console.error(e)}}))}function saverExecute(e,t,o,i){scopeReady((function(){return __awaiter$d(this,void 0,void 0,(function*(){config.isAutomationMode=!0;try{yield go$1(e,t,o,i),alert("Saver finished!")}finally{config.isAutomationMode=!1}}))}))}var __awaiter$e=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};class WcCopyModelDialog extends LitElement{constructor(e={template:{type:"scope",id:"bla",scopeId:scope().id,parentId:null,data:new TemplateProperties({}).serialize().data},colors:[],fonts:[],images:[],style:void 0,stories:[],documents:[],formFields:[],productMatrix:new ProductMatrix({}).serialize(),dateISO:(new Date).toISOString()}){super(),this.status=null,this.simpleText=new SimpleText,this.pathGeometry=PathGeometry.createStarPath(),this.pathText=new PathText,this.boxGeometry=new BoxGeometry,this.basics=new Basics,this.effects=new Effect,this.transform=new Transform,this.docref=new DocRef("",""),this.storyRef=new StoryRef("id"),this.imgRef=new ImageRef("id",{id:"xxx",def:"xxx",m:"none",ip:"fill",im:{g:"",h:1e3,w:1e3,u:"http://printess.com/some.png",na:"image",or:0,t:"external"},px:0,py:0,ws:1,hs:1,hc:.5,vc:.5}),this.store=e,this.model=JSON.stringify(e,null,0),this.backdrop=new WcBackdrop}showDialog(e){this.callback=e,document.body.appendChild(this.backdrop),document.body.appendChild(this)}closeDialog(){document.body.removeChild(this.backdrop),document.body.removeChild(this)}showRects(){const e=scope().docUi.currentSpread,t={game:{w:scope().currentDoc.pxWidth(),h:scope().currentDoc.pxHeight()},walls:[]};for(const o of e.boxes.values()){const i=o.boxGeometry.toPixel(e.width(),e.height());t.walls.push({x:i.left,y:i.top,w:i.width,h:i.height}),this.model=JSON.stringify(t,void 0,2),this.requestUpdate()}}renderDocumentViaLocalhost(){fetch("http://localhost:9898/json",{headers:{"Content-Type":"text/plain; charset=utf-8"},method:"POST",body:this.model}).then((e=>{e.text().then((e=>alert(e)))}))}renderTestDocumentViaLocalhost(){fetch("http://localhost:9898/pdf",{headers:{"Content-Type":"text/plain; charset=utf-8"},method:"POST",body:JSON.stringify({json:""})}).then((e=>{e.text().then((e=>alert(e)))}))}transferScope(){const e=prompt("Enter scope id to transfer from dev to current api user.");e&&transferScopeId(e).then((()=>alert("Transferred."))).catch((e=>alert(e)))}saver(){saverExecute(new Api("eagle.printess.com","eyJhbGciOiJSUzI1NiIsImtpZCI6InByaW50ZXNzLXNhYXMtYWxwaGEiLCJ0eXAiOiJKV1QifQ.eyJzdWIiOiJmczIyQm9kYUw3UG9BaWJrUDRrTjBvejZsMDMzIiwianRpIjoiamRuaEtCeWhRUnluU3M3ekFFWFl1V0lPZFlQN0FPZ1giLCJuYmYiOjE2MTQ5NTQ1MzksImV4cCI6MTYxNTA0MDkzOSwiaWF0IjoxNjE0OTU0NTM5LCJpc3MiOiJQcmludGVzcyBHbWJIICYgQ28uS0ciLCJhdWQiOiJwcmludGVzcy1zYWFzIn0.T81acL8HU1A8u-r0ZK1mb3iwFpxOlFPfaoM35j1vXDCONHmDWUpbI8MlpB4JyiKRiXE01pm_ja8VDI-Y82ZsCeYmZPGtj_IcoQZ14L9kWMLL3WZABrEkUsjBJx2pkdVkrNOQlMqWecmdNyE2drqmAippQ8Y_C_G6NODO0UFHSbrJ9xCEra0XIqUy1ZIq0PizX0M_oZQHAjahZv4gxWsKxtd14JlYg2G6TCppHsmof3mqdNzDCzJHBEloJz6oWxgkiaJTPgWN1oUvlC8WLVeaDf2ykibi2qyoTOkSFxP8kIiTsXyeusjJz3xSUhtwumyJH7Hfv4aDYLWkqM9jcYMAEyWkptPZ5qaH07a_6hRWCFOakc_kLf32jz-1GMcAfSQ9Wnul3A205a-AXg1Ku31iyzHGzVxriG61vktEpyZi2uURFG-W1vPjr_0UITjwLEMI1yNdKi5j2vwpF1GZyc93w3J65NspJ8ey9FIjyU_Rbm4fBep0qQ_r2H4uJfvGJfUIvPheHyM1lFoVFpRQ7G80Sn5SxMfmhrrzDl4JE-hsQxqEXWn5ZbZ7Avo1yw0bRNC89pHQewvVZn7oLgxqfr3WnRKf2lrC7FrKj8aEe01Ba1CYyo5ZTuOBikXRSe2CHPSL3wzc-vvH0Xpx7XqL-nGwAk7VXFptoBDd271yH5TDfTs"),csns.map((e=>({scopeId:e}))),"normal","generateThumbnails")}backendProducer(){return __awaiter$e(this,void 0,void 0,(function*(){const e=new Api("eagle.printess.com","eyJhbGciOiJSUzI1NiIsImtpZCI6InByaW50ZXNzLXNhYXMtYWxwaGEiLCJ0eXAiOiJKV1QifQ.eyJzdWIiOiJmczIyQm9kYUw3UG9BaWJrUDRrTjBvejZsMDMzIiwianRpIjoiUi1PMnVZTEFOYWZjVDRJamQ0bWVCQk9JMnFKTTdsaXkiLCJyb2xlIjoicHJvZHVjZXIiLCJuYmYiOjE2MTQ5NjM0NDUsImV4cCI6MTY0NjQ5OTQ0NSwiaWF0IjoxNjE0OTYzNDQ1LCJpc3MiOiJQcmludGVzcyBHbWJIICYgQ28uS0ciLCJhdWQiOiJwcmludGVzcy1zYWFzIn0.bRXSfP51vIDB1aoGZWFf3gu6VOY4HGuPv9x5jUUemZahyNNBUHcaxi76tz3qTnAjSFvZkPKdF-4s617JeraUmNZcB34ToNjYWvcmBM5s4iKDZ-6D9xcp_nbp5NOJBKhgqmiW-iO4icLpQr7t2ZqbqmISF6idKXVqzi-GFYjxzZp3DST3HbfaEoOC_J-RdscGNzoNuOE_jYNx03U09AMk_sKTVgDC0G8STbFP5L0LL6UKWkvxZTxoA7qrQgVHvcXNYoBo3VAO4TMobh73d529GvQPzB10T7h_496pZhMcuJKOd2Dc0oJ93JCAfzc3frzrSxSgjXpma7IBKESOqfj8uNYRhcwwGeljtZbQOHmZKTFgqNHFpeJpkjMDD-2yAGjWoLeqrViJowHBVji5udDl9_MoN4hY2QdbPav79dR-nxWkNMV6pkunim3U3RZntwhHJ666TDslPHYJkphPXT-B5Rrh1cKWLsfErnNU45BegPHRYOZvInooh_9hl-my4XaQ5pRtXbqQT55CSEjyxLCckcKjK1pD_9uXiDYXO2QUQs67XNWKCrBQaQ7U-kSxEiUigOWheYAFFmLvq2gDEPqNiHNCz9t1iCb7tCEL0ygEtYv-jXFcmxjZ_qtdhcHRtF_idsVi7T3vBC3RPflV2sr7R5nAIvVoWoMPbVQZvjpSy8Q"),t=new Set;for(let o=0;o<160;o++){const i=o%csns.length,r=e.produceTemplate(csns[i]);for(t.add(r),r.finally((()=>{t.delete(r)}));t.size>7;)yield Promise.race(t)}}))}renderDebugApiDocument(){createPrintessApiFromExternalConfig().debugProduce(this.store)}renderDebugApiDocumentImposed(){createPrintessApiFromExternalConfig().debugProduceImposed(this.store)}renderBackendApiDocument(){return __awaiter$e(this,void 0,void 0,(function*(){const e=createPrintessApiFromExternalConfig(),t=yield e.produce(this.store);for(this.status=yield e.getStatus(t);!this.status.isFinalStatus;)yield sleep(200),this.status=yield e.getStatus(t),this.requestUpdate("status");if(this.status.isSuccess){if(this.status.distribution)for(const e in this.status.distribution)if(Object.prototype.hasOwnProperty.call(this.status.distribution,e)){const t=this.status.distribution[e];window.open(t)}}else alert(this.status.errorDetails)}))}renderAllSnippets(){return __awaiter$e(this,void 0,void 0,(function*(){yield hb.Printess.renderAllSnippets(this.store),console_log(yield hb.Printess.loadSnippetTags(scope().templateProperties.includeGlobalSnippets)),console_log(yield hb.Printess.loadSnippets("group",["printess-default","printess-bkr"],scope().templateProperties.includeGlobalSnippets))}))}static get properties(){return{model:{type:String}}}static get styles(){return[dialogStyles,css`
      :host  {
        height: 60vh;
        width: 60vw;
      } 
    
    textarea{
        height: 100%;
        width: 100%;
        font-family: monospace;
    }
    `]}get statusInfo(){var e,t;return this.status?html`
      <p>enqueued on: ${this.status.enqueuedOn}</p>
      <p>started processing on: ${null!==(e=this.status.processingOn)&&void 0!==e?e:"unknown"}</p>
      <p>finished on: ${null!==(t=this.status.finishedOn)&&void 0!==t?t:"unknown"}</p>
      <p>is final status: ${this.status.isFinalStatus}</p>
      <p>is success: ${this.status.isSuccess}</p>
      <p>stats: ${JSON.stringify(this.status.statistics)}</p>
      `:html``}get versionInfo(){const e=getBuildVersion(),t=getBuildDate(),o=getBuildHash();return html`<span>Version: ${e}, Date: ${t}, Commit: ${o}</span><br />`}transferToEagle(){transferToEagle()}transferCurrentToEagle(){transferCurrentToEagle()}render(){return html`
      <div class="content">
            <div class="version">${this.versionInfo}</div>
            <div>
            ${this.status?this.statusInfo:""}    
            </div>
            <textarea>${this.model}</textarea>
      </div>

      <div class="footer">
        <vaadin-button style="grid-column: 0" @click=${this.renderDebugApiDocument} theme="secondary">Debug Produce</vaadin-button>
        <vaadin-button style="grid-column: 0" @click=${this.renderDebugApiDocumentImposed} theme="secondary">Debug Produce Imposed</vaadin-button>
        <vaadin-button style="grid-column: 0" @click=${this.renderBackendApiDocument} theme="secondary">Backend Produce</vaadin-button>
        <vaadin-button style="grid-column: 0" @click=${this.backendProducer} theme="secondary">Producer</vaadin-button>
        <vaadin-button style="grid-column: 0" @click=${this.renderAllSnippets} theme="secondary">Render Snippets</vaadin-button>  
        <vaadin-button style="grid-column: 1" @click=${this.renderTestDocumentViaLocalhost} theme="secondary">Print Test Localhost</vaadin-button>
        <vaadin-button style="grid-column: 1" @click=${this.transferScope} theme="secondary">Transfer</vaadin-button>
        <vaadin-button style="grid-column: 1" @click=${this.transferToEagle} theme="secondary">Transfer To Eagle</vaadin-button>
        <vaadin-button style="grid-column: 2" @click=${this.transferCurrentToEagle} theme="secondary">Transfer Current To Eagle</vaadin-button>
        <vaadin-button style="grid-column: 1" @click=${this.saver} theme="secondary">Saver</vaadin-button>
        <vaadin-button style="grid-column: 2" @click=${this.renderDocumentViaLocalhost} theme="secondary">Print Via Localhost</vaadin-button>
        <vaadin-button style="grid-column: 2" @click=${this.showPropertyToFeatureIndex} theme="secondary">Properties to features</vaadin-button>
        <vaadin-button style="grid-column: 3" @click=${this.showSubDocumentModel} theme="secondary">SubDocuments</vaadin-button>
        <vaadin-button style="grid-column: 3" @click=${this.showStyleTokens} theme="secondary">Style Properties</vaadin-button>
        <vaadin-button style="grid-column: 4" @click=${this.closeDialog} theme="secondary">CLOSE</vaadin-button>
      </div>

    `}showPropertyToFeatureIndex(){const e={};for(const t of allPropertyNamesForStyles)e[t.name]={features:this.getFeaturesByProperty(t.name).replace(/\*/g,"").split(", "),hint:""};this.model=JSON.stringify(e,void 0,2),this.requestUpdate()}showStyleTokens(){const e=[];for(const t of allPropertyNamesForStyles){const o=[];switch(o.push("**"+t.name+"**"),o.push(this.getFeaturesByProperty(t.name)),o.push(t.type),t.type){case"number":case"shapeName":case"documentName":case"spreadName":o.push(t.range);break;case"color":o.push("`[Paper]`, `gray`, `#rrggbb` (color name or webcolor)");break;case"image":o.push("`uploaded-image-name.png`, `https://homepages.cae.wisc.edu/~ece533/images/cat.png` (image name or url)");break;case"font":o.push("`Noto Sans`, `Berkshire Swash` (font name - no url)");break;default:{const e=getTokens(t.type+"Property",!1);o.push(e.tokens.map((e=>"`"+e.value+"`")).join(", "))}}e.push(o)}const t=["| Property | Features | Type | Possible Values |","|----------|----------|------|-----------------|"];for(const o of e)t.push("|"+o.join("|")+"|");this.model=t.join("\n"),this.requestUpdate()}getFeaturesByProperty(e){const t=[];return this.simpleText.hasOwnProperty(e)&&t.push("*Single Line Text*"),["font","fontSize","fontColor","tracking","baselineShift","lineHeight"].indexOf(e)>=0&&t.push("*Character / Paragraph Style*"),["horizontalTextAlign","spaceAfterParagraph","spaceBeforeParagraph","leftIndent","rightIndent","firstLineIndent","bulletMode","bulletSize","bulletShift","bulletShape","bulletColor","tabs","tabSize","tabLineColor","tabLineHeight","tabLineType"].indexOf(e)>=0&&t.push("*Paragraph-Style*"),"hyphenationLanguage"===e&&t.push("*Multi Line Text - Frame*"),this.storyRef.hasOwnProperty(e)&&"textTransform"!==e&&t.push("*Multi Line Text - Frame*"),"if"===e&&t.push("*Style Class*"),this.basics.hasOwnProperty(e)&&t.push("*Frame*"),this.boxGeometry.hasOwnProperty(e)&&t.push("*Geometry*"),this.pathGeometry.hasOwnProperty(e)&&t.push("*Shape*"),this.pathText.hasOwnProperty(e)&&t.push("*Text on Path*"),(this.imgRef.hasOwnProperty(e)||"image"===e)&&t.push("*Image*"),this.docref.hasOwnProperty(e)&&t.push("*Sub Document*"),(this.effects.hasOwnProperty(e)||"maskImage"===e)&&t.push("*Effect*"),this.transform.hasOwnProperty(e)&&t.push("*Warp*"),t.join(", ")}showSubDocumentModel(){return __awaiter$e(this,void 0,void 0,(function*(){}))}}const csns=["ps_card_bday20_littlethings_cake_p","ps_card_gen19_essentials_fullpu_p","ps_card_bday20_littlethings_bogroll_p","ps_Card_Essentials_BDay16_SimpleMulti_P","ps_CARD_Carte_B_MTY_PF_Bday19_ASU01002_P","ps_card_pgquips_bday20_wine_p","ps_card_gen19_essentials_fullpu_l","ps_card_bday20_keepcalm_quarantini_p","ps_Card_Essentials_BDay16_Multi18th_P","ps_Card_Essentials_BDay16_SimpleCircle_P","ps_card_bday19_confettiparty_circlepufem_p","ps_Card_BD18_WishyWashy_Multi4_P","ps_card_gen19_essentials_fullpu_s","ps_card_bday20_essentials_multi15pu_p","ps_card_bday19_essentials_4putextbottom_p","ps_Card_AllThatShimmers_Bday17_Female6_PU_P","ps_card_starwars_bd19_gbold_yoda_p","ps_card_bday19_essentials_4pumumpink_p","ps_card_bday20_littlethings_iou_p","ps_Card_Essentials_BDay16_Multi21st_P","ps_Card_Pigment_Bday15_AAntics_AA122_P","ps_Card_BDAY18_Essentials_HBBannerFullPU_P","ps_Card_Danilo_Strictly_FABULOUS_ST008_P","ps_card_icg_bbear_bday19_fizz_p","ps_card_bday20_essentials_3putext_p","ps_card_pigment_bday19_telegram_tf102a_gin_p","ps_Card_BDAY17_Essentials_6PU_P","ps_Card_RPA_BDay16_Hooray_P","ps_card_bday19_essentials_4putextmiddleblack_s","ps_Card_BDAY17_Essentials_4PUFloralText_P","ps_Card_BDay18_YoungHearts_BirthdayBannerPU_P","ps_Card_Essentials_BDay16_SimpleMulti_S","ps_Card_BDay17_TCrafts_CCaptions_Toast_P","ps_card_gen19_essentials_12pu_p","ps_Card_Bday17_ShineBright_NBMaleMulti_PU_P","ps_card_bday20_danilo_mrsbb_kneesup_p","ps_Card_QH_BDay17_PawPlay_BullDog_P","ps_Card_AllThatShimmers_Bday17_Male6_PU_P","ps_card_toy20_kindofabigdill_brightenyourday_p","ps_card_gen19_essentials_6pu_p","ps_card_bday19_youregold_happybeautiful_pu_p","ps_card_bday19_youregold_happybday_pu_p","ps_card_pigment_bday19_helsinki_kn401_p","ps_card_bday19_essentials_9putextbottom_p","ps_Card_Pigment_Bday15_Fabrics_Mummy_P","ps_card_ukg_bday19_minimottos_beer_p","ps_Card_HappyDays_Bday13_PinkMultiBanner_P","ps_Card_MTY_Wishes_Bday18_AlwaysFriends_P","ps_card_bday19_jt_bt030_wild_p","ps_Card_GemInt_Emoji_Bday16_241426_Nephew_P","ps_card_qh_bday19_dillydally_ordersandinstructions_p","ps_card_bday19_essentials_4puscripttextbottom_s","ps_Card_Essentials_BDay16_SimpleBlack_P","ps_CARD_Carte_B_MTY_PF_Bday19_ASC01004_P","ps_Card_Essentials_BDay16_Circle18th_P","ps_card_icg_eternal_bday19_mumpu_p","ps_Card_BDAY18_AllThatShimmers_30PU_F_P","ps_Card_Essentials_BDay16_MultiScript_P","ps_card_bday20_stupidcupid_6puframes_purple_p","ps_card_bday19_thenandnow_grandad_2pu_p","ps_CARD_Carte_B_MTY_PF_Bday_Sister_Multi_PU_P","ps_Card_Advo_BDay18_LA_LAS199957_BestDadEver_PU_P","ps_card_danilo_bday20_hp_hogwarts_p","ps_card_bday19_oldfaithful_4pupinkstars_p","ps_card_jt_fandg_bday19_fg008_fornite_pu_p","ps_Card_ColourBlock_FDay17_TheBestest_PU_P","ps_card_bday20_essentials_2putext_p","ps_card_gen19_essentials_3pu_p","ps_Card_Cardelicious_Motivational_Batman_P","ps_CARD_Carte_B_MTY_Bday_wife_P","ps_Card_FullBanner_PU_P","ps_card_bday20_kindofabigdill_fabulousday_p","ps_CARD_Carte_B_MTY_Bday_daughter_P","ps_Card_FFriends_BDay17_Love_P","ps_card_basic_fullpu_genbdf_p","ps_Card_NQ_Bday16_DS416_80th_P","ps_card_icg_eternal_bday19_husbandpu_p","ps_Card_FFriends_BDay17_Nanny_P","ps_Card_BDAY18_AllThatShimmers_21PU_F_P","ps_Card_Rhapsody_BDay16_FramePU_P","ps_CARD_Marvel_Aven_BDay17_Open_PU_P","ps_Card_Disney_Frozen_OpenPUA_P","ps_card_bday19_oldfaithful_4pumum_p","ps_Card_SwalkChalk_BDay13_MultiPolar_P","ps_CARD_Carte_B_MTY_Bday_daughter_multi_PU_P","ps_Card_SarahK_SplashyInk_SP04_SisterHeart_P","ps_card_gen19_essentials_2pu_p","ps_card_bday19_essentials_6putextbottom_s","ps_Card_GemInt_Emoji_Bday16_241402_Grandson_P","ps_Card_JT_TheNews_BDay17_60thBirthday_PU_P","ps_Card_Basic_FullPU_P","ps_Card_JT_TheNews_BDay17_SoninaMillion_PU_P","ps_Card_NQ_Bday16_DS417_90th_P","ps_card_bday20_essentials_4puhappybdaytoyou_p","ps_card_gen19_essentials_4pu_p","ps_card_bday19_nodrama_floralpattern_p","ps_card_bday19_wildandwood_happybdaybeautiful_pu_p","ps_card_gen19_essentials_3pu_l","ps_Card_BDAY18_AnimalMagic_1st_P","ps_Card_BDAY18_AnimalMagic_1stPU_P","ps_Card_Advo_BDay18_LA_LAS199954_GreyPattern_PU_P","ps_card_toy20_younghearts_paperhug_p","ps_Card_ICG_BBear_BDay18_Mum_P","ps_card_pigment_bday19_helsinki_kn406_p","ps_CARD_Carte_B_MTY_Bday_auntie_P","ps_Card_Essentials_BDay16_Circle21st_P","ps_Card_QH_PawPlay_BDay16_Again_P","ps_Card_JTLemSqzyRel_LSR005_P","ps_card_icg_bbear_bday19_daughterinlaw_p","ps_card_icg_eternal_bday19_daugherpu_p","ps_Card_Essentials_OthrOc16_MultiScript_BFs_P","ps_CARD_Carte_B_MTY_Bday_sister_multi_PU_P","ps_Card_LoveLabels_Bday12_Daughter_P","ps_card_bday20_essentials_rippededge1publack_p","ps_Card_LFMFDGrandad_FromTwo_L","ps_card_bday20_essentials_8putexttop_25_p","ps_Card_BDAY18_Essentials_9PU_40th_P","ps_Card_BDAY18_Essentials_9PU_30th_P","ps_card_jt_fandg_bday19_fg009_fortnights_pu_p","ps_card_danilo_bday20_hp_sister_p"];customElements.define("wc-copy-model-dialog",WcCopyModelDialog);var __decorate$2=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n},__awaiter$f=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};let _templates,globalUserId="",myUserId="",globalTemplates=null,userTemplates=null,recentTemplates=null,sharedTemplates=null,previousDirectoryId=-1,rootDirectory=new DirectoryTree({id:0,n:"",c:[]}),WcDialogOpen=(()=>{class e extends LitElement{constructor(){super(),this.selectedTemplate=null,this.selectedUserId=null,this.selectedFolderId=null,this.toolbarOption="loading",this.api=createPrintessApiFromExternalConfig(),this.selectedPageSize="",this.drag=!1,this.dragTemplate=null,this.dragFolder=null,this.dragTargetFolder=void 0,this.moveHandler=this.mousemove.bind(this),this.upHandler=this.mouseup.bind(this),this.backdrop=new WcBackdrop}showDialog(e){return __awaiter$f(this,void 0,void 0,(function*(){document.body.appendChild(this.backdrop),document.body.appendChild(this),e||"saas@printess.com"!==config.user.email||(e="open"),_templates=yield this.api.loadTemplatesList(),globalUserId=_templates.globalUserId,myUserId=_templates.userId,e?this.selectToolbar(e):this.loadTemplatesList("recent",null).then((e=>{e.length>0?this.selectToolbar("recent"):this.selectToolbar("new")}))}))}closeDialog(){this.backdrop.parentElement&&(document.body.removeChild(this.backdrop),document.body.removeChild(this)),recentTemplates=null,userTemplates=null,sharedTemplates=null,previousDirectoryId=-1}mousedown(e,t){e.preventDefault(),t&&"open"===this.toolbarOption&&(t instanceof Template?(this.dragTemplate=t,this.dragFolder=null):(this.dragFolder=t,this.dragTemplate=null),this.targetDiv=e.target,this.startX=e.clientX,this.startY=e.clientY,document.addEventListener("mouseup",this.upHandler),document.addEventListener("mousemove",this.moveHandler))}isDragging(){return!(!this.sprite||!this.sprite.parentNode)}mousemove(e){if(e.preventDefault(),e.cancelBubble=!0,this.shadowRoot&&!this.drag&&(Math.abs(this.startY-e.clientY)>10||Math.abs(this.startX-e.clientX)>10))(this.dragTemplate||this.dragFolder)&&(this.sprite=this.createSprite(),this.shadowRoot.appendChild(this.sprite),this.drag=!0,this.dragTargetFolder=void 0);else if(this.drag&&(this.sprite.style.left=e.clientX+"px",this.sprite.style.top=e.clientY+"px",this.shadowRoot)){const t=this.shadowRoot.elementFromPoint(e.clientX,e.clientY);if(this.dragTargetFolder&&(this.dragTargetFolder.classList.remove("over"),this.dragTargetFolder=void 0),t&&t.classList&&t.classList.contains("folder-entry")){if(this.dragFolder&&t.dataset.folderId){let e=this.getFolderById(parseInt(t.dataset.folderId));const o=this.dragFolder;if(e){if(e.id===o.id||o.parentId===e.id)return t.classList.remove("over"),void(this.dragTargetFolder=void 0);for(;e&&e.parentId;){if(o.id===e.parentId)return t.classList.remove("over"),void(this.dragTargetFolder=void 0);e=this.getFolderById(e.parentId)}}}t!==this.dragTargetFolder&&(t.classList.add("over"),this.dragTargetFolder=t)}}}mouseup(e){return __awaiter$f(this,void 0,void 0,(function*(){if(e.preventDefault(),e.cancelBubble=!0,document.removeEventListener("mousemove",this.moveHandler),document.removeEventListener("mouseup",this.upHandler),this.drag&&(this.sprite&&this.sprite.parentNode&&this.sprite.parentNode.removeChild(this.sprite),this.drag=!1,this.dragTargetFolder))if(this.dragTargetFolder.classList.remove("over"),this.dragTemplate){const e=this.dragTargetFolder.dataset.folderId;if(e){const t=parseInt(e,10);yield this.api.moveTemplateIntoDirectory(this.dragTemplate.id,t),previousDirectoryId=-1,this.requestUpdate()}}else if(this.dragFolder){const e=this.dragTargetFolder.dataset.folderId;if(e){const t=parseInt(e,10);yield this.api.moveDirectory(this.dragFolder.id,t),yield this.loadRootDirectory(),this.requestUpdate()}}}))}createSprite(){const e=document.createElement("div");if(e.style.position="absolute",e.style.pointerEvents="none",e.style.display="grid",e.style.gridRowGap="5px",e.style.justifyContent="center",e.style.minWidth="150px",e.style.zIndex="var(--printess-z-index-box-drag)",this.shadowRoot&&(this.dragTemplate||this.dragFolder)){let t=null;if(this.dragTemplate?t=this.shadowRoot.querySelector(`[data-template-name="${this.dragTemplate.name}"]`):this.dragFolder&&(t=this.shadowRoot.querySelector(`[data-folder-id="${this.dragFolder.id}"]`)),t){const o=t.cloneNode(!0);for(const e of o.querySelectorAll("wc-icon"))o.removeChild(e);this.dragFolder&&(o.style.border="1px solid black",o.style.background="white",o.style.width="150px"),e.appendChild(o)}}return e}static get styles(){return[dialogStyles,css`
      :host {
        width: 100%;
        height: 100%;
        /*grid-template-rows: calc(100% - 80px) 80px;*/
        grid-template-rows: 1fr;
        --printess-folder-bar-width: 250px;
        --printess-preview-bar-width: 160px;

      }

      .main-grid {
        display: grid;
        grid-template-columns: var(--printess-open-toolbar-width) var(--printess-folder-bar-width) 1fr 0;
        grid-template-rows: 100%;
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        right: 0;
        text-align: left; /*to correct possibly different CSS in client code */
        
      }
      .main-grid.show-preview-bar {
        grid-template-columns: var(--printess-open-toolbar-width) var(--printess-folder-bar-width) 1fr var(--printess-preview-bar-width);
      }
      

      /* Np folder bar in recent and new mode */
      .main-grid.new , .main-grid.recent{
        grid-template-columns: var(--printess-open-toolbar-width) 1fr 0;
      }
      .main-grid.new.show-preview-bar  , .main-grid.recent.show-preview-bar {
        grid-template-columns: var(--printess-open-toolbar-width) 1fr var(--printess-preview-bar-width);
      }

      

      .folder-bar {
        display: none;
        height: 100%;
        overflow: auto;
        flex-direction: column;
        border-right: 1px solid var(--printess-maxContrastColor);
      }
      .main-grid.open > .folder-bar {
        display: flex;
      }
      .main-grid.shared > .folder-bar {
        display: flex;
      }

      .preview-bar {
        display: none;
        height: 100%;
        grid-template-rows: 35px 40px 30px calc(100% - 105px);
        background-color: var(--printess-maxContrastColorInverse);   
      }
     
      .preview-header {
        display: grid;
        grid-template-columns:  auto  49px;
        grid-template-rows: 1fr; 
        background-color: var(--printess-toolbarBackground);
        color: var(--printess-toolbarColor);
        align-items: center;
        padding-left: 10px;
      }
      .main-grid.show-preview-bar  > .preview-bar {
        display: grid;
      }


      .templates-area {
        height: 100%;
        display: grid;
        grid-template-rows: 35px 1fr;
      }

    
      
      .templates-header {
        display: grid;
        grid-template-columns:  auto 40px 1fr;
        grid-template-rows: 1fr;
        grid-column-gap: 10px;
        background-color: var(--printess-toolbarBackground);
        color: var(--printess-toolbarColor);
        align-items: center;
      }

      .templates-header-buttons  {
        display: flex;
        flex-direction: row;
        justify-content: flex-end;
      }

      .header-button {
         
        color: var(--printess-headToolbarColor);
        background-color: var(--printess-toolbarColor);
    

        display: flex;
        flex-direction: row;
        padding: 10px 10px 11px 5px;
        font-size: 12px;
        color: var(--printess-toolbarButtonText);
        background-color: var(--printess-toolbarButtonBackground);
        cursor: pointer;
        margin-left: 1px;
        align-items: center;
      }

      .header-button.pink {
        background: var(--printess-headlineColor);
      }

      
      .header-button > wc-icon {
        height: 14px;
        width: 14px;
        margin-right: 7px;
        margin-left: 5px;
      }
      .header-button:hover {
        background-color:  var(--printess-toolbarButtonBackgroundHover);
      }
      .header-button:hover.pink {
        background: var(--printess-headlineColorHover);
      }
      .templates-container {
        height: 100%;
        overflow: auto;
        padding: 15px;
         
      }
      
      .template {
          display: grid;
          grid-template-columns: 120px;
          grid-template-rows: 100px 22px;
          margin: 5px;
          position: relative;
          cursor: pointer;
        }
      .template.big {
          grid-template-columns: 180px;
          grid-template-rows: 160px 22px;
      }
      .publish-badge {
          position: absolute;
          right: -2px;
          bottom: 20px;
          width: 20px;
          height: 20px;
          background-color: rgba(255,255,255,1);
          padding: 4px 4px 3px 2px;
          border-radius: 50%;
          box-shadow: rgb(0 0 0 / 40%) 1px 1px 3px;
          cursor: pointer;
      }
      .publish-badge:hover {
        background-color:#ddd;
      } 
      .draft-badge {
          position: absolute;
          left: 4px;
          bottom: 26px;
          width: 17px;
          height: 17px;
      }
      .image-box {
          width: 100%;  
          height: 100%;
        
          background-size: cover;
          border: 1px solid  var(--printess-radioBackgroundHover);
          border-radius: 3px;
          background-color: #bbb;
      } 

      .preview-images {
        height: 100%;
        overflow: auto;
      }
      .preview-images > div {
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      .preview-thumbnail {
        width:  calc(var(--printess-preview-bar-width) - 30px);
        margin-bottom: 5px; 
        margin-left: 5px;
        border: 1px solid var(--printess-textColor);
      }
      .template-name {
          font-size: 13px;
          text-overflow: ellipsis;
          width: 100%;
          overflow:hidden;
          text-overflow: ellipsis;
          white-space: nowrap;
          text-align: center;
          padding-top: 2px;
      }   
      .template:hover > .image-box {
        border-color: var(--printess-maxContrastColor);
      }
      .template.selected:hover > .image-box, .template.selected > .image-box {
        border-color: var(--printess-headlineColor);
        border-width: 2px;
      }
      .template.selected:hover > .template-name, .template.selected > .template-name {
        color: var(--printess-headlineColor);
      }

      .user-header {
        padding: 5px 10px;
        background-color: var( --printess-radioBackgroundHover);
        color: var(--printess-headlineColorInverse);

      }
      .template-list {
        display: flex;
        flex-wrap: wrap;
   
      }

      .new-template {
        display: grid;
        grid-template-columns: 1fr 100px;
        column-gap: 20px;
        max-width: 400px;
        align-items: center;
        justify-content: center;
        margin-bottom: 15px;
      }
      h3 {
        border-top: 1px solid rgba(0,0,0,0.2);
        padding-top: 6px;
        margin-bottom: 7px;
      }
      h1 {
        margin-top: 0;
        margin-bottom: 5px;;
      }



      .toolbar {
          background:  var(--printess-toolbarColor);
          width: var(--printess-open-toolbar-width);
          height: 100%;
          overflow: hidden;
          display: flex;
          flex-direction: column;
      }
      
      
      .tb-button, .tb-button-user, .tb-button-back {
          width: 100%; 
          color: var(--printess-toolbarBackground);
          text-align: center;
          display: flex;
          flex-direction: column;
          align-items: center;
          padding-top: 15px;
          padding-bottom: 15px;
          border-top: 1px solid var(--printess-toolbarColorHover);
          border-bottom: 3px solid transparent;
      }
      .tb-button, .tb-button-back {
        cursor: pointer;
      }
      .tb-button-back {
          padding-top: 8px;
          padding-bottom: 3px;
          border-top: none;
      }
      .tb-button-back:hover {
        background: var(--printess-toolbarColorHover);
      }
      .tb-button-back > wc-icon {
        width: 25px !important;
        height: 20px !important;
      }
      .tb-button-user {
        padding-bottom: 10px;
        padding-top: 10px;
      }

      .toolbar .tb-button:hover {
        background: var(--printess-toolbarColorHover);
      }

      .toolbar .tb-button.selected, .toolbar .tb-button.selected:hover  {
          background:  var(--printess-toolbarColorHover);
          border-bottom: 3px solid var(--printess-headlineColor);
          
      }

      .tb-user {
        background-color: var(--printess-headlineColor);
        width: var(--printess-open-toolbar-width);
        height: var(--printess-open-toolbar-width);
        color: white;   
        border-radius: 50%;
        font-size: 20px;
        line-height: 50px;
        width: 50px; 
        height: 50px;
        
      }

      .tb-caption {
        margin-top: 5px;
        font-size: 11px; 
        color: var(--printess-toolbarBackground);
      }
      .tb-logout {
        background-color: rgba(255,255,255,0.1);
        border: 1px solid var(--printess-toolbarBackground);
        padding: 2px 5px;
        border-radius: 4px;
        margin-top: 8px;
        font-size: 11px; 
      
        cursor: pointer;
      }
      .tb-logout:hover {
        color: var(--printess-headlineColorHover); 
        background-color: rgba(255,255,255,0.6);
      }

      .toolbar wc-icon {
        width: 40px;
        height: 40px;
      }



      .user-list {
        width: 100%;
        max-height: 200px; 
        overflow: auto;
        border-bottom: 6px solid var(--printess-panelBackgroundHover);
        padding-top: 10px;
      }
      .user-entry > wc-icon {
        width: 14px;
        height: 14px;
        margin-left: 3px;
      }
      .user-entry {
        padding: 5px; 
        padding-top: 10px;
        border-bottom: 1px solid white;
        display: grid;
        grid-template-columns: 20px 1fr;
        background-color: var(--printess-panelBackground);
        cursor: pointer;
      }
      .user-entry:hover {
        background-color: var(--printess-panelBackgroundHover);
      }
      .user-entry.selected,  .user-entry:hover.selected {
        background-color: var(--printess-panelBackground);
      }
      .user-entry:hover > div {
        color: var(--printess-textColorHover);
      }
      .user-entry.selected > div {
        color: var(--printess-headlineColor);
      }



      .folder-header {
        display: grid;
        grid-template-columns: 1fr 24px 24px;
        grid-column-gap: 10px;
        height: 35px;
        background-color: var(--printess-toolbarBackground);
        color: var(--printess-toolbarColor);
        align-items: center;
      }
      .folder-list {
        width: 100%;
        display: flex;
        flex-direction: column;
        padding-top: 10px;
      }
      .folder-entry > wc-icon {
        width: 14px;
        height: 14px;
        margin-left: 3px;
      }
      .folder-entry > div  {
        white-space: nowrap;
      }
       

      .folder-entry {
        padding: 5px; 
       
        display: grid;
        grid-template-columns: 20px 1fr;
        background-color: var(--printess-panelBackground);
        cursor: pointer;
      }
      .folder-entry.sub-folder {
        grid-column: 1 / 2;
      }
      .folder-entry.over {
        border: 1px solid var(--printess-maxContrastColor);
      }

      .folder-entry:hover {
        background-color: var(--printess-panelBackgroundHover);
      }
      .folder-entry.selected,  .folder-entry:hover.selected {
        color: var(--printess-textColorHover);
      }
      .folder-entry:hover > div {
        color: var(--printess-textColorHover);
      }
      .folder-entry.selected > div {
        color: var(--printess-headlineColor);
      }
      .folder-entry > * {
        pointer-events: none;
      }

      @media (max-width: ${config.mobileDeviceWidth}px) {
        .main-grid {
          grid-template-columns: var(--printess-open-toolbar-width)  1fr;
          grid-template-rows: 1fr;
        }
        .main-grid.open {
          grid-template-rows: 95px 1fr;
        }
        .toolbar {
          grid-row: 1 / 3;
          background-color: #ddd;
        }
        .folder-bar {
          margin-bottom: 20px;
        }
        .folder-header {
          display: none;
        }
        .tb-user {
          background-color: var(--printess-panelBackground)         
        }
      } 
  
    `]}render(){var e,t,o,i,r,s;return"loading"===this.toolbarOption?html`loading ...`:html`
    <div class="main-grid ${this.toolbarOption} ${config.isMobile?"":"show-preview-bar"}">
      
      ${this.renderToolbar()}

      <div class="folder-bar" />
        ${"shared"===this.toolbarOption?until(this.renderUserList(),html`loading users ...`):""}
        ${until(this.renderFolderList(),html`loading folders ...`)}
      </div>
      
      <div class="templates-area">
         <div class="templates-header"> 

          <div style="margin-left: 15px;" >${unsafeHTML(config.printessSvgLogo(config.isMobile?"#fff":"#444",26))}</div>
          <div></div>
          <div class="templates-header-buttons">

            ${(null===(e=this.selectedTemplate)||void 0===e?void 0:e.hasDesignVersion)?html`
              <div class="header-button" @click=${()=>this.openTemplate(this.selectedTemplate,"normal")} >
                <wc-icon icon="arrow-right" primaryColor="head-toolbar" ></wc-icon>
                <div>Open</div>
              </div> 
            `:""}
            ${(null===(t=this.selectedTemplate)||void 0===t?void 0:t.hasPublishedVersion)?html`
              <div class="header-button" @click=${()=>this.openTemplate(this.selectedTemplate,"published")}>
                <wc-icon icon="shopping-cart-solid" primaryColor="head-toolbar" ></wc-icon>
                <div>Open Published Version</div>
              </div> `:""}
            

            ${(null===(o=this.selectedTemplate)||void 0===o?void 0:o.hasPublishedVersion)&&"open"===this.toolbarOption&&!config.isMobile?html`
              <div class="header-button" @click=${()=>this.unpublish()}>
                <wc-icon icon="trash-solid" primaryColor="head-toolbar" ></wc-icon>
                <div>Delete Published Version</div>
              </div> 
            `:this.selectedTemplate&&"open"===this.toolbarOption&&!config.isMobile?html`
              <div class="header-button" @click=${()=>this.deleteTemplate()}>
                <wc-icon  icon="trash" primaryColor="head-toolbar" ></wc-icon>
                <div>Delete</div>
              </div> 
            `:""}
            
           
        </div>
        </div>
         <div class="templates-container" >
            ${this.renderTemplateView()}
        </div>  
      </div>
      
      

      <div class="preview-bar">
        <div class="preview-header"> 
            <div></div>
            <wc-icon style="height: 35px; width: 49px; padding: 3px 10px;" icon="close-square" primaryColor="headline" @click=${()=>this.closeDialog()}></wc-icon>
        </div>
        ${this.selectedTemplate?html`
          <h4 style="text-align: center; padding: 0; margin:0; align-self: center;" >${null!==(r=null===(i=this.selectedTemplate)||void 0===i?void 0:i.name)&&void 0!==r?r:"[no template]"}</h4>
          
        `:html`
          <p style="padding: 10px; text-align: center;">Please select a template, a preview will appear here.</p>
          
        `}
        ${(null===(s=this.selectedTemplate)||void 0===s?void 0:s.hasDesignVersion)?html`
          <div class="header-button pink"  @click=${()=>this.openTemplate(this.selectedTemplate,"normal")} >
                  <wc-icon icon="arrow-right" primaryColor="head-toolbar"></wc-icon>
                  <div>Open</div>
              </div> 
          </div>
        `:""}

        ${this.selectedTemplate?html`${until(this.renderTemplateDetails(this.selectedTemplate),html`loading...`)}`:""}
    </div>

 
  </div>
    `}renderUserList(){return __awaiter$f(this,void 0,void 0,(function*(){const e=yield this.loadAllUsers();return html` 
    <div class="user-list">
      ${e.map((e=>html`
        <div class="user-entry ${this.selectedUserId===e.userId?"selected":""}" @click=${()=>this.selectSharedUser(e.userId)}>
          <wc-icon icon="${e.isGlobal?"user-crown-solid":"user-solid"}"  primaryColor="${this.selectedUserId===e.userId?"headline":"text"}"  ></wc-icon>
          <div>${e.eMail}</div>
        </div>
      `))}
    </div>
    `}))}loadRootDirectory(e,t){return __awaiter$f(this,void 0,void 0,(function*(){const o=e||this.toolbarOption,i=t||this.selectedUserId;"shared"===o&&i?rootDirectory=yield this.api.loadDirectories(i):"open"===o&&(rootDirectory=yield this.api.loadDirectories())}))}selectToolbar(e){return __awaiter$f(this,void 0,void 0,(function*(){yield this.loadRootDirectory(e),"shared"===this.toolbarOption&&"open"===e&&(this.selectedFolderId=rootDirectory.id),this.selectedTemplate=null,this.toolbarOption=e}))}selectSharedUser(e){return __awaiter$f(this,void 0,void 0,(function*(){yield this.loadRootDirectory(this.toolbarOption,e),this.selectedFolderId=rootDirectory.id,this.selectedUserId=e}))}renderFolderList(){return __awaiter$f(this,void 0,void 0,(function*(){0===rootDirectory.id&&(yield this.loadRootDirectory()),this.selectedFolderId||(this.selectedFolderId=rootDirectory.id);const e=rootDirectory;return"shared"!==this.toolbarOption||this.selectedUserId?html` 
    ${"open"===this.toolbarOption?html`
      <div class="folder-header">
        <div></div>
        ${this.selectedFolderId?html`
          ${this.isRootFolderSelected()?html`<div></div>`:html`
          <wc-icon style="width: 18px; height: 16px" icon="trash" primaryColor="headline" @click=${()=>this.deleteFolder()}></wc-icon>
          `}
         
          <wc-icon style="width: 18px; height: 16x" icon="folder-plus" primaryColor="headline" @click=${()=>this.addFolder()}></wc-icon>
        `:""}
      </div>`:""}
    <div class="folder-list">
      <div  class="folder-container">
        <div class="folder-entry ${this.selectedFolderId===e.id?"selected":""}" 
              @click=${()=>this.selectedFolderId=e.id} data-folder-id=${e.id}>
          <wc-icon icon="folder-open-solid" primaryColor="${this.selectedFolderId===e.id?"headline":"text"}"  ></wc-icon>
          <div>${until(this.getSelectedUserName(),html`root`)}</div>
        </div>
        ${e.children?this.renderSubFolderList(e.children,15):""}
      </div>
    </div>
    `:html`<p style="padding: 5px;">Please Select a User</p>`}))}renderSubFolderList(e,t){return html` 
      ${e.sort(((e,t)=>e.name.localeCompare(t.name))).map((e=>html`
        <div  class="folder-container">
           <div class="folder-entry sub-folder ${this.selectedFolderId===e.id?"selected":""}" 
                style="margin-left:${t}px;"  data-folder-id="${e.id}"
                @mousedown=${t=>this.mousedown(t,e)} 
                @click=${()=>this.selectedFolderId=e.id}>
            <wc-icon icon="folder-open-solid" primaryColor="${this.selectedFolderId===e.id?"headline":"text"}"  ></wc-icon>
            <div>${e.name}</div>
          </div>
          ${e.children?this.renderSubFolderList(e.children,t+15):""}
        </div>
      `))}
    `}isRootFolderSelected(){const e=this.selectedFolderId?this.getFolderById(this.selectedFolderId):rootDirectory;return!e||0===e.parentId}addFolder(){var e;return __awaiter$f(this,void 0,void 0,(function*(){const t=null===(e=prompt("Folder Name"))||void 0===e?void 0:e.replace(/(\/|~)/g,"");if(t){const e=this.selectedFolderId?this.getFolderById(this.selectedFolderId):rootDirectory;if(!e)return void alert("Current folder not found.");yield this.api.createDirectory(e.id,t),yield this.loadRootDirectory(),this.requestUpdate()}}))}deleteFolder(){var e;return __awaiter$f(this,void 0,void 0,(function*(){if(this.selectedFolderId){const t=this.getFolderById(this.selectedFolderId);if(t&&t.parentId){const o=this.getFolderById(t.parentId);if(o&&o.children){if(null===(e=t.children)||void 0===e?void 0:e.length)return void alert("Only empty Folders can be deleted");try{yield this.api.deleteDirectory(t.id),this.selectedFolderId=null,yield this.loadRootDirectory(),this.requestUpdate()}catch(e){alert(e)}return}}}alert("Please select a Folder to delete.")}))}renderTemplateView(){switch(this.toolbarOption){case"new":return this.renderNewTemplate();case"shared":return this.renderSharedTemplates();case"open":return this.renderMyTemplates();case"recent":return this.renderMyRecentTemplates();default:return html``}}renderTemplateImage(e){return html`<img class="preview-thumbnail" src="${e.thumbnailUrl}" style="background-color:${e.backgroundColor}; "/>`}renderTemplateDetails(e){var t;return __awaiter$f(this,void 0,void 0,(function*(){const o=yield this.api.loadTemplateDetails(e.userId,e.id),i=new Map,r=[];if(o.images.forEach((e=>{let t=i.get(e.documentId);t||(t=[],i.set(e.documentId,t)),t.push(e)})),o.documentIdToNameMapping){const e=new Map;for(const t of i)e.set(o.documentIdToNameMapping[t[0]],t[1]);const s=Array.from(e.keys());for(const o of s.sort(((e,t)=>e.localeCompare(t))))r.push(html`<div>${o}</div>`),null===(t=e.get(o))||void 0===t||t.sort(((e,t)=>1e3*e.spreadIndex+e.pageIndex-(1e3*t.spreadIndex+t.pageIndex))).forEach((e=>r.push(this.renderTemplateImage(e))))}else for(const e of i)r.push(html`<div>Document</div>`),e[1].sort(((e,t)=>1e3*e.spreadIndex+e.pageIndex-(1e3*t.spreadIndex+t.pageIndex))).forEach((e=>r.push(this.renderTemplateImage(e))));return html`<div class="preview-images" style="padding-top: 10px;"><div>
                  ${r}
                </div></div>`}))}renderNewTemplate(){return config.isMobile?html`
      <h4 style="margin-top:25px;">Try out our inspiring examples:</h4>
      ${until(this.renderTemplateList("global-user"),html`loading ...`)}
    `:html`
      <h4 >Create a new Template:</h4>
      <div class="new-template">
        <wc-select  id="newDocumentSize" .list=${this.pageSizes()} .value=${null} label="Page Size"
        origin="None" selector="" .callback=${e=>this.selectedPageSize=e} > </wc-select>
        <vaadin-button @click=${()=>this.createNewEmptyDocument()} theme="primary">CREATE</vaadin-button>
      </div>
      <h4 style="margin-top:25px;">Or try out our inspiring examples:</h4>
      ${until(this.renderTemplateList("global-user"),html`loading ...`)}
    `}renderMyTemplates(){return html`
      ${until(this.renderTemplateList("myself"),html`loading ...`)}
    `}renderMyRecentTemplates(){return html`
      ${until(this.renderTemplateList("recent"),html`loading ...`)}
    `}renderSharedTemplates(){return html`
      ${until(this.renderTemplateList("shared",this.selectedUserId),html`loading ...`)}
    `}renderToolbar(){const e=[{icon:"page-plus-solid",caption:config.isMobile?"Samples":"New",option:"new"},{icon:"folder-open-solid",caption:"Open",option:"open"},{icon:"clock-solid",caption:"Recent",option:"recent"}];config.isMobile||e.push({icon:"user-friends-solid",caption:"Shared",option:"shared"});const t=config.isMobile?"headline":"head-toolbar";return html`
      <div class="toolbar">
        <div class="tb-button-back"  @click=${()=>this.closeDialog()}>
          <wc-icon icon="arrow-left" primaryColor="${t}" ></wc-icon>  
        </div>
        <div class="tb-button-user">
          <div class="tb-user">${config.user.initials}</div>  
          <div class="tb-caption">${this.getuserName().split(" ")[0]} </div>
          <div class="tb-logout" @click=${()=>this.logout()}>logout</div>
        </div>
        ${e.map((e=>html`
          <div class="tb-button ${this.toolbarOption===e.option?"selected":""}" @click=${()=>{this.selectToolbar(e.option)}}>
            <wc-icon style="${"Recent"===e.caption?"width: 35px;":""}" icon="${e.icon}" primaryColor="${t}"></wc-icon>  
            <div class="tb-caption">${e.caption} </div>
          </div>
        `))}
      </div>
    `}logout(){window.firebase.auth().signOut().then((()=>{localStorage.removeItem("printess:jwt"),window.location.reload()}))}renderTemplateList(e,t=null){return __awaiter$f(this,void 0,void 0,(function*(){const o=yield this.loadTemplatesList(e,t);return"recent"==e?html`     
      <div class="template-list">
        ${o.map((t=>this.renderTemplate(t,e)))}
      </div>`:html`     
      <div class="template-list">
        ${o.sort(((e,t)=>e.name.localeCompare(t.name))).map((t=>this.renderTemplate(t,e)))}
      </div>`}))}renderTemplate(e,t){return"global-user"===t?html`
      <div class="template ${this.selectedTemplate===e?"selected":""} ${"global-user"===t?"big":""}" 
         @click=${()=>this.selectTemplate(e)} data-template-name="${e.name}"
         @mousedown=${t=>this.mousedown(t,e)} title="${e.name}">
         <div class="image-box" style=" background-size: contain; background-repeat: no-repeat; background-position: center center; background-color: ${e.backgroundColor}; ${e.thumbnailUrl?"background-image: url("+e.thumbnailUrl+")":""}"></div>
         <div class="template-name">${e.name}</div>
      </div>
   `:html`
       <div class="template ${this.selectedTemplate===e?"selected":""}" 
          @click=${()=>this.selectTemplate(e)} data-template-name="${e.name}"
          @mousedown=${t=>this.mousedown(t,e)} title="${e.name}">
          <div class="image-box" style="background-size: contain; background-repeat: no-repeat; background-position: center center; background-color: ${e.backgroundColor}; ${e.thumbnailUrl?"background-image: url("+e.thumbnailUrl+")":""}"></div>
          <div class="template-name">${e.name}</div>
          ${e.hasPublishedVersion?html`<wc-icon @click=${t=>this.selectTemplate(e,t,"published")} title="Open Published Version" class="publish-badge" icon="shopping-cart-solid" primaryColor="headline"></wc-icon>`:""}
        </div>
    `}getuserName(){return config.user.displayName}getSelectedUserName(){return __awaiter$f(this,void 0,void 0,(function*(){if("shared"===this.toolbarOption&&this.selectedUserId){const e=(yield this.loadAllUsers()).filter((e=>e.userId===this.selectedUserId));return e.length?e[0].eMail:"user not found"}return this.getuserName()}))}pageSizes(){return config.pageSizes().map((e=>this.pageSizeCaption(e)))}pageSizeCaption(e){return"<span>"+e.name+"</span> <span style='font-size: 8px;'>("+e.width+"x "+e.height+")</span>"}createNewEmptyDocument(){const e=this.selectedPageSize;if(e)for(const t of config.pageSizes())if(e===this.pageSizeCaption(t))return this.closeDialog(),void loadScope("new",void 0,void 0,t);alert("Please select a page size first.")}loadAllUsers(){return __awaiter$f(this,void 0,void 0,(function*(){return _templates.userTemplates.filter((e=>e.userId!==_templates.userId)).map((e=>({userId:e.userId,eMail:e.eMail,isGlobal:e.userId===_templates.globalUserId})))}))}loadTemplatesList(e,t=null){return __awaiter$f(this,void 0,void 0,(function*(){if("global-user"===e)return globalTemplates||(globalTemplates=yield this.api.loadGlobalUserTemplates()),globalTemplates.templates;if("myself"===e){const e=this.selectedFolderId||rootDirectory.id;return previousDirectoryId===e&&userTemplates||(userTemplates=yield this.api.loadUserTemplates(e),previousDirectoryId=e,this.selectedTemplate=null),userTemplates.templates}if("recent"===e)return recentTemplates||(recentTemplates=yield this.api.loadRecentUserTemplates()),recentTemplates.templates;if("shared"===e&&t){const e=this.selectedFolderId||rootDirectory.id;return previousDirectoryId===e&&sharedTemplates||(sharedTemplates=yield this.api.loadSharedUserTemplates(t,e),previousDirectoryId=e,this.selectedTemplate=null),sharedTemplates.templates}return[]}))}unpublish(){return __awaiter$f(this,void 0,void 0,(function*(){this.selectedTemplate&&"ok"===prompt("Do you want to delte this published template?\nType in 'ok' to unpublish this template:","no")&&(yield this.api.unpublishTemplate(this.selectedTemplate.name,this.selectedTemplate.userId),previousDirectoryId=-1,this.selectedTemplate=null,this.requestUpdate())}))}deleteTemplate(){var e;return __awaiter$f(this,void 0,void 0,(function*(){(null===(e=this.selectedTemplate)||void 0===e?void 0:e.hasPublishedVersion)?alert("Please unpublish this template before. Published templates cannot be deleted."):this.selectedTemplate&&"ok"===prompt("Do you want to delete this template?\nType in 'ok' to delete this template:","no")&&(yield this.api.deleteTemplate(this.selectedTemplate.name,this.selectedTemplate.userId),previousDirectoryId=-1,this.selectedTemplate=null,this.requestUpdate())}))}selectTemplate(e,t,o){return __awaiter$f(this,void 0,void 0,(function*(){e&&("published"!==o&&!1===e.hasDesignVersion&&!0===e.hasPublishedVersion&&(o="published"),"normal"!==o&&!0===e.hasDesignVersion&&!1===e.hasPublishedVersion&&(o="normal"),t&&o&&(t.preventDefault(),t.stopPropagation(),yield this.openTemplate(e,o)),this.selectedTemplate&&this.selectedTemplate.id===e.id&&(yield this.openTemplate(e,o)),this.selectedTemplate?this.selectedTemplate.id!==e.id&&(this.selectedTemplate=e):this.selectedTemplate=e)}))}openTemplate(e,t){return __awaiter$f(this,void 0,void 0,(function*(){if(!e)return;showSingleTouchOverlay("loading ..."),yield asyncTimeout(100),this.closeDialog();let o=!1;"new"===this.toolbarOption&&e.userId===globalUserId&&(t="published",o=!0);const i=yield this.api.loadTemplateFromUser(e.name,e.userId,t);scope().openedFromTemplate=e,scope().savedAfterOpen=!1,scope().template=e;let r=null;o?scope().template=e.copyWithUserId(myUserId):r=(yield this.loadAllUsers()).filter((t=>t.userId===e.userId))[0]||null,scope().templateOwner=r?{userId:e.userId,eMail:r.eMail,initials:getInitials(r.eMail),name:r.eMail}:null,"published"===t?(yield loadScope(i,null,"loadAlwaysFromServer"),config.isBuyer||(yield scope().toolbarUi.toggleBuyerSide(!0,!1))):yield loadScope(i),hideSingleTouchOverlay()}))}getFolderById(e,t){if(t)for(const o of t){if(o.id===e)return o;if(o.children){const t=this.getFolderById(e,o.children);if(t)return t}}else{if(e===rootDirectory.id)return rootDirectory;if(rootDirectory.children)return this.getFolderById(e,rootDirectory.children)}return null}}return __decorate$2([property({attribute:!1})],e.prototype,"selectedTemplate",void 0),__decorate$2([property({attribute:!1})],e.prototype,"selectedUserId",void 0),__decorate$2([property({attribute:!1})],e.prototype,"selectedFolderId",void 0),__decorate$2([property({attribute:!0})],e.prototype,"toolbarOption",void 0),e})();customElements.define("wc-dialog-open",WcDialogOpen);var __awaiter$g=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};class WcDialogSave extends LitElement{constructor(){super(),this.mode="save",this.uploadProgress=-1,this.savePromise=null,this.backdrop=new WcBackdrop}showSaveAsDialog(){this.mode="saveAs",document.body.appendChild(this.backdrop),document.body.appendChild(this)}showPublishDialog(){this.mode="publish",document.body.appendChild(this.backdrop),document.body.appendChild(this)}showAndSaveAndClose(){var e,t,o;return __awaiter$g(this,void 0,void 0,(function*(){let i=!1;(null===(e=scope().template)||void 0===e?void 0:e.userId)&&(null===(t=scope().template)||void 0===t?void 0:t.userId)!==scope().myUserId?confirm("You are about to save into another account. Continue?")&&(i=!0):i=!0,i&&(this.mode="save",document.body.appendChild(this.backdrop),document.body.appendChild(this),yield this.save(scope().id,null===(o=scope().template)||void 0===o?void 0:o.userId))}))}closeDialog(){this.backdrop.parentElement&&(document.body.removeChild(this.backdrop),document.body.removeChild(this))}static get properties(){return{mode:{type:String},uploadProgress:{type:Number}}}static get styles(){return[dialogStyles,css`
          .image-upload .progress {
              width: 250px; 
              border: 1px solid black; 
              height: 22px;
          }
          .image-upload-progress > div {
              background: var(--printess-headlineColor); 
              height: 100%; 
              color: var(--printess-headlineColorInverse);
              text-align: center;
              padding: 2px;
          }

          .save-info {
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            align-items: center;
            margin-left: 20px;
          }
          .publish-info {
            display: flex;
            flex-direction: row;
            align-items: center;
            margin-bottom: 10px;
          }
          .publish-info > p {
            font-size: 16px;
          }
          .user-bubble {
              background-color: var(--printess-headlineColor);
              width: 28px;
              height: 28px;
              line-height: 28px;
              text-align: center;
              color: white;   
              border-radius: 50%;
              font-size: 16px;
              
            }
            
        `]}saveInfoIcons(){const e=scope().template,t=scope().templateOwner;return e&&e&&e.userId!=scope().myUserId&&t?html`
          <div class="save-info">
               <div class="user-bubble" style="margin-right: 10px;" title="${t.name}">${t.initials}</div>
               <wc-icon icon="arrow-right" primaryColor="headline" style="width: 20px; height: 20px"></wc-icon>
               <div class="user-bubble" style="margin-left: 10px;" title="${config.user.initials}">${config.user.initials}</div>
          </div>
         
        `:html``}saveInfoText(){const e=scope().template,t=scope().templateOwner;return e&&e&&e.userId!=scope().myUserId&&t?"publish"===this.mode?html`
          <p>Publish Template [${e.name}] from ${t.name} to your Account ${config.user.email}.</p>
        `:html`
          <p>Save a Copy of Template [${e.name}] from ${t.name} to your Account ${config.user.email}.</p>
        `:html``}templateInfo(){const e=scope().template;if(e){if(!e.isWritable)return html`You cannot save this template directly. Use save as.`;if(e.userId!=scope().myUserId)return html`You can save this template, which belongs to a different user.`}return html`You can save this template normally. It's yours ;)`}isMyTemplate(){const e=scope().template;return!e||e.userId===scope().myUserId}render(){var e,t;if("save"===this.mode)return html`
        <div class="content"> 
          <br>
          <h1 style="padding-bottom: 10px;">Saving Template ...</h1>
          <br>
          ${this.uploadProgress>=0&&this.uploadProgress<=1?html`
            <div class="image-upload-progress" >
              <div style="width: ${100*this.uploadProgress}%">${Math.round(1e4*this.uploadProgress)/100+"%"}</div>
            </div>`:""} 
        </div> 
      `;let o="new"===scope().id?"":this.sanitizeName(scope().id);return o&&scope().template&&!(null===(e=scope().template)||void 0===e?void 0:e.isWritable)&&0!==(null===(t=scope().template)||void 0===t?void 0:t.id)&&(o="copy of "+o),html`
          <div class="content">
          
            <div style="padding-bottom: 10px; display: flex; flex-direction: row;">
              ${"publish"===this.mode?html`<h1>Publish Template</h1>`:html`<h1>Save Template</h1>`}
              ${this.saveInfoIcons()}
            </div>

            <div style="margin-bottom:20px;">${this.saveInfoText()}</div>
            
            ${"publish"!==this.mode?html`
              <vaadin-text-field id="templateName"   style="width: 100%"  label="New Template Name"  .value=${o}></vaadin-text-field>
            `:html`
              <div class="publish-info">
                <wc-icon icon="shopping-cart-solid"  style="width: 32px; height: 32px; margin-right: 15px;"></wc-icon>
                <p>${o}</p>
              </div>
            `}

              ${this.uploadProgress>=0&&this.uploadProgress<=1?html`
                <div class="image-upload-progress" >
                  <div style="width: ${100*this.uploadProgress}%">${Math.round(1e4*this.uploadProgress)/100+"%"}</div>
                </div>
              `:""} 
              
          </div>
        </div>
        
         <div class="footer" >
            ${this.getSaveButton()}
            <vaadin-button style="grid-column: 3" @click=${this.closeDialog} theme="secondary">CLOSE</vaadin-button>
         </div>
        
          
         
        `}getSaveButton(){return"publish"===this.mode?html`
        <vaadin-button style="grid-column: 2" @click=${()=>this.publishTemplate("my")} theme="primary">Publish</vaadin-button>
      `:html`
        <vaadin-button style="grid-column: 2" @click=${this.saveToMyTemplates} theme="primary">Save</vaadin-button>
      `}getPublishToOriginButton(){var e;return(null===(e=scope().template)||void 0===e?void 0:e.isPublishable)?html`<vaadin-button style="grid-column: 3" @click=${()=>this.publishTemplate("origin")} theme="primary">Publish Template</vaadin-button>`:html``}getPublishToMyAccountButton(){const e=scope().template;return e&&!e.isPublishable&&scope().myUserId!==e.userId?html`<vaadin-button style="grid-column: 4" @click=${()=>this.publishTemplate("my")} theme="primary">Publish Foreing Template to My Account</vaadin-button>`:html``}saveTemplate(){var e;if(this.shadowRoot){const t=this.shadowRoot.getElementById("templateName");t&&this.save(t.value,null===(e=scope().template)||void 0===e?void 0:e.userId)}}publishTemplate(e){var t;const o="new"===scope().id?"":this.sanitizeName(scope().id);o&&this.shadowRoot&&("my"===e?this.publish(o):(alert("Should not be possible"),this.publish(o,null===(t=scope().template)||void 0===t?void 0:t.userId)))}saveToMyTemplates(){if(this.shadowRoot){const e=this.shadowRoot.getElementById("templateName");if(e){const t=e.value,o="new"===scope().id?"":this.sanitizeName(scope().id);if(config.isDebugViewBkr)!t||"new"===t||t.indexOf("~")>=0?alert("Name is not valid"):this.save(e.value,"");else{const i=scope().template,r=0===(null==i?void 0:i.id)||i&&i.userId!=scope().myUserId||!i;t!==o||r?!t||"new"===t||t.indexOf("~")>=0?alert("Name is not valid"):this.save(e.value,""):alert("[Save As] requires a different name.")}}}}changeProgress(e){this.uploadProgress=e,1===e&&this.closeDialog()}saveCheck(e){return!(!e||"new"===e.toLowerCase()||-1!==e.indexOf("~"))||(alert("Invalid Name. Name cannot be 'new' and does not allow character '~' in the name."),!1)}sanitizeName(e){return e&&e.endsWith("~published")?e.substr(0,e.length-10):e}publish(e,t){return __awaiter$g(this,void 0,void 0,(function*(){const o=this.sanitizeName(e);if(!this.saveCheck(o))return;const i=scope().id;scope().id=o+"~published";try{const e=scope().serializeAll();removeUnusedStories(e),saveDataToLocalStorage(scope().id,e),this.changeProgress(0);try{const i=createPrintessApiFromExternalConfig();yield i.publishTemplate(o,JSON.stringify(e),t)}catch(e){console_log(e)}}finally{scope().id=i,this.changeProgress(1)}}))}save(e,t){return __awaiter$g(this,void 0,void 0,(function*(){const o=this.sanitizeName(e);if(!this.saveCheck(o))return;scope().setId(o);const i=scope().serializeAll(!0);removeUnusedStories(i),saveDataToLocalStorage(e,i);try{yield documentProvider("standard").saveCore({id:o,templateJson:JSON.stringify(i),targetUserId:t}),scope().savedAfterOpen=!0,this.changeProgress(.1),this.requestUpdate()}catch(e){return alert("Could not save document: "+e),this.changeProgress(1),void this.requestUpdate()}try{const e=createPrintessApiFromExternalConfig();yield saveTemplateThumbnails(e,{scopeId:o,userId:t},i,"design",(e=>{this.changeProgress(.1+.9*e),this.requestUpdate()}));const r=scope().template;if(r&&!t&&(r.name!==o||0===r.id)){const e=createPrintessApiFromExternalConfig(),t=yield e.loadTemplateDetails("",0,o);scope().template=r.copyWithFullAccess(scope().myUserId,t.id,o),scope().templateOwner={userId:scope().myUserId,eMail:config.user.email,initials:getInitials(config.user.email),name:config.user.email},scope().toolbarUi.requestUpdate()}for(const e of scope().docs.values())e.forceThumbnailRefresh();scope().pagesUi.requestUpdate()}finally{this.changeProgress(1),this.requestUpdate()}}))}}customElements.define("wc-dialog-save",WcDialogSave);var __decorate$3=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n};let WcUploadImagesDialog=(()=>{class e extends LitElement{constructor(){super(),this.uploadProgress=-1,this.pasteMode=!1,this.backdrop=new WcBackdrop}showDialog(e){this.callback=e,document.body.appendChild(this.backdrop),document.body.appendChild(this)}uploadFiles(e){document.body.appendChild(this.backdrop),document.body.appendChild(this),this.pasteMode=!0,ImageRef.upload(e,(e=>this.changeProgress(e)),!0)}closeDialog(){this.backdrop.parentElement&&(document.body.removeChild(this.backdrop),document.body.removeChild(this))}static get properties(){return{mode:{type:String},uploadProgress:{type:Number}}}static get styles(){return[dialogStyles,css`
          :host {
            max-width: 500px;
            max-height: 400px;
          }
          .content {
            padding-bottom: 30px;
          }
          
          .image-upload .progress {
              width: 250px; 
              border: 1px solid black; 
              height: 22px;
          }
          .image-upload-progress > div {
              background: var(--printess-headlineColor); 
              height: 100%; 
              color: var(--printess-headlineColorInverse);
              text-align: center;
              padding: 2px;
          }

          .upload-item {
            position: relative;
            width: 100%;
            border: 1px solid var(--printess-textColor);
           

            display: grid;
            grid-template-columns: 10px 50px 10px 1fr;
            grid-template-rows: 35px;
            align-items: center;
            padding: 5px;
            cursor: pointer;
            margin-top: 20px;
          }
          .upload-item:hover {
            border: 1px solid var(--printess-headlineColor);
          }
          .upload-item > input {
            opacity:0;
            position: absolute;
            left: -500px;
          }
          .upload-item-icon {
            grid-column: 2;
            width: 28px;
            height: 28px;
          }
          .upload-item-text {
            grid-column: 4;
            font-size: 18px;
            color: var(--printess-textColor);
          }

        `]}render(){return html`
     <div class="header">
              Upload Images 
            </div>
          <div class="content">
           
            ${(this.uploadProgress<0||this.uploadProgress>100)&&!this.pasteMode?html`
              <label class="upload-item">
                <input 
                  accept= "image/svg+xml,image/png,image/jpg,image/jpeg,image/tiff" 
                  @change="${e=>this.inputChange(e)}" 
                  type="file" multiple />
                <wc-icon class="upload-item-icon"  icon="cloud-upload-alt" ></wc-icon>
                <div class="upload-item-text" >Upload from Computer</div>        
              </label>
         
              <label class="upload-item" style="display: none;">
                <wc-icon class="upload-item-icon"  icon="facebook-round" ></wc-icon>
                <div class="upload-item-text" >Upload from Facebook</div>        
              </label>
            
            `:""}
          
              ${this.uploadProgress>=0&&this.uploadProgress<=100?html`
                <div class="image-upload-progress" >
                  <div style="width: ${100*this.uploadProgress}%">${Math.round(1e4*this.uploadProgress)/100+"%"}</div>
                </div>
              `:""} 
              
          </div>
        </div>
        ${this.pasteMode?html``:html`
          <div class="footer" >
            <vaadin-button style="grid-column: 3" @click=${this.closeDialog} theme="secondary">CLOSE</vaadin-button>
          </div>`}
        
          
         
        `}inputChange(e){var t;const o=e.target;o&&(null===(t=o.files)||void 0===t?void 0:t.length)&&(o.disabled=!0,ImageRef.upload(o.files,(e=>this.changeProgress(e)),!1))}changeProgress(e){this.uploadProgress=e,1===e&&this.closeDialog()}}return __decorate$3([property({attribute:!1})],e.prototype,"pasteMode",void 0),e})();customElements.define("wc-upload-images-dialog",WcUploadImagesDialog);var __decorate$4=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n},__awaiter$h=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};class PrintModel{constructor(){this.impositions=[{name:"A5 Portrait",url:"https://printess-bkr.s3.eu-central-1.amazonaws.com/impositions/a5.card.portrait.json"},{name:"A5 Landsacpe",url:"https://printess-bkr.s3.eu-central-1.amazonaws.com/impositions/a5.card.landscape.json"}],this.store=scope().serializeAll(!0),this.documents=this.store.documents.map((e=>e.data.na));for(let e=0;e<this.store.documents.length;e++){const t=this.store.documents[e];if(t.data.pro){this.documentName=t.data.na;break}}if(!this.documentName)for(let e=0;e<this.store.documents.length;e++){const t=this.store.documents[e];if(t.data.pri){this.documentName=t.data.na;break}}if(!this.documentName)for(let e=0;e<this.store.documents.length;e++){const t=this.store.documents[e];this.documentName=t.data.na;break}}}let WcDialogPrint=(()=>{class e extends LitElement{constructor(){super(),this.backdrop=new WcBackdrop,this.model=new PrintModel}showDialog(){document.body.appendChild(this.backdrop),document.body.appendChild(this)}closeDialog(){this.backdrop.parentElement&&(document.body.removeChild(this.backdrop),document.body.removeChild(this))}static get styles(){return[dialogStyles,css`
      :host {
        width: 90%;
        height: 90%;
      }

      #imposition {
        width:60%;
      }
      `]}render(){return html`
    <div class="content">
    
      <div class="documents">
        <select id="document">
          ${this.model.documents.map((e=>html`<option value="${e}" ?selected="${e===this.model.documentName}">${e}</option>`))}
        </select>
      </div>

      <div class="impositions">
        <label for="imposition">Imposition Url</label>
        <input id="imposition" list="impositions">
        <datalist id="impositions">
          ${this.model.impositions.map((e=>html`<option value="${e.url}">${e.name}</option>`))}
        </datalist>
      </div>
      
    </div>

    <div class="footer">
      <vaadin-button style="grid-column: 0" @click=${this.print} theme="secondary">Render Pdf File</vaadin-button>
      <vaadin-button style="grid-column: 4" @click=${this.closeDialog} theme="secondary">Close</vaadin-button>
    </div>
    `}print(){return __awaiter$h(this,void 0,void 0,(function*(){const e=createPrintessApiFromExternalConfig(),t=this.createPrintModel();e.debugProduceModel(t)}))}createPrintModel(){const e={},t=this.model.store.template.id;return e[this.document.value]="",JSON.stringify({jobId:t,templateName:t,json:JSON.stringify(this.model.store),documents:e,record:"",outputSettings:{impositionUrl:this.imposition.value}})}}return __decorate$4([query("#document")],e.prototype,"document",void 0),__decorate$4([query("#imposition")],e.prototype,"imposition",void 0),e})();customElements.define("wc-dialog-print",WcDialogPrint);var __awaiter$i=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};let _clipboardContainer=null;function getClipboardContainer(){return _clipboardContainer||(_clipboardContainer=document.getElementById("clipboard-container"),_clipboardContainer||null)}function attachKeyHandler(){window.addEventListener("keyup",onKeyUp,!0),window.addEventListener("keydown",onKeyDown,!0),document.addEventListener("paste",handlePaste)}function onKeyUp(e){console_log("KeyUp --\x3e meta: "+e.metaKey+"       key="+e.key),scope()&&scope().copyPasteConsumer&&console_log("Context="+scope().copyPasteConsumer.getContextName()),"Shift"===e.key&&scope().pathEditorActive()&&scope().pathEditor.shiftPressedOrReleased(!1)}function keyDownReplay(e){_onKeyDown(new KeyboardEvent("keydown",{isComposing:e.isComposing,key:e.key,metaKey:e.metaKey,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,altKey:e.altKey}),e.tagName)}function onKeyDown(e){var t;if(!scope())return;if(scope().isReplaying)return;if(config.hideControls&&!scope().eddiActive()&&!scope().pathEditorActive())return;const o=document.activeElement,i=null!==(t=null==o?void 0:o.tagName)&&void 0!==t?t:"";scope().isRecording&&(e.shiftKey&&e.ctrlKey&&"R"===e.key||scope().e2e.record({module:"keyHandling",func:"keyDownReplay",args:[{key:e.key,metaKey:e.metaKey,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,altKey:e.altKey,tagName:i}]})),_onKeyDown(e,i)}function _onKeyDown(e,t){var o,i;if(console_log("KeyDown --\x3e meta: "+e.metaKey+"       key="+e.key+"    TagName="+t),"WC-SELECTION-PROPERTIES"!==t){if("WC-PRODUCT-MATRIX"!==t){if(scope().resourcesStylesUi.hasFocus()){const t=scope().resourcesStylesUi.getCurrentEddi();if((e.ctrlKey||e.metaKey)&&"cxv".indexOf(e.key)>=0)t&&(scope().copyPasteConsumer=t);else if(t)return void t.keyDown(e)}if("WC-RESOURCES"!==t&&!scope().isModalDialogOpen())if(!scope().eddiActive()||(e.ctrlKey||e.metaKey)&&"cxv".indexOf(e.key)>=0)if(scope().cropEditorActive()&&"Enter"===e.key)scope().closeCropEditor();else if("Shift"===e.key&&scope().pathEditorActive()&&scope().pathEditor.shiftPressedOrReleased(!0),e.ctrlKey&&e.shiftKey)switch(e.key){case"T":e.metaKey?scope().resourcesMacrosUi.runAllTests(100):scope().resourcesMacrosUi.runAllTests();break;case"R":scope().isRecording?scope().e2e.stopRecording():scope().isReplaying;break;case"U":scope().highlight("resources-toolbar-styles")}else if(e.ctrlKey||e.metaKey){let t=null;if(scope().isModalDialogOpen())return e.preventDefault(),void beep();switch(e.key){case"p":e.preventDefault();(new WcDialogPrint).showDialog();break;case"+":if(e.preventDefault(),scope().selection.boxes.size>0){const e=scope().selection.boxes.values().next().value;e&&(t=scope().getBox(e.box.id))}else t=scope().selection.getSingleSelection();if(t){const e=t.box.boxGeometry.toPixel(t.spread.width(),t.spread.height()),o=e.left+e.width/2+t.spread.left(),i=e.top+e.height/2+t.spread.top();scrollTo(1.5*zoomFactor(),o,i,0)}else setCenterZoom(1.5*zoomFactor(),0);break;case"-":e.preventDefault(),setCenterZoom(zoomFactor()/1.5,0);break;case"o":{const t=new WcDialogOpen;e.preventDefault(),config.isBuyer?scope().toolbarUi.toggleBuyerSide().then((()=>{t.showDialog()})):t.showDialog();break}case"n":{const t=new WcDialogOpen;e.preventDefault(),t.showDialog();break}case"s":if(e.preventDefault(),scope().isModalDialogOpen())console_log("Problem");else{const e=new WcDialogSave;if("new"===scope().id)e.showSaveAsDialog();else{if(config.isDebugViewBkr)return void e.showAndSaveAndClose();!(null===(i=scope().template)||void 0===i?void 0:i.isWritable)||scope().isPublished?beep():e.showAndSaveAndClose()}}break;case"c":clipboardCopy(!1);break;case"x":clipboardCopy(!0);break;case"v":clipboardPaste(e.shiftKey);break;case"g":e.preventDefault(),scope().selection.groupBoxes("group");break;case"u":e.preventDefault(),scope().selection.groupBoxes("ungroup");break;case"a":e.preventDefault(),scope().copyPasteConsumer.selectAll();break;case"y":redo();break;case"z":e.shiftKey?redo():undo()}}else switch(e.key){case"?":new WcCopyModelDialog(scope().serializeAll()).showDialog();break;case"Delete":case"Backspace":scope().copyPasteConsumer.removeItem()||beep();break;case"+":scope().copyPasteConsumer.createItem().then((e=>{e||beep()})).catch((e=>{alert(e)}));break;case"g":case"G":scope().docUi.showGrid(!scope().templateProperties.showGrid);break;case"d":case"D":scope().templateProperties.toggleDataPanel();break;case"b":case"B":scope().toolbarUi.toggleBuyerSide();break;case"r":case"R":scope().meshEditorActive()&&(e.preventDefault(),scope().meshEditor.selectRow());break;case"c":case"C":scope().meshEditorActive()&&(e.preventDefault(),scope().meshEditor.selectColumn());break;case"s":case"S":scope().templateProperties.toggleStyleBadges();break;case"t":case"T":e.preventDefault(),scope().selectionPropertiesUi.selectTool("story");break;case"p":case"P":scope().selectionPropertiesUi.selectTool("pathText");break;case"m":case"M":scope().selectionPropertiesUi.selectTool("path");break;case"i":case"I":scope().selectionPropertiesUi.selectTool("image");break;case"v":case"V":case"Escape":scope().selectionPropertiesUi.selectTool("geometry");break;default:handleArrowKeys(e)}else!1!==config.hideControls&&"eddi"!==(null===(o=e.target)||void 0===o?void 0:o.name)||scope().eddiKeyDown(e)}}else!config.isMobile||"Enter"!==e.key&&"Escape"!==e.key||("form-field"===scope().selectionPropertiesUi.mobileUiState.state&&(scope().selectionPropertiesUi.mobileUiState={state:"form-fields"}),"ext-value"===scope().selectionPropertiesUi.mobileUiState.state&&(scope().selectionPropertiesUi.mobileUiState={state:"selection"}))}function handleArrowKeys(e){let t=1;e.shiftKey&&(t=10);let o=0,i=null;switch(e.key){case"ArrowLeft":o=-t,i="left";break;case"ArrowRight":o=t,i="left";break;case"ArrowUp":o=-t,i="top";break;case"ArrowDown":o=t,i="top"}i&&scope().selection.boxes.size&&scope().selection.addOffsetToBoxPosition(i,o)}function clipboardCopy(e){const t=scope().copyPasteConsumer.getClipboardData(),o=getClipboardContainer();if(t&&o){if(flashScreen(),scope().resourcesStylesUi.hasFocus()){const e=scope().resourcesStylesUi.getCurrentEddi();e&&(e.skipBlurOnce=!0)}o.innerHTML="",o.style.display="block";const i=document.createElement("textarea");i.id="clipboard","PlainText"===t.context?i.value=t.objects.join(""):i.value=JSON.stringify(t),o.appendChild(i),i.focus(),i.select(),document.execCommand("copy"),e&&(scope().copyPasteConsumer.removeItem()||beep()),o.removeChild(i);const r=document.activeElement;r&&"function"==typeof r.focus&&r.focus(),o.style.display="none",console_log("Set Clipboard Content New (Scope="+scope().copyPasteConsumer.getContextName()+")")}}function handlePaste(e){if(e.clipboardData&&e.clipboardData.files.length){(new WcUploadImagesDialog).uploadFiles(e.clipboardData.files)}}let pasteTimeout=0;function clipboardPaste(e){return __awaiter$i(this,void 0,void 0,(function*(){if(navigator.clipboard){const t=yield navigator.clipboard.readText();return void(t&&processClipboardData(t,e))}const t=getClipboardContainer();if(pasteTimeout||!t)return void beep();t.innerHTML="",t.style.display="block";const o=document.createElement("textarea");if(o.id="clipboard",scope().resourcesStylesUi.hasFocus()){const e=scope().resourcesStylesUi.getCurrentEddi();e&&(e.skipBlurOnce=!0)}t.appendChild(o),o.focus(),o.select(),pasteTimeout=window.setTimeout((()=>{document.execCommand("paste");const i=document.activeElement;i&&"function"==typeof i.focus&&i.focus(),o.value&&processClipboardData(o.value,e),t.removeChild(o),t.style.display="none",pasteTimeout=0}),50)}))}function processClipboardData(e,t){let o=null;try{o=JSON.parse(e)}catch(o){"Story"===scope().copyPasteConsumer.getContextName()&&(scope().copyPasteConsumer.setClipboardData({objects:[e],context:"PlainText",scopeId:""},t)||beep())}if(o&&Array.isArray(o.objects)&&o.context&&o.scopeId){const e=scope().copyPasteConsumer.getContextName();let i=e===o.context;i||"GlobalFormFields"!==o.context&&"DocFormFields"!==o.context||(i="GlobalFormFields"===e||"DocFormFields"===e),i&&scope().copyPasteConsumer.setClipboardData(o,t)?flashScreen():beep()}}var __awaiter$j=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};class Macro{constructor(e){if(this.name="New Macro",this._caption="",this._isTest=!1,this._scopeId="",this.state="",this.active=!0,this.name=e,e.startsWith("e2e")&&e.endsWith("]")){const t=e.split("["),o=t[t.length-1];this._scopeId=o.substr(0,o.length-1),this._caption=t[0].substr(3),this._isTest=!0}else this._scopeId="",this._caption=e,this._isTest=!1}get isTest(){return this._isTest}get caption(){return this._caption}get scopeId(){return this._scopeId}get icon(){return"passed"===this.state?"check":"failed"===this.state?"warning":"running"===this.state?"running":"robot"}get iconColor(){return"passed"===this.state?"green":"failed"===this.state?"red":"running"===this.state?"blue":"gray"}toString(){return this.name}}class E2e{constructor(){this.__isReplaying=!1,this.__isRecording=!1,this.recordingMacroName="",this.recordingStack=[],this.replayStack=[],this._valueCache=new Map,this.lastRecordedActivityTime=Date.now(),this.replayIndex=0,this.replayMacroName="",this.replayActivity=null,this.currentDiffs=[],this.replayTimeout=0}get isReplaying(){return this.__isReplaying}set isReplaying(e){this.__isReplaying=e,this.setToolbarColor()}get isRecording(){return this.__isRecording}set isRecording(e){this.__isRecording=e,this.setToolbarColor()}setToolbarColor(){const e=document.querySelector("wc-toolbar");e&&(this.isRecording?e.style.background="red":this.isReplaying?e.style.background="blue":e.style.background="",scope().resourcesMacrosUi.requestUpdate())}get isTestRecording(){return this.recordingMacroName.startsWith("e2e")}get isTestReplay(){return 0===this.replayMacroName.indexOf("e2e")}record(e){this.setToolbarColor();const t=e.args.map((e=>null==e?void 0:E2e.serialize(e)));this.recordingStack.push({module:e.module,func:e.func,args:t}),this.lastRecordedActivityTime=Date.now(),console_log("+++ RECORD =>"+JSON.stringify(e))}addDiff(e){this.record({module:"diff",func:"",args:[e]})}cache(e,t){let o;this._valueCache.set(e,t),null===t?o={module:"cache",func:e,args:["+++null+++"]}:void 0!==t&&(o={module:"cache",func:e,args:[t]}),o&&this.record(o)}getCachedValue(e){const t=this._valueCache.get(e);return"+++null+++"===t?null:t}startRecording(e){if(!this.isRecording&&!this.isReplaying){if(!e)return void alert("recording needs a name.");this.recordingMacroName=e,this.recordingStack=[],this.isRecording=!0,this.isReplaying=!1,this.replayIndex=0}}stopRecording(){this.saveMacro(),this.isRecording=!1}saveMacro(){return __awaiter$j(this,void 0,void 0,(function*(){if(!this.recordingMacroName)throw new Error("Cannot save macro. No name.");yield documentProvider().save(this.recordingMacroName,JSON.stringify(this.recordingStack))}))}playMacro(e){if(!e)throw new Error("Cant save macro. no name.");return new Promise(((t,o)=>{documentProvider().load(e).then((t=>(this.replayMacroName=e,t.json()))).then((o=>{o&&Array.isArray(o)||(alert("Can not load macro:"+e),t(!1)),this.replay(JSON.stringify(o)),t(!0)})).catch((t=>{console.error("Can not load macro: "+e,t),alert("Can not load macro: "+t),o(!1)}))}))}replay(e){this.replayStack=E2e.deSerialize(e),this.isRecording=!1,this.isReplaying=!0,this.replayIndex=0,this.replayActivity=null,this.replayRecordingStack()}cancelReplay(){this.replayStack=[],this.replayIndex=0,this.replayActivity=null,this.isRecording=!1,this.isReplaying=!1,scope().resourcesMacrosUi.allTestsRunning=!1,this.replayTimeout&&window.clearTimeout(this.replayTimeout)}replayRecordingStack(){if(this.replayIndex>=this.replayStack.length){this.isReplaying=!1;const e=scope().resourcesMacrosUi.macros.get(this.replayMacroName);return void(e&&("failed"!==e.state&&(e.state="passed"),scope().resourcesMacrosUi.requestUpdate(),window.setTimeout((()=>scope().resourcesMacrosUi.runNextTest()),100)))}const e=this.replayStack[this.replayIndex];for(this.replayActivity=e,this.replayIndex++;this.replayIndex<this.replayStack.length&&("cache"===this.replayStack[this.replayIndex].module||"diff"===this.replayStack[this.replayIndex].module);){const e=this.replayStack[this.replayIndex];"cache"===e.module?this._valueCache.set(e.func,e.args[0]):"diff"===e.module&&(this.currentDiffs=e.args),this.replayIndex++}switch(console_warn("REPLAY: "+e.module+"."+e.func+" **********************"),e.module){case"cache":case"diff":alert("Never here: Already handled before!!! "+e.module);break;case"index":"zoomstageMouseDownCallback"===e.func&&zoomstageMouseDownCallback.apply(void 0,e.args),"zoomstageMouseMoveCallback"===e.func&&zoomstageMouseMoveCallback.apply(void 0,e.args),"zoomstageMouseUpCallback"===e.func&&zoomstageMouseUpCallback.apply(void 0,e.args);break;case"selection":scope().selection[e.func].apply(scope().selection,e.args);break;case"WcSelectionProperties":scope().selectionPropertiesUi[e.func].apply(scope().selectionPropertiesUi,e.args);break;case"WcPages":scope().pagesUi[e.func].apply(scope().pagesUi,e.args);break;case"WcPathEditor":scope().pathEditor[e.func].apply(scope().pathEditor,e.args);break;case"WcRessourcesFonts":scope().resourcesFontsUi[e.func].apply(scope().resourcesFontsUi,e.args);break;case"WcLayers":scope().layersUi[e.func].apply(scope().layersUi,e.args);break;case"scope":scope()[e.func].apply(scope().resourcesFontsUi,e.args);break;case"keyHandling":keyDownReplay.apply(void 0,e.args);break;default:assertNever$1(e.module)}this.replayTimeout=window.setTimeout((()=>this.replayRecordingStack()),50)}static serialize(e){return JSON.parse(JSON.stringify(e,((e,t)=>"string"==typeof t||"boolean"==typeof t||"number"==typeof t?t:t instanceof Length?{e2eLength:t.toString()}:t instanceof Color?{e2eColor:t.serialize()}:t instanceof ColorRef?{e2eColorRef:t.serialize()}:t instanceof Image$1||t instanceof Font?{e2eImage:t.serialize()}:(E2e.isSerializable(t,!1)||alert("Can't Record value: ["+e+"] value="+t.constructor),t))))}static isSerializable(e,t=!0){let o;function i(e){return void 0===e||"string"==typeof e||"boolean"==typeof e||"number"==typeof e||Array.isArray(e)||function(e){return"[object Object]"===Object.prototype.toString.call(e)}(e)}if(!i(e))return!1;for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)){if(!i(e[r]))return!1;if("object"==typeof e[r]&&t&&(o=E2e.isSerializable(e[r]),!o))return!1}return!0}static deSerialize(e){return JSON.parse(e,E2e.reviver)}static reviver(e,t){if(t){if(t.e2eLength)return new Length(t.e2eLength);if(t.e2eImage)return new Image$1(t.e2eImage.id,t.e2eImage.data);if(t.e2eColor)return new Color(t.e2eColor.id,t.e2eColor.data);if(t.e2eColorRef)return new ColorRef(t.e2eColorRef.id,t.e2eColorRef);if(t.e2eFont)return new FontRef(t.e2eFont.id,t.e2eFont.data)}return t}static getSpread(e){const t=scope().currentDoc;for(const o of t.spreads.values())if(e.model.y>=o.top()&&e.model.y<=o.top()+o.height())return o;return null}static getWcSpread(e){const t=E2e.getSpread(e);return t?scope().docUi.getWcSpread(t.id):null}static getWcBox(e,t){var o;const i=E2e.getSpread(e);if(i){const r=e.model.x-i.left(),s=e.model.y-i.top(),n=hitTest(new Rect(r,s,1,1),i.toHitTestFrames(),e.ctrlKey),a=scope().docUi.getWcSpread(i.id);if(a)for(const e of n)if(e.id){const i=a.getWcBox(e.id);if(i&&(!t||t===(null===(o=null==i?void 0:i.box.storyRef)||void 0===o?void 0:o.story)))return i}}return null}}let blinkHandle;class SelectionPoint{constructor(e,t,o,i){if(this.xPos=0,this.yPos=0,this.height=0,this.cursorHeight=0,this.cursorYOffset=0,this.frameIndex=i,!t.parentParagraph)throw"Can't assign selection to a word without a parent paragraph  ";const r=t.parentParagraph.parentEddi.frames[this.frameIndex];if(t.parent||(o=(t=t.parentParagraph.parentEddi.lastVisibleWord).length),!t.parent)throw"Can't assign selection to a word without a parent Line  ";this.cursorSvg=e;const s=t.id.split("-");this.wordId=s[0],this.lineWordId=t.id,this._lineWordPos=o,2===s.length&&t.subWordPos?(this.wordSubIndex=parseInt(s[1]),this.wordPos=o+t.subWordPos.startOffSet):(this.wordSubIndex=0,this.wordPos=o),this.paragraphId=t.parentParagraph.id,this.parentEddi=t.parentParagraph.parentEddi;const n=t.parent;let a=t.x+n.left+n.firstWordOffSet;const l=t.charWidth;for(let e=0;e<Math.min(this._lineWordPos,l.length);e++)a+=l[e];this.xPos=a+r.boxOffset,this.yPos=n.baseline-n.ascender+r.boxOffset,this.height=n.ascender+n.descender,this.cursorHeight=n.ascender+n.descender,this.cursorYOffset=0,n.lastLine,this.drawCursor();const c=this.lineWord?this.lineWord.toString():"???",d=this.paragraph?this.paragraph.idLookUp[this.wordId]:"";console_log("SelectionPoint ["+c+"] xPos="+this.xPos+" wordId="+this.wordId+" wordPos="+this.wordPos+" LineWordId"+this.lineWordId+" LineWordPos="+this.lineWordPos,d,this.lineWord)}get lineWord(){return this.getValidLineWord().lineWord}get lineWordPos(){return this.getValidLineWord().lineWordPos}getValidLineWord(){const e={lineWord:null,lineWordPos:this._lineWordPos},t=this.paragraph;if(t){const o=this.lineWordId.split("-")[0];let i=t.idLookUp[this.lineWordId];if(i&&!i.parent){const e=t.getWordFromLine(this.lineWordId);e&&(console.warn("Paragraph Workd look Up Table is corrupt."),i=e)}if(i&&i.parent)e.lineWord=i;else if(o!==this.lineWordId){const i=t.idLookUp[o];if(i&&i.hyphenationPointsIncludeForceBreaks.length>=this.wordSubIndex){const t=this.wordSubIndex>0?i.hyphenationPointsIncludeForceBreaks[this.wordSubIndex-1].pos:0;e.lineWordPos=t+this._lineWordPos,e.lineWord=i}}else{const i=SelectionPoint.getLineWordByWordIdAndPos(t,o,this._lineWordPos);i.lineWord&&i.lineWord.parent&&(e.lineWord=i.lineWord,e.lineWordPos=i.lineWordPos)}}return e}static getLineWordByWordIdAndPos(e,t,o){let i=null,r=o,s=0,n=0;for(;e.idLookUp[t+"-"+s];){const a=e.idLookUp[t+"-"+s];o>=n&&o<=n+a.length&&(i=a,r=o-n),s++,n+=a.length}return{lineWord:i,lineWordPos:r}}get line(){const e=this.lineWord;return e?e.parent:null}get paragraph(){const e=this.parentEddi.idLookUp[this.paragraphId];return e||null}freezeCursor(){this.cursorSvg&&blinkHandle&&(window.clearTimeout(blinkHandle),this.cursorSvg.setAttributeNS(null,"class","printess-eddi-steady-cursor"))}activateCursor(){if(this.cursorSvg){const e=this.parentEddi.selection.input,t=this.cursorSvg;blinkHandle&&window.clearTimeout(blinkHandle),e&&(document.activeElement!==e&&(e.focus(),console_log("===> FOCUS INPUT <==== ["+e.value+"]")),t.setAttributeNS(null,"class","printess-eddi-steady-cursor"),blinkHandle=window.setTimeout((()=>{t.setAttributeNS(null,"class","printess-eddi-blinking-cursor")}),1e3))}}drawCursor(){if(this.cursorSvg){const e=this.cursorSvg,t=this.line,o=this.parentEddi;t&&e.parentNode!==o.frames[t.boxIndex].svg&&o.frames[t.boxIndex].svg.appendChild(e);const i=this.xPos;if(e.setAttributeNS(null,"height",this.cursorHeight.toString()),e.setAttributeNS(null,"width",(1/o.config.zoom()*1.2).toString()),e.setAttributeNS(null,"y",(this.yPos+this.cursorYOffset).toString()),e.setAttributeNS(null,"x",i.toString()),e.setAttributeNS(null,"visibility","visible"),t){const e=this.lineWord;if(e){const t=o.selection.input;if(t){if(!o.selection.inputHasIME){t.style.height=this.height+"px",t.style.width="400px",t.style.left="-1000px",t.style.top="-1000px";const o=e.getSpan(this.lineWordPos),i=o.textStyle.fullStyle(o);t.style.fontFamily=i.font.font.name,t.style.fontSize=i.fontSize+"px",t.style.lineHeight=o.textStyle.getLineHeight(o)+"px"}this.activateCursor()}}}}}getScreenPosition(){const e=this.parentEddi.frames[this.frameIndex];let t=e.left+e.spreadLeft+this.xPos,o=e.top+e.spreadLeft+this.yPos;const i=this.line;return e.boxId?(t=this.parentEddi.config.modelXToScreenX(e.left-e.boxOffset+e.spreadLeft+Math.max(this.xPos,0)),o=this.parentEddi.config.modelYToScreenY(e.top+-e.boxOffset+e.spreadTop+this.yPos),i&&(o+=i.height*this.parentEddi.config.zoom())):i&&(o+=1.5*i.height),{x:t,y:o}}}class Selection{constructor(e){if(this.inputLastLength=0,this.inputInitialPos=0,this.inputInitialWordId="",this.inputHasIME=!1,this.selectAll=!1,this.intellisenseTokens=[],this.selectedTokenValue="",this.selectedTokenPostfix="",this.tokenFilter="",this.tokenFilterStartTime=Date.now(),this.svgs={startCursor:Selection.createEmptySvgRect(),endCursor:null,boxTop:Selection.createEmptySvgRect(),boxCenter1:Selection.createEmptySvgRect(),boxCenter2:Selection.createEmptySvgRect(),boxBottom:Selection.createEmptySvgRect(),boxesBetween:new Map},this.svgs.boxTop.setAttributeNS(null,"class","printess-eddi-selection-box boxTop"),this.svgs.boxCenter1.setAttributeNS(null,"class","printess-eddi-selection-box boxCenter1"),this.svgs.boxCenter2.setAttributeNS(null,"class","printess-eddi-selection-box boxCenter2"),this.svgs.boxBottom.setAttributeNS(null,"class","printess-eddi-selection-box boxBottom"),this.svgs.startCursor.setAttributeNS(null,"class","printess-eddi-blinking-cursor"),this.svgs.endCursor&&this.svgs.endCursor.setAttributeNS(null,"class","printess-eddi-blinking-cursor"),"edit"===e.mode){this.input=document.createElement("input"),this.input.style.width="400px",this.input.style.height="20px",this.input.style.color="red",this.input.style.padding="0",this.input.style.margin="0",this.input.style.border="0px",this.input.style.opacity="0.4",this.input.style.outline="none",this.input.style.position="absolute",this.input.style.background="transparent",this.input.name=e.config.name,document.body.appendChild(this.input);let t=!1;this.input.addEventListener("paste",(e=>{t=!0})),this.input.addEventListener("input",(()=>{if(t)return t=!1,void(this.input&&(this.input.value=""));let e=!1;this.input&&this.input.value&&!this.inputHasIME&&(this.hasRange&&(e=this.parent.deleteSelectedContent(!1),this.removeRange()),this.paragraph&&this.parent.render(this.paragraph.modifyWord(this.input.value,!1,e)),this.input.value="")})),this.input.addEventListener("blur",(()=>{console_log("BLURRED"),this.inputHasIME=!1,this.parent.config.codeMode?this.parent.blur():this.start&&!this.end&&this.start.freezeCursor()})),this.input.addEventListener("focus",(()=>{console_log("FOCUSSED")})),this.input.addEventListener("compositionstart",(()=>{console_log("****** compositionstart ***** "),this.start&&(this.inputHasIME=!0,this.inputInitialPos=this.start.wordPos,this.inputInitialWordId=this.start.wordId,this.inputLastLength=0)})),this.input.addEventListener("compositionupdate",(e=>{console_log("****** compositionupdate ***** "),this.previewInputFieldBuffer(e.data,!0),this.inputHasIME=!0})),this.input.addEventListener("compositionend",(e=>{console_log("****** compositionend ***** "),this.previewInputFieldBuffer(e.data,!1),this.input&&(this.input.value=""),this.inputHasIME=!1}))}this.parent=e,this.start=null,this.end=null,e.textInfoBeforeDelete=null}createBetweenBoxes(e){if(this.svgs.boxesBetween.size!==Math.max(0,this.parent.frames.length-2)){this.svgs.boxesBetween=new Map;for(let t=1;t<this.parent.frames.length-1;t++){const o=Selection.createEmptySvgRect();o.setAttributeNS(null,"class","printess-eddi-selection-box"),o.setAttributeNS(null,"transform","translate("+e+" "+e+")"),this.svgs.boxesBetween.set(t,o)}}}inputReplay(e){if(1===e.length){let t=!1;this.hasRange&&(t=this.parent.deleteSelectedContent(!1),this.removeRange()),this.paragraph&&(console_log("INPUT VALUE -> MODIFY WORD ["+e+"]"),this.parent.render(this.paragraph.modifyWord(e,!1,t)))}}emptyInputFieldBuffer(){}setFocus(){this.start&&!this.end&&this.start.activateCursor()}previewInputFieldBuffer(e,t){if(document.activeElement===this.input&&e&&this.paragraph){const o=this.inputInitialWordId,i=this.inputInitialPos;let r=i;if(console_log("previewInputFieldBuffer   first="+i+"   second="+r),o){this.inputLastLength>0&&(r+=this.inputLastLength);const s=this.paragraph.replaceChars(e,o,i,r,t);this.inputLastLength=e.length,this.parent.render("leave-unchanged"),s&&this.setStartOrEndBySelection("start",s,t)}}}getXPos(e){if("start"===e){if(this.start)return this.start.xPos}else if(this.end)return this.end.xPos;return 0}getYPos(e){if("start"===e){if(this.start)return this.start.yPos}else if(this.end)return this.end.yPos;return 0}get lineStartTabCount(){if(this.start){const e=this.start.line;if(e)return e.startTabCount}return 0}getLineWord(e){if("start"===e){if(this.start)return this.start.lineWord}else if(this.end)return this.end.lineWord;return null}getLineWordId(e){if("start"===e){if(this.start)return this.start.lineWordId}else if(this.end)return this.end.lineWordId;return null}getLineWordPos(e){if("start"===e){if(this.start)return this.start.lineWordPos}else if(this.end)return this.end.lineWordPos;return 0}getSelectedFrame(){if(this.start&&this.start.line){const e=this.start.line.boxIndex;if(e>=0&&e<this.parent.frames.length)return this.parent.frames[e]}return null}getStartSelection(){return this.start?{wordPos:this.start.wordPos,wordId:this.start.wordId,paragraphId:this.start.paragraphId,joinWithPreviousUndo:!1}:null}getEndSelection(){return this.end?{wordPos:this.end.wordPos,wordId:this.end.wordId,paragraphId:this.end.paragraphId,joinWithPreviousUndo:!1}:null}getRuleName(){if(this.start){const e=this.start.lineWordPos,t=this.start.lineWord;if(t){const o=t.getSpan(this.start.lineWordPos);if(o){let i="";return i=e+1>=t.length&&o.textStyle.temporaryProperties.annotationNextRule?o.textStyle.temporaryProperties.annotationNextRule:o.textStyle.temporaryProperties.annotationRule?o.textStyle.temporaryProperties.annotationRule:"root",i}}}return"root"}getCharsBeforeStart(){if(this.start){const e=this.start.lineWord;if(e){const t=this.start.lineWordPos,o=e.toString();if(t>0&&t<=o.length&&t>0&&o.substr(t-1,1).match(/\w/))return o.substr(0,t)}}return""}get paragraph(){return this.start?this.start.paragraph:null}static createEmptySvgRect(){return document.createElementNS("http://www.w3.org/2000/svg","rect")}reset(){this.emptyInputFieldBuffer(),this.hideRangeAndStart(),this.start=null,this.end=null,this.parent.textInfoBeforeDelete=null}setSelectAll(){this.emptyInputFieldBuffer();const e=this.parent.firstParagraph.lines[0].firstWord,t=this.parent.lastVisibleWord;this.setRangeByLineWord(e,0,t,t.length,this.parent.firstParagraph.lines[0].boxIndex,this.parent.lastVisibleLine.boxIndex),this.selectAll=!0,this.parent.textInfoBeforeDelete=null}setSelectParagraph(e){var t,o;this.emptyInputFieldBuffer();const i=null===(t=e.firstLine)||void 0===t?void 0:t.firstWord,r=null===(o=e.lastLine)||void 0===o?void 0:o.lastWord;i&&r?(this.setRangeByLineWord(i,0,r,r.length,e.lastStartFrameIndex,e.lastEndFrameIndex),this.selectAll=!1,this.parent.textInfoBeforeDelete=null):this.setSelectAll()}setStartByLineWord(e,t,o){this.emptyInputFieldBuffer(),this.removeRange(),this.parent.textInfoBeforeDelete=null,this.selectAll=!1,this.start=new SelectionPoint(this.svgs.startCursor,e,t,o),this.parent.selectionChanged()}setRangeByLineWord(e,t,o,i,r,s){this.emptyInputFieldBuffer(),this.parent.textInfoBeforeDelete=null,this.selectAll=!1,this.start=new SelectionPoint(this.svgs.startCursor,e,t,r),this.end=new SelectionPoint(this.svgs.endCursor,o,i,s),this.drawRange(),this.parent.selectionChanged()}setEndByLineWord(e,t,o){this.emptyInputFieldBuffer(),this.parent.textInfoBeforeDelete=null,this.selectAll=!1,this.end=new SelectionPoint(this.svgs.endCursor,e,t,o),this.drawRange(),this.parent.selectionChanged()}setStartOrEndByLineWord(e,t,o){const i=t.parent?t.parent.boxIndex:0;this.parent.textInfoBeforeDelete=null,"start"===e?this.setStartByLineWord(t,o,i):this.setEndByLineWord(t,o,i)}setEndToStart(){if(this.emptyInputFieldBuffer(),this.selectAll=!1,this.parent.textInfoBeforeDelete=null,!this.start||!this.start.lineWord)throw"Can't set selection end to start, start word not found.";this.end=new SelectionPoint(this.svgs.endCursor,this.start.lineWord,this.start.lineWordPos,this.start.frameIndex),this.parent.selectionChanged()}setStartBySelection(e){this.setStartOrEndBySelection("start",e)}setEndBySelection(e){this.setStartOrEndBySelection("end",e)}getSelection(){return this.start?{wordId:this.start.wordId,wordPos:this.start.wordPos,paragraphId:this.start.paragraphId,joinWithPreviousUndo:!1}:null}setStartOrEndBySelection(e,t,o=!1){o||this.emptyInputFieldBuffer(),this.selectAll=!1,"start"===e&&this.removeRange(),this.parent.textInfoBeforeDelete=null;let i=!1;if(t.wordId.startsWith("NEXT:")&&(i=!0,t.wordId=t.wordId.substr(5)),t.wordId.startsWith("FIRSTOF:")){const e=t.wordId.substr(8),o=this.parent.idLookUp[e];o&&o.firstLine?t.wordId=o.firstLine.firstWord.id:t.wordId="FIRST",t.wordPos=0}if(t.wordId.startsWith("LASTOF:")){const e=t.wordId.substr(7),o=this.parent.idLookUp[e];o&&o.lastLine?(t.wordId=o.lastLine.lastWord.id,t.wordPos=o.lastLine.lastWord.length):t.wordId="LAST"}if("FIRST"===t.wordId){const e=this.parent.paragraphs[0];e&&e.firstLine&&(t.wordId=e.firstLine.firstWord.id)}if("LAST"===t.wordId){const e=this.parent.lastVisibleWord;e&&(t.wordId=e.id,t.wordPos=e.length)}let r=this.parent.getParagraphByWordId(t.wordId);if(!r&&(r=this.parent.idLookUp[t.paragraphId],!r)){if(console.warn("Selection failed, paragraph not found for "+t.wordId+" Set to start of text."),r=this.parent.paragraphs[0],!r||!r.firstLine)throw"First Paragraph not found or no firstLine: "+r;t.wordId=r.firstLine.firstWord.id}let s=t.wordPos,n=r.getWordFromLine(t.wordId);if(!n||!n.parent){const e=SelectionPoint.getLineWordByWordIdAndPos(r,t.wordId,t.wordPos);e.lineWord&&(n=e.lineWord,s=e.lineWordPos)}n||(n=this.parent.lastVisibleWord,s=n.length),i&&n.nextWord&&(n=this.parent.config.codeMode&&n.nextWord.parent&&n.nextWord.parent.firstWord===n.nextWord&&0===n.nextWord.length&&n.nextWord.next?n.nextWord.next:n.nextWord,s=0);const a=n.parent?n.parent.boxIndex:0;"start"===e?this.start=new SelectionPoint(this.svgs.startCursor,n,s,a):this.end=new SelectionPoint(this.svgs.startCursor,n,s,a),this.parent.selectionChanged()}setByMouseEvent(e,t,o=!1){let i=-1;if(t.target){const e=t.target.dataset.index;"string"==typeof e&&(i=parseInt(e))}if(i<0){if(2!==this.parent.frames.length)return;i=0}const r=this.parent.frames[i],s=r.div?r.div.scrollLeft:0,n=r.div?r.div.scrollTop:0;this.parent.config.codeMode&&scope().clearSelectionAndAllEditors();const a=t.clientX-r.left+r.spreadLeft+window.scrollX+s+r.boxOffset,l=Math.max(0,t.clientY-r.top+window.scrollY+n)+r.boxOffset;let c=null;console_log("MouseMove x="+a+" y="+l+" frame="+i);for(const t of this.parent.paragraphs)for(const s of t.lines)if(s.boxIndex===i&&(l>=s.top&&l<=s.top+s.height&&(c=s.getWordAtXCoordinate(a)),!c&&s===t.lastLine&&l>=s.top&&l<=s.top+s.height+t.getSpaceAfter(r.useBaselineGrid)&&(c=s.getWordAtXCoordinate(a)),c)){if(console_log("mouse: lineWord="+c.lineWord.id+" frame="+i),o){const e=c.lineWord.toString();let t=c.lineWordPos,o=Math.min(c.lineWordPos+1,e.length);if(e){for(let o=Math.min(e.length-1,c.lineWordPos);o>=0;o--){if(!e[o].match(/\w/))break;t=o}for(let t=c.lineWordPos;t<e.length;t++){if(!e[t].match(/\w/))break;o=Math.min(t+1,e.length)}}this.setRangeByLineWord(c.lineWord,t,c.lineWord,o,i,i)}else"start"===e?this.setStartByLineWord(c.lineWord,c.lineWordPos,i):this.setEndByLineWord(c.lineWord,c.lineWordPos,i);return void(this.intellisenseActive&&this.hideIntellisense())}if(this.parent.lastParagraph.lastLine){const t=this.parent.lastParagraph.lastLine.lastWord;this.setStartOrEndByLineWord(e,t,t.length)}}getFirstOrLastWordOfFrame(e,t){let o=null;for(const i of this.parent.paragraphs)if(i.lastStartFrameIndex<=t&&i.lastEndFrameIndex>=t)for(const r of i.lines)if(r.boxIndex===t){if("first"===e)return{lineWordPos:0,lineWord:r.firstWord};o={lineWordPos:r.lastWord.length,lineWord:r.lastWord}}return o}setByMouseTouchEvent(e,t,o=!1){let i,r=-1;if(i=E2e.getWcBox(t,scope().eddiActiveStory)||void 0,i){const t=this.parent.getFrameByBoxId(i.box.id);t?r=t.index:"end"===e&&(i=void 0)}if(r<0&&"end"===e&&this.start&&this.start.line&&(r=this.start.line.boxIndex),r<0)return;let s,n=null;if(i){const e=scope().getBox(i.box.id);if(e){const o=e.box.boxGeometry.toPixel(e.spread.width(),e.spread.height());s={x:t.model.x-o.left-e.spread.left(),y:t.model.y-o.top-e.spread.top()}}}if(!s){"end"===e&&this.end?r=this.end.frameIndex:this.start&&(r=this.start.frameIndex);const o=this.parent.frames[r],i=t.model.y-o.spreadTop,n=t.model.x-o.spreadLeft;s={x:0,y:0},i<o.top?s.y=0:i>o.top+o.height?s.y=o.top+o.height:s.y=i-o.top,n<o.left?s.x=0:n>o.left+o.width?s.x=o.left+o.width:s.x=n-o.left}if(s){console.log("MouseTouchMove x="+s.x+" y="+s.y+" frame="+r);let e=null;for(const t of this.parent.paragraphs){for(const o of t.lines){if(o.boxIndex===r){let i=!1;s.y<o.top?n={lineWordPos:0,lineWord:o.firstWord}:s.y>=o.top+o.firstLineOffset&&s.y<=o.top+o.firstLineOffset+o.height?s.x>o.left+o.width&&o.next&&o.next.subLineIndex>o.subLineIndex?i=!0:n=o.getWordAtXCoordinate(s.x):e={lineWordPos:o.lastWord.length,lineWord:o.lastWord},!i&&!n&&o===t.lastLine&&s.y>=o.top+o.firstLineOffset&&s.y<=o.top+o.height+o.firstLineOffset+t.getSpaceAfter(this.parent.frames[r].useBaselineGrid)&&(n=o.getWordAtXCoordinate(s.x))}else e&&(n=e);if(n)break}if(n)break}}if(n)return console_log("mouse: lineWord="+n.lineWord.id+"("+n.lineWord.toString()+") frame="+r),o?this.setRangeByLineWord(n.lineWord,0,n.lineWord,n.lineWord.length,r,r):"start"===e?this.setStartByLineWord(n.lineWord,n.lineWordPos,r):this.setEndByLineWord(n.lineWord,n.lineWordPos,r),void(this.intellisenseActive&&this.hideIntellisense());if(this.parent.lastParagraph.lastLine){const t=this.parent.lastParagraph.lastLine.lastWord;this.setStartOrEndByLineWord(e,t,t.length)}this.intellisenseActive&&this.hideIntellisense()}get hasRange(){return this.start&&this.end?this.start.wordId!==this.end.wordId||this.start.wordPos!==this.end.wordPos:null!==this.end}removeRange(){this.end&&(this.end=null,this.hideRange())}updateSelectionPoint(e,t){let o;if(o="start"===e?this.start:this.end,!o)return null;const i=this.parent.idLookUp[o.paragraphId];if(i){if(i.idLookUp[o.wordId]){let r=i.idLookUp[o.wordId],s=o.wordPos,n=0,a=0;for(;i.idLookUp[o.wordId+"-"+a]&&i.idLookUp[o.wordId+"-"+a].parent;){const t=i.idLookUp[o.wordId+"-"+a];let l;if(l="start"===e?o.wordPos<t.length+n:o.wordPos<=t.length+n,o.wordPos>=n&&l){r=t,s=o.wordPos-n;break}n+=t.length,a++}return r.parent?new SelectionPoint(t,r,s,r.parent.boxIndex):new SelectionPoint(t,this.parent.lastVisibleWord,this.parent.lastVisibleWord.length,this.parent.lastVisibleLine.boxIndex)}return console.error("updateSelectionPoint - Word not found, might be in overflow"),new SelectionPoint(t,this.parent.lastVisibleWord,this.parent.lastVisibleWord.length,this.parent.lastVisibleLine.boxIndex)}return console.error("updateSelectionPoint - Word not found, might be in overflow"),new SelectionPoint(t,this.parent.lastVisibleWord,this.parent.lastVisibleWord.length,this.parent.lastVisibleLine.boxIndex)}redraw(){this.selectAll?this.setSelectAll():(this.start&&(this.start=this.updateSelectionPoint("start",this.svgs.startCursor),this.end?this.end=this.updateSelectionPoint("end",this.svgs.endCursor):this.removeRange()),this.drawRange())}static getUsedTextStyle(e){const t={};return!e.fontSize.value||"Paragraph"!==e.fontSize.origin&&"Span"!==e.fontSize.origin||(t.fontSize=e.fontSize.value),!e.lineHeight.value||"Paragraph"!==e.lineHeight.origin&&"Span"!==e.lineHeight.origin||(t.lineHeight=e.lineHeight.value),!e.fontColor.value||"Paragraph"!==e.fontColor.origin&&"Span"!==e.fontColor.origin||(t.fontColor=e.fontColor.value),!e.font.value||"Paragraph"!==e.font.origin&&"Span"!==e.font.origin||(t.font=e.font.value),!e.tracking.value||"Paragraph"!==e.tracking.origin&&"Span"!==e.tracking.origin||(t.tracking=e.tracking.value),!e.baselineShift.value||"Paragraph"!==e.baselineShift.origin&&"Span"!==e.baselineShift.origin||(t.baselineShift=e.baselineShift.value),t}static getUsedParagraphStyle(e){const t={};return!e.horizontalTextAlign.value||"Paragraph"!==e.horizontalTextAlign.origin&&"Span"!==e.horizontalTextAlign.origin||(t.horizontalTextAlign=e.horizontalTextAlign.value),t}getTextInfo(){if(!this.start)return null;const e=this.getSelectedSpans();if(0===e.spans.length){console_log("Cant find LineWord: "+this.start.lineWordId,this.parent.paragraphs[0].idLookUp,this.parent.paragraphs);this.getSelectedSpans()}const t=e.spans;if(0===t.length)return console.error("Invalid Selection can't look up first Span"),{fullStyle:baseTextStyleProps(),chars:"",span:null,rule:null,spanClass:{value:null,origin:"None"},paragraphClass:{value:null,origin:"None"},lineHeight:{value:null,origin:"None"},tracking:{value:null,origin:"None"},fontColor:{value:null,origin:"None"},font:{value:null,origin:"None"},fontSize:{value:null,origin:"None"},baselineShift:{value:null,origin:"None"},horizontalTextAlign:{value:null,origin:"None"},spaceAfterParagraph:{value:null,origin:"None"},spaceBeforeParagraph:{value:null,origin:"None"},leftIndent:{value:null,origin:"None"},rightIndent:{value:null,origin:"None"},firstLineIndent:{value:null,origin:"None"},bulletSize:{value:null,origin:"None"},bulletShift:{value:null,origin:"None"},bulletShape:{value:null,origin:"None"},bulletColor:{value:null,origin:"None"}};const o=t[0],i=o.textStyle.temporaryProperties.annotationRule||null;return{span:o,chars:t.map((e=>e.chars)).reduce(((e,t)=>e+t),"").substr(0,10),rule:i,fullStyle:o.textStyle.fullStyle(o),lineHeight:TextStyle.getTextStylePropertyFromSpans(t,"lineHeight"),tracking:TextStyle.getTextStylePropertyFromSpans(t,"tracking"),baselineShift:TextStyle.getTextStylePropertyFromSpans(t,"baselineShift"),fontSize:TextStyle.getTextStylePropertyFromSpans(t,"fontSize"),font:TextStyle.getTextStylePropertyFromSpans(t,"font"),fontColor:TextStyle.getTextStylePropertyFromSpans(t,"fontColor"),spanClass:TextStyle.getClassPropertyFromSpans(t),paragraphClass:TextStyle.getClassPropertyFromParagraphs(e.paragraphs),horizontalTextAlign:ParagraphStyle.getParagraphStylePropertyFromParagraphs(e.paragraphs,"horizontalTextAlign"),spaceAfterParagraph:ParagraphStyle.getParagraphStylePropertyFromParagraphs(e.paragraphs,"spaceAfterParagraph"),spaceBeforeParagraph:ParagraphStyle.getParagraphStylePropertyFromParagraphs(e.paragraphs,"spaceBeforeParagraph"),leftIndent:ParagraphStyle.getParagraphStylePropertyFromParagraphs(e.paragraphs,"leftIndent"),rightIndent:ParagraphStyle.getParagraphStylePropertyFromParagraphs(e.paragraphs,"rightIndent"),firstLineIndent:ParagraphStyle.getParagraphStylePropertyFromParagraphs(e.paragraphs,"firstLineIndent"),bulletSize:ParagraphStyle.getParagraphStylePropertyFromParagraphs(e.paragraphs,"bulletSize"),bulletShift:ParagraphStyle.getParagraphStylePropertyFromParagraphs(e.paragraphs,"bulletShift"),bulletShape:ParagraphStyle.getParagraphStylePropertyFromParagraphs(e.paragraphs,"bulletShape"),bulletColor:ParagraphStyle.getParagraphStylePropertyFromParagraphs(e.paragraphs,"bulletColor")}}getSelectedSpans(){var e,t,o,i;const r=new Set,s=new Set,n=new Set;if(this.start&&this.start.lineWord&&this.end&&this.end.lineWord){let a=this.start,l=this.end;if(this.toggleStartEnd()){const e=a;a=l,l=e}if(!a.lineWord||!l.lineWord)throw"Will never happen ...";if(a.wordId!==l.wordId||a.line!==l.line){const c=[];c.push(...a.lineWord.getSpans(a.lineWordPos,a.lineWord.length,!0)),n.add(a.lineWord.parentParagraph),(null===(e=a.lineWord.parentParagraph)||void 0===e?void 0:e.textStyle.properties.class)&&r.add(null===(t=a.lineWord.parentParagraph)||void 0===t?void 0:t.textStyle.properties.class);for(const e of a.lineWord.spanClasses)s.add(e);let d=a.lineWord.nextWord;for(;d&&d!==l.lineWord;){c.push(...d.spans);for(const e of d.spanClasses)s.add(e);(null===(o=a.lineWord.parentParagraph)||void 0===o?void 0:o.textStyle.properties.class)&&r.add(null===(i=a.lineWord.parentParagraph)||void 0===i?void 0:i.textStyle.properties.class),n.add(d.parentParagraph),d=d.nextWord}if(c.push(...l.lineWord.getSpans(0,l.lineWordPos,!0)),n.add(l.lineWord.parentParagraph),c.length)return{paragraphClasses:r,spanClasses:s,spans:c,paragraphs:Array.from(n)};{let e=a.lineWordPos,t=e+1;return e>0&&(t=e,e--),{paragraphClasses:r,spanClasses:s,spans:a.lineWord.getSpans(e,t,!0),paragraphs:[a.lineWord.parentParagraph]}}}{let e=l.lineWordPos,t=a.lineWordPos;return e===t&&(t>0?t--:e++),{paragraphClasses:a.lineWord.paragraphClasses,spanClasses:a.lineWord.spanClasses,spans:a.lineWord.getSpans(t,e,!0),paragraphs:[a.lineWord.parentParagraph]}}}if(this.start&&this.start.lineWord){const e=this.start.lineWord,t=e.getSpan(this.start.lineWordPos);return{paragraphClasses:e.paragraphClasses,spanClasses:t.spanClasses,spans:[t],paragraphs:[t.parentWord.parentParagraph]}}if(this.start&&this.start.wordId&&this.start.paragraph){const e=this.start.paragraph.idLookUp[this.start.wordId];if(e){const t=e.getSpan(this.start.wordPos+1);return{paragraphClasses:e.paragraphClasses,spanClasses:t.spanClasses,spans:[t],paragraphs:[t.parentWord.parentParagraph]}}}return{paragraphClasses:new Set,spanClasses:new Set,spans:[],paragraphs:[]}}getLastWordOutsideLineBounds(){for(let e=this.parent.paragraphs.length-1;e>=0;e--){const t=this.parent.paragraphs[e];if(t.words.length)for(let e=t.words.length-1;e>=0;e--){const o=t.words[e];if(o instanceof Word)return o}}return null}getFirstWordOutsideLineBounds(){const e=this.parent.paragraphs[0];if(e.words.length)for(let t=0;t<e.words.length;t++){const o=e.words[t];if(o instanceof Word)return o}return null}getAllLinesInSelection(){const e=[];let t=this.start,o=this.end;if(this.toggleStartEnd()&&(o=this.start,t=this.end),!t)return e;o||(o=t);let i=!1;for(const r of this.parent.paragraphs)if(r.id===t.paragraphId||i){const s={paragraph:r,lines:[]};e.push(s);for(const n of r.lines)if(n===t.line&&(i=!0),i&&s.lines.push(n),n===o.line)return e}return e}getRange(){if(this.selectAll&&this.start&&this.end){const e=this.getFirstWordOutsideLineBounds(),t=this.getLastWordOutsideLineBounds();if(e&&t)return{start:{wordPos:0,wordId:e.id.split("-")[0],paragraphId:e.parentParagraph.id,joinWithPreviousUndo:!1},end:{wordPos:t.length,wordId:t.id.split("-")[0],paragraphId:t.parentParagraph.id,joinWithPreviousUndo:!1}}}if(!this.start)return null;if(!this.end){const e=this.start.lineWord,t=this.start.paragraph;if(!e||!t)throw"Get Range Line Word not found";const o=this.start.wordId,i=t.idLookUp[this.start.wordId].length,r=Math.min(i,Math.max(0,this.start.wordPos));return{start:{wordPos:r,wordId:o,paragraphId:this.start.paragraphId,joinWithPreviousUndo:!1},end:{wordPos:r,wordId:o,paragraphId:this.start.paragraphId,joinWithPreviousUndo:!1}}}let e=this.start,t=this.end;return this.toggleStartEnd()&&(e=this.end,t=this.start),{start:{wordPos:e.wordPos,wordId:e.wordId,paragraphId:e.paragraphId,joinWithPreviousUndo:!1},end:{wordPos:t.wordPos,wordId:t.wordId,paragraphId:t.paragraphId,joinWithPreviousUndo:!1}}}hasSelection(){return!!this.start}toggleStartEnd(){if(this.end&&this.start){if(!this.start.lineWord||!this.start.lineWord.parent)return!0;const e=this.start.line,t=this.end.line;if(e&&t){if(e.boxIndex===t.boxIndex)return e.top>t.top||e.top==t.top&&this.start.xPos>this.end.xPos;if(t.boxIndex<e.boxIndex)return!0}}return!1}drawRange(){if(!this.end||!this.start)return!1;this.svgs.endCursor||Selection.hideRect(this.svgs.startCursor);for(const e of this.svgs.boxesBetween.values())Selection.hideRect(e);let e=this.start,t=this.end;this.toggleStartEnd()&&(t=this.start,e=this.end);const o=e.xPos,i=e.yPos,r=e.height,s=e.line?e.line.boxIndex:0,n=t.line?t.line.boxIndex:0,a=this.parent.frames[s],l=this.parent.frames[n],c=a.boxOffset;if(this.createBetweenBoxes(c),t.yPos>e.yPos||n>s){const e=a.width-o+c;Selection.arrangeRect(a,this.svgs.boxTop,o,i,e,r);const d=this.parent.config.codeMode?20:c,h=t.yPos,p=t.xPos-(this.parent.config.codeMode?20:c),u=t.height;if(Selection.arrangeRect(l,this.svgs.boxBottom,d,h,p,u),s===n)if(Selection.hideRect(this.svgs.boxCenter2),i+r<h){const e=this.parent.config.codeMode?20:c,t=i+r,o=a.width,s=h-(i+r);Selection.arrangeRect(a,this.svgs.boxCenter1,e,t,o,s)}else Selection.hideRect(this.svgs.boxCenter1);else{const e=c;let t=i+r;const o=a.width;let d=a.height-t+c;d>0&&Selection.arrangeRect(a,this.svgs.boxCenter1,e,t,o,d),t=c,d=h-c,d>0&&Selection.arrangeRect(l,this.svgs.boxCenter2,e,t,l.width,d);for(let e=s+1;e<n;e++){const t=this.parent.frames[e],o=this.svgs.boxesBetween.get(e);o&&Selection.arrangeRect(t,o,0,0,t.width,t.height)}}return!0}if(r>0&&t.xPos-o>0){const e=t.xPos-o;return Selection.arrangeRect(a,this.svgs.boxTop,o,i,e,r),Selection.hideRect(this.svgs.boxCenter1),Selection.hideRect(this.svgs.boxCenter2),Selection.hideRect(this.svgs.boxBottom),!0}return this.hideRange(),!1}paste(e){let t=!1;this.hasRange&&(t=this.parent.deleteSelectedContent(!0),this.removeRange()),this.paragraph&&this.parent.render(this.paragraph.modifyWord(e,!1,t))}serialize(){const e=this.getRange();if(!e)return null;const t=e.start.wordId,o=e.start.wordPos,i=e.end.wordId,r=e.end.wordPos,s=this.parent.getParagraphByWordId(t),n=this.parent.getParagraphByWordId(i);if(!s||!n)return null;const a=[...s.words],l=[...n.words],c=this.parent.getParagraphIndex(s),d=this.parent.getParagraphIndex(n);let h;const p=s.getWordIndex(a,t),u=n.getWordIndex(l,i);let m,f;const g=[],y=[];for(let e=c;e<=d;e++){let t=!1,i=!1;const s=this.parent.paragraphs[e];if(h=e===c?a:e===d?l:[...s.words],e===c?(m=p,t=o>0):(m=0,t=!1),e===d){f=u;const e=h[u];i=!(e instanceof Word)||r!==e.length}else f=h.length-1,i=!1;if(0!==m||f!==h.length-1||t||i){const t=[];let i=0,n=0;for(let s=m;s<=f;s++){const a=h[s];if(a instanceof Word&&a.length>0){i=e===c&&s===m&&o>0?o:0,n=e===d&&s===f&&r>0?r:a.length;const l=a.getSpans(i,n);t.push(new Word(a.parentParagraph,newId("W"),l))}else t.push(a)}const a={w:t.map((e=>e.serialize()))};Object.keys(s.paragraphStyle.properties).length&&(a.p=s.paragraphStyle.serialize()),Object.keys(s.textStyle.properties).length&&(a.s=s.textStyle.serialize()),g.push(a),y.push(Paragraph.wordsToString(t))}else g.push(s.serialize()),y.push(s.toString())}return g.length?{paragraphs:g,text:y.join("\n\n")}:null}get eddiSenseDiv(){let e=document.getElementById("eddiSenseBox");return e||(e=document.createElement("div"),e.setAttribute("id","eddiSenseBox"),e.innerHTML='<div class="content"></div>',document.body.appendChild(e),e.addEventListener("mousedown",(e=>{if(e.preventDefault(),e.stopPropagation(),e.target){const t=e.target.closest(".line");if(t){const e=t.dataset.value;e&&(this.selectIntellisenseToken(e),this.applyIntellisenseToken())}}}))),e}get eddiSenseContentDiv(){return this.eddiSenseDiv.children.item(0)}showIntellisense(e,t=""){if(0===e.length)return;this.tokenFilter=t,this.intellisenseTokens=e,this.selectedTokenValue=this.intellisenseTokens[0].value,this.selectedTokenPostfix=this.intellisenseTokens[0].postfix||"";let o=this.start;if(!o)return;this.toggleStartEnd()&&this.end&&(o=this.end);const i=this.eddiSenseDiv;i.style.width="400px",i.style.height="300px";const r=o.getScreenPosition();let s=0,n=0;if(this.parent.config.codeMode&&this.parent.frames.length){const e=this.parent.frames[0].div;s=e?e.scrollTop:0,n=e?e.scrollLeft:0}i.style.left=r.x-n+"px",i.style.top=r.y-s+"px",this.populateIntellisense()}get intellisenseActive(){return!!document.getElementById("eddiSenseBox")}populateIntellisense(){const e=this.eddiSenseContentDiv,t=this.intellisenseTokens;let o="",i="",r="",s=!0;const n=this.tokenFilter.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),a=new RegExp(n,"i"),l=t.filter((e=>e.caption.match(a)));for(const e of l){let t="";if(e.caption===this.tokenFilter)this.selectedTokenValue=e.value,this.selectedTokenPostfix=e.postfix||"",t=e.caption;else{const o=e.caption.split(this.tokenFilter);for(let e=0;e<o.length;e++)e>0&&(t+=`<strong>${this.tokenFilter}</strong>`),t+=`<span>${o[e]}</span>`}e.badges&&(t+=e.badges.map((e=>"&nbsp;<i>"+e+"</i>&nbsp;")).join(""));const n=this.selectedTokenValue===e.value;n&&(i=e.value,r=e.postfix||""),o+=`<div  class="line ${n?"selected":""} ${s?"___first___":""}" data-value="${e.value.replace(/\n/g,"")}">\n                <div class="type" style="${e.color?"background-color:"+e.color+";":""}">${e.type}</div>\n                <div class="main" style="${e.style?e.style:""}">${t}</div>\n            </div>`,s=!1}if(0===l.length)return this.selectedTokenValue="",void this.hideIntellisense();i||(o=o.replace("___first___","selected"),i=l[0].value,r=l[0].postfix||""),this.selectedTokenValue=i,this.selectedTokenPostfix=r,e.innerHTML=o}selectIntellisenseToken(e){let t=this.eddiSenseContentDiv.querySelector(".selected");if(t&&t.classList.remove("selected"),this.selectedTokenValue=e,t=this.eddiSenseContentDiv.querySelector(`[data-value="${e.replace(/\n/g,"")}"]`),t){t.classList.add("selected");const e=t.offsetTop,o=t.offsetHeight;console_log("SelTop="+e+"  ParenthHeight="+this.eddiSenseDiv.offsetHeight+"  scrollTop="+this.eddiSenseDiv.scrollTop),e+o>this.eddiSenseDiv.offsetHeight+this.eddiSenseDiv.scrollTop?this.eddiSenseDiv.scrollTop=e+o-this.eddiSenseDiv.offsetHeight:e<this.eddiSenseDiv.scrollTop&&(this.eddiSenseDiv.scrollTop=e)}}selectNextIntellisenseToken(e){const t=this.eddiSenseContentDiv.querySelector(".selected");if(t){let o;if(o="next"===e?t.nextElementSibling:t.previousElementSibling,o){const e=o.dataset.value;e&&this.selectIntellisenseToken(e)}}}hideIntellisense(){const e=document.getElementById("eddiSenseBox");e&&document.body.removeChild(e)}applyIntellisenseToken(){if(this.start&&this.start.paragraph){const e=this.start.lineWord,t=this.start.line;if(e&&t){const o=Math.max(0,this.start.lineWordPos-this.tokenFilter.length);this.setRangeByLineWord(e,o,t.lastWord,t.lastWord.length,this.start.frameIndex,this.start.frameIndex),this.parent.deleteSelectedContent(),this.parent.render(this.start.paragraph.modifyWord(this.selectedTokenValue+this.selectedTokenPostfix,!1,!1)),this.hideIntellisense()}}}intellisenseKeyDown(e){if("ArrowDown"===e.key)return this.selectNextIntellisenseToken("next"),!0;if("ArrowUp"===e.key)return this.selectNextIntellisenseToken("previous"),!0;if(this.selectedTokenValue&&("Tab"===e.key||"Enter"===e.key))return this.applyIntellisenseToken(),!0;if("ArrowLeft"===e.key||"ArrowRight"===e.key||"Escape"===e.key)return this.hideIntellisense(),!0;if(this.parent.config.codeMode||this.intellisenseActive){if(this.hasRange||!this.start)return this.hideIntellisense(),!1;if(this.start.lineWord){const t=this.start.lineWord.getSpans(0,this.start.lineWordPos).map((e=>e.chars)).join("");this.tokenFilter=t,1===e.key.length&&(this.tokenFilter+=e.key)}if(!this.tokenFilter)return this.hideIntellisense(),!1}else Date.now()-this.tokenFilterStartTime>1500&&(this.tokenFilter="",this.tokenFilterStartTime=Date.now()),1===e.key.length?e.key.match(/\w/)&&(this.tokenFilter+=e.key):(this.tokenFilter="",this.tokenFilterStartTime=Date.now());return this.populateIntellisense(),!1}hideRange(){Selection.hideRect(this.svgs.boxTop),Selection.hideRect(this.svgs.boxCenter1),Selection.hideRect(this.svgs.boxCenter2),Selection.hideRect(this.svgs.boxBottom),Selection.hideRect(this.svgs.endCursor);for(const e of this.svgs.boxesBetween.values())Selection.hideRect(e);Selection.showRect(this.svgs.startCursor)}hideRangeAndStart(){this.hideRange(),Selection.hideRect(this.svgs.startCursor)}static arrangeRect(e,t,o,i,r,s){e.svg.appendChild(t),t.setAttributeNS(null,"height",s.toString()),t.setAttributeNS(null,"width",r.toString()),t.setAttributeNS(null,"y",i.toString()),t.setAttributeNS(null,"x",o.toString()),t.setAttributeNS(null,"visibility","visible")}static hideRect(e){e&&e.setAttributeNS(null,"visibility","hidden")}static showRect(e){e.setAttributeNS(null,"visibility","visible")}}class Line{constructor(e,t,o,i,r,s,n,a,l,c,d,h,p){let u,m;this.lastLineOfFrame=!1,this.previous=null,this.next=null,this.id=e,this.parent=t,this.lastLine=l,this.boxIndex=c,this._height=d||0,this.maxFontSize=h||0,this.firstLineOffset=0,this.subLineIndex=p,this.isFirstLine=s;let f=0,g=0;for(let e=0;e<o.length;e++){const i=o[e];i.justifyCharSpacing=0,i.justifyWordSpacing=0,i.parent=this,i.parentParagraph=t,e===o.length-1?(u=0,m=i.hyphenWidth):i.hasSpace?(u=i.spaceWidth,m=0,g++):(u=0,m=0),i.x=f+i.offsetToNextTabStop,f+=i.width+u+m+i.offsetToNextTabStop}if(!o.length)throw"Create Line with empty word list called";this.usedWidth=f,this.width=a,this.left=i,this.firstWordOffSet=0;const y=t.paragraphStyle.getParagraphStyleProperty(this.parent,"horizontalTextAlign");if("center"===y||l&&"justifyCenter"===y)this.firstWordOffSet=(a-this.usedWidth)/2;else if("right"===y||l&&"justifyRight"===y)this.firstWordOffSet=a-this.usedWidth;else if("justifyJustify"===y||!l&&("justifyLeft"===y||"justifyCenter"===y||"justifyRight"===y)){const e=a-f;if(g>0){const t=e/g;let i=0;for(let e=0;e<o.length;e++){const r=o[e];e>0&&(!r.subWordPos||r.subWordPos.isFirstPartOfBreak)&&(i+=t,o[e-1].justifyWordSpacing=t),r.x+=i}}else{const t=o.map((e=>e.length)).reduce(((e,t)=>e+t),0);if(t>1){const i=e/(t-1);let r=0;for(let e=0;e<o.length;e++){const t=o[e];t.justifyCharSpacing=i,t.x+=r,r+=i*t.length}}}}this.words=o,this.top=r,this.breaks=n;const b=this.parent.parentEddi.config;b.codeMode?(this.maxFontSize=b.codeModeFontSize,this._height=b.codeModeLineHeight,this._ascender=b.codeModeAscender,this._descender=b.codeModeDescender):(this.maxFontSize=o.map((e=>e.maxFontSize)).reduce(((e,t)=>Math.max(e,t)),0),0===this.maxFontSize&&(this.maxFontSize=this.parent.textStyle.getFontSize(this.parent)),this._height=o.map((e=>e.lineHeight)).reduce(((e,t)=>Math.max(e,t)),0),0===this._height&&(this._height=this.parent.textStyle.getLineHeight(this.parent)),this._ascender=o.map((e=>e.ascender)).reduce(((e,t)=>Math.max(e,t)),0),0===this._ascender&&(this._ascender=this.parent.textStyle.getAscender(this.parent)),this._descender=o.map((e=>e.descender)).reduce(((e,t)=>Math.max(e,t)),0),0===this._descender&&(this._descender=this.parent.textStyle.getDescender(this.parent)));const v=t.parentEddi.frames[c];if(this.isFirstLine&&v&&!v.useBaselineGrid&&"ascender"===v.firstBaseline&&(this.firstLineOffset=-this.height+this.ascender),v&&v.useBaselineGrid){const e=Math.ceil(this.maxFontSize/v.baselineHeight)*v.baselineHeight;console_log("Old Height: "+this._height+"  new Height="+e),this._height=e}if(setPreviousNextPointers(this.words),this.annotationLineLeftColor=null,this.parent.parentEddi.config.codeMode)for(const e of this.words)for(const t of e.spans)if(t.textStyle.temporaryProperties.annotationLineLeftColor&&(this.annotationLineLeftColor=t.textStyle.temporaryProperties.annotationLineLeftColor),t.textStyle.temporaryProperties.annotationColorBox){const e=scope().colors.getSwatchByName(t.textStyle.temporaryProperties.annotationColorBox);this.annotationColorBox=e?e.toRgbHexColor():t.textStyle.temporaryProperties.annotationColorBox}}get height(){let e=this._height,t=this;for(;t.previous&&t.subLineIndex>0&&t.previous.top===t.top;)t.previous._height>t._height&&(e=t.previous._height),t=t.previous;for(t=this;t.next&&t.next.subLineIndex>0&&t.next.top===t.top;)t.next._height>t._height&&(e=t.next._height),t=t.next;return e}get ascender(){let e=this._ascender,t=this;for(;t.previous&&t.subLineIndex>0&&t.previous.top===t.top;)t.previous._ascender>t._ascender&&(e=t.previous._ascender),t=t.previous;for(t=this;t.next&&t.next.subLineIndex>0&&t.next.top===t.top;)t.next._ascender>t._ascender&&(e=t.next._ascender),t=t.next;return e}get descender(){let e=this._descender,t=this;for(;t.previous&&t.subLineIndex>0&&t.previous.top===t.top;)t.previous._descender>t._descender&&(e=t.previous._descender),t=t.previous;for(t=this;t.next&&t.next.subLineIndex>0&&t.next.top===t.top;)t.next._descender>t._descender&&(e=t.next._descender),t=t.next;return e}get baseline(){return this.top+this.height+this.firstLineOffset}renderLineRect(){const e=document.createElementNS("http://www.w3.org/2000/svg","rect");return"lines"!==this.parent.fromCache?e.setAttributeNS(null,"stroke","gray"):e.setAttributeNS(null,"stroke","orange"),e.setAttributeNS(null,"height",this.height.toString()),e.setAttributeNS(null,"width",this.width.toString()),e.setAttributeNS(null,"fill","none"),e.setAttributeNS(null,"stroke-width","0.3px"),e.setAttributeNS(null,"x",(this.left+this.firstWordOffSet).toString()),e.setAttributeNS(null,"y","-"+this.height),e}renderLineData(e){const t=document.createElementNS("http://www.w3.org/2000/svg","g");t.classList.add("noselect"),t.setAttributeNS(null,"transform","translate(-111 0)");const o=document.createElementNS("http://www.w3.org/2000/svg","text");return o.setAttribute("fill","#000"),o.textContent="T="+Math.round(this.top)+" H="+Math.round(this.height)+" LFH="+Math.round(e.lastFlowHeight)+" FLO="+Math.round(this.firstLineOffset),o.style.fontSize="8px",o.setAttribute("y","0"),t.appendChild(o),t}renderAnnotations(e){let t=this.annotationLineLeftColor;if(!t&&this.previous&&this.previous.annotationLineLeftColor&&(t=this.previous.annotationLineLeftColor),t){const o=document.createElementNS("http://www.w3.org/2000/svg","rect");o.setAttributeNS(null,"fill",t),o.setAttributeNS(null,"height",this.height.toString()),o.setAttributeNS(null,"width","2px"),o.setAttributeNS(null,"stroke-width","0"),o.setAttributeNS(null,"x","-3px"),o.setAttributeNS(null,"y","-"+(this.height-5)),e.appendChild(o)}if(this.annotationColorBox){const t=document.createElementNS("http://www.w3.org/2000/svg","rect");t.setAttributeNS(null,"fill",this.annotationColorBox),t.setAttributeNS(null,"height","10px"),t.setAttributeNS(null,"width","10px"),t.setAttributeNS(null,"stroke-width","0"),t.setAttributeNS(null,"x","-15px"),t.setAttributeNS(null,"y","-"+(this.height-10)),e.appendChild(t)}}render(){const e=document.createElementNS("http://www.w3.org/2000/svg","g");e.classList.add("noselect"),e.setAttributeNS(null,"transform","translate("+(this.left+this.firstWordOffSet)+" "+this.baseline+")");const t=this.words[this.words.length-1];for(const o of this.words){if(e.appendChild(o.render(o===t&&"automatic"===this.breaks)),o.zigZagColor&&e.appendChild(o.renderZigZagLine(o.zigZagColor)),scope().templateProperties.showStyleBadges){const t=o.getClassBadge(this.height);t&&e.appendChild(t)}if(o.appliedTab&&o.appliedTab.hasLine){const t=this.parent.paragraphStyle.getParagraphStyleProperty(this.parent,"tabLineColor").color.toCssColor(100,100),i=this.parent.paragraphStyle.getParagraphStyleProperty(this.parent,"tabLineHeight").toPixel_1Axis(this.height),r=this.parent.paragraphStyle.getParagraphStyleProperty(this.parent,"tabLineType");e.appendChild(o.renderTabLine(t,i,r))}}return this.renderAnnotations(e),e}get firstWord(){return this.words[0]}get lastWord(){return this.words[this.words.length+-1]}get startTabCount(){return this.words.length>1&&0===this.words[0].length&&this.words[1].x>=17?Math.floor(this.words[1].x/17):0}get text(){let e="";for(const t of this.words)e+=t.toString(),t.hasSpace&&(e+=" ");return e}getWordAtXCoordinate(e){let t=0;const o=this.firstWord;let i=o.x-o.offsetToNextTabStop+this.left+this.firstWordOffSet,r=o;for(;e>i+r.offsetToNextTabStop;){const o=r.totalWidth+r.justifyWordSpacing+r.length*r.justifyCharSpacing;if(!(e>i+o+r.offsetToNextTabStop)){for(let o=0;o<r.length;o++){const s=r.charWidth[o];i+=s,t=o;const n=i-e+r.offsetToNextTabStop;if(n>=0){t=o+(n>s/2?0:1);break}o===r.length-1&&(t=o+1)}break}if(!(r.next instanceof Word)){t=r.length;break}t=0,i=i+o+r.offsetToNextTabStop,r=r.next}return{lineWordPos:t,lineWord:r}}debugString(){return this.words.map((e=>e.toDebugString()+"|"+e.spans.map((e=>e.textStyle.temporaryProperties.annotationRule||"")).join("|"))).reduce(((e,t)=>e+"\n   "+t),"")+"\n"}getWordById(e){for(const t of this.words)if(t.id===e)return t}get hasContent(){return 0===this.words.length||this.firstWord.isEmpty}}class Break{constructor(e){this.id=e}toDebugString(){let e="";return e=this.id+" BREAK",e}toString(){return"\n"}toAnnotationDebugString(){return"BREAK"}serialize(){return{k:"B"}}}class WordPointer{constructor(e,t,o){this.wordPos=o,this.pIndex=e,this.wIndex=t,this.handled=!1}}function extractTextFromWords(e,t,o,i){for(let r=0;r<t.length;r++){const s=t[r];if(s instanceof Word){let t=s.toString();s.hasSpace&&(t+=" "),o.push(t);for(let o=0;o<t.length;o++)i.push(new WordPointer(e,r,o))}else o.push("\n"),i.push(new WordPointer(e,r,0))}}function applyRegExStyleToWords(e,t){if(e.config.regexStyles){const o=[],i=[];for(const r of e.config.regexStyles){let e;for(;null!==(e=r.regex.exec(o.join("")));){e.index===r.regex.lastIndex&&r.regex.lastIndex++;const o=e.index,s=e[0],n=i[o],a=i[o+s.length];n&&a&&styleWords(t,0,n,a,void 0,r.style)}}}}function applyRegExLanguageToWords(e,t){const o=[],i=[],r=[],s=e.config.getLanguageModel();extractTextFromWords(0,t,o,i);for(const e of t)if(e instanceof Word)for(const t of e.spans)t.textStyle.temporaryProperties.annotationZigzag&&delete t.textStyle.temporaryProperties.annotationZigzag;const n=o.join("");if(_applyRegExLanguageToWords(e,t,0,n,i,s.rules,r),r.length){const o=r.sort(((e,t)=>t.start-e.start));for(const r of o)if(r.text=n.substr(r.start,r.end-r.start),styleWords(t,0,i[r.start],i[r.end],void 0,{fontColor:"#bbbbbb"}),"preview"===e.mode){const e=i[r.start].wIndex,o=t[e],s=i[r.start].wordPos,n=i[r.end].wIndex,a=t[n],l=i[r.end].wordPos;if(o instanceof Word&&a instanceof Word){const i=o.split(s),r=a.split(l);i.first&&r.second?t.splice(e,n+1-e,i.first.join(r.second)):i.first?t.splice(e,n+1-e,i.first):r.second?t.splice(e,n+1-e,r.second):t.splice(e,n+1-e)}}}return t}function setHandled(e,t,o){for(let i=t;i<t+o;i++)e[i].handled=!0}function isHandled(e,t,o){for(let i=t;i<t+o;i++)if(e[i].handled)return!0;return!1}function _applyRegExLanguageToWords(e,t,o,i,r,s,n,a=null,l=[]){let c=!1;for(const[d,h]of s)if("noMatch"===d){if(!1===c){const e=o,s=r[e],n=r[e+i.length];if(s&&n&&!isHandled(r,e,i.length)){styleWords(t,0,s,n,void 0,Object.assign({},h.style))}else console.warn("Endpos of no-match rule out of bounds. ["+i+"]")}}else{const s=getMatches(e,d,h,i);for(const p of s){c=!0;const s=p.pos+o,u=r[s],m=r[s+p.txt.length];let f=null;if(u&&m&&!isHandled(r,s,p.txt.length)){if(setHandled(r,s,p.txt.length),f=Object.assign({},h.style),"selector"===d&&p.txt){const e=p.txt.replace(/[.|{|\s]/gi,"").split(" "),t=scope().style_classNameColorLookUp(e[0]);t&&(f.fontColor=t,a=t)}h.inside&&(f.annotationNextRule=d),"selector"===d&&(f.annotationRule="root"),"color"===d&&p.txt&&(f.annotationColorBox=p.txt.trim()),a&&(f.annotationLineLeftColor=a),Object.keys(f).forEach((e=>{const t=f[e];"string"==typeof t&&t.indexOf("$")>=0&&(alert("no clue what should happen here"),f[e]=t)})),styleWords(t,0,u,m,void 0,f),h.remove&&addRemoval(h.remove,p.txt,n,s)}if(h.inside){const c=s+p.txt.length;let u=s+p.txt.length;if(h.close&&h.open){let e=1;for(;u-s<i.length;){const t=i.substr(u-o,1);if(t===h.open&&e++,t===h.close&&(e--,0===e))break;if("\n"===t&&!h.multiLine)break;u++}const n=i.substr(s-o,u-s);let a=r[u],l=r[u+1];if(a&&l&&((null==f?void 0:f.annotationNextRule)&&delete f.annotationNextRule,"selector"===d&&f&&(f.annotationNextRule="root"),styleWords(t,0,a,l,void 0,f||h.style)),f&&f.annotationLineLeftColor&&(f.annotationLineLeftColor=void 0),a=r[Math.max(0,c)],l=r[u],a&&l){styleWords(t,0,a,l,void 0,{annotationRule:d})}else console.warn("Endpos of inside rule out of bounds. ["+n+"]");f&&f.annotationLineLeftColor&&(f.annotationLineLeftColor=void 0)}const m=i.substr(c-o,u-c);_applyRegExLanguageToWords(e,t,c,m,r,h.inside,n,a,[...l,d]),setHandled(r,c,m.length)}}}}function getMatches(e,t,o,i){const r=[];let s;const n=new RegExp(o.pattern.source,"gm");if("font"===t&&e.config.styleFontExists&&e.config.styleFontExists(i.trim()))return[{pos:0,txt:i}];if("color"===t&&e.config.styleColorExists&&e.config.styleColorExists(i.trim()))return[{pos:0,txt:i}];if("image"===t&&e.config.styleImageExists&&e.config.styleImageExists(i.trim()))return[{pos:0,txt:i}];for(;null!==(s=n.exec(i));)s.index===n.lastIndex&&n.lastIndex++,r.push({pos:s.index,txt:s[0]});return r}function addRemoval(e,t,o,i){let r;const s=new RegExp(e.source,"g");for(;null!==(r=s.exec(t));){r.index===s.lastIndex&&s.lastIndex++;const e=r.index+i,n=r[0],a=r.index+i+n.length;o.push({start:e,end:a,text:t.substr(r.index,n.length)})}}function styleWords(e,t,o,i,r,s){let n=0,a=0;for(let l=o.wIndex;l<=i.wIndex;l++){const c=e[l];c instanceof Word&&(n=t===o.pIndex&&l===o.wIndex&&o.wordPos>0?o.wordPos:0,a=t===o.pIndex&&l===i.wIndex&&i.wordPos>0?i.wordPos:c.length,e[l]=c.setTextStyle(n,a,r,s))}}class Tab{constructor(e){this.id=e}toDebugString(){let e="";return e=this.id+" TAB",e}toString(){return"\t"}toAnnotationDebugString(){return"TAB"}serialize(){return{k:"T"}}}class Paragraph{constructor(e,t,o,i,r,s=!1){this.idLookUp={},this.previous=null,this.next=null,this.lastFlowTop=-1,this.lastFlowHeight=-1,this.lastFlowMaxWidth=-1,this.lastStartFrameIndex=-1,this.lastEndFrameIndex=-1,this.fromCache="nothing",this.parentEddi=t,this.id=e||newId("P"),this.x=0,this.textStyle=i,this.paragraphStyle=r;let n,a,l=this.readWords(o,void 0,s);l=this.insertAutoWords(l),this.lines=[],console_log("CREATING NEW PARAGRAPH - RESET LINES"),t.config.codeMode?applyRegExLanguageToWords(t,l):applyRegExStyleToWords(t,l),this.words=l,this.idLookUp={};for(const e of l)e instanceof Word&&(this.idLookUp[e.id]=e);for(let e=this.words.length-1;e>=0;e--){const t=this.words[e];if(t instanceof Word){a=t;break}}n=a?a.lastSpan.textStyle.getFontSize(a.lastSpan):this.textStyle.getFontSize(this);const c=this.paragraphStyle.getParagraphStyleProperty(this,"spaceAfterParagraph"),d=this.paragraphStyle.getParagraphStyleProperty(this,"spaceBeforeParagraph");this._spaceAfter=c.toPixel_1Axis(n),this._spaceBefore=d.toPixel_1Axis(n)}getSpaceAfter(e){return e?0:this._spaceAfter}getAllRuleNames(e){return["------------------",...e.map((e=>e.toAnnotationDebugString())),"-----------------"].join("\n")}insertAutoWords(e){var t,o;let i=null,r=!0,s=!0;const n=[];if(e.length){for(const o of e)o instanceof Word&&(i=o),s=!(o instanceof Word),s&&r&&n.push(new Word(this,newId("W"),"",void 0,null!==(t=null==i?void 0:i.lastSpan.textStyle)&&void 0!==t?t:void 0)),n.push(o),r=!(o instanceof Word);r&&n.push(new Word(this,newId("W"),"",void 0,null!==(o=null==i?void 0:i.lastSpan.textStyle)&&void 0!==o?o:void 0))}else n.push(new Word(this,newId("W"),""));return n}getLineHeightSum(){var e;let t=0,o=0;for(const i of this.lines)(null===(e=i.next)||void 0===e?void 0:e.subLineIndex)?o=Math.max(o,i.height+i.firstLineOffset):(t+=Math.max(o,i.height+i.firstLineOffset),o=0);return t}breakAllWords(e){const t=[];for(const o of e)if(o instanceof Word){const e=o.break();for(const o of e)t.push(o)}else t.push(o);return t}readWords(e,t,o=!1){const i=[];if(Array.isArray(e))for(const t of e)if(t instanceof Word)if(o)i.push(new Word(this,t.id,t.spans,t.subWordPos));else{t.parentParagraph=this;for(const e of t.spans)e.textStyle.temporaryProperties={};i.push(t)}else i.push(t);else if("string"==typeof e){const o=e.split(/\n/);for(let e=0;e<o.length;e++){const r=o[e];if(r){const e=r.split("\t");for(const o of e){const r=o.split(" ");for(const e of r)i.push(new Word(this,newId("W"),e,void 0,t));o!==e[e.length-1]&&i.push(new Tab(newId("T")))}}e!==o.length-1&&i.push(new Break(newId("B")))}}else if("object"==typeof e){const t=e;for(const e of t.w)"string"==typeof e?i.push(new Word(this,newId("W"),e)):"B"===e.k?i.push(new Break(newId("B"))):"T"===e.k?i.push(new Tab(newId("T"))):!0===e.e&&e.s?i.push(...this.readWords(e.s[0].t,TextStyle.deserialize(e.s[0].s))):i.push(Word.Deserialize(e,this))}return i}static consilidateStyles(e){return Paragraph.consolidateConsistenTextStyles(Paragraph.consolidateEquivalentTextStyles(e))}static consolidateEquivalentTextStyles(e){if(!e.s)return e;const t=Array.from(Object.keys(e.s));if(!t.length)return e;const o=new Map;for(const i of t)o.set(i,JSON.stringify(e.s[i]));for(const i of e.w)if("object"==typeof i&&"W"===i.k)for(const e of i.s||[])if(e.s)for(const i of t)o.get(i)===JSON.stringify(e.s[i])&&delete e.s[i];return e}static consolidateConsistenTextStyles(e){var t,o;let i,r=!0;for(const s of e.w){if("string"==typeof s||!0===s.e)return e;if("W"===s.k)if(r&&1===(null===(t=s.s)||void 0===t?void 0:t.length)){r=!1;const e=s.s[0];i=JSON.parse(JSON.stringify(e.s)),i&&(delete i.c,0===Object.keys(i).length&&(i=void 0))}else if(null===(o=s.s)||void 0===o?void 0:o.length){if(!i)return e;for(const t of s.s){if(!t.s)return e;const o=Array.from(Object.keys(t.s));for(const e of o)"c"!==e&&(void 0!==t.s[e]&&JSON.stringify(t.s[e])===JSON.stringify(i[e])||delete i[e]);const r=Array.from(Object.keys(i));for(const e of r)-1===o.indexOf(e)&&delete i[e]}}}if(!i)return e;const s=Array.from(Object.keys(i));for(const t of s)"c"!==t&&void 0!==i[t]&&(e.s=e.s||{},e.s[t]=i[t]);return Paragraph.resetTextStyleInAllSpans(e,s,!0),e}static resetTextStyleInAllSpans(e,t,o=!1){for(const i of e.w)if("object"==typeof i&&"W"===i.k)for(const e of i.s||[])if(e.s)for(const i of t)o&&"c"===i||delete e.s[i]}getLine(e,t,o,i,r,s,n,a){const l=[],c=newId("L");let d,h=e,p=n,u=[],m=0,f=!1,g=0,y="",b=0;for(;h<this.words.length||p.length;)if(d=p.length?p[0]:this.words[h],y||(y=d.id),f=h>=this.words.length-1,d instanceof Tab)b++,h++;else{if(d instanceof Break){if(h++,l.length){const e=new Line(d.id,this,l,o,i,r,"manual",t,f,s,void 0,void 0,a);return{text:e.text,line:e,nextWordIndex:h,remainingSubWords:[],createdWords:u}}return{text:"",line:null,nextWordIndex:h,remainingSubWords:[],createdWords:u}}if(d instanceof Word){if(g+d.width+d.hyphenWidth>t)if(f=!1,2===this.parentEddi.frames.length&&"width"===this.parentEddi.frames[0].autoFrameSizeSettings.autoTextMode)this.parentEddi.hasOverflow=!0;else if(!this.parentEddi.config.codeMode){if(d.length>=2&&0===g&&0===d.hyphenationPoints.length&&t>this.parentEddi.config.wordBreakThreshold*this.parentEddi.frames[s].width){const e=d.addForcedBreakAndGetSplitPos(t);let n=0,l=!0;d.subWordPos&&(n=d.subWordPos.startOffSet,l=d.subWordPos.isFirstPartOfBreak);const m=d.id.split("-")[0],g=d.getSpans(0,e),y=d.getSpans(e,d.length);let b=0;if(d.subWordPos){b=parseInt(d.id.split("-")[1]);for(let e=1;e<p.length;e++){const t=p[e],o=parseInt(t.id.split("-")[1]);p[e]=new Word(this,m+"-"+(o+1),t.spans,t.subWordPos),u.push(p[e])}}const v=b+1,x=new Word(this,m+"-"+b,g,{startOffSet:n,isFirstPartOfBreak:l,isLastPartOfBreak:!1,needsHyphen:!1,isForced:!0});u.push(x);const w=new Word(this,m+"-"+v,y,{startOffSet:n+x.length,isFirstPartOfBreak:!1,isLastPartOfBreak:p.length<=1,needsHyphen:!1,isForced:!0});u.push(w);const _=[w,...p.slice(1)];console_log("Forced Break Remaining Words:",_),d.subWordPos||h++;const S=new Line(c,this,[x],o,i,r,"automatic",t,f,s,void 0,void 0,a);return console_log("GetLine LastChanceBreak Text="+S.text,[w,...p]),{text:S.text,line:S,nextWordIndex:h,remainingSubWords:_,createdWords:u}}if(!p.length&&d.hyphenationPoints.length){p=d.break(),m=p.length,h++;for(const e of p)u.push(e);continue}if(p.length&&p.length===m&&(p=[],u=u.filter((e=>!p.indexOf(e))),h--),l.length){const e=new Line(c,this,l,o,i,r,"automatic",t,f,s,void 0,void 0,a);return{text:e.text,line:e,nextWordIndex:h,remainingSubWords:p,createdWords:u}}return{text:"",line:null,nextWordIndex:h,remainingSubWords:p,createdWords:u}}if(d.offsetToNextTabStop=0,b>0&&0===p.length){const e=this.paragraphStyle.getParagraphStyleProperty(this,"tabs"),o=ParagraphStyle.getTabStops(e);if(o){let e=null;const t=this.parentEddi.frames[s].width;for(const i of o)if(i.pos.toPixel_1Axis(t)>g){e=i;break}if(e){let o=0;const i=e.pos.toPixel_1Axis(t);switch(e.align){case"left":o=i-g;break;case"center":o=i-g-d.width/2;break;case"right":o=i-g-d.width;break;case"char":const t=d.toString().indexOf(e.alignChar);if(t>0){const e=d.charWidth;let r=0;for(let o=0;o<t;o++)r+=e[o];o=i-g-r}else o=i-g}d.appliedTab=e,o<0&&(o=0),d.offsetToNextTabStop=o}}else{const e=this.parentEddi.config.codeMode;let o=this.parentEddi.config.tabStop;e||(o=this.paragraphStyle.getParagraphStyleProperty(this,"tabSize").toPixel_1Axis(d.maxFontSize));let i=o-g%o;if(e||g+i+d.totalWidth<t){for(let r=1;r<b;r++)(e||g+i+d.totalWidth+o<t)&&(i+=o);d.offsetToNextTabStop=i}}}b=0;const e=d.id;if(l.filter((t=>t.id===e)).length>0)throw"Attempt to re-insert word to line.";l.push(d),g+=d.totalWidth+d.offsetToNextTabStop,this.lastFlowMaxWidth<g&&(this.parentEddi.config.codeMode?this.lastFlowMaxWidth=g+20:this.lastFlowMaxWidth=g-d.spaceWidth),p.length?p.splice(0,1):h++}}const v=new Line(c,this,[...p,...l],o,i,r,"manual",t,f,s,void 0,void 0,a);return{text:v.text,line:v,nextWordIndex:h,remainingSubWords:[],createdWords:null}}getWordFromLine(e){for(const t of this.lines){if(t.id===e)return t.lastWord;const o=t.getWordById(e);if(o)return o}}clone(e,t=newId("P"),o){let i=this.textStyle;if(o){const e=Object.assign(Object.assign({},i.properties),o.properties);i=new TextStyle(e)}return new Paragraph(t,this.parentEddi,e,i,this.paragraphStyle)}get hasContent(){return null!==this.firstLine}removeWords(e,t,o,i,r){var s,n;const a=this.parentEddi.selection.getTextInfo();let l=this.parentEddi.selection.getStartSelection();if(!l)return null;let c=[...this.words],d=[...this.parentEddi.paragraphs];if(o&&e!==o){const e=this.parentEddi.getParagraphByWordId(o);if(e&&e!==this){const t=this.parentEddi.getParagraphIndex(this),o=this.parentEddi.getParagraphIndex(e);o>t&&(c=[...c,...Eddi.applyParagraphTextStyleToWordStyle(e,e.words)]),d.splice(t+1,o-t)}}if(c.length>0){let a,h,p=-1,u=-1,m=null,f=0;for(let t=0;t<c.length;t++)c[t].id===e&&(p=t),c[t].id===o&&(u=t);const g=c[p];if(!(g instanceof Word))throw"Can't remove selection. FromWord is incorrect type.";a=g;let y=c[u];if(!(y instanceof Word))throw o=e,y=g,u=p,"Can't remove selection. ToWord is incorrect type.";if(h=y,e===o){const e=c[u+1],o=c[u+2],s=c[p-1],n=c[p-2];if("Delete"===r)if(t<a.length){const e=a.removeChars(t,t===i?t+1:i);e.first&&c.splice(p,1,e.first),e.sel&&(l=e.sel)}else if(e instanceof Break)o instanceof Word&&o.isEmpty?c.splice(p+1,2):c.splice(p+1,1);else if(e instanceof Tab)c.splice(p+1,1);else if(e instanceof Word)l.wordPos=i,l.wordId=h.id,c.splice(p,2,a.join(e));else if(this.next)if(this.hasContent){const e=Eddi.addWords(this.next,this,c,!0);d=d.map((t=>t.id===e.id?e:t)),c=[],l.wordPos=t,l.wordId=a.id}else c=[],l.wordPos=0,l.wordId="FIRSTOF:"+this.next.id;else l.wordPos=0,l.wordId="LAST";else if("Backspace"===r)if(t>0||t!==i){const e=a.removeChars(t===i?t-1:t,i);e.first&&c.splice(p,1,e.first),e.sel&&(l=e.sel)}else if(s instanceof Break||s instanceof Tab)n instanceof Word&&n.isEmpty?c.splice(p-2,2):c.splice(p-1,1);else if(s instanceof Word)l.wordPos=s.length,l.wordId=s.id,c.splice(p-1,2,s.join(a)),l.wordPos=s.length;else if(this.previous)if(this.hasContent){const e=Eddi.addWords(this.previous,this,c,!1);d=d.map((t=>t.id===e.id?e:t)),c=[],l.wordPos=0,l.wordId=a.id}else d=d.filter((e=>e.id!==this.id)),c=[],this.previous.lastFlowTop=-1,l.wordPos=0,l.wordId="LASTOF:"+this.previous.id;else l.wordPos=0,l.wordId="FIRST";else{const e=a.removeChars(t,i);e.first&&c.splice(p,1,e.first),e.sel&&(l=e.sel)}}else{const e=a.split(t),o=h.split(i);e.first&&o.second?c.splice(p,u+1-p,e.first.join(o.second)):e.first?c.splice(p,u+1-p,e.first):o.second?c.splice(p,u+1-p,o.second):c.splice(p,u+1-p);const r=new Set;for(const e of c)r.has(e.id),r.add(e.id);if(e.first&&e.sel)l=e.sel;else{if(a.previousWord)if(0===p||c[p-1]instanceof Break||c)if(c.length>p)m=c[p],f=0;else{const t=null!==(n=null===(s=e.second)||void 0===s?void 0:s.spans[0].textStyle)&&void 0!==n?n:void 0,o=new Word(this,newId("W"),[],void 0,t);c.push(o),m=o,f=-1}else m=a.previousWord,f=-1;else if(c.length){f=0;for(const e of c)if(e instanceof Word){m=e;break}}else this.previous&&this.previous.lastLine&&(m=this.previous.lastLine.lastWord,f=-1);m?(l.wordId=m.id,l.wordPos=m instanceof Word&&-1===f?m.length:0):(l.wordId="FIRST",l.wordPos=0)}}if(c.length){const e=new Paragraph(this.id,this.parentEddi,c,this.textStyle,this.paragraphStyle,!0);d=d.map((t=>t.id===this.id?e:t))}else d=d.filter((e=>e.id!==this.id));this.parentEddi.setParagraphs(d),l.joinWithPreviousUndo=!0}return{selection:l,info:a}}modifyWord(e="",t,o,i){const r=this.parentEddi.selection.getStartSelection();if(!r)return null;if(!e)return r;const s=[...this.words];let n=[...this.parentEddi.paragraphs];const a=this.parentEddi.getParagraphByWordId(r.wordId);if(!a)return console.error("Selection Paragraph not found"),r;let l,c=null,d=0;const h=r.wordPos;for(let e=0;e<s.length;e++)if(s[e].id===r.wordId){c=s[e],d=e;break}if(c instanceof Word){let p,u,m=0;if(this.parentEddi.config.codeMode&&"ShiftEnter"===e&&(m=this.parentEddi.selection.lineStartTabCount),l=c.split(h,i,!t&&" "!==e),"Enter"===e){let e;p=s.splice(d+1,s.length),s.pop(),l.first&&s.push(l.first),l.second?p.unshift(l.second):l.first&&(e=l.first.lastSpan.textStyle);const t=a.clone(p,void 0,e),o=this.parentEddi.getParagraphIndex(a);n.splice(o+1,0,t),r.wordId="FIRSTOF:"+t.id,r.wordPos=0}else if("ShiftEnter"===e){const e=[new Break(newId("B"))];for(let t=0;t<m;t++)e.push(new Tab(newId("T")));if(l.first&&l.second)s.splice(d,1,l.first,...e,l.second),r.wordId=l.second.id,r.wordPos=0;else if(l.first)s.splice(d,1,l.first,...e),c.next?(r.wordId=c.next.id,r.wordPos=0):(r.wordId="NEXT:"+l.first.id,r.wordPos=l.first.length);else{if(!l.second)throw alert("Can't insert shiftEnter: no word split created"),"Can't insert shiftEnter: no word split created";s.splice(d,1,...e,l.second),r.wordId=l.second.id,r.wordPos=0}}else if(" "===e){const e=l.first,t=l.second;if(e&&t)s.splice(d,1,e,t),r.wordId=t.id,r.wordPos=0;else if(t){r.wordId=t.id,r.wordPos=0;const e=new Word(this,newId("W"),"",void 0,TextStyle.deserialize(t.lastSpan.textStyle.serialize()));s.splice(d,1,e,t)}else if(e){const t=new Word(this,newId("W"),"",void 0,TextStyle.deserialize(e.lastSpan.textStyle.serialize()));r.wordId=t.id,r.wordPos=0,s.splice(d,1,e,t)}}else if("Tab"===e){const e=l.first,t=l.second,o=new Tab(newId("T"));if(e&&t)s.splice(d,1,e,o,t),r.wordId=t.id,r.wordPos=0;else if(e){const t=new Word(this,newId("W"),"");s.splice(d,1,e,o,t),r.wordId=t.id,r.wordPos=0}else t&&(s.splice(d,1,o,t),r.wordId=t.id,r.wordPos=0)}else if(e.indexOf(" ")>=0||e.indexOf("\n")>=0){const t=e.split(/\n *\n/gm);let o;this.parentEddi.textInfoBeforeDelete?o=new TextStyle(Selection.getUsedTextStyle(this.parentEddi.textInfoBeforeDelete)):l.first?o=new TextStyle(l.first.lastTextStyle.properties):l.second&&(o=new TextStyle(l.second.lastTextStyle.properties));const i=this.readWords(t[0],o);if(i.length){l.first&&i[0]instanceof Word&&(i[0]=l.first.join(i[0]));const e=i.length-1,t=i[e];l.second&&e>=1&&t instanceof Word&&(i[e]=t.join(l.second)),s.splice(d,1,...i)}if(t.length>1){t.shift();const e=this.parentEddi.getParagraphIndex(a),o=[];for(const e of t)o.push(new Paragraph(newId("P"),this.parentEddi,e,new TextStyle,new ParagraphStyle));n.splice(e+1,0,...o)}}else{let t=0;if(l.first instanceof Word?(s[d]=c.insertChars(h,e),t=h,r.wordPos+=e.length):l.second instanceof Word&&(s[d]=l.second.insertChars(0,e),r.wordPos+=e.length),1!==s.length&&this.parentEddi.textInfoBeforeDelete){const o=s[d];o instanceof Word&&s.length>1&&(s[d]=o.setTextStyle(t,t+e.length,Selection.getUsedTextStyle(this.parentEddi.textInfoBeforeDelete)))}}if(1==s.length&&this.parentEddi.textInfoBeforeDelete){const t=s[0];if(t instanceof Word&&t.toString()!==e)u=new Paragraph(this.id,this.parentEddi,s,this.textStyle,this.paragraphStyle);else{let o=this.paragraphStyle;1===s.length&&t.toString()===e&&(o=new ParagraphStyle(Selection.getUsedParagraphStyle(this.parentEddi.textInfoBeforeDelete))),u=new Paragraph(this.id,this.parentEddi,s,new TextStyle(Selection.getUsedTextStyle(this.parentEddi.textInfoBeforeDelete)),o,!0)}}else u=new Paragraph(this.id,this.parentEddi,s,this.textStyle,this.paragraphStyle);this.parentEddi.textInfoBeforeDelete=null,n=n.map((e=>e.id===u.id?u:e)),this.parentEddi.setParagraphs(n,o)}return r}replaceChars(e,t,o,i,r){const s=this.parentEddi.selection.getStartSelection();if(!s)return null;if(!e)return null;const n=[...this.words];let a=[...this.parentEddi.paragraphs];if(!this.parentEddi.getParagraphByWordId(t))return console.error("Selection Paragraph not found"),s;let l,c=null,d=0;for(let e=0;e<n.length;e++)if(n[e].id===t){c=n[e],d=e;break}if(c instanceof Word&&(l=c.removeChars(o,i,e,r),l.first)){n[d]=l.first,s.wordPos=o+e.length;const t=new Paragraph(this.id,this.parentEddi,n,this.textStyle,this.paragraphStyle);a=a.map((e=>e.id===t.id?t:e)),this.parentEddi.setParagraphs(a,!1)}return s}render(){let e,t=this.getBullet(),o=-1;const i=scope().templateProperties.showStyleBadges;for(const i of this.lines){if(i.boxIndex!==o){const r=this.parentEddi.frames[o];e&&r.paragraphsGroup&&(t&&(t.setAttributeNS(null,"transform","translate(0 "+this.lines[0].baseline+")"),e.appendChild(t),t=void 0),r.paragraphsGroup.appendChild(e)),e=document.createElementNS("http://www.w3.org/2000/svg","g"),e.setAttributeNS(null,"style",this.paragraphStyle.css()+TextStyle.baseCss(TextStyle.getFrameWidth(this),this.parentEddi)),e.setAttributeNS(null,"name",this.id),o=i.boxIndex}e&&e.appendChild(i.render())}if(e){if(t){const o=this.lines[0];t.setAttributeNS(null,"transform","translate(0 "+o.baseline+")"),e.prepend(t)}i&&this.textStyle.properties.class&&e.appendChild(this.getClassBadge(this.lines[0].baseline));const r=this.parentEddi.frames[o];r.paragraphsGroup&&r.paragraphsGroup.appendChild(e)}}getClassBadge(e){let t=(this.textStyle.properties.class||"").split(" ")[0],o="red";for(const e of scope().styles_all){const i=e.classNameColorLookUp.get(t);i&&(o=i)}t=t.substr(0,10);const i=document.createElementNS("http://www.w3.org/2000/svg","g"),r=document.createElementNS("http://www.w3.org/2000/svg","rect");r.setAttributeNS(null,"x","0"),r.setAttributeNS(null,"y","0"),r.setAttributeNS(null,"width","35"),r.setAttributeNS(null,"height","15"),r.setAttributeNS(null,"fill",o),i.appendChild(r);const s=7*t.length+4,n=document.createElementNS("http://www.w3.org/2000/svg","text");return n.setAttributeNS(null,"style","fill: white; font-size: 11px; font-family: monospace"),n.setAttributeNS(null,"x","3"),n.setAttributeNS(null,"y","12"),r.setAttributeNS(null,"width",s.toString()),r.setAttributeNS(null,"height","15"),n.innerHTML=t,i.appendChild(n),i.setAttributeNS(null,"transform","translate(-"+(s+2)+"  "+(e-14)+")"),i}getBullet(){if(0===this.lines.length||"bullet"!==this.paragraphStyle.getParagraphStyleProperty(this,"horizontalTextAlign"))return;const e=this.lines[0],t=e.boxIndex,o=this.paragraphStyle.getBulletSize(this),i=this.paragraphStyle.getBulletShift(this),r=this.paragraphStyle.getParagraphStyleProperty(this,"bulletShape"),s=this.paragraphStyle.getParagraphStyleProperty(this,"bulletColor").toCssColor(),n=-o+i*e.ascender/2;let a,l;if("Custom"===r){const e=this.parentEddi.frames[t];if(e&&e.getWcBox&&e.boxId){const t=e.getWcBox(e.boxId);t&&t.box.pathGeometry&&(a=t.box.pathGeometry.toBullet(n,o,s))}}if(!a){if(l="Custom"===r?PathGeometry.getShapeGeneratorFunction("Circle"):PathGeometry.getShapeGeneratorFunction(r),!l)throw alert("No Shape Generator Function for Bullets found."),new Error("No Shape Generator Function for Bullets found.");a=l().toBullet(n,o,s)}return a}get lastLine(){return this.lines.length?this.lines[this.lines.length-1]:null}get firstSpan(){for(const e of this.words)if(e instanceof Word&&e.spans.length)return e.spans[0]}get firstLine(){return this.lines[0]}debugStringWord(e=""){return this.id+":"+e+"-------------------------------------WORDS---\n"+this.words.map((e=>e.toDebugString())).reduce(((e,t)=>e+"\n"+t),"")}debugStringLines(e=""){let t=this.id+":"+e+"-------------------------------------LINES---\n";for(const e of this.lines)t+="\n"+e.id+" "+e.breaks,t+=e.debugString();return t}debugStringFirstLine(){const e=this.lines[0];if(e){return e.debugString()}return"first line is null"}getLineWordAtPosition(e,t){for(const o of this.lines)if(t>=o.top&&t<=o.top+o.height)return o.getWordAtXCoordinate(e);return this.lastLine?this.lastLine.getWordAtXCoordinate(e):null}getWordIndex(e,t){let o=0;for(const i of e){if(i.id===t)return o;o++}return-1}setParagraphStyle(e){const t=this.paragraphStyle.properties,o=new ParagraphStyle(Object.assign(Object.assign({},t),e));return new Paragraph(this.id,this.parentEddi,this.words,this.textStyle,o)}setTextStyle(e,t=!0){let o;if(t){const t=this.textStyle.properties;o=new TextStyle(Object.assign(Object.assign({},t),e))}else o=new TextStyle(Object.assign({},e));const i=new Paragraph(this.id,this.parentEddi,this.words,o,this.paragraphStyle),r=i.words.map((o=>o instanceof Word?o.removeTextStyleProperties(e,!t):o));return new Paragraph(i.id,i.parentEddi,r,i.textStyle,i.paragraphStyle)}serialize(){const e=[];let t=0;for(;t<this.words.length;){const o=this.words[t];if(o instanceof Word){let i=o.toString(),r=0,s=i.indexOf("${");if(i.indexOf("${")>=0){let n=t;for(let e=t;e<this.words.length;e++){i=this.words[e].toString();for(let t=s;t<i.length;t++)if("{"===i.charAt(t))r++;else if("}"===i.charAt(t)&&(r--,0===r)){n=e;break}s=0}const a=[];for(let e=t;e<=n;e++)a.push(this.words[e].toString());for(let e=0;e<a.length;e++){const t=a[e];"\n"!==t&&"\t"!==t&&e<a.length-1&&"\n"!==a[e+1]&&"\t"!==a[e+1]&&(a[e]=a[e]+" ")}e.push({k:"W",e:!0,s:[{t:a.join(""),s:o.spans[0].textStyle.serialize()}]}),t=n+1}else e.push(o.serialize()),t++}else e.push(o.serialize()),t++}const o={w:e};return Object.keys(this.paragraphStyle.properties).length&&(o.p=this.paragraphStyle.serialize()),Object.keys(this.textStyle.properties).length&&(o.s=this.textStyle.serialize()),o}toString(){return Paragraph.wordsToString(this.words)}static wordsToString(e){return e.map((t=>t instanceof Word&&t!==e[e.length-1]?t.toString()+" ":t.toString())).join("")}static Deserialize(e,t){const o=TextStyle.deserialize(e.s),i=ParagraphStyle.deserialize(e.p);return new Paragraph(newId("P"),t,e,o,i,void 0)}}const clipperScale=1e6;class Frame{constructor(e,t,o,i,r,s,n){if(this.codeModeWidth=0,this.boxOffset=s?0:111,this.index=t,this.codeMode=s,this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svg.setAttributeNS(null,"class","eddi-svg-frame"),s||(this.svg.style.pointerEvents="none"),this.svg.setAttributeNS(null,"data-index",this.index+""),this.div=null,this.boxId=null,this.classes=null,this.paragraphsGroup=null,this.getWcBox=null,this.name="none",this.spreadLeft=0,this.spreadTop=0,this.wrapShapeOffset=0,this.wrapAscenderDiminisher=0,this.rotation=0,this.paddingLeft=0,this.paddingRight=0,this.paddingTop=0,this.paddingBottom=0,this.verticalAlign="top",this.useBaselineGrid=!1,this.firstBaseline="ascender",this.baselineTop=0,this.baselineHeight=30,this.autoFrameSizeSettings=r||{autoTextMode:"off",maxHeight:500,minHeight:50,maxWidth:500,minWidth:200},"number"==typeof e)this._width=e,this.height=1500,this.left=0,this.top=0;else if(e instanceof HTMLDivElement){if(this.left=getElementOffset(e,"offsetLeft"),this.top=getElementOffset(e,"offsetTop"),this._width=e.offsetWidth,this.height=e.offsetHeight,n&&0===this.height&&(this.left=getElementOffset(n,"offsetLeft"),this.top=getElementOffset(n,"offsetTop"),this._width=n.offsetWidth,this.height=n.offsetHeight),this.div=n||e,this.div.style.cursor="text",s){this.div.style.overflow="auto";let e=document.createElementNS("http://www.w3.org/2000/svg","rect");e.setAttributeNS(null,"height","100%"),e.setAttributeNS(null,"width","18px"),e.setAttributeNS(null,"fill","#eeeeee"),e.setAttributeNS(null,"x","0px"),e.setAttributeNS(null,"y","0px"),this.svg.appendChild(e),e=document.createElementNS("http://www.w3.org/2000/svg","rect"),e.setAttributeNS(null,"height","100%"),e.setAttributeNS(null,"width","1px"),e.setAttributeNS(null,"fill","#cccccc"),e.setAttributeNS(null,"x","17px"),e.setAttributeNS(null,"y","0px"),e.setAttributeNS(null,"stroke","#cccccc"),this.svg.appendChild(e)}this.div.innerHTML="",this.div.appendChild(this.svg),this.paragraphsGroup=document.createElementNS("http://www.w3.org/2000/svg","g"),this.paragraphsGroup.setAttributeNS(null,"transform","translate("+this.boxOffset+" "+this.boxOffset+")"),this.svg.appendChild(this.paragraphsGroup)}else{const t=e;this.svg.setAttributeNS("http://www.w3.org/2000/svg","width",(t.width+222).toString()),this.svg.setAttributeNS("http://www.w3.org/2000/svg","height",(t.height+222).toString()),this.svg.style.position="absolute",this.svg.style.left="-111px",this.svg.style.top="-111px",this.svg.style.width=`${t.width+222}px`,this.svg.style.height=`${t.height+222}px`,this.left=t.left,this.top=t.top,this._width=t.width,this.height=t.height,this.spreadLeft=t.spreadLeft,this.spreadTop=t.spreadTop,this.paddingLeft=t.paddingLeft,this.paddingTop=t.paddingTop,this.paddingRight=t.paddingRight,this.paddingBottom=t.paddingBottom,this.verticalAlign=t.verticalAlign,this.rotation=t.rotation,this.wrapShapeOffset=t.wrapShapeOffset,this.wrapAscenderDiminisher=t.wrapAscenderDiminisher,this.boxId=t.boxId,this.getWcBox=t.getWcBox,this.name=t.name,this.classes=t.classes,this.useBaselineGrid=t.useBaseLineGrid,this.firstBaseline=t.firstBaseline,this.baselineTop=t.baselineTop,this.baselineHeight=t.baselineHeight,this.paragraphsGroup=document.createElementNS("http://www.w3.org/2000/svg","g"),this.paragraphsGroup.setAttributeNS(null,"transform","translate("+this.boxOffset+" "+this.boxOffset+")"),this.svg.appendChild(this.paragraphsGroup)}o&&o.length>=3?(o[0].x===o[o.length-1].x&&o[0].y===o[o.length-1].y||o.push({x:o[0].x,y:o[0].y}),this.boxPath=o):this.boxPath=null;let a=this.getScaledBoxPath();if((this.rotation||"top"!==this.verticalAlign)&&(i=null),"width"===this.autoFrameSizeSettings.autoTextMode&&(i=null,a=null),i||this.wrapShapeOffset?(this.paths=this.clipPath(i,a),this.wrapPaths=i):(this.paths=a?[a.map((e=>({x:e.x-this.left,y:e.y-this.top})))]:null,this.wrapPaths=null),this.paths)for(const e of this.paths)!e||e[0].x===e[e.length-1].x&&e[0].y===e[e.length-1].y||e.push({x:e[0].x,y:e[0].y})}setCodeModeDimensions(e,t){this.svg.style.height=Math.max(this.height,e+20)+"px",this.codeModeWidth=t,this.svg.style.minWidth=Math.max(this.width,t)+"px"}getScaledBoxPath(){return this.boxPath?this.boxPath.map((e=>({x:this.left+e.x*this.width,y:this.top+e.y*this.height}))):null}offSetPathPointsOnSpread(e,t,o){if(t<=0)return e;const i=new ClipperLib.ClipperOffset(2,.25);i.AddPath(e,ClipperLib.JoinType.jtMiter,ClipperLib.EndType.etClosedPolygon);const r=new ClipperLib.Paths,s="shrink"===o?-t:t;return i.Execute(r,1e6*s),i.Clear(),r&&r.length>0?r[0]:e}clipPath(e,t){const o=new ClipperLib.Clipper,i=[],r=Math.round(1e6*this.left),s=Math.round(1e6*this.top);if(this.height<=0||this.width<=0)return t?[t]:null;if(!(e&&0!==e.length||this.wrapShapeOffset))return t?[t]:null;if(e)for(const t of e)if("wrap around both sides"===t.mode){const e=t.points.map((e=>({X:1e6*e.x,Y:1e6*e.y})));i.push({path:e,wrapObjectOffset:t.wrapObjectOffset})}const n=[{X:this.left,Y:this.top},{X:this.left+this.width,Y:this.top},{X:this.left+this.width,Y:this.top+this.height},{X:this.left,Y:this.top+this.height}];let a=[{X:this.left,Y:this.top},{X:this.left+this.width,Y:this.top},{X:this.left+this.width,Y:this.top+this.height},{X:this.left,Y:this.top+this.height}];if(t?a=t.map((e=>({X:1e6*e.x,Y:1e6*e.y}))):ClipperLib.JS.ScaleUpPath(a,1e6),0===i.length)return[this.offSetPathPointsOnSpread(a,this.wrapShapeOffset,"shrink").map((e=>({x:(e.X-r)/1e6,y:(e.Y-s)/1e6})))];o.AddPath(this.offSetPathPointsOnSpread(a,this.wrapShapeOffset,"shrink"),ClipperLib.PolyType.ptSubject,!0);for(const e of i)o.AddPath(this.offSetPathPointsOnSpread(e.path,e.wrapObjectOffset,"grow"),ClipperLib.PolyType.ptClip,!0);const l=ClipperLib.PolyFillType.pftNonZero,c=ClipperLib.PolyFillType.pftNonZero,d=ClipperLib.ClipType.ctDifference,h=new ClipperLib.Paths;if(o.Execute(d,h,l,c),Array.isArray(h)&&h.length>0){console_log(h);const e=[];for(const t of h)e.push(t.map((e=>({x:(e.X-r)/1e6,y:(e.Y-s)/1e6}))));return JSON.stringify(e)===JSON.stringify([n])?null:e}return t?[t]:null}get width(){let e=this._width;return this.codeMode&&this.div&&(e=this.codeModeWidth||this.div.offsetWidth),e}getWidth(e,t,o,i){if(this.codeMode)return[{width:this.width-20,left:20}];if(this.paths){const r=e-t*i,s=this.getInterSectionPoints(Math.max(0,r)),n=e,a=this.getInterSectionPoints(n),l=e+o,c=this.getInterSectionPoints(l);if(c.length>=2&&s.length>=2&&a.length>=2){const e=this.intersectIntervals([this.pointsToIntervals(s),this.pointsToIntervals(a),this.pointsToIntervals(c)]);return 0===e.length?[{width:0,left:0}]:e.map((e=>({left:e.start,width:e.end-e.start})))}return[{width:0,left:0}]}return[{width:this.width-this.paddingLeft-this.paddingRight,left:this.paddingLeft}]}pointsToIntervals(e){const t=[];if(e.length>=2){const o=Math.floor(e.length/2);for(let i=0;i<o;i++){const o=2*i;t.push({start:e[o].x,end:e[o+1].x})}}return t}intersectIntervals(e){if(0===e.length)return[{start:0,end:0}];const t=e.sort(((e,t)=>t.length-e.length)).splice(0,1)[0],o=[];for(let e=0;e<t.length;e++)o.push(null);for(let i=0;i<t.length;i++){const r=t[i];for(const t of e)for(const e of t){const t=this.intersect(r.start,r.end,e.start,e.end);if(t){const e=o[i];null===e?o[i]=t:(e.s<t.s&&(e.s=t.s),e.e>t.e&&(e.e=t.e))}}}const i=[];for(const e of o)null!==e&&i.push({start:e.s,end:e.e});return i}intersect(e,t,o,i){const r=Math.max(e,o),s=Math.min(t,i);return s>r?{s:r,e:s}:null}equals(e){if(JSON.stringify(this.autoFrameSizeSettings)!==JSON.stringify(e.autoFrameSizeSettings))return!1;if(e.paddingLeft!==this.paddingLeft||e.paddingRight!==this.paddingRight||e.paddingTop!==this.paddingTop||e.paddingBottom!==this.paddingBottom)return!1;if(this.width!==e.width||this.height!==e.height)return!1;if(this.useBaselineGrid!==e.useBaselineGrid||e.useBaselineGrid&&(this.baselineHeight!==e.baselineHeight||this.baselineTop!==e.baselineTop))return!1;if(this.firstBaseline!==e.firstBaseline)return!1;if(this.paths&&e.paths&&this.paths.length===e.paths.length)for(let t=0;t<this.paths.length;t++){const o=this.paths[t],i=e.paths[t];if(o.length!==i.length)return!1;for(let e=0;e<o.length;e++)if(o[e].x!==i[e].x||o[e].y!==i[e].y)return!1}else if(this.paths&&!e.paths||!this.paths&&e.paths)return!1;if(this.wrapPaths&&e.wrapPaths){if(this.wrapPaths.length!==e.wrapPaths.length)return!1;for(let t=0;t<this.wrapPaths.length;t++){const o=this.wrapPaths[t].points,i=e.wrapPaths[t].points;if(this.wrapPaths[t].mode!==e.wrapPaths[t].mode)return!1;if(o.length!==i.length)return!1;for(let e=0;e<o.length;e++)if(o[e].x!==i[e].x||o[e].y!==i[e].y)return!1}}return!0}static rou(e){return Math.round(1e3*e)}static checkBoundingBoxIntersect(e,t,o,i){const r=Frame.rou(Math.min(e.x,t.x)),s=Frame.rou(Math.min(e.y,t.y)),n=Frame.rou(Math.max(e.x,t.x)),a=Frame.rou(Math.max(e.y,t.y)),l=Frame.rou(Math.min(o.x,i.x)),c=Frame.rou(Math.min(o.y,i.y)),d=Frame.rou(Math.max(o.x,i.x)),h=Frame.rou(Math.max(o.y,i.y));return r<=d&&n>=l&&s<=h&&a>=c}intersectLineWithTextLine(e,t,o){const i=t.y-e.y,r=t.x-e.x;if(1*i==0*r)return null;return{x:((o-e.y)*r+i*e.x)/i,y:o}}getInterSectionPoints(e){if(this.paths){const t=[],o=Math.round(1e6*this.width)/1e6;for(const i of this.paths)for(let r=1;r<i.length;r++){const s=i[r-1],n=i[r];if(Frame.checkBoundingBoxIntersect(s,n,{x:0,y:e},{x:o,y:e})){const o=this.intersectLineWithTextLine(s,n,e);o&&t.push(o)}}return t.sort(((e,t)=>e.x-t.x))}return[{x:0,y:e},{x:this.width,y:e}]}}class UndoState{constructor(e,t,o){this.endSelection=o,this.selection=t,this.paragraphs=e}}class Eddi{constructor(e,t,o,i,r,s,n=null,a=[],l=[],c=null,d="off",h){this.idLookUp={},this.timeFromLastPersistCall=Date.now(),this.codeModeTextWidthCache=new Map,this.debugLastFlowMs=0,this.debugLastRenderMs=0,this._hasOverflow=!1,this.allFramesHaveSameWidth=!1,this.textInfoBeforeDelete=null,this.on30SekPersistTimer=null,this.paragraphsBeforeEdit=null,this.formFields=new Map,this.dataFields=new Map,this.classNames=new Set,this.flowStartTime=Date.now(),this._selectionChangedTimeoutHandle=0,this.skipBlurOnce=!1,this._____paragraphs=[],this.config=e,this.undos=[],this.parentBoxIdForEvaluation=c,this.hyphenationLanguage=d,a.length||a.push(new TextStyle),l.length||l.push(new ParagraphStyle),this._setFramesInternal(o,i,r,n,h),this.mode=s,this.undos=[],this.selection=new Selection(this);let p=[];if("string"==typeof t){let e;e=this.config.codeMode?[t]:t.split(/\n\n/);let o=0,i=0;for(const t of e){const e=new Paragraph(newId("P"),this,t,a[o],l[i]);i<l.length-1&&i++,o<a.length-1&&o++,p.push(e)}}else if("edit"===this.mode)p=t.a.map((e=>Paragraph.Deserialize(e,this)));else{const e=evaluatedIText(t,c);p=e.text.a.map((e=>Paragraph.Deserialize(e,this))),this.formFields=e.formFields,this.dataFields=e.dataFields,this.classNames=e.classNames}this.hasUi?(this.setParagraphs(p,void 0,void 0,!0),this.paragraphsBeforeEdit=this.paragraphs,this.render(),"preview"!==this.mode&&this.firstParagraph.firstLine?this.selection.setStartByLineWord(this.firstParagraph.firstLine.firstWord,0,0):this.selection.reset()):this.setParagraphs(p)}get paragraphs(){return this._____paragraphs}setParagraphs(e,t=!1,o=!1,i=!1){const r=new Set;for(const t of e)for(const e of t.words){if(r.has(e.id))throw new Error("Can't set paragraphs model, double ids found.");r.add(e.id)}if(!0===i?this.undos=[]:!t&&this.selection&&(o||(this.undos.length>50&&this.undos.shift(),this.undos.push(new UndoState([...this.paragraphs],this.selection.getStartSelection(),this.selection.getEndSelection())))),(!e||e.length<1)&&(e=[new Paragraph(newId("P"),this,"",new TextStyle,new ParagraphStyle)]),this._____paragraphs=e,this.idLookUp)for(const t of e)this.idLookUp[t.id]!==t&&void 0!==this.idLookUp[t.id]&&console_log("::: P CHANGED:"+t.id+" ["+t.debugStringFirstLine()+"]");this.idLookUp={};for(const t of e)this.idLookUp[t.id]=t;setPreviousNextPointers(this.paragraphs),this.flow(),i||this.config.onContentChangedCallback&&this.config.onContentChangedCallback(this.toString())}get class(){return this.frames[0].classes}get frames(){return this._frames}get hasUi(){return this._hasUi}get hasOverflow(){return this._hasOverflow}set hasOverflow(e){this._hasOverflow=e,this.config.onOverflowChangeCallback&&this.config.onOverflowChangeCallback()}clear(){this.on30SekPersistTimer&&window.clearInterval(this.on30SekPersistTimer),this._setFramesInternal(null,[null],[null],null),this.setParagraphs([])}redraw(){const e=[];for(const t of this.paragraphs)e.push(new Paragraph(t.id,this,t.words,t.textStyle,t.paragraphStyle,!0));this.setParagraphs(e),this.render()}fitFrameToText(){if(2!==this.frames.length)return null;const e=this.frames[0];if("off"===e.autoFrameSizeSettings.autoTextMode)return null;let t;if(console_log("++++++++ Fit Frame ["+e.name+"] +++++++++++"),"width"===e.autoFrameSizeSettings.autoTextMode){const o=e.paddingLeft+e.paddingRight+this.paragraphs.map((e=>e.lastFlowMaxWidth)).reduce(((e,t)=>t>e?t:e),0),i=e.autoFrameSizeSettings.maxWidth-e.paddingLeft-e.paddingRight,r=e.autoFrameSizeSettings.minWidth;if(t={width:Math.min(i,Math.max(o,r)),height:e.height},t.width===e.width&&t.height===e.height)return t}else{t=this._getFittingFrame(e.width,e.height);for(const e of this.paragraphs)e.lastFlowTop=-1}const o={width:t.width,height:t.height,left:e.left,spreadLeft:e.spreadLeft,top:e.top,paddingLeft:e.paddingLeft,paddingTop:e.paddingTop,paddingRight:e.paddingRight,paddingBottom:e.paddingBottom,verticalAlign:e.verticalAlign,rotation:e.rotation,spreadTop:e.spreadTop,boxId:e.boxId||"",getWcBox:e.getWcBox,wrapShapeOffset:e.wrapShapeOffset,wrapAscenderDiminisher:e.wrapAscenderDiminisher,name:e.name,classes:e.classes||"",useBaseLineGrid:e.useBaselineGrid,firstBaseline:e.firstBaseline,baselineTop:e.baselineTop,baselineHeight:e.baselineHeight};this._setFramesInternal([o],[e.boxPath],[e.wrapPaths],e.autoFrameSizeSettings);for(const e of this.paragraphs)e.lastFlowTop=-1;return this.flow(!1,!0),this.render("leave-unchanged"),console_log({newWidth:t.width,oldWidth:e.width,newHeight:t.height,oldHeight:e.height,heighDif:t.height-e.height}),e.boxId&&this.config.changeFrameSize&&this.config.changeFrameSize(this,e.boxId,t.width,t.height),console_log("****** Fit Text Frame Result Width="+t.width+"  Height="+t.height),t}static round(e){return e}_getFittingFrame(e,t){const o=this.frames[0];let i=e/2,r=t/2,s=0,n=0,a=2,l=2;let c=o.autoFrameSizeSettings.maxWidth,d=o.autoFrameSizeSettings.maxHeight;const h=o.autoFrameSizeSettings.minWidth,p=o.autoFrameSizeSettings.minHeight;let u=this.hasOverflow?"expand":"contract";switch(o.autoFrameSizeSettings.autoTextMode){case"height":a=0,i=0,c=e;break;case"width":l=0,r=0,d=t}let m=0;for(m=0;m<20;m++){if((this.hasOverflow&&"contract"===u||!this.hasOverflow&&"expand"===u)&&(u="toggle"),"toggle"===u&&(this.hasOverflow&&!s?(i*=a,r*=l):(a>0?i/=a:i=0,l>0?r/=l:r=0)),this.hasOverflow){if(t>d&&"height"===o.autoFrameSizeSettings.autoTextMode)break;if(e>c&&"width"===o.autoFrameSizeSettings.autoTextMode)break;e+=i,t+=r}else{let o=!1;if(m>8&&e-s<.01&&t-n<.01&&(o=!0),s=e,n=t,o)break;e-=i,t-=r}const h={width:Math.min(c,e),height:Math.min(d,t),left:o.left,spreadLeft:o.spreadLeft,top:o.top,paddingLeft:o.paddingLeft,paddingTop:o.paddingTop,paddingBottom:o.paddingBottom,paddingRight:o.paddingRight,verticalAlign:o.verticalAlign,rotation:o.rotation,spreadTop:o.spreadTop,boxId:o.boxId||"",getWcBox:o.getWcBox,wrapShapeOffset:o.wrapShapeOffset,wrapAscenderDiminisher:o.wrapAscenderDiminisher,name:o.name,classes:o.classes||"",useBaseLineGrid:o.useBaselineGrid,firstBaseline:o.firstBaseline,baselineHeight:o.baselineHeight,baselineTop:o.baselineTop};this._setFramesInternal([h],[o.boxPath],[o.wrapPaths],o.autoFrameSizeSettings);for(const e of this.paragraphs)e.lastFlowTop=-1;this.flow(!0)}return console_log("Get fitting frame iterations: "+m),s&&n?{width:Math.min(c,Math.max(s,h)),height:Math.min(d,Math.max(n,p))}:{width:c,height:d}}setText(e,t){let o;o=this.config.codeMode?[e]:e.split(/\n\n/);const i=[];for(const e of o){const t=new Paragraph(newId("P"),this,e,new TextStyle,new ParagraphStyle);i.push(t)}this.setParagraphs(i,void 0,void 0,t),this.render()}setFrames(e,t,o,i,r,s,n="off"){let a=this._setFramesInternal(e,t,o,i);if(this.hyphenationLanguage=n,void 0!==r){a=!0,null===r?(this.setParagraphs([]),this.render()):this.deserialize(r);let e=null;if(s){const t=this.getFrameByBoxId(s);if(t){const o=this.selection.getFirstOrLastWordOfFrame("first",t.index);o&&o.lineWord&&(e=o.lineWord)}}!e&&this.firstParagraph.firstLine&&(e=this.firstParagraph.firstLine.firstWord),e&&this.selection.setStartByLineWord(e,0,0)}else if(a){for(const e of this.paragraphs)e.fromCache="nothing",e.lastFlowTop=-1;this.flow(),this.render()}return a}_setFramesInternal(e,t,o,i,r){let s=!1;const n=[];if(e?(this._hasUi=!0,e.forEach(((e,a)=>{const l=new Frame(e,a,t[a],o[a],i,this.config.codeMode,r);if(this._frames&&this._frames.length>a){this.frames[a].equals(l)||(s=!0)}else s=!0;n.push(l)})),n.push(new Frame(n[n.length-1].width,n.length,null,null,null,this.config.codeMode))):(this._hasUi=!1,s=!0,n.push(new Frame(500,0,null,null,null,this.config.codeMode))),s&&(this._frames=n),this.allFramesHaveSameWidth=!0,n.length){const e=n[0].width;for(const t of n)(t.paths||t.width!==e)&&(this.allFramesHaveSameWidth=!1)}return s}static applyParagraphTextStyleToWordStyle(e,t){const o=[];for(const i of t)i instanceof Word?o.push(i.setTextStyle(0,i.length,e.textStyle.properties,void 0,!0,!0)):o.push(i);return o}static addWords(e,t,o,i){let r;if(i){const i=Eddi.applyParagraphTextStyleToWordStyle(e,[...e.words]);r=new Paragraph(e.id,e.parentEddi,[...o,...i],t.textStyle,t.paragraphStyle,!0)}else o=Eddi.applyParagraphTextStyleToWordStyle(t,o),r=new Paragraph(e.id,e.parentEddi,[...e.words,...o],e.textStyle,e.paragraphStyle,!0);return r}flow(e=!1,t=!1){let o="off";2===this.frames.length&&(o=this.frames[0].autoFrameSizeSettings.autoTextMode),this.hasOverflow=!1;const i=this.lastParagraph.lastFlowTop,r=this.lastParagraph.lastFlowHeight,s=this.paragraphs.map((e=>e.lastFlowMaxWidth)).reduce(((e,t)=>t>e?t:e),0);e||t||(this.flowStartTime=Date.now());let n=0,a=[],l="nothing",c=0,d=null;for(const e of this.frames){if(d=this.fillFrame(e.index,c,n,a,l),n=d.nextWordIndex,a=d.remainingSubWords,c=d.nextParagraphIndex,l=d.lastParagraphCacheMode,this.config.codeMode){const t=this.paragraphs.map((e=>e.lastFlowMaxWidth)).reduce(((e,t)=>t>e?t:e),0);try{e.setCodeModeDimensions(this.lastVisibleLine.top+this.lastVisibleLine.height,t)}catch(e){console.error(e)}}if(e===this.frames[this.frames.length-1]&&(this.hasOverflow=!0),c>=this.paragraphs.length)break}let h=!0;const p=this.paragraphs.map((e=>e.lastFlowMaxWidth)).reduce(((e,t)=>t>e?t:e),0);for(let e=0;e<this.paragraphs.length;e++)if(this.paragraphs[e].lines.length>0){h=!1;break}if(h){const e=this.firstParagraph,t=this.firstWord,o=new Line(newId("L"),e,[t],0,0,!0,"automatic",t.width,!0,0,t.lineHeight,t.maxFontSize,0);t.parent=o,e.lines.push(o),d&&(d.nextWordIndex=1),this.hasOverflow=this.paragraphs[0].words.length>0}else{const e=this.firstParagraph;1===e.lines.length&&1===this.paragraphs.length&&"width"!==o&&(this.hasOverflow=this.hasOverflow||this.frames[0].height<e.lines[0].height)}if(!e){if(t||"height"!==o){if(t||"width"!==o){if(!1===this.hasOverflow&&2===this.frames.length&&"top"!==this.frames[0].verticalAlign){const e=Math.max(0,this.frames[0].height-(this.lastParagraph.lastFlowTop+this.lastParagraph.lastFlowHeight));if(e>0){const t="bottom"===this.frames[0].verticalAlign?e:e/2;for(const e of this.paragraphs)for(const o of e.lines)o.top+=t}}}else if(this.hasOverflow||s!==p)return void this.fitFrameToText()}else if(-1===this.lastParagraph.lastEndFrameIndex||this.lastParagraph.lastEndFrameIndex>0||i+r!==this.lastParagraph.lastFlowTop+this.lastParagraph.lastFlowHeight)return void this.fitFrameToText();if(d)for(let e=d.nextParagraphIndex;e<this.paragraphs.length;e++){const t=this.paragraphs[e];if(e===d.nextParagraphIndex){if("paragraph"!==d.lastParagraphCacheMode){for(let e=d.nextWordIndex;e<t.words.length;e++){const o=t.words[e];o instanceof Word&&(o.parent=null)}for(const e of d.remainingSubWords)e instanceof Word&&(e.parent=null)}}else{t.lastFlowTop=-1;for(const e of t.words)e instanceof Word&&(e.parent=null);t.lines=[]}}for(const e of this.paragraphs)setPreviousNextPointers(e.lines);this.debugLastFlowMs=Date.now()-this.flowStartTime,console_log("Eddi Flow: "+this.debugLastFlowMs+"ms")}}getInitialFontValues(e,t,o=0){let i={lineHeight:0,ascender:0,descender:0,fontSize:0},r=!1;const s="number"==typeof t?this.paragraphs[t]:t;if(!s)return i;for(let e=o;e<s.words.length;e++){const t=s.words[e];if(t instanceof Word&&t.spans.length>0){const e=t.spans[0];i={lineHeight:e.textStyle.getLineHeight(e),ascender:e.textStyle.getAscender(e),descender:e.textStyle.getDescender(e),fontSize:e.textStyle.getFontSize(e)},r=!0;break}}return r||(i={lineHeight:s.textStyle.getLineHeight(s),ascender:s.textStyle.getAscender(s),descender:s.textStyle.getDescender(s),fontSize:s.textStyle.getFontSize(s)}),e.useBaselineGrid&&(i.lineHeight=e.baselineHeight),i}fillFrame(e,t,o,i,r){const s=this.frames[e],n=this.getInitialFontValues(s,t);let a=n.lineHeight,l=n.ascender,c=n.descender,d=Math.max(s.paddingTop,s.wrapShapeOffset),h=!0;if(s.useBaselineGrid){const e=d+s.top;if(e<s.baselineTop)d=s.baselineTop-e;else if(e>s.baselineTop){let t=e-s.baselineTop;t=Math.ceil(t/s.baselineHeight)*s.baselineHeight;d=s.baselineTop+t-s.top}}let p,u=t,m=o,f=0;for(;u<this.paragraphs.length;){const t=this.paragraphs[u];if(0===m&&!f){const o="bullet"===t.paragraphStyle.getParagraphStyleProperty(t,"horizontalTextAlign"),i="top"!==s.verticalAlign;if(!s.useBaselineGrid){const e=t.paragraphStyle.getSpaceBeforeParagraph(t);e>0&&(d+=e)}if(t.fromCache="nothing",t.lastFlowTop!==d&&"paragraph"!==r||t.lastStartFrameIndex!==e||t.lastStartFrameIndex!==t.lastEndFrameIndex||o||i){if(this.allFramesHaveSameWidth&&t.lastFlowTop>=0&&t.lastStartFrameIndex===t.lastEndFrameIndex&&e===t.lastStartFrameIndex&&!o&&!i){let e=d,o=0;for(;o<t.lines.length;){const i=t.lines[o];if(!(e+i.height<s.height))break;i.top=e,e+=i.height,o++}if(o==t.lines.length){t.fromCache="lines",h=!1,u++;const e=this.getInitialFontValues(s,u);a=e.lineHeight,l=e.ascender,c=e.descender,m=0,t.lastFlowTop=d,d+=t.lastFlowHeight}}}else{if(console_warn("P has not changed: "+t.id+" lastStartFrame="+t.lastStartFrameIndex+"  p.lastEndFrameIndex="+t.lastEndFrameIndex),t.fromCache="paragraph",r="nothing",h=!1,t.lastEndFrameIndex>e)return{remainingSubWords:[],nextWordIndex:0,nextParagraphIndex:u,lastParagraphCacheMode:"paragraph"};if(-1===t.lastEndFrameIndex)return{remainingSubWords:[],nextWordIndex:0,nextParagraphIndex:u,lastParagraphCacheMode:"paragraph"};u++,d+=t.lastFlowHeight;const o=this.getInitialFontValues(s,u);a=o.lineHeight,l=o.ascender,c=o.descender}}if("nothing"===t.fromCache){0===m&&(t.fromCache="nothing",t.lastStartFrameIndex=e,t.lastFlowTop=d,t.lines=[]);let o,r=0===u&&0===e&&0===m&&!f;if(s.autoFrameSizeSettings&&"height"===s.autoFrameSizeSettings.autoTextMode&&(r=!1),r){const r=this.getInitialFontValues(s,u,m);a=r.lineHeight,l=r.ascender,c=r.descender;const n=this.getSublineWidths(s,h,d,r.ascender,r.descender,r.lineHeight);if(this.setIndents(n,t,m),!(d<s.height))break;o=t.getLine(m,n[0].width,n[0].left,d,h,e,i,0),n.length>1&&(o.nextSubLineIndex=1,o.subLineWidths=n)}else o=this.fitLine(s,d,h,a,l,c,t,m,i,f,p);if(!o)break;{const r=0===o.remainingSubWords.length&&o.nextWordIndex>=t.words.length&&0===o.remainingSubWords.length;if(o&&o.createdWords)for(const e of o.createdWords)t.idLookUp[e.id]=e;if(o.line?(o.nextSubLineIndex||(h=!1),t.lines.push(o.line),0===f?(a=o.line.height+o.line.firstLineOffset,l=o.line.ascender,c=o.line.descender):(a=Math.max(a,o.line.height+o.line.firstLineOffset),l=Math.max(l,o.line.ascender),c=Math.max(c,o.line.descender))):t.lines.length>0&&(h=!1),o.nextSubLineIndex&&!r||(h&&!s.useBaselineGrid?d+=3:d+=a),o.nextSubLineIndex&&o.nextSubLineIndex>0?(f=o.nextSubLineIndex,p=o.subLineWidths):(p=void 0,f=0),r){const o=t.getSpaceAfter(s.useBaselineGrid);d+=o,f=0,p=void 0,t.lastEndFrameIndex=e,t.lastFlowHeight=o+t.getLineHeightSum(),m=0,i=[],u++;const r=this.getInitialFontValues(s,u);a=r.lineHeight,l=r.ascender,c=r.descender}else m=o.nextWordIndex,i=o.remainingSubWords}}}return{remainingSubWords:i,nextWordIndex:m,nextParagraphIndex:u,lastParagraphCacheMode:"nothing"}}fitLine(e,t,o,i,r,s,n,a,l,c,d,h=10){let p=i,u=r,m=s;if(!d){c=0;const l=this.getInitialFontValues(e,n,a);i=l.lineHeight,r=l.ascender,s=l.descender,d=this.getSublineWidths(e,o,t,l.ascender,l.descender,l.lineHeight),this.setIndents(d,n,a)}const f=n.getLine(a,d[c].width,d[c].left,t,o,e.index,[...l],c);f.line&&(p=f.line.height,u=f.line.ascender,m=f.line.descender);const g=t+p+m<=e.height-e.paddingBottom+.1;return this.config.codeMode||g?p>i&&h>0&&0===c?(d=this.getSublineWidths(e,o,t,u,m,p),this.setIndents(d,n,a),this.fitLine(e,t,o,p,u,m,n,a,l,c,d,h-1)):(c<d.length-1&&(f.nextSubLineIndex=c+1,f.subLineWidths=d),f):null}getSublineWidths(e,t,o,i,r,s){let n;return n=t&&"ascender"===e.firstBaseline&&!e.useBaselineGrid?o+i:o+s,e.getWidth(n,i,r,e.wrapAscenderDiminisher)}setIndents(e,t,o){let i=0;i=0===o?t.paragraphStyle.getFirstLineIndent(t):t.paragraphStyle.getLeftIndent(t);const r=t.paragraphStyle.getRightIndent(t);e[0].left+=i,e[0].width-=i+r,e[0].width<0&&(e[0].width=0)}render(e=null){const t=Date.now(),o=new Set(this.paragraphs.filter((e=>("paragraph"===e.fromCache||"lines"===e.fromCache)&&e.lines.length)).map((e=>e.id)));for(const e of this.frames)if(e.paragraphsGroup){e.paragraphsGroup.setAttributeNS(null,"style",TextStyle.baseFullCss(this));for(let t=e.paragraphsGroup.children.length-1;t>=0;t--){const i=e.paragraphsGroup.children[t],r=i.getAttributeNS(null,"name");if(r)if(o.has(r)){const e=this.idLookUp[r];if(e&&"lines"===e.fromCache&&e.lines.length<=i.children.length){for(let t=0;t<e.lines.length;t++){const o=e.lines[t];i.children[t].setAttributeNS(null,"transform","translate("+(o.left+o.firstWordOffSet)+" "+o.baseline+")")}i.children.length===e.lines.length+1&&i.children[i.children.length-1].setAttributeNS(null,"transform","translate(0 "+e.lines[0].top+")")}}else i.remove()}}for(const e of this.paragraphs)"nothing"===e.fromCache&&e.render();if("edit"===this.mode){for(const e of this.frames)if(e.paragraphsGroup&&e.getWcBox&&e.boxId){const t=e.getWcBox(e.boxId);t&&"function"==typeof t.replaceStoryTextSvg&&t.replaceStoryTextSvg(e.svg)}"leave-unchanged"!==e&&(e?this.selection.setStartBySelection(e):this.selection.hasSelection()?this.selection.redraw():this.firstParagraph.firstLine&&this.selection.setStartByLineWord(this.firstParagraph.firstLine.firstWord,0,0))}else this.selection.hasSelection()&&this.selection.reset();this.debugLastRenderMs=Date.now()-t,console_log("Eddi render-Time: "+this.debugLastRenderMs+"ms")}selectionChanged(){this.config.onSelectionChangedCallback&&(this._selectionChangedTimeoutHandle&&clearTimeout(this._selectionChangedTimeoutHandle),this._selectionChangedTimeoutHandle=window.setTimeout((()=>{this._selectionChangedTimeoutHandle=0,this._selectionChangedDeferred()}),350))}_selectionChangedDeferred(){if(scope().eddiActive()){const e=this.selection.getTextInfo();e&&(console_log("***** SELECTION CHANGED CALLED ["+e.rule+"] *****"),this.config.onSelectionChangedCallback&&this.config.onSelectionChangedCallback(e,this.debugLastFlowMs,this.debugLastRenderMs))}}getParagraphIndex(e){for(let t=0;t<this.paragraphs.length;t++)if(e===this.paragraphs[t])return t;return-1}getParagraphByWordId(e){if(!e)return null;if(e.startsWith("W")||e.startsWith("B")||e.startsWith("T")){for(const t of this.paragraphs)if(t.idLookUp[e])return t}else if(e.startsWith("P")){const t=this.idLookUp[e];if(this.idLookUp[e])return t}return null}insertParagraphAfterSelection(e){const t=this.selection.paragraph;if(!t)throw"Selection has no valid paragraph";const o=[...this.paragraphs],i=t.clone(e);for(let e=0;e<o.length;e++)if(o[e].id===t.id){o.splice(e+1,0,i);break}return o}doubleClick(e){e.preventDefault(),"preview"!==this.mode&&this.selection.setByMouseEvent("start",e,!0)}mouseDown(e){e.preventDefault(),"preview"!==this.mode&&(e.shiftKey?this.selection.setByMouseEvent("end",e):this.selection.setByMouseEvent("start",e),this.mouseMoveRouting=e=>this.mouseMove(e),this.mouseUpRouting=()=>this.mouseUp(),document.addEventListener("mousemove",this.mouseMoveRouting),document.addEventListener("mouseup",this.mouseUpRouting))}mouseMove(e){e.preventDefault(),this.selection.setByMouseEvent("end",e)}mouseUp(){document.removeEventListener("mousemove",this.mouseMoveRouting),document.removeEventListener("mouseup",this.mouseUpRouting)}mouseTouchDown(e){"preview"!==this.mode&&(e.shiftKey?this.selection.setByMouseTouchEvent("end",e):this.selection.setByMouseTouchEvent("start",e))}mouseTouchMove(e){"preview"!==this.mode&&this.selection.setByMouseTouchEvent("end",e)}mouseTouchUp(e,t){"preview"!==this.mode&&(t?this.selection.setByMouseTouchEvent("start",e,!0):this.selection.hasRange&&showTip("textSelectAll"))}get lastParagraph(){return this.paragraphs[this.paragraphs.length-1]}get lastVisibleParagraph(){for(let e=this.paragraphs.length-1;e>=0;e--)if(this.paragraphs[e].lines.length>0)return this.paragraphs[e];throw"No Visible Paragraph Found."}get lastVisibleWord(){return this.lastVisibleLine.lastWord}get lastVisibleLine(){const e=this.lastVisibleParagraph;return e.lines[e.lines.length-1]}get firstParagraph(){return this.paragraphs[0]}get firstWord(){for(const e of this.firstParagraph.words)if(e instanceof Word)return e;throw"First Paragraph has no word"}getFrameByBoxId(e){for(const t of this.frames)if(t.boxId===e)return t;return null}keyDown(e){if(!e.isComposing){if("cancel"===this.handleSpecialKey(e))return e.preventDefault(),!0;scope().isReplaying&&this.selection&&this.selection&&this.selection.inputReplay(e.key)}return!1}handleSpecialKey(e){let t=!1;if(this.selection.intellisenseActive){if(!0===this.selection.intellisenseKeyDown(e))return"cancel"}else if(!(e.metaKey||e.altKey||e.ctrlKey&&" "!==e.key)){let t=e.key;const o=this.selection.getRuleName();let i=!1,r=this.selection.getCharsBeforeStart();if(1===t.length?(r=(r+t).trim(),i=!0):"Backspace"===t&&r.length&&(r=r.substr(0,r.length-1),t="",i=!0),i&&(this.config.codeMode||"$"===t||r.startsWith("$"))){const e=getTokens(o,!0,"local"===this.config.styleContext);this.selection.showIntellisense(e.tokens,r)}}if(e.key.startsWith("Arrow"))return this.handleArrowKeys(e),"cancel";if(" "===e.key&&e.ctrlKey){const e=this.selection.getRuleName();return this.selection.showIntellisense(getTokens(e,!0,"local"===this.config.styleContext).tokens,this.selection.getCharsBeforeStart()),"cancel"}if("Backspace"===e.key||"Delete"===e.key)return this.deleteSelectedContent("Delete"===e.key,!0),this.selection.removeRange(),"cancel";if("Tab"===e.key)return this.config.codeMode&&(this.selection.hasRange||e.shiftKey)?this.addOrRemoveTabsInCodeMode(e.shiftKey?"remove":"add"):this.selection.paragraph&&(this.selection.hasRange&&(t=this.deleteSelectedContent(!1)),this.render(this.selection.paragraph.modifyWord(e.key,e.key.length>1,t))),"cancel";if("Escape"===e.key)return scope().selectionPropertiesUi.selectTool("geometry"),"cancel";if("Enter"===e.key){let o=e.key;return e.shiftKey&&(o="ShiftEnter"),this.config.codeMode&&("Enter"===o?o="ShiftEnter":"ShiftEnter"===o&&(o="Enter")),this.selection.paragraph&&(this.selection.hasRange&&(t=this.deleteSelectedContent(!1)),this.render(this.selection.paragraph.modifyWord(o,e.key.length>1,t))),"cancel"}if((e.ctrlKey||e.metaKey)&&"Meta"!==e.key&&"Ctrl"!==e.key){if("a"===e.key)return this.selection.setSelectAll(),"cancel";if("v"===e.key)return"cancel";if("z"===e.key&&this.undos.length)return this.undo(),"cancel";if("9"==e.key)return this.selection.redraw(),"cancel";const t=this.selection.getLineWord("start"),o=this.selection.getLineWord("end");if(t&&o){const t=this.getTextStyleByKey(e.key);if(t)return this.styleSelectedContent(t),"cancel";{const t=this.getParagraphStyleByKey(e.key);if(t)return this.styleSelectedParagraph(t),"cancel"}}}return"nothing"}undo(){const e=this.undos.pop();return!!e&&(this.setParagraphs(e.paragraphs.map((e=>new Paragraph(e.id,this,e.words,e.textStyle,e.paragraphStyle))),!0),e.selection?this.selection.setStartBySelection(e.selection):this.selection.hideRangeAndStart(),e.endSelection?this.selection.setEndBySelection(e.endSelection):this.selection.removeRange(),this.render(),!0)}handleArrowKeys(e){if(e.altKey){const t=this.getTextStyleByKey(e.key,e.shiftKey);return void(t&&this.styleSelectedContent(t,"ArrowLeft"===e.key||"ArrowRight"===e.key))}let t="start";e.shiftKey&&(t="end",this.selection.hasRange||this.selection.setEndToStart());const o=this.selection.getLineWord(t),i=this.selection.getLineWordPos(t);if(!o)throw"Selection arrow key handling aborted word not found ["+t+"] ";if("ArrowLeft"===e.key){const e=o.previous&&o.subWordPos&&!o.subWordPos.isFirstPartOfBreak;if(0===i){const i=o.previousWord;i&&this.selection.setStartOrEndByLineWord(t,i,i.length-(e?1:0))}else this.selection.setStartOrEndByLineWord(t,o,i-1)}else if("ArrowRight"===e.key){const r=o.next&&o.subWordPos&&!o.subWordPos.isLastPartOfBreak;if(i>=o.length){const i=o.nextWord;i&&(e.ctrlKey?this.selection.setStartOrEndByLineWord(t,i,i.length):this.selection.setStartOrEndByLineWord(t,i,r?1:0))}else e.ctrlKey?this.selection.setStartOrEndByLineWord(t,o,o.length):this.selection.setStartOrEndByLineWord(t,o,i+1)}else if("ArrowUp"===e.key){const e=this.getPreviousLines(o.parent);if(e.length){const o=this.getWordAtXCoordinate(e,this.selection.getXPos(t));o?this.selection.setStartOrEndByLineWord(t,o.lineWord,o.lineWordPos):this.selection.setStartOrEndByLineWord(t,e[0].firstWord,0)}}else if("ArrowDown"===e.key){const e=this.getNextLines(o.parent);if(e.length){const o=this.getWordAtXCoordinate(e,this.selection.getXPos(t));o?this.selection.setStartOrEndByLineWord(t,o.lineWord,o.lineWordPos):this.selection.setStartOrEndByLineWord(t,e[0].firstWord,0)}}}getPreviousLines(e){var t;let o=null;const i=[];let r=null!==(t=null==e?void 0:e.subLineIndex)&&void 0!==t?t:0;if(e){for(;e.previous&&e.previous.subLineIndex<r;)r=(e=e.previous).subLineIndex;if(e.previous?o=e.previous:e.parent.previous&&(o=e.parent.previous.lastLine),o)for(i.unshift(o);o.subLineIndex>0&&o.previous&&o.previous.subLineIndex<o.subLineIndex;)o=o.previous,o&&i.unshift(o)}return i}getNextLines(e){var t;let o=null;const i=[];let r=null!==(t=null==e?void 0:e.subLineIndex)&&void 0!==t?t:0;if(e){for(;e.next&&e.next.subLineIndex>r;)r=(e=e.next).subLineIndex;if(o=e.next?e.next:e.parent.next?e.parent.next.firstLine:e,o)for(i.push(o);o.next&&o.next.subLineIndex>0;)o=o.next,o&&i.push(o)}return i}getWordAtXCoordinate(e,t){let o=0;const i=e.length;if(i){for(;t>e[o].left+e[o].width&&e[o].next&&o<i-1;)o++;return e[o].getWordAtXCoordinate(t)}return null}getTextStyleByKey(e,t=!1){const o=t?10:1,i=this.selection.getTextInfo();if(!i)return null;const r=i.fullStyle.fontSize.value,s=i.fullStyle.tracking,n=i.fullStyle.lineHeight.value,a=i.fullStyle.baselineShift;return"+"===e?{fontSize:new Length(Math.min(500,r+3),i.fullStyle.fontSize.unit)}:"-"===e?{fontSize:new Length(Math.max(3,r-3),i.fullStyle.fontSize.unit)}:"ArrowLeft"===e?(console_log("Kerning:"+s+"==>"+(s-20*o)),{tracking:Math.max(-500,s-20*o)}):"ArrowRight"===e?(console_log("Kerning:"+s+"==>"+(s+20*o)),{tracking:s+20*o}):"ArrowUp"===e?!1===t?{lineHeight:new Length(Math.max(2,n-2),i.fullStyle.lineHeight.unit)}:{baselineShift:new Length(a.value-1*o,a.unit)}:"ArrowDown"===e?!1===t?{lineHeight:new Length(Math.max(2,n+2),i.fullStyle.lineHeight.unit)}:{baselineShift:new Length(a.value+1*o,a.unit)}:"r"===e?{fontColor:"#ff0000"}:"g"===e?{fontColor:"#00ff00"}:"b"===e?{fontColor:"#0000ff"}:null}getParagraphStyleByKey(e){const t=this.selection.paragraph;if(t){const o=t.paragraphStyle.getParagraphStyleProperty(t,"horizontalTextAlign");if("#"===e)switch(o){case"center":return{horizontalTextAlign:"justifyLeft"};case"justifyLeft":return{horizontalTextAlign:"left"};case"left":return{horizontalTextAlign:"right"};case"right":return{horizontalTextAlign:"center"}}}return null}static isInsertableKey(e){return!("Enter"!==e.key&&"Tab"!==e.key&&1!==e.key.length||e.ctrlKey||e.metaKey)}addOrRemoveTabsInCodeMode(e){const t=this.selection.getAllLinesInSelection();console_log("Lines_and_ps=",t);const o=[...this.paragraphs];for(const i of t)if(i.lines.length>0){const t=[...o[this.getParagraphIndex(i.paragraph)].words];for(const o of i.lines)if(!o.previous||"manual"===o.previous.breaks)if("add"===e){for(let e=0;e<t.length-1;e++)if(t[e].id===o.firstWord.id){const o=new Tab(newId("T"));t.splice(e,0,o);break}}else for(let e=0;e<t.length-1;e++)if(t[e].id===o.firstWord.id){const o=t[e];o instanceof Word&&0===o.length&&t[e+1]instanceof Tab&&t.splice(e,2);break}o[this.getParagraphIndex(i.paragraph)]=new Paragraph(i.paragraph.id,this,t,i.paragraph.textStyle,i.paragraph.paragraphStyle)}this.setParagraphs(o),this.render()}deleteSelectedContent(e=!1,t=!1){const o=this.selection.getRange();if(!o)return!1;const i=this.getParagraphByWordId(o.start.wordId);if(!i)throw"Can't delete selected content, no paragraph found in selection";const r=i.removeWords(o.start.wordId,o.start.wordPos,o.end.wordId,o.end.wordPos,e?"Delete":"Backspace"),s=r?r.selection:null;return this.render(s),t?(this.textInfoBeforeDelete=null,!1):(this.textInfoBeforeDelete=r&&r.info?r.info:null,!(!s||!s.joinWithPreviousUndo))}styleSelectedContent(e=null,t=!1,o=!0,i="default"){var r,s,n;let a=this.selection.hasRange;if(!a||"all-paragraphs"===i){const e=this.selection.getStartSelection();if(e&&e.paragraphId){const o=this.idLookUp[e.paragraphId];if(o)if(t&&"all-paragraphs"!==i)if(e.wordPos>0)e.wordPos--,this.selection.setEndBySelection(e),a=this.selection.hasRange;else{const t=this.selection.getLineWord("start");t&&t.length>e.wordPos&&(e.wordPos++,this.selection.setEndBySelection(e),a=this.selection.hasRange)}else if("default"!==i)this.selection.setSelectAll(),a=this.selection.hasRange;else{const e=null===(r=o.firstLine)||void 0===r?void 0:r.firstWord,t=null===(s=o.lastLine)||void 0===s?void 0:s.lastWord;e&&t&&(this.selection.setRangeByLineWord(e,0,t,t.length,o.lastStartFrameIndex,o.lastEndFrameIndex),a=this.selection.hasRange)}}}if(a||t){const t=this.selection.getRange();if(!t)return;this.styleContentCrossParagraph(e,t.start.wordId,t.start.wordPos,t.end.wordId,t.end.wordPos,o),this.render(),this.selectionChanged(),console_log("after styleContentCrossParagraph: "+(null===(n=document.activeElement)||void 0===n?void 0:n.tagName))}}styleSelectedParagraph(e=null,t=null,o=!0){const i=this.selection.getRange();if(i){const r=[...this.paragraphs],s=this.getParagraphByWordId(i.start.wordId),n=this.getParagraphByWordId(i.end.wordId);if(s&&n){const i=this.getParagraphIndex(s),a=this.getParagraphIndex(n);for(let s=i;s<=a;s++){const i=r[s];e&&(r[s]=i.setParagraphStyle(e)),null!==t&&(r[s]=i.setTextStyle({class:t},o))}this.setParagraphs(r),this.render(),this.selectionChanged()}}}styleContentCrossParagraph(e=null,t,o,i,r,s=!0){let n;let a=!1;if(null===e&&(e={},a=!0),i&&t){const l=this.getParagraphByWordId(t),c=this.getParagraphByWordId(i);if(l&&c){const d=[...l.words],h=[...c.words],p=this.getParagraphIndex(l),u=this.getParagraphIndex(c),m=l.getWordIndex(d,t),f=c.getWordIndex(h,i);let g,y;const b=[];for(let e=0;e<p;e++)b.push(this.paragraphs[e]);for(let t=p;t<=u;t++){let i=!1,l=!1;const c=this.paragraphs[t];if(n=t===p?d:t===u?h:[...c.words],t===p?(g=m,i=o>0):(g=0,i=!1),t===u){y=f;const e=n[f];l=!(e instanceof Word)||r!==e.length}else y=n.length-1,l=!1;if(Object.prototype.hasOwnProperty.call(e,"class")||0!==g||y!==n.length-1||i||l){if(a&&!Object.prototype.hasOwnProperty.call(e,"class"))for(const t of Object.keys(e))if(Object.prototype.hasOwnProperty.call(c.textStyle.properties,t)){const e=c.textStyle.properties[t];if(e){for(let o=0;o<n.length;o++){const i=n[o];if(i instanceof Word)for(const o of i.spans)Object.prototype.hasOwnProperty.call(o.textStyle.properties,t)||(o.textStyle.properties[t]=e)}delete c.textStyle.properties[t]}}let i=0,l=0;for(let a=g;a<=y;a++){const c=n[a];c instanceof Word&&(t===u&&a===y&&0===r?console_log("Word not formatted, because start and end are 0."):(i=t===p&&a===g&&o>0?o:0,l=t===u&&a===y&&r>0?r:c.length,n[a]=c.setTextStyle(i,l,e,void 0,s)))}b.push(new Paragraph(c.id,this,n,c.textStyle,c.paragraphStyle))}else{const t=c.setTextStyle(e,s);b.push(t)}}for(let e=u+1;e<this.paragraphs.length;e++)b.push(this.paragraphs[e]);this.setParagraphs(b,false)}}}toString(){const e=[];for(const[t,o]of this.paragraphs.entries())e.push(o.toString()),t<this.paragraphs.length-1&&e.push("\n\n");return e.join("").replace(/ ((\n|\t))/gi,"$2")}toShortString(){return this.paragraphs[0].toString().substr(0,20).replace(/ ((\n|\t))/gi,"$2")}serialize(){return{a:this.paragraphs.map((e=>Paragraph.consilidateStyles(e.serialize())))}}deserialize(e){const t=e.a.map((e=>Paragraph.Deserialize(e,this)));this.setParagraphs(t,!1,!1,!0),this.paragraphsBeforeEdit=this.paragraphs,this.firstParagraph.firstLine?this.selection.setStartByLineWord(this.firstParagraph.firstLine.firstWord,0,0):this.selection.reset(),this.render()}save(e){window.localStorage.setItem("eddi"+e,JSON.stringify(this.serialize()))}load(e){const t=window.localStorage.getItem("eddi"+e);t?this.deserialize(JSON.parse(t)):alert("Can't load data.")}getContextName(){return"Story"}getClipboardData(){const e=this.selection.serialize();return e?{objects:[e.text],context:"PlainText",scopeId:"Wei nicht"}:null}setClipboardData(e){return"PlainText"===e.context&&(this.selection.paste(e.objects[0]),!0)}createItem(){return new Promise(((e,t)=>t()))}removeItem(){return new Promise((e=>{e(this.deleteSelectedContent(!0))}))}selectAll(){return this.selection.setSelectAll(),!0}selectParagraph(e){return this.selection.setSelectParagraph(e),!0}blur(){this.skipBlurOnce?this.skipBlurOnce=!1:(this.selection.reset(),this.selection.input&&this.selection.input.blur(),this.selection.intellisenseActive&&this.selection.hideIntellisense())}canCreateItem(){return!1}}class VariableStates{constructor(){this.states=new Map}addState(e,t,o,i,r){const s=new VariableState(e);return this.states.set(r||"root",s),s.classNames=t,s.formFields=o,s.dataFields=i,s}getState(e){return this.states.get(e||"root")}isUpToDate(e){const t=this.states.get(e||"root");return!!t&&t.isUpToDate(e)}hasFormFields(){for(const e of this.states.values())if(e.formFields.size>0)return!0;return!1}hasDataFields(){for(const e of this.states.values())if(e.dataFields.size>0)return!0;return!1}}class VariableState{constructor(e){this.lastRenderTimeStamp=Date.now(),this.formFields=new Map,this.dataFields=new Map,this.classNames=new Set,this.context=e}isUpToDate(e){let t=scope().currentDoc;if(e){const o=scope().getBox(e);o&&o.box.docRef&&(t=scope().getDocByName(o.box.docRef.documentName)||scope().currentDoc)}for(const[e,t]of this.formFields){const o=e.split("#");if(scope().getFormFieldValue(o[0],o[1]||null)!==t)return console_log(">>>>>>>>>  "+this.context+" is not up to date, form."+e+" has changed."),!1}if(this.classNames.size){const o=scope().resourcesStylesUi.getGlobalStyle().getStyleTimeStampByClass(this.classNames);if("no-class"!==o){if("outdated"===o){const e=" ["+Array.from(this.classNames).join(" ")+"]";return console_log(">>>>>>>>> "+this.context+e+" is not up to date, global class is outdated"),!1}if(this.lastRenderTimeStamp<o){const e=" ["+Array.from(this.classNames).join(" ")+"]";return console_log(">>>>>>>>>  "+this.context+e+" is not up to date, global class is more current: "+(o-this.lastRenderTimeStamp)/1e3+"s"),!1}}const i=t.getStyleTimeStampByClass(this.classNames,e);if("no-class"!==i){if("outdated"===i){const e=" ["+Array.from(this.classNames).join(" ")+"]";return console_log(">>>>>>>>> "+this.context+e+" is not up to date, local class is outdated"),!1}if(this.lastRenderTimeStamp<i){const e=" ["+Array.from(this.classNames).join(" ")+"]";return console_log(">>>>>>>>>  "+this.context+e+" is not up to date, local class is more current: "+(i-this.lastRenderTimeStamp)/1e3+"s"),!1}}}return!0}}class Story extends NobsBase{constructor(e,t,o){if(super(e,t),this.hasBeenRendered=new Map,this.framesHash=new Map,this.svgCache=new Map,this.hasOverflow=!1,this.myBoxes=new Map,this.url="","string"==typeof e&&"string"==typeof t){const e=new Eddi(scope().eddiConfig,t,null,[null],[null],"preview",void 0,o?[o]:void 0);this.serializedText=e.serialize(),this.shortText=t.substr(0,20)}else if(!(e instanceof Nobs)){const o=t;this.serializedText=o.txt,this.shortText=o.sho,this.hyphenationLanguage=o.hy||"off",this.id=e}this.serializedText||(this.serializedText=Story.anyStory().serializedText),this.shortText||(this.shortText=""),void 0===this.hyphenationLanguage&&(this.hyphenationLanguage="off"),void 0===this.id&&(this.id=generateDBID()),this.variableStates=new VariableStates}isUpToDate(){return this.variableStates.isUpToDate()}hasFormFields(){return this.variableStates.hasFormFields()||this.variableStates.hasDataFields()}static getAllClassNames(e){const t=new Set;if(e.a)for(const o of e.a)if(o.s&&o.s.c&&o.s.c.split(" ").forEach((e=>{t.add(e)})),o.w)for(const e of o.w)if("string"!=typeof e&&e.s)for(const o of e.s)o.s&&o.s.c&&o.s.c.split(" ").forEach((e=>t.add(e)));return t}getFirstParagraphTextStyle(){if(this.serializedText.a.length>0){const e=this.serializedText.a[0];if(e.s)return TextStyle.deserialize(e.s)}return new TextStyle}getFirstParagraphParagraphStyle(){if(this.serializedText.a.length>0){const e=this.serializedText.a[0];if(e.p)return ParagraphStyle.deserialize(e.p)}return new ParagraphStyle}getCacheKey(e,t){return t?t+"_"+e:e}getSvg(e,t,o="standard"){console_log("GET-SVG Called for box"+e),this.render(t,o);const i=this.getCacheKey(e,t),r=this.svgCache.get(i);if(scope().eddiActiveStory===this){const t=scope().eddiGetFrameByBoxId(e);return t?t.svg:"ILLEGAL REDRAW, EDDI HAS NO CONTENT"}return this.pushCacheToWcBoxes(e,t),r?r.svg:"loading ..."}pushCacheToWcBoxes(e="",t=null){const o=this.getWcBoxes(t);for(const i of o)if(i.box.id!==e){const e=this.getCacheKey(i.box.id,t),r=this.svgCache.get(e);r&&(i.replaceStoryTextSvg(r.svg),o.length>1?i.storyFlowIndex=r.index:i.storyFlowIndex=0)}}getEddiFrameInfos(e=null){var t,o,i,r;const s=[],n=[],a=[];let l="";l="off"!==this.hyphenationLanguage&&getHyphenationPattern(this.hyphenationLanguage)?this.hyphenationLanguage+"|":"|";const c=this.getBoxes(e);let d=null,h="top";if(e){const t=scope().getBox(e);if(t){const e=t.box.boxGeometry.toPixel(t.spread.width(),t.spread.height());l+="|"+ +e.width.toFixed(2)+"|"+e.height.toFixed(2)+"|",t.box.docRef&&(l+=Array.from(t.box.docRef.formFieldValues.values()).join("|"))}}for(const e of c.values())if(e){const p=e.box.storyRef;if(1===c.size&&p){"off"!==p.autoTextMode||p.useBaselineGrid||(h=e.box.getValue("storyRef","verticalStoryTextAlign")||"top");const t=e.spread.height(),o=e.spread.width();d={autoTextMode:p.autoTextMode,minWidth:e.box.getValue("storyRef","minWidth").toPixel(o,t),maxWidth:e.box.getValue("storyRef","maxWidth").toPixel(o,t),minHeight:e.box.getValue("storyRef","minHeight").toPixel(t,o),maxHeight:Math.min(e.spread.height(),e.box.getValue("storyRef","maxHeight").toPixel(t,o))}}const u=e.box.boxGeometry.includeStyle(e.box.basics.class,e.box.autoSizeMode).toPixel(e.spread.width(),e.spread.height()),m=e.box.basics.paddingLeft.toPixel(u.width,u.height),f=e.box.basics.paddingTop.toPixel(u.width,u.height),g=e.box.basics.paddingRight.toPixel(u.width,u.height),y=e.box.basics.paddingBottom.toPixel(u.width,u.height),b=e.doc.baselineHeight.toPixel(e.doc.pageHeight,e.doc.pageWidth),v=e.doc.baselineTop.toPixel(e.doc.pageHeight,e.doc.pageWidth);l+="|"+e.box.id+"|"+e.box.basics.class+"|"+u.left.toFixed(2)+"|"+u.top.toFixed(2)+"|"+u.width.toFixed(2)+"|"+u.height.toFixed(2)+"|"+m.toFixed(2)+"|"+f.toFixed(2)+"|"+g.toFixed(2)+"|"+y.toFixed(2)+"|";let x=0;p&&e.box.hasActiveFeature("pathGeometry")&&(x=e.box.getValue("storyRef","wrapShapeOffset").toPixel_1Axis(e.spread.width()));const w=e.box.getValue("storyRef","wrapAscenderDiminisher"),_=e.box.storyRef;_&&(l+="|"+_.autoTextMode+"|"+_.wrapShapeOffset+"|"+w+"|"+_.minWidth+"|"+_.maxWidth+"|"+_.minHeight+"|"+_.maxHeight+"|"+_.verticalStoryTextAlign+"|"+_.useBaselineGrid+"|"+v+"|"+b+"|"+_.firstBaseline);const S=e.box.pathGeometry&&e.box.pathGeometry.wrapTextInShape&&e.box.pathGeometry.closed?e.box.pathGeometry.getNormalLinePointList():null;S&&(h="top",l+=S.reduce(((e,t)=>e+t.x.toFixed(2)+"|"+t.y.toFixed(2)+"|"),"")),n.push(S);const P=this.getWrapPaths(e);if(a.push(P),P)for(const e of P)l+=e.left.toFixed(2)+"|"+e.top.toFixed(2)+"|"+e.width.toFixed(2)+"|"+e.height.toFixed(2)+"|"+e.mode+"|"+e.wrapObjectOffset+"|"+e.points.reduce(((e,t)=>e+t.x.toFixed(2)+"|"+t.y.toFixed(2)+"|"),"");s.push({width:u.width,height:u.height,top:u.top,left:u.left,paddingLeft:m,paddingRight:g,paddingTop:f,paddingBottom:y,verticalAlign:h,spreadTop:e.spread.top(),rotation:e.box.boxGeometry.rotation,spreadLeft:e.spread.left(),boxId:e.box.id,getWcBox:e=>scope().docUi.getWcBox(e),wrapShapeOffset:x,wrapAscenderDiminisher:w,name:e.box.jsName||"ID="+e.box.id,classes:e.box.basics.class,useBaseLineGrid:null!==(o=null===(t=e.box.storyRef)||void 0===t?void 0:t.useBaselineGrid)&&void 0!==o&&o,firstBaseline:null!==(r=null===(i=e.box.storyRef)||void 0===i?void 0:i.firstBaseline)&&void 0!==r?r:"ascender",baselineHeight:b,baselineTop:v})}return{boxDimensions:s,paths:n,hash:l,wrapPaths:a,autoTextFrameSettings:d}}getWrapPaths(e){const t=[],o=e.spread,i=e.box.boxGeometry.includeStyle(e.box.basics.class,e.box.autoSizeMode).toPixel(o.width(),o.height());for(const r of o.boxes.values())if("wrap around both sides"===r.basics.textWrapMode&&r!==e.box){const s=r.boxGeometry.includeStyle(r.basics.class,r.autoSizeMode).toPixel(o.width(),o.height());if(s.hasOverlap(i)){let o,i=0;if(r.pathGeometry?(o=r.pathGeometry.getNormalLinePointListInSpreadDimensions(s.left,s.top,s.width,s.height),i=r.getValue("basics","wrapObjectOffset").toPixel_1Axis(e.spread.width())):o=[{x:s.left,y:s.top},{x:s.left+s.width,y:s.top},{x:s.left+s.width,y:s.top+s.height},{x:s.left,y:s.top+s.height}],r.boxGeometry.rotation){const e=new Polygon(o).rotate(r.boxGeometry.rotation),n=e.getBoundingBox();t.push({mode:r.basics.textWrapMode,points:e.points,left:s.left,top:s.top,width:n.width,height:n.height,wrapObjectOffset:i})}else t.push({mode:r.basics.textWrapMode,points:o,left:s.left,top:s.top,width:s.width,height:s.height,wrapObjectOffset:i})}}return t.length?t:null}isOnCurrentSpread(e){for(const t of this.getBoxes(e).values())if(!e&&t.doc.id!==scope().currentDoc.id)return!1;return!0}resetStoryCache(){this.framesHash=new Map,this.svgCache=new Map}render(e,t="standard"){if(!scope().fontsLoaded)return!1;if(scope().eddiActiveStory===this)return!1;if(!this.isOnCurrentSpread(e)&&"standard"===t)return!1;const o=this.getEddiFrameInfos(e);if(0===o.boxDimensions.length)return!1;if(!this.variableStates.isUpToDate(e||void 0)||o.hash!==this.framesHash.get(e||"")){console_log("Story hash changed!");const t=o.autoTextFrameSettings,i=this.serializedText,r=new Eddi(scope().eddiConfig,i,o.boxDimensions,o.paths,o.wrapPaths,"preview",t,void 0,void 0,e,this.hyphenationLanguage);for(const e of o.boxDimensions)for(const t of e.classes.split(" "))t&&r.classNames.add(t);if(this.hasOverflow=r.hasOverflow,this.variableStates.addState("story",r.classNames,r.formFields,r.dataFields,e||void 0),this.framesHash.set(e||"",this.getEddiFrameInfos(e).hash),e)for(const t of this.svgCache.keys())t.indexOf(e)>=0&&this.svgCache.delete(t);else for(const e of this.svgCache.keys())e.indexOf("_")<0&&this.svgCache.delete(e);for(const t of o.boxDimensions){const o=r.getFrameByBoxId(t.boxId);if(o){const i=this.getCacheKey(t.boxId,e);this.svgCache.set(i,{svg:o.svg,index:o.index+1})}}}return!0}getWcBoxes(e=null){return scope().docUi.getWcBoxesWithStory(this.id,e)}getMaxOrder(){const e=Array.from(this.getBoxes().values());if(e.length>0){const t=e[e.length-1];if(t.box.storyRef)return t.box.storyRef.order}return 0}getBoxes(e=null){var t,o;if(!e)return this.myBoxes;const i=new Map,r=scope().getBox(e);if(r){const e=scope().getDocByName(null!==(o=null===(t=r.box.docRef)||void 0===t?void 0:t.documentName)&&void 0!==o?o:"");if(e){for(const t of e.spreads.values())for(const o of t.boxes.values())i.has(o.id)||o.storyRef&&o.storyRef.storyId===this.id&&i.set(o.id,{doc:e,spread:t,box:o});return new Map(new Map(Array.from(i.values()).sort(((e,t)=>e.box.storyRef&&t.box.storyRef?e.box.storyRef.order-t.box.storyRef.order:0)).map((e=>[e.box.id,e]))))}}return i}boxHasOverflowIcon(e){if(this.hasOverflow){const t=this.getBoxes();if(t.has(e)&&t.size>0&&Array.from(t.keys())[t.size-1]===e)return!0}return!1}boxHasTextInIcon(e){const t=this.getBoxes();return!(!t.has(e)||t.keys().next().value===e)}boxHasTextOutIcon(e){const t=this.getBoxes();return!!(t.has(e)&&t.size>0&&Array.from(t.keys())[t.size-1]!==e)}getBoxFlowIndex(e){const t=this.getBoxes();let o=0;if(t.size>1)for(const i of t.keys()){if(i===e)return""+(o+1);o++}return""}getNewOrder(e){let t=0,o=1;const i=[];for(const e of this.getBoxes().values())e.box.storyRef&&i.push({id:e.box.id,order:e.box.storyRef.order});let r=!1;if(e&&"start"!==e)for(let s=0;s<i.length;s++){const n=i[s];if(n.id===e&&(r=!0),r&&(n.order>0||s<i.length-1&&i[s+1].order>0)){s<i.length-1&&(o=i[s+1].order),t=n.order;break}}else{o=.001;for(const e of i)if(e.order>0){o=e.order;break}}return getOrder(t,o)}canEdit(){return!1}canRemove(){return!0}canMove(){return!0}toText(){const e=new Eddi(scope().eddiConfig,"",null,[null],[null],"preview");e.deserialize(this.serializedText),e.selectAll();const t=e.getClipboardData();if(t&&t.objects&&t.objects.length){return t.objects[0].replace(/\n\n/g,"\n")}return""}toStoryContent(e){const t=new Eddi(scope().eddiConfig,"",null,[null],[null],"preview");t.deserialize(this.serializedText);const o=[];let i=null,r=[];const s=this.getWcBoxes();s.length&&(r=s[0].box.lock.allowText);let n=scope().currentDoc.splitMultilineToParagraphs;n&&!config.splitMultilineToParagraphs&&(n=!1);for(const s of t.paragraphs){const t={text:s.toString(),textStyleProps:s.textStyle.properties,paragraphStyleProps:s.paragraphStyle.properties,pSpan:1,externalTextStyle:{color:s.textStyle.getCssColor(s),font:s.textStyle.getFont(s).name,hAlign:s.paragraphStyle.getParagraphStyleProperty(s,"horizontalTextAlign"),vAlign:e,size:s.textStyle.getFontSizeAslength(s).toString(),allows:r},externalFontColorRef:s.textStyle.getColorRef(s)};i&&!n?i.text+="\n\n"+t.text:i&&this.stringifyStyle(i.paragraphStyleProps)===this.stringifyStyle(t.paragraphStyleProps)&&this.stringifyStyle(i.textStyleProps)===this.stringifyStyle(t.textStyleProps)?(i.text+="\n\n"+t.text,i.pSpan++):(o.push(t),i=t)}return 0===o.length&&o.push({text:"",paragraphStyleProps:{},textStyleProps:{},pSpan:1,externalTextStyle:{color:baseTextStyleProps().fontColor.color.toRgbHexColor(),font:baseTextStyleProps().font.font.name,hAlign:baseParagraphStyleProps().horizontalTextAlign,vAlign:e,size:baseTextStyleProps().fontSize.toString(),allows:r},externalFontColorRef:baseTextStyleProps().fontColor}),{pts:o}}stringifyStyle(e){return JSON.stringify(e,(function(e,t){return"fontColor"===e&&t?t.color:"id"===e?null:t}))}fromText(e){const t=this.getFirstParagraphParagraphStyle(),o=this.getFirstParagraphTextStyle(),i=new Eddi(scope().eddiConfig,e,null,[null],[null],"preview",null,o?[o]:void 0,t?[t]:void 0),r=(new Nobs).setProperty(this,"serializedText",i.serialize());return new Story(r,this)}fromParagraphTextsAndStyles(e){const t=[],o=[],i=[];for(const r of e){const e=r.text.split(/\n\n/);for(const s of e)t.push(s),o.push(new TextStyle(r.textStyleProps)),i.push(new ParagraphStyle(r.paragraphStyleProps))}const r=new Eddi(scope().eddiConfig,t.join("\n\n"),null,[null],[null],"preview",null,o,i),s=(new Nobs).setProperty(this,"serializedText",r.serialize());return new Story(s,this)}setParagraphTextStyle(e,t=-1){const o=new Eddi(scope().eddiConfig,"",null,[null],[null],"preview");o.deserialize(this.serializedText);const i=t>=0?o.paragraphs[t]:null;i?o.selectParagraph(i):o.selectAll(),o.styleSelectedContent(e);const r=(new Nobs).setProperty(this,"serializedText",o.serialize());return new Story(r,this)}setParagraphStyle(e,t=-1){const o=new Eddi(scope().eddiConfig,"",null,[null],[null],"preview");o.deserialize(this.serializedText);const i=t>=0?o.paragraphs[t]:null;i?o.selectParagraph(i):o.selectAll(),o.styleSelectedParagraph(e);const r=(new Nobs).setProperty(this,"serializedText",o.serialize());return new Story(r,this)}setParagraphTextStyleColorKeepTintOpacityHSL(e,t=-1){const o=new Eddi(scope().eddiConfig,"",null,[null],[null],"preview");o.deserialize(this.serializedText);const i=t>=0?o.paragraphs[t]:null;let r=null;i?(o.selectParagraph(i),r=i.textStyle.getColorRef(i)):(o.selectAll(),r=o.firstParagraph.textStyle.getColorRef(o.firstParagraph));let s=new ColorRef(e);r&&(s=new ColorRef(e,r.tint,r.opacity,r.modifier)),o.styleSelectedContent({fontColor:s});const n=(new Nobs).setProperty(this,"serializedText",o.serialize());return new Story(n,this)}serialize(e=!1){return{type:"story",id:e?generateDBID():this.id,scopeId:scope().id,parentId:scope().id,data:{txt:this.serializedText,sho:this.shortText,hy:this.hyphenationLanguage}}}static anyStory(){return new Story(generateDBID(),"One morning, when Gregor Samsa woke from troubled dreams, he found himself transformed in his bed into a horrible vermin. He lay on his armour-like back, and if he lifted his head a little he could see his brown belly, slightly domed and divided by arches into stiff sections.\n\nThe bedding was hardly able to cover it and seemed ready to slide off any moment. His many legs, pitifully thin compared with the size of the rest of him, waved about helplessly as he looked. \"What's happened to me?\" he thought. It wasn't a dream. His room, a proper human room although a little too small, lay peacefully between its four familiar walls. A collection of textile samples lay spread out on the table - Samsa was a travelling salesman - and above it there hung a picture that he had recently cut out of an illustrated magazine and housed in a nice, gilded frame. \n\nIt showed a lady fitted out with a fur hat and fur boa who sat upright, raising a heavy fur muff that covered the whole of her lower arm towards the viewer. Gregor then turned to look out the window at the dull weather. Drops of rain could be heard hitting the pane, which made him feel quite sad. \"How about if I sleep a little bit longer and forget all this nonsense\", he thought, but that was something he was unable to do because he was used to sleeping on his right, and in his present state couldn't get into that position. However hard he threw himself onto his right, he always rolled back to where he was. He must have tried it a hundred times, shut his eyes so that he wouldn't have to look at the floundering legs, and only stopped when he began to feel a mild, dull pain there that he had never felt before. \"Oh, God\", he thought, \"what a strenuous career it is that I've chosen! \n\nTravelling day in and day out. Doing business like this takes much more effort than doing your own business at home, and on top of that there's the curse of travelling, worries about making train connections, bad and irregular food, contact with different people all the time so that you can never get to know anyone or become friendly with them. It can all go to Hell!\" He felt a slight itch up on his belly; pushed himself slowly up on his back towards the headboard so that he could lift his head better; found where the itch was, and saw that it was covered with lots of little white spots which he didn't know what to make of; and when he tried to feel the place with one of his legs he drew it quickly back because as soon as he touched it he was overcome by a cold shudder. He slid back into his former position. \"Getting up early all the time\", he thought, \"it makes you stupid. You've got to get enough sleep. \n\nOther travelling salesmen live a life of luxury. For instance, whenever I go back to the guest house during the morning to copy out the contract, these gentlemen are always still sitting there eating their breakfasts. I ought to just try that with my boss; I'd get kicked out on the spot. But who knows, maybe that would be the best thing for me. If I didn't have my parents to think about I'd have given in my notice a long time ago, I'd have gone up to the boss and told him just what I think, tell him everything I would, let him know just what I feel. He'd fall right off his desk! And it's a funny sort of business to be sitting up there at your desk, talking down at your subordinates from up there, especially when you have to go right up close because the boss is hard of hearing. Well, there's still some hope; once I've got the money together to pay off my parents' debt to him - another five or six years I suppose - that's definitely what I'll do. That's when I'll make the big change. First of all though, I've got to get up, my train leaves at five.\"\n\nAnd he looked over at the alarm clock, ticking on the chest of drawers. \"God in Heaven!\" he thought. It was half past six and the hands were quietly moving forwards, it was even later than half past, more like quarter to seven. Had the alarm clock not rung? He could see from the bed that it had been set for four o'clock as it should have been; it certainly must have rung. Yes, but was it possible to quietly sleep through that furniture-rattling noise? True, he had not slept peacefully, but probably all the more deeply because of that. What should he do now? The next train went at seven; if he were to catch that he would have to rush like mad and the collection of samples was still not packed, and he did not at all feel particularly fresh and lively. And even if he did catch the train he would not avoid his boss's anger as the office assistant would have been there to see the five o'clock train go, he would have put in his report about Gregor's not being there a long time ago. The office assistant was the boss's man, spineless, and with no understanding. What about if he reported sick? But that would be extremely strained and suspicious as in fifteen years of service Gregor had never once yet been ill. \n\nHis boss would certainly come round with the doctor from the medical insurance company, accuse his parents of having a lazy son, and accept the doctor's recommendation not to make any claim as the doctor believed that no-one was ever ill but that many were workshy. And what's more, would he have been entirely wrong in this case? Gregor")}hasColorName(e){return replaceAllColorNames(this.serialize(),"???",e)}}class Lock extends NobsBase{constructor(e,t){var o,i,r,s,n,a,l,c,d,h,p,u,m,f,g,y,b,v;if(super(e,t),!(e instanceof Nobs)){let t={};"object"==typeof e&&(t=e),this.hasZoomAction=t.zoom||!1,this.zoomActionOrderNo=t.zor||"none",this.boundToBoxSelection=t.boxor||"none",this.hasClickAction=t.click||!1,this.isUiElement=t.ui||!1,this.clickActionFormFieldName=t.ffna||"",this.clickActionFormFieldValue=t.ffva||"",this.textFieldCaption=t.txca||"",this.buyerOrderNo=t.bor||"none",this.allowFontGroups=t.fgr||["Buyer Fonts"],this.allowImageGroups=t.igr||["Buyer Upload"],this.allowColorGroups=t.cgr||["Buyer Colors"],this.allowImageFilters=[],this.allowAdd=null!==(i=null===(o=t.allows)||void 0===o?void 0:o.allowAdd)&&void 0!==i?i:[],this.allowFrame=null!==(s=null===(r=t.allows)||void 0===r?void 0:r.allowFrame)&&void 0!==s?s:[],this.allowImage=null!==(a=null===(n=t.allows)||void 0===n?void 0:n.allowImage)&&void 0!==a?a:[];const x=this.allowImage.indexOf("pick");x>=0&&(this.allowImage.splice(x,1),this.allowImage.indexOf("content")<0&&this.allowImage.push("content")),this.allowShape=null!==(c=null===(l=t.allows)||void 0===l?void 0:l.allowShape)&&void 0!==c?c:[],this.allowText=null!==(h=null===(d=t.allows)||void 0===d?void 0:d.allowText)&&void 0!==h?h:[],this.allowPathText=null!==(u=null===(p=t.allows)||void 0===p?void 0:p.allowPathText)&&void 0!==u?u:[],this.allowSubDocument=null!==(f=null===(m=t.allows)||void 0===m?void 0:m.allowSubDocument)&&void 0!==f?f:[],this.allowTransform=null!==(y=null===(g=t.allows)||void 0===g?void 0:g.allowTransform)&&void 0!==y?y:[],this.allowEffect=null!==(v=null===(b=t.allows)||void 0===b?void 0:b.allowEffect)&&void 0!==v?v:[]}}hasImageUpload(){return!config.isBuyer&&!config.isMobile||(this.allowImage.indexOf("content")>=0&&this.allowImageGroups.indexOf("Buyer Upload"),!1)}hasImagePlacement(){return!config.isBuyer&&!config.isMobile||(!!this.hasImageUpload()||this.allowImage.indexOf("placement")>=0)}hasOnlyTextContentAllow(){let e=0;for(const t of enums.allAllowEnums)this[t].length&&"allowFontGroups"!==t&&"allowImageGroups"!==t&&"allowColorGroups"!==t&&e++;return 1===e&&this.allowText.indexOf("content")>=0}hasOnlyTextAllows(){let e=0,t=!1;for(const o of enums.allAllowEnums)"allowText"===o?t=this[o].length>0:this[o].length&&"allowFontGroups"!==o&&"allowImageGroups"!==o&&"allowColorGroups"!==o&&e++;return!(0!==e||!t)}hasChangeTextContentAllow(){return this.allowText.indexOf("content")>=0||this.allowPathText.indexOf("content")>=0}hasOnlyStoryColorAllow(){return this.allowText.indexOf("color")>=0&&-1===this.allowText.indexOf("size")&&-1===this.allowText.indexOf("font")&&-1===this.allowText.indexOf("horizontalAlignment")&&-1===this.allowText.indexOf("verticalAlignment")}hasChangeColorAllow(){return this.allowText.indexOf("color")>=0||this.allowPathText.indexOf("color")>=0||this.allowShape.indexOf("color")>=0}hasChangeImageAllow(){return this.allowImage.indexOf("content")>=0}hasChangePositionAllow(){return this.allowFrame.indexOf("positionByMouse")>=0}get isClickableUi(){return this.hasClickAction||this.hasZoomAction&&"none"!==this.zoomActionOrderNo}hasFrameAllows(e,t=!1){if(t){if(this.isUiElement&&this.isClickableUi)return!0}else{if(this.isUiElement)return!1;for(const t of enums.allAllowEnums)if(this[t].length)if("allowColorGroups"===t&&1===this[t].length&&"Buyer Colors"===this[t][0]);else if("allowFontGroups"===t&&1===this[t].length&&"Buyer Fonts"===this[t][0]);else if("allowImageGroups"===t&&1===this[t].length&&"Buyer Upload"===this[t][0]);else if("allowImage"!==t||e.imageRef)if("allowText"!==t||e.storyRef||e.simpleText)if("allowShape"!==t||e.pathGeometry){if("allowPathText"!==t||e.pathText)return!0}else;else;else;}return!1}hasDocAllows(){return this.allowAdd.length>0}allows(e,t){return this[e].indexOf(t)>=0}static getfeatureByAllow(e){switch(e){case"allowAdd":case"allowImageGroups":case"allowFontGroups":case"allowColorGroups":case"allowImageFilters":throw new Error("Cant get feature for allow 'add' or 'groups'");case"allowFrame":return"boxGeometry";case"allowImage":return"imageRef";case"allowPathText":return"pathText";case"allowShape":return"pathGeometry";case"allowText":return"simpleText";case"allowEffect":return"effect";case"allowTransform":return"transform";case"allowSubDocument":return"docRef";default:assertNever$1(e)}}serialize(){return{fgr:this.allowFontGroups,igr:this.allowImageGroups,cgr:this.allowColorGroups,allows:{allowAdd:this.allowAdd,allowFrame:this.allowFrame,allowImage:this.allowImage,allowText:this.allowText,allowPathText:this.allowPathText,allowSubDocument:this.allowSubDocument,allowShape:this.allowShape,allowTransform:this.allowTransform,allowEffect:this.allowEffect},click:this.hasClickAction,ui:this.isUiElement,ffna:this.clickActionFormFieldName,ffva:this.clickActionFormFieldValue,txca:this.textFieldCaption,bor:this.buyerOrderNo,zoom:this.hasZoomAction,zor:this.zoomActionOrderNo,boxor:this.boundToBoxSelection}}}var __decorate$5=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n};function getIcon(e){switch(e){case"docRef":return'<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg"   viewBox="50 50 412 412"   xml:space="preserve"><g>    <polygon points="272,160 352,160 352,240 384,240 384,128 272,128 \t"/><polygon points="160,240 160,160 240,160 240,128 128,128 128,240 \t"/>  <polygon points="240,352 160,352 160,272 128,272 128,384 240,384 \t"/>    <polygon points="352,272 352,352 272,352 272,384 384,384 384,272 \t"/></g></svg>';case"image":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M464 64H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V112c0-26.51-21.49-48-48-48zm16 336c0 8.822-7.178 16-16 16H48c-8.822 0-16-7.178-16-16V112c0-8.822 7.178-16 16-16h416c8.822 0 16 7.178 16 16v288zM112 232c30.928 0 56-25.072 56-56s-25.072-56-56-56-56 25.072-56 56 25.072 56 56 56zm0-80c13.234 0 24 10.766 24 24s-10.766 24-24 24-24-10.766-24-24 10.766-24 24-24zm207.029 23.029L224 270.059l-31.029-31.029c-9.373-9.373-24.569-9.373-33.941 0l-88 88A23.998 23.998 0 0 0 64 344v28c0 6.627 5.373 12 12 12h360c6.627 0 12-5.373 12-12v-92c0-6.365-2.529-12.47-7.029-16.971l-88-88c-9.373-9.372-24.569-9.372-33.942 0zM416 352H96v-4.686l80-80 48 48 112-112 80 80V352z"/></svg>';case"bezier":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path  d="M576 176c35.35 0 64-28.65 64-64s-28.65-64-64-64c-29.79 0-54.6 20.44-61.74 48H400V64c0-17.67-14.33-32-32-32h-96c-17.67 0-32 14.33-32 32v32H125.74C118.6 68.44 93.79 48 64 48 28.65 48 0 76.65 0 112s28.65 64 64 64c29.79 0 54.6-20.44 61.74-48h112.81c-80.61 31.51-135.13 105.79-141.27 192H64c-17.67 0-32 14.33-32 32v96c0 17.67 14.33 32 32 32h96c17.67 0 32-14.33 32-32v-96c0-17.67-14.33-32-32-32h-30.73c5.76-69.41 48.06-129.54 111.08-158.25.96 16.81 14.6 30.25 31.65 30.25h96c17.05 0 30.69-13.44 31.65-30.25 63.02 28.72 105.32 88.84 111.08 158.25H480c-17.67 0-32 14.33-32 32v96c0 17.67 14.33 32 32 32h96c17.67 0 32-14.33 32-32v-96c0-17.67-14.33-32-32-32h-33.27c-6.13-86.21-60.66-160.49-141.27-192h112.81c7.13 27.56 31.94 48 61.73 48zM160 448H64v-96h96v96zM64 144c-17.64 0-32-14.36-32-32s14.36-32 32-32 32 14.36 32 32-14.36 32-32 32zm304 16h-96V64h96v96zm208 288h-96v-96h96v96zm0-368c17.64 0 32 14.36 32 32s-14.36 32-32 32-32-14.36-32-32 14.36-32 32-32z"/></svg>';case"pathText":return'<svg   xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">\t<path  d="M61.78,19.86l-3.6,5.15c-0.36,0.52-1.07,0.64-1.59,0.28l-1.87-1.31c-0.52-0.36-0.64-1.07-0.28-1.59l2.29-3.28\t\tl-6.68-4.66L36.96,33.19l2.69,1.88c0.52,0.36,0.64,1.07,0.28,1.59l-1.31,1.87c-0.36,0.52-1.07,0.64-1.59,0.28l-9.13-6.38\t\tc-0.52-0.36-0.64-1.07-0.28-1.59l1.31-1.87c0.36-0.52,1.07-0.64,1.59-0.28l2.69,1.88L46.3,11.84l-6.68-4.66l-2.29,3.28\t\tc-0.36,0.52-1.07,0.64-1.59,0.28l-1.87-1.31c-0.52-0.36-0.64-1.07-0.28-1.59l3.6-5.15c0.72-1.03,2.15-1.29,3.18-0.56l20.85,14.56\t\tC62.25,17.4,62.5,18.83,61.78,19.86z"/>\t<path   d="M43.23,61.54c-0.9,0-1.75-0.54-2.11-1.42C39.48,56.1,35.49,48.5,27.18,42.8c-8.77-6.01-17.75-6.78-22.34-6.76\t\tc-0.01,0-0.02,0-0.03,0c-1.24,0-2.26-1-2.27-2.25c-0.02-1.26,0.99-2.29,2.25-2.3c5.11-0.06,15.17,0.84,24.97,7.55\t\tc9.3,6.37,13.76,14.87,15.59,19.37c0.47,1.16-0.09,2.49-1.25,2.96C43.81,61.49,43.52,61.54,43.23,61.54z"/> </svg>';case"text":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path  d="M448 48v72a8 8 0 0 1-8 8h-16a8 8 0 0 1-8-8V64H240v384h72a8 8 0 0 1 8 8v16a8 8 0 0 1-8 8H136a8 8 0 0 1-8-8v-16a8 8 0 0 1 8-8h72V64H32v56a8 8 0 0 1-8 8H8a8 8 0 0 1-8-8V48a16 16 0 0 1 16-16h416a16 16 0 0 1 16 16z"/></svg>';case"magnet":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M372 32c-19.9 0-36 16.1-36 36v172c0 64-40 96-79.9 96-40 0-80.1-32-80.1-96V68c0-19.9-16.1-36-36-36H36.4C16.4 32 .2 48.3.4 68.4c.3 24.5.6 58.4.7 91.6H0v32h1.1C1 218.3.7 242 0 257.3 0 408 136.2 504 256.8 504 377.5 504 512 408 512 257.3V68c0-19.9-16.1-36-36-36H372zM36.5 68H140v92H37.1c-.1-33.4-.4-67.4-.6-92zM476 258.1c-.1 30.4-6.6 59.3-19.4 85.8-11.9 24.9-29 47.2-50.8 66.3-20.6 18.1-45.2 32.9-71.2 42.9-25.5 9.8-52.4 15-77.9 15-25.5 0-52.5-5.2-78.2-15-26.2-10-51-24.9-71.8-43-22-19.2-39.2-41.5-51.3-66.3-12.9-26.5-19.4-55.3-19.6-85.6.7-15.9 1-39.7 1.1-66.1H140v48c0 49.2 18.9 79.7 34.8 96.6 10.8 11.5 23.5 20.4 37.8 26.5 13.8 5.9 28.5 8.9 43.5 8.9s29.7-3 43.5-8.9c14.3-6.1 27-15 37.7-26.5 15.8-16.9 34.7-47.4 34.7-96.6v-48h102.9c.1 26.2.4 50.1 1.1 66zM372 160V68h103.5c-.3 24.6-.6 58.6-.6 92H372z"/></svg>';case"pointer":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path d="M154.149 488.438l-41.915-101.865-46.788 52.8C42.432 465.345 0 448.788 0 413.5V38.561c0-34.714 41.401-51.675 64.794-26.59L309.547 274.41c22.697 24.335 6.074 65.09-27.195 65.09h-65.71l42.809 104.037c8.149 19.807-1.035 42.511-20.474 50.61l-36 15.001c-19.036 7.928-40.808-1.217-48.828-20.71zm-31.84-161.482l61.435 149.307c1.182 2.877 4.117 4.518 6.926 3.347l35.999-15c3.114-1.298 4.604-5.455 3.188-8.896L168.872 307.5h113.479c5.009 0 7.62-7.16 3.793-11.266L41.392 33.795C37.785 29.932 32 32.879 32 38.561V413.5c0 5.775 5.935 8.67 9.497 4.65l80.812-91.194z"/></svg>';case"collapseLeft":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path d="M153.1 247.5l117.8-116c4.7-4.7 12.3-4.7 17 0l7.1 7.1c4.7 4.7 4.7 12.3 0 17L192.7 256l102.2 100.4c4.7 4.7 4.7 12.3 0 17l-7.1 7.1c-4.7 4.7-12.3 4.7-17 0L153 264.5c-4.6-4.7-4.6-12.3.1-17zm-128 17l117.8 116c4.7 4.7 12.3 4.7 17 0l7.1-7.1c4.7-4.7 4.7-12.3 0-17L64.7 256l102.2-100.4c4.7-4.7 4.7-12.3 0-17l-7.1-7.1c-4.7-4.7-12.3-4.7-17 0L25 247.5c-4.6 4.7-4.6 12.3.1 17z"/></svg>';case"expandLeft":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path d="M166.9 264.5l-117.8 116c-4.7 4.7-12.3 4.7-17 0l-7.1-7.1c-4.7-4.7-4.7-12.3 0-17L127.3 256 25.1 155.6c-4.7-4.7-4.7-12.3 0-17l7.1-7.1c4.7-4.7 12.3-4.7 17 0l117.8 116c4.6 4.7 4.6 12.3-.1 17zm128-17l-117.8-116c-4.7-4.7-12.3-4.7-17 0l-7.1 7.1c-4.7 4.7-4.7 12.3 0 17L255.3 256 153.1 356.4c-4.7 4.7-4.7 12.3 0 17l7.1 7.1c4.7 4.7 12.3 4.7 17 0l117.8-116c4.6-4.7 4.6-12.3-.1-17z"/></svg>';case"edit":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M417.8 315.5l20-20c3.8-3.8 10.2-1.1 10.2 4.2V464c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h292.3c5.3 0 8 6.5 4.2 10.2l-20 20c-1.1 1.1-2.7 1.8-4.2 1.8H48c-8.8 0-16 7.2-16 16v352c0 8.8 7.2 16 16 16h352c8.8 0 16-7.2 16-16V319.7c0-1.6.6-3.1 1.8-4.2zm145.9-191.2L251.2 436.8l-99.9 11.1c-13.4 1.5-24.7-9.8-23.2-23.2l11.1-99.9L451.7 12.3c16.4-16.4 43-16.4 59.4 0l52.6 52.6c16.4 16.4 16.4 43 0 59.4zm-93.6 48.4L403.4 106 169.8 339.5l-8.3 75.1 75.1-8.3 233.5-233.6zm71-85.2l-52.6-52.6c-3.8-3.8-10.2-4-14.1 0L426 83.3l66.7 66.7 48.4-48.4c3.9-3.8 3.9-10.2 0-14.1z"/></svg>';case"pen":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M493.25 56.26l-37.51-37.51C443.25 6.25 426.87 0 410.49 0s-32.76 6.25-45.26 18.74L12.85 371.12.15 485.34C-1.45 499.72 9.88 512 23.95 512c.89 0 1.78-.05 2.69-.15l114.14-12.61 352.48-352.48c24.99-24.99 24.99-65.51-.01-90.5zM126.09 468.68l-93.03 10.31 10.36-93.17 263.89-263.89 82.77 82.77-263.99 263.98zm344.54-344.54l-57.93 57.93-82.77-82.77 57.93-57.93c6.04-6.04 14.08-9.37 22.63-9.37 8.55 0 16.58 3.33 22.63 9.37l37.51 37.51c12.47 12.48 12.47 32.78 0 45.26z"/></svg>';case"pencil-ruler":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M502.71 368.14L379.88 245.31l49.4-49.4 68.65-68.66c18.76-18.76 18.75-49.17 0-67.93l-45.25-45.25C443.3 4.69 431 0 418.71 0s-24.59 4.69-33.97 14.07l-68.65 68.64-49.4 49.4L143.87 9.29C137.68 3.1 129.56 0 121.44 0s-16.23 3.1-22.43 9.29L9.31 99c-12.38 12.39-12.39 32.47 0 44.86l122.8 122.8-113.01 113L.34 487.11c-2.72 15.63 11.22 26.9 24.59 24.56l107.44-18.84 112.94-112.96L368.14 502.7a31.621 31.621 0 0 0 22.42 9.29c8.12 0 16.24-3.1 22.43-9.29l89.72-89.7c12.39-12.39 12.39-32.47 0-44.86zM407.36 36.7c4.09-4.09 18.6-4.09 22.69 0l45.25 45.24c6.25 6.25 6.25 16.42 0 22.67l-46.03 46.03-67.94-67.94 46.03-46zM31.93 121.63l89.51-89.52L177.39 88l-39.03 39.03c-3.12 3.12-3.12 8.19 0 11.31l11.31 11.31c3.12 3.12 8.19 3.12 11.31 0l39.04-39.04 44.1 44.05-89.5 89.49L31.93 121.63zm84.96 341.43L34.5 477.51l14.37-82.37 289.83-289.8 67.94 67.94-289.75 289.78zm273.88 17.02l-122.86-122.8 89.47-89.48 44.12 44.07-39.15 39.16c-3.12 3.12-3.12 8.19 0 11.31l11.31 11.31c3.12 3.12 8.19 3.12 11.31 0l39.17-39.17 55.94 55.88-89.31 89.72z"></path></svg>';case"plus-circle":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M384 250v12c0 6.6-5.4 12-12 12h-98v98c0 6.6-5.4 12-12 12h-12c-6.6 0-12-5.4-12-12v-98h-98c-6.6 0-12-5.4-12-12v-12c0-6.6 5.4-12 12-12h98v-98c0-6.6 5.4-12 12-12h12c6.6 0 12 5.4 12 12v98h98c6.6 0 12 5.4 12 12zm120 6c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-32 0c0-119.9-97.3-216-216-216-119.9 0-216 97.3-216 216 0 119.9 97.3 216 216 216 119.9 0 216-97.3 216-216z"/></svg>';case"minus":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M140 274c-6.6 0-12-5.4-12-12v-12c0-6.6 5.4-12 12-12h232c6.6 0 12 5.4 12 12v12c0 6.6-5.4 12-12 12H140zm364-18c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-32 0c0-119.9-97.3-216-216-216-119.9 0-216 97.3-216 216 0 119.9 97.3 216 216 216 119.9 0 216-97.3 216-216z"/></svg>';case"shapes":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M480 288H320c-17.67 0-32 14.33-32 32v160c0 17.67 14.33 32 32 32h160c17.67 0 32-14.33 32-32V320c0-17.67-14.33-32-32-32zm0 192H320V320h160v160zM128 256C57.31 256 0 313.31 0 384s57.31 128 128 128 128-57.31 128-128-57.31-128-128-128zm0 224c-52.93 0-96-43.07-96-96 0-52.94 43.07-96 96-96 52.94 0 96 43.06 96 96 0 52.93-43.06 96-96 96zm378.98-278.86L400.07 18.29C392.95 6.1 380.47 0 368 0s-24.95 6.1-32.07 18.29L229.02 201.14c-14.26 24.38 3.56 54.86 32.07 54.86h213.82c28.51 0 46.33-30.48 32.07-54.86zm-27.6 20.39c-.94 1.64-2.45 2.47-4.47 2.47H261.09c-2.02 0-3.53-.83-4.47-2.47-1.21-2.12-.35-3.6.02-4.23L363.55 34.44c.95-1.62 2.44-2.44 4.45-2.44s3.5.82 4.45 2.44L479.36 217.3c.37.63 1.24 2.11.02 4.23z"/></svg>';case"vector-shape":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M486.4 128c14.14 0 25.6-11.46 25.6-25.6V25.6C512 11.46 500.54 0 486.4 0h-76.8C395.46 0 384 11.46 384 25.6V48H128V25.6C128 11.46 116.54 0 102.4 0H25.6C11.46 0 0 11.46 0 25.6v76.8C0 116.54 11.46 128 25.6 128H48v256H25.6C11.46 384 0 395.46 0 409.6v76.8C0 500.54 11.46 512 25.6 512h76.8c14.14 0 25.6-11.46 25.6-25.6V464h256v22.4c0 14.14 11.46 25.6 25.6 25.6h76.8c14.14 0 25.6-11.46 25.6-25.6v-76.8c0-14.14-11.46-25.6-25.6-25.6H464V128h22.4zM416 32h64v64h-64V32zM32 96V32h64v64H32zm64 384H32v-64h64v64zm384-64v64h-64v-64h64zm-48-32h-22.4c-14.14 0-25.6 11.46-25.6 25.6V432H128v-22.4c0-14.14-11.46-25.6-25.6-25.6H80V128h22.4c14.14 0 25.6-11.46 25.6-25.6V80h256v22.4c0 14.14 11.46 25.6 25.6 25.6H432v256z"/></svg>';case"address-card":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M512 32H64C28.7 32 0 60.7 0 96v320c0 35.3 28.7 64 64 64h448c35.3 0 64-28.7 64-64V96c0-35.3-28.7-64-64-64zm32 384c0 17.6-14.4 32-32 32H64c-17.6 0-32-14.4-32-32V96c0-17.6 14.4-32 32-32h448c17.6 0 32 14.4 32 32v320zm-72-128H360c-4.4 0-8 3.6-8 8v16c0 4.4 3.6 8 8 8h112c4.4 0 8-3.6 8-8v-16c0-4.4-3.6-8-8-8zm0-64H360c-4.4 0-8 3.6-8 8v16c0 4.4 3.6 8 8 8h112c4.4 0 8-3.6 8-8v-16c0-4.4-3.6-8-8-8zm0-64H360c-4.4 0-8 3.6-8 8v16c0 4.4 3.6 8 8 8h112c4.4 0 8-3.6 8-8v-16c0-4.4-3.6-8-8-8zM208 288c44.2 0 80-35.8 80-80s-35.8-80-80-80-80 35.8-80 80 35.8 80 80 80zm0-128c26.5 0 48 21.5 48 48s-21.5 48-48 48-48-21.5-48-48 21.5-48 48-48zm46.8 144c-19.5 0-24.4 7-46.8 7s-27.3-7-46.8-7c-21.2 0-41.8 9.4-53.8 27.4C100.2 342.1 96 355 96 368.9V392c0 4.4 3.6 8 8 8h16c4.4 0 8-3.6 8-8v-23.1c0-7 2.1-13.8 6-19.6 5.6-8.3 15.8-13.2 27.3-13.2 12.4 0 20.8 7 46.8 7 25.9 0 34.3-7 46.8-7 11.5 0 21.7 5 27.3 13.2 3.9 5.8 6 12.6 6 19.6V392c0 4.4 3.6 8 8 8h16c4.4 0 8-3.6 8-8v-23.1c0-13.9-4.2-26.8-11.4-37.5-12.3-18-32.9-27.4-54-27.4z"/></svg>';case"paperclip":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M149.106 512c-33.076 0-66.153-12.59-91.333-37.771-50.364-50.361-50.364-132.305-.002-182.665L319.842 29.498c39.331-39.331 103.328-39.331 142.66 0 39.331 39.332 39.331 103.327 0 142.657l-222.63 222.626c-28.297 28.301-74.347 28.303-102.65 0-28.3-28.301-28.3-74.349 0-102.649l170.301-170.298c4.686-4.686 12.284-4.686 16.97 0l5.661 5.661c4.686 4.686 4.686 12.284 0 16.971l-170.3 170.297c-15.821 15.821-15.821 41.563.001 57.385 15.821 15.82 41.564 15.82 57.385 0l222.63-222.626c26.851-26.851 26.851-70.541 0-97.394-26.855-26.851-70.544-26.849-97.395 0L80.404 314.196c-37.882 37.882-37.882 99.519 0 137.401 37.884 37.881 99.523 37.882 137.404.001l217.743-217.739c4.686-4.686 12.284-4.686 16.97 0l5.661 5.661c4.686 4.686 4.686 12.284 0 16.971L240.44 474.229C215.26 499.41 182.183 512 149.106 512z"/></svg>';case"facing-pages":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M546.4,32c-2.7,0-5.5,0.4-8.3,1.2L302.5,96h0L64,35.3c-9-2.2-16.5-4.5-30.3-3S5.9,49,5.9,62v332.4c0,9.2,15.9,16.7,30.4,21.6l0,0l238.4,60.7c18,4.3,37.5,4.4,55.5,0.1L540.7,424c16.8-4.9,27.9-16.6,27.9-29.7V48C568.6,38.8,558.1,32,546.4,32z M41.6,382.4V62.5l238.7,61.8v319.9L41.6,382.4z M324.6,444.4V124.2l214.6-61.7l1.8,322.9L324.6,444.4L324.6,444.4z"/></svg>';case"page":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 612 512"><path d="M369.9 97.9L286 14C277 5 264.8-.1 252.1-.1H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V131.9c0-12.7-5.1-25-14.1-34zm-22.6 22.7c2.1 2.1 3.5 4.6 4.2 7.4H256V32.5c2.8.7 5.3 2.1 7.4 4.2l83.9 83.9zM336 480H48c-8.8 0-16-7.2-16-16V48c0-8.8 7.2-16 16-16h176v104c0 13.3 10.7 24 24 24h104v304c0 8.8-7.2 16-16 16z"/></svg>';case"cog":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M482.696 299.276l-32.61-18.827a195.168 195.168 0 0 0 0-48.899l32.61-18.827c9.576-5.528 14.195-16.902 11.046-27.501-11.214-37.749-31.175-71.728-57.535-99.595-7.634-8.07-19.817-9.836-29.437-4.282l-32.562 18.798a194.125 194.125 0 0 0-42.339-24.48V38.049c0-11.13-7.652-20.804-18.484-23.367-37.644-8.909-77.118-8.91-114.77 0-10.831 2.563-18.484 12.236-18.484 23.367v37.614a194.101 194.101 0 0 0-42.339 24.48L105.23 81.345c-9.621-5.554-21.804-3.788-29.437 4.282-26.36 27.867-46.321 61.847-57.535 99.595-3.149 10.599 1.47 21.972 11.046 27.501l32.61 18.827a195.168 195.168 0 0 0 0 48.899l-32.61 18.827c-9.576 5.528-14.195 16.902-11.046 27.501 11.214 37.748 31.175 71.728 57.535 99.595 7.634 8.07 19.817 9.836 29.437 4.283l32.562-18.798a194.08 194.08 0 0 0 42.339 24.479v37.614c0 11.13 7.652 20.804 18.484 23.367 37.645 8.909 77.118 8.91 114.77 0 10.831-2.563 18.484-12.236 18.484-23.367v-37.614a194.138 194.138 0 0 0 42.339-24.479l32.562 18.798c9.62 5.554 21.803 3.788 29.437-4.283 26.36-27.867 46.321-61.847 57.535-99.595 3.149-10.599-1.47-21.972-11.046-27.501zm-65.479 100.461l-46.309-26.74c-26.988 23.071-36.559 28.876-71.039 41.059v53.479a217.145 217.145 0 0 1-87.738 0v-53.479c-33.621-11.879-43.355-17.395-71.039-41.059l-46.309 26.74c-19.71-22.09-34.689-47.989-43.929-75.958l46.329-26.74c-6.535-35.417-6.538-46.644 0-82.079l-46.329-26.74c9.24-27.969 24.22-53.869 43.929-75.969l46.309 26.76c27.377-23.434 37.063-29.065 71.039-41.069V44.464a216.79 216.79 0 0 1 87.738 0v53.479c33.978 12.005 43.665 17.637 71.039 41.069l46.309-26.76c19.709 22.099 34.689 47.999 43.929 75.969l-46.329 26.74c6.536 35.426 6.538 46.644 0 82.079l46.329 26.74c-9.24 27.968-24.219 53.868-43.929 75.957zM256 160c-52.935 0-96 43.065-96 96s43.065 96 96 96 96-43.065 96-96-43.065-96-96-96zm0 160c-35.29 0-64-28.71-64-64s28.71-64 64-64 64 28.71 64 64-28.71 64-64 64z"/></svg>';case"perspective":return'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 512 512" style="enable-background:new 0 0 512 512;" xml:space="preserve"> <path d="M396.4,128c14.1,0,25.6-11.5,25.6-25.6V25.6C422,11.5,410.5,0,396.4,0h-76.8C305.5,0,294,11.5,294,25.6V48h-86V25.6 \tC208,11.5,196.5,0,182.4,0h-76.8C91.5,0,80,11.5,80,25.6v76.8c0,14.1,11.5,25.6,25.6,25.6H128L48,384H25.6C11.5,384,0,395.5,0,409.6 \tv76.8C0,500.5,11.5,512,25.6,512h76.8c14.1,0,25.6-11.5,25.6-25.6V464h256v22.4c0,14.1,11.5,25.6,25.6,25.6h76.8 \tc14.1,0,25.6-11.5,25.6-25.6v-76.8c0-14.1-11.5-25.6-25.6-25.6H464l-90-256H396.4z M326,32h64v64h-64V32z M112,96V32h64v64H112z \t M96,480H32v-64h64V480z M480,416v64h-64v-64H480z M432,384h-22.4c-14.1,0-25.6,11.5-25.6,25.6V432H128v-22.4 \tc0-14.1-11.5-25.6-25.6-25.6H80l80-256h22.4c14.1,0,25.6-11.5,25.6-25.6V80h86v22.4c0,14.1,11.5,25.6,25.6,25.6H342L432,384z"/> </svg> ';case"style":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M344 240H104c-4.4 0-8 3.6-8 8v16c0 4.4 3.6 8 8 8h240c4.4 0 8-3.6 8-8v-16c0-4.4-3.6-8-8-8zm0 96H104c-4.4 0-8 3.6-8 8v16c0 4.4 3.6 8 8 8h240c4.4 0 8-3.6 8-8v-16c0-4.4-3.6-8-8-8zM418.1 0c-5.8 0-11.8 1.8-17.3 5.7L357.3 37 318.7 9.2c-8.4-6-18.2-9.1-28.1-9.1-9.8 0-19.6 3-28 9.1L224 37 185.4 9.2C177 3.2 167.1.1 157.3.1s-19.6 3-28 9.1L90.7 37 47.2 5.7C41.8 1.8 35.8 0 29.9 0 14.4.1 0 12.3 0 29.9v452.3C0 499.5 14.3 512 29.9 512c5.8 0 11.8-1.8 17.3-5.7L90.7 475l38.6 27.8c8.4 6 18.2 9.1 28.1 9.1 9.8 0 19.6-3 28-9.1L224 475l38.6 27.8c8.4 6 18.3 9.1 28.1 9.1s19.6-3 28-9.1l38.6-27.8 43.5 31.3c5.4 3.9 11.4 5.7 17.3 5.7 15.5 0 29.8-12.2 29.8-29.8V29.9C448 12.5 433.7 0 418.1 0zM416 477.8L376 449l-18.7-13.5-18.7 13.5-38.6 27.8c-2.8 2-6 3-9.3 3-3.4 0-6.6-1.1-9.4-3.1L242.7 449 224 435.5 205.3 449l-38.6 27.8c-2.8 2-6 3-9.4 3-3.4 0-6.6-1.1-9.4-3.1L109.3 449l-18.7-13.5L72 449l-40 29.4V34.2L72 63l18.7 13.5L109.4 63 148 35.2c2.8-2 6-3 9.3-3 3.4 0 6.6 1.1 9.4 3.1L205.3 63 224 76.5 242.7 63l38.6-27.8c2.8-2 6-3 9.4-3 3.4 0 6.6 1.1 9.4 3.1L338.7 63l18.7 13.5L376 63l40-28.8v443.6zM344 144H104c-4.4 0-8 3.6-8 8v16c0 4.4 3.6 8 8 8h240c4.4 0 8-3.6 8-8v-16c0-4.4-3.6-8-8-8z"/></svg>';case"story":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M288 52v24a6 6 0 0 1-6 6H6a6 6 0 0 1-6-6V52a6 6 0 0 1 6-6h276a6 6 0 0 1 6 6zM6 210h436a6 6 0 0 0 6-6v-24a6 6 0 0 0-6-6H6a6 6 0 0 0-6 6v24a6 6 0 0 0 6 6zm0 256h436a6 6 0 0 0 6-6v-24a6 6 0 0 0-6-6H6a6 6 0 0 0-6 6v24a6 6 0 0 0 6 6zm276-164H6a6 6 0 0 0-6 6v24a6 6 0 0 0 6 6h276a6 6 0 0 0 6-6v-24a6 6 0 0 0-6-6z"/></svg>';case"plus-square":return'<svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 448 512"  xml:space="preserve"><path fill="#FFFFFF" d="M400,64c8.8,0,16,7.2,16,16v352c0,8.8-7.2,16-16,16H48c-8.8,0-16-7.2-16-16V80c0-8.8,7.2-16,16-16H400"/><path d="M400,64c8.8,0,16,7.2,16,16v352c0,8.8-7.2,16-16,16H48c-8.8,0-16-7.2-16-16V80c0-8.8,7.2-16,16-16H400 M400,32H48 C21.5,32,0,53.5,0,80v352c0,26.5,21.5,48,48,48h352c26.5,0,48-21.5,48-48V80C448,53.5,426.5,32,400,32z M340,238h-98v-98 c0-6.6-5.4-12-12-12h-12c-6.6,0-12,5.4-12,12v98h-98c-6.6,0-12,5.4-12,12v12c0,6.6,5.4,12,12,12h98v98c0,6.6,5.4,12,12,12h12 c6.6,0,12-5.4,12-12v-98h98c6.6,0,12-5.4,12-12v-12C352,243.4,346.6,238,340,238z"/></svg>';case"text-flow":return'<svg   xmlns="http://www.w3.org/2000/svg"   x="0px" y="0px" viewBox="0 0 448 512" xml:space="preserve"><path d="M48,32h352c26.5,0,48,21.5,48,48v352c0,26.5-21.5,48-48,48H48c-26.5,0-48-21.5-48-48V80C0,53.5,21.5,32,48,32z"/><path fill="#FFFFFF" d="M67.4,312.9h149.9v91.6c0,13.8,16.8,20.8,26.5,11L391.6,267c6.1-6.1,6.1-15.8,0-21.8L243.8,96.5c-9.8-9.8-26.5-2.8-26.5,11v91.6H67.4c-8.5,0-15.5,7-15.5,15.5v82.7C51.9,305.9,58.9,312.9,67.4,312.9z"/></svg>';case"exchange":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M508.485 184.485l-92.485 92c-4.687 4.686-12.284 4.686-16.97 0l-7.071-7.07c-4.687-4.686-4.687-12.284 0-16.971L452.893 192H12c-6.627 0-12-5.373-12-12v-8c0-6.627 5.373-12 12-12h440.905l-60.946-60.444c-4.687-4.686-4.687-12.284 0-16.971l7.07-7.07c4.687-4.686 12.284-4.686 16.971 0l92.485 92c4.687 4.686 4.686 12.284 0 16.97zm-504.97 160l92.485 92c4.687 4.686 12.284 4.686 16.971 0l7.07-7.07c4.687-4.686 4.687-12.284 0-16.971L59.095 352H500c6.627 0 12-5.373 12-12v-8c0-6.627-5.373-12-12-12H59.107l60.934-60.444c4.687-4.686 4.687-12.284 0-16.971l-7.071-7.07c-4.686-4.686-12.284-4.687-16.97 0l-92.485 92c-4.686 4.686-4.687 12.284 0 16.97z"></path></svg>';case"text-align-justify-justify":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439 48H7a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h432a8 8 0 0 0 8-8V56a8 8 0 0 0-8-8zm0 384H7a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h432a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8zm0-128H7a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h432a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8zm0-128H7a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h432a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8z"></path></svg>';case"text-align-justify-left":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path  d="M439,48H7c-4.4,0-8,3.6-8,8v16c0,4.4,3.6,8,8,8h432c4.4,0,8-3.6,8-8V56C447,51.6,443.4,48,439,48z M219,432H8 c-4.4,0-8,3.6-8,8v16c0,4.4,3.6,8,8,8h211c4.4,0,8-3.6,8-8v-16C227,435.6,223.4,432,219,432z M439,304H7c-4.4,0-8,3.6-8,8v16 c0,4.4,3.6,8,8,8h432c4.4,0,8-3.6,8-8v-16C447,307.6,443.4,304,439,304z M439,176H7c-4.4,0-8,3.6-8,8v16c0,4.4,3.6,8,8,8h432 c4.4,0,8-3.6,8-8v-16C447,179.6,443.4,176,439,176z"></path></svg>';case"text-align-justify-right":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439,48H7c-4.4,0-8,3.6-8,8v16c0,4.4,3.6,8,8,8h432c4.4,0,8-3.6,8-8V56C447,51.6,443.4,48,439,48z M439,432H228 c-4.4,0-8,3.6-8,8v16c0,4.4,3.6,8,8,8h211c4.4,0,8-3.6,8-8v-16C447,435.6,443.4,432,439,432z M439,304H7c-4.4,0-8,3.6-8,8v16 c0,4.4,3.6,8,8,8h432c4.4,0,8-3.6,8-8v-16C447,307.6,443.4,304,439,304z M439,176H7c-4.4,0-8,3.6-8,8v16c0,4.4,3.6,8,8,8h432 c4.4,0,8-3.6,8-8v-16C447,179.6,443.4,176,439,176z"></path></svg>';case"text-align-justify-center":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439,48H7c-4.4,0-8,3.6-8,8v16c0,4.4,3.6,8,8,8h432c4.4,0,8-3.6,8-8V56C447,51.6,443.4,48,439,48z M329,432H118 c-4.4,0-8,3.6-8,8v16c0,4.4,3.6,8,8,8h211c4.4,0,8-3.6,8-8v-16C337,435.6,333.4,432,329,432z M439,304H7c-4.4,0-8,3.6-8,8v16 c0,4.4,3.6,8,8,8h432c4.4,0,8-3.6,8-8v-16C447,307.6,443.4,304,439,304z M439,176H7c-4.4,0-8,3.6-8,8v16c0,4.4,3.6,8,8,8h432 c4.4,0,8-3.6,8-8v-16C447,179.6,443.4,176,439,176z"></path></svg>';case"text-align-left":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M280 48H8a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h272a8 8 0 0 0 8-8V56a8 8 0 0 0-8-8zm160 384H8a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h432a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8zM280 304H8a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h272a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8zm160-128H8a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h432a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8z"></path></svg>';case"text-align-right":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M440 48H168a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h272a8 8 0 0 0 8-8V56a8 8 0 0 0-8-8zm0 384H8a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h432a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8zm0-128H168a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h272a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8zm0-128H8a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h432a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8z"></path></svg>';case"text-align-center":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M344 48H104a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h240a8 8 0 0 0 8-8V56a8 8 0 0 0-8-8zm96 384H8a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h432a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8zm-96-128H104a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h240a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8zm96-128H8a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h432a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8z"></path></svg>';case"check":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path  d="M413.505 91.951L133.49 371.966l-98.995-98.995c-4.686-4.686-12.284-4.686-16.971 0L6.211 284.284c-4.686 4.686-4.686 12.284 0 16.971l118.794 118.794c4.686 4.686 12.284 4.686 16.971 0l299.813-299.813c4.686-4.686 4.686-12.284 0-16.971l-11.314-11.314c-4.686-4.686-12.284-4.686-16.97 0z"></path></svg>';case"plus":return'<svg   xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path  d="M376 232H216V72c0-4.42-3.58-8-8-8h-32c-4.42 0-8 3.58-8 8v160H8c-4.42 0-8 3.58-8 8v32c0 4.42 3.58 8 8 8h160v160c0 4.42 3.58 8 8 8h32c4.42 0 8-3.58 8-8V280h160c4.42 0 8-3.58 8-8v-32c0-4.42-3.58-8-8-8z"></path></svg>';case"arrow-left":case"mirror-x":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path  d="M231.536 475.535l7.071-7.07c4.686-4.686 4.686-12.284 0-16.971L60.113 273H436c6.627 0 12-5.373 12-12v-10c0-6.627-5.373-12-12-12H60.113L238.607 60.506c4.686-4.686 4.686-12.284 0-16.971l-7.071-7.07c-4.686-4.686-12.284-4.686-16.97 0L3.515 247.515c-4.686 4.686-4.686 12.284 0 16.971l211.051 211.05c4.686 4.686 12.284 4.686 16.97-.001z"></path></svg>';case"arrow-up":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path   d="M4.465 263.536l7.07 7.071c4.686 4.686 12.284 4.686 16.971 0L207 92.113V468c0 6.627 5.373 12 12 12h10c6.627 0 12-5.373 12-12V92.113l178.494 178.493c4.686 4.686 12.284 4.686 16.971 0l7.07-7.071c4.686-4.686 4.686-12.284 0-16.97l-211.05-211.05c-4.686-4.686-12.284-4.686-16.971 0L4.465 246.566c-4.687 4.686-4.687 12.284 0 16.97z"></path></svg>';case"arrow-down":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M443.5 248.5l-7.1-7.1c-4.7-4.7-12.3-4.7-17 0L241 419.9V44c0-6.6-5.4-12-12-12h-10c-6.6 0-12 5.4-12 12v375.9L28.5 241.4c-4.7-4.7-12.3-4.7-17 0l-7.1 7.1c-4.7 4.7-4.7 12.3 0 17l211 211.1c4.7 4.7 12.3 4.7 17 0l211-211.1c4.8-4.8 4.8-12.3.1-17z"></path></svg>';case"arrow-right":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path  d="M216.464 36.465l-7.071 7.07c-4.686 4.686-4.686 12.284 0 16.971L387.887 239H12c-6.627 0-12 5.373-12 12v10c0 6.627 5.373 12 12 12h375.887L209.393 451.494c-4.686 4.686-4.686 12.284 0 16.971l7.071 7.07c4.686 4.686 12.284 4.686 16.97 0l211.051-211.05c4.686-4.686 4.686-12.284 0-16.971L233.434 36.465c-4.686-4.687-12.284-4.687-16.97 0z"></path></svg>';case"mirror-y":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M443.5 248.5l-7.1-7.1c-4.7-4.7-12.3-4.7-17 0L241 419.9V44c0-6.6-5.4-12-12-12h-10c-6.6 0-12 5.4-12 12v375.9L28.5 241.4c-4.7-4.7-12.3-4.7-17 0l-7.1 7.1c-4.7 4.7-4.7 12.3 0 17l211 211.1c4.7 4.7 12.3 4.7 17 0l211-211.1c4.8-4.8 4.8-12.3.1-17z"></path></svg>';case"arrows-h":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M399.959 170.585c-4.686 4.686-4.686 12.284 0 16.971L451.887 239H60.113l51.928-51.444c4.686-4.686 4.686-12.284 0-16.971l-7.071-7.07c-4.686-4.686-12.284-4.686-16.97 0l-84.485 84c-4.686 4.686-4.686 12.284 0 16.971l84.485 84c4.686 4.686 12.284 4.686 16.97 0l7.071-7.07c4.686-4.686 4.686-12.284 0-16.971L60.113 273h391.773l-51.928 51.444c-4.686 4.686-4.686 12.284 0 16.971l7.071 7.07c4.686 4.686 12.284 4.686 16.97 0l84.485-84c4.687-4.686 4.687-12.284 0-16.971l-84.485-84c-4.686-4.686-12.284-4.686-16.97 0l-7.07 7.071z"></path></svg>';case"arrows-v":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 192 512"><path  d="M181.415 399.959c-4.686-4.686-12.284-4.686-16.971 0L113 451.887V60.113l51.444 51.928c4.686 4.686 12.284 4.686 16.971 0l7.07-7.071c4.686-4.686 4.686-12.284 0-16.97l-84-84.485c-4.686-4.686-12.284-4.686-16.971 0L3.515 88c-4.686 4.686-4.686 12.284 0 16.97l7.07 7.071c4.686 4.686 12.284 4.686 16.971 0L79 60.113v391.773l-51.444-51.928c-4.686-4.686-12.284-4.686-16.971 0l-7.07 7.071c-4.686 4.686-4.686 12.284 0 16.97l84 84.485c4.686 4.687 12.284 4.687 16.971 0l84-84.485c4.686-4.686 4.686-12.284 0-16.97l-7.071-7.07z"></path></svg>';case"arrows":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path   d="M337.782 434.704l-73.297 73.782c-4.686 4.686-12.284 4.686-16.971 0l-73.296-73.782c-4.686-4.686-4.686-12.284 0-16.97l7.07-7.07c4.686-4.686 12.284-4.686 16.971 0L239 451.887h1V272H60.113v1l41.224 40.741c4.686 4.686 4.686 12.284 0 16.971l-7.071 7.07c-4.686 4.686-12.284 4.686-16.97 0L3.515 264.485c-4.686-4.686-4.686-12.284 0-16.971l73.782-73.297c4.686-4.686 12.284-4.686 16.971 0l7.071 7.071c4.686 4.686 4.686 12.284 0 16.971L60.113 239v1H240V60.113h-1l-40.741 41.224c-4.686 4.686-12.284 4.686-16.971 0l-7.07-7.071c-4.686-4.686-4.687-12.284 0-16.97l73.297-73.782c4.686-4.686 12.284-4.686 16.971 0l73.297 73.782c4.686 4.686 4.686 12.284 0 16.971l-7.071 7.071c-4.686 4.686-12.284 4.686-16.971 0L273 60.113h-1V240h179.887v-1l-41.224-40.741c-4.686-4.686-4.686-12.284 0-16.971l7.071-7.07c4.686-4.686 12.284-4.686 16.97 0l73.782 73.297c4.687 4.686 4.686 12.284 0 16.971l-73.782 73.297c-4.686 4.686-12.284 4.686-16.97 0l-7.071-7.07c-4.686-4.686-4.686-12.284 0-16.971L451.887 273v-1H272v179.887h1l40.741-41.224c4.686-4.686 12.284-4.686 16.971 0l7.07 7.071c4.686 4.685 4.686 12.283 0 16.97z"></path></svg>';case"arrows-circle":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 139.54 139.54"><path d="M139.54,69.77A69.77,69.77,0,1,1,69.77,0,69.77,69.77,0,0,1,139.54,69.77ZM87.46,41.53,69.78,9.2,52.1,41.53ZM99.23,88l32.32-17.68L99.23,52.6ZM40.47,52.6,8.15,70.27,40.47,88ZM53,99.65,70.68,132,88.36,99.65Z"/></svg>';case"text-size":return'<svg   xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path  d="M624 32H272a16 16 0 0 0-16 16v72a8 8 0 0 0 8 8h16a8 8 0 0 0 8-8V64h144v384h-72a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h176a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8h-72V64h144v56a8 8 0 0 0 8 8h16a8 8 0 0 0 8-8V48a16 16 0 0 0-16-16zM304 224H16a16 16 0 0 0-16 16v56a8 8 0 0 0 8 8h16a8 8 0 0 0 8-8v-40h112v192H88a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h144a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8h-56V256h112v40a8 8 0 0 0 8 8h16a8 8 0 0 0 8-8v-56a16 16 0 0 0-16-16z"></path></svg>';case"text-width":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path  d="M362.31 292.69a16.12 16.12 0 0 0-11.48-4.69c-8 0-15.83 5.69-15.83 16v64H111v-64a16 16 0 0 0-16.12-16 15.63 15.63 0 0 0-11.19 4.71l-80 80a16 16 0 0 0 0 22.63l80 80A16.16 16.16 0 0 0 95.17 480c8 0 15.83-5.69 15.83-16v-64h224v64a16 16 0 0 0 16.13 16 15.64 15.64 0 0 0 11.18-4.7l80-80a16 16 0 0 0 0-22.63zM79 368v57.37L37.63 384 79 342.64zm288 57.36v-82.73L408.37 384zM431 32H15A16 16 0 0 0-1 48v72a8 8 0 0 0 8 8h16a8 8 0 0 0 8-8V64h176v192h-40a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h112a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8h-40V64h176v56a8 8 0 0 0 8 8h16a8 8 0 0 0 8-8V48a16 16 0 0 0-16-16z"></path></svg>';case"line-width":return'<svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 640 512" ><path d="M506.63,354h-368c-4.42,0-8,3.58-8,8v16c0,4.42,3.58,8,8,8h368c4.42,0,8-3.58,8-8v-16C514.63,357.58,511.04,354,506.63,354z M506.63,442h-368c-4.42,0-8,3.58-8,8v16c0,4.42,3.58,8,8,8h368c4.42,0,8-3.58,8-8v-16C514.63,445.58,511.04,442,506.63,442z M506.63,266h-368c-4.42,0-8,3.58-8,8v16c0,4.42,3.58,8,8,8h368c4.42,0,8-3.58,8-8v-16C514.63,269.58,511.04,266,506.63,266z"/><path d="M208,32.01c0-14.31-17.31-21.33-27.31-11.31l-80,80c-6.25,6.25-6.25,16.38,0,22.63c0,0,0,0,0,0l80,80 c9.31,9.32,27.31,4.32,27.31-11.32v-64h224v64c0,14.29,17.31,21.31,27.31,11.29l80-80c6.25-6.25,6.25-16.38,0-22.63c0,0,0,0,0,0 l-80-80C450,11.36,432,16.36,432,32.01v64H208V32.01z"/>\t<polygon points="464,70.63 505.37,112.01 464,153.36 \t"/>\t<polygon points="176,128.01 176,153.38 134.63,112.01 176,70.65 \t"/></svg>';case"line-height":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path   d="M175 144c14.31 0 21.33-17.31 11.31-27.31l-80-80a16 16 0 0 0-22.63 0l-80 80C-5.64 126-.64 144 15 144h64v224H15C.71 368-6.31 385.31 3.71 395.31l80 80a16 16 0 0 0 22.63 0l80-80C195.65 386 190.65 368 175 368h-64V144zm-38.62 256L95 441.37 53.65 400h82.73zM79 112H53.63L95 70.63 136.36 112H79zm552 128H263a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h368a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8zm0 128H263a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h368a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8zm0-256H263a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h368a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8z"></path></svg>';case"palette":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M112 264c-13.3 0-24 10.7-24 24s10.7 24 24 24 24-10.7 24-24-10.7-24-24-24zm32-112c-13.3 0-24 10.7-24 24s10.7 24 24 24 24-10.7 24-24-10.7-24-24-24zM256 0c-16.9 0-34.2 1.6-51.7 5C104.9 24.4 24.8 104.3 5.2 203.4-29.4 378.5 116.4 512 239.5 512c8.3 0 16.5-.6 24.6-1.9 41.2-6.4 61.4-54.6 42.5-91.7-23.1-45.4 9.9-98.4 60.9-98.4h79.7c35.8 0 64.8-29.6 64.9-65.3C511.6 113.9 397.1 0 256 0zm191.1 288h-79.7c-35.3 0-67.4 17.9-85.7 47.8-18.2 29.7-19.6 66-3.7 97.2 4.9 9.6 4.8 21.6-.1 31.3-2.4 4.6-7.9 12.6-18.7 14.3-6.3 1-12.9 1.5-19.7 1.5-54.6 0-114.1-31.3-155.5-81.6-44-53.6-60.9-120.6-47.4-188.7 17.1-86.6 87-156.2 173.9-173.2 15.2-3 30.5-4.5 45.5-4.5 123.1 0 223.6 99.9 224 222.6 0 18.3-14.8 33.3-32.9 33.3zM368 136c-13.3 0-24 10.7-24 24s10.7 24 24 24 24-10.7 24-24-10.7-24-24-24zM240 88c-13.3 0-24 10.7-24 24s10.7 24 24 24 24-10.7 24-24-10.7-24-24-24z"></path></svg>';case"brush":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path d="M352 0H32C14.33 0 0 14.33 0 32v288c0 35.35 28.66 64 64 64h64v64c0 35.35 28.66 64 64 64s64-28.65 64-64v-64h64c35.34 0 64-28.65 64-64V32c0-17.67-14.33-32-32-32zm0 320c0 17.64-14.36 32-32 32h-96v96c0 17.64-14.36 32-32 32s-32-14.36-32-32v-96H64c-17.64 0-32-14.36-32-32v-32h320v32zm0-64H32V32h320v224z"></path></svg>';case"undo":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path  d="M20 8h10c6.627 0 12 5.373 12 12v110.625C85.196 57.047 165.239 7.715 256.793 8.001 393.18 8.428 504.213 120.009 504 256.396 503.786 393.181 392.834 504 256 504c-63.926 0-122.202-24.187-166.178-63.908-5.113-4.618-5.354-12.561-.482-17.433l7.069-7.069c4.503-4.503 11.749-4.714 16.482-.454C150.782 449.238 200.935 470 256 470c117.744 0 214-95.331 214-214 0-117.744-95.331-214-214-214-82.862 0-154.737 47.077-190.289 116H180c6.627 0 12 5.373 12 12v10c0 6.627-5.373 12-12 12H20c-6.627 0-12-5.373-12-12V20c0-6.627 5.373-12 12-12z"></path></svg>';case"redo":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M492 8h-10c-6.627 0-12 5.373-12 12v110.625C426.804 57.047 346.761 7.715 255.207 8.001 118.82 8.428 7.787 120.009 8 256.396 8.214 393.181 119.166 504 256 504c63.926 0 122.202-24.187 166.178-63.908 5.113-4.618 5.354-12.561.482-17.433l-7.069-7.069c-4.503-4.503-11.749-4.714-16.482-.454C361.218 449.238 311.065 470 256 470c-117.744 0-214-95.331-214-214 0-117.744 95.331-214 214-214 82.862 0 154.737 47.077 190.289 116H332c-6.627 0-12 5.373-12 12v10c0 6.627 5.373 12 12 12h160c6.627 0 12-5.373 12-12V20c0-6.627-5.373-12-12-12z"></path></svg>';case"copy":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path  d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM352 32.491a15.88 15.88 0 0 1 7.431 4.195l51.882 51.883A15.885 15.885 0 0 1 415.508 96H352V32.491zM288 464c0 8.822-7.178 16-16 16H48c-8.822 0-16-7.178-16-16V144c0-8.822 7.178-16 16-16h80v240c0 26.51 21.49 48 48 48h112v48zm128-96c0 8.822-7.178 16-16 16H176c-8.822 0-16-7.178-16-16V48c0-8.822 7.178-16 16-16h144v72c0 13.2 10.8 24 24 24h72v240z"></path></svg>';case"cut":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path  d="M249.52 256L446.83 58.83a3.996 3.996 0 0 0 0-5.65c-12.5-12.5-32.76-12.5-45.25 0L224.06 230.56l-48.64-48.61C185.88 166.57 192 148 192 128c0-53.02-42.98-96-96-96S0 74.98 0 128s42.98 96 96 96c20.01 0 38.58-6.12 53.96-16.6l48.63 48.6-48.63 48.6C134.58 294.12 116.01 288 96 288c-53.02 0-96 42.98-96 96s42.98 96 96 96 96-42.98 96-96c0-20-6.12-38.57-16.58-53.95l48.64-48.61 177.52 177.38c12.5 12.5 32.76 12.5 45.25 0a3.996 3.996 0 0 0 0-5.65L249.52 256zM96 192c-35.29 0-64-28.71-64-64s28.71-64 64-64 64 28.71 64 64-28.71 64-64 64zm0 256c-35.29 0-64-28.71-64-64s28.71-64 64-64 64 28.71 64 64-28.71 64-64 64z"></path></svg>';case"paste":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path  d="M433.941 193.941l-51.882-51.882A48 48 0 0 0 348.118 128H320V80c0-26.51-21.49-48-48-48h-66.752C198.643 13.377 180.858 0 160 0s-38.643 13.377-45.248 32H48C21.49 32 0 53.49 0 80v288c0 26.51 21.49 48 48 48h80v48c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48V227.882a48 48 0 0 0-14.059-33.941zm-22.627 22.627a15.888 15.888 0 0 1 4.195 7.432H352v-63.509a15.88 15.88 0 0 1 7.431 4.195l51.883 51.882zM160 30c9.941 0 18 8.059 18 18s-8.059 18-18 18-18-8.059-18-18 8.059-18 18-18zM48 384c-8.822 0-16-7.178-16-16V80c0-8.822 7.178-16 16-16h66.752c6.605 18.623 24.389 32 45.248 32s38.643-13.377 45.248-32H272c8.822 0 16 7.178 16 16v48H176c-26.51 0-48 21.49-48 48v208H48zm352 96H176c-8.822 0-16-7.178-16-16V176c0-8.822 7.178-16 16-16h144v72c0 13.2 10.8 24 24 24h72v208c0 8.822-7.178 16-16 16z"></path></svg>';case"object-ungroup":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path  d="M564 224c6.627 0 12-5.373 12-12v-72c0-6.627-5.373-12-12-12h-72c-6.627 0-12 5.373-12 12v20h-96v-32h20c6.627 0 12-5.373 12-12V44c0-6.627-5.373-12-12-12h-72c-6.627 0-12 5.373-12 12v20H96V44c0-6.627-5.373-12-12-12H12C5.373 32 0 37.373 0 44v72c0 6.627 5.373 12 12 12h20v160H12c-6.627 0-12 5.373-12 12v72c0 6.627 5.373 12 12 12h72c6.627 0 12-5.373 12-12v-20h96v32h-20c-6.627 0-12 5.373-12 12v72c0 6.627 5.373 12 12 12h72c6.627 0 12-5.373 12-12v-20h224v20c0 6.627 5.373 12 12 12h72c6.627 0 12-5.373 12-12v-72c0-6.627-5.373-12-12-12h-20V224h20zm-180 96v32h-32v-32h32zM352 64h32v32h-32V64zM32 64h32v32H32V64zm32 288H32v-32h32v32zm20-64H64V128h20c6.627 0 12-5.373 12-12V96h224v20c0 6.627 5.373 12 12 12h20v160h-20c-6.627 0-12 5.373-12 12v20H96v-20c0-6.627-5.373-12-12-12zm140 160h-32v-32h32v32zm256-52v20H256v-20c0-6.627-5.373-12-12-12h-20v-32h96v20c0 6.627 5.373 12 12 12h72c6.627 0 12-5.373 12-12v-72c0-6.627-5.373-12-12-12h-20v-96h96v20c0 6.627 5.373 12 12 12h20v160h-20c-6.627 0-12 5.373-12 12zm64 52h-32v-32h32v32zm-32-256v-32h32v32h-32z"></path></svg>';case"trash":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path  d="M296 432h16a8 8 0 0 0 8-8V152a8 8 0 0 0-8-8h-16a8 8 0 0 0-8 8v272a8 8 0 0 0 8 8zm-160 0h16a8 8 0 0 0 8-8V152a8 8 0 0 0-8-8h-16a8 8 0 0 0-8 8v272a8 8 0 0 0 8 8zM440 64H336l-33.6-44.8A48 48 0 0 0 264 0h-80a48 48 0 0 0-38.4 19.2L112 64H8a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h24v368a48 48 0 0 0 48 48h288a48 48 0 0 0 48-48V96h24a8 8 0 0 0 8-8V72a8 8 0 0 0-8-8zM171.2 38.4A16.1 16.1 0 0 1 184 32h80a16.1 16.1 0 0 1 12.8 6.4L296 64H152zM384 464a16 16 0 0 1-16 16H80a16 16 0 0 1-16-16V96h320zm-168-32h16a8 8 0 0 0 8-8V152a8 8 0 0 0-8-8h-16a8 8 0 0 0-8 8v272a8 8 0 0 0 8 8z"></path></svg>';case"remove-format":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path  d="M192 64h176l-44.56 133.68 25.35 20L400 64h176v56a8 8 0 0 0 8 8h16a8 8 0 0 0 8-8V48a16 16 0 0 0-16-16H176a16 16 0 0 0-16 16v21l32 25.19zm152 384h-72l44.55-133.64-25.35-20L240 448h-72a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h176a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8zm293 37.31L23 1.8A7.86 7.86 0 0 0 11.79 3l-10 12.5A7.92 7.92 0 0 0 3 26.71l614 483.52a7.91 7.91 0 0 0 11.18-1.23l10-12.5a7.83 7.83 0 0 0-1.18-11.18z"></path></svg>';case"clipboard":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path  d="M336 64h-88.6c.4-2.6.6-5.3.6-8 0-30.9-25.1-56-56-56s-56 25.1-56 56c0 2.7.2 5.4.6 8H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48zM192 32c13.3 0 24 10.7 24 24s-10.7 24-24 24-24-10.7-24-24 10.7-24 24-24zm160 432c0 8.8-7.2 16-16 16H48c-8.8 0-16-7.2-16-16V112c0-8.8 7.2-16 16-16h48v20c0 6.6 5.4 12 12 12h168c6.6 0 12-5.4 12-12V96h48c8.8 0 16 7.2 16 16z"></path></svg>';case"undo-solid":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path  d="M212.333 224.333H12c-6.627 0-12-5.373-12-12V12C0 5.373 5.373 0 12 0h48c6.627 0 12 5.373 12 12v78.112C117.773 39.279 184.26 7.47 258.175 8.007c136.906.994 246.448 111.623 246.157 248.532C504.041 393.258 393.12 504 256.333 504c-64.089 0-122.496-24.313-166.51-64.215-5.099-4.622-5.334-12.554-.467-17.42l33.967-33.967c4.474-4.474 11.662-4.717 16.401-.525C170.76 415.336 211.58 432 256.333 432c97.268 0 176-78.716 176-176 0-97.267-78.716-176-176-176-58.496 0-110.28 28.476-142.274 72.333h98.274c6.627 0 12 5.373 12 12v48c0 6.627-5.373 12-12 12z"></path></svg>';case"redo-solid":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path  d="M500.33 0h-47.41a12 12 0 0 0-12 12.57l4 82.76A247.42 247.42 0 0 0 256 8C119.34 8 7.9 119.53 8 256.19 8.1 393.07 119.1 504 256 504a247.1 247.1 0 0 0 166.18-63.91 12 12 0 0 0 .48-17.43l-34-34a12 12 0 0 0-16.38-.55A176 176 0 1 1 402.1 157.8l-101.53-4.87a12 12 0 0 0-12.57 12v47.41a12 12 0 0 0 12 12h200.33a12 12 0 0 0 12-12V12a12 12 0 0 0-12-12z"></path></svg>';case"copy-solid":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path  d="M320 448v40c0 13.255-10.745 24-24 24H24c-13.255 0-24-10.745-24-24V120c0-13.255 10.745-24 24-24h72v296c0 30.879 25.121 56 56 56h168zm0-344V0H152c-13.255 0-24 10.745-24 24v368c0 13.255 10.745 24 24 24h272c13.255 0 24-10.745 24-24V128H344c-13.2 0-24-10.8-24-24zm120.971-31.029L375.029 7.029A24 24 0 0 0 358.059 0H352v96h96v-6.059a24 24 0 0 0-7.029-16.97z"></path></svg>';case"trash-solid":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path  d="M432 32H312l-9.4-18.7A24 24 0 0 0 281.1 0H166.8a23.72 23.72 0 0 0-21.4 13.3L136 32H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16zM53.2 467a48 48 0 0 0 47.9 45h245.8a48 48 0 0 0 47.9-45L416 128H32z"></path></svg>';case"search-plus":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path  d="M304 192v32c0 6.6-5.4 12-12 12h-56v56c0 6.6-5.4 12-12 12h-32c-6.6 0-12-5.4-12-12v-56h-56c-6.6 0-12-5.4-12-12v-32c0-6.6 5.4-12 12-12h56v-56c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v56h56c6.6 0 12 5.4 12 12zm201 284.7L476.7 505c-9.4 9.4-24.6 9.4-33.9 0L343 405.3c-4.5-4.5-7-10.6-7-17V372c-35.3 27.6-79.7 44-128 44C93.1 416 0 322.9 0 208S93.1 0 208 0s208 93.1 208 208c0 48.3-16.4 92.7-44 128h16.3c6.4 0 12.5 2.5 17 7l99.7 99.7c9.3 9.4 9.3 24.6 0 34zM344 208c0-75.2-60.8-136-136-136S72 132.8 72 208s60.8 136 136 136 136-60.8 136-136z"></path></svg>';case"search-minus":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path  d="M304 192v32c0 6.6-5.4 12-12 12H124c-6.6 0-12-5.4-12-12v-32c0-6.6 5.4-12 12-12h168c6.6 0 12 5.4 12 12zm201 284.7L476.7 505c-9.4 9.4-24.6 9.4-33.9 0L343 405.3c-4.5-4.5-7-10.6-7-17V372c-35.3 27.6-79.7 44-128 44C93.1 416 0 322.9 0 208S93.1 0 208 0s208 93.1 208 208c0 48.3-16.4 92.7-44 128h16.3c6.4 0 12.5 2.5 17 7l99.7 99.7c9.3 9.4 9.3 24.6 0 34zM344 208c0-75.2-60.8-136-136-136S72 132.8 72 208s60.8 136 136 136 136-60.8 136-136z"></path></svg>';case"search-light":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M508.5 481.6l-129-129c-2.3-2.3-5.3-3.5-8.5-3.5h-10.3C395 312 416 262.5 416 208 416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c54.5 0 104-21 141.1-55.2V371c0 3.2 1.3 6.2 3.5 8.5l129 129c4.7 4.7 12.3 4.7 17 0l9.9-9.9c4.7-4.7 4.7-12.3 0-17zM208 384c-97.3 0-176-78.7-176-176S110.7 32 208 32s176 78.7 176 176-78.7 176-176 176z"></path></svg>';case"save":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path  d="M433.941 129.941l-83.882-83.882A48 48 0 0 0 316.118 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V163.882a48 48 0 0 0-14.059-33.941zM224 416c-35.346 0-64-28.654-64-64 0-35.346 28.654-64 64-64s64 28.654 64 64c0 35.346-28.654 64-64 64zm96-304.52V212c0 6.627-5.373 12-12 12H76c-6.627 0-12-5.373-12-12V108c0-6.627 5.373-12 12-12h228.52c3.183 0 6.235 1.264 8.485 3.515l3.48 3.48A11.996 11.996 0 0 1 320 111.48z"></path></svg>';case"cloud-upload-alt":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path  d="M537.6 226.6c4.1-10.7 6.4-22.4 6.4-34.6 0-53-43-96-96-96-19.7 0-38.1 6-53.3 16.2C367 64.2 315.3 32 256 32c-88.4 0-160 71.6-160 160 0 2.7.1 5.4.2 8.1C40.2 219.8 0 273.2 0 336c0 79.5 64.5 144 144 144h368c70.7 0 128-57.3 128-128 0-61.9-44-113.6-102.4-125.4zM393.4 288H328v112c0 8.8-7.2 16-16 16h-48c-8.8 0-16-7.2-16-16V288h-65.4c-14.3 0-21.4-17.2-11.3-27.3l105.4-105.4c6.2-6.2 16.4-6.2 22.6 0l105.4 105.4c10.1 10.1 2.9 27.3-11.3 27.3z"></path></svg>';case"folder-open-solid":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path  d="M572.694 292.093L500.27 416.248A63.997 63.997 0 0 1 444.989 448H45.025c-18.523 0-30.064-20.093-20.731-36.093l72.424-124.155A64 64 0 0 1 152 256h399.964c18.523 0 30.064 20.093 20.73 36.093zM152 224h328v-48c0-26.51-21.49-48-48-48H272l-64-64H48C21.49 64 0 85.49 0 112v278.046l69.077-118.418C86.214 242.25 117.989 224 152 224z"></path></svg>';case"tint":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 352 512"><path  d="M205.22 22.09C201.21 7.53 188.61 0 175.97 0c-12.35 0-24.74 7.2-29.19 22.09C100.01 179.85 0 222.72 0 333.91 0 432.35 78.72 512 176 512s176-79.65 176-178.09c0-111.75-99.79-153.34-146.78-311.82zM176 480c-79.4 0-144-65.54-144-146.09 0-48.36 23-81.32 54.84-126.94 29.18-41.81 65.34-93.63 89.18-170.91 23.83 77.52 60.06 129.31 89.3 171.08C297.06 252.52 320 285.3 320 333.91 320 414.46 255.4 480 176 480zm0-64c-44.12 0-80-35.89-80-80 0-8.84-7.16-16-16-16s-16 7.16-16 16c0 61.75 50.25 112 112 112 8.84 0 16-7.16 16-16s-7.16-16-16-16z"></path></svg>';case"warp-arc":return'<svg   xmlns="http://www.w3.org/2000/svg"  \t viewBox="0 0 500 500">\t<path  d="M499.63,193.5c0.11-0.55,0.19-1.09,0.25-1.64c0.07-0.6,0.11-1.18,0.12-1.78c0-0.54-0.03-1.07-0.07-1.6\t\tc-0.05-0.59-0.11-1.17-0.22-1.74c-0.1-0.55-0.24-1.08-0.39-1.62c-0.16-0.55-0.32-1.09-0.53-1.62c-0.2-0.52-0.44-1.03-0.7-1.54\t\tc-0.27-0.52-0.55-1.03-0.86-1.53c-0.29-0.45-0.6-0.88-0.94-1.31c-0.4-0.51-0.82-1-1.27-1.47c-0.18-0.19-0.31-0.4-0.5-0.58\t\tC477.8,161.3,387.48,82.52,250.17,81.35c-123.44-0.96-206.3,59.51-244.62,95.7l0.05,0.05c-5.33,5.02-7.22,13-4.05,20.05\t\tl95.09,211.08c2.95,6.54,9.38,10.41,16.11,10.41c1.91,0,3.82-0.41,5.69-1.06c0.5-0.14,0.99-0.3,1.48-0.48\t\tc0.02-0.01,0.05-0.01,0.07-0.02c0.02-0.01,0.03-0.02,0.05-0.03c1.85-0.71,3.63-1.67,5.22-3.03\t\tc18.75-16.07,59.09-42.87,119.53-42.87c0.52,0,1.06,0,1.59,0.01c68.59,0.54,113.14,35.8,121.38,42.87\t\tc3.33,2.86,7.42,4.25,11.49,4.25c4.97,0,9.92-2.09,13.41-6.16c0.1-0.11,0.16-0.24,0.25-0.36c1.33-1.34,2.52-2.86,3.4-4.65\t\tl101.98-209.48c0.12-0.25,0.17-0.51,0.28-0.76c0.25-0.57,0.46-1.14,0.64-1.73C499.36,194.59,499.51,194.05,499.63,193.5z\t\t M427.08,263.19c-20.18-12.43-77.33-42.87-159.73-47.76l-0.21-98.02c98.24,6.05,167.02,54.67,193.5,76.84L427.08,263.19z\t\t M373.06,374.17c-20.68-13.58-57.18-32.34-105.43-37.1l-0.19-86.22c78.64,5.12,130.51,35.41,144.1,44.27L373.06,374.17z\t\t M119.86,373.82L84,294.23c25.41-16.52,75.22-41.27,148.11-43.9l0.19,85.87C181.86,338.86,144.12,357.24,119.86,373.82z\t\t M232.04,215.02c-77.69,2.57-132.59,28.04-162.68,46.69L39.03,194.4c35.34-30.74,100.27-73.02,192.79-77.29L232.04,215.02z"/></svg>';case"warp-flag":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 449 427.46"><path d="M433,52.28C294.33-147,155.67,301.81,17,105.6,8.16,93.17,1,87.15,1,96q-.49,118.6-1,237.2c0,8.8,7.16,29.31,16,41.95,138.67,199.31,277.33-249.53,416-53.32,8.84,12.43,16,18.45,16,9.57q.5-118.6,1-237.2C449,85.44,441.84,64.92,433,52.28ZM33,157.45c58.67,62.83,117.33,19.1,176-33.25q-.5,44.45-1,88.89c-58.67,52.25-117.33,95.32-176,31.28Q32.49,200.92,33,157.45ZM32,363.37v-87c58.67,64,117.33,21,176-31.28v87C149.33,384.34,90.67,427.41,32,363.37ZM416,270c-58.67-62.83-117.33-19.1-176,33.25v-87c58.67-52.35,117.33-96.08,176-33.25Zm0-119c-58.67-62.83-117.33-19.1-176,33.25q.5-44.44,1-88.89C299.67,43.12,358.33.05,417,64.09Q416.51,107.55,416,151Z"/></svg>';case"warp-bulge":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 449 546.15"><path d="M438.38,118.66C341.05-39.17,109.3-39.55,11.32,117.53,5.06,127.76.63,143.83.63,152.5Q.31,273.61,0,392.57c0,8.59,4.4,24.63,10.62,34.91C108,585.32,339.7,585.7,437.68,428.62c6.25-10.23,10.68-26.3,10.69-35q.31-121.11.63-240.08C449,145,444.6,128.94,438.38,118.66ZM23.21,141C68.84,94.1,136.58,68.78,206.1,65q-.58,88.5-1.18,176.93c-69.5.61-137.1,4.43-182.49,11.49Q22.82,197.52,23.21,141ZM22.43,404.4V294c45.39,7.51,113,11.58,182.49,12.23V481.09C135.42,477.05,67.82,451.49,22.43,404.4Zm403.36.8c-45.63,46.84-113.37,72.16-182.89,76V306.25c69.52-.61,137.26-4.64,182.89-12.11Zm0-151.91c-45.63-7-113.37-10.81-182.89-11.38q.58-88.46,1.18-176.85c69.5,4,137.1,29.6,182.49,76.69Q426.18,197.18,425.79,253.29Z"/></svg>';case"warp-arc-lower":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 449 408.57"><path d="M433,0H17A16.17,16.17,0,0,0,1,16.07Q.32,136.07,0,255c.05,8.7,4.44,24.75,10.62,34.91C108,447.75,339.7,448.13,437.68,291.05c6.22-10.12,10.64-26.15,10.67-34.9Q448.52,135.54,449,16A16.11,16.11,0,0,0,433,0ZM31.84,36.42A1533.22,1533.22,0,0,0,208.66,48.17q-1,66.22-2,132.42c-63.47-2.34-126.09-17.16-178.88-44.46Q29.77,86.45,31.84,36.42Zm-8.28,234.7q1.53-49.34,3.07-98.69c51.22,34.58,114.9,53.35,179.64,56.32l-1,130.92C137.06,355,70.51,325.5,23.56,271.12Zm401.08.93c-47.18,54.09-113.84,83.32-182.09,87.7l-.93-130.95C306.38,226,370.13,207.42,421.49,173Zm-4.3-135.46c-52.9,27.16-115.58,41.84-179.06,44q.08-66.25.08-132.47A1533.93,1533.93,0,0,0,418.13,36.3Q419.19,86.28,420.34,136.59Z"/></svg>';case"warp-arc-upper":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 449 408.57"><path d="M438.38,118.66C341.05-39.17,109.3-39.55,11.32,117.53,5.1,127.64.68,143.68.65,152.42Q.49,273,0,392.57a16.1,16.1,0,0,0,16,16H432a16.16,16.16,0,0,0,16-16.07q.66-120,1-238.93C449,144.87,444.56,128.83,438.38,118.66Zm-414,17.87C71.54,82.44,138.2,53.2,206.45,48.82q-.12,66.27-.17,132.51c-64.7,2.95-128.35,21.6-179.61,55.95Q25.55,187.08,24.36,136.53Zm6.51,235.74q-1.53-49.35-3.07-98.69c52.83-27.07,115.42-41.77,178.85-44.09l1,130.93A1531.72,1531.72,0,0,0,30.87,372.27Zm386.29-.12a1533.24,1533.24,0,0,0-176.82-11.74l.93-131c63.44,2.18,126.09,16.74,179,43.67Q418.73,322.64,417.16,372.15Zm4.3-135.46c-51.41-34.17-115.13-52.64-179.85-55.41q1-66.19,2.11-132.38c68.22,4.66,134.77,34.18,181.72,88.55Q423.49,186.9,421.46,236.69Z"/></svg>';case"warp-pit-upper":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 449 261.48"><path d="M437,6.82c-107.81,136.38-316,136.71-424.26,1C5.88-.94.76-1.44.74,7.48Q.48,126,0,245.48a15.84,15.84,0,0,0,16,16H432a15.83,15.83,0,0,0,16-15.93q.62-119.07,1-239.07C449-2.47,443.87-2,437,6.82ZM26.55,51c50.09,46.73,114.73,72,180.54,75.77q-.21,24.76-.37,49.55C143.54,173.81,81.16,157.7,28,128Q27.32,89.38,26.55,51ZM31.16,233.2q-1.15-38.44-2.3-76.9C83.18,179.69,144.77,192.39,207,194.4q.38,24.53.74,49C148.11,242.9,88.65,239.49,31.16,233.2Zm385.7.11c-57.51,6.25-117,9.64-176.6,10.14l.69-49c62.23-1.88,123.87-14.46,178.26-37.73Q418,195,416.86,233.31Zm3.21-104.79C366.83,158.05,304.39,174,241.2,176.4q.9-24.81,1.83-49.65c65.8-4,130.35-29.53,180.27-76.51Q421.71,89.53,420.07,128.52Z"/></svg>';case"warp-pit-lower":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 449 261.48"><path d="M433,0H17A15.84,15.84,0,0,0,1,15.94Q.37,135,0,255c0,8.95,5.13,8.44,12-.34,107.81-136.37,316-136.7,424.26-1,6.88,8.74,12,9.24,12,.33q.25-118.55.74-238A15.84,15.84,0,0,0,433,0ZM32.14,28.18c57.52-6.26,117-9.64,176.6-10.15q-.86,24.8-1.76,49.62c-62.25,2-123.87,14.83-178.14,38.42Q30.46,67,32.14,28.18ZM25.7,211.25q1.14-38.46,2.29-76.9c53.11-29.88,115.52-46.1,178.72-48.66q-.37,24.53-.74,49.05C140.17,138.76,75.62,164.27,25.7,211.25Zm396.75-.8c-50.09-46.74-114.73-72-180.54-75.78q-.34-24.51-.7-49c63.22,2.4,125.68,18.47,178.89,48.19Q421.27,172.15,422.45,210.45Zm-3.21-104.79c-54.36-23.46-116-36.14-178.28-38q.18-24.78.31-49.58c59.62.54,119.08,3.95,176.57,10.24Q418.52,67.13,419.24,105.66Z"/></svg>';case"warp-fish":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 449 427.46"><path d="M433,104.18C294.33,303.49,155.67-145.35,17,50.86,8.16,63.62,1,84.09,1,92.64Q.51,214.52,0,333.23c0,8.44,7.16,29,16,41.95,138.67,199.31,277.33-249.53,416-53.32,8.84,12.76,16,18.9,16,9.78q.5-117.12,1-237.41C449,85,441.84,91.22,433,104.18Zm-400-30c58.67-48,117.33-14.59,176,25.4q-.5,48.19-1,97c-58.67-6-117.33-10.9-176-3.58Q32.49,133.91,33,74.16ZM32,352.48V235.85c58.67,7.8,117.33,2.55,176-3.81v96.54C149.33,368.49,90.67,401.39,32,352.48Zm384-71.32c-58.67-48-117.33-14.59-176,25.4v-78c58.67-6.37,117.33-11.7,176-4.05Zm0-77.53c-58.67,7.19-117.33,2.19-176-3.8q.5-39.42,1-78.25c58.67,39.91,117.33,72.81,176,23.9Q416.51,174.91,416,203.63Z"/></svg>';case"warp-squeeze":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 449 254.41"><path d="M435.46,4.49c-119.78,106.69-301,106.94-421,.76C6.75-1.66.83-.52.83,8.43Q.41,126.84,0,246.7c0,9,5.9,10.17,13.54,3.22,119.78-106.69,301-106.94,421.05-.77,7.66,6.92,13.58,5.78,13.58-3.17q.42-118.41.83-238.28C449-1.3,443.1-2.46,435.46,4.49ZM28.53,43.05C81.24,74.72,144.05,91.83,207.68,94.4q-.54,13.92-1.09,27.88c-63.62-.4-126.36-3-179-7.76Q28.08,78.55,28.53,43.05Zm-.9,168.85V140.71c52.6-5.08,115.34-7.83,179-8.27v27.62C143,162.79,80.23,180.07,27.63,211.9Zm392.84-.54C367.76,179.69,305,162.58,241.32,160V132.43c63.63.41,126.44,3.14,179.15,8.19Zm0-96.76c-52.71,4.74-115.52,7.31-179.15,7.69q.54-14,1.09-27.94c63.62-2.73,126.36-20,179-51.84Q420.92,78.78,420.47,114.6Z"/></svg>';case"settings":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path  d="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zm16 400c0 8.8-7.2 16-16 16H48c-8.8 0-16-7.2-16-16V80c0-8.8 7.2-16 16-16h352c8.8 0 16 7.2 16 16v352zM200 160h-40v-32c0-6.6-5.4-12-12-12h-8c-6.6 0-12 5.4-12 12v32H88c-13.2 0-24 10.8-24 24v48c0 13.2 10.8 24 24 24h40v116c0 6.6 5.4 12 12 12h8c6.6 0 12-5.4 12-12V256h40c13.2 0 24-10.8 24-24v-48c0-13.2-10.8-24-24-24zm-8 64H96v-32h96v32zm168 32h-40V128c0-6.6-5.4-12-12-12h-8c-6.6 0-12 5.4-12 12v128h-40c-13.2 0-24 10.8-24 24v48c0 13.2 10.8 24 24 24h40v20c0 6.6 5.4 12 12 12h8c6.6 0 12-5.4 12-12v-20h40c13.2 0 24-10.8 24-24v-48c0-13.2-10.8-24-24-24zm-8 64h-96v-32h96v32z"></path></svg>';case"slash":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path  d="M637 485.3L23 1.8C19.6-1 14.5-.5 11.8 3l-10 12.5C-1 19-.4 24 3 26.7l614 483.5c3.5 2.8 8.5 2.2 11.2-1.2l10-12.5c2.8-3.5 2.3-8.5-1.2-11.2z"></path></svg>';case"empty":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"></svg>';case"warp-mug":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path  d="M480 64H64a32 32 0 0 0-32 32v256a96 96 0 0 0 96 96h192a96 96 0 0 0 96-96v-96h64a96 96 0 0 0 0-192zm-96 288a64.07 64.07 0 0 1-64 64H128a64.07 64.07 0 0 1-64-64V96h320zm96-128h-64V96h64a64 64 0 0 1 0 128z"></path></svg>';case"close-square":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path  d="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zm16 400c0 8.8-7.2 16-16 16H48c-8.8 0-16-7.2-16-16V80c0-8.8 7.2-16 16-16h352c8.8 0 16 7.2 16 16v352zm-97.2-245.3L249.5 256l69.3 69.3c4.7 4.7 4.7 12.3 0 17l-8.5 8.5c-4.7 4.7-12.3 4.7-17 0L224 281.5l-69.3 69.3c-4.7 4.7-12.3 4.7-17 0l-8.5-8.5c-4.7-4.7-4.7-12.3 0-17l69.3-69.3-69.3-69.3c-4.7-4.7-4.7-12.3 0-17l8.5-8.5c4.7-4.7 12.3-4.7 17 0l69.3 69.3 69.3-69.3c4.7-4.7 12.3-4.7 17 0l8.5 8.5c4.6 4.7 4.6 12.3 0 17z"></path></svg>';case"close":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path  d="M193.94 256L296.5 153.44l21.15-21.15c3.12-3.12 3.12-8.19 0-11.31l-22.63-22.63c-3.12-3.12-8.19-3.12-11.31 0L160 222.06 36.29 98.34c-3.12-3.12-8.19-3.12-11.31 0L2.34 120.97c-3.12 3.12-3.12 8.19 0 11.31L126.06 256 2.34 379.71c-3.12 3.12-3.12 8.19 0 11.31l22.63 22.63c3.12 3.12 8.19 3.12 11.31 0L160 289.94 262.56 392.5l21.15 21.15c3.12 3.12 8.19 3.12 11.31 0l22.63-22.63c3.12-3.12 3.12-8.19 0-11.31L193.94 256z"></path></svg>';case"square":return'<svg   xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zm16 400c0 8.8-7.2 16-16 16H48c-8.8 0-16-7.2-16-16V80c0-8.8 7.2-16 16-16h352c8.8 0 16 7.2 16 16v352z"></path></svg>';case"mesh":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 198.725 198.725"  ><path d="M194.828,0H3.897C1.745,0,0,1.745,0,3.897v190.931c0,2.154,1.745,3.897,3.897,3.897h190.931\nc2.152,0,3.897-1.743,3.897-3.897V3.897C198.724,1.745,196.979,0,194.828,0z M135.336,7.793 c-1.794,7.887-5.085,24.174-6.073,41.085c-5.646-1.308-11.613-2.843-17.707-4.412c-16.791-4.322-34.076-8.731-48.241-9.287\nc3.851-12.645,8.947-23.169,11.117-27.386H135.336z M140.168,115.415c-8.484,1.236-14.626,4.939-20.562,8.586 c-8.348,5.126-16.984,10.43-33.881,10.43c-2.384,0-4.852-0.069-7.364-0.185c-2.669-15.64-8.165-33.341-16.343-52.032\nc-5.081-11.614-3.973-26.095-0.807-39.32c13.572,0.173,31.259,4.706,48.402,9.118c6.676,1.719,13.188,3.386,19.369,4.787 c-0.104,10.231,0.852,20.238,3.727,28.288C136.221,94.92,138.646,105.339,140.168,115.415z M7.793,7.793h57.904\nc-2.904,5.97-7.32,15.966-10.605,27.516C35.965,37.001,17.199,47.237,7.793,53.121V7.793z M7.793,62.433 c5.587-3.795,25.301-16.304,45.27-19.007c-3.023,13.934-3.764,29.158,1.815,41.912c7.629,17.44,12.812,33.863,15.476,48.384\nc-26.972-2.26-56.834-9.239-62.561-10.618C7.793,123.104,7.793,62.433,7.793,62.433z M72.105,161.319 c-1.425,14.256-6.164,25.315-8.246,29.612H7.793v-59.814c9.096,2.155,37.708,8.563,63.77,10.525\nC72.441,148.805,72.691,155.46,72.105,161.319z M72.436,190.931c2.574-5.996,6.162-16.211,7.425-28.836\tc0.6-6.013,0.396-12.767-0.413-19.996c2.131,0.081,4.228,0.125,6.277,0.125c19.101,0,29.119-6.153,37.961-11.583\nc5.622-3.453,10.651-6.485,17.484-7.505c1.621,15.093,1.182,28.805-0.8,37.726c-2.739,12.323-0.178,23.604,1.981,30.069H72.436z M190.93,190.932h-40.296v-0.001c-1.803-4.587-5.412-15.983-2.659-28.379c2.102-9.457,2.599-23.901,0.949-39.754\nc17.307,0.457,35.295,4.937,42.006,6.781V190.932z M190.93,121.497c-8.373-2.215-25.866-6.237-42.98-6.513 c-1.577-10.817-4.146-22.005-7.901-32.519c-2.405-6.734-3.285-15.201-3.281-24.043c6.291,1.197,12.11,1.975,17.145,1.975\nc16.583,0,30.355-0.984,37.017-1.562V121.497z M190.931,51.013c-6.188,0.551-20.108,1.591-37.017,1.591\tc-4.817,0-10.594-0.821-16.929-2.074c0.958-18.006,4.769-35.902,6.36-42.737h47.586V51.013z"/></svg>\n';case"crop":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path  d="M160 16c0-8.84-7.16-16-16-16h-32c-8.84 0-16 7.16-16 16v80H16c-8.84 0-16 7.16-16 16v32c0 8.84 7.16 16 16 16h80v224c0 17.67 14.33 32 32 32h192v-64H160V16zm336 336h-80V128c0-17.67-14.33-32-32-32H192v64h160v336c0 8.84 7.16 16 16 16h32c8.84 0 16-7.16 16-16v-80h80c8.84 0 16-7.16 16-16v-32c0-8.84-7.16-16-16-16z"></path></svg>';case"fill-image":return'<svg xmlns="http://www.w3.org/2000/svg"   viewBox="0 0 500 500"  >\t<rect x="1" y="181.66" width="36" height="32.33"/>\t<rect x="1" y="234.32" width="36" height="32.33"/>\t<rect x="1" y="286.98" width="36" height="32.33"/>\t<path d="M464.23,359.08h-25.8l-88.08-195.22c-1.87-4.15-5.42-7.37-9.8-8.63c-0.11-0.03-0.22-0.06-0.33-0.09\t\tc-10.21-2.76-20.98,1.95-26.48,10.98l-95.27,156.41l-39.93-58.07c-1.84-2.68-4.36-4.86-7.38-6.07c-0.37-0.15-0.74-0.28-1.12-0.41\t\tc-10.57-3.57-22.18,1.18-27.92,10.74l-54.44,90.61H37v-22H1v59h89v-0.29h320.23v0.03h90v-59h-36V359.08z"/>\t<path d="M37,141.33h27.48c4.94,28.88,30.08,50.86,60.36,50.86c30.8,0,56.29-22.74,60.6-52.34h21.31v-36h-26.5\t\tc0-0.01-0.01-0.03-0.01-0.03L69.07,104.3c0,0-0.01,0.02-0.01,0.03H1v59h36V141.33z"/>\t<polygon points="410.23,104.33 410.23,141.33 464.23,141.08 464.23,163.08 500.23,163.08 500.23,104.08 \t"/>\t<rect x="464" y="234.16" width="36" height="32.33"/>\t<rect x="464" y="181.5" width="36" height="32.33"/>\t<rect x="464" y="286.82" width="36" height="32.33"/>\t<rect x="350.91" y="103.85" width="28.83" height="36"/>\t<rect x="293.25" y="103.85" width="28.83" height="36"/>\t<rect x="235.58" y="103.85" width="28.83" height="36"/></svg>';case"fit-image":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 500 500"  xml:space="preserve">\t<path  d="M360.19,104H139.15c-20.2,0-36.58,16.38-36.58,36.58v219.49c0,20.2,16.38,36.58,36.58,36.58h221.04\t\tc20.2,0,36.58-16.38,36.58-36.58V140.58C396.77,120.38,380.39,104,360.19,104z M355.62,360.07h-211.9c-2.53,0-4.57-2.05-4.57-4.57\t\tV145.15c0-2.53,2.05-4.57,4.57-4.57h211.9c2.53,0,4.57,2.05,4.57,4.57V355.5C360.19,358.03,358.14,360.07,355.62,360.07z\t\t M199.42,178.07c-12.8,0-23.18,10.38-23.18,23.18s10.38,23.18,23.18,23.18c12.8,0,23.18-10.38,23.18-23.18\t\tS212.22,178.07,199.42,178.07z M174.73,323.49h148.88v-4.97l-38.7-89.7c-3.57-3.57-9.36-3.57-12.93,0l-34.08,58.09l-20.12-30.12\t\tc-3.57-3.57-9.36-3.57-12.93,0l-30.11,63.12V323.49z"/>\t<path  d="M36,319.31H0v-32.33h36V319.31z M36,266.65H0v-32.33h36V266.65z M36,213.99H0v-32.33h36V213.99z"/>\t<polygon  points="464.23,337.08 500.23,337.08 500.23,396.08 410.23,396.08 420.23,359.08 464.23,359.08 \t"/>\t<polygon  points="36,163.33 0,163.33 0,104.33 89,104.33 79,141.33 36,141.33 \t"/>\t<polygon  points="36,337.33 0,337.33 0,396.33 89,396.33 79,359.33 36,359.33 \t"/>\t<polygon  points="464.23,163.08 500.23,163.08 500.23,104.08 410.23,104.33 420.23,141.33 464.23,141.08 \t"/>\t<path  d="M500,319.15h-36v-32.33h36V319.15z M500,266.49h-36v-32.33h36V266.49z M500,213.83h-36V181.5h36V213.83z"/></svg>';case"vertical-align-bottom-baseline":return'<svg version="1.1" xmlns="http://www.w3.org/2000/svg" \n               x="0px" y="0px" viewBox="0 0 512 512"   >\n           <path d="M177.9,463.9l-3.1-26.3h-1.3c-12,16.4-35.2,31-65.9,31c-43.7,0-65.9-29.7-65.9-59.9c0-50.4,46.3-78,129.6-77.5v-4.3\n                  c0-17.2-4.9-48.2-49-48.2c-20,0-41,6-56.1,15.5l-8.9-25C75,258,100.8,250.7,128,250.7c65.9,0,82,43.5,82,85.3v78\n                  c0,18.1,0.9,35.8,3.6,50H177.9z M172.1,357.5c-42.8-0.9-91.3,6.5-91.3,47c0,24.6,16.9,36.2,37,36.2c28.1,0,45.9-17.2,52.1-34.9\n                  c1.3-3.9,2.2-8.2,2.2-12.1V357.5z"/>\n                  <path d="M459,255.4c-0.9,15.1-1.8,31.9-1.8,57.3v121c0,47.8-9.8,77.1-30.7,95.2c-20.9,19-51.2,25-78.4,25c-25.8,0-54.3-6-71.7-17.2\n                  l9.8-28.9c14.3,8.6,36.5,16.4,63.3,16.4c40.1,0,69.5-20.2,69.5-72.8v-23.3H418c-12,19.4-35.2,34.9-68.6,34.9\n                  c-53.5,0-91.8-43.9-91.8-101.7c0-70.6,47.7-110.7,97.1-110.7c37.4,0,57.9,19,67.3,36.2h0.9l1.8-31.4H459z M418.4,337.7\n                  c0-6.5-0.4-12.1-2.2-17.2c-7.1-22-26.3-40.1-54.8-40.1c-37.4,0-64.1,30.6-64.1,78.8c0,40.9,21.4,75,63.7,75\n                  c24.1,0,45.9-14.6,54.3-38.8c2.2-6.5,3.1-13.8,3.1-20.2V337.7z"/>\n          <rect x="33" y="481.6" width="209.8" height="28.8"/>\n          </svg>';case"vertical-align-bottom":return'<svg version="1.1" xmlns="http://www.w3.org/2000/svg" c\n               c viewBox="0 0 512 512">\n               <path d="M177.9,423.3l-3.1-26.3h-1.3c-12,16.4-35.2,31-65.9,31c-43.7,0-65.9-29.7-65.9-59.9c0-50.4,46.3-78,129.6-77.5v-4.3\n                   c0-17.2-4.9-48.2-49-48.2c-20,0-41,6-56.1,15.5l-8.9-25c17.8-11.2,43.7-18.5,70.8-18.5c65.9,0,82,43.5,82,85.3v78\n                   c0,18.1,0.9,35.8,3.6,50H177.9z M172.1,316.9c-42.8-0.9-91.3,6.5-91.3,47c0,24.6,16.9,36.2,37,36.2c28.1,0,45.9-17.2,52.1-34.9\n                   c1.3-3.9,2.2-8.2,2.2-12.1V316.9z"/>\n               <path d="M459,214.9c-0.9,15.1-1.8,31.9-1.8,57.3v121c0,47.8-9.8,77.1-30.7,95.2c-20.9,19-51.2,25-78.4,25c-25.8,0-54.3-6-71.7-17.2\n                   l9.8-28.9c14.3,8.6,36.5,16.4,63.3,16.4c40.1,0,69.5-20.2,69.5-72.8v-23.3H418c-12,19.4-35.2,34.9-68.6,34.9\n                   c-53.5,0-91.8-43.9-91.8-101.7c0-70.6,47.7-110.7,97.1-110.7c37.4,0,57.9,19,67.3,36.2h0.9l1.8-31.4H459z M418.4,297.1\n                   c0-6.5-0.4-12.1-2.2-17.2c-7.1-22-26.3-40.1-54.8-40.1c-37.4,0-64.1,30.6-64.1,78.8c0,40.9,21.4,75,63.7,75\n                   c24.1,0,45.9-14.6,54.3-38.8c2.2-6.5,3.1-13.8,3.1-20.2V297.1z"/>\n           </svg>';case"vertical-align-center":return'<svg version="1.1" xmlns="http://www.w3.org/2000/svg"  \n               viewBox="0 0 512 512"  >\n             <path d="M183.9,317.1l-3.1-26.3h-1.3c-12,16.4-35.2,31-65.9,31c-43.7,0-65.9-29.7-65.9-59.9c0-50.4,46.3-78,129.6-77.5v-4.3\n                 c0-17.2-4.9-48.2-49-48.2c-20,0-41,6-56.1,15.5l-8.9-25c17.8-11.2,43.7-18.5,70.8-18.5c65.9,0,82,43.5,82,85.3v78\n                 c0,18.1,0.9,35.8,3.6,50H183.9z M178.1,210.7c-42.8-0.9-91.3,6.5-91.3,47c0,24.6,16.9,36.2,37,36.2c28.1,0,45.9-17.2,52.1-34.9\n                 c1.3-3.9,2.2-8.2,2.2-12.1V210.7z"/>\n             <path d="M465,108.7c-0.9,15.1-1.8,31.9-1.8,57.3v121c0,47.8-9.8,77.1-30.7,95.2c-20.9,19-51.2,25-78.4,25c-25.8,0-54.3-6-71.7-17.2\n                 l9.8-28.9c14.3,8.6,36.5,16.4,63.3,16.4c40.1,0,69.5-20.2,69.5-72.8v-23.3H424c-12,19.4-35.2,34.9-68.6,34.9\n                 c-53.5,0-91.8-43.9-91.8-101.7c0-70.6,47.7-110.7,97.1-110.7c37.4,0,57.9,19,67.3,36.2h0.9l1.8-31.4H465z M424.4,190.9\n                 c0-6.5-0.4-12.1-2.2-17.2c-7.1-22-26.3-40.1-54.8-40.1c-37.4,0-64.1,30.6-64.1,78.8c0,40.9,21.4,75,63.7,75\n                 c24.1,0,45.9-14.6,54.3-38.8c2.2-6.5,3.1-13.8,3.1-20.2V190.9z"/>\n         </svg>';case"vertical-align-center-baseline":return'<svg version="1.1" xmlns="http://www.w3.org/2000/svg" \n               viewBox="0 0 512 512" >\n           \n              <path d="M173.9,284.1l-3.1-26.3h-1.3c-12,16.4-35.2,31-65.9,31c-43.7,0-65.9-29.7-65.9-59.9c0-50.4,46.3-78,129.6-77.5v-4.3\n                  c0-17.2-4.9-48.2-49-48.2c-20,0-41,6-56.1,15.5l-8.9-25C71,78.2,96.8,70.9,124,70.9c65.9,0,82,43.5,82,85.3v78\n                  c0,18.1,0.9,35.8,3.6,50H173.9z M168.1,177.7c-42.8-0.9-91.3,6.5-91.3,47c0,24.6,16.9,36.2,37,36.2c28.1,0,45.9-17.2,52.1-34.9\n                  c1.3-3.9,2.2-8.2,2.2-12.1V177.7z"/>\n              <path d="M455,75.7c-0.9,15.1-1.8,31.9-1.8,57.3v121c0,47.8-9.8,77.1-30.7,95.2c-20.9,19-51.2,25-78.4,25c-25.8,0-54.3-6-71.7-17.2\n                  l9.8-28.9c14.3,8.6,36.5,16.4,63.3,16.4c40.1,0,69.5-20.2,69.5-72.8v-23.3H414c-12,19.4-35.2,34.9-68.6,34.9\n                  c-53.5,0-91.8-43.9-91.8-101.7c0-70.6,47.7-110.7,97.1-110.7c37.4,0,57.9,19,67.3,36.2h0.9l1.8-31.4H455z M414.4,157.9\n                  c0-6.5-0.4-12.1-2.2-17.2c-7.1-22-26.3-40.1-54.8-40.1c-37.4,0-64.1,30.6-64.1,78.8c0,40.9,21.4,75,63.7,75\n                  c24.1,0,45.9-14.6,54.3-38.8c2.2-6.5,3.1-13.8,3.1-20.2V157.9z"/>\n           \n          <rect x="35.5" y="295.3" width="209.8" height="28.8"/>\n          </svg>\n          ';case"vertical-align-top":return'<svg version="1.1"   xmlns="http://www.w3.org/2000/svg" \n               viewBox="0 0 512 512"  ><path d="M177.5,216.5l-3.1-26.3H173c-12,16.4-35.2,31-65.9,31c-43.7,0-65.9-29.7-65.9-59.9c0-50.4,46.3-78,129.6-77.5v-4.3\n                     c0-17.2-4.9-48.2-49-48.2c-20,0-41,6-56.1,15.5l-8.9-25c17.8-11.2,43.7-18.5,70.8-18.5c65.9,0,82,43.5,82,85.3v78\n                     c0,18.1,0.9,35.8,3.6,50H177.5z M171.7,110.1c-42.8-0.9-91.3,6.5-91.3,47c0,24.6,16.9,36.2,37,36.2c28.1,0,45.9-17.2,52.1-34.9\n                     c1.3-3.9,2.2-8.2,2.2-12.1V110.1z"/>\n                 <path d="M458.6,8c-0.9,15.1-1.8,31.9-1.8,57.3v121c0,47.8-9.8,77.1-30.7,95.2c-20.9,19-51.2,25-78.4,25c-25.8,0-54.3-6-71.7-17.2\n                     l9.8-28.9c14.3,8.6,36.5,16.4,63.3,16.4c40.1,0,69.5-20.2,69.5-72.8v-23.3h-0.9c-12,19.4-35.2,34.9-68.6,34.9\n                     c-53.5,0-91.8-43.9-91.8-101.7c0-70.6,47.7-110.7,97.1-110.7c37.4,0,57.9,19,67.3,36.2h0.9L424.3,8H458.6z M418,90.2\n                     c0-6.5-0.4-12.1-2.2-17.2C408.7,51,389.5,33,361,33c-37.4,0-64.1,30.6-64.1,78.8c0,40.9,21.4,75,63.7,75\n                     c24.1,0,45.9-14.6,54.3-38.8c2.2-6.5,3.1-13.8,3.1-20.2V90.2z"/>\n              \n             </svg>\n             ';case"warning":return'<svg   xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path  d="M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937 0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154 0l239.94 416.028zM288 354c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"></path></svg>';case"effects":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path  d="M224 96l16-32 32-16-32-16-16-32-16 32-32 16 32 16 16 32zM80 160l26.66-53.33L160 80l-53.34-26.67L80 0 53.34 53.33 0 80l53.34 26.67L80 160zm0-96c8.84 0 16 7.16 16 16s-7.16 16-16 16-16-7.16-16-16 7.16-16 16-16zm352 224l-26.66 53.33L352 368l53.34 26.67L432 448l26.66-53.33L512 368l-53.34-26.67L432 288zm0 96c-8.84 0-16-7.16-16-16s7.16-16 16-16 16 7.16 16 16-7.16 16-16 16zm70.63-306.04L434.04 9.37C427.79 3.12 419.6 0 411.41 0s-16.38 3.12-22.63 9.37L9.37 388.79c-12.5 12.5-12.5 32.76 0 45.25l68.59 68.59c6.25 6.25 14.44 9.37 22.63 9.37s16.38-3.12 22.63-9.37l379.41-379.41c12.49-12.5 12.49-32.76 0-45.26zM100.59 480L32 411.41l258.38-258.4 68.6 68.6L100.59 480zm281.02-281.02l-68.6-68.6L411.38 32h.03L480 100.59l-98.39 98.39z"></path></svg>';case"robot":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path  d="M192,416h64V384H192ZM576,224H544V192a95.99975,95.99975,0,0,0-96-96H336V16a16,16,0,0,0-32,0V96H192a95.99975,95.99975,0,0,0-96,96v32H64a31.99908,31.99908,0,0,0-32,32V384a32.00033,32.00033,0,0,0,32,32H96a95.99975,95.99975,0,0,0,96,96H448a95.99975,95.99975,0,0,0,96-96h32a32.00033,32.00033,0,0,0,32-32V256A31.99908,31.99908,0,0,0,576,224ZM96,384H64V256H96Zm416,32a64.18916,64.18916,0,0,1-64,64H192a64.18916,64.18916,0,0,1-64-64V192a63.99942,63.99942,0,0,1,64-64H448a63.99942,63.99942,0,0,1,64,64Zm64-32H544V256h32ZM416,192a64,64,0,1,0,64,64A64.07333,64.07333,0,0,0,416,192Zm0,96a32,32,0,1,1,32-32A31.97162,31.97162,0,0,1,416,288ZM384,416h64V384H384Zm-96,0h64V384H288ZM224,192a64,64,0,1,0,64,64A64.07333,64.07333,0,0,0,224,192Zm0,96a32,32,0,1,1,32-32A31.97162,31.97162,0,0,1,224,288Z"></path></svg>';case"microchip":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path  d="M368 0H144c-26.51 0-48 21.49-48 48v416c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48V48c0-26.51-21.49-48-48-48zm16 464c0 8.822-7.178 16-16 16H144c-8.822 0-16-7.178-16-16V48c0-8.822 7.178-16 16-16h224c8.822 0 16 7.178 16 16v416zm128-358v12a6 6 0 0 1-6 6h-18v6a6 6 0 0 1-6 6h-42V88h42a6 6 0 0 1 6 6v6h18a6 6 0 0 1 6 6zm0 96v12a6 6 0 0 1-6 6h-18v6a6 6 0 0 1-6 6h-42v-48h42a6 6 0 0 1 6 6v6h18a6 6 0 0 1 6 6zm0 96v12a6 6 0 0 1-6 6h-18v6a6 6 0 0 1-6 6h-42v-48h42a6 6 0 0 1 6 6v6h18a6 6 0 0 1 6 6zm0 96v12a6 6 0 0 1-6 6h-18v6a6 6 0 0 1-6 6h-42v-48h42a6 6 0 0 1 6 6v6h18a6 6 0 0 1 6 6zM30 376h42v48H30a6 6 0 0 1-6-6v-6H6a6 6 0 0 1-6-6v-12a6 6 0 0 1 6-6h18v-6a6 6 0 0 1 6-6zm0-96h42v48H30a6 6 0 0 1-6-6v-6H6a6 6 0 0 1-6-6v-12a6 6 0 0 1 6-6h18v-6a6 6 0 0 1 6-6zm0-96h42v48H30a6 6 0 0 1-6-6v-6H6a6 6 0 0 1-6-6v-12a6 6 0 0 1 6-6h18v-6a6 6 0 0 1 6-6zm0-96h42v48H30a6 6 0 0 1-6-6v-6H6a6 6 0 0 1-6-6v-12a6 6 0 0 1 6-6h18v-6a6 6 0 0 1 6-6z"></path></svg>';case"record":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path   d="M160 352c53.02 0 96-42.98 96-96V96c0-53.02-42.98-96-96-96S64 42.98 64 96v160c0 53.02 42.98 96 96 96zM96 96c0-35.29 28.71-64 64-64s64 28.71 64 64v160c0 35.29-28.71 64-64 64s-64-28.71-64-64V96zm216 96h-16c-4.42 0-8 3.58-8 8v56c0 73.46-62.2 132.68-136.73 127.71C83.3 379.18 32 319.61 32 251.49V200c0-4.42-3.58-8-8-8H8c-4.42 0-8 3.58-8 8v50.34c0 83.39 61.65 156.12 144 164.43V480H72c-4.42 0-8 3.58-8 8v16c0 4.42 3.58 8 8 8h176c4.42 0 8-3.58 8-8v-16c0-4.42-3.58-8-8-8h-72v-65.01C256.71 406.9 320 338.8 320 256v-56c0-4.42-3.58-8-8-8z"></path></svg>';case"play":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path  d="M424.4 214.7L72.4 6.6C43.8-10.3 0 6.1 0 47.9V464c0 37.5 40.7 60.1 72.4 41.3l352-208c31.4-18.5 31.5-64.1 0-82.6zm-16.2 55.1l-352 208C45.6 483.9 32 476.6 32 464V47.9c0-16.3 16.4-18.4 24.1-13.8l352 208.1c10.5 6.2 10.5 21.4.1 27.6z"></path></svg>';case"running":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path  d="M396 216h-14.53l-9.04-27.12c-8.11-24.31-24.18-44-44.5-58.04C347 117.91 360 96.73 360 72c0-39.7-32.3-72-72-72s-72 32.3-72 72c0 8.34 1.56 16.28 4.2 23.72-8.62-1.98-17.37-3.22-26.13-3.22-20.55 0-40.8 5.53-58.64 16l-46.19 24.07C64.7 147.31 56.7 179.3 71.4 203.88c9.39 15.62 26.48 25.27 44.63 25.27 8.98 0 17.82-2.33 25.65-6.76l18.95-9.85L101.75 344H52c-28.67 0-52 23.33-52 52s23.33 52 52 52h62.91c33.65 0 63.95-19.99 77.2-50.92l19.32-39.74 43.7 19.63-19.64 68.74c-7.87 27.58 8.15 56.42 35.71 64.29 4.8 1.34 9.55 2 14.31 2 23.07 0 43.62-15.5 49.98-37.69l24.4-85.4c7.11-24.86 2.02-50.92-12.01-71.12 6.2 1.45 12.63 2.21 19.2 2.21H396c28.67 0 52-23.33 52-52s-23.33-52-52-52zM288 32c22.09 0 40 17.91 40 40s-17.91 40-40 40-40-17.91-40-40 17.91-40 40-40zM162.69 384.48A51.915 51.915 0 0 1 114.91 416H52c-11.05 0-20-8.95-20-20s8.95-20 20-20h62.91c4.8 0 9.12-2.86 11.03-7.28l26.72-56.88c6.9 12.72 17.07 23.57 29.98 31.43l-19.95 41.21zM396 288h-28.94a51.94 51.94 0 0 1-49.33-35.55l-13.59-40.8c-2.83-8.46-8.21-15.43-15-20.67l-41.47 103.69 52.78 23.72c23.41 10.55 35.72 37.09 28.67 61.73l-24.39 85.38c-2.52 8.78-10.52 14.5-19.22 14.5-1.83 0-3.67-.25-5.52-.77-10.61-3.03-16.77-14.11-13.73-24.73l24.39-85.38c1.64-5.69-1.22-11.81-6.62-14.25 0 0-85.82-39.04-88.71-41.16-17.8-13.09-25.42-36.48-18.51-57.88l37.75-87.57s-16.9-3.77-20.5-3.77c-7.88 0-15.59 2.14-22.5 6.31l-45.25 23.52a20.137 20.137 0 0 1-10.29 2.84c-6.8 0-13.41-3.46-17.16-9.7-5.67-9.48-2.61-21.77 6.86-27.45l45.26-23.52c13.24-7.93 28.06-11.99 43.1-11.99 6.83 0 13.72.84 20.51 2.53l68.19 17.05c28 6.98 50.17 27.52 59.31 54.92l13.59 40.8c1.64 4.91 6.22 8.2 11.39 8.2H396c11.05 0 20 8.95 20 20s-8.95 20-20 20z"></path></svg>';case"rotator":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M212.333 224.333H12c-6.627 0-12-5.373-12-12V12C0 5.373 5.373 0 12 0h48c6.627 0 12 5.373 12 12v78.112C117.773 39.279 184.26 7.47 258.175 8.007c136.906.994 246.448 111.623 246.157 248.532C504.041 393.258 393.12 504 256.333 504c-64.089 0-122.496-24.313-166.51-64.215-5.099-4.622-5.334-12.554-.467-17.42l33.967-33.967c4.474-4.474 11.662-4.717 16.401-.525C170.76 415.336 211.58 432 256.333 432c97.268 0 176-78.716 176-176 0-97.267-78.716-176-176-176-58.496 0-110.28 28.476-142.274 72.333h98.274c6.627 0 12 5.373 12 12v48c0 6.627-5.373 12-12 12z"></path></svg>';case"lock-closed":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path  d="M224 420c-11 0-20-9-20-20v-64c0-11 9-20 20-20s20 9 20 20v64c0 11-9 20-20 20zm224-148v192c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V272c0-26.5 21.5-48 48-48h16v-64C64 71.6 136-.3 224.5 0 312.9.3 384 73.1 384 161.5V224h16c26.5 0 48 21.5 48 48zM96 224h256v-64c0-70.6-57.4-128-128-128S96 89.4 96 160v64zm320 240V272c0-8.8-7.2-16-16-16H48c-8.8 0-16 7.2-16 16v192c0 8.8 7.2 16 16 16h352c8.8 0 16-7.2 16-16z"></path></svg>';case"lock-open":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path  d="M480.5 0C392-.3 320 71.6 320 160v64H48c-26.5 0-48 21.5-48 48v192c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V272c0-26.5-21.5-48-48-48h-48v-62.6c0-70.7 56.7-129 127.3-129.4C550.2 31.6 608 89.2 608 160v84c0 6.6 5.4 12 12 12h8c6.6 0 12-5.4 12-12v-82.5C640 73.1 568.9.3 480.5 0zM400 256c8.8 0 16 7.2 16 16v192c0 8.8-7.2 16-16 16H48c-8.8 0-16-7.2-16-16V272c0-8.8 7.2-16 16-16h352z"></path></svg>';case"user-lock-closed":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path  d="M48 480a16 16 0 0 1-16-16v-41.6A102.47 102.47 0 0 1 134.4 320c19.6 0 39.1 16 89.6 16s70-16 89.6-16c2.7 0 5.3.6 7.9.8a79.45 79.45 0 0 1 13.1-30.7 132.34 132.34 0 0 0-21.1-2.1c-28.7 0-42.5 16-89.6 16s-60.8-16-89.6-16C60.2 288 0 348.2 0 422.4V464a48 48 0 0 0 48 48h288.4a78.34 78.34 0 0 1-14.8-32zm176-224A128 128 0 1 0 96 128a128 128 0 0 0 128 128zm0-224a96 96 0 1 1-96 96 96.15 96.15 0 0 1 96-96zm272 336a32 32 0 1 0 32 32 32 32 0 0 0-32-32zm96-80h-16v-48a80 80 0 0 0-160 0v48h-16a48 48 0 0 0-48 48v128a48 48 0 0 0 48 48h192a48 48 0 0 0 48-48V336a48 48 0 0 0-48-48zm-144-48a48 48 0 0 1 96 0v48h-96zm160 224a16 16 0 0 1-16 16H400a16 16 0 0 1-16-16V336a16 16 0 0 1 16-16h192a16 16 0 0 1 16 16z"></path></svg>';case"user-crown-solid":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path  d="M352 0l-64 32-64-32-64 32L96 0v96h256V0zm-38.4 304h-16.71c-22.24 10.18-46.88 16-72.89 16s-50.65-5.82-72.89-16H134.4C60.17 304 0 364.17 0 438.4V464c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48v-25.6c0-74.23-60.17-134.4-134.4-134.4zM224 272c70.69 0 128-57.31 128-128v-16H96v16c0 70.69 57.31 128 128 128z"></path></svg>';case"user-solid":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"></path></svg>';case"user-lock-opened":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path  d="M592,288H448V208.79c0-26.32,20.86-48.34,47.18-48.78A48,48,0,0,1,544,208v8a8,8,0,0,0,8,8h16a8,8,0,0,0,8-8v-7c0-43.28-34-79.51-77.26-80.95A80,80,0,0,0,416,208v80H400a48,48,0,0,0-48,48V464a48,48,0,0,0,48,48H592a48,48,0,0,0,48-48V336A48,48,0,0,0,592,288Zm16,176a16,16,0,0,1-16,16H400a16,16,0,0,1-16-16V336a16,16,0,0,1,16-16H592a16,16,0,0,1,16,16ZM224,256A128,128,0,1,0,96,128,128,128,0,0,0,224,256Zm0-224a96,96,0,1,1-96,96A96,96,0,0,1,224,32ZM496,368a32,32,0,1,0,32,32A32,32,0,0,0,496,368ZM48,480a16,16,0,0,1-16-16V422.4A102.47,102.47,0,0,1,134.4,320c19.6,0,39.1,16,89.6,16s70-16,89.6-16c2.7,0,5.3.6,7.9.8a79.38,79.38,0,0,1,13.1-30.7,132.22,132.22,0,0,0-21.1-2.1c-28.7,0-42.5,16-89.6,16s-60.8-16-89.6-16C60.2,288,0,348.2,0,422.4V464a48,48,0,0,0,48,48H336.4a78.37,78.37,0,0,1-14.8-32Z"></path></svg>';case"link":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path  d="M301.148 394.702l-79.2 79.19c-50.778 50.799-133.037 50.824-183.84 0-50.799-50.778-50.824-133.037 0-183.84l79.19-79.2a132.833 132.833 0 0 1 3.532-3.403c7.55-7.005 19.795-2.004 20.208 8.286.193 4.807.598 9.607 1.216 14.384.481 3.717-.746 7.447-3.397 10.096-16.48 16.469-75.142 75.128-75.3 75.286-36.738 36.759-36.731 96.188 0 132.94 36.759 36.738 96.188 36.731 132.94 0l79.2-79.2.36-.36c36.301-36.672 36.14-96.07-.37-132.58-8.214-8.214-17.577-14.58-27.585-19.109-4.566-2.066-7.426-6.667-7.134-11.67a62.197 62.197 0 0 1 2.826-15.259c2.103-6.601 9.531-9.961 15.919-7.28 15.073 6.324 29.187 15.62 41.435 27.868 50.688 50.689 50.679 133.17 0 183.851zm-90.296-93.554c12.248 12.248 26.362 21.544 41.435 27.868 6.388 2.68 13.816-.68 15.919-7.28a62.197 62.197 0 0 0 2.826-15.259c.292-5.003-2.569-9.604-7.134-11.67-10.008-4.528-19.371-10.894-27.585-19.109-36.51-36.51-36.671-95.908-.37-132.58l.36-.36 79.2-79.2c36.752-36.731 96.181-36.738 132.94 0 36.731 36.752 36.738 96.181 0 132.94-.157.157-58.819 58.817-75.3 75.286-2.651 2.65-3.878 6.379-3.397 10.096a163.156 163.156 0 0 1 1.216 14.384c.413 10.291 12.659 15.291 20.208 8.286a131.324 131.324 0 0 0 3.532-3.403l79.19-79.2c50.824-50.803 50.799-133.062 0-183.84-50.802-50.824-133.062-50.799-183.84 0l-79.2 79.19c-50.679 50.682-50.688 133.163 0 183.851z"></path></svg>';case"stroke-cap-round":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64"><path d="M64,29.58V0H32C14.33,0,0,14.33,0,32v0c0,17.67,14.33,32,32,32h32V34.51H39.27v4.87H24.59V24.7h14.68v4.88H64z"/></svg>';case"stroke-cap-projecting":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" >\t<polygon  points="64,29.58 64,0 0,0 0,64 64,64 64,34.51 39.27,34.51 39.27,39.38 24.59,39.38 24.59,24.7 39.27,24.7 39.27,29.58 \t"/></svg>';case"stroke-cap-butt":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64"><polygon points="39.27,29.54 63.92,29.54 64,29.54 64,0 31.96,0 31.96,21.66 21.51,21.66 21.51,42.34 31.96,42.34 31.96,64 64,64 64,34.47 63.92,34.47 39.27,34.47 39.19,34.47 39.19,39.34 31.96,39.34 24.51,39.34 24.51,24.66 31.96,24.66 39.19,24.66 39.19,29.54 \t"/></svg>';case"stroke-align-center":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64"><polygon points="0,64 64,64 64,45.54 30.34,45.54 30.34,50.41 15.66,50.41 15.66,35.73 20.54,35.73 20.54,0 0,0 "/><polygon  points="30.34,35.73 30.34,40.61 64,40.61 64,23.23 42.77,23.23 42.77,0 25.47,0 25.47,35.73 "/></svg>';case"stroke-align-inside":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64"><polygon points="17.54,32.73 15.66,32.73 12.66,32.73 12.66,53.41 33.34,53.41 33.34,48.54 64,48.54 64,45.54 30.34,45.54 30.34,50.41 15.66,50.41 15.66,35.73 20.54,35.73 20.54,0 17.54,0 \t"/><polygon points="30.34,35.73 30.34,40.61 64,40.61 64,16.23 48.77,16.23 48.77,0 25.47,0 25.47,35.73 \t"/></svg>';case"stroke-align-outside":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" >\t<polygon points="0,64 64,64 64,45.54 30.34,45.54 30.34,50.41 15.66,50.41 15.66,35.73 20.54,35.73 20.54,0 0,0 "/>\t<polygon points="64,37.61 33.34,37.61 33.34,35.73 33.34,32.73 30.34,32.73 28.47,32.73 28.47,0 25.47,0 25.47,35.73 30.34,35.73 30.34,40.61 64,40.61"/></svg>';case"stroke-join-miter":return'<svg   xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" style="enable-background:new 0 0 64 64;" xml:space="preserve"><polygon  points="0,0 0,64 29.46,64 29.46,39.34 24.59,39.34 24.59,39.34 24.59,24.66 39.27,24.66 39.27,24.66 39.27,29.54 64,29.54 64,0 "/><polygon points="39.27,39.34 39.27,39.34 39.27,39.34 34.39,39.34 34.39,64 48.77,64 48.77,48.77 64,48.77 64,34.47 39.27,34.47"/></svg>';case"stroke-join-round":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" ><path  d="M0,36.75V64h29.46V39.34h-4.87v0V24.66h14.68h0v4.88H64V0H36.75C17.56,0,0,17.56,0,36.75z"/><polygon points="39.27,39.34 39.27,39.34 39.27,39.34 34.39,39.34 34.39,64 48.77,64 48.77,48.77 64,48.77 64,34.47 39.27,34.47 "/>';case"stroke-join-bevel":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64"><polygon class="st0" points="0,32 0,64 29.46,64 29.46,39.34 24.59,39.34 24.59,39.34 24.59,24.66 39.27,24.66 39.27,24.66 39.27,29.54 64,29.54 64,0 32,0 "/><polygon class="st0" points="39.27,39.34 39.27,39.34 39.27,39.34 34.39,39.34 34.39,64 48.77,64 48.77,48.77 64,48.77 64,34.47 39.27,34.47 "/></svg>';case"ruler":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path  d="M635.7 165.8L556.1 27.9C550.2 17.7 539.5 12 528.5 12c-5.4 0-10.9 1.4-15.9 4.3L15.9 302.8C.7 311.5-4.5 331 4.3 346.2L83.9 484c5.9 10.2 16.6 15.9 27.6 15.9 5.4 0 10.9-1.4 15.9-4.3L624 209.1c15.3-8.6 20.5-28.1 11.7-43.3zM111.5 468.2L31.9 330.3l69-39.8 43.8 75.8c2.2 3.8 7.1 5.1 10.9 2.9l13.8-8c3.8-2.2 5.1-7.1 2.9-10.9l-43.8-75.8 55.2-31.8 27.9 48.2c2.2 3.8 7.1 5.1 10.9 2.9l13.8-8c3.8-2.2 5.1-7.1 2.9-10.9l-27.9-48.2 55.2-31.8 43.8 75.8c2.2 3.8 7.1 5.1 10.9 2.9l13.8-8c3.8-2.2 5.1-7.1 2.9-10.9L294 179.1l55.2-31.8 27.9 48.2c2.2 3.8 7.1 5.1 10.9 2.9l13.8-8c3.8-2.2 5.1-7.1 2.9-10.9l-27.9-48.2L432 99.5l43.8 75.8c2.2 3.8 7.1 5.1 10.9 2.9l13.8-8c3.8-2.2 5.1-7.1 2.9-10.9l-43.8-75.8 69-39.8 79.6 137.8-496.7 286.7z"></path></svg>';case"no-wrap":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" >\t<rect y="57.5"  width="64" height="5"/>\t<rect x="18.32" y="34.5" class="st0" width="27.36" height="9"/>\t<rect x="18.32" y="48.5" class="st0" width="27.36" height="3.42"/>\t<rect x="47.68" y="43.5" class="st0" width="16.32" height="5"/>\t<rect y="43.5"  width="16.32" height="5"/>\t<rect x="18.32" y="20.5" class="st0" width="27.36" height="9"/>\t<rect x="47.68" y="29.5" class="st0" width="16.32" height="5"/>\t<rect y="29.5"  width="16.32" height="5"/>\t<rect x="18.32" y="12.15" class="st0" width="27.36" height="3.35"/>\t<rect y="15.5"  width="16.32" height="5"/><rect x="47.68" y="15.5"  width="16.32" height="5"/><rect y="1.5" width="64" height="5"/><rect x="12.32" y="11.15" width="39.36" height="41.77"/></svg>';case"wrap-both-sides":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64"> <rect y="57.5" class="st0" width="64" height="5"/><path class="st0" d="M14.47,43.5H0v5h17.26C16.17,46.99,15.23,45.31,14.47,43.5z"/><path class="st0" d="M49.53,43.5c-0.76,1.81-1.7,3.49-2.79,5H64v-5H49.53z"/>\t<path class="st0" d="M12.21,32.08c0-0.87,0.04-1.73,0.11-2.58H0v5h12.31C12.24,33.7,12.21,32.89,12.21,32.08z"/><path class="st0" d="M51.68,29.5c0.07,0.85,0.11,1.71,0.11,2.58c0,0.82-0.03,1.63-0.1,2.42H64v-5H51.68z"/>\t<path class="st0" d="M17.36,15.5H0v5h14.53C15.31,18.69,16.26,17.01,17.36,15.5z"/>\t<path class="st0" d="M46.64,15.5c1.1,1.51,2.05,3.19,2.83,5H64v-5H46.64z"/><rect y="1.5" class="st0" width="64" height="5"/>\t<ellipse class="st0" cx="32" cy="32.07" rx="12.54" ry="15.18"/></svg>';case"printess-wand":return'<svg  xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 64 64">\t<path   d="M58.08,21.21l-7.11-7.55l2.19-10.13c0.16-0.74-0.12-1.52-0.71-1.99s-1.41-0.57-2.1-0.24l-9.38,4.42L32.01,0.5\t\tc-0.66-0.38-1.48-0.36-2.11,0.06c-0.63,0.42-0.98,1.17-0.88,1.92l1.31,10.29l-7.73,6.91c-0.57,0.51-0.8,1.29-0.59,2.03\t\tc0.2,0.73,0.81,1.29,1.55,1.43l7.4,1.4L5.41,55.96c-0.87,1.07-0.71,2.65,0.36,3.52c0.46,0.38,1.02,0.56,1.58,0.56\t\tc0.73,0,1.45-0.32,1.94-0.92l25.6-31.48l3.05,6.92c0.31,0.7,0.98,1.16,1.74,1.19c0.03,0,0.06,0,0.09,0c0.73,0,1.4-0.4,1.75-1.04\t\tl4.98-9.09l10.32-1.05c0.76-0.08,1.41-0.58,1.67-1.29C58.76,22.56,58.6,21.76,58.08,21.21z M45.06,21.74\t\tc-0.66,0.07-1.24,0.45-1.55,1.03l-3.54,6.46l-2.97-6.74c-0.27-0.6-0.81-1.04-1.46-1.16l-7.24-1.37l5.49-4.91\t\tc0.49-0.44,0.73-1.09,0.65-1.74L33.5,6l6.37,3.71c0.57,0.33,1.27,0.36,1.86,0.08l6.66-3.14l-1.56,7.2\t\tc-0.14,0.64,0.05,1.31,0.5,1.79L52.39,21L45.06,21.74z"/>\t<polygon   points="12.92,5.15 10.56,9.47 6.25,11.83 10.56,14.19 12.92,18.5 15.28,14.19 19.6,11.83 15.28,9.47 \t\t12.92,5.15 \t"/>\t<path  d="M49.4,40.73c1.38,0,2.77,1,2.77,2.63c0,1.81-1.7,2.63-2.63,2.63s-2.63-0.9-2.63-2.63\t\tc0-2.29,2.02-2.63,2.63-2.63 M49.54,34.48l-3.14,5.74l-5.74,3.14l5.74,3.14l3.14,5.74l3.14-5.74l5.74-3.14l-5.74-3.14L49.54,34.48\t\tL49.54,34.48z"/></svg>';case"shopping-cart":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path  d="M551.991 64H129.28l-8.329-44.423C118.822 8.226 108.911 0 97.362 0H12C5.373 0 0 5.373 0 12v8c0 6.627 5.373 12 12 12h78.72l69.927 372.946C150.305 416.314 144 431.42 144 448c0 35.346 28.654 64 64 64s64-28.654 64-64a63.681 63.681 0 0 0-8.583-32h145.167a63.681 63.681 0 0 0-8.583 32c0 35.346 28.654 64 64 64 35.346 0 64-28.654 64-64 0-17.993-7.435-34.24-19.388-45.868C506.022 391.891 496.76 384 485.328 384H189.28l-12-64h331.381c11.368 0 21.177-7.976 23.496-19.105l43.331-208C578.592 77.991 567.215 64 551.991 64zM240 448c0 17.645-14.355 32-32 32s-32-14.355-32-32 14.355-32 32-32 32 14.355 32 32zm224 32c-17.645 0-32-14.355-32-32s14.355-32 32-32 32 14.355 32 32-14.355 32-32 32zm38.156-192H171.28l-36-192h406.876l-40 192z"></path></svg>';case"shopping-cart-solid":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path  d="M528.12 301.319l47.273-208C578.806 78.301 567.391 64 551.99 64H159.208l-9.166-44.81C147.758 8.021 137.93 0 126.529 0H24C10.745 0 0 10.745 0 24v16c0 13.255 10.745 24 24 24h69.883l70.248 343.435C147.325 417.1 136 435.222 136 456c0 30.928 25.072 56 56 56s56-25.072 56-56c0-15.674-6.447-29.835-16.824-40h209.647C430.447 426.165 424 440.326 424 456c0 30.928 25.072 56 56 56s56-25.072 56-56c0-22.172-12.888-41.332-31.579-50.405l5.517-24.276c3.413-15.018-8.002-29.319-23.403-29.319H218.117l-6.545-32h293.145c11.206 0 20.92-7.754 23.403-18.681z"></path></svg>';case"shopping-cart-add":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path  d="M551.991 64H129.28l-8.329-44.423C118.822 8.226 108.911 0 97.362 0H12C5.373 0 0 5.373 0 12v8c0 6.627 5.373 12 12 12h78.72l69.927 372.946C150.305 416.314 144 431.42 144 448c0 35.346 28.654 64 64 64s64-28.654 64-64a63.681 63.681 0 0 0-8.583-32h145.167a63.681 63.681 0 0 0-8.583 32c0 35.346 28.654 64 64 64 35.346 0 64-28.654 64-64 0-17.993-7.435-34.24-19.388-45.868C506.022 391.891 496.76 384 485.328 384H189.28l-12-64h331.381c11.368 0 21.177-7.976 23.496-19.105l43.331-208C578.592 77.991 567.215 64 551.991 64zM240 448c0 17.645-14.355 32-32 32s-32-14.355-32-32 14.355-32 32-32 32 14.355 32 32zm224 32c-17.645 0-32-14.355-32-32s14.355-32 32-32 32 14.355 32 32-14.355 32-32 32zm38.156-192H171.28l-36-192h406.876l-40 192zm-106.641-75.515l-51.029 51.029c-4.686 4.686-12.284 4.686-16.971 0l-51.029-51.029c-7.56-7.56-2.206-20.485 8.485-20.485H320v-52c0-6.627 5.373-12 12-12h8c6.627 0 12 5.373 12 12v52h35.029c10.691 0 16.045 12.926 8.486 20.485z"></path></svg>';case"folder-plus":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M464,128H272L217.37,73.37A32,32,0,0,0,194.74,64H48A48,48,0,0,0,0,112V400a48,48,0,0,0,48,48H464a48,48,0,0,0,48-48V176A48,48,0,0,0,464,128Zm16,272a16,16,0,0,1-16,16H48a16,16,0,0,1-16-16V112A16,16,0,0,1,48,96H194.74l54.63,54.63A32,32,0,0,0,272,160H464a16,16,0,0,1,16,16ZM339.5,272h-68V204a12,12,0,0,0-12-12h-8a12,12,0,0,0-12,12v68h-68a12,12,0,0,0-12,12v8a12,12,0,0,0,12,12h68v68a12,12,0,0,0,12,12h8a12,12,0,0,0,12-12V304h68a12,12,0,0,0,12-12v-8A12,12,0,0,0,339.5,272Z"></path></svg>';case"eye-solid":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M572.52 241.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 0 0 0 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 0 0 0-29.19zM288 400a144 144 0 1 1 144-144 143.93 143.93 0 0 1-144 144zm0-240a95.31 95.31 0 0 0-25.31 3.79 47.85 47.85 0 0 1-66.9 66.9A95.78 95.78 0 1 0 288 160z"></path></svg>';case"eye-solid-slash":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path  d="M320 400c-75.85 0-137.25-58.71-142.9-133.11L72.2 185.82c-13.79 17.3-26.48 35.59-36.72 55.59a32.35 32.35 0 0 0 0 29.19C89.71 376.41 197.07 448 320 448c26.91 0 52.87-4 77.89-10.46L346 397.39a144.13 144.13 0 0 1-26 2.61zm313.82 58.1l-110.55-85.44a331.25 331.25 0 0 0 81.25-102.07 32.35 32.35 0 0 0 0-29.19C550.29 135.59 442.93 64 320 64a308.15 308.15 0 0 0-147.32 37.7L45.46 3.37A16 16 0 0 0 23 6.18L3.37 31.45A16 16 0 0 0 6.18 53.9l588.36 454.73a16 16 0 0 0 22.46-2.81l19.64-25.27a16 16 0 0 0-2.82-22.45zm-183.72-142l-39.3-30.38A94.75 94.75 0 0 0 416 256a94.76 94.76 0 0 0-121.31-92.21A47.65 47.65 0 0 1 304 192a46.64 46.64 0 0 1-1.54 10l-73.61-56.89A142.31 142.31 0 0 1 320 112a143.92 143.92 0 0 1 144 144c0 21.63-5.29 41.79-13.9 60.11z"></path></svg>';case"lock-closed-solid":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M400 224h-24v-72C376 68.2 307.8 0 224 0S72 68.2 72 152v72H48c-26.5 0-48 21.5-48 48v192c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V272c0-26.5-21.5-48-48-48zm-104 0H152v-72c0-39.7 32.3-72 72-72s72 32.3 72 72v72z"></path></svg>';case"print-solid":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path  d="M448 192V77.25c0-8.49-3.37-16.62-9.37-22.63L393.37 9.37c-6-6-14.14-9.37-22.63-9.37H96C78.33 0 64 14.33 64 32v160c-35.35 0-64 28.65-64 64v112c0 8.84 7.16 16 16 16h48v96c0 17.67 14.33 32 32 32h320c17.67 0 32-14.33 32-32v-96h48c8.84 0 16-7.16 16-16V256c0-35.35-28.65-64-64-64zm-64 256H128v-96h256v96zm0-224H128V64h192v48c0 8.84 7.16 16 16 16h48v96zm48 72c-13.25 0-24-10.75-24-24 0-13.26 10.75-24 24-24s24 10.74 24 24c0 13.25-10.75 24-24 24z"></path></svg>';case"carret-down-solid":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path d="M31.3 192h257.3c17.8 0 26.7 21.5 14.1 34.1L174.1 354.8c-7.8 7.8-20.5 7.8-28.3 0L17.2 226.1C4.6 213.5 13.5 192 31.3 192z"></path></svg>';case"carret-right-solid":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 192 512"><path  d="M0 384.662V127.338c0-17.818 21.543-26.741 34.142-14.142l128.662 128.662c7.81 7.81 7.81 20.474 0 28.284L34.142 398.804C21.543 411.404 0 402.48 0 384.662z"></path></svg>';case"font":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M424 448h-36.6L247.13 42.77A16 16 0 0 0 232 32h-16a16 16 0 0 0-15.12 10.77L60.6 448H24a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h112a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H94.48l44.3-128h170.44l44.31 128H312a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h112a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8zM149.86 288L224 73.8 298.14 288z"></path></svg>';case"check-square":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path  d="M400 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V80c0-26.51-21.49-48-48-48zm0 32c8.823 0 16 7.178 16 16v352c0 8.822-7.177 16-16 16H48c-8.822 0-16-7.178-16-16V80c0-8.822 7.178-16 16-16h352m-34.301 98.293l-8.451-8.52c-4.667-4.705-12.265-4.736-16.97-.068l-163.441 162.13-68.976-69.533c-4.667-4.705-12.265-4.736-16.97-.068l-8.52 8.451c-4.705 4.667-4.736 12.265-.068 16.97l85.878 86.572c4.667 4.705 12.265 4.736 16.97.068l180.48-179.032c4.704-4.667 4.735-12.265.068-16.97z"></path></svg>';case"user-circle":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm128 421.6c-35.9 26.5-80.1 42.4-128 42.4s-92.1-15.9-128-42.4V416c0-35.3 28.7-64 64-64 11.1 0 27.5 11.4 64 11.4 36.6 0 52.8-11.4 64-11.4 35.3 0 64 28.7 64 64v13.6zm30.6-27.5c-6.8-46.4-46.3-82.1-94.6-82.1-20.5 0-30.4 11.4-64 11.4S204.6 320 184 320c-48.3 0-87.8 35.7-94.6 82.1C53.9 363.6 32 312.4 32 256c0-119.1 96.9-216 216-216s216 96.9 216 216c0 56.4-21.9 107.6-57.4 146.1zM248 120c-48.6 0-88 39.4-88 88s39.4 88 88 88 88-39.4 88-88-39.4-88-88-88zm0 144c-30.9 0-56-25.1-56-56s25.1-56 56-56 56 25.1 56 56-25.1 56-56 56z"></path></svg>';case"send-back":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path d="M175 64H79a16 16 0 0 0-16 16v96a16 16 0 0 0 16 16h96a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm-16 96H95V96h64zm288-16v80h32v-80a48 48 0 0 0-48-48H287v32h144a16 16 0 0 1 16 16zm112 176h-96a16 16 0 0 0-16 16v96a16 16 0 0 0 16 16h96a16 16 0 0 0 16-16v-96a16 16 0 0 0-16-16zm-16 96h-64v-64h64zm48-160H431a48 48 0 0 0-48 48v160a48 48 0 0 0 48 48h160a48 48 0 0 0 48-48V304a48 48 0 0 0-48-48zm16 208a16 16 0 0 1-16 16H431a16 16 0 0 1-16-16V304a16 16 0 0 1 16-16h160a16 16 0 0 1 16 16zm-416-96v-80h-32v80a48 48 0 0 0 48 48h144v-32H207a16 16 0 0 1-16-16zm64-160V48a48 48 0 0 0-48-48H47A48 48 0 0 0-1 48v160a48 48 0 0 0 48 48h160a48 48 0 0 0 48-48zm-224 0V48a16 16 0 0 1 16-16h160a16 16 0 0 1 16 16v160a16 16 0 0 1-16 16H47a16 16 0 0 1-16-16z"></path></svg>';case"send-backward":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path  d="M464,160H208a48,48,0,0,0-48,48V464a48,48,0,0,0,48,48H464a48,48,0,0,0,48-48V208A48,48,0,0,0,464,160Zm16,304a16,16,0,0,1-16,16H208a16,16,0,0,1-16-16V208a16,16,0,0,1,16-16H464a16,16,0,0,1,16,16ZM32,304V48A16,16,0,0,1,48,32H304a16,16,0,0,1,16,16v80h32V48A48,48,0,0,0,304,0H48A48,48,0,0,0,0,48V304a48,48,0,0,0,48,48h80V320H48A16,16,0,0,1,32,304Zm400-80H240a16,16,0,0,0-16,16V432a16,16,0,0,0,16,16H432a16,16,0,0,0,16-16V240A16,16,0,0,0,432,224ZM416,416H256V256H416Z"></path></svg>';case"bring-front":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path d="M32 208V48a16 16 0 0 1 16-16h160a16 16 0 0 1 16 16v16h32V48a48 48 0 0 0-48-48H48A48 48 0 0 0 0 48v160a48 48 0 0 0 48 48h80v-32H48a16 16 0 0 1-16-16zm448 160V144a48 48 0 0 0-48-48H208a48 48 0 0 0-48 48v224a48 48 0 0 0 48 48h224a48 48 0 0 0 48-48zm-288 0V144a16 16 0 0 1 16-16h224a16 16 0 0 1 16 16v224a16 16 0 0 1-16 16H208a16 16 0 0 1-16-16zm400-112h-80v32h80a16 16 0 0 1 16 16v160a16 16 0 0 1-16 16H432a16 16 0 0 1-16-16v-16h-32v16a48 48 0 0 0 48 48h160a48 48 0 0 0 48-48V304a48 48 0 0 0-48-48zM464 448h96a16 16 0 0 0 16-16v-96a16 16 0 0 0-16-16h-48v32h32v64h-48.41a79.76 79.76 0 0 1-41.25 28.43A15.66 15.66 0 0 0 464 448zM176 64H80a16 16 0 0 0-16 16v96a16 16 0 0 0 16 16h48v-32H96V96h48.41a79.76 79.76 0 0 1 41.25-28.43A15.66 15.66 0 0 0 176 64z"></path></svg>';case"bring-forward":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M352 304V48a48 48 0 0 0-48-48H48A48 48 0 0 0 0 48v256a48 48 0 0 0 48 48h256a48 48 0 0 0 48-48zM48 48h256v256H48zm416 112h-80v48h80v256H208v-80h-48v80a48 48 0 0 0 48 48h256a48 48 0 0 0 48-48V208a48 48 0 0 0-48-48zM240 416a16 16 0 0 0 16 16h160a16 16 0 0 0 16-16V256a16 16 0 0 0-16-16h-32v144H240z"></path></svg>';case"distort":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path   d="M483.55,227.55H462c-50.68,0-76.07-61.27-40.23-97.11L437,115.19A28.44,28.44,0,0,0,396.8,75L381.56,90.22A55.74,55.74,0,0,1,341.74,107c-29.24,0-57.29-22.7-57.29-57V28.44a28.45,28.45,0,0,0-56.9,0V50c0,34.29-28.05,57-57.29,57a55.7,55.7,0,0,1-39.82-16.77L115.2,75A28.44,28.44,0,0,0,75,115.19l15.25,15.25c35.84,35.84,10.45,97.11-40.23,97.11H28.45a28.45,28.45,0,1,0,0,56.89H50c50.68,0,76.07,61.28,40.23,97.12L75,396.8A28.45,28.45,0,0,0,115.2,437l15.24-15.25A55.7,55.7,0,0,1,170.25,405c29.25,0,57.3,22.7,57.3,57v21.54a28.45,28.45,0,0,0,56.9,0V462c0-34.29,28.05-57,57.3-57a55.7,55.7,0,0,1,39.81,16.77L396.8,437A28.45,28.45,0,0,0,437,396.8l-15.25-15.24c-35.84-35.84-10.45-97.12,40.23-97.12h21.54a28.45,28.45,0,1,0,0-56.89ZM379.88,307.32c-10.64,25.71-8.94,53.3,3.84,76.44a86.92,86.92,0,0,0-42-10.75A89.42,89.42,0,0,0,256,437.11,89.42,89.42,0,0,0,170.25,373a86.92,86.92,0,0,0-42,10.75c12.78-23.14,14.48-50.73,3.84-76.44s-31.33-44-56.69-51.32c25.36-7.34,46.05-25.63,56.69-51.32s8.94-53.3-3.84-76.44a87,87,0,0,0,42,10.75A89.42,89.42,0,0,0,256,74.88,89.42,89.42,0,0,0,341.74,139a87,87,0,0,0,42-10.75c-12.78,23.14-14.48,50.73-3.84,76.44s31.33,44,56.69,51.32C411.21,263.33,390.52,281.63,379.88,307.32ZM224,176a48,48,0,1,0,48,48A48,48,0,0,0,224,176Zm0,64a16,16,0,1,1,16-16A16,16,0,0,1,224,240Zm80,48a16,16,0,1,0,16,16A16,16,0,0,0,304,288Z"></path></svg>';case"list-ul":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path  d="M32.39 224C14.73 224 0 238.33 0 256s14.73 32 32.39 32a32 32 0 0 0 0-64zm0-160C14.73 64 0 78.33 0 96s14.73 32 32.39 32a32 32 0 0 0 0-64zm0 320C14.73 384 0 398.33 0 416s14.73 32 32.39 32a32 32 0 0 0 0-64zM504 80H136a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h368a8 8 0 0 0 8-8V88a8 8 0 0 0-8-8zm0 160H136a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h368a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8zm0 160H136a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h368a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8z"></path></svg>';case"portrait":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path  d="M320 0H64C28.7 0 0 28.7 0 64v384c0 35.3 28.7 64 64 64h256c35.3 0 64-28.7 64-64V64c0-35.3-28.7-64-64-64zm32 448c0 17.6-14.4 32-32 32H64c-17.6 0-32-14.4-32-32V64c0-17.6 14.4-32 32-32h256c17.6 0 32 14.4 32 32v384zM192 288c44.2 0 80-35.8 80-80s-35.8-80-80-80-80 35.8-80 80 35.8 80 80 80zm0-128c26.5 0 48 21.5 48 48s-21.5 48-48 48-48-21.5-48-48 21.5-48 48-48zm46.8 144c-19.5 0-24.4 7-46.8 7s-27.3-7-46.8-7c-21.2 0-41.8 9.4-53.8 27.4C84.2 342.1 80 355 80 368.9V408c0 4.4 3.6 8 8 8h16c4.4 0 8-3.6 8-8v-39.1c0-14 9-32.9 33.2-32.9 12.4 0 20.8 7 46.8 7 25.9 0 34.3-7 46.8-7 24.3 0 33.2 18.9 33.2 32.9V408c0 4.4 3.6 8 8 8h16c4.4 0 8-3.6 8-8v-39.1c0-13.9-4.2-26.8-11.4-37.5-12.1-18-32.7-27.4-53.8-27.4z"></path></svg>';case"ellipsis-v":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 128 512"><path  d="M64 208c26.5 0 48 21.5 48 48s-21.5 48-48 48-48-21.5-48-48 21.5-48 48-48zM16 104c0 26.5 21.5 48 48 48s48-21.5 48-48-21.5-48-48-48-48 21.5-48 48zm0 304c0 26.5 21.5 48 48 48s48-21.5 48-48-21.5-48-48-48-48 21.5-48 48z"></path></svg>';case"sun-light":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path  d="M256 143.7c-61.8 0-112 50.3-112 112.1s50.2 112.1 112 112.1 112-50.3 112-112.1-50.2-112.1-112-112.1zm0 192.2c-44.1 0-80-35.9-80-80.1s35.9-80.1 80-80.1 80 35.9 80 80.1-35.9 80.1-80 80.1zm256-80.1c0-5.3-2.7-10.3-7.1-13.3L422 187l19.4-97.9c1-5.2-.6-10.7-4.4-14.4-3.8-3.8-9.1-5.5-14.4-4.4l-97.8 19.4-55.5-83c-6-8.9-20.6-8.9-26.6 0l-55.5 83-97.8-19.5c-5.3-1.1-10.6.6-14.4 4.4-3.8 3.8-5.4 9.2-4.4 14.4L90 187 7.1 242.5c-4.4 3-7.1 8-7.1 13.3 0 5.3 2.7 10.3 7.1 13.3L90 324.6l-19.4 97.9c-1 5.2.6 10.7 4.4 14.4 3.8 3.8 9.1 5.5 14.4 4.4l97.8-19.4 55.5 83c3 4.5 8 7.1 13.3 7.1s10.3-2.7 13.3-7.1l55.5-83 97.8 19.4c5.4 1.2 10.7-.6 14.4-4.4 3.8-3.8 5.4-9.2 4.4-14.4L422 324.6l82.9-55.5c4.4-3 7.1-8 7.1-13.3zm-116.7 48.1c-5.4 3.6-8 10.1-6.8 16.4l16.8 84.9-84.8-16.8c-6.6-1.4-12.8 1.4-16.4 6.8l-48.1 72-48.1-71.9c-3-4.5-8-7.1-13.3-7.1-1 0-2.1.1-3.1.3l-84.8 16.8 16.8-84.9c1.2-6.3-1.4-12.8-6.8-16.4l-71.9-48.1 71.9-48.2c5.4-3.6 8-10.1 6.8-16.4l-16.8-84.9 84.8 16.8c6.5 1.3 12.8-1.4 16.4-6.8l48.1-72 48.1 72c3.6 5.4 9.9 8.1 16.4 6.8l84.8-16.8-16.8 84.9c-1.2 6.3 1.4 12.8 6.8 16.4l71.9 48.2-71.9 48z"></path></svg>';case"adjust":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path  d="M256 40c119.945 0 216 97.337 216 216 0 119.945-97.337 216-216 216-119.945 0-216-97.337-216-216 0-119.945 97.337-216 216-216m0-32C119.033 8 8 119.033 8 256s111.033 248 248 248 248-111.033 248-248S392.967 8 256 8zm-32 124.01v247.98c-53.855-13.8-96-63.001-96-123.99 0-60.99 42.145-110.19 96-123.99M256 96c-88.366 0-160 71.634-160 160s71.634 160 160 160V96z"></path></svg>';case"scroll-old":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path  d="M616 352h-72v-73.38L521.38 256 544 233.38v-82.75L521.38 128l22.25-22.28-.97-7.77C535.59 42.11 488.03 0 432 0H80C35.88 0 0 35.89 0 80v88c0 13.23 10.78 24 24 24h104v41.38L150.62 256 128 278.62v132.81c0 51.28 37.84 95.23 86.16 100.08 1.5.15 3 .14 4.5.23v.26h312C590.94 512 640 462.95 640 402.67V376c0-13.23-10.78-24-24-24zM128 160H32V80c0-26.47 21.53-48 48-48s48 21.53 48 48v80zm32 251.44V291.88L195.88 256 160 220.12V80c0-18-5.97-34.62-16.03-48H432c37.41 0 69.56 26.39 77.59 62.5L476.12 128 512 163.88v56.25L476.12 256 512 291.88V352h-73.38L416 374.62 393.38 352H320c-17.66 0-32 14.36-32 32v32c0 18.05-7.69 35.34-21.06 47.47-13.59 12.3-31.12 18.09-49.59 16.2-32.16-3.22-57.35-33.19-57.35-68.23zm448-8.77c0 42.64-34.69 77.33-77.34 77.33H294.83c15.82-17.55 25.17-40.18 25.17-64v-32h60.12L416 419.88 451.88 384H608v18.67z"></path></svg>';case"align-top":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 500 500">  <polygon points="500 0 0 0 0 34.468 88.66 34.468 88.66 433.596 228.66 433.596 228.66 34.468 274.787 34.468 274.787 313.745 414.787 313.745 414.787 34.468 500 34.468 500 0" /></svg>\n               ';case"align-middle":return'<svg xmlns="http://www.w3.org/2000/svg" width="500" height="500" viewBox="0 0 500 500"><polygon points="500 234.489 414.787 234.489 414.787 111.149 274.787 111.149 274.787 234.489 228.66 234.489 228.66 50 88.66 50 88.66 234.489 0 234.489 0 268.957 88.66 268.957 88.66 450 228.66 450 228.66 268.957 274.787 268.957 274.787 391.149 414.787 391.149 414.787 268.957 500 268.957 500 234.489" /></svg>';case"align-bottom":return'<svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 500 500"><rect x="88.66" y="65.404" width="140" height="400" /> <polygon points="414.787 465.532 414.787 186.255 274.787 186.255 274.787 465.532 0 465.532 0 500 500 500 500 465.532 414.787 465.532" /></svg>';case"align-left":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 500 500">  <polygon points="433.596 271.34 34.468 271.34 34.468 225.213 313.745 225.213 313.745 85.213 34.468 85.213 34.468 0 0 0 0 500 34.468 500 34.468 411.34 433.596 411.34 433.596 271.34" /></svg>';case"align-center":return'<svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 500 500">  <polygon points="450 271.34 268.957 271.34 268.957 225.213 391.149 225.213 391.149 85.213 268.957 85.213 268.957 0 234.489 0 234.489 85.213 111.149 85.213 111.149 225.213 234.489 225.213 234.489 271.34 50 271.34 50 411.34 234.489 411.34 234.489 500 268.957 500 268.957 411.34 450 411.34 450 271.34"/></svg>';case"align-right":return'<svg xmlns="http://www.w3.org/2000/svg"   viewBox="0 0 500 500">    <rect x="65.404" y="271.34" width="400" height="140" /><polygon points="465.532 0 465.532 85.213 186.255 85.213 186.255 225.213 465.532 225.213 465.532 500 500 500 500 0 465.532 0"/></svg>';case"space-vertical-around":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 500 500"> <rect x="120" y="296.302" width="260" height="140"/> <rect x="120" y="61.174" width="260" height="140"/> <path d="M403.446,500H96.554C87.412,500,80,493.284,80,485s7.412-15,16.554-15H403.446c9.142,0,16.554,6.716,16.554,15S412.588,500,403.446,500Z"/> <path d="M403.446,265H96.554C87.412,265,80,258.284,80,250s7.412-15,16.554-15H403.446c9.142,0,16.554,6.716,16.554,15S412.588,265,403.446,265Z"/> <path d="M403.446,31H96.554C87.412,31,80,24.284,80,16S87.412,1,96.554,1H403.446C412.588,1,420,7.716,420,16S412.588,31,403.446,31Z"/> </svg>';case"space-vertical-between":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 500 500"> <rect x="122.414" y="296.84" width="260" height="140"/> <rect x="122.414" y="60.713" width="260" height="140"/> <path d="M405.859,265H98.968c-9.143,0-16.554-6.716-16.554-15s7.411-15,16.554-15H405.859c9.143,0,16.555,6.716,16.555,15S415,265,405.859,265Z"/> </svg>';case"space-horizontal-around":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 500 500"> <rect x="60.552" y="124.264" width="140" height="260"/> <rect x="297.679" y="124.264" width="140" height="260"/> <path d="M485,424.263c-8.284,0-15-7.412-15-16.554V100.817c0-9.142,6.716-16.554,15-16.554s15,7.412,15,16.554V407.709C500,416.851,493.284,424.263,485,424.263Z"/> <path d="M250,424.263c-8.284,0-15-7.412-15-16.554V100.817c0-9.142,6.716-16.554,15-16.554s15,7.412,15,16.554V407.709C265,416.851,258.284,424.263,250,424.263Z"/> <path d="M15,424.263c-8.284,0-15-7.412-15-16.554V100.817c0-9.142,6.716-16.554,15-16.554s15,7.412,15,16.554V407.709C30,416.851,23.284,424.263,15,424.263Z"/> </svg>';case"space-horizontal-between":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 500 500"> <rect x="58.975" y="121.704" width="140" height="260"/> <rect x="298.102" y="121.704" width="140" height="260"/> <path d="M250,421.705c-8.284,0-15-7.412-15-16.555V98.259c0-9.143,6.716-16.554,15-16.554s15,7.411,15,16.554V405.15C265,414.293,258.284,421.705,250,421.705Z"/> </svg>';case"layer-group":return'<svg   xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path  d="M512 256.01c0-9.98-5.81-18.94-14.77-22.81l-99.74-43.27 99.7-43.26c9-3.89 14.81-12.84 14.81-22.81s-5.81-18.92-14.77-22.79L271.94 3.33c-10.1-4.44-21.71-4.45-31.87-.02L14.81 101.06C5.81 104.95 0 113.9 0 123.87s5.81 18.92 14.77 22.79l99.73 43.28-99.7 43.26C5.81 237.08 0 246.03 0 256.01c0 9.97 5.81 18.92 14.77 22.79l99.72 43.26-99.69 43.25C5.81 369.21 0 378.16 0 388.14c0 9.97 5.81 18.92 14.77 22.79l225.32 97.76a40.066 40.066 0 0 0 15.9 3.31c5.42 0 10.84-1.1 15.9-3.31l225.29-97.74c9-3.89 14.81-12.84 14.81-22.81 0-9.98-5.81-18.94-14.77-22.81l-99.72-43.26 99.69-43.25c9-3.89 14.81-12.84 14.81-22.81zM45.23 123.87l208.03-90.26.03-.02c1.74-.71 3.65-.76 5.45.02l208.03 90.26-208.03 90.27c-1.81.77-3.74.77-5.48 0L45.23 123.87zm421.54 264.27L258.74 478.4c-1.81.77-3.74.77-5.48 0L45.23 388.13l110.76-48.06 84.11 36.49a40.066 40.066 0 0 0 15.9 3.31c5.42 0 10.84-1.1 15.9-3.31l84.11-36.49 110.76 48.07zm-208.03-41.87c-1.81.77-3.74.77-5.48 0L45.23 256 156 207.94l84.1 36.5a40.066 40.066 0 0 0 15.9 3.31c5.42 0 10.84-1.1 15.9-3.31l84.1-36.49 110.77 48.07-208.03 90.25z"></path></svg>';case"facebook-round":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"></path></svg>';case"primary-doc":return'<svg xmlns="http://www.w3.org/2000/svg" width="500" height="500" viewBox="0 0 500 500">\n      <g>\n        <path d="M149.075,177.875q13.047-5.4,27.225-12.375t27.675-15.3q13.5-8.322,25.875-17.551a177.165,177.165,0,0,0,22.275-19.574h46.8v273.85h-67.05V200.375a203.922,203.922,0,0,1-30.15,16.425q-16.653,7.425-32.4,12.825Z" />\n        <path d="M438.681,40A21.344,21.344,0,0,1,460,61.319V438.681A21.344,21.344,0,0,1,438.681,460H61.319A21.344,21.344,0,0,1,40,438.681V61.319A21.344,21.344,0,0,1,61.319,40H438.681m0-40H61.319A61.319,61.319,0,0,0,0,61.319V438.681A61.319,61.319,0,0,0,61.319,500H438.681A61.319,61.319,0,0,0,500,438.681V61.319A61.319,61.319,0,0,0,438.681,0Z" />\n      </g>\n    </svg>\n    ';case"primary-doc-invers":return'<svg xmlns="http://www.w3.org/2000/svg" width="500" height="500" viewBox="0 0 500 500">\n      <path d="M438.681,0H61.319A61.319,61.319,0,0,0,0,61.319V438.681A61.319,61.319,0,0,0,61.319,500H438.681A61.319,61.319,0,0,0,500,438.681V61.319A61.319,61.319,0,0,0,438.681,0ZM297.425,388.05h-67.05V201.5a203.922,203.922,0,0,1-30.15,16.425q-16.653,7.425-32.4,12.825L147.575,179q13.047-5.4,27.225-12.375t27.675-15.3q13.5-8.322,25.875-17.551A177.165,177.165,0,0,0,250.625,114.2h46.8Z" />\n    </svg>';case"preview-doc":return'<svg xmlns="http://www.w3.org/2000/svg" width="500" height="500" viewBox="0 0 500 500">\n      <g>\n        <path d="M438.681,40A21.344,21.344,0,0,1,460,61.319V438.681A21.344,21.344,0,0,1,438.681,460H61.319A21.344,21.344,0,0,1,40,438.681V61.319A21.344,21.344,0,0,1,61.319,40H438.681m0-40H61.319A61.319,61.319,0,0,0,0,61.319V438.681A61.319,61.319,0,0,0,61.319,500H438.681A61.319,61.319,0,0,0,500,438.681V61.319A61.319,61.319,0,0,0,438.681,0Z" />\n        <path d="M247.218,179.532a67.28,67.28,0,0,0-19,3.052,33.841,33.841,0,0,1-46.086,46.242,67.868,67.868,0,1,0,65.09-49.294Zm193.557,59.235c-36.67-71.789-109.267-120.361-192.392-120.361S92.641,167.011,55.991,238.774a22.014,22.014,0,0,0,0,19.8c36.67,71.79,109.267,120.362,192.392,120.362s155.742-48.606,192.392-120.368A22.016,22.016,0,0,0,440.775,238.767Zm-193.557,97.02c-60.011,0-115.028-33.57-144.738-87.893C132.19,193.57,187.2,160,247.218,160s115.028,33.57,144.739,87.894C362.252,302.217,307.235,335.787,247.218,335.787Z" />\n      </g>\n    </svg>\n    ';case"preview-doc-invers":return'<svg xmlns="http://www.w3.org/2000/svg" width="500" height="500" viewBox="0 0 500 500">\n      <g>\n        <path d="M248.718,160.375c-60.017,0-115.028,33.57-144.738,87.894,29.71,54.323,84.727,87.893,144.738,87.893s115.034-33.57,144.739-87.893C363.746,193.945,308.735,160.375,248.718,160.375Zm65.5,106.607A67.973,67.973,0,1,1,183.628,229.2a33.615,33.615,0,0,0,16.424,4.419,33.94,33.94,0,0,0,29.662-50.661,64.66,64.66,0,0,1,38.037-.383A68.218,68.218,0,0,1,314.219,266.982Z" />\n        <path d="M438.681,0H61.319A61.319,61.319,0,0,0,0,61.319V438.681A61.319,61.319,0,0,0,61.319,500H438.681A61.319,61.319,0,0,0,500,438.681V61.319A61.319,61.319,0,0,0,438.681,0Zm3.594,258.947c-36.65,71.762-109.267,120.368-192.392,120.368S94.161,330.743,57.491,258.953a22.014,22.014,0,0,1,0-19.8c36.65-71.763,109.267-120.368,192.392-120.368s155.722,48.572,192.392,120.361A22.016,22.016,0,0,1,442.275,258.947Z" />\n      </g>\n    </svg>\n    ';case"production-doc":return'<svg xmlns="http://www.w3.org/2000/svg" width="500" height="500" viewBox="0 0 500 500">\n      <path d="M390.625,257.812a23.438,23.438,0,1,0,23.438,23.438A23.438,23.438,0,0,0,390.625,257.812Zm31.25-89.937V97.539A46.876,46.876,0,0,0,408.145,64.4L357.48,13.73A46.876,46.876,0,0,0,324.336,0H107.891C91.445,0,78.125,13.994,78.125,31.25V167.875A78.128,78.128,0,0,0,0,246V375a15.62,15.62,0,0,0,15.625,15.625h62.5v93.75A15.62,15.62,0,0,0,93.75,500h312.5a15.62,15.62,0,0,0,15.625-15.625v-93.75h62.5A15.62,15.62,0,0,0,500,375V246A78.128,78.128,0,0,0,421.875,167.875ZM121,39.875H312.5V93.75a15.62,15.62,0,0,0,15.625,15.625H379v62.5H121Zm258,420.25H122v-69.5H379ZM457.125,347.75H42.875V246a31.291,31.291,0,0,1,31.25-31.25h351.75A31.291,31.291,0,0,1,457.125,246Z" />\n    </svg>\n    ';case"production-doc-invers":return'<svg xmlns="http://www.w3.org/2000/svg" width="500" height="500" viewBox="0 0 500 500">\n      <path d="M421.875,167.875V97.539A46.876,46.876,0,0,0,408.145,64.4L357.48,13.73A46.876,46.876,0,0,0,324.336,0H107.891C91.445,0,78.125,13.994,78.125,31.25V167.875A78.128,78.128,0,0,0,0,246V375a15.62,15.62,0,0,0,15.625,15.625h62.5v93.75A15.62,15.62,0,0,0,93.75,500h312.5a15.62,15.62,0,0,0,15.625-15.625v-93.75h62.5A15.62,15.62,0,0,0,500,375V246A78.128,78.128,0,0,0,421.875,167.875ZM121,39.875H312.5V93.75a15.62,15.62,0,0,0,15.625,15.625H379v62.5H121Zm258,420.25H122v-69.5H379Zm11.021-155.794a23.438,23.438,0,1,1,23.438-23.437A23.443,23.443,0,0,1,390.021,304.331Z" />\n    </svg>\n    ';case"layout-snippet":return'<svg xmlns="http://www.w3.org/2000/svg" width="500" height="500" viewBox="0 0 500 500">\n      <g>\n        <path d="M438.681,40A21.344,21.344,0,0,1,460,61.319V438.681A21.344,21.344,0,0,1,438.681,460H61.319A21.344,21.344,0,0,1,40,438.681V61.319A21.344,21.344,0,0,1,61.319,40H438.681m0-40H61.319A61.319,61.319,0,0,0,0,61.319V438.681A61.319,61.319,0,0,0,61.319,500H438.681A61.319,61.319,0,0,0,500,438.681V61.319A61.319,61.319,0,0,0,438.681,0Z" />\n        <path d="M306.3,419.918a15,15,0,0,1-16.463-13.362h0a14.99,14.99,0,0,1,13.36-16.473h0a15,15,0,0,1,16.475,13.36h0a15,15,0,0,1-12.361,16.332h0C306.971,419.833,306.635,419.881,306.3,419.918Zm32.1-10.006a15.023,15.023,0,0,1,8.474-19.459h0a15,15,0,0,1,19.448,8.476h0a15,15,0,0,1-8.465,19.446h0a15.267,15.267,0,0,1-2.961.835h0A15.024,15.024,0,0,1,338.4,409.912Zm-85.17,9.247-.008.012h0a15.013,15.013,0,0,1-12.236-17.337h0A15,15,0,0,1,258.312,389.6h0a15.009,15.009,0,0,1,12.244,17.326h0a15.02,15.02,0,0,1-12.241,12.242h0A14.875,14.875,0,0,1,253.229,419.159Zm-50.618-1.082a15,15,0,0,1-7.1-19.985h0a15,15,0,0,1,20-7.093h0a14.988,14.988,0,0,1,7.09,19.988h0a14.977,14.977,0,0,1-11.015,8.337h0A14.849,14.849,0,0,1,202.611,418.077Z" />\n        <path d="M345.891,112.072a15.014,15.014,0,0,1-7.742-19.758h0a15,15,0,0,1,19.758-7.732h0a15,15,0,0,1,7.732,19.748h0a14.987,14.987,0,0,1-12.783,8.962h0A15,15,0,0,1,345.891,112.072Zm-151.172-8.013a15,15,0,0,1,7.822-19.721h0a15,15,0,0,1,19.721,7.822h0a15.007,15.007,0,0,1-7.811,19.721h0a15.1,15.1,0,0,1-4.984,1.2h0A15.012,15.012,0,0,1,194.719,104.059ZM302.667,112.9h0a14.989,14.989,0,0,1-12.808-16.912h0a15,15,0,0,1,16.9-12.807h0a14.985,14.985,0,0,1,12.809,16.9h0a15,15,0,0,1-13.858,12.929h0A14.932,14.932,0,0,1,302.667,112.9Zm-61.82-12.891a14.994,14.994,0,0,1,12.858-16.874h0A14.993,14.993,0,0,1,270.569,96h0a15,15,0,0,1-12.86,16.873h0c-.347.044-.695.076-1.045.1h0A14.986,14.986,0,0,1,240.847,100.01Z" />\n        <path d="M254.88,355.562l-8.631-6.142a497.046,497.046,0,0,1-51.729-43.463c-36.2-35.072-54.786-65.924-55.242-91.7-.3-16.99,7.154-31.8,21.556-42.839,15.728-12.052,33.054-16.663,50.106-13.345,19.3,3.76,34.431,16.594,44.261,27.594,9.889-10.637,24.91-22.943,43.629-26.432,16.034-2.99,32.148,1.2,46.592,12.124,15.439,11.675,23.43,27.262,23.108,45.076-.468,25.935-18.714,56.471-54.228,90.762a468.719,468.719,0,0,1-50.748,42.281ZM200.062,187.021c-6.894,0-13.8,2.712-20.982,8.212-6.912,5.3-9.936,11-9.807,18.488.3,17,16.582,42.016,45.861,70.436A478.656,478.656,0,0,0,255,318.5a450,450,0,0,0,38.736-33.146c28.585-27.658,44.5-52.329,44.8-69.467.091-5.135-.972-12.856-11.207-20.595-7.746-5.856-15.272-8-23-6.562-16.95,3.159-32.515,22.825-36.632,29.465l-13.078,21.1-12.582-21.364c-4.388-7.347-19.55-27.093-36.913-30.422A26.854,26.854,0,0,0,200.062,187.021Z" />\n        <path d="M154.914,418.145a15,15,0,0,1-7.1-19.985h0a15,15,0,0,1,20-7.093h0a14.988,14.988,0,0,1,7.09,19.988h0a14.981,14.981,0,0,1-11.015,8.338h0A14.858,14.858,0,0,1,154.914,418.145Z" />\n        <path d="M146.589,103.494a15,15,0,0,1,7.823-19.721h0A15,15,0,0,1,174.133,91.6h0a15.007,15.007,0,0,1-7.812,19.721h0a15.118,15.118,0,0,1-4.983,1.2h0A15.015,15.015,0,0,1,146.589,103.494Z" />\n      </g>\n    </svg>\n    ';case"layout-snippet-invers":return'<svg xmlns="http://www.w3.org/2000/svg" width="500" height="500" viewBox="0 0 500 500">\n      <g>\n        <path d="M320.09,195.292c-7.746-5.856-15.273-8-23-6.562-16.95,3.159-32.516,22.825-36.632,29.465l-13.078,21.1L234.8,217.929c-4.389-7.347-19.55-27.093-36.913-30.422a26.865,26.865,0,0,0-5.06-.486c-6.893,0-13.8,2.712-20.981,8.212-6.912,5.3-9.937,11-9.807,18.488.3,17,16.582,42.016,45.861,70.436A478.656,478.656,0,0,0,247.762,318.5,450,450,0,0,0,286.5,285.354c28.585-27.658,44.5-52.329,44.8-69.467C331.388,210.752,330.325,203.031,320.09,195.292Z" />\n        <path d="M438.681,0H61.319A61.319,61.319,0,0,0,0,61.319V438.681A61.319,61.319,0,0,0,61.319,500H438.681A61.319,61.319,0,0,0,500,438.681V61.319A61.319,61.319,0,0,0,438.681,0ZM329.149,92.314a15,15,0,1,1,7.742,19.758A15,15,0,0,1,329.149,92.314Zm-48.29,3.675A15.018,15.018,0,1,1,293.667,112.9,15,15,0,0,1,280.859,95.989ZM244.705,83.136a15,15,0,0,1,4,29.732c-.347.044-.695.076-1.045.1a15,15,0,0,1-2.959-29.831Zm-51.164,1.2a15,15,0,1,1-7.822,19.721A15,15,0,0,1,193.541,84.338Zm-46.129-.565a15,15,0,1,1-7.822,19.721A15,15,0,0,1,147.412,83.773ZM167.9,411.055a15,15,0,1,1-7.09-19.988A14.981,14.981,0,0,1,167.9,411.055Zm45.7-.068A15,15,0,1,1,206.507,391,14.975,14.975,0,0,1,213.6,410.987Zm47.959-4.062a14.974,14.974,0,0,1-17.327,12.234l-.008.012a15,15,0,1,1,17.335-12.246Zm36.75,12.85c-.335.058-.671.105-1.011.143a15.049,15.049,0,1,1,1.011-.143Zm50.55-1.4a15.267,15.267,0,0,1-2.961.835,15.035,15.035,0,1,1,2.961-.835ZM307.064,307.2a468.566,468.566,0,0,1-50.749,42.281l-8.673,6.081-8.631-6.142a497.115,497.115,0,0,1-51.73-43.463c-36.2-35.072-54.785-65.924-55.241-91.7-.3-16.99,7.153-31.8,21.556-42.839,15.727-12.052,33.053-16.663,50.106-13.345,19.3,3.76,34.431,16.594,44.261,27.594,9.889-10.637,24.91-22.943,43.629-26.432,16.034-2.99,32.147,1.2,46.592,12.124,15.439,11.675,23.429,27.262,23.108,45.076C360.823,242.373,342.578,272.909,307.064,307.2Z" />\n      </g>\n    </svg>\n    ';case"group-snippet":return'<svg xmlns="http://www.w3.org/2000/svg" width="500" height="500" viewBox="0 0 500 500">\n      <g>\n        <path d="M250,498c-66.937,0-129.657-25.233-176.6-71.053C26.066,380.754,0,318.623,0,252A250,250,0,0,1,426.776,75.224,248.361,248.361,0,0,1,500,252c0,66.623-26.066,128.754-73.4,174.947C379.657,472.767,316.938,498,250,498Zm0-456C134.205,42,40,136.205,40,252c0,115.514,92.243,206,210,206s210-90.486,210-206C460,136.205,365.8,42,250,42Z" />\n        <path d="M274.537,421.95a15,15,0,0,1-16.464-13.362h0a14.99,14.99,0,0,1,13.361-16.473h0a15,15,0,0,1,16.474,13.36h0a15,15,0,0,1-12.361,16.332h0Q275.046,421.894,274.537,421.95Zm32.1-21.006a15.025,15.025,0,0,1,8.475-19.459h0a15,15,0,0,1,19.447,8.476h0a15,15,0,0,1-8.465,19.446h0a15.267,15.267,0,0,1-2.961.835h0A15.024,15.024,0,0,1,306.64,400.944Zm-85.17,19.247-.008.012h0a15.015,15.015,0,0,1-12.236-17.337h0a15,15,0,0,1,17.327-12.235h0A15.009,15.009,0,0,1,238.8,407.957h0A15.021,15.021,0,0,1,226.556,420.2h0A14.9,14.9,0,0,1,221.47,420.191Zm-50.618-16.082a15,15,0,0,1-7.1-19.985h0a15,15,0,0,1,20-7.093h0a14.989,14.989,0,0,1,7.091,19.988h0a14.98,14.98,0,0,1-11.016,8.337h0A14.85,14.85,0,0,1,170.852,404.109Z" />\n        <path d="M315.941,117.156A15.012,15.012,0,0,1,308.2,97.4h0a15,15,0,0,1,19.758-7.732h0a15,15,0,0,1,7.732,19.748h0a14.988,14.988,0,0,1-12.783,8.962h0A15,15,0,0,1,315.941,117.156Zm-151.173-8.013a15,15,0,0,1,7.823-19.721h0a15,15,0,0,1,19.721,7.822h0a15.006,15.006,0,0,1-7.812,19.721h0a15.1,15.1,0,0,1-4.983,1.2h0A15.014,15.014,0,0,1,164.768,109.143Zm107.949-4.158h0a14.989,14.989,0,0,1-12.808-16.912h0a15,15,0,0,1,16.9-12.807h0a14.984,14.984,0,0,1,12.808,16.9h0A15,15,0,0,1,275.761,105.1h0A15,15,0,0,1,272.717,104.985ZM210.9,92.094A14.994,14.994,0,0,1,223.755,75.22h0a14.991,14.991,0,0,1,16.863,12.859h0a15,15,0,0,1-12.859,16.873h0c-.347.044-.7.076-1.045.1h0A14.986,14.986,0,0,1,210.9,92.094Z" />\n        <path d="M250.93,352.427l-8.631-6.142a496.968,496.968,0,0,1-51.73-43.463c-36.2-35.072-54.785-65.924-55.241-91.7-.3-16.99,7.153-31.8,21.556-42.839,15.727-12.052,33.054-16.663,50.106-13.345,19.3,3.76,34.431,16.594,44.261,27.594,9.889-10.637,24.91-22.943,43.629-26.431,16.034-2.991,32.147,1.2,46.592,12.124C356.911,179.9,364.9,195.489,364.58,213.3c-.469,25.935-18.714,56.471-54.228,90.762A468.936,468.936,0,0,1,259.6,346.347ZM196.111,183.886c-6.893,0-13.8,2.713-20.981,8.213-6.912,5.3-9.937,11-9.807,18.487.3,17,16.582,42.017,45.861,70.436a478.656,478.656,0,0,0,39.866,34.343,449.818,449.818,0,0,0,38.736-33.146c28.585-27.657,44.5-52.328,44.8-69.467.091-5.135-.972-12.856-11.207-20.595-7.746-5.856-15.273-8-23-6.561-16.95,3.158-32.516,22.824-36.632,29.465l-13.078,21.1-12.582-21.364c-4.389-7.347-19.55-27.093-36.913-30.422A26.865,26.865,0,0,0,196.111,183.886Z" />\n      </g>\n    </svg>';case"group-snippet-invers":return'<svg xmlns="http://www.w3.org/2000/svg" width="500" height="500" viewBox="0 0 500 500">\n      <path d="M322.128,194.532c-7.746-5.856-15.273-8-23-6.561-16.95,3.158-32.516,22.824-36.632,29.465l-13.078,21.1-12.582-21.364c-4.389-7.347-19.55-27.093-36.913-30.422a26.865,26.865,0,0,0-5.06-.486c-6.893,0-13.8,2.713-20.981,8.213-6.912,5.3-9.937,11-9.807,18.487.3,17,16.582,42.017,45.861,70.436A478.656,478.656,0,0,0,249.8,317.74a449.818,449.818,0,0,0,38.736-33.146c28.585-27.657,44.5-52.328,44.8-69.467C333.426,209.992,332.363,202.271,322.128,194.532Z" />\n      <path d="M426.776,75.224A250,250,0,0,0,0,252c0,66.623,26.066,128.754,73.4,174.947C120.343,472.767,183.063,498,250,498s129.657-25.233,176.6-71.053C473.934,380.754,500,318.623,500,252A248.361,248.361,0,0,0,426.776,75.224ZM306.949,99.773a15,15,0,1,1,7.742,19.758A15,15,0,0,1,306.949,99.773Zm-48.29-9.325a15.018,15.018,0,1,1,12.808,16.912A15,15,0,0,1,258.659,90.448ZM222.505,77.6a15,15,0,0,1,4,29.732c-.347.044-.7.076-1.045.1A15,15,0,0,1,222.505,77.6ZM171.341,91.8a15,15,0,1,1-7.823,19.721A15,15,0,0,1,171.341,91.8Zm18.248,307.6a15,15,0,1,1-7.091-19.988A14.978,14.978,0,0,1,189.589,399.394Zm47.958,10.938a14.974,14.974,0,0,1-17.327,12.234l-.008.012a15,15,0,1,1,17.335-12.246Zm36.75,13.85q-.5.087-1.01.143a15.051,15.051,0,1,1,1.01-.143Zm50.55-12.4a15.267,15.267,0,0,1-2.961.835,15.036,15.036,0,1,1,2.961-.835ZM309.1,306.44a468.936,468.936,0,0,1-50.748,42.282l-8.674,6.08-8.631-6.142a496.968,496.968,0,0,1-51.73-43.463c-36.2-35.072-54.785-65.924-55.241-91.7-.3-16.99,7.153-31.8,21.556-42.839,15.727-12.052,33.054-16.663,50.106-13.345,19.3,3.76,34.431,16.594,44.261,27.594,9.889-10.637,24.91-22.943,43.629-26.431,16.034-2.991,32.147,1.2,46.592,12.124,15.439,11.674,23.429,27.261,23.108,45.075C362.861,241.613,344.616,272.149,309.1,306.44Z"/>\n  </svg>';case"file-invoice":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path d="M312 416h-80c-4.42 0-8 3.58-8 8v16c0 4.42 3.58 8 8 8h80c4.42 0 8-3.58 8-8v-16c0-4.42-3.58-8-8-8zM64 240v96c0 8.84 8.19 16 18.29 16h219.43c10.1 0 18.29-7.16 18.29-16v-96c0-8.84-8.19-16-18.29-16H82.29C72.19 224 64 231.16 64 240zm32 16h192v64H96v-64zM72 96h112c4.42 0 8-3.58 8-8V72c0-4.42-3.58-8-8-8H72c-4.42 0-8 3.58-8 8v16c0 4.42 3.58 8 8 8zm0 64h112c4.42 0 8-3.58 8-8v-16c0-4.42-3.58-8-8-8H72c-4.42 0-8 3.58-8 8v16c0 4.42 3.58 8 8 8zm297.9-62.02L286.02 14.1c-9-9-21.2-14.1-33.89-14.1H47.99C21.5.1 0 21.6 0 48.09v415.92C0 490.5 21.5 512 47.99 512h288.02c26.49 0 47.99-21.5 47.99-47.99V131.97c0-12.69-5.1-24.99-14.1-33.99zM256.03 32.59c2.8.7 5.3 2.1 7.4 4.2l83.88 83.88c2.1 2.1 3.5 4.6 4.2 7.4h-95.48V32.59zm95.98 431.42c0 8.8-7.2 16-16 16H47.99c-8.8 0-16-7.2-16-16V48.09c0-8.8 7.2-16.09 16-16.09h176.04v104.07c0 13.3 10.7 23.93 24 23.93h103.98v304.01z"></path></svg>';case"clock-solid":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path   d="M256,8C119,8,8,119,8,256S119,504,256,504,504,393,504,256,393,8,256,8Zm92.49,313h0l-20,25a16,16,0,0,1-22.49,2.5h0l-67-49.72a40,40,0,0,1-15-31.23V112a16,16,0,0,1,16-16h32a16,16,0,0,1,16,16V256l58,42.5A16,16,0,0,1,348.49,321Z"></path></svg>';case"page-plus-solid":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path d="M377,105,279.1,7a24,24,0,0,0-17-7H256V128H384v-6.1A23.92,23.92,0,0,0,377,105ZM224,136V0H24A23.94,23.94,0,0,0,0,24V488a23.94,23.94,0,0,0,24,24H360a23.94,23.94,0,0,0,24-24V160H248A24.07,24.07,0,0,1,224,136Zm72,176v16a16,16,0,0,1-16,16H216v64a16,16,0,0,1-16,16H184a16,16,0,0,1-16-16V344H104a16,16,0,0,1-16-16V312a16,16,0,0,1,16-16h64V232a16,16,0,0,1,16-16h16a16,16,0,0,1,16,16v64h64A16,16,0,0,1,296,312Z"></path></svg>';case"user-friends-solid":return'<svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path d="M192 256c61.9 0 112-50.1 112-112S253.9 32 192 32 80 82.1 80 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C51.6 288 0 339.6 0 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zM480 256c53 0 96-43 96-96s-43-96-96-96-96 43-96 96 43 96 96 96zm48 32h-3.8c-13.9 4.8-28.6 8-44.2 8s-30.3-3.2-44.2-8H432c-20.4 0-39.2 5.9-55.7 15.4 24.4 26.3 39.7 61.2 39.7 99.8v38.4c0 2.2-.5 4.3-.6 6.4H592c26.5 0 48-21.5 48-48 0-61.9-50.1-112-112-112z"></path></svg>';case"opacity":return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M255.9.2h-64v64h64zM0 64.17v64h64v-64zM128 .2H64v64h64zm64 255.9v64h64v-64zM0 192.12v64h64v-64zM383.85.2h-64v64h64zm128 0h-64v64h64zM128 256.1H64v64h64zM511.8 448v-64h-64v64zm0-128v-64h-64v64zM383.85 512h64v-64h-64zm128-319.88v-64h-64v64zM128 512h64v-64h-64zM0 512h64v-64H0zm255.9 0h64v-64h-64zM0 320.07v64h64v-64zm319.88-191.92v-64h-64v64zm-64 128h64v-64h-64zm-64 128v64h64v-64zm128-64h64v-64h-64zm0-127.95h64v-64h-64zm0 191.93v64h64v-64zM64 384.05v64h64v-64zm128-255.9v-64h-64v64zm191.92 255.9h64v-64h-64zm-128-191.93v-64h-64v64zm128-127.95v64h64v-64zm-128 255.9v64h64v-64zm-64-127.95H128v64h64zm191.92 64h64v-64h-64zM128 128.15H64v64h64zm0 191.92v64h64v-64z"></path></svg>';default:assertNever$1(e)}}let WcIcon=(()=>{let e=class extends LitElement{constructor(){super(...arguments),this.primaryColor="text",this.icon="pen"}static get styles(){return css`
:host, :host * {
    box-sizing: border-box;
}

:host {
    display: block;
}

svg {
    width: 100%;
    height: 100%;
    display: block;
}


.color-arrows {
    fill: rgba(255,255,255,0.5);
}
.color-arrows:hover {
    fill:  rgba(255,255,255,0.6);
}

.color-headline {
    fill: var(--printess-headlineColor);
}
.color-headline:hover {
    fill: var(--printess-headlineColorHover);
}

.color-text {
    fill: var(--printess-textColor);
} 
.color-text:hover {
    fill: var(--printess-textColorHover);
}

.color-medium {
    fill: var(--printess-textColorDisabled);
} 
.color-medium:hover {
    fill: var(--printess-textColorDisabledHover);
}

.color-light {
    fill: var(--printess-textColorLight);
}   
.color-light:hover {  
    fill: var(--printess-textColorLightHover);
}

.color-toolbar {
    fill: var(--printess-toolbarColor);
} 
.color-toolbar:hover {
    fill: var(--printess-toolbarColorHover);
}
.color-remove {
    fill: var(--printess-textColor);
} 
.color-remove:hover {
    fill: tomato;
}
.color-red {
    fill: red;
} 
.color-red:hover {
    fill: tomato;
}

.color-black, .color-black:hover {
    fill: black;
}
.color-green, .color-green:hover {
    fill: green;
}
.color-blue, .color-blue:hover {
    fill: blue;
}
.color-gray, .color-gray:hover {
    fill: gray;
}
.color-warning, .color-warning:hover {
    fill: orange;
}
.color-frame {
    fill:  var(--printess-frameColor);;
    } 
.color-frame:hover {
    fill: var(--printess-frameColorHover);
}

.color-head-toolbar  {
    fill:  var(--printess-headToolbarColor);
} 
.color-head-toolbar :hover {
    fill: var(--printess-headToolbarColorHover);
}`}render(){let e="color-"+this.primaryColor;return this.classList.contains("strict-no-zoom")&&(e+=" strict-no-zoom"),html`${unsafeHTML(getIcon(this.icon).replace("<svg ",'<svg class="'+e+'"'))}`}};return __decorate$5([property()],e.prototype,"primaryColor",void 0),__decorate$5([property()],e.prototype,"icon",void 0),e=__decorate$5([customElement("wc-icon")],e),e})();const menuItemH=28,submMenuHGap=7,contextOverlayDiv=createOverlayDiv();contextOverlayDiv.addEventListener("mousedown",removeCtxMenu);const contextMenuDiv=document.createElement("div");function getLi(e){const t=document.createElement("li");if("-"===e.caption)return t.classList.add("ctxMenuItemSeperator"),t;if(t.classList.add("ctxMenuItem"),e.callback&&!0!==e.disabled&&t.addEventListener("mouseup",e.callback),e.disabled)t.classList.add("disabled"),t.appendChild(document.createElement("div"));else if(!e.textOnly)if(e.icon){const o=new WcIcon;o.icon=e.icon,e.icon.indexOf("-invers")>=0?o.primaryColor="headline":o.primaryColor="text",t.appendChild(o)}else{const o=document.createElement("div");e.color&&(o.style.backgroundColor=e.color,o.classList.add("color")),t.appendChild(o)}const o=document.createElement("div");if(o.classList.add("ctxMenuCaption"),o.innerText=e.caption,e.font&&(o.style.fontFamily=e.font,o.style.fontSize="11pt"),t.appendChild(o),e.sub){const e=new WcIcon;e.icon="carret-right-solid",e.primaryColor="text",e.classList.add("arrow"),t.appendChild(e)}return t}function showCtxMenu(e,t,o=0,i=0,r=150,s=!1){e.preventDefault();const n=r;removeCtxMenu();const a=e.clientX,l=e.clientY;if(!e.target)return;if(scope().eddiActive()&&!s){if(document.activeElement&&"eddi"===document.activeElement.getAttribute("name")){const e=document.activeElement;e.blur(),window.setTimeout((()=>e.focus()),100),beep()}return}if(!t){const o=e.target;"function"==typeof o.getContextMenu&&(t=o.getContextMenu(e.target,a,l))}if(!t)return;cancelMouseRouting();const c=28*t.filter((e=>"-"!==e.caption)).length+7*t.filter((e=>"-"===e.caption)).length;contextMenuDiv.style.height=c+"px",contextMenuDiv.style.width=n+"px",e.preventDefault();let d=a,h=l,p=a,u=l;contextMenuDiv.innerHTML="";const m=document.createElement("div");contextMenuDiv.appendChild(m);const f=document.createElement("ul");m.appendChild(f);for(const e of t){const t=getLi(e);if(t.addEventListener("mouseup",removeCtxMenu),e.sub&&e.sub.length){t.classList.add("subMenu-trigger");const o=document.createElement("div"),i=document.createElement("ul");o.appendChild(i),o.classList.add("subMenu");for(const t of e.sub){const e=getLi(t);i.appendChild(e)}u=window.innerHeight-l<7?-33-(l+7-window.innerHeight):7,p=window.innerWidth-a<2*n?-n:n,o.style.top=u+"px",o.style.left=p+"px",o.style.width=n+"px",t.onmouseover=()=>{o.style.display="block"},o.onmouseover=()=>{o.style.display="block"},t.onmouseout=()=>{o.style.display="none"},o.onmouseout=()=>{o.style.display="none"},t.appendChild(o)}f.appendChild(t)}h=l+c>window.innerHeight?window.innerHeight-c-10:l,window.innerWidth-(a+o)<n?(d=a-n,contextMenuDiv.classList.add("revCtxMenu")):(contextMenuDiv.classList.remove("revCtxMenu"),d=a),contextMenuDiv.style.top=h+i+"px",contextMenuDiv.style.left=d+o+"px",document.body.appendChild(contextOverlayDiv),document.body.appendChild(contextMenuDiv)}function showColorList(e,t,o,i,r){removeCtxMenu();const s=240,n=30*Math.ceil(o.length/8);contextMenuDiv.style.height=n+"px",contextMenuDiv.style.width="240px";let a=e,l=t;contextMenuDiv.innerHTML="";const c=document.createElement("div");contextMenuDiv.appendChild(c);const d=document.createElement("div");d.style.display="flex",d.style.flexWrap="wrap",d.style.flexDirection="row",c.appendChild(d);for(const e of o){const t=document.createElement("div");if(t.style.width="30px",t.style.height="30px",t.style.position="relative",t.style.backgroundColor=e,e===r&&(t.style.border="2px solid  black"),"transparent"===e){const e=document.createElement("div");e.classList.add("red-line"),t.appendChild(e)}const o=function(e){return()=>{removeCtxMenu(),i(e)}}(e);t.addEventListener("mouseup",o),d.appendChild(t)}l=t+n>window.innerHeight?window.innerHeight-n-10:t,window.innerWidth-s<e?(a=e-s,contextMenuDiv.classList.add("revCtxMenu")):(contextMenuDiv.classList.remove("revCtxMenu"),a=e),contextMenuDiv.style.top=l+"px",contextMenuDiv.style.left=a+"px",document.body.appendChild(contextOverlayDiv),document.body.appendChild(contextMenuDiv)}function removeCtxMenu(){contextMenuDiv.parentElement&&document.body.removeChild(contextMenuDiv),contextOverlayDiv.parentElement&&document.body.removeChild(contextOverlayDiv)}function contextMenuIsOpen(){return!!contextMenuDiv.parentElement||!!contextOverlayDiv.parentElement}contextMenuDiv.classList.add("ctxMenu"),contextMenuDiv.id="contextMenu",documentReady((function(){document.addEventListener("contextmenu",(e=>{e.preventDefault(),contextMenuIsOpen()||showCtxMenu(e)})),window.onresize=function(e){removeCtxMenu()}}));var __decorate$6=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n};const lengthRegex=/^(=.+|-?\d*(\.|,)?\d*(|px|%|%%|pt|cm|mm|inch)$)/,lengthRegexString="^(=.+|-?\\d*(\\.|,)?\\d*(|px|%|%%|pt|cm|mm|inch)$)";function lengthError(){return"Requires valid length like 100, 12px, 10pt, 1cm, 10mm,  2ich, 50%, 50%% or a valid equation like '=50%+2cm'."}let WcLengthTextBox=(()=>{let e=class extends LitElement{constructor(){super(...arguments),this.selection=null,this.feature=null,this.property=null,this.label=null,this.suffix=null,this.value=null,this.callback=null,this.origin=null,this.selector=null,this.slider=!0,this.updateWcBox=!0,this._inBetweenSliderValue=null}static get styles(){return css`
            :host, :host * {
                box-sizing: border-box;
            }
            :host {
              display: block;
              position: relative;
            } 

            :host, vaadin-text-field,  wc-number-box {
              
                width: 100%;
            }

           /* vaadin-text-field {
              padding-top: 4px;
               
            }*/

            
            wc-icon {
              width: 13px;
              height: 13px;
              position: absolute;
              right: 0px; 
              top: 4px;
              cursor: pointer;
            }
        `}render(){return!1===config.isBuyer||"inactive"!==this.extendedValue.origin?html`
             
              <vaadin-text-field id="textField"  theme="small" label=${this.getLabel()} title="${augmentLabel("",this.extendedValue,!0)}" class="property" value=${this.uiValueString}
                  required pattern=${lengthRegexString}  error-message="${lengthError()}"
                  ?disabled=${this.uiDisabled}
                  @change=${e=>this.uiValueString=e.currentTarget?e.currentTarget.value:""}
              >${this.hasStyleSelector()?html`<wc-icon slot="prefix" icon="style" style="width:16px; height: 16px;"></wc-icon>`:""}</vaadin-text-field>        
              ${this.hasContextMenu()?html`
                  <wc-icon icon="carret-right-solid" primaryColor="light" @click=${e=>this.contextMenu(e)} ></wc-icon>
              `:""}
              
             
              ${this.hasSlider()?html`
                  <wc-number-box .updateWcBox=${this.updateWcBox} mode="slider" .value="${this.ptValue}" .callback=${e=>this.sliderChange(e)} .previewCallback=${e=>this.sliderChangePreview(e)} 
                    property="${this.sliderProperty}" 
                    .textLengthProperty="${null!==this.ptValue?this.property:null}"
                  ></wc-number-box>
              `:""}        
        `:html``}hasContextMenu(){const e=this.property;return!this.uiDisabled&&!(!this.selection||"top"!==e&&"bottom"!==e&&"height"!==e&&"left"!==e&&"width"!==e&&"right"!==e)}contextMenu(e){const t=this.property;if(this.selection&&"top"===t||"bottom"===t||"height"===t||"left"===t||"width"===t||"right"===t){showCtxMenu(e,[...enums.lengthUnit.filter((e=>{var t;return"equation"!==e&&e!==(null===(t=this.extendedValue.value)||void 0===t?void 0:t.unit)}))].map((e=>({caption:e,callback:()=>this.selection?this.selection.convertAllLengthValues(e,[t]):""}))))}}hasStyleSelector(){const e=this.extendedValue;return!(!e||!e.selector)}get uiDisabled(){return isInactive(this.extendedValue)}get extendedValue(){return this.selection&&this.feature&&this.property?isBoxGeoLengthProperty(this.property)?this.selection.getPosition(this.property):this.selection.getValueExtended(this.feature,this.property):this.value instanceof Length?{value:this.value,selector:this.selector,origin:this.origin}:{value:null,selector:this.selector,origin:this.origin}}get uiValueString(){if(this._inBetweenSliderValue){return this._inBetweenSliderValue}const e=this.extendedValue;return e&&e.value?e.value.toString():""}set uiValueString(e){e&&e!==this.uiValueString&&e.match(lengthRegex)&&(this.selection&&this.property?isBoxGeoLengthProperty(this.property)?this.selection.setPosition(this.property,e):this.feature&&this.selection.setLengthValue(this.feature,this.property,e).then((()=>{var e;(null===(e=this.property)||void 0===e?void 0:e.startsWith("padding"))&&scope().eddiRefreshActiveFrameInfos()})):this.call_callback(e))}call_callback(e){var t;if(this.callback){parseFloat(e).toString()===e&&(null===(t=this.extendedValue.value)||void 0===t?void 0:t.unit)?this.value=new Length(parseFloat(e),this.extendedValue.value.unit):this.value=new Length(e+""),this.callback(this.value)}}getLabel(){let e="";if(this.selection&&this.property){switch(this.property){case"width":e="Width";break;case"height":e="Height";break;case"left":e="Left";break;case"top":e="Top";break;case"bottom":e="Bottom";break;case"right":e="Right";break;case"minWidth":e="Min-Width";break;case"minHeight":e="Min-Height";break;case"maxWidth":e="Max-Width";break;case"maxHeight":e="Max-Height";break;case"wrapShapeOffset":e="Shape Padding";break;case"wrapObjectOffset":e="Text Flow Distance";break;case"paddingLeft":e="Padding Left";break;case"paddingRight":e="Padding Right";break;case"paddingBottom":e="Padding Bottom";break;case"paddingTop":e="Padding Top";break;case"pathTextFontSize":case"fontSize":e="Font Size";break;case"fontStrokeWidth":case"pathTextStrokeWidth":case"strokeWidth":e="Stroke Width";break;case"dropXoffset":case"inShadowXoffset":case"strokeXoffset":case"inGlowXoffset":case"outGlowXoffset":e="X";break;case"dropYoffset":case"inShadowYoffset":case"strokeYoffset":case"inGlowYoffset":case"outGlowYoffset":e="Y";break;case"dropBlurRadius":case"strokeBlurRadius":case"inShadowBlurRadius":case"inGlowBlurRadius":case"outGlowBlurRadius":e="Blur";break;case"dropSpreadRadius":case"strokeSpreadRadius":case"inShadowSpreadRadius":case"inGlowSpreadRadius":case"outGlowSpreadRadius":e="Spread";break;case"bevelBlur":e="Size";break;case"distance":e="Distance";break;default:e=this.property}}else e=null!==this.label?this.label:"Length";return augmentLabel(e,this.extendedValue)}hasSlider(){return!0===this.slider&&null!==this.ptValue&&!this.uiDisabled}get sliderProperty(){const e=this.sliderLength;return"%"===(null==e?void 0:e.unit)||"%%"===(null==e?void 0:e.unit)?"genericPercentProperty":"px"===(null==e?void 0:e.unit)?"genericPxProperty":"genericPtProperty"}get sliderLength(){return!this.value||"fontSize"!==this.property&&"baselineShift"!==this.property&&"lineHeight"!==this.property?this.property&&!isBoxGeoLengthProperty(this.property)?this.extendedValue.value:null:this.value}get ptValue(){const e=this.sliderLength;return e?"%"===e.unit||"%%"===e.unit?Math.round(e.value):"px"===e.unit?Math.round(e.toPixel_1Axis(100)):Math.round(.75*e.toPixel_1Axis(100)):null}sliderChange(e){this._inBetweenSliderValue=null;let t=null;if(t=this.value?this.value:this.extendedValue.value,t){let o="pt";"%"===t.unit?o="%":"%%"===t.unit?o="%%":"px"===t.unit&&(o="px"),this.uiValueString!==e+o&&(this.uiValueString=e+o)}}sliderChangePreview(e){let t=null;if(t=this.value?this.value:this.extendedValue.value,t){let o="pt";"%"===t.unit?o="%":"%%"===t.unit?o="%%":"px"===t.unit&&(o="px"),this._inBetweenSliderValue=new Length(e,o).toString(),this.call_callback(e+o),this.requestUpdate()}}};return __decorate$6([property({attribute:!1,type:Object})],e.prototype,"selection",void 0),__decorate$6([property()],e.prototype,"feature",void 0),__decorate$6([property()],e.prototype,"property",void 0),__decorate$6([property()],e.prototype,"label",void 0),__decorate$6([property()],e.prototype,"suffix",void 0),__decorate$6([property({attribute:!1})],e.prototype,"value",void 0),__decorate$6([property({attribute:!1})],e.prototype,"callback",void 0),__decorate$6([property()],e.prototype,"origin",void 0),__decorate$6([property()],e.prototype,"selector",void 0),__decorate$6([property({type:Boolean})],e.prototype,"slider",void 0),__decorate$6([property({type:Boolean})],e.prototype,"updateWcBox",void 0),e=__decorate$6([customElement("wc-length-box")],e),e})();const $_documentContainer$q=html$1`<dom-module id="lumo-list-box" theme-for="vaadin-list-box">
  <template>
    <style>
      :host {
        -webkit-tap-highlight-color: transparent;
        --_lumo-item-selected-icon-display: var(--_lumo-list-box-item-selected-icon-display, block);
      }

      /* IE11 flexbox issue workaround (vaadin-items are flex containers with min-height) */
      [part="items"] {
        display: flex;
        flex-direction: column;
      }

      [part="items"] ::slotted(*) {
        flex: none;
      }

      /* Normal item */

      [part="items"] ::slotted(vaadin-item) {
        -webkit-tap-highlight-color: var(--lumo-primary-color-10pct);
        cursor: default;
      }

      [part="items"] ::slotted(vaadin-item) {
        outline: none;
        border-radius: var(--lumo-border-radius);
        padding-left: var(--_lumo-list-box-item-padding-left, calc(var(--lumo-border-radius) / 4));
        padding-right: calc(var(--lumo-space-l) + var(--lumo-border-radius) / 4);
      }

      /* Workaround to display checkmark in IE11 when list-box is not used in dropdown-menu */
      [part="items"] ::slotted(vaadin-item)::before {
        display: var(--_lumo-item-selected-icon-display);
      }

      /* Hovered item */
      /* TODO a workaround until we have "focus-follows-mouse". After that, use the hover style for focus-ring as well */

      [part="items"] ::slotted(vaadin-item:hover:not([disabled])) {
        background-color: var(--lumo-primary-color-10pct);
      }

      /* Focused item */

      [part="items"] ::slotted([focus-ring]:not([disabled])) {
        box-shadow: inset 0 0 0 2px var(--lumo-primary-color-50pct);
      }

      @media (pointer: coarse) {
        [part="items"] ::slotted(vaadin-item:hover:not([disabled])) {
          background-color: transparent;
        }

        [part="items"] ::slotted([focus-ring]:not([disabled])) {
          box-shadow: none;
        }
      }

      /* Easily add section dividers */

      [part="items"] ::slotted(hr) {
        height: 1px;
        border: 0;
        padding: 0;
        margin: var(--lumo-space-s) var(--lumo-border-radius);
        background-color: var(--lumo-contrast-10pct);
      }
    </style>
  </template>
</dom-module>`;document.head.appendChild($_documentContainer$q.content);
/**
@license
Copyright (c) 2017 Vaadin Ltd.
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
*/
const ListMixin=e=>class extends e{static get properties(){return{_hasVaadinListMixin:{value:!0},selected:{type:Number,reflectToAttribute:!0,notify:!0},orientation:{type:String,reflectToAttribute:!0,value:""},items:{type:Array,readOnly:!0,notify:!0},_searchBuf:{type:String,value:""}}}static get observers(){return["_enhanceItems(items, orientation, selected, disabled)"]}ready(){super.ready(),this.addEventListener("keydown",(e=>this._onKeydown(e))),this.addEventListener("click",(e=>this._onClick(e))),this._observer=new FlattenedNodesObserver(this,(e=>{this._setItems(this._filterItems(Array.from(this.children)))}))}_enhanceItems(e,t,o,i){if(!i&&e){this.setAttribute("aria-orientation",t||"vertical"),this.items.forEach((e=>{t?e.setAttribute("orientation",t):e.removeAttribute("orientation"),e.updateStyles()})),this._setFocusable(o);const i=e[o];e.forEach((e=>e.selected=e===i)),i&&!i.disabled&&this._scrollToItem(o)}}get focused(){return this.getRootNode().activeElement}_filterItems(e){return e.filter((e=>e._hasVaadinItemMixin))}_onClick(e){if(e.metaKey||e.shiftKey||e.ctrlKey||e.defaultPrevented)return;const t=this._filterItems(e.composedPath())[0];let o;t&&!t.disabled&&(o=this.items.indexOf(t))>=0&&(this.selected=o)}_searchKey(e,t){this._searchReset=Debouncer.debounce(this._searchReset,timeOut.after(500),(()=>this._searchBuf="")),this._searchBuf+=t.toLowerCase();this.items.some((e=>0===e.textContent.replace(/[^a-zA-Z0-9]/g,"").toLowerCase().indexOf(this._searchBuf)))||(this._searchBuf=t.toLowerCase());const o=1===this._searchBuf.length?e+1:e;return this._getAvailableIndex(o,1,(e=>!e.disabled&&0===e.textContent.replace(/[^a-zA-Z0-9]/g,"").toLowerCase().indexOf(this._searchBuf)))}_onKeydown(e){if(e.metaKey||e.ctrlKey)return;const t=e.key.replace(/^Arrow/,""),o=this.items.indexOf(this.focused);if(/[a-zA-Z0-9]/.test(t)&&1===t.length){const e=this._searchKey(o,t);return void(e>=0&&this._focus(e))}let i,r;this._vertical&&"Up"===t||!this._vertical&&"Left"===t?(r=-1,i=o-1):this._vertical&&"Down"===t||!this._vertical&&"Right"===t?(r=1,i=o+1):"Home"===t?(r=1,i=0):"End"===t&&(r=-1,i=this.items.length-1),i=this._getAvailableIndex(i,r,(e=>!e.disabled)),i>=0&&(this._focus(i),e.preventDefault())}_getAvailableIndex(e,t,o){const i=this.items.length;for(let r=0;"number"==typeof e&&r<i;r++,e+=t||1){e<0?e=i-1:e>=i&&(e=0);if(o(this.items[e]))return e}return-1}_setFocusable(e){e=this._getAvailableIndex(e,1,(e=>!e.disabled));const t=this.items[e]||this.items[0];this.items.forEach((e=>e.tabIndex=e===t?0:-1))}_focus(e){const t=this.items[e];this.items.forEach((e=>e.focused=e===t)),this._setFocusable(e),this._scrollToItem(e),t.focus()}focus(){this._observer&&this._observer.flush();const e=this.querySelector('[tabindex="0"]')||(this.items?this.items[0]:null);e&&e.focus()}get _scrollerElement(){}_scrollToItem(e){const t=this.items[e];if(!t)return;const o=this._vertical?["top","bottom"]:["left","right"],i=this._scrollerElement.getBoundingClientRect(),r=(this.items[e+1]||t).getBoundingClientRect(),s=(this.items[e-1]||t).getBoundingClientRect();let n=0;r[o[1]]>=i[o[1]]?n=r[o[1]]-i[o[1]]:s[o[0]]<=i[o[0]]&&(n=s[o[0]]-i[o[0]]),this._scroll(n)}get _vertical(){return"horizontal"!==this.orientation}_scroll(e){this._scrollerElement["scroll"+(this._vertical?"Top":"Left")]+=e}}
/**
@license
Copyright (c) 2019 Vaadin Ltd.
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
*/,MultiSelectListMixin=e=>class extends(ListMixin(e)){static get properties(){return{multiple:{type:Boolean,value:!1,reflectToAttribute:!0,observer:"_multipleChanged"},selectedValues:{type:Array,notify:!0,value:function(){return[]}}}}static get observers(){return["_enhanceMultipleItems(items, multiple, selected, selectedValues, selectedValues.*)"]}ready(){this.addEventListener("click",(e=>this._onMultipleClick(e))),super.ready()}_enhanceMultipleItems(e,t,o,i){if(!e||!t)return;if(i){const t=i.map((t=>e[t]));e.forEach((e=>e.selected=-1!==t.indexOf(e)))}const r=this.selectedValues.slice(-1)[0];r&&!r.disabled&&this._scrollToItem(r)}_onMultipleClick(e){const t=this._filterItems(e.composedPath())[0],o=t&&!t.disabled?this.items.indexOf(t):-1;o<0||!this.multiple||(e.preventDefault(),-1!==this.selectedValues.indexOf(o)?this.selectedValues=this.selectedValues.filter((e=>e!==o)):this.selectedValues=this.selectedValues.concat(o))}_multipleChanged(e,t){!e&&t&&(this.selectedValues=[],this.items.forEach((e=>e.selected=!1))),e&&!t&&void 0!==this.selected&&(this.push("selectedValues",this.selected),this.selected=void 0)}}
/**
@license
Copyright (c) 2017 Vaadin Ltd.
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
*/;class ListBoxElement extends(ElementMixin$1(MultiSelectListMixin(ThemableMixin(PolymerElement)))){static get template(){return html$1`
    <style>
      :host {
        display: flex;
      }

      :host([hidden]) {
        display: none !important;
      }

      [part="items"] {
        height: 100%;
        width: 100%;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
      }
    </style>
    <div part="items">
      <slot></slot>
    </div>
`}static get is(){return"vaadin-list-box"}static get version(){return"1.2.0"}static get properties(){return{orientation:{readOnly:!0}}}constructor(){super(),this.focused}ready(){super.ready(),this.setAttribute("role","list"),setTimeout(this._checkImport.bind(this),2e3)}get _scrollerElement(){return this.shadowRoot.querySelector('[part="items"]')}_checkImport(){var e=this.querySelector("vaadin-item");!e||e instanceof PolymerElement||console.warn("Make sure you have imported the vaadin-item element.")}}customElements.define(ListBoxElement.is,ListBoxElement);const $_documentContainer$r=html$1`<dom-module id="lumo-select" theme-for="vaadin-select">
  <template>
    <style include="lumo-field-button">
      :host {
        outline: none;
        -webkit-tap-highlight-color: transparent;
      }

      [selected] {
        padding-left: 0;
        padding-right: 0;
        flex: auto;
      }

      :host([theme~="small"]) [selected] {
        padding: 0;
        min-height: var(--lumo-size-s);
      }

      :host([theme~="align-right"]) [selected] {
        text-align: right;
      }

      :host([theme~="align-center"]) [selected] {
        text-align: center;
      }

      [part="toggle-button"]::before {
        content: var(--lumo-icons-dropdown);
      }

      /* Highlight the toggle button when hovering over the entire component */
      :host(:hover:not([readonly]):not([disabled])) [part="toggle-button"] {
        color: var(--lumo-contrast-80pct);
      }
    </style>
  </template>
</dom-module><dom-module id="lumo-select-text-field" theme-for="vaadin-select-text-field">
  <template>
    <style>
      :host([theme~="align-center"]) ::slotted([part~="value"]) {
        --_lumo-text-field-overflow-mask-image: none;
      }

      :host([theme~="align-right"]) ::slotted([part~="value"]) {
        --_lumo-text-field-overflow-mask-image: linear-gradient(to right, transparent 0.25em, #000 1.5em);
      }

      [part="input-field"] {
        cursor: default;
      }

      [part="input-field"] ::slotted([part="value"]) {
        display: flex;
      }

      /* ShadyCSS limitation workaround */
      [part="input-field"] ::slotted([part="value"]) [selected]::before {
        display: none;
      }

      [part="input-field"]:focus {
        outline: none;
      }
    </style>
  </template>
</dom-module><dom-module id="lumo-select-overlay" theme-for="vaadin-select-overlay">
  <template>
    <style include="lumo-menu-overlay">
      :host {
        --_lumo-item-selected-icon-display: block;
      }

      :host([bottom-aligned]) {
        justify-content: flex-end;
      }

      [part~="overlay"] {
        min-width: var(--vaadin-select-text-field-width);
      }

      /* Small viewport adjustment */
      :host([phone]) {
        top: 0 !important;
        right: 0 !important;
        bottom: var(--vaadin-overlay-viewport-bottom, 0) !important;
        left: 0 !important;
        align-items: stretch;
        justify-content: flex-end;
      }

      :host([theme~="align-right"]) {
        text-align: right;
      }

      :host([theme~="align-center"]) {
        text-align: center;
      }
    </style>
  </template>
</dom-module>`;document.head.appendChild($_documentContainer$r.content),
/**
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at
http://polymer.github.io/LICENSE.txt The complete set of authors may be found at
http://polymer.github.io/AUTHORS.txt The complete set of contributors may be
found at http://polymer.github.io/CONTRIBUTORS.txt Code distributed by Google as
part of the polymer project is also subject to an additional IP rights grant
found at http://polymer.github.io/PATENTS.txt
*/
Polymer({is:"iron-media-query",properties:{queryMatches:{type:Boolean,value:!1,readOnly:!0,notify:!0},query:{type:String,observer:"queryChanged"},full:{type:Boolean,value:!1},_boundMQHandler:{value:function(){return this.queryHandler.bind(this)}},_mq:{value:null}},attached:function(){this.style.display="none",this.queryChanged()},detached:function(){this._remove()},_add:function(){this._mq&&this._mq.addListener(this._boundMQHandler)},_remove:function(){this._mq&&this._mq.removeListener(this._boundMQHandler),this._mq=null},queryChanged:function(){this._remove();var e=this.query;e&&(this.full||"("===e[0]||(e="("+e+")"),this._mq=window.matchMedia(e),this._add(),this.queryHandler(this._mq))},queryHandler:function(e){this._setQueryMatches(e.matches)}});
/**
@license
Copyright (c) 2017 Vaadin Ltd.
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
*/
const $_documentContainer$s=document.createElement("template");$_documentContainer$s.innerHTML='<dom-module id="vaadin-select-overlay-styles" theme-for="vaadin-select-overlay">\n  <template>\n    <style>\n      :host {\n        align-items: flex-start;\n        justify-content: flex-start;\n      }\n    </style>\n  </template>\n</dom-module>',document.head.appendChild($_documentContainer$s.content);class SelectOverlayElement extends OverlayElement{static get is(){return"vaadin-select-overlay"}}
/**
@license
Copyright (c) 2017 Vaadin Ltd.
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
*/
let memoizedTemplate$1;customElements.define(SelectOverlayElement.is,SelectOverlayElement);class SelectTextFieldElement extends TextFieldElement{static get is(){return"vaadin-select-text-field"}static get template(){if(super.template.content.querySelector('slot[name="input"]'))return super.template;if(!memoizedTemplate$1){memoizedTemplate$1=super.template.cloneNode(!0);const e=document.createElement("slot");e.setAttribute("name","value");const t=memoizedTemplate$1.content.querySelector("input");t.parentElement.replaceChild(e,t),e.appendChild(t)}return memoizedTemplate$1}get focusElement(){return this.shadowRoot.querySelector("[part=input-field]")}get inputElement(){return this.shadowRoot.querySelector("input")}}customElements.define(SelectTextFieldElement.is,SelectTextFieldElement);
/**
@license
Copyright (c) 2017 Vaadin Ltd.
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
*/
const $_documentContainer$t=document.createElement("template");$_documentContainer$t.innerHTML="<custom-style>\n  <style>\n    @font-face {\n      font-family: \"vaadin-select-icons\";\n      src: url(data:application/font-woff;charset=utf-8;base64,d09GRgABAAAAAASEAAsAAAAABDgAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABPUy8yAAABCAAAAGAAAABgDxIGKmNtYXAAAAFoAAAAVAAAAFQXVtKHZ2FzcAAAAbwAAAAIAAAACAAAABBnbHlmAAABxAAAAHwAAAB8CohkJ2hlYWQAAAJAAAAANgAAADYOavgEaGhlYQAAAngAAAAkAAAAJAarA8ZobXR4AAACnAAAABQAAAAUCAABP2xvY2EAAAKwAAAADAAAAAwAKABSbWF4cAAAArwAAAAgAAAAIAAHABduYW1lAAAC3AAAAYYAAAGGmUoJ+3Bvc3QAAARkAAAAIAAAACAAAwAAAAMEAAGQAAUAAAKZAswAAACPApkCzAAAAesAMwEJAAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAAAAAAAAAAAAAQAAA6QADwP/AAEADwABAAAAAAQAAAAAAAAAAAAAAIAAAAAAAAwAAAAMAAAAcAAEAAwAAABwAAwABAAAAHAAEADgAAAAKAAgAAgACAAEAIOkA//3//wAAAAAAIOkA//3//wAB/+MXBAADAAEAAAAAAAAAAAAAAAEAAf//AA8AAQAAAAAAAAAAAAIAADc5AQAAAAABAAAAAAAAAAAAAgAANzkBAAAAAAEAAAAAAAAAAAACAAA3OQEAAAAAAQE/AUAC6QIVABQAAAEwFx4BFxYxMDc+ATc2MTAjKgEjIgE/ISJPIiEhIk8iIUNCoEJDAhUhIk8iISEiTyIhAAEAAAABAABvL5bdXw889QALBAAAAAAA1jHaeQAAAADWMdp5AAAAAALpAhUAAAAIAAIAAAAAAAAAAQAAA8D/wAAABAAAAAAAAukAAQAAAAAAAAAAAAAAAAAAAAUEAAAAAAAAAAAAAAAAAAAABAABPwAAAAAACgAUAB4APgABAAAABQAVAAEAAAAAAAIAAAAAAAAAAAAAAAAAAAAAAAAADgCuAAEAAAAAAAEABwAAAAEAAAAAAAIABwBgAAEAAAAAAAMABwA2AAEAAAAAAAQABwB1AAEAAAAAAAUACwAVAAEAAAAAAAYABwBLAAEAAAAAAAoAGgCKAAMAAQQJAAEADgAHAAMAAQQJAAIADgBnAAMAAQQJAAMADgA9AAMAAQQJAAQADgB8AAMAAQQJAAUAFgAgAAMAAQQJAAYADgBSAAMAAQQJAAoANACkaWNvbW9vbgBpAGMAbwBtAG8AbwBuVmVyc2lvbiAxLjAAVgBlAHIAcwBpAG8AbgAgADEALgAwaWNvbW9vbgBpAGMAbwBtAG8AbwBuaWNvbW9vbgBpAGMAbwBtAG8AbwBuUmVndWxhcgBSAGUAZwB1AGwAYQByaWNvbW9vbgBpAGMAbwBtAG8AbwBuRm9udCBnZW5lcmF0ZWQgYnkgSWNvTW9vbi4ARgBvAG4AdAAgAGcAZQBuAGUAcgBhAHQAZQBkACAAYgB5ACAASQBjAG8ATQBvAG8AbgAuAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==) format('woff');\n      font-weight: normal;\n      font-style: normal;\n    }\n  </style>\n</custom-style>",document.head.appendChild($_documentContainer$t.content);class SelectElement extends(ElementMixin$1(ControlStateMixin(ThemableMixin(ThemePropertyMixin(mixinBehaviors(IronResizableBehavior,PolymerElement)))))){static get template(){return html$1`
    <style>
      :host {
        display: inline-block;
      }

      vaadin-select-text-field {
        width: 100%;
        min-width: 0;
      }

      :host([hidden]) {
        display: none !important;
      }

      [part="toggle-button"] {
        font-family: "vaadin-select-icons";
      }

      [part="toggle-button"]::before {
        content: "\\e900";
      }
    </style>

    <vaadin-select-text-field placeholder="[[placeholder]]" label="[[label]]" required="[[required]]" invalid="[[invalid]]" error-message="[[errorMessage]]" readonly\$="[[readonly]]" theme\$="[[theme]]">
      <slot name="prefix" slot="prefix"></slot>
      <div part="value"></div>
      <div part="toggle-button" slot="suffix" role="button" aria-haspopup="listbox" aria-label="Toggle"></div>
    </vaadin-select-text-field>
    <vaadin-select-overlay opened="{{opened}}" with-backdrop="[[_phone]]" phone\$="[[_phone]]" theme\$="[[theme]]"></vaadin-select-overlay>

    <iron-media-query query="[[_phoneMediaQuery]]" query-matches="{{_phone}}"></iron-media-query>
`}static get is(){return"vaadin-select"}static get version(){return"2.1.7"}static get properties(){return{opened:{type:Boolean,value:!1,notify:!0,reflectToAttribute:!0,observer:"_openedChanged"},renderer:Function,errorMessage:{type:String,value:""},label:{type:String},value:{type:String,value:"",notify:!0,observer:"_valueChanged"},required:{type:Boolean,reflectToAttribute:!0,observer:"_requiredChanged"},invalid:{type:Boolean,reflectToAttribute:!0,notify:!0,value:!1},name:{type:String,reflectToAttribute:!0},placeholder:{type:String},readonly:{type:Boolean,value:!1,reflectToAttribute:!0},_phone:Boolean,_phoneMediaQuery:{value:"(max-width: 420px), (max-height: 420px)"},_overlayElement:Object,_inputElement:Object,_toggleElement:Object,_items:Object,_contentTemplate:Object,_oldTemplate:Object,_oldRenderer:Object}}static get observers(){return["_updateSelectedItem(value, _items)","_updateAriaExpanded(opened, _toggleElement, _inputElement)","_templateOrRendererChanged(_contentTemplate, renderer, _overlayElement)"]}constructor(){super(),this._boundSetPosition=this._setPosition.bind(this)}connectedCallback(){super.connectedCallback(),this.addEventListener("iron-resize",this._boundSetPosition)}ready(){super.ready(),this._overlayElement=this.shadowRoot.querySelector("vaadin-select-overlay"),this._valueElement=this.shadowRoot.querySelector('[part="value"]'),this._toggleElement=this.shadowRoot.querySelector('[part="toggle-button"]'),this._nativeInput=this.focusElement.shadowRoot.querySelector("input"),this._nativeInput.setAttribute("aria-hidden",!0),this._nativeInput.setAttribute("tabindex",-1),this._nativeInput.style.pointerEvents="none",this.focusElement.addEventListener("click",(e=>this.opened=!this.readonly)),this.focusElement.addEventListener("keydown",(e=>this._onKeyDown(e))),this._observer=new FlattenedNodesObserver(this,(e=>this._setTemplateFromNodes(e.addedNodes))),this._observer.flush()}_setTemplateFromNodes(e){const t=Array.from(e).filter((e=>e.localName&&"template"===e.localName))[0]||this._contentTemplate;this._overlayElement.template=this._contentTemplate=t,this._setForwardHostProps()}_setForwardHostProps(){if(this._overlayElement.content){const e=this._overlayElement._instance&&this._overlayElement._instance.forwardHostProp;this._overlayElement._instance&&(this._overlayElement._instance.forwardHostProp=(...t)=>{e.apply(this._overlayElement._instance,t),setTimeout((()=>{this._updateValueSlot()}))},this._assignMenuElement())}}render(){this._overlayElement.render(),this._menuElement&&this._menuElement.items&&this._updateSelectedItem(this.value,this._menuElement.items)}_removeNewRendererOrTemplate(e,t,o,i){e!==t?this._contentTemplate=void 0:o!==i&&(this.renderer=void 0)}_templateOrRendererChanged(e,t,o){if(o){if(e&&t)throw this._removeNewRendererOrTemplate(e,this._oldTemplate,t,this._oldRenderer),new Error("You should only use either a renderer or a template for select content");this._oldTemplate=e,this._oldRenderer=t,t&&(o.setProperties({owner:this,renderer:t}),this.render(),o.content.firstChild&&this._assignMenuElement())}}_assignMenuElement(){this._menuElement=Array.from(this._overlayElement.content.children).filter((e=>"style"!==e.localName))[0],this._menuElement&&(this._menuElement.addEventListener("items-changed",(e=>{this._items=this._menuElement.items,this._items.forEach((e=>e.setAttribute("role","option")))})),this._menuElement.addEventListener("selected-changed",(e=>this._updateValueSlot())),this._menuElement.addEventListener("keydown",(e=>this._onKeyDownInside(e))),this._menuElement.addEventListener("click",(e=>{this.__userInteraction=!0,this.opened=!1}),!0),this._menuElement.setAttribute("role","listbox"))}get focusElement(){return this._inputElement||(this._inputElement=this.shadowRoot.querySelector("vaadin-select-text-field"))}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("iron-resize",this._boundSetPosition),this.opened=!1}notifyResize(){super.notifyResize(),this.positionTarget&&this.opened&&(this._setPosition(),requestAnimationFrame(this._setPosition.bind(this)))}_requiredChanged(e){this.setAttribute("aria-required",e)}_valueChanged(e,t){""===e?this.focusElement.removeAttribute("has-value"):this.focusElement.setAttribute("has-value",""),""===e&&void 0===t||this.validate()}_onKeyDown(e){if(!this.readonly&&!this.opened)if(/^(Enter|SpaceBar|\s|ArrowDown|Down|ArrowUp|Up)$/.test(e.key))e.preventDefault(),this.opened=!0;else if(/[a-zA-Z0-9]/.test(e.key)&&1===e.key.length){const t=this._menuElement.selected,o=void 0!==t?t:-1,i=this._menuElement._searchKey(o,e.key);i>=0&&(this.__userInteraction=!0,this._updateSelectedItem(this._items[i].value,this._items))}}_onKeyDownInside(e){/^(Tab)$/.test(e.key)&&(this.opened=!1)}_openedChanged(e,t){if(e){if(!this._overlayElement||!this._menuElement||!this._toggleElement||!this.focusElement||this.disabled||this.readonly)return void(this.opened=!1);this._openedWithFocusRing=this.hasAttribute("focus-ring")||this.focusElement.hasAttribute("focus-ring"),this._menuElement.focus(),this._setPosition(),window.addEventListener("scroll",this._boundSetPosition,!0)}else t&&(this._phone?this._setFocused(!1):(this.focusElement.focus(),this._openedWithFocusRing&&this.focusElement.setAttribute("focus-ring","")),this.validate(),window.removeEventListener("scroll",this._boundSetPosition,!0))}_hasContent(e){return!!e&&Boolean(e.hasAttribute("label")?e.getAttribute("label"):e.textContent.trim()||e.children.length)}_attachSelectedItem(e){if(!e)return;let t;e.hasAttribute("label")?(t=document.createElement("vaadin-item"),t.textContent=e.getAttribute("label")):t=e.cloneNode(!0),t._sourceItem=e,t.removeAttribute("tabindex"),t.removeAttribute("role"),this._valueElement.appendChild(t),t.selected=!0}_updateAriaExpanded(e,t,o){t&&t.setAttribute("aria-expanded",e),o&&o.focusElement&&o.focusElement.setAttribute("aria-expanded",e)}_updateValueSlot(){this.opened=!1,this._valueElement.innerHTML="";const e=this._items[this._menuElement.selected],t=this._hasContent(e),o=this._inputElement.shadowRoot.querySelector('slot[name="input"]')?"input":"value";this._valueElement.slot=t?o:"",t&&window.ShadyDOM&&window.ShadyDOM.flush(),this._attachSelectedItem(e),!this._valueChanging&&e&&(this._selectedChanging=!0,this.value=e.value||"",this.__userInteraction&&(this.dispatchEvent(new CustomEvent("change",{bubbles:!0})),this.__userInteraction=!1),delete this._selectedChanging)}_updateSelectedItem(e,t){t&&(this._menuElement.selected=t.reduce(((t,o,i)=>void 0===t&&o.value===e?i:t),void 0),this._selectedChanging||(this._valueChanging=!0,this._updateValueSlot(),delete this._valueChanging))}_setFocused(e){super._setFocused(this.opened||e),this.focusElement._setFocused(this.hasAttribute("focused")),!this.hasAttribute("focused")&&this.validate()}_setPosition(){const e=this._inputElement.shadowRoot.querySelector('[part~="input-field"]').getBoundingClientRect(),t=Math.min(window.innerHeight,document.documentElement.clientHeight),o=e.top>(t-e.height)/2;this._overlayElement.style.left=e.left+"px",o?(this._overlayElement.setAttribute("bottom-aligned",""),this._overlayElement.style.removeProperty("top"),this._overlayElement.style.bottom=t-e.bottom+"px"):(this._overlayElement.removeAttribute("bottom-aligned"),this._overlayElement.style.removeProperty("bottom"),this._overlayElement.style.top=e.top+"px"),this._overlayElement.updateStyles({"--vaadin-select-text-field-width":e.width+"px"})}validate(){return!(this.invalid=!(this.disabled||!this.required||this.value))}}customElements.define(SelectElement.is,SelectElement);var __decorate$7=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n};let WcSelect=(()=>{var e;let t=e=class extends LitElement{constructor(){super(...arguments),this.feature=null,this.selection=null,this.property=null,this.value=null,this.label=null,this.list=null,this.callback=null,this.selector=null,this.origin=null,this.icons=!1}get items(){let e,t,o=[""];if(this.property)switch(this.property){case"horizontalPathTextAlign":o=enums.horizontalPathTextAlign,e=enumIcons.horizontalPathTextAlign;break;case"horizontalSimpleTextAlign":o=enums.horizontalSimpleTextAlign,e=enumIcons.horizontalSimpleTextAlign;break;case"horizontalTextAlign":o=enums.horizontalTextAlign,e=enumIcons.horizontalTextAlign;break;case"verticalSimpleTextAlign":o=enums.verticalSimpleTextAlign,e=enumIcons.verticalSimpleTextAlign;break;case"verticalStoryTextAlign":o=enums.verticalStoryTextAlign,e=enumIcons.verticalStoryTextAlign;break;case"warpCustomTopTransform":case"warpCustomBottomTransform":o=enums.transform;break;case"warpArcPosition":o=enums.warpArcPosition,e=enumIcons.warpArcPosition;break;case"anchorRotation":o=enums.anchorRotation,e=enumIcons.anchorRotation;break;case"warpPitPosition":o=enums.warpPitPosition,e=enumIcons.warpPitPosition;break;case"autoTextMode":o=enums.autoText,e=enumIcons.autoText;break;case"textWrapMode":o=enums.textWrap,e=enumIcons.textWrap;break;case"imageMasking":o=enums.imageMask,e=enumIcons.imageMask,t=enumLabels.imageMask;break;case"imagePlacement":o=enums.imagePlacement;break;case"documentPlacement":o=enums.documentPlacement;break;case"imageType":o=enums.imageType;break;case"frameRepeat":o=enums.frameRepeat;break;case"blendMode":case"dropBlend":case"inShadowBlend":case"inGlowBlend":case"outGlowBlend":case"strokeBlend":o=enums.blendMode;break;case"strokeAlign":case"pathTextStrokeAlign":case"fontStrokeAlign":o=enums.strokeAlign,e=enumIcons.strokeAlign;break;case"strokeCap":o=enums.strokeCap,e=enumIcons.strokeCap;break;case"strokeType":case"fontStrokeType":case"tabLineType":o=enums.strokeType;break;case"fontHeights":o=enums.fontHeights,e=enumIcons.fontHeights;break;case"orientation":o=enums.orientation,e=enumIcons.orientation;break;case"dashDistribution":case"fontDashDistribution":o=enums.dashDistribution;break;case"bulletMode":o=enums.bulletMode;break;case"gridSize":o=enums.gridSize;break;case"buyerOrderNo":case"zoomActionOrderNo":case"boundToBoxSelection":o=enums.buyerOrderNo;break;case"textTransform":o=enums.textTransform;break;case"maskChannel":o=enums.imageChannel;break;case"warpArchPosition":o=enums.warpArchPosition;break;case"warpArchMirror":o=enums.warpArchMirror;break;case"firstBaseline":o=enums.firstBaseline;break;case"simpleTextMode":o=enums.simpleTextMode;break;case"inGlowArea":case"inShadowArea":o=enums.effectArea;break;case"strokeJoin":case"fontStrokeJoin":case"pathTextStrokeJoin":e=enumIcons.strokeJoin,o=enums.strokeJoin;break;case"hyphenationLanguage":o=enums.hyphenationLanguage;break;case"barcodeType":o=enums.barcodeType;break;default:assertNever$1(this.property)}else Array.isArray(this.list)&&(o=this.list);const i=[];for(let r=0;r<o.length;r++)e&&t?i.push({key:o[r],label:t[r],icon:e[r]}):e?i.push({key:o[r],label:o[r],icon:e[r]}):t?i.push({key:o[r],label:t[r],icon:""}):i.push({key:o[r],label:o[r],icon:""});return i}static get styles(){return css`
            :host, :host * {
                box-sizing: border-box;
            }

            :host {
                display: flex;
                flex-direction: column;
            }

            .icon {
                width: 18px;
                height: 18px;
            }

            .icons-wrapper {
                display: flex;
                flex-direction: row;
                flex-wrap: wrap;
                width: 100%;
                min-height: 30px;
                align-items: flex-start;
                padding-top: var(--printess-input-top-padding);
            }
            .icons {
                display: grid;
                grid-template-rows: 24px;
                justify-content: flex-start;
                align-items: center;
                grid-column-gap: 4px;
            }
            .icon-wrapper {
                padding: 2px; 
                border: 1px solid var(--printess-panelBackgroundSelected);
                border-radius: 3px;
            }
            .icon-wrapper:hover {
                background-color: var(--printess-panelBackgroundHover);
            }
            .icons-label {
                font-size: var(--printess-labelSize);
                padding-right: 4px;
                padding-top: 2px;
                padding-bottom: 4px;
                width: 100%; /* remove this, for 2 column layout */
            }
        `}static getDashArray(e){if("solid"===e)return"";if("dotted"===e)return"0 4";{const t=e.replace("dashed ","");return"n"===t?"0 2":parseInt(t)-1+" 2"}}render(){return"strokeType"===this.property||"fontStrokeType"==this.property?html`
      <vaadin-select theme="small" id="select" .value=${this.uiValue}  label="${this.uiLabel}"   ?disabled=${this.uiDisabled}
        @value-changed=${e=>this.uiValue=e.currentTarget?e.currentTarget.value:null} >
        <template>
            <vaadin-list-box>
                    ${this.items.map((t=>html`
                <vaadin-item value="${t.key}">
                ${"dashed n"===t.key?html`
                  <span>Dashed N</span>
                `:html`
                  <svg style="width: 80px; height: 20px" viewBox="0 0 20 5" xmlns="http://www.w3.org/2000/svg">
                    <line x1="1" y1="3" x2="19" y2="3" stroke="black"  stroke-width="${t.key.startsWith("dotted")?"2":"1"}"
                    stroke-linecap="${t.key.startsWith("dotted")?"round":"square"}" stroke-dasharray="${e.getDashArray(t.key)}" />
                  </svg>
                `}
               
                          
                </vaadin-item>`))}
            </vaadin-list-box>
        </template>             
    </vaadin-select >
      `:!0===this.icons?html`
<div class="icons-wrapper" style="${this.uiDisabled?"opacity: 0.5":""}">
    <div class="icons-label">${this.uiLabel}</div>
    <div class="icons" style="grid-template-columns: repeat(${this.items.length}, 23px);">
        ${this.items.map((e=>html`<div class="icon-wrapper" title="${e.label}" 
                    @click=${()=>this.uiValue=e.key}
                    style="border-color: ${this.isSelected(e.key)?"var(--printess-headlineColor)":"var(--printess-textColor)"}; background-color: ${this.isSelected(e.key)?"var(--printess-panelBackgroundSelected)":"transparent"};">
                <wc-icon  class="icon"
                    primaryColor="${this.isSelected(e.key)?"headline":"text"}"  
                    icon="${e.icon||"empty"}" 
                ></wc-icon></div>`))}
    </div>
</div>
            `:html`
            
<vaadin-select theme="small" id="select" .value=${this.uiValue}  label="${this.uiLabel}"   ?disabled=${this.uiDisabled}
    @value-changed=${e=>this.uiValue=e.currentTarget?e.currentTarget.value:null} >
    <template>
        <vaadin-list-box>
                ${this.items.map((e=>html`
            <vaadin-item value="${e.key}">
                ${e.icon?html`<wc-icon style=" vertical-align: bottom; display: inline-block; margin-right: 4px; width: 18px; height: 18px;" icon="${e.icon}" ></wc-icon>`:""}
                ${e.label.startsWith("<")?html`${unsafeHTML(e.label)}`:e.label}        
            </vaadin-item>`))}
        </vaadin-list-box>
    </template>             
</vaadin-select >
`}getLabel(e){return new Function("value","return html`"+e+"`;").call(null,e)}iconClick(e){alert(e)}isSelected(e){return this.uiValue===e}get uiDisabled(){return isInactive(this.extendedValue)}get uiLabel(){let e="";if(this.property)switch(this.property){case"horizontalPathTextAlign":case"horizontalSimpleTextAlign":e="Horizontal:";break;case"horizontalTextAlign":e="Text Align:";break;case"verticalSimpleTextAlign":case"verticalStoryTextAlign":e="Vertical:";break;case"warpCustomTopTransform":e="Top Transformation";break;case"warpCustomBottomTransform":e="Bottom Transformation";break;case"warpArcPosition":case"warpPitPosition":e="Position";break;case"anchorRotation":e="Content Rotation";break;case"blendMode":case"dropBlend":case"inGlowBlend":case"outGlowBlend":case"inShadowBlend":case"strokeBlend":e="Blend Mode";break;case"autoTextMode":e="Auto Frame Size";break;case"textWrapMode":e="Wrap Text Around";break;case"imageMasking":e="Image Mask";break;case"imagePlacement":e="Image Placement";break;case"documentPlacement":e="Content Placement";break;case"imageType":e="Image Type";break;case"frameRepeat":e="Frame Repeat Settings";break;case"strokeAlign":case"fontStrokeAlign":case"pathTextStrokeAlign":e="Stroke Alignment";break;case"strokeType":case"fontStrokeType":case"tabLineType":e="Stroke Type";break;case"strokeJoin":case"fontStrokeJoin":case"pathTextStrokeJoin":e="Stroke Join";break;case"strokeCap":e="Line Cap";break;case"bulletMode":e="Bullets or Numbers";break;case"orientation":e="Orientation";break;case"textTransform":e="Text Case";break;case"gridSize":e="Grid Gap Size";break;case"buyerOrderNo":case"zoomActionOrderNo":e="Order-No.";break;case"boundToBoxSelection":e="Connected Frame Order-No.";break;case"warpArchMirror":e="Mirror";break;case"warpArchPosition":e="Position";break;case"firstBaseline":e="First Baseline";break;case"maskChannel":e="Masking Channel";break;case"inGlowArea":case"inShadowArea":e="Effect Area";break;case"fontHeights":e="Fitting";break;case"dashDistribution":case"fontDashDistribution":e="Dash Distribution";break;case"hyphenationLanguage":e="Hyphenation";break;case"simpleTextMode":e="Mode";break;case"barcodeType":e="Code Type";break;default:assertNever$1(this.property)}return this.label&&(e=this.label),augmentLabel(e,this.extendedValue)}get extendedValue(){return this.selection&&this.property&&this.feature?this.selection.getValueExtended(this.feature,this.property):{value:this.value,selector:this.selector,origin:this.origin}}get uiValue(){return this.selection&&this.property&&this.feature?this.selection.getValueExtended(this.feature,this.property).value:this.value}set uiValue(e){!1===this.uiDisabled&&null!=e&&e!==this.uiValue&&(this.selection&&this.property&&this.feature?"anchorRotation"===this.property&&this.selection.getMoverAnchorTriState("lt")!==eTriState.on?this.selection.setMoverAnchorValue("lt").then((()=>{setTimeout((()=>{this.selection&&this.feature&&this.property&&this.selection.setValue(this.feature,this.property,e)}),0)})):this.selection.setValue(this.feature,this.property,e):this.callback&&this.callback(e))}};return __decorate$7([property()],t.prototype,"feature",void 0),__decorate$7([property({attribute:!1,type:Object})],t.prototype,"selection",void 0),__decorate$7([property()],t.prototype,"property",void 0),__decorate$7([property({attribute:!1})],t.prototype,"value",void 0),__decorate$7([property()],t.prototype,"label",void 0),__decorate$7([property({attribute:!1})],t.prototype,"list",void 0),__decorate$7([property({attribute:!1})],t.prototype,"callback",void 0),__decorate$7([property()],t.prototype,"selector",void 0),__decorate$7([property()],t.prototype,"origin",void 0),__decorate$7([property({type:Boolean})],t.prototype,"icons",void 0),t=e=__decorate$7([customElement("wc-select")],t),t})();var __decorate$8=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n};let WcCombo=(()=>{let e=class extends LitElement{constructor(){super(...arguments),this.feature=null,this.selection=null,this.property=null,this.value=null,this.label=null,this.list=null,this.callback=null,this.selector=null,this.origin=null}updated(){if(this.shadowRoot){const e=this.shadowRoot.getElementById("combo");if(e){let t=[""];if("class"===this.property){const e=new Set;e.add("[none]"),scope().style.classNames.forEach((t=>e.add(t))),scope().currentDoc.getClassNames().forEach((t=>e.add(t)));for(const t of scope().globalResources.styles.values())t.classNames.forEach((t=>e.add(t)));t=Array.from(e).sort()}else"documentName"===this.property?t=Array.from(scope().docs.values()).map((e=>e.name)).filter((e=>e!==scope().currentDoc.name)):Array.isArray(this.list)&&(t=this.list);e.items=t}}}static get styles(){return css`
            :host, :host * {
                box-sizing: border-box;
            }

            :host {
                display: flex;
                flex-direction: column;
            }
        `}render(){return html`
            
          <vaadin-combo-box theme="small"  ?disabled=${this.uiDisabled} ?allow-custom-value="${this.uiAllowCustomValue}" id="combo" 
             .value=${this.uiValue}  label="${this.uiLabel}" 
             @value-changed=${e=>this.uiValue=e.currentTarget?e.currentTarget.value:null} 
             ></vaadin-combo-box>
               
        `}get uiDisabled(){return"class"!==this.property&&isInactive(this.extendedValue)}get uiAllowCustomValue(){return"class"===this.property}get uiLabel(){let e="";if(this.property)switch(this.property){case"class":e="Character"===this.label?"Character Style":"Paragraph"===this.label?"Paragraph Style":"Frame Style";break;case"documentName":e="Sub-Document";break;default:assertNever$1(this.property)}return this.label&&(e=this.label),"class"===this.property?e:augmentLabel(e,this.extendedValue)}get extendedValue(){return this.selection&&this.property&&this.feature?this.selection.getValueExtended(this.feature,this.property):{value:this.value,selector:this.selector,origin:this.origin}}get uiValue(){return this.selection&&this.property&&this.feature?this.selection.getValueExtended(this.feature,this.property).value:this.value}set uiValue(e){null!==e&&e!==this.uiValue&&(this.selection&&this.property&&this.feature?this.selection.setValue(this.feature,this.property,e):this.callback&&this.callback(e))}};return __decorate$8([property()],e.prototype,"feature",void 0),__decorate$8([property({attribute:!1,type:Object})],e.prototype,"selection",void 0),__decorate$8([property()],e.prototype,"property",void 0),__decorate$8([property()],e.prototype,"value",void 0),__decorate$8([property()],e.prototype,"label",void 0),__decorate$8([property({type:Array})],e.prototype,"list",void 0),__decorate$8([property({attribute:!1})],e.prototype,"callback",void 0),__decorate$8([property()],e.prototype,"selector",void 0),__decorate$8([property()],e.prototype,"origin",void 0),e=__decorate$8([customElement("wc-combo")],e),e})();var __decorate$9=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n};let WcSelectionAnchors=(()=>{let e=class extends LitElement{static get styles(){return[desktopPropertyStyles,css`


    :host, :host * {
        box-sizing: border-box;   
    }
    
    :host {
        --printess-anchor-size: 10px;
        display: block;
    }

    hr {
      border-color: var(--printess-headlineColor);
    }
    .anchors {
        width: 100px;
        height: 100px;
        position:relative;
    }
    .checker {
        /* position: absolute;
        width: 20px;
        height: 20px;*/
        border: var(--printess-headlineColor) 1px solid;
        border-radius: 10%;
        transition: border-color;
        transition-duration: 0.7s;
        cursor: pointer;
    }
    .checker.lefttop {
        border-color: var(--printess-textColor);
       /* border-width: 2px;*/
    }
    .checker.disabled {
        border-color: var(--printess-textColorDisabled);
    }
    .checker:hover {
        background-color: var(--printess-headlineColorHover);
    }
    

    .on {
        background-color: var(--printess-headlineColor);
    }
    .off {
        background-color: var(--printess-panelBackground);
    }
    
    .checker.on:hover {
        background-color: var(--printess-headlineColorHover);
    }
    
    .mixed {
        background-color: var(--printess-panelAnchorMixed);
    }
    .null {
        background-color: yellow;
    }
    .checker.disabled:hover {
        border-color: lightgray;
        background-color:  #eee;
        cursor: not-allowed;
    }
        
    .grid {
        display: grid;
        grid-template-columns: auto 1fr;
        grid-auto-rows: 30px;
    }
    input:disabled {
        color: #ccc    ;
        background-color: rgba(255,255,255,0.9);
    }
    
    
    .anchor-grid-container {
        padding-top: 8px;
        padding-bottom: 2px;
        display: flex;
        flex-direction: row;
        justify-content: space-around;
    }
    
    .options {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: space-between;
      width: 20px;
    }
    .options > wc-icon {
      cursor: pointer;

    }
    
    .top {
        grid-area: chk-top;
    }
    .left {
        grid-area: chk-left;
    }
    .right {
        grid-area: chk-right;
    }
    .bottom {
        grid-area: chk-bottom; 
    }
    
    
    
    
    .anchor-grid {
        display: grid;
            
        align-items: stretch;
        align-content: stretch;
        grid-gap: 8px 8px;
        grid-template-rows:   var(--printess-anchor-size)  var(--printess-anchor-size)  var(--printess-anchor-size) ;
        grid-template-columns:    var(--printess-anchor-size)  var(--printess-anchor-size)  var(--printess-anchor-size) ;
                    
        grid-template-areas:  "  m_lt  chk-top   .   "
                                "chk-left  magnet   chk-right "
                                "    . chk-bottom m_rb " ;

                                
    }
    
    .anchor-box {
    
        grid-column-start: m_lt; 
        grid-column-end: m_rb;
        grid-row-start: m_lt; 
        grid-row-end: m_rb;
        padding: calc(var(--printess-anchor-size) / 2);
    }
    .anchor-box > div {
        border: 1px solid var(--printess-headlineColor); 
        height: 100%;
    }
    
    
    .mover-grid {
    
    grid-template-areas:  "m_lt m_ct m_rt"
                            "m_lm m_cm m_rm"
                            "m_lb m_cb m_rb";

                            
    }
    
    .from-style {
        border-color: red !important;
        cursor: not-allowed !important; 
        
    }   

    .little-button {
        padding-left: 8px;
        padding-right: 8px;
        min-width: 20px;
    }
    
    .unit-converter {
        display: flex; 
        justify-content: space-between; 
        align-items: center; 
        flex-wrap: wrap; 
        margin-top: 10px; 
    }
       `]}renderAnchorUi(){return this.selection.allows("allowFrame","anchors")?html`
    <div class="anchor-grid-container">
       
        <div class="anchor-grid mover-grid" style="opacity: ${this.hasMoverAnchorGrid()?1:.3}; transform-origin: 50% 50%; transform: rotate(${this.selection.getRotation()}deg)">
         
             <div class="anchor-box"> 
                 <div> </div>
             </div>
           
             <div style="grid-area: m_lt;" class="checker lefttop  ${this.selection.getMoverAnchorTriState("lt")}" @click=${()=>this.moverClick("lt")} ></div>
             <div style="grid-area: m_lm;" class="checker ${this.selection.getMoverAnchorDisabled("lm")} ${this.selection.getMoverAnchorTriState("lm")}" @click=${()=>this.moverClick("lm")} ></div>
             <div style="grid-area: m_lb;" class="checker  ${this.selection.getMoverAnchorDisabled("lb")} ${this.selection.getMoverAnchorTriState("lb")}" @click=${()=>this.moverClick("lb")} ></div>
             
             <div style="grid-area: m_ct;" class="checker ${this.selection.getMoverAnchorDisabled("ct")} ${this.selection.getMoverAnchorTriState("ct")}" @click=${()=>this.moverClick("ct")} ></div>
             <div style="grid-area: m_cm;" class="checker ${this.selection.getMoverAnchorDisabled("cm")} ${this.selection.getMoverAnchorTriState("cm")}" @click=${()=>this.moverClick("cm")} ></div>
             <div style="grid-area: m_cb;" class="checker ${this.selection.getMoverAnchorDisabled("cb")} ${this.selection.getMoverAnchorTriState("cb")}" @click=${()=>this.moverClick("cb")} ></div>
             
             <div style="grid-area: m_rt;" class="checker ${this.selection.getMoverAnchorDisabled("rt")} ${this.selection.getMoverAnchorTriState("rt")}" @click=${()=>this.moverClick("rt")} ></div>
             <div style="grid-area: m_rm;" class="checker ${this.selection.getMoverAnchorDisabled("rm")} ${this.selection.getMoverAnchorTriState("rm")}" @click=${()=>this.moverClick("rm")} ></div>
             <div style="grid-area: m_rb;" class="checker ${this.selection.getMoverAnchorDisabled("rb")} ${this.selection.getMoverAnchorTriState("rb")}" @click=${()=>this.moverClick("rb")} ></div>
        
        </div> 
        <div class="options">
          
          <!--<wc-checker theme="icon" feature="basics" property="lockAspectRatio" .selection=${this.selection} ></wc-checker>-->
        
        </div>
        <div class="anchor-grid" style="opacity: ${this.hasAnchorGrid()?1:.3};" >
            
            <div class="anchor-box">  
                <div></div>
            </div>
            
            <div class="checker top ${this.selection.getAnchorTriState("Top")+" "+this.styleIndicator("anchorTop")} "  @click=${()=>this.anchorClick("Top")} ></div>
            <div class="checker left ${this.selection.getAnchorTriState("Left")+" "+this.styleIndicator("anchorLeft")}"  @click=${()=>this.anchorClick("Left")} ></div>
            
            <div class="checker bottom ${this.selection.getAnchorTriState("Bottom")+" "+this.styleIndicator("anchorBottom")}"  @click=${()=>this.anchorClick("Bottom")} ></div>
            <div class="checker right ${this.selection.getAnchorTriState("Right")+" "+this.styleIndicator("anchorRight")}"  @click=${()=>this.anchorClick("Right")} ></div>
            
            <wc-icon style="grid-area: magnet; margin-left: -2px; margin-top: -2px; width: 14px; height: 14px;" icon="magnet" primaryColor="headline" ></wc-icon> 
        
        </div>  
    </div>

    
    <div class="seperator"></div>
        `:""}renderPositionUi(){return this.selection.allows("allowFrame","positionByInput")?html`
   
    <div class="two-cols">
    
        <wc-length-box feature="boxGeometry" property="left" .selection=${this.selection}></wc-length-box>
        <wc-length-box feature="boxGeometry" property="top" .selection=${this.selection}></wc-length-box>
        <wc-length-box feature="boxGeometry" property="right" .selection=${this.selection}></wc-length-box>
        <wc-length-box feature="boxGeometry" property="bottom" .selection=${this.selection}></wc-length-box>
       
    </div>
    ${this.selection.hasFeature("storyRef")&&!this.selection.hasTextFlow()?html`
        <div class="two-cols" style="margin-bottom: 5px;">
            <div></div>
            <wc-select .icons=${!0} feature="storyRef" property="autoTextMode" .selection="${this.selection}"></wc-select>
        </div>
     `:""}
    

    <div class="two-cols">
        <wc-length-box feature="boxGeometry" property="width" .selection=${this.selection}></wc-length-box>
        <wc-length-box feature="boxGeometry" property="height" .selection=${this.selection}></wc-length-box>
    </div>

  ${this.selection.hasFeature("storyRef")&&!this.selection.hasTextFlow()?html`
    ${"height"===this.selection.getValueExtended("storyRef","autoTextMode").value?html`
    <div class="two-cols">
        <wc-length-box feature="storyRef" property="maxHeight" .selection=${this.selection}></wc-length-box>
        <wc-length-box feature="storyRef" property="minHeight" .selection=${this.selection}></wc-length-box>    
    </div>
    `:""}
    
    ${"width"===this.selection.getValueExtended("storyRef","autoTextMode").value?html`
    <div class="two-cols">
        <wc-length-box feature="storyRef" property="maxWidth" .selection=${this.selection}></wc-length-box>
        <wc-length-box feature="storyRef" property="minWidth" .selection=${this.selection}></wc-length-box>    
    </div>
    `:""}
  `:""}
 
        `:""}renderUnitConverterUi(){return this.selection.allows("allowFrame","unitConverter")?html`
    <div class="unit-converter">
        <vaadin-button class="little-button" @click=${()=>this.selection.convertAllLengthValues("px")} theme="small">px</vaadin-button>
        <vaadin-button class="little-button" @click=${()=>this.selection.convertAllLengthValues("cm")} theme="small">cm</vaadin-button>
        <vaadin-button class="little-button" @click=${()=>this.selection.convertAllLengthValues("inch")} theme="small">inch</vaadin-button>
        <vaadin-button class="little-button" @click=${()=>this.selection.convertAllLengthValues("%")} theme="small">%</vaadin-button>
        <vaadin-button class="little-button" @click=${()=>this.selection.convertAllLengthValues("%%W")} theme="small">
            <span><wc-icon icon="arrows-h" style="width: 14px; height: 14px" primaryColor="headline" slot="prefix"></wc-icon>
            %</span>
        </vaadin-button>
        <vaadin-button class="little-button" @click=${()=>this.selection.convertAllLengthValues("%%H")} theme="small">
            <wc-icon icon="arrows-v" style="width: 14px; height: 14px" primaryColor="headline" slot="prefix"></wc-icon>
            %
        </vaadin-button>
    </div> 
    <div class="seperator"></div>
        `:""}renderRotationUi(){if(this.selection.allows("allowFrame","rotation")){if(this.hasRotation())return html`<wc-number-box feature="boxGeometry" property="rotation" .selection=${this.selection}></wc-number-box>`;if(this.hasAnchorRotation())return html`<wc-select  icons feature="boxGeometry" property="anchorRotation" .selection=${this.selection}></wc-select>`}return""}renderMirrorUi(){return this.selection.allows("allowFrame","mirror")?html`
         
          <div style="display: grid; grid-template-columns: 1fr 30px 30px; align-items: center;">
            <div style="font-size: var(--printess-labelSize)" >Mirror:</div>
            <wc-checker theme="icon"  feature="basics" property="mirrorX" .selection=${this.selection}></wc-checker>
            <wc-checker theme="icon" feature="basics" property="mirrorY" .selection=${this.selection}></wc-checker>
          </div>
          <div class="seperator"></div>`:""}renderJsNameUi(){return this.selection.allows("allowFrame","name")?html`
        <vaadin-text-field theme="small" style="width: 100%" 
             label="Name" class="property" 
            .value=${this.selection.boxJsName}
            @change=${e=>this.selection.setBoxJsName(e.currentTarget?e.currentTarget.value:"")}  
        ></vaadin-text-field>
        `:""}renderTextWrapUi(){return this.selection.allows("allowFrame","textWrap")?html` 
             <div class="seperator"></div> 
            <wc-select feature="basics" property="textWrapMode" .selection="${this.selection}"></wc-select>
            ${"wrap around both sides"===this.selection.getValueExtended("basics","textWrapMode").value?html`
             <wc-length-box feature="basics" property="wrapObjectOffset" .selection=${this.selection}></wc-length-box>
          `:""}
           `:""}renderClassUiAlt(){return this.selection.allows("allowFrame","class")?html`<wc-combo feature="basics" property="class" .selection="${this.selection}"></wc-combo>`:""}renderClassUi(){const e=this.selection.getValueExtended("basics","class").value;let t=[];return e&&(t=e.split(" ").filter((e=>""!==e.trim()))),this.selection.allows("allowFrame","class")?html`<p style="margin-bottom: 0">Style [Class]</p><wc-tag-list caption="" addtags="allowed" type="class" .tags=${t} @tagsChanged=${e=>this.classChanged(e.detail)}  ></wc-tag-list>`:""}classChanged(e){const t=e.join(" ");this.selection.setValue("basics","class",t)}render(){return!this.selection||!this.selection.hasFeature("boxGeometry")||scope().filterPropertiesBySelectedFeature&&"geometry"!==this.selectedTool?html``:html`   
                
            ${this.renderAnchorUi()}
            ${this.renderPositionUi()}
            ${this.renderUnitConverterUi()}
            ${this.renderRotationUi()}
            ${this.renderMirrorUi()}
            ${this.renderJsNameUi()}
             
            ${this.renderClassUi()}
            ${this.renderTextWrapUi()}
            
          
     

            ${config.isBuyer?"":html`
              <div class="seperator"></div> 
              <div style="font-size: 8px; color: #a89a8d">${"ID:"+this.getSingleSelectionBoxId()+"   ORDER:"+this.getSingleSelectionOrder()}</div>
            `}
    
`}getSingleSelectionBoxId(){const e=scope().selection.getSingleSelection();return e?e.box.id:""}getSingleSelectionOrder(){const e=scope().selection.getSingleSelection();return e?e.box.order:""}hasRotation(){if(1===this.selection.boxes.size){const e=Array.from(this.selection.boxes.values())[0];return e.box.boxGeometry.hasWidth()&&e.box.boxGeometry.hasHeight()}return!1}hasAnchorRotation(){if(1===this.selection.boxes.size){const e=Array.from(this.selection.boxes.values())[0];return!e.box.boxGeometry.hasWidth()||!e.box.boxGeometry.hasHeight()}return!1}hasMoverAnchorGrid(){return!0}hasAnchorGrid(){return!(isInactive(this.selection.getValueExtended("boxGeometry","anchorLeft"))||isInactive(this.selection.getValueExtended("boxGeometry","anchorTop"))||isInactive(this.selection.getValueExtended("boxGeometry","anchorRight"))||isInactive(this.selection.getValueExtended("boxGeometry","anchorBottom")))}setRotation(e){this.selection.setPosition("rotation",e+"")}styleIndicator(e){return this.selection.getStyleSelector(e)?"from-style":""}anchorClick(e){let t=!0;this.selection.getAnchorTriState(e)===eTriState.on&&(t=!1),this.selection.setAnchorValue(e,t)}moverClick(e){if(""===this.selection.getMoverAnchorDisabled(e)){"on"!==this.selection.getMoverAnchorTriState(e)&&this.selection.setMoverAnchorValue(e)}}};return __decorate$9([property({attribute:!1,type:Object})],e.prototype,"selection",void 0),__decorate$9([property()],e.prototype,"selectedTool",void 0),e=__decorate$9([customElement("wc-selection-anchors")],e),e})();var __awaiter$k=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};const panels={isLeftDragging:!1,isRightDragging:!1,stageMinWidth:200,resources:{minWidth:200,maxWidth:700,initialWidth:-1,width:-1},properties:{minWidth:250,maxWidth:700,initialWidth:280,width:280}},debounce=(e,t,o=!1)=>{let i;return function(...r){return void 0===i&&o&&t.apply(this,r),clearTimeout(i),i=window.setTimeout((()=>t.apply(this,r)),e),i}};function persistPanelWidths(){return __awaiter$k(this,void 0,void 0,(function*(){const e=(new Nobs).setProperty(scope().templateProperties,"resourcesPanelWidth",panels.resources.width);e.setProperty(scope().templateProperties,"propertiesPanelWidth",panels.properties.width);const t=new TemplateProperties(e,scope().templateProperties);yield update([scope().templateProperties.serialize()],[t.serialize()],void 0,!1)}))}const persistPanelWidthsDebounced=debounce(1e3,(()=>{persistPanelWidths()}));function setSplitterCursor(e){const t=document.getElementById("mainGrid");t&&(t.style.cursor=e)}function startResourceSplitterMove(){panels.isLeftDragging=!0,document.addEventListener("mousemove",moveSplitter),document.addEventListener("mouseup",endSplitterMove),setSplitterCursor("ew-resize")}function startPropertiesSplitterMove(){panels.isRightDragging=!0,document.addEventListener("mousemove",moveSplitter),document.addEventListener("mouseup",endSplitterMove),setSplitterCursor("ew-resize")}function endSplitterMove(){document.removeEventListener("mousemove",moveSplitter),document.removeEventListener("mouseup",endSplitterMove),panels.isLeftDragging=!1,panels.isRightDragging=!1,setSplitterCursor("auto")}function moveSplitter(e){e.preventDefault();const t=document.getElementById("mainGrid"),o=document.getElementById("resources"),i=document.getElementById("properties");if(t&&o&&i){if(panels.isLeftDragging){if(scope()&&scope().resourcesUi.isMinimized())return void scope().resourcesUi.normalize();const i=t.clientWidth;let r=panels.isLeftDragging?e.clientX:o.clientWidth;r=Math.max(Math.min(r,panels.resources.maxWidth),panels.resources.minWidth),r+panels.properties.width>i-panels.stageMinWidth&&(r=i-panels.stageMinWidth-panels.properties.width),panels.resources.width=r}if(panels.isRightDragging){const o=t.clientWidth;let r=panels.isRightDragging?t.clientWidth-e.clientX:i.clientWidth;r=Math.max(Math.min(r,panels.properties.maxWidth),panels.properties.minWidth),panels.resources.width+r>o-panels.stageMinWidth&&(r=o-panels.stageMinWidth-panels.resources.width),panels.properties.width=r}setPanelColumns()}}function setPanelColumns(e=123){const t=document.getElementById("mainGrid");if(t)if(-1===panels.resources.initialWidth?(panels.resources.initialWidth=config.resourcePanelInitialWidth(),panels.resources.width=config.resourcePanelInitialWidth(),scope().templateProperties.resourcesPanelWidth&&(panels.resources.width=scope().templateProperties.resourcesPanelWidth),scope().templateProperties.propertiesPanelWidth&&(panels.properties.width=scope().templateProperties.propertiesPanelWidth)):persistPanelWidthsDebounced(),setMainMobileGridRows(e),isMobile()!==config.isMobile&&(config.isMobile=isMobile(),scope()&&(scope().boxSelection.requestUpdate(),scope().selectionPropertiesUi.requestUpdate(),scope().resourcesUi.requestUpdate(),scope().toolbarUi.requestUpdate())),config.isMobile||config.hideControls)t.style.gridTemplateColumns="100%";else{scope()&&scope().resourcesUi&&(scope().resourcesUi.isMinimized()?panels.resources.width=config.resourceToolBarWidth():panels.resources.width===config.resourceToolBarWidth()&&(panels.resources.width=config.resourcePanelInitialWidth()));const e=t.clientWidth;config.isBuyer?t.style.gridTemplateColumns=`1fr 1px ${panels.properties.width}px`:(scope().docSelectorUI.tabsWidth=e-90+"px",panels.resources.width+panels.properties.width+panels.stageMinWidth>e&&(panels.resources.width=panels.resources.minWidth,panels.properties.width=panels.properties.minWidth),t.style.gridTemplateColumns=`${panels.resources.width}px 1px 1fr 1px ${panels.properties.width}px`)}}function measureTextAreaHeight(e,t=40){const o=document.createElement("div");o.style.position="absolute",o.style.opacity="0",o.style.top="100px",o.style.backgroundColor="pink",o.style.padding="calc(var(--lumo-font-size-s) * 1) calc(var(--lumo-font-size-s) * 1.45 + var(--lumo-border-radius) / 4 - 1px)",o.style.lineHeight="var(--lumo-line-height-s)",o.style.fontSize="var(--lumo-font-size-s)",o.style.width=panels.properties.width-30-config.propertiesToolBarWidth()+"px";let i=e.replace(/\n/g,"<br>");i.endsWith("<br>")&&(i+="x"),o.innerHTML=i,document.body.appendChild(o);const r=o.offsetHeight;return document.body.removeChild(o),Math.max(t,r)}function measureSimpleTextAreaHeight(e,t=30){const o=document.createElement("div");o.style.position="absolute",o.style.opacity="0",o.style.top="100px",o.style.backgroundColor="pink",o.style.padding="4px",o.style.lineHeight="140%",o.style.fontSize="11px",o.style.width=panels.properties.width-30-config.propertiesToolBarWidth()+"px";let i=e.replace(/\n/g,"<br>");i.endsWith("<br>")&&(i+="x"),o.innerHTML=i,document.body.appendChild(o);const r=o.offsetHeight;return document.body.removeChild(o),Math.max(t,r)}scopeReady((function(){const e=document.getElementById("resourcesSplitterBar"),t=document.getElementById("propertiesSplitterBar");config.hideControls?(e&&(e.style.display="none"),t&&(t.style.display="none")):(e&&e.addEventListener("mousedown",startResourceSplitterMove),t&&t.addEventListener("mousedown",startPropertiesSplitterMove),window.addEventListener("resize",(()=>{resizePrintess(),setPanelColumns()})));const o=document.getElementById("mainGrid");o&&(config.hideControls?(o.classList.remove("admin"),o.classList.remove("buyer"),o.classList.add("hide-controls")):(o.classList.remove(config.isBuyer?"admin":"buyer"),o.classList.add(config.isBuyer?"buyer":"admin"))),setMainMobileGridRows(),setPanelColumns()}));var __decorate$a=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n};let WcTextArea=(()=>{let e=class extends LitElement{constructor(){super(...arguments),this.selection=null,this.feature=null,this.property=null,this.mode="singleLine",this.hint="on",this.label=null,this.suffix=null,this.value=null,this.callback=null,this.lastPosition=null}static get styles(){return css`
            :host, :host * {
                box-sizing: border-box;
            }
            :host {
              display: block;
              position: relative;
            }
          /*  vaadin-text-area {
                 width: 100%;
                 height: 200px
            }

            vaadin-text-area.singleLine {
              height: 60px;
            }*/
           
            .label {
                font-size: var(--printess-labelSize);
                padding-right: 4px;
                padding-top: 2px;
                padding-bottom: 4px;
                white-space: nowrap;
            }
            .counter {
              position: absolute;
              right: 0;
              top: 3px;
              font-size: var(--printess-labelSize);
              color: var(--printess-textColor);
            }
            .desk-text-area {
              background-color: var(--printess-inputBackground);
              color: var(--printess-inputColor);
              height: 80px;
              width: 100%;
              border: none;
              border-radius: 4px;
              resize: none; 
            }
            .desk-text-area.singleLine {
              height: 40px;
            }
            .hint {
              font-size: 10px; 
              text-align: right; 
              padding-bottom: 6px;
            }
            @media (max-width: ${config.mobileDeviceWidth}px) {
                :host {
                    padding-left: 5%;
                    padding-top: 35px;
                    width: 100%;
                    display: block;
                }
                textarea {
                    width: 95%;
                    height: 50px;
                    font-size: 21px;
                }
                input {
                  width: calc(100% - 40px);
                  height: 40px; 
                  font-size: 24px; 
                  
                  border: none; 
                  background-color: white;
                  color: black;
                }
            }

        `}render(){const e=isMobile();return e&&"singleLine"===this.mode||"input"===this.mode?html`<input type="text" id="textinput" ?disabled=${this.uiDisabled}
        @keyup=${e=>this.uiValueString=e.currentTarget?e.currentTarget.value:""}}
        .value=${this.uiValueString}  @focus=${()=>this.focus()} />`:e&&"multiLine"===this.mode?html`<textarea id="textinput" ?disabled=${this.uiDisabled} 
        @keyup=${e=>this.uiValueString=e.currentTarget?e.currentTarget.value:""}}
        .value=${this.uiValueString}
        @focus=${()=>this.focus()}></textarea>`:html`
      ${this.getLabel()?html`<div class="label"> ${this.getLabel()}</div>`:""}
      <textarea id="textinput" class="desk-text-area ${this.mode}" ?disabled=${this.uiDisabled} 
        @keyup=${e=>this.keyUp(e)}
        @keydown=${e=>{"Enter"===e.key&&"singleLine"===this.mode&&e.preventDefault()}}
        .value=${this.uiValueString} @mousedown=${e=>this.areaDown(e)}
        @focus=${()=>this.focus()}></textarea>
        ${e||config.isBuyer||"on"!==this.hint?"":html`<div class="hint">Right Click to insert Form Field</div>`}
        `}keyUp(e){if(this.shadowRoot){const t=this.shadowRoot.querySelector("#textinput.desk-text-area");t&&(" "===e.key&&e.ctrlKey||"Enter"===e.key?beep():this.uiValueString=t.value)}}areaDown(e){if(2===e.button&&e.target){e.preventDefault;const t=[];t.push(...Array.from(scope().getAllGlobalFormFields().values()).filter((e=>"USER_CREATED"===e.systemType)).map((e=>"${form."+e.name+"}"))),t.push(...Array.from(scope().currentDoc.getAllDocFormFields(null).values()).filter((e=>"USER_CREATED"===e.systemType)).map((e=>"${form."+e.name+"}")));showCtxMenu(e,t.map((e=>({caption:e,callback:()=>{if(this.shadowRoot){const t=this.shadowRoot.querySelector("#textinput.desk-text-area");t&&(t.setRangeText(e),this.uiValueString=t.value)}}}))),-e.offsetX-3,e.offsetY,300)}}get areaHeight(){return measureTextAreaHeight(this.uiValueString)+25}hasCharCounter(){return!(!this.selection||"simpleText"!==this.feature||"text"!==this.property)}charCounter(){if(this.selection){const e=this.selection.getValueExtended("simpleText","maxCharacters").value||0,t=this.selection.getValueExtended("simpleText","text").value||"";if(e>0)return t.length+" of "+e+" letters"}return""}focus(){if(this.selection){scope().selectionPropertiesUi.lastPosition||(scope().selectionPropertiesUi.lastPosition=getCurrentScrollPosition());const e=this.selection.getSingleSelection();e&&(console_log("....centerBoxInViewWithKeyboard...."),scope().docUi.centerBoxInViewWithKeyboard(e.box,e.spread))}}updated(e){var t;console_log("WCTextArea received update = "+this.uiValueString),this.shadowRoot&&(null===(t=this.shadowRoot.querySelector("textarea"))||void 0===t?void 0:t.matches(":focus"))&&this.focus()}hasStyleSelector(){const e=this.extendedValue;return!(!e||!e.selector)}get uiDisabled(){return isInactive(this.extendedValue)}get extendedValue(){return this.selection&&this.feature&&this.property?this.selection.getValueExtended(this.feature,this.property):{value:this.value,selector:"",origin:"unset"}}get uiValueString(){const e=this.extendedValue;return e&&e.value?e.value:""}set uiValueString(e){if(null!==e)if("singleLine"===this.mode&&(e=e.replace(/[\n\r]/g,"")),this.selection&&this.property&&this.feature){const t=this.selection.getValueExtended(this.feature,this.property).value;if("simpleText"===this.feature&&"text"===this.property){const o=this.selection.getValueExtended("simpleText","maxCharacters").value||0;if(o>0&&o<e.length){if(beep(),this.requestUpdate(),this.shadowRoot){const e=this.shadowRoot.querySelector("#textinput");e&&(e.value=t||"")}return}}t!==e&&(scope().updatesBeforeBlurActiveElementOnNewSelection=this.selection.boxes.size||1,this.selection.setValue(this.feature,this.property,e))}else this.callback&&this.value!==e&&(this.value=e,this.callback(this.value))}getLabel(){let e="";if(this.selection&&this.property)switch(this.property){case"text":return"Text";case"textBefore":return"Text Before";case"textAfter":return"Text After";case"textOnPath":return"Text on path";case"textFieldCaption":return"Text-Input Label";case"class":case"documentName":e="Not in use with text area";break;default:e=this.property}else e=null!==this.label?this.label:"Length";return augmentLabel(e,this.extendedValue)}};return __decorate$a([property({attribute:!1,type:Object})],e.prototype,"selection",void 0),__decorate$a([property({attribute:!0,type:String})],e.prototype,"feature",void 0),__decorate$a([property({attribute:!0,type:String})],e.prototype,"property",void 0),__decorate$a([property({attribute:!0,type:String})],e.prototype,"mode",void 0),__decorate$a([property({attribute:!0,type:String})],e.prototype,"hint",void 0),__decorate$a([property()],e.prototype,"label",void 0),__decorate$a([property()],e.prototype,"suffix",void 0),__decorate$a([property()],e.prototype,"value",void 0),__decorate$a([property({attribute:!1})],e.prototype,"callback",void 0),e=__decorate$a([customElement("wc-text-area")],e),e})();var __decorate$b=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n};let WcColorGrid=(()=>{let e=class extends LitElement{constructor(){super(...arguments),this.feature=null,this.selection=null,this.property=null,this.colorHexValue=null,this.label=null,this.callback=null,this.selector=null,this.origin=null,this.mode="inline",this.transparency=!1,this.colors=null,this.curentColors=[]}rgb(e,t,o){return"#"+[e,t,o].map((e=>{const t=e.toString(16);return 1===t.length?"0"+t:t})).join("")}static get styles(){return css`
            :host, :host * {
                box-sizing: border-box;
            }

            :host {
                display: block;
               
                position: relative;
            }
            .input {
              width: 30px;
              height: 30px;
            }
            .color-square {
              width: 30px;
              height: 30px;
              position: relative;
            }
            
            .red-line {
                position: absolute;
                height: 3px;
                width: 20px;
                top: 12px;
                left: 4px;
                transform-origin: 50% 50%;
                transform: rotate(45deg);
                background-color: red;
              }

            .flex {
                width: auto;
                display: block;
                
                flex-wrap: wrap; 
            }
          
            .flex-popup {
                width: auto;
                display: block;
                position: absolute;
                top: 200px;
                left: 0px;
                flex-wrap: wrap; 
            }
           
            .flex-popup > div, .flex > div {
                width: 25px;
                height: 25px;
                border-radius: 50%;
                border: 1px solid black;
                margin-right: 1px;
                margin-left: 1px;
                display: inline-block;
                cursor: pointer;
            }
            @media (min-width:  ${config.mobileDeviceWidth+1}px) {
              .flex {
                width: 100% !important;
              }
              .flex > div {
                width: 17px;
                height: 18px;
                margin: 0;
                border-radius: 25%;
                border: none;
              }
            }
            
        `}render(){this.curentColors=this.colors||Array.from([{name:"Pasteboard",value:"#4e4e50"},...config.rgbColors]),this.transparency&&this.curentColors.unshift({name:"transparent",value:"transparent"});const e=this.uicolorHexValue||"#ffffff",t=this.curentColors.filter((t=>t.value===e));return 0===t.length?this.curentColors.unshift({name:"Selected Color",value:e}):t[0].name="Selected Color","popup"===this.mode?html`
      <div class="input" @click="${()=>this.showPopup()}">
        <div class="color-square" style="background-color: ${e}; ${"popup"===this.mode?"border-radius: 50%; border: 1px solid #444;":""} ">
          ${"transparent"===e?html`<div class="red-line"></div>`:""}
        </div>
      </div>
    `:(this.style.overflow="auto",html`
          <div class="flex" style="width: ${38*config.rgbColors.length}px">
            ${this.curentColors.map((e=>html` 
                  <div style="background-color: ${e.value}; ${"Selected Color"===e.name?"border: 2px solid black;":""}" 
                    title="${e.name}" @click=${()=>this.uicolorHexValue=e.value} ></div>
            `))}     
          </div>
        `)}showPopup(){showColorList(getElementOffset$1(this,"offsetLeft"),getElementOffset$1(this,"offsetTop")+40,this.curentColors.map((e=>e.value)),(e=>this.colorPopupCallback(e)),this.uicolorHexValue)}colorPopupCallback(e){this.uicolorHexValue=e}get uiLabel(){return augmentLabel("Color",this.extendedValue)}get uiDisabled(){return isInactive(this.extendedValue)}get extendedValue(){return this.selection&&this.property&&this.feature?this.selection.getValueExtended(this.feature,this.property):{value:this.colorHexValue,selector:this.selector,origin:this.origin}}get uicolorHexValue(){if(this.selection&&this.property&&this.feature){const e=this.selection.getValueExtended(this.feature,this.property).value;return e?e.toCssColor():null}return this.colorHexValue}set uicolorHexValue(e){var t;if(null!==e&&e!==this.uicolorHexValue){const t=Color.parseRgbColor(e);t&&(this.selection&&this.property&&this.feature?this.selection.setValue(this.feature,this.property,new ColorRef(t)):this.callback&&this.callback(t))}console_log("after set uicolorHexValue: "+(null===(t=document.activeElement)||void 0===t?void 0:t.tagName))}};return __decorate$b([property()],e.prototype,"feature",void 0),__decorate$b([property({attribute:!1,type:Object})],e.prototype,"selection",void 0),__decorate$b([property()],e.prototype,"property",void 0),__decorate$b([property()],e.prototype,"colorHexValue",void 0),__decorate$b([property()],e.prototype,"label",void 0),__decorate$b([property({attribute:!1})],e.prototype,"callback",void 0),__decorate$b([property()],e.prototype,"selector",void 0),__decorate$b([property()],e.prototype,"origin",void 0),__decorate$b([property({type:String})],e.prototype,"mode",void 0),__decorate$b([property({type:Boolean})],e.prototype,"transparency",void 0),__decorate$b([property({type:Array,attribute:!1})],e.prototype,"colors",void 0),e=__decorate$b([customElement("wc-color-grid")],e),e})();class WcDeleteSwatchDialog extends LitElement{constructor(e){if(super(),!e)throw new Error("WcDeleteSwatchDialog constructor expects a valid swatchName");this.swatchName=e,this.replaceMode="color",this.backdrop=new WcBackdrop,this.newName="[None]";const t=scope().colors.getSwatchByName(this.swatchName);if(!t)throw new Error("Swatch to delete not found: "+e);this.swatchToDelete=t}showDialog(e){this.callback=e,document.body.appendChild(this.backdrop),document.body.appendChild(this)}closeDialog(e=!1){document.body.removeChild(this.backdrop),document.body.removeChild(this),this.callback&&this.callback(e)}ok(){let e;const t=[],o=[],i=scope().colors.getOrReplaceAllBoxesWithSwatch(this.swatchName);for(const[r,s]of i){e=new Nobs;for(const t of s)if("swatch"===this.replaceMode&&this.newName)e.replaceObject(t,new ColorRef(this.newName,t.tint,t.opacity,t.modifier));else{const o=this.swatchToDelete.serialize(!0,0,!0);e.replaceObject(t,new ColorRef(o.id,{id:o.id,color:o.data,tint:100,mo:{m:"inactive",h:0,l:0,s:0},op:100}))}const i=new Box(e,r.box);t.push(r.box.serialize(r.spread.id,r.doc.id)),o.push(i.serialize(r.spread.id,r.doc.id))}o.length>0&&update(t,o),remove([this.swatchToDelete.serialize()],void 0,!0),this.closeDialog(!0)}static get properties(){return{swatchName:{type:String},replaceMode:{type:String}}}static get styles(){return[dialogStyles,css`
              

              .mode-combo {
                grid-area: mode;
              } 
             
              .color-preview {
                width: 100%;
                height: 50%;
                background-color: yellow;
              }
              
               .color-preview-container {
                width: 100%;
                height: 75%;
                position: relative;
                background-color: yellow;
                grid-area: old;
              }

              .content {
                max-width: 600px;
              } 
             
        `]}render(){return html`
           
          <div class="content">
           
                
            <h1 style="padding-bottom: 10px;">Delete Swatch (${this.swatchName})</h1>
            <p><strong>This swatch is used somewhere else. </strong>Please specify if those occcurences should be converted to custom colors or replaced by another swatch:</p>
            
            <vaadin-radio-button ?checked=${"color"===this.replaceMode} style="grid-area: mode_g"  @checked-changed=${e=>this.modeChanged(e,"color")} >Custom Color</vaadin-radio-button>
          
            <vaadin-radio-button ?checked=${"swatch"===this.replaceMode} style="grid-area: mode_r"   @checked-changed=${e=>this.modeChanged(e,"swatch")} >Other Swatch</vaadin-radio-button>
            
           
            <div  style=" height: 150px; padding-top: 20px;">
                ${"swatch"===this.replaceMode?html`<wc-select label="Replacememt Color Swatch" .list=${this.getReplaceColors()} .callback="${e=>this.newName=e}" ></wc-select>`:""}
            </div> 
             
               
            </div>
        </div>
        
        <div class="footer" >
           
          <vaadin-button style="grid-column: 2" @click=${this.ok} theme="primary">OK</vaadin-button>
          <vaadin-button style="grid-column: 3" @click=${this.closeDialog} theme="secondary">CANCEL</vaadin-button>
        </div>
        
          
         
        `}getReplaceColors(){const e=new Set;for(const t of scope().colors.namedColorsSorted)t.name!==this.swatchToDelete.name&&e.add(t.name);return Array.from(e).sort()}modeChanged(e,t){e&&e.target&&e.target.checked&&(this.replaceMode=t)}}customElements.define("wc-delete-swatch-dialog",WcDeleteSwatchDialog);var __awaiter$l=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};class WcDialogColor extends LitElement{constructor(e,t,o){if(super(),!e||void 0===t||!o)throw new Error("WcDialogColor constructor expects a color, editNamedColor, callback.");t&&e.name?this.swatchEditMode=!0:this.swatchEditMode=!1,this.orgColor=e,this.backdrop=new WcBackdrop,this.mode=e.mode,this.type=e.type,this.r=e.r,this.g=e.g,this.b=e.b,this.c=e.c,this.m=e.m,this.y=e.y,this.k=e.k,this.L=e.L,this.A=e.A,this.B=e.B,this.name=e.name,this.autoName=e.autoName,this.group=e.group,this.callback=o}showDialog(){document.body.appendChild(this.backdrop),document.body.appendChild(this)}closeDialog(){document.body.removeChild(this.backdrop),document.body.removeChild(this)}getColor(e="",t=!0,o="process",i,r=!1){return new Color(this.r,this.g,this.b,this.c,this.m,this.y,this.k,this.L,this.A,this.B,e,this.mode,o,this.orgColor.access,t,i||this.orgColor.id,r?void 0:this.orgColor.order,this.group)}removeNamedColor(){new WcDeleteSwatchDialog(this.orgColor.name).showDialog(),this.closeDialog()}addNamedColor(){const e=this.getColor().toAutoName(""),t=this.getColor(e,void 0,void 0,generateDBID(),!0).serialize(!0,void 0,void 0,"write"),o=new Color(t.id,t.data);create([t]),this.callback(o),this.closeDialog()}ok(){return __awaiter$l(this,void 0,void 0,(function*(){if(this.closeDialog(),this.swatchEditMode){const e=this.getColor(this.name,this.autoName,this.type),t=this.orgColor.name;let o;if(o=this.orgColor.name!==e.name?scope().colors.getOrReplaceAllBoxesWithSwatch(t,e.name):scope().colors.getOrReplaceAllBoxesWithSwatch(t),this.orgColor.name!==e.name){const t=[],i=[];for(const r of o.keys())if(r.box.storyRef&&r.box.storyRef.story){const o=r.box.storyRef.story,s=o.serialize();replaceAllColorNames(s,this.orgColor.id,this.orgColor.name,e.name)&&(i.push(o.serialize()),t.push(s))}t.length&&(yield update(i,t))}yield update([this.orgColor.serialize()],[e.serialize()]),this.callback(e)}else this.callback(this.getColor("",!0,"process",generateDBID()))}))}static get properties(){return{r:{type:Number},g:{type:Number},b:{type:Number},c:{type:Number},m:{type:Number},y:{type:Number},k:{type:Number},mode:{type:String},name:{type:String},autoName:{type:Boolean},type:{type:String},swatchEditMode:{type:Boolean}}}firstUpdated(){if(this.shadowRoot){const e=this.shadowRoot.getElementById("colorwheel");e&&(this.colorPicker=new window.iro.ColorPicker(e,{width:280,color:{r:this.r,g:this.g,b:this.b},borderWidth:1,borderColor:"#fff"}),this.colorPicker.on("color:change",((e,t)=>this.onColorChange(e))));const t=this.shadowRoot.getElementById("colorMode");t&&(t.items=[{caption:"R G B",value:"rgb"},{caption:"C M Y K",value:"cmyk"}])}}static get styles(){return[dialogStyles,css`
        
         
        .content {
           
          display: grid;
         
          column-gap: var(--printess-dialog-padding);
          
          grid-template-columns: 280px 110px 110px 110px;;
          grid-template-rows: 75px 50px 30px 1fr max-content;
           
          grid-template-areas:  "   name          spot1    .      old "
                                "   autoName      spot2    .      old "
                                "  wheel         mode_r   mode_g  mode_l"
                                "  wheel         rgb      cmyk     LAB"
                                "  wheel         list      list     list"
      }
        
        .mode-combo {
          grid-area: mode;
        } 
 
        
        .color-preview {
          width: 100%;
          height: 50%;
          background-color: yellow;
        }
        
         .color-preview-container {
          width: 100%;
          height: 75%;
          position: relative;
          background-color: yellow;
          grid-area: old;
        }
       
       
       vaadin-text-field {
           width: 100%;
       }
        `]}render(){return html`
            
           <div class="content" >
                
                ${this.swatchEditMode?html`
               <vaadin-radio-button  ?checked=${"process"===this.type} style="grid-area: spot1;align-self: flex-end;padding-bottom: 30px;"   @checked-changed=${e=>this.colorTypeChanged(e,"process")}    >Process</vaadin-radio-button>
               <vaadin-radio-button ?checked=${"spot"===this.type} style="grid-area: spot1;align-self: flex-end;"  @checked-changed=${e=>this.colorTypeChanged(e,"spot")} >Spot</vaadin-radio-button>
               <vaadin-text-field id="nameField"  minlength="1"  maxlength="30" label="Swatch Name" ?disabled=${this.autoName||"readonlyName"===this.orgColor.access} 
                            @change=${e=>this.nameChanged(e)}
                            style="grid-area: name" value="${this.name}"></vaadin-text-field>
               <vaadin-checkbox  ?disabled=${"readonlyName"===this.orgColor.access} style="grid-area: autoName" ?checked=${this.autoName}
               @checked-changed=${e=>this.autoNameChanged(e)}>Name with Color Value</vaadin-checkbox>

            `:html`<h1>Custom Color</h1>`}
                
                
                <div class="color-preview-container" >
                   <div class="color-preview" style="grid-area: old; background: ${this.orgColor.toCssColor(100,100)}"></div>
                   <div class="color-preview" style="grid-area: new; background: ${this.getColor().toCssColor(100,100)}"></div>
                </div>
              
               <vaadin-radio-button ?checked=${"rgb"===this.mode} style="grid-area: mode_r"   @checked-changed=${e=>this.colorModeChanged(e,"rgb")}    >RGB</vaadin-radio-button>
               <vaadin-radio-button ?checked=${"cmyk"===this.mode} style="grid-area: mode_g"  @checked-changed=${e=>this.colorModeChanged(e,"cmyk")} >CMYK</vaadin-radio-button>
                <vaadin-radio-button ?checked=${"LAB"===this.mode} style="grid-area: mode_l"  @checked-changed=${e=>this.colorModeChanged(e,"LAB")} >LAB</vaadin-radio-button>
              
               <div style="grid-area: wheel" id="colorwheel" ></div>
               <wc-color-grid style="grid-area: list; margin-top: 10px;"
                  .callback=${e=>this.colorGridPick(e)} 
                  origin="None"  selector=""></wc-color-grid>

               <div style="grid-area: rgb"   >
            
                    <vaadin-number-field theme="small"   @change=${e=>this.rgbValueChange(e.currentTarget,"r")} label="Red (R)"   value="${this.r}" has-controls min="0" max="255"></vaadin-number-field>
                    <vaadin-number-field theme="small"   @change=${e=>this.rgbValueChange(e.currentTarget,"g")} label="Green (G)"   value="${this.g}" has-controls min="0" max="255"></vaadin-number-field>
                    <vaadin-number-field theme="small"  @change=${e=>this.rgbValueChange(e.currentTarget,"b")} label="Blue (B)"   value="${this.b}" has-controls min="0" max="255"></vaadin-number-field>
                  
                  <vaadin-text-field label="Web Color" value="${this.webColor()}"  @change=${e=>this.webColorChanged(e)} theme="small"> </vaadin-text-field>
               </div>
              
               <div style="grid-area: cmyk" >
                  <vaadin-number-field theme="small"   @change=${e=>this.cmykValueChange(e.currentTarget,"c")} label="Cyan (C)" suffix="%" value="${this.c}" has-controls min="0" max="100"></vaadin-number-field>
                  <vaadin-number-field theme="small"  @change=${e=>this.cmykValueChange(e.currentTarget,"m")} label="Magenta (M)"   value="${this.m}" has-controls min="0" max="100"></vaadin-number-field>
                  <vaadin-number-field theme="small"  @change=${e=>this.cmykValueChange(e.currentTarget,"y")} label="Yellow (Y)" value="${this.y}" has-controls min="0" max="100"></vaadin-number-field>
                  <vaadin-number-field theme="small"   @change=${e=>this.cmykValueChange(e.currentTarget,"k")} label="Kontrast (K)"   value="${this.k}" has-controls min="0" max="100"></vaadin-number-field>
               
               </div>
               
                <div style="grid-area: LAB" >
                  <vaadin-number-field theme="small"   @change=${e=>this.labValueChange(e.currentTarget,"L")} label="Lightness (L)" suffix="%" value="${this.L}" has-controls min="0" max="100"></vaadin-number-field>
                  <vaadin-number-field theme="small"  @change=${e=>this.labValueChange(e.currentTarget,"A")} label="Color (a)"   value="${this.A}" has-controls min="-128" max="127"></vaadin-number-field>
                  <vaadin-number-field theme="small"  @change=${e=>this.labValueChange(e.currentTarget,"B")} label="Color (b)" value="${this.B}" has-controls min="-128" max="127"></vaadin-number-field>
               
               </div>

    
        </div>
        
         <div class="footer" >
               ${this.swatchEditMode?html`<vaadin-button style="grid-column: 0" @click=${this.removeNamedColor} theme="secondary">Remove this Swatch</vaadin-button>`:html`<vaadin-button style="grid-column: 0" @click=${this.addNamedColor} theme="secondary">Add ${this.mode.toString().toUpperCase()} Swatch</vaadin-button>`}
            <vaadin-button style="grid-column: 2" @click=${this.ok} theme="primary">OK</vaadin-button>
            <vaadin-button style="grid-column: 3" @click=${this.closeDialog} theme="secondary">CANCEL</vaadin-button>
         </div>
        
          
         
        `}colorGridPick(e){this.onColorChange({hexString:"",rgb:e}),this.colorPicker.color.set(e)}webColor(){function e(e){let t=Number(e).toString(16);return t.length<2&&(t="0"+t),t}return"#"+e(this.r)+e(this.g)+e(this.b)}webColorChanged(e){if(e&&e.target){const t=e.target.value.match(/^#([0-9a-f]{6})$/i);t&&t.length>0&&(this.r=parseInt(t[1].substr(0,2),16),this.g=parseInt(t[1].substr(2,2),16),this.b=parseInt(t[1].substr(4,2),16),Color.rgbToCmyk(this.r,this.g,this.b,(e=>{this.c=e.c,this.m=e.m,this.y=e.y,this.k=e.k})),this.mode="rgb",this.updateAutoName(),this.colorPicker.color.set({r:this.r,g:this.g,b:this.b}))}}colorModeChanged(e,t){e&&e.target&&e.target.checked&&(this.mode=t,this.updateAutoName())}colorTypeChanged(e,t){e&&e.target&&e.target.checked&&(this.type=t,this.updateAutoName())}autoNameChanged(e){e&&e.target&&(this.autoName=!!e.target.checked,this.autoName&&(this.name=this.getColor().toAutoName("")))}nameChanged(e){if(e&&e.target&&(this.name=scope().colors.getNewSwatchName(e.target.value),this.shadowRoot)){const e=this.shadowRoot.getElementById("nameField");e&&(e.value=this.name)}}rgbValueChange(e,t){var o;const i=null!==(o=null==e?void 0:e.value)&&void 0!==o?o:-1;if(i>=0&&i<=255){switch(t){case"r":this.r=i,this.colorPicker.color.setChannel("rgb","r",this.r);break;case"g":this.g=i,this.colorPicker.color.setChannel("rgb","g",this.g);break;case"b":this.b=i,this.colorPicker.color.setChannel("rgb","b",this.b)}this.mode="rgb",Color.rgbToCmyk(this.r,this.g,this.b,(e=>{this.c=e.c,this.m=e.m,this.y=e.y,this.k=e.k})),Color.rgbToLab(this.r,this.g,this.b,(e=>{this.L=e.L,this.A=e.A,this.B=e.B})),this.updateAutoName()}}labValueChange(e,t){var o;const i=null!==(o=null==e?void 0:e.value)&&void 0!==o?o:-9999;"L"===t&&i>=0&&i<=100?this.L=i:"A"===t&&i>=-128&&i<=127?this.A=i:"B"===t&&i>=-128&&i<=127&&(this.B=i),this.mode="LAB",Color.labToRgb(this.L,this.A,this.B,(e=>{this.r=e.r,this.g=e.g,this.b=e.b,this.colorPicker.color.set(e),Color.rgbToCmyk(this.r,this.g,this.b,(e=>{this.c=e.c,this.m=e.m,this.y=e.y,this.k=e.k}))})),this.updateAutoName()}cmykValueChange(e,t){var o;const i=null!==(o=null==e?void 0:e.value)&&void 0!==o?o:-1;if(i>=0&&i<=255){switch(t){case"c":this.c=i;break;case"m":this.m=i;break;case"y":this.y=i;break;case"k":this.k=i}this.mode="cmyk",this.updateAutoName()}}updateAutoName(){this.autoName&&(this.name=this.getColor().toAutoName(this.orgColor.name))}onColorChange(e){console_log(e.hexString),this.r===e.rgb.r&&this.g===e.rgb.g&&this.b===e.rgb.b||(this.r=e.rgb.r,this.g=e.rgb.g,this.b=e.rgb.b,this.mode="rgb",Color.rgbToCmyk(this.r,this.g,this.b,(e=>{this.c=e.c,this.m=e.m,this.y=e.y,this.k=e.k})),Color.rgbToLab(this.r,this.g,this.b,(e=>{this.L=e.L,this.A=e.A,this.B=e.B})),this.updateAutoName())}}customElements.define("wc-dialog-color",WcDialogColor);var __decorate$c=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n};let WcColorCombo=(()=>{let e=class extends LitElement{constructor(){super(...arguments),this.feature=null,this.selection=null,this.property=null,this.colorRef=null,this.label=null,this.callback=null,this.selector=null,this.origin=null}getColors(){const e=[],t=this.uiColor;t.isSwatch()||e.push({name:"",color:t.toCssColor(100,100,{m:"inactive",s:0,l:0,h:0}),caption:"[Custom Color]"});for(const t of scope().colors.getSwatches())scope().colors.getSwatchByName(t.name)===t&&e.push({name:t.name,caption:t.name,color:t.toCssColor(100,100)});return e}firstUpdated(){var e;const t=null===(e=this.shadowRoot)||void 0===e?void 0:e.getElementById("comboBox");t&&(t.renderer=function(e,t,o){e.firstElementChild||(e.innerHTML='<div style="width: 20px; height: 20px;position: relative;  border: 1px solid black;" class="color-box"</div><div style=" padding-left: 30px;" class="name"></div>');const i=e.querySelector(".name"),r=e.querySelector(".color-box");if(!i||!r)throw new Error("Can't initialize color combo");if(i.textContent=o.item.caption,i.style.fontSize="12px",i.style.whiteSpace="nowrap",""===o.item.name&&(i.style.color="var(--printess-textColor)",i.style.fontStyle="italic"),r.style.backgroundColor=o.item.color,"[None]"===o.item.name){const e=document.createElement("div");e.style.position="absolute",e.style.height="3px",e.style.width="18px",e.style.top="9px",e.style.left="1px",e.style.transformOrigin="50% 50%",e.style.transform="rotate(45deg)",e.style.backgroundColor="red",r.appendChild(e)}if("[null]"===o.item.name){const e=document.createElement("div");e.textContent="?",e.style.fontSize="12px",e.style.color="black",e.style.position="absolute",r.appendChild(e)}})}updated(){var e;const t=null===(e=this.shadowRoot)||void 0===e?void 0:e.getElementById("comboBox");t&&(t.items=this.getColors())}static get styles(){return css`
            :host, :host * {
                box-sizing: border-box;
            }

            :host {

                display: flex;
                flex-direction: column;
            }

            textarea {
                font-size: 14px;;
            }

            .color-box {

                width: 28px;
                height: 28px;
                /*border: 1px solid black;*/
                background-color: rgb(255, 255, 255);
                overflow: hidden;
                position: relative;
                cursor: pointer;
            }

            .my-toggle-button::before {
                content: "\\ea18";
                font-family: "lumo-icons";
                display: block;
                height: 1em;
                line-height: 1;
                font-size: 1.5EM;
                text-align: center;
                color: var(--printess-textColor);
                transition: 0.2s color;
                cursor: pointer;
            }

            .my-edit-button::before {
                content: "\\ea19";
                font-family: "lumo-icons";
                display: block;
                height: 1em;
                line-height: 1;
                font-size: 2em;
                text-align: center;
                color: var(--printess-headlineColor);
                transition: 0.2s color;
                cursor: pointer;
            }

            .red-line {
                position: absolute;
                height: 3px;
                width: 25px;
                top: 12px;
                left: 1px;
                transform-origin: 50% 50%;
                transform: rotate(45deg);
                background-color: red;
            }

            .question-mark:after {
                content: "?";
                position: absolute;
                color: white;
                width: 100%;
                text-align: center;
                font-size: 28px;
            }

            vaadin-combo-box-light {
                width: 100%;
                height: 100%;
                display: block;
            }
            vaadin-combo-box-light  {
              display: block;
            }

            .toggleModifierButton {
              padding: 1px; 
              font-size: 9px; 
              border: 1px solid var(--printess-textColor);
              border-radius: 2px;
            }
            .slider-grid {
              position: relative; 
              font-size: var(--printess-labelSize); 
              display: grid; 
              grid-template-columns: 1fr 1px 30px 10px 30px;  
              height: 18px; 
              align-items: baseline; 
              padding-bottom: 6px; 
            }
            .slider-grid.opacity {
              grid-template-columns: 16px 1fr 1px 30px 10px 30px;  
            }
            .seperator {
              height: 0px;
              opacity: 0.5;
              border-bottom: dashed 1px var(--printess-textColorDisabled);
              margin: 4px;
            }
            .hsl-caption {
              cursor: pointer;
            }
            .hsl-caption:hover {
              color: var(--printess-headlineColor); 
            }
        `}render(){return html`
             
            <vaadin-combo-box-light theme="small"  ?disabled=${this.uiDisabled} id="comboBox"  
                value=${this.uiColorName||""}  
                item-label-path="caption" item-value-path="name"
                @value-changed=${e=>this.uiColorName=e.currentTarget?e.currentTarget.value:null}>
              
                <vaadin-text-field theme="small" style="width: 100%" value="${this.uiColorName||"???"}"  label="${this.uiLabel}"  ?disabled=${this.uiDisabled}>
                   
                     <div slot="prefix" @click=${e=>this.openColorDialog(e)} 
                        class="color-box ${"[null]"===this.uiColor.name?"question-mark":""}" 
                        style="background-color: ${this.uiColor.toCssColor(100,100)}">
                        ${"[None]"===this.uiColor.name?html`
                        <div class="red-line"></div>`:""}
                     </div>
                      
                      ${this.uiColor.isEditableSwatch()&&this.selection?html`
                        <div slot="suffix" part="toggle-button" class="my-edit-button"  
                              @click=${e=>this.openNamedColorDialog(e)} 
                              role="button"  ></div>
                        `:""}
                     
                     <div slot="suffix" part="toggle-button" class="my-toggle-button" id="toggleButton" role="button" aria-label="Toggle" aria-expanded="false"></div>
                </vaadin-text-field>
                          
          </vaadin-combo-box-light>
              
              ${this.uiColor.canHaveTint()?html`
                 <wc-number-box   style="width: 50%; align-self: flex-end"
                    .value="${this.getUiRefNumberProperty("tint")}" .callback=${e=>this.setUiRefproperty("tint",e)} 
                    property="colorTint" ></wc-number-box>
             
                `:""}
              ${this.uiColor.canHaveOpacity()?html`
                <div class="slider-grid opacity" >
              
                  <wc-icon  title="Opacity" icon="opacity" primaryColor="text" style="width: 14px; height: 14px; margin-left: 2px;"></wc-icon>
                  <wc-number-box title="Opacity"   mode="slider"  
                    .value="${this.getUiRefNumberProperty("opacity")}" .callback=${e=>this.setUiRefproperty("opacity",e)} 
                    property="colorOpacity" style="${this.uiColor.canHaveLightnessOrSaturation()?"":"grid-column: 2/5"}" ></wc-number-box>
                    <div></div>
                    <div>${this.getUiRefNumberProperty("opacity")}%</div>

                  ${this.uiColor.canHaveLightnessOrSaturation()?html`
                    <div></div>
                    <button class="toggleModifierButton" @click=${()=>this.toggleModifierMode()}  
                        style="background-color: ${"inactive"!==this.getUiRefModifierMode()?"hlsRelative"===this.getUiRefModifierMode()?"var(--printess-headlineColor)":"blue":"transparent"}; color: ${"inactive"!==this.getUiRefModifierMode()?"white":"var(--printess-textColor)"};">HSL</button>
                  `:""}
                          </div>
              `:""}
              ${this.uiColor.canHaveLightnessOrSaturation()&&"inactive"!==this.getUiRefModifierMode()?html`
                <div class="seperator"></div>
                <div class="slider-grid">
                  <wc-number-box mode="slider"  
                    .value="${this.getUiRefNumberProperty("modifier","h")}" .callback=${e=>this.setUiRefproperty("modifier",e,"h")} 
                    property="colorHue"></wc-number-box>
                  <div></div>
                  <div>${this.getUiRefNumberProperty("modifier","h")}:</div>
                  <div></div>
                  <div class="hsl-caption" title="Reset Hue Value" @click=${()=>this.setUiRefproperty("modifier",0,"h")}>Hue</div>
                </div>
               
                <div class="slider-grid">
                  <wc-number-box  mode="slider"  
                    .value="${this.getUiRefNumberProperty("modifier","s")}" .callback=${e=>this.setUiRefproperty("modifier",e,"s")} 
                    property="colorSaturation" ></wc-number-box>
                  <div></div>
                  <div>${this.getUiRefNumberProperty("modifier","s")}%:</div>
                  <div></div>
                  <div class="hsl-caption"  title="Reset Saturation Value" @click=${()=>this.setUiRefproperty("modifier",0,"s")}>Sat</div>
                </div>

                <div class="slider-grid">
                    <wc-number-box  mode="slider"  
                          .value="${this.getUiRefNumberProperty("modifier","l")}" .callback=${e=>this.setUiRefproperty("modifier",e,"l")} 
                          property="colorLightness" ></wc-number-box>
                    <div></div>
                    <div>${this.getUiRefNumberProperty("modifier","l")}%:</div>
                    <div></div>
                    <div class="hsl-caption"  title="Reset Lightness Value" @click=${()=>this.setUiRefproperty("modifier",0,"l")}>Light</div>
                  </div>
                </div>
              
              `:""}
     
        `}toggleModifierMode(){"inactive"===this.getUiRefModifierMode()?this.setUiRefproperty("modifier","hlsRelative","m"):this.setUiRefproperty("modifier","inactive","m")}get uiColorRef(){return this.selection&&this.feature&&this.property?this.selection.getValueExtended(this.feature,this.property).value:this.colorRef}get uiColor(){const e=this.uiColorRef;return e?e.color:ColorRef.Null_Color()}set uiColor(e){if(null!==e&&!e.equals(this.uiColor)){const t=new ColorRef(e,this.getUiRefNumberProperty("tint")||100,this.getUiRefNumberProperty("opacity")||100,this.getUiRefModifier()||{m:"inactive",s:0,h:0,l:0});this.selection&&this.feature&&this.property?this.selection.setValue(this.feature,this.property,t):(this.colorRef=t,this.callback&&this.callback(t))}}get uiColorName(){const e=this.uiColorRef;return e?e.uiColorName:null}set uiColorName(e){if(e&&"[Custom]"!==e){const t=scope().colors.getSwatchByName(e);if(t){this.uiColor.name!==e&&(this.uiColor=t)}}}getUiRefNumberProperty(e,t){if(this.selection&&this.feature&&this.property){const o=this.selection.getValueExtended(this.feature,this.property);if(o.value){if("modifier"!==e)return o.value[e];if(t)return o.value.modifier[t]}return null}if(this.colorRef){if("modifier"!==e)return this.colorRef[e];if(t&&t)return this.colorRef.modifier[t]}return"modifier"!==e?ColorRef.Some_Color()[e]:t?ColorRef.Some_Color()[e][t]:null}getUiRefModifierMode(){if(this.selection&&this.feature&&this.property){const e=this.selection.getValueExtended(this.feature,this.property);return e.value?e.value.modifier.m:null}return this.colorRef?this.colorRef.modifier.m:"inactive"}getUiRefModifier(){if(this.selection&&this.feature&&this.property){const e=this.selection.getValueExtended(this.feature,this.property);return e.value?e.value.modifier:null}return this.colorRef?this.colorRef.modifier:null}setUiRefproperty(e,t,o){if(null!==t){if("modifier"===e){if(!o)return;if("m"===o&&t===this.getUiRefModifierMode())return;if("m"!==o&&t===this.getUiRefNumberProperty(e,o))return}else if(t===this.getUiRefNumberProperty(e))return;if(this.selection&&this.feature&&this.property)this.selection.setColorRefProperty(this.feature,this.property,e,t,o);else if(this.callback){let i;i=this.colorRef?this.colorRef:this.colorRef=new ColorRef(ColorRef.Some_Color().color);const r="tint"===e&&"number"==typeof t?t:i.tint,s="opacity"===e&&"number"==typeof t?t:i.opacity,n=i.modifier;"modifier"===e&&o&&("m"===o||"number"==typeof t)&&(i.modifier[o]=t),this.colorRef=new ColorRef(i.color,r,s,n),this.callback(this.colorRef)}}}get uiLabel(){let e=this.label||"Color";if(this.property)switch(this.property){case"strokeColor":e="Stroke Color";break;case"fontStrokeColor":case"pathTextStrokeColor":e="Text Stroke Color";break;case"pathTextFontColor":case"fontColor":e="Text Color";break;case"fillColor":e="Shape Color";break;case"bulletColor":e="Bullet Color";break;case"tabLineColor":e="Tab Line Color";break;case"dropColor":case"inGlowColor":case"inShadowColor":case"outGlowColor":case"strokeEffectColor":case"bevelLightColor":e="Color";break;default:assertNever$1(this.property)}return augmentLabel(e,this.extendedValue)}get uiDisabled(){return isInactive(this.extendedValue)}get extendedValue(){return this.selection&&this.property&&this.feature?this.selection.getValueExtended(this.feature,this.property):{value:this.colorRef,selector:this.selector,origin:this.origin}}openColorDialog(e){e.preventDefault(),e.cancelBubble=!0;new WcDialogColor(this.uiColor,!1,(e=>{e&&!this.uiColor.equals(e)&&(this.uiColor=e,window.setTimeout((()=>{this.requestUpdate()}),100))})).showDialog()}openNamedColorDialog(e){e.preventDefault(),e.cancelBubble=!0;new WcDialogColor(this.uiColor,!0,(e=>{e&&!this.uiColor.equals(e)&&(this.uiColor=e)})).showDialog()}};return __decorate$c([property()],e.prototype,"feature",void 0),__decorate$c([property({attribute:!1,type:Object})],e.prototype,"selection",void 0),__decorate$c([property()],e.prototype,"property",void 0),__decorate$c([property({attribute:!1})],e.prototype,"colorRef",void 0),__decorate$c([property()],e.prototype,"label",void 0),__decorate$c([property({attribute:!1})],e.prototype,"callback",void 0),__decorate$c([property()],e.prototype,"selector",void 0),__decorate$c([property()],e.prototype,"origin",void 0),e=__decorate$c([customElement("wc-color-combo")],e),e})(),FormField=(()=>{class e extends NobsBase{constructor(t,o,i,r=null,s=null){if(super(t,o),this.subFields=[],this.uiUpdateValue=null,this.inUse=!1,this.parentBoxId=null,this.docJsName=null,!(t instanceof Nobs||o instanceof e)){let n={};if("object"==typeof o&&(n=o),this.value=void 0!==n.v?n.v:"Test",void 0!==i&&(this.value=i),this.parentBoxId=r,this.docJsName=s,this.id=t||generateDBID(),this.dataType=n.t||"string","text"===this.dataType&&(this.dataType="string"),this.order=n.or||0,this.origin=n.o||"scope",this.group=n.g||"",this.name=n.na||"New Form Field",this.caption=n.ca||this.name,this.visibility=n.vs||"buyer",this.priceRelevant="boolean"==typeof n.pr&&n.pr,this.thumbWidth=n.tw||80,this.thumbHeight=n.th||80,this.imageCss=n.ics||e.defaultImageListCss,this.textBefore=n.tb||"",this.textAfter=n.ta||"",scopeIsInitialised()&&n.allImages)for(const e of n.allImages)scope().images.has(e.id)||create([e]);this.list=n.lst?new Map(n.lst.map((e=>[e.k,{key:e.k,label:e.l||void 0,imageId:e.im||void 0,description:e.ds||void 0}]))):void 0,this.uiControl=n.ui?n.ui:this.list&&this.list.size?"select-list":"textbox",this.order||0===this.order||(alert("Try to create Form Field without order"),this.order=Math.random())}}get __private_render_value_access_only_via_scope_getFormFieldValue(){if(this.uiUpdateValue)return this.uiUpdateValue;if("USER_CREATED"!==this.systemType)throw alert("Forbidden direct read access to a system form-field value: "+this.id),"Forbidden direct read access to a system form-field value: "+this.id;return this.value}static getSystemType(e){return"COLOR_SCHEME"===e?"COLOR_SCHEME":"DOCUMENT_SIZE"===e?"DOCUMENT_SIZE":"MATRIX_PRODUCT"===e?"MATRIX_PRODUCT":e.startsWith("SUB_DOC_")?"SUB_DOC":e.startsWith("LAYER_")?"LAYER":e.startsWith("BOX_STEXT_")?"BOX-SIMPLE-TEXT":e.startsWith("BOX_PTEXT_")?"BOX-PATH-TEXT":"USER_CREATED"}get systemType(){return e.getSystemType(this.id)}get captionLookUp(){const e=new Map;if(this.list)for(const[t,o]of this.list)e.set(t,{label:o.label||void 0,imageId:o.imageId||void 0,description:o.description||void 0});return e}get hasList(){return!("select-list"!==this.uiControl||!this.list||!this.list.size)}get arrayList(){return this.list?Array.from(this.list.values()):[]}canEdit(){return!0}canRemove(){switch(this.systemType){case"USER_CREATED":return!0;default:return!1}}canMove(){return!0}src(){return this.toString()}getCircleCss(){let e="white",t="solid",o="10%",i="white",r=/background-color\s*:\s*([^;]*)/gm.exec(this.imageCss);2===(null==r?void 0:r.length)&&(i=r[1]),r=/border-style\s*:\s*([^;]*)/gm.exec(this.imageCss),2===(null==r?void 0:r.length)&&(t=r[1]),r=/border-color\s*:\s*([^;]*)/gm.exec(this.imageCss),2===(null==r?void 0:r.length)&&(e=r[1]),r=/border-radius\s*:\s*([^;]*)/gm.exec(this.imageCss),2===(null==r?void 0:r.length)&&(o=r[1]);return`background-color: ${i}; border: 1px ${t} ${e}; border-radius: ${o}; width: ${this.thumbWidth/this.thumbHeight*36}px;`}serializeSimple(t=0){var o,i;const r=[];for(const e of null!==(i=null===(o=this.list)||void 0===o?void 0:o.values())&&void 0!==i?i:[])if(e.imageId){const t=scope().images.get(e.imageId);t&&r.push(t.serialize())}return{id:this.id,t:this.dataType,or:t||this.order,o:this.origin,g:this.group,na:this.name,ca:this.caption,ics:this.imageCss===e.defaultImageListCss?"":this.imageCss,v:this.value,vs:this.visibility,pr:this.priceRelevant,tw:this.thumbWidth,th:this.thumbHeight,ui:this.uiControl,tb:this.textBefore,ta:this.textAfter,lst:this.list?Array.from(this.list.values()).map((e=>({k:e.key,l:e.label,im:e.imageId,ds:e.description}))):void 0,allImages:r.length>0?r:void 0}}serialize(e=!1,t=0){return{type:"form",id:e?generateDBID():this.id,scopeId:scope().id,parentId:scope().id,data:this.serializeSimple(t)}}}return e.defaultImageListCss=".image {\n   border-width: 2px;\n   border-style: solid;\n   border-color: gray;\n   border-radius: 0%;\n   background-color: white;\n   background-size: cover; \n   background-position: 50% 50%; \n   background-repeat: no-repeat;\n}\n.image:hover {\n   border-color: var(--printess-maxContrastColor);\n}\n.image.selected, .image.selected:hover{\n   border-color: var(--printess-headlineColor);\n}",e})();var __decorate$d=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n},__awaiter$m=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};let WcFormFieldValue=(()=>{let e=class extends LitElement{constructor(e){super(),this.property=null,this.feature=null,this.showName=!1,e&&(this.formField=e)}static get styles(){return[desktopPropertyStyles,css`
      :host, :host * {
          box-sizing: border-box;
      }
      .form {
        width: 100%;
      }
      .form >  vaadin-text-field {
        width: 100%;
      } 
      .form >  vaadin-select {
        width: 100%;
      }
      .select-container {
        display: flex;
        flex-direction: column-reverse;
      }
      .select-container > select {
        border: none;
        padding: 3px;
        background: var(--printess-inputBackground);
        color: var(--printess-inputColor);
        padding-top: 5px;
        padding-bottom: 5px;
        font-size: var(--printess-inputSize);
      }
      .select-container > .label {
        font-size: var(--printess-labelSize);
        padding-bottom: 3px;
        padding-top: 4px;
      }
      .select-container > select:focus + .label {
        color: var(--printess-headlineColor);
      }
      .imageListWrapper {
        display: block;
        width: 100%;
      }
      .imageList {
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
        margin: -2px;
      }
      .image {
        margin: 2px;
        cursor: pointer;
      }
      .label {
        font-size: var(--lumo-font-size-s);  
        color: var(--lumo-secondary-text-color);
        font-weight: 500;
        margin-left: calc(var(--lumo-border-radius-m) / 4);
        line-height: 2;
        overflow: hidden;
        white-space: nowrap;
        text-overflow: ellipsis;
        position: relative;
        max-width: 100%;
        box-sizing: border-box;
      }
      @media (max-width: ${config.mobileDeviceWidth}px) {
        .label {
          text-align: center;
          width: 90%;
          margin: 0;
          display: block;
        }
        .imageList {
          justify-content: center;
          flex-wrap: nowrap;
          min-width: fit-content;
          margin: 0;
        }
        .imageListWrapper {
          overflow: auto;
        }
        .image {
          margin: 6px;
        }
        .form >  vaadin-text-field {
          margin-top: 15px;
          margin-left: 5%;
          width: 90%;
        } 
        .form >  vaadin-select {
          margin-top: 15px;
          margin-left: 5%;
          width: 90%;
        }

        .mobile-text-input {
          width: 100%;
          height: 40px; 
          font-size: 24px; 

          border: none; 
          background-color: white;
          color: black;
        }
            
      }
  
      `]}render(){var e,t;let o=this.formField;if(!o&&this.feature&&this.selection&&"clickActionFormFieldValue"===this.property){const e=this.selection.getValueExtended(this.feature,"clickActionFormFieldName").value,t=this.selection.getValueExtended(this.feature,"clickActionFormFieldValue").value;if(e){const i=scope().getGlobalFormField(e)||scope().currentDoc.getFormField(e,null);i&&(o=new FormField(generateDBID(),i.serializeSimple(),t||"",""))}}if(o){if("image-list"===o.uiControl)return(null===(e=o.list)||void 0===e?void 0:e.size)?html`
          ${this.listImageCss(o)}
          <div class="form"> 
            <div class="imageListWrapper">
              <label class="label">${o.caption}</label>
              <div class="imageList">
                ${Array.from(o.list.values()).map((e=>html`
                    ${this.getImageListItem(o,e)}
                `))}
                </div>
            </div>
          </div>
        `:html`<div style="color:red">User Interface Image List can't be displayed without list data.</div>`;if("select-list"===o.uiControl){if(!(null===(t=o.list)||void 0===t?void 0:t.size))return html`<div style="color:red">User Interface Select List can't be displayed without list data.</div>`;if(config.isMobile){const e=this.getFormFieldValue();let t=0;const i=o.arrayList;for(let o=0;o<i.length;o++)if(i[o].key===e){t=o;break}return html` 
            <div class="form" style="padding-left: 60px;">       
              <vaadin-list-box  selected="${t}">
                      ${i.map((e=>html`
                  <vaadin-item value="${e.key}" @click=${()=>this.setFormFieldValueString(e.key)}>
                      ${this.getImageTag(o,e)}
                  </vaadin-item>`))}
              </vaadin-list-box>
            </div>`}return html` 
          <div class="form">       
            <vaadin-select theme="small"  value="${this.getFormFieldValue()}" label="${this.getCaption()}"   
              @value-changed=${e=>this.setFormFieldValue(e.target)} >
              <template>
                  <vaadin-list-box>
                          ${o.arrayList.map((e=>html`
                      <vaadin-item value="${e.key}">
                          ${this.getImageTag(o,e)}
                      </vaadin-item>`))}
                  </vaadin-list-box>
              </template>             
          </vaadin-select >
        </div>`}return config.isMobile?html`
            <div class="form" style="padding: 25px 35px;" > 
              <p>${o.caption}</p>
              <input type="text" class="mobile-text-input"  @input=${e=>this.setFormFieldValue(e.target)}
              value="${this.getFormFieldValue()}"   @focus=${()=>this.focus()} />
            </div>`:html`
            <div class="form" > 
              <vaadin-text-field label="${o.caption}" type="text" value="${this.getFormFieldValue()}" 
                  @input=${e=>this.setFormFieldValue(e.target)}></vaadin-text-field>
            </div>`}return html`No Form Field`}getCaption(){if("clickActionFormFieldValue"===this.property)return"Click Action Form Field Value";const e=this.formField;return e?this.showName&&e.caption!==e.name?e.caption+" ... ["+e.name+"]":e.caption:""}getImageListItem(e,t){if(!e)return"";let o=Image$1.anyImage();t.imageId&&(o=scope().images.get(t.imageId||"")||o);const i=config.isMobile?Math.min(e.thumbWidth,70):e.thumbWidth,r=config.isMobile?Math.min(e.thumbHeight,70):e.thumbHeight,s=this.getFormFieldValue()===t.key?"selected":"";return html`
      <div class="image ${s}" title="${t.label||""}" 
        @click=${()=>this.setFormFieldValueString(t.key)}
      style="width: ${i}px; height: ${r}px; background-image: ${o.thumbNailCssUrl()};"></div>
    `}listImageCss(e){return e.imageCss?html`<style>${e.imageCss}</style>`:""}getImageTag(e,t){var o,i,r;if(!e)return"";if(t.imageId){let r=scope().images.get(t.imageId||"");r||(r=Image$1.anyImage());const s=config.isMobile?Math.min(e.thumbWidth,70):e.thumbWidth,n=config.isMobile?Math.min(e.thumbHeight,70):e.thumbHeight;return html`
     <div style="display: grid; grid-template-columns: ${null!==(i=null===(o=this.formField)||void 0===o?void 0:o.thumbWidth)&&void 0!==i?i:70}px 10px 1fr; align-items: center">
        <div style="width: ${s}px; height: ${n}px; ${r.thumbNailCss()}"></div>
        <div></div>
        ${this.getItemCaption(t)}
     </div>`}if("COLOR_SCHEME"===(null===(r=this.formField)||void 0===r?void 0:r.id)){const e=scope().colors.groups.get(t.key);if(e&&e.color)return html`
      <div style="display: grid; grid-template-columns: 20px 10px 1fr; align-items: center">
         <div style="width: 20px; height: 20px;  border: 1px solid black; background-color: ${e.color}"></div>
         <div></div>
         ${this.getItemCaption(t)}
      </div>`}return this.getItemCaption(t)}getItemCaption(e){const t=e.label||e.key;return e.description?html`
    <div style="padding-top: 6px; padding-bottom: 6px;">
      <div style="font-weight: bold;padding-bottom: 3px;">${t}</div>
      <div style="white-space: break-spaces;">${e.description}</div>
    </div>
    `:html`
    <div>${t}</div>
    `}setFormFieldValue(e){e&&null!==e.value&&void 0!==e.value&&(e.value===this.getFormFieldValue()||e.value.startsWith("not found")||this.setFormFieldValueString(e.value))}setFormFieldValueString(e){var t,o;return __awaiter$m(this,void 0,void 0,(function*(){console_log("Set Form Field Value: ff-name:"+(null===(t=this.formField)||void 0===t?void 0:t.name)+"  new value="+e),this.selection&&this.property&&this.feature?(scope().updatesBeforeBlurActiveElementOnNewSelection=1,yield this.selection.setValue(this.feature,this.property,e)):this.formField&&this.getFormFieldValue()!==e&&(scope().updatesBeforeBlurActiveElementOnNewSelection=1,yield scope().setFormFieldValue(this.formField.id,this.formField.parentBoxId,e),config.isMobile&&"textbox"!==this.formField.uiControl&&(scope().selectionPropertiesUi.mobileUiState={state:"form-fields"})),"image-list"===(null===(o=this.formField)||void 0===o?void 0:o.uiControl)&&this.requestUpdate()}))}getFormFieldValue(){var e;return"clickActionFormFieldValue"===this.property?(null===(e=this.selection)||void 0===e?void 0:e.getValueExtended("lock","clickActionFormFieldValue").value)||"":this.formField?scope().getFormFieldValue(this.formField.id,this.formField.parentBoxId):""}};return __decorate$d([property({attribute:!1,type:Object})],e.prototype,"formField",void 0),__decorate$d([property({attribute:!1,type:Object})],e.prototype,"selection",void 0),__decorate$d([property({attribute:!0,type:String})],e.prototype,"property",void 0),__decorate$d([property({attribute:!0,type:String})],e.prototype,"feature",void 0),__decorate$d([property({attribute:!0,type:Boolean})],e.prototype,"showName",void 0),e=__decorate$d([customElement("wc-form-field-value")],e),e})();var __decorate$e=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n};let WcSelectionFormFields=(()=>{let e=class extends LitElement{constructor(){super(...arguments),this.mode="all",this.buyer="off"}static get styles(){return[desktopPropertyStyles,css`
      :host, :host * {
          box-sizing: border-box;
      }
      .form {
        width: 100%;
      }
      .form >  vaadin-text-field {
        width: 100%;
      } 
      .form >  vaadin-select {
        width: 100%;
      }`]}renderFormFieldsUi(){if("docRef"===this.mode){if(!config.isBuyer){const e=this.selection.getSingleSelection();if(e&&e.box.docRef){const t=scope().getDocByName(e.box.docRef.documentName);if(t){let o="";const i=!(this.selection.allows("allowSubDocument","pageName")||!config.isBuyer),r=[];if(t.spreads.size>1&&!i){const t=scope().currentDoc.getDocRefFormField(e.box,null);t&&(r.push(t),o=e.box.docRef.spreadName)}const s=[...r,...t.getAllDocFormFields(e.box.id,config.isBuyer,o)];return html`<div class="form">
             ${s.map((e=>html`
                ${e.hasList?new WcFormFieldValue(e):html`<wc-form-field-value .formField=${e}  ></wc-form-field-value>`}
                ${"SUB_DOC"===e.systemType?html`<div style="margin-bottom: 10px; background-color: var(--printess-headlineColor) " class="seperator"></div>`:""}
            `))} 
            </div>`}}}}else if("on"===this.buyer){if(this.selection.externalProperties.length>0||scope().eddiActive())return html``;const e=[...Array.from(scope().getAllGlobalFormFields(!0).values()).sort(((e,t)=>e.order-t.order)),...Array.from(scope().currentDoc.getAllDocFormFields(null,!0).values())];return e.length?html`

        <div class="form">
            ${e.map((e=>html`
              ${e.hasList?new WcFormFieldValue(e):html`<wc-form-field-value .formField=${e}  ></wc-form-field-value>`}
                
              ${e.subFields.length?html`
                <div style="padding: 5px; margin-top: -8px; margin-bottom: 15px; padding-left: 15px; background-color: var(--printess-maxContrastColorInverse)">
                  ${e.subFields.map((e=>html`
                  ${e.hasList?new WcFormFieldValue(e):html`<wc-form-field-value .formField=${e}  ></wc-form-field-value>`}
                  `))}
                </div>
              `:""} 
              `))} 
            <div class="seperator"></div>
        </div>`:html``}return""}render(){return console_log("++++ START RENDER FORMFIELDS PROPERTIES UI +++"),html`   
          ${this.renderFormFieldsUi()}
      `}};return __decorate$e([property({attribute:!1,type:Object})],e.prototype,"selection",void 0),__decorate$e([property({type:String})],e.prototype,"mode",void 0),__decorate$e([property({type:String})],e.prototype,"buyer",void 0),e=__decorate$e([customElement("wc-selection-form-fields")],e),e})();var __decorate$f=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n},__awaiter$n=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};let WcSelectionDocRef=(()=>{let e=class extends LitElement{static get styles(){return[desktopPropertyStyles,css`
            :host, :host * {
                box-sizing: border-box;
            }
            
            
    .anchors {
        width: 100px;
        height: 100px;
        position:relative;
    }
 
    .doc  {
      width: 120px;
      height: auto;
      margin: 5px;
      cursor: pointer;
    }
    .doc > div {
      display: flex; 
      flex-direction: row;
      width: 100%;
      justify-content: space-between;
      flex-wrap: nowrap;
    }
    .doc img {
      width: 120px;
      height: auto;
      background-color: rgb(215, 232, 235);   
      border: 1px solid black;
    }

    .doc img:hover {
      border: var(--printess-headlineColor) 1px solid;
    }
    
    .doc .caption {
      font-size: 11px;
      text-align: center;
    }

    .doc wc-icon {
      margin-left: 10px;
      width: 14px; 
      height: 14px;
    }
     

    .doc-list {
      display: flex; 
      flex-wrap: wrap; 
      flex-direction: column;
    }

    .doc-list > div.bkr {
      width: 400px;
      height: 400px;
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center center;
      background-color: transparent;
      border: 1px solid black;
      
      cursor: pointer;
      overflow: hidden;
       
    }
    
 

    .button-border {
        border: 1px solid var(--printess-headlineColor);
    }

    .button-grid {
        display: flex;
        justify-content: space-between;
    }
     
    `]}get placementSelector(){const e=this.selection.getValueExtended("docRef","documentPlacement").selector;return e?" ["+e+"]":""}getThumbnail(e){return __awaiter$n(this,void 0,void 0,(function*(){try{if(config.isDebugViewBkr){const t=yield hb.Printess.renderDocumentImagesAsDataUrl(scope().serializeAll(!0),e.name,400,600,!1);return html`${t.map((t=>html`<div class="bkr" style="background-image: url('${t}'); background-color: ${e.docBackgroundColor.toCssColor()}"></div>`))}`}const t=yield e.getThumbnailUrls(e.firstSpread().id);return t?html`<div class="doc" >
          <img src="${t[0]}" title="${e.name}" @click="${()=>DocRef.createOrAssignDoc(e.name)}" style="background-color: ${e.docBackgroundColor.toCssColor()}" />
            <div >
              <div class="caption">${e.name}</div>
              <wc-icon icon="folder-open-solid"   primaryColor="headline" @click="${()=>scope().selectDocAsync(e,!0)}"></wc-icon>
          </div>
        </div>`:html`<div class="doc" >
          <img src="${Image$1.anyImage().url}" title="${e.name}" @click="${()=>DocRef.createOrAssignDoc(e.name)}" style="background-color: ${e.docBackgroundColor.toCssColor()}" />
          <div >
              <div class="caption">${e.name}</div>
              <wc-icon icon="folder-open-solid"   primaryColor="headline" @click="${()=>scope().selectDocAsync(e,!0)}"></wc-icon>
          </div>
        </div>`}catch(e){return console.error("SubDoc-Thumbnail generation failed: See console line above. ["+e+"]"),html`<div>No Image</div>`}}))}renderNewDocRef(){return config.isDebugViewBkr?html`
      <div class="doc-list">
        ${Array.from(scope().docs.values()).filter((e=>e.isPrimary||e.isPreview)).map((e=>html`
          ${until(this.getThumbnail(e),html`<div>loading ${e.name} ...</div>`)}
        `))}
      </div>`:html`
    <div class="doc-list">
      ${Array.from(scope().docs.values()).filter((e=>e!==scope().currentDoc)).map((e=>html`
        ${until(this.getThumbnail(e),html`<div>loading ${e.name} ...</div>`)}
      `))}
    </div>`}renderDocPlacementUi(){return this.selection.allowsImagePlacement()?html`
            <p class="section-head">Sub-Document Placement${this.placementSelector}:</p>
            <div class="button-grid">  
                <wc-fat-button caption="flex" icon="file-invoice" 
                    .callback=${()=>scope().selection.fitOrFillDocRef("adjust")} 
                    ?selected=${"adjust"===this.placement}
                    ?disabled=${""!==this.placementSelector}></wc-fat-button>
                <wc-fat-button caption="fit" icon="fit-image" 
                    .callback=${()=>scope().selection.fitOrFillDocRef("fit")} 
                    ?selected=${"fit"===this.placement}
                    ?disabled=${""!==this.placementSelector}></wc-fat-button>
                <wc-fat-button caption="fill" icon="fill-image" 
                    .callback=${()=>scope().selection.fitOrFillDocRef("fill")} 
                    ?selected=${"fill"===this.placement}
                    ?disabled=${""!==this.placementSelector}></wc-fat-button>
                <wc-fat-button  caption="crop" icon="crop" 
                    .callback=${()=>{scope().selection.fitOrFillDocRef("crop"),scope().showCropEditor()}} 
                    ?selected=${"crop"===this.placement} 
                    ?disabled=${""!==this.placementSelector}></wc-fat-button>
            </div>`:""}render(){return!this.selection||scope().filterPropertiesBySelectedFeature&&"doc"!==this.selectedTool?html``:config.isBuyer?this.selection.hasFeature("docRef")?html`   
            <wc-selection-form-fields mode="docRef" .selection=${this.selection}  ></wc-selection-form-fields>`:html``:this.selection.hasFeature("docRef")?"none"!==this.selection.crop?html` 
            <vaadin-button  theme="small"  class="${"crop"===this.placement?"button-border":""}"  @click="${()=>scope().closeCropEditor()}" theme="secondary">
                <wc-icon icon="close-square" style="width: 16px; height: 16px;" slot="prefix"></wc-icon>
                Close Crop
            </vaadin-button>`:html`   
    <wc-combo   property="documentName" .value=${this.selection.getValueExtended("docRef","documentName").value} .callback=${e=>DocRef.createOrAssignDoc(e)} ></wc-combo> 
    <div class="seperator" ></div>
   <!-- <wc-select feature="docRef" property="documentPlacement" .selection=${this.selection}></wc-select>-->

    ${this.renderDocPlacementUi()}

    ${this.placement&&"crop"===this.placement?html`
                <vaadin-button style="margin-top: 10px;"  theme="small"  @click="${()=>scope().showCropEditor()}" theme="secondary">
                <wc-icon icon="crop" style="width: 16px; height: 16px" slot="prefix"></wc-icon>
                Crop Sub Document
                </vaadin-button>`:""}

    ${"adjust"!==this.placement&&"crop"!==this.placement?html`
      <vaadin-button style="margin-top: 10px;"  theme="small"  @click="${()=>scope().selection.fitFrameToDocRef()}" theme="secondary">
        <wc-icon icon="image" style="width: 16px; height: 16px" slot="prefix"></wc-icon>
        Fit Frame to Sub-Document
      </vaadin-button>
      <div style="margin-top: 5px;" class="two-cols">
        <p class="section-head">Focal Point: ${this.anchorSelector}</p>
        <div class="anchor-grid"    >

            <div class="anchor-box"> 
                <div style=" border: 1px solid var(--printess-headlineColor); height: 100%; "> </div>
                </div>
                <div style="grid-area: m_lt;" class="checker ${this.getAnchorTriState(0,0)}" @click=${()=>this.anchorClick(0,0)} ></div>
                <div style="grid-area: m_lm;" class="checker ${this.getAnchorTriState(0,.5)}" @click=${()=>this.anchorClick(0,.5)} ></div>
                <div style="grid-area: m_lb;" class="checker ${this.getAnchorTriState(0,1)}" @click=${()=>this.anchorClick(0,1)} ></div>

                <div style="grid-area: m_ct;" class="checker ${this.getAnchorTriState(.5,0)}" @click=${()=>this.anchorClick(.5,0)} ></div>
                <div style="grid-area: m_cm;" class="checker ${this.getAnchorTriState(.5,.5)}" @click=${()=>this.anchorClick(.5,.5)} ></div>
                <div style="grid-area: m_cb;" class="checker ${this.getAnchorTriState(.5,1)}" @click=${()=>this.anchorClick(.5,1)} ></div>

                <div style="grid-area: m_rt;" class="checker ${this.getAnchorTriState(1,0)}" @click=${()=>this.anchorClick(1,0)} ></div>
                <div style="grid-area: m_rm;" class="checker ${this.getAnchorTriState(1,.5)}" @click=${()=>this.anchorClick(1,.5)} ></div>
                <div style="grid-area: m_rb;" class="checker ${this.getAnchorTriState(1,1)}" @click=${()=>this.anchorClick(1,1)} ></div>

            </div> 
        </div>               
      </div>
     
    `:""}
    <div class="seperator"></div>
    <wc-checker theme="small" feature="docRef" property="hideNonPrintableLayers" .selection=${this.selection}></wc-checker>
    <wc-checker theme="small" feature="docRef" property="hasFormField" .selection=${this.selection}></wc-checker>

    <div class="admin-properties-devider" >Document: ${this.selection.getValueExtended("docRef","documentName").value||""}</div>
    <wc-selection-form-fields mode="docRef" .selection=${this.selection}  ></wc-selection-form-fields>
   
`:this.renderNewDocRef()}serializeAsSubDocument(){const e=this.selection.getSingleSelection();if(e){const t=DocRef.serializeAsSubDocument(e.box);t&&(console_log(JSON.stringify(t)),prompt("Serialized Sub Document",JSON.stringify(t)))}}get anchorSelector(){let e="";const t=this.selection.getValueExtended("docRef","verticalFocalPointDocument").selector,o=this.selection.getValueExtended("docRef","horizontalFocalPointDocument").selector;return t&&o&&t!==o?e=t+","+o:t?e=t:o&&(e=o),e&&(e=" ["+e+"]"),e}get placement(){return this.selection.getValueExtended("docRef","documentPlacement").value}getAnchorTriState(e,t){let o=!1,i=!1;if(null===this.placement)return eTriState.mixed;this.selection.getValueExtended("docRef","verticalFocalPointDocument").value===t&&(o=!0);return this.selection.getValueExtended("docRef","horizontalFocalPointDocument").value===e&&(i=!0),o&&i?eTriState.on:eTriState.off}anchorClick(e,t){this.selection.setMultipleValues([{feature:"docRef",property:"horizontalFocalPointDocument",value:e},{feature:"docRef",property:"verticalFocalPointDocument",value:t}])}ungroup(){const e=this.selection.getSingleSelection();if(e&&e.box.docRef){const t=e.box.boxGeometry.toPixel(e.spread.width(),e.spread.height()),o=scope().getDocByName(e.box.docRef.documentName);if(o){let i=o.spreads.values().next().value;const r=e.box.docRef.spreadName;if(r)for(const e of o.spreads.values())e.name==r&&(i=e);const s=this.getClipboardData(o,i);s&&scope().selection.setClipboardData(s,!1,t.left,t.top)}}}getClipboardData(e,t){const o=Array.from(t.boxes.values()).sort(((e,t)=>e.order-t.order)).map((o=>{const i=o.boxGeometry,r=i.toPixel(t.width(),t.height(),!0),s=BoxGeometry.getRotationPositionX(i),n=BoxGeometry.getRotationPositionY(i);if(0!==s||0!==n){const e=changeAnchor(r,i.rotation,s,n,0,0,!0);r.top=e.top,r.left=e.left,r.width=e.width,r.height=e.height}const a=(new Nobs).setProperty(i,"left",new Length(r.left,"px")).setProperty(i,"top",new Length(r.top,"px")).setProperty(i,"width",new Length(r.width,"px")).setProperty(i,"height",new Length(r.height,"px")).setProperty(i,"moverAnchor","lt").setProperty(i,"anchorLeft",!0).setProperty(i,"anchorTop",!0).setProperty(i,"anchorRight",!1).setProperty(i,"anchorBottom",!1),l=new BoxGeometry(a,i);return o.serialize(t.id,e.id,!0,!0,l)}));return o.length>0?{context:"Selection",objects:o,scopeId:scope().id}:null}};return __decorate$f([property({attribute:!1,type:Object})],e.prototype,"selection",void 0),__decorate$f([property()],e.prototype,"selectedTool",void 0),e=__decorate$f([customElement("wc-selection-doc-ref")],e),e})();var __decorate$g=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n},__awaiter$o=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};let WcSelectionDoc=(()=>{var e;let t=e=class extends LitElement{constructor(){super(...arguments),this.doc=null}static get styles(){return[desktopPropertyStyles,css`
            :host, :host * {
                box-sizing: border-box;
            }`]}pageSizeCaption(e){return"<span>"+e.name+"</span> <span style='font-size: 8px;'>("+e.width+"x "+e.height+")</span>"}pageSizeDimensions(e){const t=new Length(e.width,e.unit).toPixel_1Axis(100),o=new Length(e.height,e.unit).toPixel_1Axis(100);return{width:t,height:o,orientation:t>o?"landscape":"portrait"}}pageSizes(){return config.pageSizes().map((e=>this.pageSizeCaption(e)))}selectedPageSize(){if(this.doc)for(const e of config.pageSizes()){const t=this.pageSizeDimensions(e);if(t.height===this.doc.pageWidth&&t.width===this.doc.pageHeight||t.width===this.doc.pageWidth&&t.height===this.doc.pageHeight)return e}return null}selectedPageSizeCaption(){const e=this.selectedPageSize();return e?this.pageSizeCaption(e):null}setPageSizeByCaption(e){if(this.doc)for(const t of config.pageSizes())e===this.pageSizeCaption(t)&&this.setPageSize(t)}setPageSize(t){const o=this.pageSizeDimensions(t);if(this.doc&&o&&this.doc){const i=new Nobs;if(this.getOrientation()!==o.orientation){const e=o.height;o.height=o.width,o.width=e}i.setProperty(this.doc,"pageWidth",o.width),i.setProperty(this.doc,"pageHeight",o.height),i.setProperty(this.doc,"unit",t.unit),i.replaceCollection(this.doc.spreads,e.getNewSpreads(o.width,o.height));const r=new Doc(i,this.doc);update([this.doc.serialize(scope().id)],[r.serialize(scope().id)])}}getOrientation(){return this.doc&&this.doc.pageWidth>this.doc.pageHeight?"landscape":"portrait"}setOrientation(t){if(this.doc&&t&&t!==this.getOrientation()){const t=new Nobs;t.setProperty(this.doc,"pageWidth",this.doc.pageHeight),t.setProperty(this.doc,"pageHeight",this.doc.pageWidth),t.replaceCollection(this.doc.spreads,e.getNewSpreads(this.doc.pageHeight,this.doc.pageWidth));const o=new Doc(t,this.doc);update([this.doc.serialize(scope().id)],[o.serialize(scope().id)])}}render(){return!config.isBuyer&&this.doc?html`   
       <wc-select .list=${this.pageSizes()} .value="${this.selectedPageSizeCaption()}" label="Page Size"
        .callback=${e=>this.setPageSizeByCaption(e)} origin="None" selector="" > </wc-select>
       
        
        <div class="two-cols">
          <wc-length-box  
          .callback=${e=>this.setDocValue("pageWidth",e.toPixel(100,100))}
          .value=${new Length(1,this.doc.unit).fromPixel(this.doc.pageWidth,100,100,void 0,2)} 
          label="Page Width"  selector="" origin="None" ></wc-length-box>

          <wc-length-box  
          .callback=${e=>this.setDocValue("pageHeight",e.toPixel(100,100))}
          .value=${new Length(1,this.doc.unit).fromPixel(this.doc.pageHeight,100,100,void 0,2)} 
          label="Page Height" selector="" origin="None" ></wc-length-box>
        </div>
        <div class="two-cols">
          <wc-select ?icons="${!0}" property="orientation" .value="${this.getOrientation()}"  origin="None" selector=""
          .callback=${e=>this.setOrientation(e)}></wc-select>
          
          <wc-select .list=${["mm","cm","inch","px"]} .value="${this.doc.unit}" label="Unit" origin="None" selector=""
          .callback=${e=>this.setDocValue("unit",e)}></wc-select>
        </div>

        <div class="seperator" ></div> 
        <wc-color-combo .callback=${e=>this.setDocValue("docBackgroundColorSerialized",e.serialize())}
        .colorRef=${this.doc.docBackgroundColor}
         origin="None"  selector="" label="Background Color"></wc-color-combo> 

      
        <div class="seperator" ></div>     
        
        <div>Paste Board:</div>
        <div class="two-cols">
          <wc-length-box  
          .callback=${e=>this.setDocValue("pasteBoardLeft",e.toPixel(100,100))}
          .value=${new Length(1,this.doc.unit).fromPixel(this.doc.pasteBoardLeft,100,100,void 0,2)} 
          label="Left"  selector="" origin="None" ></wc-length-box>

          <wc-length-box  
          .callback=${e=>this.setDocValue("pasteBoardRight",e.toPixel(100,100))}
          .value=${new Length(1,this.doc.unit).fromPixel(this.doc.pasteBoardRight,100,100,void 0,2)} 
          label="Right" selector="" origin="None" ></wc-length-box>
       
       
          <wc-length-box  
          .callback=${e=>this.setDocValue("pasteBoardTop",e.toPixel(100,100))}
          .value=${new Length(1,this.doc.unit).fromPixel(this.doc.pasteBoardTop,100,100,void 0,2)} 
          label="Top"  selector="" origin="None" ></wc-length-box>

          <wc-length-box  
          .callback=${e=>this.setDocValue("pasteBoardBottom",e.toPixel(100,100))}
          .value=${new Length(1,this.doc.unit).fromPixel(this.doc.pasteBoardBottom,100,100,void 0,2)} 
          label="Bottom" selector="" origin="None" ></wc-length-box>

          <wc-length-box  
          .callback=${e=>this.setDocValue("verticalSpaceBetweenPasteboards",e.toPixel(100,100))}
          .value=${new Length(1,this.doc.unit).fromPixel(this.doc.verticalSpaceBetweenPasteboards,100,100,void 0,2)} 
          label="Space Between" selector="" origin="None" ></wc-length-box>

      
            <wc-number-box mode="both"  origin="None"  label="Show Frames" property="opacity"  .value="${Math.round(100*(1-this.doc.pasteBoardOpacity))}" 
            .callback=${e=>this.setDocValue("pasteBoardOpacity",(100-e)/100)}> </wc-number-box>

          </div>    
          <wc-checker theme="small" label="Page Zoom to Paste Board" .value="${this.doc.zoomToPasteBoard}"  .callback=${e=>this.setDocValue("zoomToPasteBoard",e)}></wc-checker>
          
          <wc-checker theme="small" label="Buyer Side Page Border" .value="${this.doc.hasPageBorder}"  .callback=${e=>this.setDocValue("hasPageBorder",e)}></wc-checker>
          
          <div style="display: grid; grid-template-columns: 1fr 30px; align-items: center;">
            <div style="padding-left:0; color: var(--printess-textColor); font-size: var(--printess-inputSize);">Paste Board Color</div>
            <wc-color-grid mode="popup" origin="None" selector="" .colorHexValue=${this.doc.pasteBoardColor} 
                .callback=${e=>this.setDocValue("pasteBoardColor",e.toSimpleRgbColor())} ></wc-color-grid>
         </div>
         
         
         

        <div class="seperator" ></div>     
        <div>Base Line Grid:</div>
        <div class="two-cols">
          <wc-length-box  
          .callback=${e=>this.setDocValue("baselineTop",e)}
          .value=${this.doc.baselineTop} 
          label="First Line"  selector="" origin="None" ></wc-length-box>
          <wc-length-box  
          .callback=${e=>this.setDocValue("baselineHeight",e)}
          .value=${this.doc.baselineHeight} 
          label="Line Height"  selector="" origin="None" ></wc-length-box>

        </div>

        ${this.doc.isLayoutSnippet||this.doc.isGroupSnippet?html` 
        <div class="buyer-properties-devider">Snippet Export</div>
          <wc-tag-list .tags=${this.doc.snippetExportTags} addtags="allowed" caption="Tags:"
            @tagsChanged=${e=>this.setDocValue("snippetExportTags",e.detail)}></wc-tag-list>
          
          <vaadin-text-field theme="small" style="width: 100%" 
            label="Snippet Title" 
            .value=${this.doc.snippetTitle}
            @change=${e=>this.setDocValue("snippetTitle",e.currentTarget?e.currentTarget.value:"")}  
        ></vaadin-text-field>
        `:""}


        <div class="seperator" ></div>  
        <div style="display: grid; grid-template-columns: 1fr 30px; align-items: center;">
            <div style="padding-left:0; color: var(--printess-textColor); font-size: var(--printess-inputSize);">Buyer Overlay Color</div>
            <wc-color-grid .transparency=${!0} mode="popup" origin="None" selector="" .colorHexValue=${this.doc.buyerOverlayColor} 
                .callback=${e=>this.setDocValue("buyerOverlayColor",e.toSimpleRgbColor())} ></wc-color-grid>
         </div>

         <div class="seperator" ></div>     
        
        <wc-checker theme="big" label="Show Bleed" .value="${this.doc.showBleed}"  .callback=${e=>this.setDocValue("showBleed",e)}></wc-checker> 
        ${this.doc.showBleed?html`<div class="two-cols">
        
          <wc-length-box  
          .callback=${e=>this.setDocValue("bleedInside",e.toPixel(100,100))}
          .value=${new Length(1,this.doc.unit).fromPixel(this.doc.bleedInside,100,100,void 0,2)} 
          label="Inside"  selector="" origin="None" ></wc-length-box>

          <wc-length-box  
          .callback=${e=>this.setDocValue("bleedOutside",e.toPixel(100,100))}
          .value=${new Length(1,this.doc.unit).fromPixel(this.doc.bleedOutside,100,100,void 0,2)} 
          label="Outside" selector="" origin="None" ></wc-length-box>
       
          <wc-length-box  
          .callback=${e=>this.setDocValue("bleedTop",e.toPixel(100,100))}
          .value=${new Length(1,this.doc.unit).fromPixel(this.doc.bleedTop,100,100,void 0,2)} 
          label="Top"  selector="" origin="None" ></wc-length-box>

          <wc-length-box  
          .callback=${e=>this.setDocValue("bleedBottom",e.toPixel(100,100))}
          .value=${new Length(1,this.doc.unit).fromPixel(this.doc.bleedBottom,100,100,void 0,2)} 
          label="Bottom" selector="" origin="None" ></wc-length-box>

         
        </div> 
        <wc-checker theme="small" label="Show Save Zone" .value="${this.doc.showSaveZone}"  .callback=${e=>this.setDocValue("showSaveZone",e)}></wc-checker>
         `:""}
        
        <div class="seperator" ></div>  

        <wc-checker theme="big" label="Show Margins" .value="${this.doc.showMargins}"  .callback=${e=>this.setDocValue("showMargins",e)}></wc-checker> 
        ${this.doc.showMargins?html`<div class="two-cols">
        
          <wc-length-box  
          .callback=${e=>this.setDocValue("marginInside",e.toPixel(100,100))}
          .value=${new Length(1,this.doc.unit).fromPixel(this.doc.marginInside,100,100,void 0,2)} 
          label="Inside"  selector="" origin="None" ></wc-length-box>

          <wc-length-box  
          .callback=${e=>this.setDocValue("marginOutside",e.toPixel(100,100))}
          .value=${new Length(1,this.doc.unit).fromPixel(this.doc.marginOutside,100,100,void 0,2)} 
          label="Outside" selector="" origin="None" ></wc-length-box>
       
          <wc-length-box  
          .callback=${e=>this.setDocValue("marginTop",e.toPixel(100,100))}
          .value=${new Length(1,this.doc.unit).fromPixel(this.doc.marginTop,100,100,void 0,2)} 
          label="Top"  selector="" origin="None" ></wc-length-box>

          <wc-length-box  
          .callback=${e=>this.setDocValue("marginBottom",e.toPixel(100,100))}
          .value=${new Length(1,this.doc.unit).fromPixel(this.doc.marginBottom,100,100,void 0,2)} 
          label="Bottom" selector="" origin="None" ></wc-length-box>
 
        </div> `:""}

        <div class="seperator" ></div>  
        <button @click=${()=>this.scale(2)}>Scale up</button>
        <button @click=${()=>this.scale(.5)}>Scale down</button>
        <button @click=${()=>{const e=prompt("Enter scale value","2.0");if(e){const t=parseFloat(e);this.scale(t)}}}>Scale</button>
`:html``}scale(e){const t=scope().serializeAll(),o=t.documents.filter((e=>e.id===scope().currentDoc.id))[0];o.data.pw*=e,o.data.ph*=e;const i=new Set;for(const e of o.data.sps)if(e.boxes)for(const t of e.boxes)t.data.story&&i.add(t.data.story.sId);for(const o of i){const i=t.stories.filter((e=>e.id===o));i&&scaleAllLengthValues(i,e)}if(t.style&&t.style.data.txt){const o=scaleUnitsInString(t.style.data.txt,e);t.style.data.txt=o}scaleAllLengthValues(o,e),loadScope(t)}static setDocSize(e,t){return __awaiter$o(this,void 0,void 0,(function*(){const o=scope().currentDoc,i=new Nobs,r=new Length(e,o.unit).toPixel(100,100),s=new Length(t,o.unit).toPixel(100,100);i.setProperty(o,"pageWidth",r),i.setProperty(o,"pageHeight",s),i.replaceCollection(o.spreads,this.getNewSpreads(r,s));const n=new Doc(i,o);yield update([o.serialize(scope().id)],[n.serialize(scope().id)]),window.setTimeout((()=>{scope().docUi.centerSpreadInView()}),500)}))}static getDocSize(e){const t=scope().currentDoc,o=new Length(1,t.unit).fromPixel(t.pageWidth,100,100,void 0,2).value,i=new Length(1,t.unit).fromPixel(t.pageHeight,100,100,void 0,2).value;return e?o+t.unit+" x "+i+t.unit:o+"x"+i}setDocValue(t,o){return __awaiter$o(this,void 0,void 0,(function*(){if(this.doc){const i=new Nobs;if(i.setProperty(this.doc,t,o),"pageWidth"===t||"pageHeight"===t&&"number"==typeof o){const r="pageWidth"===t?o:this.doc.pageWidth,s="pageHeight"===t?o:this.doc.pageHeight;i.replaceCollection(this.doc.spreads,e.getNewSpreads(r,s))}"baselineHeight"!==t&&"baselineTop"!==t||(scope().baselineGridChanged=!0),"zoomToPasteBoard"===t&&window.setTimeout((()=>{scope().docUi.centerSpreadInView()}),500);const r=new Doc(i,this.doc);yield update([this.doc.serialize(scope().id)],[r.serialize(scope().id)]),"pasteBoardOpacity"!==t&&"pasteBoardColor"!==t||scope().setStageColor(r)}}))}static getNewSpreads(e,t){const o=new Map;for(const i of scope().currentDoc.spreads.values()){const r=[];for(let o=0;o<i.pages.length;o++)r.push(new BoxGeometry(o*e,0,e,t));const s=new Spread((new Nobs).replaceCollection(i.pages,r),i);o.set(i.id,s)}return o}};return __decorate$g([property({attribute:!1,type:Object})],t.prototype,"doc",void 0),t=e=__decorate$g([customElement("wc-selection-doc")],t),t})();
/**
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at
http://polymer.github.io/LICENSE.txt The complete set of authors may be found at
http://polymer.github.io/AUTHORS.txt The complete set of contributors may be
found at http://polymer.github.io/CONTRIBUTORS.txt Code distributed by Google as
part of the polymer project is also subject to an additional IP rights grant
found at http://polymer.github.io/PATENTS.txt
*/const template=html$1`
<custom-style>
  <style is="custom-style">
    [hidden] {
      display: none !important;
    }
  </style>
</custom-style>
<custom-style>
  <style is="custom-style">
    html {

      --layout: {
        display: -ms-flexbox;
        display: -webkit-flex;
        display: flex;
      };

      --layout-inline: {
        display: -ms-inline-flexbox;
        display: -webkit-inline-flex;
        display: inline-flex;
      };

      --layout-horizontal: {
        @apply --layout;

        -ms-flex-direction: row;
        -webkit-flex-direction: row;
        flex-direction: row;
      };

      --layout-horizontal-reverse: {
        @apply --layout;

        -ms-flex-direction: row-reverse;
        -webkit-flex-direction: row-reverse;
        flex-direction: row-reverse;
      };

      --layout-vertical: {
        @apply --layout;

        -ms-flex-direction: column;
        -webkit-flex-direction: column;
        flex-direction: column;
      };

      --layout-vertical-reverse: {
        @apply --layout;

        -ms-flex-direction: column-reverse;
        -webkit-flex-direction: column-reverse;
        flex-direction: column-reverse;
      };

      --layout-wrap: {
        -ms-flex-wrap: wrap;
        -webkit-flex-wrap: wrap;
        flex-wrap: wrap;
      };

      --layout-wrap-reverse: {
        -ms-flex-wrap: wrap-reverse;
        -webkit-flex-wrap: wrap-reverse;
        flex-wrap: wrap-reverse;
      };

      --layout-flex-auto: {
        -ms-flex: 1 1 auto;
        -webkit-flex: 1 1 auto;
        flex: 1 1 auto;
      };

      --layout-flex-none: {
        -ms-flex: none;
        -webkit-flex: none;
        flex: none;
      };

      --layout-flex: {
        -ms-flex: 1 1 0.000000001px;
        -webkit-flex: 1;
        flex: 1;
        -webkit-flex-basis: 0.000000001px;
        flex-basis: 0.000000001px;
      };

      --layout-flex-2: {
        -ms-flex: 2;
        -webkit-flex: 2;
        flex: 2;
      };

      --layout-flex-3: {
        -ms-flex: 3;
        -webkit-flex: 3;
        flex: 3;
      };

      --layout-flex-4: {
        -ms-flex: 4;
        -webkit-flex: 4;
        flex: 4;
      };

      --layout-flex-5: {
        -ms-flex: 5;
        -webkit-flex: 5;
        flex: 5;
      };

      --layout-flex-6: {
        -ms-flex: 6;
        -webkit-flex: 6;
        flex: 6;
      };

      --layout-flex-7: {
        -ms-flex: 7;
        -webkit-flex: 7;
        flex: 7;
      };

      --layout-flex-8: {
        -ms-flex: 8;
        -webkit-flex: 8;
        flex: 8;
      };

      --layout-flex-9: {
        -ms-flex: 9;
        -webkit-flex: 9;
        flex: 9;
      };

      --layout-flex-10: {
        -ms-flex: 10;
        -webkit-flex: 10;
        flex: 10;
      };

      --layout-flex-11: {
        -ms-flex: 11;
        -webkit-flex: 11;
        flex: 11;
      };

      --layout-flex-12: {
        -ms-flex: 12;
        -webkit-flex: 12;
        flex: 12;
      };

      /* alignment in cross axis */

      --layout-start: {
        -ms-flex-align: start;
        -webkit-align-items: flex-start;
        align-items: flex-start;
      };

      --layout-center: {
        -ms-flex-align: center;
        -webkit-align-items: center;
        align-items: center;
      };

      --layout-end: {
        -ms-flex-align: end;
        -webkit-align-items: flex-end;
        align-items: flex-end;
      };

      --layout-baseline: {
        -ms-flex-align: baseline;
        -webkit-align-items: baseline;
        align-items: baseline;
      };

      /* alignment in main axis */

      --layout-start-justified: {
        -ms-flex-pack: start;
        -webkit-justify-content: flex-start;
        justify-content: flex-start;
      };

      --layout-center-justified: {
        -ms-flex-pack: center;
        -webkit-justify-content: center;
        justify-content: center;
      };

      --layout-end-justified: {
        -ms-flex-pack: end;
        -webkit-justify-content: flex-end;
        justify-content: flex-end;
      };

      --layout-around-justified: {
        -ms-flex-pack: distribute;
        -webkit-justify-content: space-around;
        justify-content: space-around;
      };

      --layout-justified: {
        -ms-flex-pack: justify;
        -webkit-justify-content: space-between;
        justify-content: space-between;
      };

      --layout-center-center: {
        @apply --layout-center;
        @apply --layout-center-justified;
      };

      /* self alignment */

      --layout-self-start: {
        -ms-align-self: flex-start;
        -webkit-align-self: flex-start;
        align-self: flex-start;
      };

      --layout-self-center: {
        -ms-align-self: center;
        -webkit-align-self: center;
        align-self: center;
      };

      --layout-self-end: {
        -ms-align-self: flex-end;
        -webkit-align-self: flex-end;
        align-self: flex-end;
      };

      --layout-self-stretch: {
        -ms-align-self: stretch;
        -webkit-align-self: stretch;
        align-self: stretch;
      };

      --layout-self-baseline: {
        -ms-align-self: baseline;
        -webkit-align-self: baseline;
        align-self: baseline;
      };

      /* multi-line alignment in main axis */

      --layout-start-aligned: {
        -ms-flex-line-pack: start;  /* IE10 */
        -ms-align-content: flex-start;
        -webkit-align-content: flex-start;
        align-content: flex-start;
      };

      --layout-end-aligned: {
        -ms-flex-line-pack: end;  /* IE10 */
        -ms-align-content: flex-end;
        -webkit-align-content: flex-end;
        align-content: flex-end;
      };

      --layout-center-aligned: {
        -ms-flex-line-pack: center;  /* IE10 */
        -ms-align-content: center;
        -webkit-align-content: center;
        align-content: center;
      };

      --layout-between-aligned: {
        -ms-flex-line-pack: justify;  /* IE10 */
        -ms-align-content: space-between;
        -webkit-align-content: space-between;
        align-content: space-between;
      };

      --layout-around-aligned: {
        -ms-flex-line-pack: distribute;  /* IE10 */
        -ms-align-content: space-around;
        -webkit-align-content: space-around;
        align-content: space-around;
      };

      /*******************************
                Other Layout
      *******************************/

      --layout-block: {
        display: block;
      };

      --layout-invisible: {
        visibility: hidden !important;
      };

      --layout-relative: {
        position: relative;
      };

      --layout-fit: {
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
      };

      --layout-scroll: {
        -webkit-overflow-scrolling: touch;
        overflow: auto;
      };

      --layout-fullbleed: {
        margin: 0;
        height: 100vh;
      };

      /* fixed position */

      --layout-fixed-top: {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
      };

      --layout-fixed-right: {
        position: fixed;
        top: 0;
        right: 0;
        bottom: 0;
      };

      --layout-fixed-bottom: {
        position: fixed;
        right: 0;
        bottom: 0;
        left: 0;
      };

      --layout-fixed-left: {
        position: fixed;
        top: 0;
        bottom: 0;
        left: 0;
      };

    }
  </style>
</custom-style>`;template.setAttribute("style","display: none;"),document.head.appendChild(template.content);var style=document.createElement("style");style.textContent="[hidden] { display: none !important; }",document.head.appendChild(style);
/**
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at
http://polymer.github.io/LICENSE.txt The complete set of authors may be found at
http://polymer.github.io/AUTHORS.txt The complete set of contributors may be
found at http://polymer.github.io/CONTRIBUTORS.txt Code distributed by Google as
part of the polymer project is also subject to an additional IP rights grant
found at http://polymer.github.io/PATENTS.txt
*/
class IronMeta{constructor(e){IronMeta[" "](e),this.type=e&&e.type||"default",this.key=e&&e.key,e&&"value"in e&&(this.value=e.value)}get value(){var e=this.type,t=this.key;if(e&&t)return IronMeta.types[e]&&IronMeta.types[e][t]}set value(e){var t=this.type,o=this.key;t&&o&&(t=IronMeta.types[t]=IronMeta.types[t]||{},null==e?delete t[o]:t[o]=e)}get list(){if(this.type){var e=IronMeta.types[this.type];return e?Object.keys(e).map((function(e){return metaDatas[this.type][e]}),this):[]}}byKey(e){return this.key=e,this.value}}IronMeta[" "]=function(){},IronMeta.types={};var metaDatas=IronMeta.types;Polymer({is:"iron-meta",properties:{type:{type:String,value:"default"},key:{type:String},value:{type:String,notify:!0},self:{type:Boolean,observer:"_selfChanged"},__meta:{type:Boolean,computed:"__computeMeta(type, key, value)"}},hostAttributes:{hidden:!0},__computeMeta:function(e,t,o){var i=new IronMeta({type:e,key:t});return void 0!==o&&o!==i.value?i.value=o:this.value!==i.value&&(this.value=i.value),i},get list(){return this.__meta&&this.__meta.list},_selfChanged:function(e){e&&(this.value=this)},byKey:function(e){return new IronMeta({type:this.type,key:e}).value}}),
/**
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at
http://polymer.github.io/LICENSE.txt The complete set of authors may be found at
http://polymer.github.io/AUTHORS.txt The complete set of contributors may be
found at http://polymer.github.io/CONTRIBUTORS.txt Code distributed by Google as
part of the polymer project is also subject to an additional IP rights grant
found at http://polymer.github.io/PATENTS.txt
*/
Polymer({_template:html$1`
    <style>
      :host {
        @apply --layout-inline;
        @apply --layout-center-center;
        position: relative;

        vertical-align: middle;

        fill: var(--iron-icon-fill-color, currentcolor);
        stroke: var(--iron-icon-stroke-color, none);

        width: var(--iron-icon-width, 24px);
        height: var(--iron-icon-height, 24px);
        @apply --iron-icon;
      }

      :host([hidden]) {
        display: none;
      }
    </style>
`,is:"iron-icon",properties:{icon:{type:String},theme:{type:String},src:{type:String},_meta:{value:Base.create("iron-meta",{type:"iconset"})}},observers:["_updateIcon(_meta, isAttached)","_updateIcon(theme, isAttached)","_srcChanged(src, isAttached)","_iconChanged(icon, isAttached)"],_DEFAULT_ICONSET:"icons",_iconChanged:function(e){var t=(e||"").split(":");this._iconName=t.pop(),this._iconsetName=t.pop()||this._DEFAULT_ICONSET,this._updateIcon()},_srcChanged:function(e){this._updateIcon()},_usesIconset:function(){return this.icon||!this.src},_updateIcon:function(){this._usesIconset()?(this._img&&this._img.parentNode&&dom(this.root).removeChild(this._img),""===this._iconName?this._iconset&&this._iconset.removeIcon(this):this._iconsetName&&this._meta&&(this._iconset=this._meta.byKey(this._iconsetName),this._iconset?(this._iconset.applyIcon(this,this._iconName,this.theme),this.unlisten(window,"iron-iconset-added","_updateIcon")):this.listen(window,"iron-iconset-added","_updateIcon"))):(this._iconset&&this._iconset.removeIcon(this),this._img||(this._img=document.createElement("img"),this._img.style.width="100%",this._img.style.height="100%",this._img.draggable=!1),this._img.src=this.src,dom(this.root).appendChild(this._img))}});var __decorate$h=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n};let WcFatButton=(()=>{let e=class extends LitElement{constructor(){super(...arguments),this.icon=null,this.caption="",this.selected=!1,this.disabled=!1,this.callback=null}static get styles(){return css`
            :host, :host * {
                box-sizing: border-box;
            }

            :host {
                display: flex;
                flex-direction: column;
                width: 54px;
            }

            .fat-button {
                display: grid;
                grid-template-rows: 38px 0px 12px;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                padding: 2px;
                padding-bottom: 5px;
                border: 1px solid var(--printess-fatButtonForeground);
                border-radius: 5px;
            }

            .fat-button:hover {
                background-color: var(--printess-fatButtonBackgroundHover)
            }
           
            .fat-button.selected {
                border: 1px solid var(--printess-fatButtonForegroundSelected);
                background-color: var(--printess-fatButtonBackgroundSelected);
            }

            .fat-button.disabled {
               opacity: 0.3;
               cursor: default;
               pointer-events: none;
            }

            .fat-button > wc-icon {
                align-self: center;
                justify-self: center;
            }

            .fat-caption {
                grid-row: 3;
                color: var(--printess-fatButtonForeground);
                white-space: nowrap;
                font-size: 12px;
                text-align: center;
                
            }
        `}render(){return html`
<div class="fat-button ${this.selected?"selected":""} ${this.disabled?"disabled":""}"  @click=${()=>{var e;return null===(e=this.callback)||void 0===e?void 0:e.call(this)}}  >
  ${this.icon?html`<wc-icon primaryColor="${this.selected?"headline":"text"}" style="width: 26px; height: 26px;" icon="${this.icon}"></wc-icon>`:""}
    <div style="color: ${this.selected?"var(--printess-headlineColor)":"var(--printess-textColor)"}" class="fat-caption">${this.caption}</div>
</div>
`}};return __decorate$h([property()],e.prototype,"icon",void 0),__decorate$h([property()],e.prototype,"caption",void 0),__decorate$h([property({type:Boolean})],e.prototype,"selected",void 0),__decorate$h([property({type:Boolean})],e.prototype,"disabled",void 0),__decorate$h([property({attribute:!1})],e.prototype,"callback",void 0),e=__decorate$h([customElement("wc-fat-button")],e),e})();var __awaiter$p=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};class WcSelectImageDialog extends LitElement{constructor(e,t){super(),this.uploadProgress=-1,this.target="image",this.externalPropertyId=void 0,this.backdrop=new WcBackdrop,this.target=e,this.externalPropertyId=t}showDialog(e){this.callback=e,document.body.appendChild(this.backdrop),document.body.appendChild(this)}closeDialog(){this.backdrop.parentElement&&(document.body.removeChild(this.backdrop),document.body.removeChild(this))}static get properties(){return{uploadProgress:{type:Number}}}static get styles(){return[dialogStyles,css`

          :host {
            max-width: 600px;
            width: 90%; 
          }
          .image-upload .progress {
              
              border: 1px solid black; 
              height: 22px;
          }
          .image-upload-progress > div {
              background: var(--printess-headlineColor); 
              height: 100%; 
              color: var(--printess-headlineColorInverse);
              text-align: center;
              padding: 2px;
          }

          .imageListContainer {
            height: 350px;
            overflow: auto; 
           
          }

          .imageList {
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
             
        }
        .imageItem {
            display: grid;
            grid-template-columns: 56px;
            grid-template-rows: 56px 16px;
            margin: 2px;
            cursor: pointer;
        }
       
        .imageBox {
            width: 100%;  
            height: 100%;
          
            background-size: cover;
            border: 1px solid  var(--printess-textColor);
            border-radius: 3px;
            background-color: #bbb;
         } 
         .imageBox.selected {
            border: 2px solid  var(--printess-headlineColor);
        }
         .imageName {
             font-size: 9px;
             text-overflow: ellipsis;
             width: 100%;
             overflow:hidden;
             text-overflow: ellipsis;
             white-space: nowrap;
             text-align: center;
         }   
        `]}get allImages(){return this.externalPropertyId?getImagesAsImage(this.externalPropertyId):Array.from(scope().images.values())}render(){return html`
          <div class="content">
          
            <h1 style="padding-bottom: 10px;">Select Image</h1>
        
            <label class="imageItem">
              <input style="display: none;" @change="${e=>this.inputChange(e)}"  
                  type="file" multiple accept="image/svg+xml,image/png,image/jpg,image/jpeg,image/tiff"/>
              <wc-icon class="imageBox" primaryColor="medium" style=" background: white;" icon="plus" ></wc-icon>       
            </label>
            
       
            <div class="imageListContainer">
              <div class="imageList">
                ${this.allImages.map((e=>html`
                    <div class="imageItem" title="${e.name}" @click=${()=>this.imageClick(e)}  >
                        <div class="imageBox" style="background-image: ${e.thumbNailCssUrl()};" ></div>
                        <div class="imageName" >${e.name}</div>
                    </div>
                `))}
                
            </div>
           </div>

              ${this.uploadProgress>=0&&this.uploadProgress<=100?html`
                <div class="image-upload-progress" >
                  <div style="width: ${100*this.uploadProgress}%">${Math.round(1e4*this.uploadProgress)/100+"%"}</div>
                </div>
              `:""} 
              
          </div>
        </div>
        
         <div class="footer" >
            <vaadin-button style="grid-column: 3" @click=${this.closeDialog} theme="secondary">CLOSE</vaadin-button>
         </div>
        
          
         
        `}imageClick(e){"callback"===this.target?this.callback&&this.callback(e):ImageRef.createOrAssignImage(e,this.target),this.closeDialog()}inputChange(e){var t;return __awaiter$p(this,void 0,void 0,(function*(){const o=e.target;if(o&&(null===(t=o.files)||void 0===t?void 0:t.length)){o.disabled=!0;const e=(yield ImageRef.upload(o.files,(e=>this.changeProgress(e)),!1))[0];e&&this.callback&&this.callback(e),this.closeDialog()}}))}changeProgress(e){this.uploadProgress=e}}customElements.define("wc-select-image-dialog",WcSelectImageDialog);var __decorate$i=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n};let WcSelectionImageRef=(()=>{let e=class extends LitElement{constructor(){super(...arguments),this.uploadProgress=-1}static get styles(){return[desktopPropertyStyles,css`
    :host, :host * {
        box-sizing: border-box;
    }

    :host {
      --printess-anchor-size: 10px;
      display: block;
    }
    
    vaadin-button {
        width: 100%;
        margin-bottom: 10px;
    }
    
    .anchors {
        width: 100px;
        height: 100px;
        position:relative;
    }
    .checker {
        border: var(--printess-headlineColor) 1px solid;
      border-radius: 10%;
      transition: border-color;
      transition-duration: 0.7s;
      cursor: pointer;
    }
    .checker:hover {
         background-color: white;
      
    }
    
    .on {
        background-color: var(--printess-headlineColor);
    }
    .off {
        background-color: #eee;
    }
    
    .checker.on:hover {
        background-color: var(--printess-headlineColorHover);
    }
    
    .mixed {
        background-color: #ddd;
    }
    .null {
        background-color: yellow;
    }
     
    

  
  .anchor-grid {
      display: grid;
          
      align-items: stretch;
      align-content: stretch;
      grid-gap: 8px 8px;
      grid-template-rows:   var(--printess-anchor-size)  var(--printess-anchor-size)  var(--printess-anchor-size) ;
      grid-template-columns:    var(--printess-anchor-size)  var(--printess-anchor-size)  var(--printess-anchor-size) ;
                  
      grid-template-areas:  "m_lt m_ct m_rt"
                            "m_lm m_cm m_rm"
                            "m_lb m_cb m_rb";

      margin-top: 10px;                        
  }
  
  .anchor-box {
  
      grid-column-start: m_lt; 
      grid-column-end: m_rb;
      grid-row-start: m_lt; 
      grid-row-end: m_rb;
      padding: calc(var(--printess-anchor-size) / 2);
  }
  .anchor-box > div {
      border: 1px solid var(--printess-headlineColor); 
      height: 100%;
  }
  

    .button-border {
        border: 1px solid var(--printess-headlineColor);
    }
    .button-grid {
        display: flex;
        justify-content: space-between;
    }

    td {
        text-overflow: ellipsis;
        white-space: nowrap;
    }
    .imageList {
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
        margin: -2px;
        max-height: 178px;
        overflow-y: auto;
     
    }
    .imageItem {
        display: grid;
        grid-template-columns: 56px;
        grid-template-rows: 56px 16px;
        margin: 2px;
        cursor: pointer;
    }
   
    .imageItemPur {
        display: grid;
        grid-template-columns: 56px;
        grid-template-rows: 56px;
        margin: 2px;
        cursor: pointer;
    }
   
    .imageBox {
        width: 100%;  
        height: 100%;
      
        background-size: cover;
        border: 1px solid  var(--printess-textColor);
        border-radius: 3px;
        background-color: #bbb;
     } 
     .imageBox.selected {
        border: 2px solid  var(--printess-headlineColor);
    }
     .imageName {
         font-size: 9px;
         text-overflow: ellipsis;
         width: 100%;
         overflow:hidden;
         text-overflow: ellipsis;
         white-space: nowrap;
         text-align: center;
     }   

     .image-upload .progress {
        width: 250px; 
        border: 1px solid black; 
        height: 22px;
     }
     .image-upload-progress > div {
        background: var(--printess-headlineColor); 
        height: 100%; 
        color: var(--printess-headlineColorInverse);
        text-align: center;
        padding: 2px;
     }
     table {
      width: 100%;
      font-size: var(--printess-labelSize);
     }
        `]}renderImageUploadUi(){return-1===this.uploadProgress&&this.selection.hasImageUploadButton()?html`   
      <label class="imageItemPur" @click=${()=>this.openImageDialog()}>
        <wc-icon class="imageBox"  style="width: 56px; height: 56px; background-color: white;" icon="plus" ></wc-icon>      
      </label>
    `:""}renderImageUploadProgressUi(){return this.uploadProgress>=0&&this.uploadProgress<=100?html`  
      <div class="image-upload-progress" >
        <div style="width: ${100*this.uploadProgress}%">${Math.round(1e4*this.uploadProgress)/100+"%"}</div>
      </div>`:""}renderNewImageUi(){return this.selection.allows("allowAdd","image")?html`
            <div class="buyer-properties-devider">Create Image</div>
            ${config.isBuyer?"":html`<p>To create an image, draw a new frame on the page or click on an image below:</p>`}

            <div class="imageList" style="max-height: fit-content;">
                ${this.renderImageUploadUi()}
                ${Array.from(scope().images.values()).map((e=>html`
                    <div class="imageItemPur" title="${e.name}" @click=${()=>ImageRef.createOrAssignImage(e)}  >
                        <div class="imageBox" style="background-image: ${e.thumbNailCssUrl()};" ></div>
                
                    </div>
                `))}
                
               
              
            </div>
            ${this.renderImageUploadProgressUi()}
           `:html``}renderLevelUi(){const e=this.selection.allows("allowImageFilters","brightness"),t=this.selection.allows("allowImageFilters","contrast"),o=this.selection.allows("allowImageFilters","vivid"),i=this.selection.allows("allowImageFilters","sepia"),r=this.selection.allows("allowImageFilters","hueRotate");return html`
     <div class="seperator"></div>
     ${e?html`<wc-number-box feature="effect" property="brightness" .selection=${this.selection}></wc-number-box>`:""}
     ${t?html`<wc-number-box feature="effect" property="contrast" .selection=${this.selection}></wc-number-box>`:""}
     ${o?html`<wc-number-box feature="effect" property="saturate" .selection=${this.selection}></wc-number-box>`:""}
     ${i?html`<wc-number-box feature="effect" property="sepia" .selection=${this.selection}></wc-number-box>`:""}
     ${r?html`<wc-number-box feature="effect" property="hueRotate" .selection=${this.selection}></wc-number-box>`:""}
     `}renderImageInfoUi(){return this.selection.allows("allowImage","info")?html`<table>
            ${this.imageSelector?html`  
            <tr  >
                <td>Style:</td>
                <td>${this.imageSelector}</td>
            </tr>
            `:""}
            <tr title="${this.imageName}">
                <td>Name:</td>
                <td>${this.imageName}</td>
            </tr>
            <tr>
                <td>Size:</td>
                <td>W:${this.imageWidth} / H:${this.imageHeight}</td>
            </tr>
            <tr>
                <td>Type:</td>
                <td>${this.imageType}</td>
            </tr>
            ${this.imageSelector?html` 
                <tr title="${this.imageUrl}" >
                    <td>Url:</td>
                    <td  >${this.imageUrl}</td>
                </tr>`:html`
                <tr title="${this.imageUrl}" >
                    <td>Url:</td>
                    <td style="text-decoration: underline; cursor: pointer;"  @click=${()=>this.imageUrlClick()} >${this.imageUrl}</td>
                </tr>
            `}
            ${this.scaledImages.map(((e,t)=>html`
                <tr title="${this.imageUrl}" >
                    <td>scale [${t}]</td>
                    <td > <a href="${e.url}" target="_blank" style="text-decoration: underline; cursor: pointer;" >${"W:"+e.width+"px/H:"+e.height+"px"}</a></td>
                </tr>
            `))}
            </table>
            <div class="seperator"></div>`:""}renderImagePlacementUi(){return this.selection.allowsImagePlacement()?html`
            <p class="section-head">Image Placement${this.placementSelector}:</p>
            <div class="button-grid">  
                <wc-fat-button caption="fit" icon="fit-image" 
                    .callback=${()=>scope().selection.fitOrFillImage("fit")} 
                    ?selected=${"fit"===this.placement}
                    ?disabled=${""!==this.placementSelector}></wc-fat-button>
                <wc-fat-button caption="fill" icon="fill-image" 
                    .callback=${()=>scope().selection.fitOrFillImage("fill")} 
                    ?selected=${"fill"===this.placement}
                    ?disabled=${""!==this.placementSelector}></wc-fat-button>
                <wc-fat-button  caption="crop" icon="crop" 
                    .callback=${()=>{scope().selection.fitOrFillImage("crop"),scope().showCropEditor()}} 
                    ?selected=${"crop"===this.placement} 
                    ?disabled=${!this.selection.canCrop||""!==this.placementSelector}></wc-fat-button>
            </div>
            
            
    
            ${this.placement&&"crop"===this.placement?html`
                <vaadin-button style="margin-top: 10px;"  theme="small"  @click="${()=>scope().showCropEditor()}" theme="secondary">
                <wc-icon icon="crop" style="width: 16px; height: 16px" slot="prefix"></wc-icon>
                Crop Image
                </vaadin-button>`:html`
                <vaadin-button style="margin-top: 10px;"  theme="small"  @click="${()=>scope().selection.fitFrameToImage()}" theme="secondary">
                <wc-icon icon="image" style="width: 16px; height: 16px" slot="prefix"></wc-icon>
                Fit Frame to Image
                </vaadin-button>
                <div class="two-cols">
                  <p class="section-head">Focal Point: ${this.anchorSelector}</p>
                  <div class="anchor-grid"    >

                      <div class="anchor-box"> 
                          <div style=" border: 1px solid var(--printess-headlineColor); height: 100%; "> </div>
                          </div>
                          <div style="grid-area: m_lt;" class="checker ${this.getAnchorTriState("lt")}" @click=${()=>this.anchorClick("lt")} ></div>
                          <div style="grid-area: m_lm;" class="checker ${this.getAnchorTriState("lm")}" @click=${()=>this.anchorClick("lm")} ></div>
                          <div style="grid-area: m_lb;" class="checker ${this.getAnchorTriState("lb")}" @click=${()=>this.anchorClick("lb")} ></div>

                          <div style="grid-area: m_ct;" class="checker ${this.getAnchorTriState("ct")}" @click=${()=>this.anchorClick("ct")} ></div>
                          <div style="grid-area: m_cm;" class="checker ${this.getAnchorTriState("cm")}" @click=${()=>this.anchorClick("cm")} ></div>
                          <div style="grid-area: m_cb;" class="checker ${this.getAnchorTriState("cb")}" @click=${()=>this.anchorClick("cb")} ></div>

                          <div style="grid-area: m_rt;" class="checker ${this.getAnchorTriState("rt")}" @click=${()=>this.anchorClick("rt")} ></div>
                          <div style="grid-area: m_rm;" class="checker ${this.getAnchorTriState("rm")}" @click=${()=>this.anchorClick("rm")} ></div>
                          <div style="grid-area: m_rb;" class="checker ${this.getAnchorTriState("rb")}" @click=${()=>this.anchorClick("rb")} ></div>

                      </div> 
                  </div>               
                </div>
                <div class="seperator"></div>

            `}
            
            `:""}renderImageMaskUi(){return this.selection.allows("allowImage","mask")?html`
            <p class="section-head">Image Mask${this.maskSelector}:</p>

            <div class="button-grid" style="margin-bottom: 20px;">  
                <wc-fat-button  caption="None" icon="image" 
                    .callback=${()=>this.setMask("none")} 
                    ?selected=${"none"===this.mask()}
                    ?disabled=${!this.canMask("none")}></wc-fat-button>
                <wc-fat-button  caption="Shape" icon="shapes" 
                    .callback=${()=>this.setMask("pathGeometry")} 
                    ?selected=${"pathGeometry"===this.mask()} 
                    ?disabled=${!this.canMask("pathGeometry")}></wc-fat-button>
                <wc-fat-button  caption="Text" icon="text" 
                    .callback=${()=>this.setMask("simpleText")} 
                    ?selected=${"simpleText"===this.mask()} 
                    ?disabled=${!this.canMask("simpleText")}></wc-fat-button>
            </div> 
            <div class="seperator"></div>
        `:""}renderImageChangeUi(){return this.selection.allows("allowImage","content")?html`
            <p class="section-head">Change Image:</p>
            <div class="imageList">
            ${this.renderImageUploadUi()}
              ${this.selection.getImageList().map((e=>html`
                  <div class="imageItemPur"  @click=${()=>ImageRef.createOrAssignImage(e)}  >
                      <div class="imageBox ${this.isSelectedImage(e)?"selected":""}" style="background-image: ${e.thumbNailCssUrl()};" ></div>
                     
                  </div>
              `))}
               
              </div>
              ${this.renderImageUploadProgressUi()}
              
        `:""}openImageDialog(){new WcSelectImageDialog("image").showDialog()}renderSectionHead(){return config.isBuyer&&this.selection.allowsAny("allowImage")?html`
              <div class="buyer-properties-devider">Image</div>
         `:""}render(){return!this.selection||scope().filterPropertiesBySelectedFeature&&"image"!==this.selectedTool?html``:this.selection.hasFeature("imageRef")?"none"!==this.selection.crop?html` 
<vaadin-button  theme="small"  class="${"crop"===this.placement?"button-border":""}"  @click="${()=>scope().closeCropEditor()}" theme="secondary">
    <wc-icon icon="close-square" style="width: 16px; height: 16px;" slot="prefix"></wc-icon>
    Close Crop
</vaadin-button>`:html`   
                    ${this.renderSectionHead()}
                    ${this.renderImageInfoUi()}
                    ${this.renderImagePlacementUi()}
                    ${this.renderImageMaskUi()}
                    ${this.renderImageChangeUi()}
                    ${this.renderLevelUi()}

                    
 

`:this.renderNewImageUi()}isSelectedImage(e){if(this.selection){if(this.selection.getValueExtended("imageRef","image").value===e)return!0}return!1}mask(){return this.selection.getValueExtended("imageRef","imageMasking").value||"none"}get maskSelector(){const e=this.selection.getValueExtended("imageRef","imageMasking").selector;return e?" ["+e+"]":""}get placementSelector(){const e=this.selection.getValueExtended("imageRef","imagePlacement").selector;return e?" ["+e+"]":""}get placement(){return this.selection.getValueExtended("imageRef","imagePlacement").value}setMask(e){e!==this.mask()&&this.selection.setMask(e)}canMask(e){if(this.selection&&1===this.selection.boxes.size){if(this.maskSelector)return!1;if(!this.selection.boxes.values().next().value.box.storyRef&&"simpleText"===e)return!0;if("pathGeometry"===e)return!0;if("none"===e)return!0}return!1}getVerticalAnchor(e){let t=.5;return e.endsWith("t")&&(t=0),e.endsWith("b")&&(t=1),t}getHorizontalAnchor(e){let t=.5;return e.startsWith("l")&&(t=0),e.startsWith("r")&&(t=1),t}get anchorSelector(){let e="";const t=this.selection.getValueExtended("imageRef","verticalFocalPoint").selector,o=this.selection.getValueExtended("imageRef","horizontalFocalPoint").selector;return t&&o&&t!==o?e=t+","+o:t?e=t:o&&(e=o),e&&(e=" ["+e+"]"),e}getAnchorTriState(e){let t=!1,o=!1;if(null===this.placement)return eTriState.mixed;this.selection.getValueExtended("imageRef","verticalFocalPoint").value===this.getVerticalAnchor(e)&&(t=!0);return this.selection.getValueExtended("imageRef","horizontalFocalPoint").value===this.getHorizontalAnchor(e)&&(o=!0),t&&o?eTriState.on:eTriState.off}anchorClick(e){const t=this.getHorizontalAnchor(e),o=this.getVerticalAnchor(e);this.selection.fitOrFillImage(void 0,t,o)}get imageType(){const e=this.selection.getValueExtended("imageRef","image").value;return e?e.type:"???"}get imageWidth(){const e=this.selection.getValueExtended("imageRef","image").value;return e?e.width+"px":"???"}get imageHeight(){const e=this.selection.getValueExtended("imageRef","image").value;return e?e.height+"px":"???"}get imageName(){const e=this.selection.getValueExtended("imageRef","image").value;return e?e.name:"???"}get imageUrl(){const e=this.selection.getValueExtended("imageRef","image").value;return e?e.url:"???"}get scaledImages(){const e=this.selection.getValueExtended("imageRef","image").value;return e?e.scales:[]}get imageSelector(){return this.selection.getValueExtended("imageRef","image").selector}imageUrlClick(){const e=this.imageUrl,t=prompt("Enter External Image Url:",e);if(t&&t!==e){const e=scope().images_getOrCreate(t);e?this.selection.assignImage(e):alert("Could not assign image, no valid id, name or url.")}}};return __decorate$i([property({attribute:!1,type:Object})],e.prototype,"selection",void 0),__decorate$i([property()],e.prototype,"selectedTool",void 0),__decorate$i([property({type:Number})],e.prototype,"uploadProgress",void 0),e=__decorate$i([customElement("wc-selection-image-ref")],e),e})();var __awaiter$q=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};class WcUploadFontsDialog extends LitElement{constructor(e="image"){super(),this.uploadProgress=-1,this.mode=e,this.backdrop=new WcBackdrop}showDialog(e){this.callback=e,document.body.appendChild(this.backdrop),document.body.appendChild(this)}closeDialog(){this.backdrop.parentElement&&(document.body.removeChild(this.backdrop),document.body.removeChild(this))}static get properties(){return{mode:{type:String},uploadProgress:{type:Number}}}static get styles(){return[dialogStyles,css`
          .image-upload .progress {
              width: 250px; 
              border: 1px solid black; 
              height: 22px;
          }
          .image-upload-progress > div {
              background: var(--printess-headlineColor); 
              height: 100%; 
              color: var(--printess-headlineColorInverse);
              text-align: center;
              padding: 2px;
          }
        `]}render(){return html`
          <div class="content">
          
            <h1 style="padding-bottom: 10px;">Upload (${this.mode})</h1>
        
            <input 
               accept="${"font"===this.mode?".ttf,font/ttf,.otf,font/otf":"image/svg+xml,image/png,image/jpg,image/jpeg,image/tiff"}" 
               @change="${e=>this.inputChange(e)}" 
               type="file" multiple />
       
          
              ${this.uploadProgress>=0&&this.uploadProgress<=1?html`
                <div class="image-upload-progress" >
                  <div style="width: ${100*this.uploadProgress}%">${Math.round(1e4*this.uploadProgress)/100+"%"}</div>
                </div>
              `:""} 
              
          </div>
        </div>
        
         <div class="footer" >
            <vaadin-button style="grid-column: 3" @click=${this.closeDialog} theme="secondary">CLOSE</vaadin-button>
         </div>
        
          
         
        `}upload(e,t){return __awaiter$q(this,void 0,void 0,(function*(){if(e&&e.length>0){const o=new TheUploader(uploadProvider(),t);try{const i=yield o.uploadFonts(e),r=[];t(-1);for(const e of i){const t=Array.from(scope().fonts.values()).sort(((e,t)=>t.order-e.order)),o=t.length?t[0].order:1e-4;r.push(new Font("",e.url,e.family,e.face,getOrder(o,1),e.ascender,e.descender,e.leading,e.lineHeight,e.spaceWidth,e.svgUrl))}this.callback&&this.callback(r)}catch(e){alert(e),t(-1)}}}))}inputChange(e){var t;const o=e.target;o&&(null===(t=o.files)||void 0===t?void 0:t.length)&&(o.disabled=!0,this.upload(o.files,(e=>this.changeProgress(e))))}changeProgress(e){this.uploadProgress=e,1===e&&this.closeDialog()}}customElements.define("wc-upload-fonts-dialog",WcUploadFontsDialog);var __decorate$j=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n},__awaiter$r=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};let WcFontCombo=(()=>{let e=class extends LitElement{constructor(){super(...arguments),this.feature=null,this.selection=null,this.property=null,this.fontName=null,this.label=null,this.callback=null,this.selector=null,this.origin=null,this.reloadFontList=!1}firstUpdated(){this.fillFontList()}fillFontList(){if(this.shadowRoot){const e=this.shadowRoot.getElementById("font");e&&(e.items=this.getFontList().map((e=>e.name)),e.renderer=function(e,t,o){o&&o.item&&(e.innerHTML='<span style="font-family: '+o.item+'" >'+o.item+"</span>")})}}getFontList(){var e;const t=Array.from(scope().fonts.values()).sort(((e,t)=>e.order-t.order));if(config.isBuyer||config.isMobile){const o=null===(e=this.selection)||void 0===e?void 0:e.getValueExtended("lock","allowFontGroups").value;return o?t.filter((e=>e.group&&o.indexOf(e.group)>=0)):[]}return t}static get styles(){return css`
            :host, :host * {
                box-sizing: border-box;
            }

            :host {
                display: flex;
                flex-direction: column;
                position: relative;
            }
            a {
                font-size: 8pt;
                color: var(--printess-headlineColor);
                text-align: right;
                position: absolute;
                right: 0;
                top: 0;
                cursor: pointer;
            }
        `}renderFontUploadUi(){return!config.isMobile&&!config.isBuyer||scope().currentDoc.lock.allows("allowAdd","fonts")?html`  
          <a @click=${()=>this.uploadFont()}>Upload</a>
        `:""}render(){const e=this.getFontList();return this.reloadFontList?(this.reloadFontList=!1,html`loading ...`):html`
     <vaadin-select theme="small" id="select" .value=${this.uiFontName}  label="${this.uiLabel}"  ?disabled=${this.uiDisabled}
        @value-changed=${e=>this.uiFontName=e.currentTarget?e.currentTarget.value:null} >
        <template>
            <vaadin-list-box>
                    ${e.map((e=>html`
                <vaadin-item value="${e.name}">
                    <span style="font-family: ${e.cssName}; font-size: var(--printess-textSize); white-space: nowrap;" >${e.name}</span>     
                </vaadin-item>`))}
            </vaadin-list-box>
        </template>             
    </vaadin-select >
    
    ${this.renderFontUploadUi()}            
        `}get uiLabel(){return augmentLabel("Font",this.extendedValue)}get uiDisabled(){return isInactive(this.extendedValue)}get extendedValue(){return this.selection&&this.property&&this.feature?this.selection.getValueExtended(this.feature,this.property):{value:this.fontName,selector:this.selector,origin:this.origin}}get uiFontName(){if(this.selection&&this.property&&this.feature){const e=this.selection.getValueExtended(this.feature,this.property).value;return e?e.font.name:null}return this.fontName}set uiFontName(e){if(null!==e&&e!==this.uiFontName)if(this.selection&&this.property&&this.feature)this.selection.setValue(this.feature,this.property,new FontRef(e));else if(this.callback){const t=scope().fonts_getByName(e);t&&this.callback(t)}}uploadFont(){return __awaiter$r(this,void 0,void 0,(function*(){new WcUploadFontsDialog("font").showDialog((e=>__awaiter$r(this,void 0,void 0,(function*(){const t=scope().resourcesFontsUi.getWcList();if(t){yield t.createItems(e);const o=document.querySelector("vaadin-select-overlay");o&&o.parentElement&&o.parentElement.removeChild(o),this.reloadFontList=!0,this.requestUpdate(),window.setTimeout((()=>{this.requestUpdate()}),200)}}))))}))}};return __decorate$j([property({type:String})],e.prototype,"feature",void 0),__decorate$j([property({attribute:!1,type:Object})],e.prototype,"selection",void 0),__decorate$j([property()],e.prototype,"property",void 0),__decorate$j([property()],e.prototype,"fontName",void 0),__decorate$j([property()],e.prototype,"label",void 0),__decorate$j([property({attribute:!1})],e.prototype,"callback",void 0),__decorate$j([property()],e.prototype,"selector",void 0),__decorate$j([property()],e.prototype,"origin",void 0),e=__decorate$j([customElement("wc-font-combo")],e),e})();class WcDialogAddTextStyle extends LitElement{constructor(){super(),this.backdrop=new WcBackdrop}showDialog(e,t){this.callback=t,document.body.appendChild(this.backdrop),document.body.appendChild(this),this.which=e,this.requestUpdate(),this.updateComplete.then((()=>{var e;this.shadowRoot&&(null===(e=this.shadowRoot.getElementById("styleName"))||void 0===e||e.focus())}))}createStyle(){var e,t,o,i;if(this.shadowRoot){const r=null===(e=this.shadowRoot.getElementById("createAllProperties"))||void 0===e?void 0:e.checked,s=null===(t=this.shadowRoot.getElementById("createTab"))||void 0===t?void 0:t.checked,n=null===(o=this.shadowRoot.getElementById("styleName"))||void 0===o?void 0:o.value,a=null===(i=this.shadowRoot.getElementById("addInTemplate"))||void 0===i?void 0:i.checked;n||alert("Please give the new Style a name."),n&&this.callback&&this.callback(n,r,s,a)}this.closeDialog()}closeDialog(){this.backdrop.parentElement&&(document.body.removeChild(this.backdrop),document.body.removeChild(this))}static get styles(){return[dialogStyles,css`
          
        `]}render(){return html`
      <div class="content">
      
        <h1 style="padding-bottom: 20px;">Create new ${this.which} style</h1>

       
        <vaadin-text-field id="styleName" theme="small" style="width: 100%"  label="Text Style Name" ></vaadin-text-field>
        
        <vaadin-checkbox style="margin-top: 15px;" id="createAllProperties" >Include all properties</vaadin-checkbox>
        <br>
        <vaadin-checkbox style="margin-top: 15px;" id="createTab" >Include tabulator settings</vaadin-checkbox>
        <div style="margin-top: 15px;">
          <vaadin-radio-button id="addInTemplate" checked >Add in Template Style</vaadin-radio-button>
          <vaadin-radio-button id="addInDocument"  >Add in Document Style</vaadin-radio-button>
        </div>
      </div>
    
      
      <div class="footer" >
        <vaadin-button style="grid-column: 2" @click=${this.createStyle} theme="primary">Create Style</vaadin-button>
        <vaadin-button style="grid-column: 3" @click=${this.closeDialog} theme="secondary">CLOSE</vaadin-button>
      </div>
    
        
        `}}customElements.define("wc-dialog-add-text-style",WcDialogAddTextStyle);var __decorate$k=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n},__awaiter$s=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};let WcSelectionStoryRef=(()=>{let e=class extends LitElement{constructor(){super(),this.chars=null;const e=scope().eddiGetSelectedTextInfo();e?this.onEddiChange(e,0,0):(this.class={value:null,origin:"None"},this.lineHeight={value:null,origin:"None"},this.baselineShift={value:null,origin:"None"},this.tracking={value:null,origin:"None"},this.font={value:null,origin:"None"},this.fontSize={value:null,origin:"None"},this.fontColor={value:null,origin:"None"},this.spanClass={value:null,origin:"None"},this.paragraphClass={value:null,origin:"None"},this.horizontalTextAlign={value:null,origin:"None"},this.spaceAfterParagraph={value:null,origin:"None"},this.spaceBeforeParagraph={value:null,origin:"None"},this.bulletSize={value:null,origin:"None"},this.leftIndent={value:null,origin:"None"},this.rightIndent={value:null,origin:"None"},this.firstLineIndent={value:null,origin:"None"})}static get styles(){return[css`
            :host, :host * {
                box-sizing: border-box;
            }
            .thumb {
              width: 16px;
              height: 16px;
              position: relative;
              /* background-color: white;*/
              overflow: hidden;
              /*  border: 1px solid gray;*/

              cursor: pointer;
              line-height: 16px;
              text-align: center;
              color: black;
            }
            .grid {
              display: grid;
              grid-template-columns: repeat(auto-fit, 16px);
              grid-row-gap: 3px;
              grid-column-gap: 3px;
              margin-bottom: 10px;
              padding: 3px;
              border: 1px solid var(--printess-textColorLight)
            }
            .plus-button {
              align-self: center;
              margin-top: 6px;
              width: 20px;
              height: 20px;
            }
            `,desktopPropertyStyles]}renderTextContentUi(){return this.selection.allows("allowText","content")?html`
        `:""}createTextStyle(e){return __awaiter$s(this,void 0,void 0,(function*(){const t=baseParagraphStyleProps(),o=baseTextStyleProps();(new WcDialogAddTextStyle).showDialog(e,((i,r,s,n)=>{if(i&&(i=getValidClassName(i))){const a=[];a.push("."+i+" { "),this.fontSize.value&&a.push("\tfontSize: "+this.fontSize.value.toString()+";"),this.lineHeight.value&&(r||this.lineHeight.value.toString()!==o.lineHeight.toString())&&a.push("\tlineHeight: "+this.lineHeight.value.toString()+";"),this.fontColor.value&&(r||JSON.stringify(this.fontColor.value)!==JSON.stringify(o.fontColor))&&("string"==typeof this.fontColor.value?a.push("\tfontColor: "+this.fontColor.value+";"):this.fontColor.value.color.isSwatch()?a.push("\tfontColor: "+this.fontColor.value.color.name+";"):a.push("\tfontColor: "+this.fontColor.value.color.toRgbHexColor()+";")),this.baselineShift.value&&(r||this.baselineShift.value.toString()!==o.baselineShift.toString())&&a.push("\tbaselineShift: "+this.baselineShift.value.toString()+";"),null===this.tracking.value||!r&&this.tracking.value===o.tracking||a.push("\ttracking: "+this.tracking.value.toString()+";"),this.font.value&&(r||this.font.value.font.name!==o.font.font.name)&&a.push("\tfont: '"+this.font.value.font.name+"';"),"paragraph"===e&&(this.horizontalTextAlign.value&&(r||this.horizontalTextAlign.value!==t.horizontalTextAlign)&&(a.push("\thorizontalTextAlign: "+this.horizontalTextAlign.value+";"),"bullet"===this.horizontalTextAlign.value&&(this.bulletShape.value&&a.push("\tbulletShape: "+this.bulletShape.value+";"),this.bulletShift&&a.push("\tbulletShift: "+this.bulletShift.value+";"),this.bulletColor.value&&("string"==typeof this.bulletColor.value?a.push("\tbulletColor: "+this.bulletColor.value+";"):this.bulletColor.value.color.isSwatch()?a.push("\tbulletColor: "+this.bulletColor.value.color.name+";"):a.push("\tbulletColor: "+this.bulletColor.value.color.toRgbHexColor()+";")),this.bulletSize.value&&a.push("\tbulletSize: "+this.bulletSize.value+";"))),this.spaceAfterParagraph.value&&(r||this.spaceAfterParagraph.value.toString()!==t.spaceAfterParagraph.toString())&&a.push("\tspaceAfterParagraph: "+this.spaceAfterParagraph.value+";"),this.spaceBeforeParagraph.value&&(r||this.spaceBeforeParagraph.value.toString()!==t.spaceBeforeParagraph.toString())&&a.push("\tspaceBeforeParagraph: "+this.spaceBeforeParagraph.value+";"),this.firstLineIndent.value&&(r||this.firstLineIndent.value.toString()!==t.firstLineIndent.toString())&&a.push("\tfirstLineIndent: "+this.firstLineIndent.value+";"),this.leftIndent.value&&(r||this.leftIndent.value.toString()!==t.leftIndent.toString())&&a.push("\tleftIndent: "+this.leftIndent.value+";"),this.rightIndent.value&&(r||this.rightIndent.value.toString()!==t.rightIndent.toString())&&a.push("\trightIndent: "+this.rightIndent.value+";"),s&&(a.push("\ttabSize: 150%; /* only valid if tabs is not set */"),a.push("\t/**** Specific Tabs ****/"),a.push("\t/* To set specific tabs 'L_5cm' */"),a.push("\t/* (L)_5cm   L=left C=center R=right [.]=dezimal (or any other sign)*/"),a.push("\t/* L(_)5cm   _ for line or leave it out */"),a.push("\t/* L_(5cm)   5cm Position of tab */"),a.push("\ttabs: L1cm C_3cm R5cm .7cm;"),a.push("\ttabLineColor: [Black];"),a.push("\ttabLineType: dotted;"),a.push("\ttabLineHeight: 1pt;"))),a.push("}"),"paragraph"===e?scope().eddiStyleSelectedParagraph(null,i):scope().eddiStyleSelectedContent({class:i});const l=new RegExp("\\."+i+"\\s*{[^}]+}");let c="";c=n?scope().resourcesStylesUi.getGlobalStyle().text:scope().currentDoc.styleText.replace(l,"");const d=c+"\n\n"+a.join("\n");if(n)scope().resourcesStylesUi.onGlobalTextChange(d).then((()=>{scope().resourcesUi.selectStyles("global")}));else{const e=new Nobs;e.setProperty(scope().currentDoc,"styleText",d);const t=new Doc(e,scope().currentDoc);update([scope().currentDoc.serialize(scope().id)],[t.serialize(scope().id)]).then((()=>{scope().resourcesUi.selectStyles("local"),this.requestUpdate()}))}}}))}))}renderFontUi(){return this.selection.allows("allowText","font")?html`
        <wc-font-combo .callback=${this.fontChanged}  
        .fontName=${this.font.value?this.font.value.font.name:null}
         origin="${this.font.origin}" 
         selector="${this.font.selector||""}" 
        ></wc-font-combo>
        `:""}renderStylesUi(){const e=this.spanClass.value;let t=[];e&&(t=e.split(" ").filter((e=>""!==e.trim())));const o=this.paragraphClass.value;let i=[];return o&&(i=o.split(" ").filter((e=>""!==e.trim()))),this.selection.allows("allowText","styles")?html`
    <div class="two-cols" style="grid-template-columns: calc(100% - 30px) 30px; margin-bottom: 0;"> 
     
      <wc-tag-list style="margin-bottom:0;" caption="Paragraph-Style" addtags="not-allowed" type="class" .tags=${i} @tagsChanged=${e=>this.paragraphClassChangedArray(e.detail)}  ></wc-tag-list>   
      <wc-icon class="plus-button" icon="plus-circle" primarycolor="headline"  @click=${()=>this.createTextStyle("paragraph")}></wc-icon>
      
      <wc-tag-list caption="Character-Style" addtags="not-allowed" type="class" .tags=${t} @tagsChanged=${e=>this.spanClassChangedArray(e.detail)}  ></wc-tag-list>
      <wc-icon class="plus-button" icon="plus-circle" primarycolor="headline"  @click=${()=>this.createTextStyle("charracters")}></wc-icon>
    </div>
        `:""}renderColorUi(){return this.selection.allows("allowText","color")?html`
        <wc-color-combo .callback=${this.colorChanged}
        .colorRef=${this.fontColor.value instanceof ColorRef?this.fontColor.value:null}
         origin="${this.fontColor.origin}"  selector="${this.fontColor.selector||""}"></wc-color-combo> 
        `:""}renderSizeUi(){return this.selection.allows("allowText","size")?html`
        <wc-length-box property="fontSize" .callback=${this.fontSizeChanged} .value=${this.fontSize.value} 
        selector="${this.fontSize.selector||""}" origin="${this.fontSize.origin}" label="Font Size"></wc-length-box>

        `:""}renderlineHeightUi(){return this.selection.allows("allowText","lineHeight")?html` <wc-length-box property="lineHeight" .callback=${this.lineHeightChanged}  .value=${this.lineHeight.value}  
        selector="${this.lineHeight.selector||""}" origin="${this.lineHeight.origin}" label="Line Height"></wc-length-box>
        `:""}renderSizeAndLineHeight(){return this.selection.allows("allowText","size")&&this.selection.allows("allowText","lineHeight")?html`
          <div class="two-cols">
            <wc-length-box property="fontSize" .callback=${this.fontSizeChanged} .value=${this.fontSize.value} 
            selector="${this.fontSize.selector||""}" origin="${this.fontSize.origin}" label="Font Size"></wc-length-box>
            <wc-length-box .updateWcBox=${!1} property="lineHeight" .callback=${this.lineHeightChanged}  .value=${this.lineHeight.value}  
            selector="${this.lineHeight.selector||""}" origin="${this.lineHeight.origin}" label="Line Height"></wc-length-box>
          </div>`:this.selection.allows("allowText","size")?this.renderSizeUi():this.selection.allows("allowText","lineHeight")?this.renderlineHeightUi():""}renderTrackingAndBaseLineShiftUi(){return this.selection.allows("allowText","tracking")&&this.selection.allows("allowText","baselineShift")?html`
        <div class="seperator" ></div>  
      <div class="two-cols">
        ${this.renderTrackingUi()}
        ${this.renderBaselineShiftUi()}
      </div>`:html`
        ${this.renderTrackingUi()}
        ${this.renderBaselineShiftUi()}
      `}renderTrackingUi(){return this.selection.allows("allowText","tracking")?html`
        <wc-number-box  .value="${this.tracking.value}" .callback=${this.trackingChanged} 
        property="tracking"  
        selector="${this.tracking.selector||""}" origin="${this.tracking.origin}"
        ></wc-number-box>
        `:""}renderBaselineShiftUi(){return this.selection.allows("allowText","baselineShift")?html`
        <wc-length-box  property="baselineShift" .callback=${this.baselineShiftChanged} .value=${this.baselineShift.value} 
        selector="${this.baselineShift.selector||""}" origin="${this.baselineShift.origin}" label="Baseline Shift"></wc-length-box>
        `:""}renderBulletUi(){var e;return this.selection.allows("allowText","bullet")&&"bullet"===(null===(e=this.horizontalTextAlign)||void 0===e?void 0:e.value)?html`
        <div class="seperator" ></div>  
      
        <div class="two-cols">
            <wc-number-box  .value="${this.bulletSize.value}" .callback=${this.bulletSizeChanged} 
            property="bulletSize"  selector="${this.bulletSize.selector||""}" origin="${this.bulletSize.origin}"
            ></wc-number-box>
            <wc-number-box  .value="${this.bulletShift.value}" .callback=${this.bulletShiftChanged} 
            property="bulletShift"  selector="${this.bulletShift.selector||""}" origin="${this.bulletShift.origin}"
            ></wc-number-box>
        </div>
        <div class="grid">
            ${PathGeometry.getBulletShapeGenerators().map((e=>html`
              <div title="${e.name}"  @click=${()=>this.bulletShapeChanged(e.name)} class="thumb">${e.func?e.func().toSvg(this.bulletShape.value===e.name):"Empty"}</div>`))}
        </div>
        <wc-color-combo .callback=${this.bulletColorChanged} label="Bullet Color"
        .colorRef=${this.bulletColor.value instanceof ColorRef?this.bulletColor.value:null}
         origin="${this.bulletColor.origin}"  selector="${this.bulletColor.selector||""}"></wc-color-combo> 
        <div class="seperator" ></div>  
        `:""}renderIndentUi(){return this.selection.allows("allowText","indent")?html`
      <div class="seperator" ></div>  
      <p>Space Around Paragraph:</p>
      <div style="padding-top: 10px" class="two-cols">
      
        <wc-length-box  property="firstLineIndent" .callback=${this.firstLineIndentChanged} .value=${this.firstLineIndent.value} 
        selector="${this.firstLineIndent.selector||""}" origin="${this.firstLineIndent.origin}" label="First Line"></wc-length-box>
        <div></div>

        <wc-length-box  property="leftIndent" .callback=${this.leftIndentChanged} .value=${this.leftIndent.value} 
        selector="${this.leftIndent.selector||""}" origin="${this.leftIndent.origin}" label="Left Indent" ></wc-length-box>

        <wc-length-box  property="rightIndent" .callback=${this.rightIndentChanged} .value=${this.rightIndent.value} 
        selector="${this.rightIndent.selector||""}" origin="${this.rightIndent.origin}" label="Right Indent"></wc-length-box>

       
      </div>
        `:""}renderTextTransformUi(){return config.isBuyer||config.isMobile?"":html`
        <div class="two-cols">
            <wc-select .icons="${!1}" feature="storyRef" property="textTransform" .selection=${this.selection}></wc-select>
        </div>
        `}renderParagraphSpacingUi(){return this.selection.allows("allowText","paragraphSpacing")&&!this.selection.getValueExtended("storyRef","useBaselineGrid").value?html`
  
     <div class="two-cols">
        <wc-length-box  property="spaceBeforeParagraph" .callback=${this.spaceBeforeParagraphChanged} .value=${this.spaceBeforeParagraph.value} 
        selector="${this.spaceBeforeParagraph.selector||""}" origin="${this.spaceBeforeParagraph.origin}" label="Space Before"></wc-length-box>
        <wc-length-box  property="spaceAfterParagraph" .callback=${this.spaceAfterParagraphChanged} .value=${this.spaceAfterParagraph.value} 
        selector="${this.spaceAfterParagraph.selector||""}" origin="${this.spaceAfterParagraph.origin}" label="Space After"></wc-length-box>
    </div>
        `:""}renderHorizontalAlignmentUi(){return this.selection.allows("allowText","horizontalAlignment")?html` 
        <wc-select .icons="${!0}" .callback=${e=>this.horizontalTextAlignChanged(e)} .value="${this.horizontalTextAlignValue}" origin="${this.horizontalTextAlign.origin}" 
        selector="${this.horizontalTextAlign.selector||""}"  property="horizontalTextAlign" ></wc-select>
        `:""}renderVerticalAlignmentUi(){return this.selection.allows("allowText","verticalAlignment")?html`
        `:""}renderResetUi(){return this.canReset()?html`
                <div class="seperator"></div>
                <button  @click=${()=>this.resetStyles()}>Reset Text Formatting</button>
                `:""}renderSectionHead(){return config.isBuyer&&this.selection.allowsAny("allowText")?html`
            <div class="admin-properties-devider">Text</div>
       `:""}renderCharacterHead(){return config.isBuyer?"":html`
            <div class="admin-properties-devider" style="margin-top: 5px;">  
              <span>Character</span>
              ${this.canReset()?html`<wc-icon icon="trash" style="width: 15px; height: 15px; top:1px; position: absolute; right: 3px;" primaryColor="head-toolbar" @click=${()=>this.resetStyles()}>RESET</wc-icon>`:""}
            </div>
            
            
       `}canReset(){let e=!1;const t=scope().eddiGetSelectedBox();if(t){const o=t.box.getValue("lock","allowText"),i=o.indexOf("content")>=0?2:1;e=o.length>=i||!config.isMobile&&!config.isBuyer}return e}renderParagraphHead(){return config.isBuyer?"":html`
            <div class="admin-properties-devider">Paragraph</div>
       `}render(){return!this.selection||!this.selection.hasFeature("storyRef")||scope().filterPropertiesBySelectedFeature&&"story"!==this.selectedTool?html``:html`   

              ${this.renderSectionHead()}

             
              
              ${scope().eddiActive()?html`

                <vaadin-button  theme="small" @click="${()=>scope().closeEddi()}" theme="secondary">
                    <wc-icon icon="close-square" style="width: 16px; height: 16px" primaryColor="headline" slot="prefix"></wc-icon>
                    Close Text Editor
                </vaadin-button>
                <div class="seperator"></div>
               
                ${this.renderStylesUi()}
                

                ${this.renderCharacterHead()} 
                ${this.renderFontUi()}
                ${this.renderSizeAndLineHeight()}
                
                ${this.renderColorUi()}
                ${this.renderTrackingAndBaseLineShiftUi()}
                ${this.renderResetUi()}

                ${this.renderParagraphHead()}
                 

                ${this.renderHorizontalAlignmentUi()}
                ${this.renderBulletUi()}
                ${this.renderIndentUi()}
                ${this.renderParagraphSpacingUi()}
               
                <div class="seperator"></div>
                <vaadin-button  theme="small" @click="${()=>scope().closeEddi()}" theme="secondary">
                    <wc-icon icon="close-square" style="width: 16px; height: 16px" primaryColor="headline" slot="prefix"></wc-icon>
                    Close Text Editor
                </vaadin-button>
              
               
              `:html` 
                  <vaadin-button  theme="small" @click="${()=>scope().showEddi()}" theme="secondary">
                    <wc-icon icon="pen" style="width: 16px; height: 16px" primaryColor="headline" slot="prefix"></wc-icon>
                    Edit Text
                </vaadin-button>

                <div class="seperator"></div>
                
                ${this.renderClassUi()}

                <div class="seperator"></div>
              
              
                ${this.renderPaddingUi()}
                ${this.renderMinMaxHeight()}
                ${this.renderBaselineGridUi()}
                ${this.renderFirstBaselineUi()}
                ${this.renderHyphenationUI()}
                ${this.renderStoryVerticalAlignUi()}
                


               <div class="seperator"></div>
               <vaadin-button  theme="small" @click="${()=>scope().selectionPropertiesUi.setTextMode("single")}" theme="secondary">
                    <wc-icon icon="text" style="width: 16px; height: 16px" primaryColor="headline" slot="prefix"></wc-icon>
                    Make Single Line Text
                </vaadin-button>
                

              `}
`}renderClassUi(){const e=this.selection.getValueExtended("basics","class").value;let t=[];return e&&(t=e.split(" ").filter((e=>""!==e.trim()))),this.selection.allows("allowFrame","class")?html`<p style="margin-bottom: 0">Base Style [Class]</p><wc-tag-list caption="" addtags="allowed" type="class" .tags=${t} @tagsChanged=${e=>this.classChanged(e.detail)}  ></wc-tag-list>`:""}classChanged(e){const t=e.join(" ");this.selection.setValue("basics","class",t)}get horizontalTextAlignValue(){return this.horizontalTextAlign.value?this.horizontalTextAlign.value.toString():null}onEddiChange(e,t,o){console_log(" info.tracking:"+e.tracking),this.font=e.font,this.fontSize=e.fontSize,this.fontColor=e.fontColor,this.tracking=e.tracking,this.baselineShift=e.baselineShift,this.lineHeight=e.lineHeight,this.chars=e.chars,this.horizontalTextAlign=e.horizontalTextAlign,this.spaceAfterParagraph=e.spaceAfterParagraph,this.spaceBeforeParagraph=e.spaceBeforeParagraph,this.leftIndent=e.leftIndent,this.rightIndent=e.rightIndent,this.firstLineIndent=e.firstLineIndent,this.bulletShape=e.bulletShape,this.bulletSize=e.bulletSize,this.bulletShift=e.bulletShift,this.bulletColor=e.bulletColor,this.paragraphClass=e.paragraphClass,this.spanClass=e.spanClass,this.requestUpdate()}reloadFonts(){if(this.shadowRoot){const e=this.shadowRoot.querySelector("WC-FONT-COMBO");e&&e.fillFontList()}}resetStyles(){scope().eddiStyleSelectedContent({},!1,!1)}lineHeightChanged(e){scope().eddiStyleSelectedContent({lineHeight:e})}baselineShiftChanged(e){scope().eddiStyleSelectedContent({baselineShift:e})}spanClassChanged(e){scope().eddiStyleSelectedContent({class:"[none]"===e?"":e})}spanClassChangedArray(e){scope().eddiStyleSelectedContent({class:e.join(" ")})}paragraphClassChanged(e){scope().eddiStyleSelectedParagraph(null,"[none]"===e?"":e)}paragraphClassChangedArray(e){scope().eddiStyleSelectedParagraph(null,e.join(" "))}trackingChanged(e){scope().eddiStyleSelectedContent({tracking:e})}bulletSizeChanged(e){scope().eddiStyleSelectedParagraph({bulletSize:e})}bulletShiftChanged(e){scope().eddiStyleSelectedParagraph({bulletShift:e})}bulletShapeChanged(e){scope().eddiStyleSelectedParagraph({bulletShape:e})}bulletColorChanged(e){scope().eddiStyleSelectedParagraph({bulletColor:e})}fontSizeChanged(e){scope().eddiStyleSelectedContent({fontSize:e})}horizontalTextAlignChanged(e){scope().eddiStyleSelectedParagraph({horizontalTextAlign:e})}leftIndentChanged(e){scope().eddiStyleSelectedParagraph({leftIndent:e})}rightIndentChanged(e){scope().eddiStyleSelectedParagraph({rightIndent:e})}firstLineIndentChanged(e){scope().eddiStyleSelectedParagraph({firstLineIndent:e})}spaceAfterParagraphChanged(e){scope().eddiStyleSelectedParagraph({spaceAfterParagraph:e})}spaceBeforeParagraphChanged(e){scope().eddiStyleSelectedParagraph({spaceBeforeParagraph:e})}colorChanged(e){scope().eddiStyleSelectedContent({fontColor:e})}fontChanged(e){scope().eddiStyleSelectedContent({font:new FontRef(e)})}repeat(){return this.selection.getValueExtended("storyRef","frameRepeat").value||"none"}setRepeat(e,t){e&&e.target&&t!==this.repeat()&&this.selection.setValue("storyRef","frameRepeat",t)}renderPaddingUi(){return(this.selection.hasFeature("simpleText")||this.selection.hasFeature("storyRef"))&&this.selection.allows("allowText","padding")?html`
        
        <div class="two-cols">
          <wc-length-box feature="basics" property="paddingLeft" .selection=${this.selection}></wc-length-box>
          <wc-length-box feature="basics" property="paddingRight" .selection=${this.selection}></wc-length-box>
          <wc-length-box feature="basics" property="paddingTop" .selection=${this.selection}></wc-length-box>
          <wc-length-box feature="basics" property="paddingBottom" .selection=${this.selection}></wc-length-box>
        </div>
        ${!0===this.selection.getValueExtended("pathGeometry","pathDefinesBoxSize").value?html`
            <wc-checker theme="small" feature="pathGeometry" property="wrapTextInShape" .selection=${this.selection} ></wc-checker>
        `:""}
        <div class="two-cols">
            ${this.selection.hasFeature("storyRef")&&this.selection.hasFeature("pathGeometry")?html`
              <wc-length-box feature="storyRef" property="wrapShapeOffset" .selection=${this.selection}></wc-length-box>
            `:html`<div></div>`}
            <wc-number-box feature="storyRef" property="wrapAscenderDiminisher" .selection=${this.selection} .updateWcBox=${!1}></wc-number-box>

          <div></div>
          ${this.selection.hasTextFlow()?html``:html`
          <wc-select .icons=${!0} feature="storyRef" property="autoTextMode" .selection="${this.selection}"></wc-select>`}
          
        </div>
     
      `:""}renderMinMaxHeight(){return this.selection.hasTextFlow()?"":html`
        ${"height"===this.selection.getValueExtended("storyRef","autoTextMode").value?html`
          <div class="two-cols">
              <wc-length-box feature="storyRef" property="maxHeight" .selection=${this.selection}></wc-length-box>
              <wc-length-box feature="storyRef" property="minHeight" .selection=${this.selection}></wc-length-box>    
          </div>
        `:""}
        
        ${"width"===this.selection.getValueExtended("storyRef","autoTextMode").value?html`
          <div class="two-cols">
              <wc-length-box feature="storyRef" property="maxWidth" .selection=${this.selection}></wc-length-box>
              <wc-length-box feature="storyRef" property="minWidth" .selection=${this.selection}></wc-length-box>    
          </div>
        `:""}
      `}renderBaselineGridUi(){return this.selection.hasFeature("storyRef")&&this.selection.allows("allowText","baselineGrid")?html`
          <div class="seperator" ></div>  
          <wc-checker theme="small" feature="storyRef" property="useBaselineGrid" .selection=${this.selection}></wc-checker>
       `:""}renderFirstBaselineUi(){return this.selection.hasFeature("storyRef")&&this.selection.allows("allowText","baselineGrid")&&!this.selection.getValueExtended("storyRef","useBaselineGrid").value?html`
          <wc-select feature="storyRef" property="firstBaseline" .selection=${this.selection}></wc-select>
       `:""}renderHyphenationUI(){if(this.selection.hasFeature("storyRef")&&this.selection.allows("allowText","content")){const e=this.selection.getStory();if(e)return html`<wc-select .value="${e.hyphenationLanguage}"  property="hyphenationLanguage"
        .callback=${t=>this.setHyphenationLanguage(e,t)} label="Hyphenation:"  ></wc-select>`}return""}setHyphenationLanguage(e,t){return __awaiter$s(this,void 0,void 0,(function*(){if(checkEnumValue("hyphenationLanguage",t)){const o=t,i=new Nobs;i.setProperty(e,"hyphenationLanguage",o),yield update([e.serialize()],[new Story(i,e).serialize()]),this.requestUpdate()}}))}renderStoryVerticalAlignUi(){return this.selection.hasFeature("storyRef")&&this.selection.allows("allowText","verticalAlignment")?!0===this.selection.getValueExtended("storyRef","useBaselineGrid").value?html`<div class="seperator" ></div><p>Vertical text alignment disabled because baseline grid is active.</p>`:!0===this.selection.getValueExtended("pathGeometry","wrapTextInShape").value?html`<div class="seperator" ></div><p>Vertical text alignment disabled because shape wrapping is active.</p>`:"off"!==this.selection.getValueExtended("storyRef","autoTextMode").value?html`<div class="seperator" ></div><p>Vertical text alignment disabled because auto frame size is active.</p>`:this.selection.hasTextFlow()?html`<div class="seperator" ></div><p>Vertical text alignment disabled because text flow is active.</p>`:html`
          <div class="seperator" ></div>  
          <wc-select .icons=${!0} feature="storyRef" property="verticalStoryTextAlign" .selection=${this.selection}></wc-select>
       `:""}};return __decorate$k([property({attribute:!1,type:Object})],e.prototype,"selection",void 0),__decorate$k([property()],e.prototype,"selectedTool",void 0),e=__decorate$k([customElement("wc-selection-story-ref")],e),e})();var __decorate$l=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n};let WcSelectionPath=(()=>{let e=class extends LitElement{constructor(){super(...arguments),this.currentShapeName="",this.currentShapeParams={}}static get styles(){return[desktopPropertyStyles,css`
            :host, :host * {
                box-sizing: border-box;
            }

            :host {
                display: block;
            }

            .thumb {
                width: 40px;
                height: 40px;
                position: relative;
                /* background-color: white;*/
                overflow: hidden;
                /*  border: 1px solid gray;*/

                cursor: pointer;
                line-height: 40px;
                text-align: center;
                color: #999;
            }
 

            .thumb:hover {
                outline: 3px solid white;
            }

            .grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, 40px);
                grid-row-gap: 5px;
                grid-column-gap: 5px;
                margin-bottom: 15px;
            }

           `]}isOpenPath(){return!1===this.selection.getValueExtended("pathGeometry","closed").value}renderPatheEditorUi(){var e;return html`
            <vaadin-button  theme="small" @click="${()=>scope().closePathEditor()}" theme="secondary">
                <wc-icon icon="close-square" style="width: 16px; height: 16px" primaryColor="headline" slot="prefix"></wc-icon>
                Close Path Editor
            </vaadin-button>
            <vaadin-checkbox theme="small" ?checked=${scope().pathEditor.snapToGrid}
                    @checked-changed=${e=>scope().pathEditor.snapToGrid=!!e.target.checked}
                    >Snap to grid lines</vaadin-checkbox>
                    <div class="seperator"></div>

            <vaadin-button theme="small"   @click="${()=>scope().pathEditor.insertPoint(-1,"X")}" theme="secondary">
                <wc-icon icon="trash"  style="width: 16px; height: 16px" primaryColor="headline"  slot="prefix"></wc-icon>
                Remove Point
            </vaadin-button>  

            <vaadin-button theme="small"   @click="${()=>scope().pathEditor.insertPoint(-1,"L")}" theme="secondary">
                <wc-icon icon="plus-circle"  style="width: 16px; height: 16px" primaryColor="headline"  slot="prefix"></wc-icon>
                Add Point
            </vaadin-button>

            <vaadin-button theme="small"   @click="${()=>scope().pathEditor.openOrClosePath()}" theme="secondary">
            
                ${(null===(e=scope().pathEditor.originalPath)||void 0===e?void 0:e.closed)?"Path is closed":"Path is open"}
            </vaadin-button> 
            <div class="seperator"></div>

            <h5>Tip:</h5>
            <p>Hold down shift while moving an anchor point to create curve. You can also hold down shift to move both control points at once.</p>
            <p>Select an anchor point and press "+" to insert a new point or the "delete"-key to remove point</p>
        `}renderNewShapeUi(){return!config.isBuyer||!this.selection.hasSelection()&&this.selection.allows("allowAdd","shape")?html`
        <div class="buyer-properties-devider">Create Shape</div>
        ${config.isBuyer?"":html` <p>To create a shape, draw a new frame on the page or click on a shape below:</p>`}
 
            <div class="grid">  
                ${PathGeometry.getShapeGenerators().map((e=>html`
                  <div title="${e.name}"  
                    @click=${()=>this.makeShape(e.name)} 
                    style="${"Checker"===e.name?"padding: 3px;":""}"
                    class="thumb">${e.func?e.func().toSvg(void 0,"Checker"===e.name?10:void 0):"Empty"}</div>
                `))}
            </div>
        `:html``}renderShapeUi(){return this.selection.allows("allowShape","shape")?html`
        <div class="grid">
            ${PathGeometry.getShapeGenerators().map((e=>html`
              <div title="${e.name}" 
                @click=${()=>this.makeShape(e.name)} 
                style="${"Checker"===e.name?"padding: 3px;":""}"
                class="thumb" >${e.func?e.func().toSvg(this.currentShapeName===e.name,"Checker"===e.name?10:void 0):"Empty"}</div>`))}
        </div>
        `:""}renderPathUi(){return this.selection.allows("allowShape","path")?html`
        <vaadin-button theme="small"   @click="${()=>scope().showPathEditor()}" theme="secondary">
            <wc-icon icon="pen"  style="width: 16px; height: 16px" primaryColor="headline"  slot="prefix"></wc-icon>
            Edit Path
        </vaadin-button> 
        
      ${"Badge"===this.currentShapeName?html`
          <div class="seperator"></div>
          <div class="two-cols">
            <wc-number-box property="corners" .value="${this.currentShapeParams.corners}" 
              .callback=${(e,t)=>this.setShapeProperty("Badge","corners",e,t)}></wc-number-box>
            <wc-number-box property="innerRadius" .value="${this.currentShapeParams.innerRadius}" 
              .callback=${(e,t)=>this.setShapeProperty("Badge","innerRadius",e,t)}></wc-number-box>
            </wc-number-box>  
          </div>
          <div class="seperator"></div>
      `:"Star"===this.currentShapeName?html`
          <div class="seperator"></div>
          <div class="two-cols">
            <wc-number-box property="corners" .value="${this.currentShapeParams.corners}" 
              .callback=${(e,t)=>this.setShapeProperty("Star","corners",e,t)}></wc-number-box>
            <wc-number-box property="innerRadius" .value="${this.currentShapeParams.innerRadius}" 
              .callback=${(e,t)=>this.setShapeProperty("Star","innerRadius",e,t)}></wc-number-box>
            </wc-number-box>  
          </div>
          <div class="seperator"></div>
      `:"Arrow"===this.currentShapeName?html`
          <div class="seperator"></div>
          <div class="two-cols">
            <wc-number-box property="customStrictStep1"  customMin="1" customMax="100" .value="${this.currentShapeParams.thickness}" 
              label="Thickness"  .callback=${(e,t)=>this.setShapeProperty("Arrow","thickness",e,t)}>
            </wc-number-box>
            <wc-number-box property="customStrictStep1"  customMin="50" customMax="95" .value="${this.currentShapeParams.start}" 
              label="Length"  .callback=${(e,t)=>this.setShapeProperty("Arrow","start",e,t)}>
            </wc-number-box>
            <wc-number-box property="customStrictStep1"  customMin="0" customMax="100" .value="${this.currentShapeParams.curve}" 
              label="Curve"  .callback=${(e,t)=>this.setShapeProperty("Arrow","curve",e,t)}>
            </wc-number-box>
           
          </div>
          <div class="seperator"></div>
      `:"Rectangle"===this.currentShapeName?html`
          <div class="seperator"></div>
          <div class="two-cols">
            <wc-number-box property="customStrictStep1"  customMin="0" customMax="50" .value="${this.currentShapeParams.radius}" 
              label="Corner Radius"  .callback=${(e,t)=>this.setShapeProperty("Rectangle","radius",e,t)}>
            </wc-number-box>
          
          </div>
          <div class="seperator"></div>
      `:""}
       
        `:""}setShapeProperty(e,t,o,i){t&&(this.currentShapeParams[t]=o),this.makeShape(e,this.currentShapeParams,i)}renderPathDefinesBoxUi(){return config.isMobile||config.isBuyer?"":html`
       <div class="seperator"></div>
       <wc-checker theme="small" feature="pathGeometry" property="pathDefinesBoxSize" .selection=${this.selection} ></wc-checker>
        `}renderwrapTextInShapeUi(){return config.isMobile||config.isBuyer||!this.selection.hasFeature("storyRef")||!0!==this.selection.getValueExtended("pathGeometry","pathDefinesBoxSize").value?"":html`
       <div class="seperator"></div>
       <wc-checker theme="small" feature="pathGeometry" property="wrapTextInShape" .selection=${this.selection} ></wc-checker>
       ${this.selection.getValueExtended("pathGeometry","wrapTextInShape").value?html`
              <wc-length-box feature="storyRef" property="wrapShapeOffset" .selection=${this.selection}></wc-length-box>
              <wc-number-box feature="storyRef" property="wrapAscenderDiminisher" .selection=${this.selection}></wc-number-box>
            `:""}
        `}renderColorUi(){return this.isOpenPath()?"":config.isBuyer?this.selection.allows("allowShape","color")?html`
          <wc-color-grid feature="pathGeometry" property="fillColor" .selection=${this.selection}></wc-color-grid>
        `:"":html`<wc-color-combo feature="pathGeometry" property="fillColor" .selection=${this.selection}></wc-color-combo>`}renderStrokeUi(){return this.selection.allows("allowShape","stroke")?html`
      <div class="seperator" ></div>
      <wc-length-box feature="pathGeometry" property="strokeWidth" .selection=${this.selection}></wc-length-box>
      ${this.hasStrokeUi()?html`
          <wc-color-combo feature="pathGeometry" property="strokeColor" .selection=${this.selection}></wc-color-combo>
          <div class="two-cols">
            ${this.isOpenPath()?html`<div></div>`:html`
            <wc-select ?icons=${!0} feature="pathGeometry" property="strokeAlign" .selection=${this.selection}></wc-select>
            `}
            <wc-select ?icons=${!0} feature="pathGeometry" property="strokeJoin" .selection=${this.selection}></wc-select>
            <wc-select  feature="pathGeometry" property="strokeType" .selection=${this.selection}></wc-select>
            ${this.hasStrokeCapUi()?html`
              <wc-select ?icons=${!0} feature="pathGeometry" property="strokeCap" .selection=${this.selection}></wc-select>
            `:""}
          </div>  
          ${this.hasStrokeDashUi()?html`
            <wc-number-box mode="both" feature="pathGeometry" property="strokeDashFactor" .selection=${this.selection}></wc-number-box>
          `:""}
          ${this.hasStrokeGapUi()?html`
            <wc-number-box mode="both" feature="pathGeometry" property="strokeGapFactor" .selection=${this.selection}></wc-number-box>
          `:""}
          
        `:""}
      `:""}hasStrokeUi(){const e=this.selection.getValueExtended("pathGeometry","strokeWidth").value;return!!(e&&e.value>0)}hasStrokeCapUi(){let e="solid"===this.selection.getValueExtended("pathGeometry","strokeType").value;return e&&(e=!1===this.selection.getValueExtended("pathGeometry","closed").value),e}hasStrokeGapUi(){return"solid"!==this.selection.getValueExtended("pathGeometry","strokeType").value}hasStrokeDashUi(){return"dashed n"===this.selection.getValueExtended("pathGeometry","strokeType").value}hasDashDistribution(){return"solid"!==this.selection.getValueExtended("pathGeometry","strokeType").value}renderSectionHead(){return config.isBuyer&&this.selection.allowsAny("allowShape")?html`
          <div class="buyer-properties-devider">Shape</div>
     `:""}render(){var e,t;if(this.currentShapeName="",this.currentShapeParams={},!this.selection||scope().filterPropertiesBySelectedFeature&&"path"!==this.selectedTool)return html``;if(this.selection.hasFeature("pathGeometry")){const o=this.selection.getSingleSelection();return o&&o.box.pathGeometry&&(this.currentShapeName=null===(e=o.box.pathGeometry)||void 0===e?void 0:e.shape,this.currentShapeParams=null===(t=o.box.pathGeometry)||void 0===t?void 0:t.shapeParams),scope().pathEditorActive()?this.renderPatheEditorUi():html`
          
          ${this.renderSectionHead()}

          ${this.renderShapeUi()}
          ${this.renderPathUi()}
          ${this.renderColorUi()}
          ${this.renderStrokeUi()}

          ${this.renderPathDefinesBoxUi()}
          ${this.renderwrapTextInShapeUi()}
`}return this.renderNewShapeUi()}makeShape(e,t={},o=!1){var i;this.selection.getSelectedBoxes().length>0?(null===(i=this.selection.getSingleSelection())||void 0===i?void 0:i.box.getFeature("pathGeometry"))?this.selection.assignShape(e,t,o):(new WcTipDialog).showDialog("addFeatureOrCreateBox").then((t=>{"addBox"===t?scope().createNewBox("auto",boxTypeE.path,void 0,void 0,void 0,e):"OK"===t&&this.selection.assignShape(e)})):scope().createNewBox("auto",boxTypeE.path,void 0,void 0,void 0,e)}};return __decorate$l([property({attribute:!1,type:Object})],e.prototype,"selection",void 0),__decorate$l([property()],e.prototype,"selectedTool",void 0),e=__decorate$l([customElement("wc-selection-path")],e),e})();var __decorate$m=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n};let WcChecker=(()=>{var e;let t=e=class extends LitElement{constructor(){super(...arguments),this.feature=null,this.selection=null,this.property=null,this.value=null,this.label=null,this.callback=null,this.selector=null,this.origin=null,this.theme="big"}static get styles(){return css`
            :host, :host * {
                box-sizing: border-box;
            }

            :host {
                display: flex;
                flex-direction: column;
            }

            .icon {
                width: 20px;
                height: 20px;
                margin-right: 8px;
            }

            .item {
            
                height: 28px;
                display: flex;
                align-items: center;
                justify-content: space-between;
            }

            .label {
                color: var(--printess-textColor);
                font-size: 16px;
                width: 100%;
                 
                padding-right: 5px;
            }
 
            .switch {
                width: 30px;
                height: 16px;
                display: inline-block;
            }

            .switch input {
                display: none;
            }

            .switch .slider {
                position: absolute;
           
                 background-color: #d1d1cc;
                width: inherit;
                height: inherit;
                border-radius: 8px;
                cursor: pointer;
                transition: background-color 1s linear;
            }

            .switch .slider:before {
                position: absolute;
                content: "";
                height: 16px;
                width: 16px;
                border-radius: 8px;
                background-color: #fff;
                transition: 0.4s, background-color 1s linear;
            }

            .switch input:checked + .slider {
                    background-color: var(--printess-headlineColor);
            }

            .switch input:checked + .slider:before {
                transform: translateX(15px);
            }


        `}render(){return"icon"===this.theme&&this.icon?html`<wc-icon style="width: 18px; height: 18px; pointer: cursor;" class="icon" title="${this.uiLabel}" icon="${this.icon}" primaryColor="${this.uiValue?"headline":"text"}" 
                  @click=${()=>this.uiValue=!this.uiValue}></wc-icon>`:html`  
    <div class="item" >
      ${null!==this.icon?html`<wc-icon class="icon"  icon="${this.icon}" primaryColor="${this.uiValue?"headline":"text"}"></wc-icon>`:""}
      
      ${this.uiLabel?html`<div class="label"   style="${"big"!==this.theme?"padding-left:0;":""} color: ${this.uiValue?"var(--printess-headlineColor)":"var(--printess-textColor)"}; font-size: ${"small"===this.theme?"var(--printess-inputSize)":"16px"};">${this.uiLabel}</div>`:""}
      
      <label class="switch">
          <input type="checkbox"  ?disabled=${this.uiDisabled}  
              .checked=${!!this.uiValue}
              @change=${e=>e.currentTarget?this.uiValue=e.currentTarget.checked:null} />
          <div class="slider"></div>
      </label>
    </div>        
        `}get icon(){switch(this.property){case"warpPitActive":return"warp-squeeze";case"warpFlagActive":return"warp-flag";case"warpArcActive":return"warp-bulge";case"warpArchActive":return"warp-arc";case"warpCupActive":return"warp-mug";case"lockForAdmin":return"lock-closed";case"lockForBuyer":return"user-lock-closed";case"warpFishActive":return"warp-fish";case"warpCustomActive":return"settings";case"meshActive":return"mesh";case"distortActive":return"distort";case"perspectiveActive":return"perspective";case"wrapTextInShape":return"text-align-center";case"lockBox":return!0===this.uiValue?"lock-closed":"lock-open";case"lockAspectRatio":return"link";case"hasClickAction":return"pointer";case"isUiElement":return"user-circle";case"hasZoomAction":return"search-plus";case"mirrorX":return"mirror-x";case"mirrorY":return"mirror-y"}return null}get uiDisabled(){return isInactive(this.extendedValue)}get uiLabel(){let t="";return this.property?e.getLabel(this.property):(this.label&&(t=this.label),"class"===this.property?t:augmentLabel(t,this.extendedValue))}static getLabel(e){switch(e){case"maskActive":return"Mask";case"warpArcActive":return"Arc";case"warpArchActive":return"Arch";case"warpCupActive":return"Mug";case"warpCustomActive":return"Custom";case"warpFishActive":return"Fish";case"warpFlagActive":return"Flag";case"warpPitActive":return"Pit";case"meshActive":return"Mesh";case"distortActive":return"Distortion";case"blurActive":return"Blur";case"perspectiveActive":return"Perspective";case"dropActive":return"Drop Shadow";case"inShadowActive":return"Inner Shadow";case"inGlowActive":return"Inner Glow";case"strokeActive":return"Stroke";case"outGlowActive":return"Outer Glow";case"turbulenceActive":return"Turbulence";case"bevelActive":return"Bevel";case"lockForAdmin":return"Lock always";case"lockForBuyer":return"Lock for buyer";case"closed":return"Path is closed";case"visible":return"Visibility";case"wrapTextInShape":return"Wrap text inside shape";case"hasClickAction":return"Click Action";case"hasZoomAction":return"Zoom to Frame";case"isUiElement":return"User Interface";case"if":return"If";case"useBaselineGrid":return"Use Base Line Grid";case"lockBox":return"lock Position";case"maskInverse":return"Inverse";case"hasFontSize":return"";case"lockAspectRatio":return"Lock Aspect Ratio";case"symbolKeepRatio":return"Preserve Ratio";case"pathDefinesBoxSize":return"Path defines box size";case"hideNonPrintableLayers":return"Hide Non Printable Layers in Preview";case"hasFormField":return"Show as Form Field";case"mirrorX":return"Horizontal Mirror";case"mirrorY":return"Vertical Mirror";default:assertNever$1(e)}}get extendedValue(){return this.selection&&this.property&&this.feature?this.selection.getValueExtended(this.feature,this.property):{value:this.value,selector:this.selector,origin:this.origin}}get uiValue(){return this.selection&&this.property&&this.feature?this.selection.getValueExtended(this.feature,this.property).value:this.value}set uiValue(e){null!==e&&e!==this.uiValue&&(this.selection&&this.property&&this.feature?this.selection.setValue(this.feature,this.property,e):this.callback&&this.callback(e))}};return __decorate$m([property()],t.prototype,"feature",void 0),__decorate$m([property({attribute:!1,type:Object})],t.prototype,"selection",void 0),__decorate$m([property()],t.prototype,"property",void 0),__decorate$m([property({type:Boolean})],t.prototype,"value",void 0),__decorate$m([property()],t.prototype,"label",void 0),__decorate$m([property({attribute:!1})],t.prototype,"callback",void 0),__decorate$m([property()],t.prototype,"selector",void 0),__decorate$m([property()],t.prototype,"origin",void 0),__decorate$m([property()],t.prototype,"theme",void 0),t=e=__decorate$m([customElement("wc-checker")],t),t})();var __decorate$n=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n},__awaiter$t=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};let WcSelectionSimpleText=(()=>{var e;let t=e=class extends LitElement{static get styles(){return[desktopPropertyStyles,css`
            :host, :host * {
                box-sizing: border-box;
            }
            .symbols {
                width: 100%;
                min-height: 100px; 
                max-height: 280px;
                overflow-y: scroll;
            }`]}reloadFonts(){if(this.shadowRoot){const e=this.shadowRoot.querySelector("WC-FONT-COMBO");e&&e.fillFontList()}}renderTextContentUi(){return this.selection.allows("allowText","content")?html`
           <wc-text-area feature="simpleText" property="text" .selection=${this.selection} ></wc-text-area> 
        `:""}renderFontUi(){return this.selection.allows("allowText","font")?html`
           <wc-font-combo feature="simpleText" property="font" .selection=${this.selection} ></wc-font-combo>
        `:""}renderBarcodeUi(){return this.selection.allows("allowText","content")?html`
           <wc-select feature="simpleText" property="barcodeType" .selection=${this.selection} ></wc-select>
           <wc-text-area feature="simpleText" mode="multiLine" property="barcodeOptions" .selection=${this.selection} ></wc-text-area> 
        `:""}renderFontSizeUi(){return this.selection.allows("allowText","size")?html`
    <div class="seperator"></div>
    <div class="two-cols uneven">
      <div>
        <wc-checker  style="padding-right: 15px; margin-top: 20px;" theme="small" feature="simpleText" property="hasFontSize" .selection=${this.selection} ></wc-checker>
      </div>
    
      <wc-length-box style="opacity: ${this.selection.getValueExtended("simpleText","hasFontSize").value?"1":"0.3"};"
            feature="simpleText" property="fontSize" .selection=${this.selection}></wc-length-box>
      
    </div>
        `:""}renderLetterWidthAndSpacingUi(){return this.selection.allows("allowText","font")?html`
          <div class="seperator"></div>
           <div class="two-cols">
              <wc-number-box feature="simpleText" property="minLetterWidth" .selection=${this.selection}></wc-number-box>
              <wc-number-box feature="simpleText" property="maxLetterWidth" .selection=${this.selection}></wc-number-box>

              <wc-number-box feature="simpleText" property="minLetterSpacing" .selection=${this.selection}></wc-number-box>
              <wc-number-box feature="simpleText" property="maxLetterSpacing" .selection=${this.selection}></wc-number-box>
           </div>
        `:""}renderColorUi(){return this.selection.hasFeature("imageRef")&&"simpleText"===this.selection.getValueExtended("imageRef","imageMasking").value?"":this.selection.allows("allowText","color")?html`
            <wc-color-combo feature="simpleText" property="fontColor" .selection=${this.selection}></wc-color-combo>
        `:""}renderTextTransformUi(){return config.isBuyer||config.isMobile?"":html`
        <div class="seperator"></div>
        <div class="two-cols">
            <wc-select .icons="${!1}" feature="simpleText" property="textTransform" .selection=${this.selection}></wc-select>
            <wc-number-box mode="input" feature="simpleText" property="maxCharacters" .selection=${this.selection}></wc-number-box>
        </div>
        `}renderTextBeforeAftertUi(){return config.isBuyer||config.isMobile?"":html`
      <div class="two-cols">
        <wc-text-area hint="off"  mode="singleLine" feature="simpleText" property="textBefore" .selection=${this.selection} ></wc-text-area> 
        <wc-text-area hint="off" mode="singleLine" feature="simpleText" property="textAfter" .selection=${this.selection} ></wc-text-area> 
      </div>
        `}renderHorizontalAlignmentUi(){return this.selection.allows("allowText","horizontalAlignment")?html`
            <wc-select .icons="${!0}" feature="simpleText" property="horizontalSimpleTextAlign" .selection=${this.selection}></wc-select>
        `:""}renderVerticalAlignmentUi(){return this.selection.allows("allowText","verticalAlignment")?html`
          <div class="two-cols uneven">
            <wc-select .icons="${!0}" feature="simpleText" property="verticalSimpleTextAlign" .selection=${this.selection}></wc-select>
            <wc-select .icons="${!0}" feature="simpleText" property="fontHeights" .selection=${this.selection}></wc-select>
          </div>
        `:""}renderSymbolPositionUI(){return this.selection.allows("allowText","verticalAlignment")?html`
      <div class="two-cols uneven">
      <div>
        <p class="section-head">Position:</p>
        <wc-checker style="padding-right: 15px; margin-top: 20px;" theme="small" feature="simpleText" property="symbolKeepRatio" .selection=${this.selection} ></wc-checker>
        </div>
        ${this.selection.getValueExtended("simpleText","symbolKeepRatio").value?html`
        <div class="anchor-grid"    > 

            <div class="anchor-box"> 
                <div style=" border: 1px solid var(--printess-headlineColor); height: 100%; "> </div>
                </div>
                <div style="grid-area: m_lt;" class="checker ${this.getAnchorTriState(0,0)}" @click=${()=>this.anchorClick(0,0)} ></div>
                <div style="grid-area: m_lm;" class="checker ${this.getAnchorTriState(0,.5)}" @click=${()=>this.anchorClick(0,.5)} ></div>
                <div style="grid-area: m_lb;" class="checker ${this.getAnchorTriState(0,1)}" @click=${()=>this.anchorClick(0,1)} ></div>

                <div style="grid-area: m_ct;" class="checker ${this.getAnchorTriState(.5,0)}" @click=${()=>this.anchorClick(.5,0)} ></div>
                <div style="grid-area: m_cm;" class="checker ${this.getAnchorTriState(.5,.5)}" @click=${()=>this.anchorClick(.5,.5)} ></div>
                <div style="grid-area: m_cb;" class="checker ${this.getAnchorTriState(.5,1)}" @click=${()=>this.anchorClick(.5,1)} ></div>

                <div style="grid-area: m_rt;" class="checker ${this.getAnchorTriState(1,0)}" @click=${()=>this.anchorClick(1,0)} ></div>
                <div style="grid-area: m_rm;" class="checker ${this.getAnchorTriState(1,.5)}" @click=${()=>this.anchorClick(1,.5)} ></div>
                <div style="grid-area: m_rb;" class="checker ${this.getAnchorTriState(1,1)}" @click=${()=>this.anchorClick(1,1)} ></div>

            </div> 
        </div>`:""}               
      </div>
        `:""}getAnchorTriState(e,t){let o=!1,i=!1;const r=this.selection.getValueExtended("simpleText","verticalSimpleTextAlign").value,s=this.selection.getValueExtended("simpleText","horizontalSimpleTextAlign").value;if(null===r||null===s)return eTriState.mixed;switch(r){case"bottom":case"bottomBaseline":o=1===t;break;case"top":o=0===t;break;default:o=.5===t}switch(s){case"right":i=1===e;break;case"center":i=.5===e;break;default:i=0===e}return o&&i?eTriState.on:eTriState.off}anchorClick(e,t){let o="left";.5===e&&(o="center"),1===e&&(o="right");let i="top";.5===t&&(i="center"),1===t&&(i="bottom"),this.selection.setMultipleValues([{feature:"simpleText",property:"horizontalSimpleTextAlign",value:o},{feature:"simpleText",property:"verticalSimpleTextAlign",value:i}])}renderCharSelectorUi(){return __awaiter$t(this,void 0,void 0,(function*(){const e=this.selection.getValueExtended("simpleText","font").value;if(!config.isBuyer&&e){let t=yield hb.Printess.Font.loadFontUnicodesFromUrl(e.font.url);t=t.filter((e=>parseInt(e.substr(e.length-5,4),16)>32));const o="0000"+(this.selection.getValueExtended("simpleText","text").value||" ").charCodeAt(0).toString(16).toUpperCase(),i="&#x"+o.substr(o.length-4)+";";return html`
         <div class="symbols">
            <div style="display: flex; flex-wrap:wrap; " >
                ${t.map((t=>html`<div title="${t}"
                  @click=${()=>{this.setChar(t)}}
                  style="cursor: pointer; padding: 2px; color: ${i===t?"white":"var(--printess-textColor)"}; background-color: ${i===t?"var(--printess-headlineColor)":"var(--printess-panelBackgroundHover)"};  margin: 2px; font-size: 25pt; font-family: ${e.font.cssName}">${unsafeHTML(t)}</div>`))}
            </div> 
        </div>
        `}return""}))}setChar(e){this.selection.setValue("simpleText","text",this.unescape(e))}unescape(t){return e.element.innerHTML=t,e.element.textContent||""}renderStrokeUi(){return this.selection.allows("allowText","stroke")?html`
          <div class="seperator" ></div>
          <wc-length-box  feature="simpleText" property="fontStrokeWidth" .selection=${this.selection}></wc-length-box>
          ${this.hasStrokeUi()?html`
            <wc-color-combo  feature="simpleText" property="fontStrokeColor" .selection=${this.selection}></wc-color-combo>
            <div class="two-cols">
              <wc-select ?icons=${!0} feature="simpleText" property="fontStrokeAlign" .selection=${this.selection}></wc-select>
              <wc-select ?icons=${!0} feature="simpleText" property="fontStrokeJoin" .selection=${this.selection}></wc-select>
            </div>
            <wc-select  feature="simpleText" property="fontStrokeType" .selection=${this.selection}></wc-select>
            ${this.hasStrokeDashUi()?html`
              <wc-number-box mode="both" feature="simpleText" property="fontStrokeDashFactor" .selection=${this.selection}></wc-number-box>
            `:""} 
            ${this.hasStrokeGapUi()?html`
              <wc-number-box mode="both" feature="simpleText" property="fontStrokeGapFactor" .selection=${this.selection}></wc-number-box>
            `:""}
                
          `:""}
        `:""}hasStrokeUi(){const e=this.selection.getValueExtended("simpleText","fontStrokeWidth").value;return!!(e&&e.value>0)}hasStrokeGapUi(){return"solid"!==this.selection.getValueExtended("simpleText","fontStrokeType").value}hasStrokeDashUi(){return"dashed n"===this.selection.getValueExtended("simpleText","fontStrokeType").value}hasDashDistribution(){return"solid"!==this.selection.getValueExtended("simpleText","fontStrokeType").value}renderSectionHead(){return config.isBuyer&&this.selection.allowsAny("allowText")?html`
            <div class="buyer-properties-devider">Single Line Text</div>
       `:""}renderPaddingUi(){return this.selection.hasFeature("simpleText")&&this.selection.allows("allowText","padding")?html`
          <div class="seperator"></div>
          <div class="two-cols">
            <wc-length-box feature="basics" property="paddingLeft" .selection=${this.selection}></wc-length-box>
            <wc-length-box feature="basics" property="paddingRight" .selection=${this.selection}></wc-length-box>
            <wc-length-box feature="basics" property="paddingTop" .selection=${this.selection}></wc-length-box>
            <wc-length-box feature="basics" property="paddingBottom" .selection=${this.selection}></wc-length-box>
          
          </div>
        `:""}render(){const e=this.selection.getValueExtended("simpleText","simpleTextMode").value,t="symbol"===e,o="text"===e,i="barcode"===e;return!this.selection||!this.selection.hasFeature("simpleText")||scope().filterPropertiesBySelectedFeature&&"story"!==this.selectedTool?html``:html`   
                ${this.renderSectionHead()}

               

                ${t?until(this.renderCharSelectorUi(),html`<div class="symbols">Loading Symbols...</div>`):this.renderTextContentUi()}
            
                ${o||t?this.renderFontUi():""} 
                ${i?this.renderBarcodeUi():""} 
                ${t?this.renderSymbolPositionUI():""}
                ${o?this.renderHorizontalAlignmentUi():""}
                ${o?this.renderVerticalAlignmentUi():""}
               
                ${this.renderColorUi()} 
            
                ${o?this.renderFontSizeUi():""}
                ${config.isBuyer?"":html` <wc-checker theme="small" feature="simpleText" property="hasFormField" .selection=${this.selection}></wc-checker>`}
                ${o||t?this.renderPaddingUi():""}
                ${o||t?this.renderStrokeUi():""}  
                ${o?this.renderLetterWidthAndSpacingUi():""}

                ${o?this.renderTextTransformUi():""}
                ${o?this.renderTextBeforeAftertUi():""}

                ${o?html` 
                  <div class="seperator"></div>
                  <vaadin-button  theme="small" @click="${()=>scope().selectionPropertiesUi.setTextMode("multi")}" theme="secondary">
                        <wc-icon icon="text" style="width: 16px; height: 16px" primaryColor="headline" slot="prefix"></wc-icon>
                        Make Multi Line Text
                  </vaadin-button>
                `:""}
            `}};return t.element=document.createElement("div"),__decorate$n([property({attribute:!1,type:Object})],t.prototype,"selection",void 0),__decorate$n([property()],t.prototype,"selectedTool",void 0),t=e=__decorate$n([customElement("wc-selection-simple-text")],t),t})();var __decorate$o=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n};let WcSelectionNewText=(()=>{let e=class extends LitElement{static get styles(){return[desktopPropertyStyles,css`
            :host, :host * {
                box-sizing: border-box;
            }
            :host {
                width: 100%;
                
                position: relative;

            }
            .snippets {
              display: flex;
              flex-direction: row;
              flex-wrap: wrap;
               
            }
            .snippets > div {
              width: 100px;
              height: 100px; 
              margin: 2px;
              background-size: contain;
              background-repeat: no-repeat;
              background-position: center center;
              border: 1px solid #444;
              background-color: white;
              cursor: pointer;

            }
            .snippets > div:hover {
             /* border: 1px solid var(--printess-headlineColor);*/
              /*filter: brightness(115%);*/
              filter: sepia(50%);
            } 
            ul {
                list-style: none;
                width: 100%;
                padding: 0;
                margin: 0;
            }
            li {
                width: 100%;
                padding: 4px;
                background-color: rgba(255,255,255,0.2);
                border: 1px solid  rgba(0,0,0,0.2);
                margin: 3px;
                margin-bottom: 5px;
                cursor: pointer;
                position: relative;
                height: 32px;
                overflow: hidden;
                text-overflow: ellipsis;
             
            }
            li:after {
                position: absolute; 
                right: 9px;
                bottom: 9px;
                top: 9px;
                content: '+';
                line-height: 14px;
                text-align: center;
                height: 14px;
                width: 14px;
                font-size: 17px;
                color: white;
                background-color: var(--printess-headlineColor);
            }
            li:hover {
                background-color: rgba(255,255,255,1);
              
                
            }
            .qrcode {
              padding-left: 6px;
              width: 80px;
              height: 80px;
              padding-top: 6px;
            }
            `]}renderSnippetsUi(){return this.selection.allows("allowAdd","text")?html`               
  <div class="snippets">
  
  <div style="background-color: white; font-size: 14pt; text-align: center; line-height: 100px;" @click=${()=>scope().selectionPropertiesUi.addSimpleText("text")}>
    Single Line
  </div>
  <div style="background-color: white; padding: 5px;" @click=${()=>scope().selectionPropertiesUi.addStory()}>
    Multi Line Text Lorem ipsum dolor sit, amet elit adipiscing.
  </div>
  <div style="background-color: white; padding: 5px; font-size: 54pt; text-align: center; font-family: PrintessSummer; line-height: 100px;" @click=${()=>scope().selectionPropertiesUi.addSimpleText("symbol")}>
   &#xE909;
  </div>
  <div style="background-color: white; padding: 5px;" @click=${()=>scope().selectionPropertiesUi.addSimpleText("barcode")}>
    <svg class="qrcode" viewBox="0 0 32 32"
      xmlns="http://www.w3.org/2000/svg" version="1.1">
      <g  fill="none" stroke="#555" stroke-width="2" stroke-linecap="butt">
        <path id="A" d="M3,3 h8 v8 h-8 v-8 z M6,7 h2"/>
        <use xlink:href="#A" x="18" y="0" />
        <use xlink:href="#A" x="0" y="18" />
        <path d="M18,3 h-3 v4 h2 v4 h-2 v3" />
        <path d="M2,15 h2 m2,0 h4 m6,0 h2 m2,0 h4 m4,0 h2"/>
        <path d="M4,17 h2 m2,0 h8 m6,0 h2 m2,0 h4" />
        <path d="M14,19 h2 m2,0 h2 m6,0 h2" />
        <path d="M16,21 h2 m2,0 h8"/> 
        <path d="M14,23 h2 m2,0 h2 m4,0 h2 m2,0 h2" />
        <path d="M14,25 h4 m2,0 h2 m2, 0 h4" />
        <path d="M14,27 h2 m6,0 h2 m4,0 h2" />
        <path d="M16,29 h8 m2,0 h2"/>
      </g>
  </svg>

  </div>
    
  </div>
`:""}renderNewHeadUi(){return this.selection.allows("allowAdd","text")||this.selection.allows("allowAdd","warpText")?html`
                <div class="buyer-properties-devider">Create Text</div>
                ${config.isBuyer?"":html`<p>To create a text, draw a new frame on the page or click on a text type below:</p>`}
               `:""}render(){const e=1===this.selection.count()&&!this.selection.hasFeature("simpleText")&&!this.selection.hasFeature("storyRef");return!this.selection||this.selection.hasSelection()&&!e||scope().filterPropertiesBySelectedFeature&&"story"!==this.selectedTool?html``:html` 
               
            ${this.renderNewHeadUi()}
        
            
            ${this.renderSnippetsUi()}
                `}getTextStyles(){const e=[];if(scope())for(const t of scope().styles_all)for(const o of t.getTextStyles())e.push(o);return e}};return __decorate$o([property({attribute:!1,type:Object})],e.prototype,"selection",void 0),__decorate$o([property()],e.prototype,"selectedTool",void 0),e=__decorate$o([customElement("wc-selection-new-text")],e),e})();var __decorate$p=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n};let WcSelect$1=(()=>{let e=class extends LitElement{constructor(){super(...arguments),this.feature="transform",this.selection=null,this.property=null}get items(){if("meshOmits"===this.property)return[{value:"image",label:"Image",icon:"image"},{value:"path",label:"Shape",icon:"shapes"},{value:"text",label:"Text",icon:"text"},{value:"subdoc",label:"Sub-Doc",icon:"address-card"}];if("bevelOmits"===this.property)return[{value:"path",label:"Shape",icon:"shapes"},{value:"text",label:"Text",icon:"text"},{value:"ptxt",label:"Text on path",icon:"pathText"}];if("warpArchOmits"===this.property)return[{value:"image",label:"Image",icon:"image"},{value:"path",label:"Shape",icon:"shapes"},{value:"text",label:"Text",icon:"text"},{value:"ptxt",label:"Text on path",icon:"pathText"},{value:"subdoc",label:"Sub-Doc",icon:"address-card"}];{const e=[{value:"image",label:"Transform Image",icon:"image"},{value:"path",label:"Transform Shape",icon:"shapes"},{value:"text",label:"Transform Text",icon:"text"},{value:"ptxt",label:"Transform Text on path",icon:"pathText"}];return"transform"===this.feature&&e.push({value:"subdoc",label:"Sub-Doc",icon:"address-card"}),e}}static get styles(){return css`
            :host, :host * {
                box-sizing: border-box;
            }

            :host {
                display: flex;
                flex-direction: column;
            }

            .icons-wrapper {
                display: flex;
                flex-direction: row;
                flex-wrap: wrap;
                width: 100%;
                min-height: 32px;
                align-items: flex-start;
                padding-top: 4px;
                justify-content: flex-end;

            }
            .icons {
                display: grid;
                grid-template-rows: 24;
                justify-content: flex-start;
                align-items: center;
                grid-column-gap: 4px;
            }
            .icon-wrapper {
                padding: 2px; 
                border: 1px solid var(--printess-textColor);
                border-radius: 3px;
            }
            .icon-wrapper:hover {
                background-color: white;
            }
            .icons-label {
                padding-right: 4px;
               
                padding-bottom: 4px;
                width: 100%; /* remove this, for 2 column layout */
            }
            wc-icon {
                width: 18px;
                height: 18px;
            }
        `}render(){return html`
<div class="icons-wrapper" >
   
    <div class="icons" style="grid-template-columns: repeat(${this.items.length}, 24px);">
        ${this.items.map((e=>html`<div class="icon-wrapper" title="${e.label}" 
                    @click=${()=>this.toggleValue(e.value)}
                    style="opacity: ${this.uiDisabled(e.value)?"0.4":"1"}; border-color: ${this.isSelected(e.value)?"var(--printess-headlineColor)":"var(--printess-textColor)"}; background-color: ${this.isSelected(e.value)?"var(--printess-panelBackgroundSelected)":"transparent"};">
                <wc-icon  
                    primaryColor="${this.isSelected(e.value)?"headline":"text"}" 
                    icon="${e.icon||"empty"}" 
                ></wc-icon></div>`))}
    </div>
</div>
            `}iconClick(e){alert(e)}isSelected(e){let t=this.uiValue;return t||(t=""),-1===t.indexOf(e)}uiDisabled(e){return!!isInactive(this.extendedValue)||(!this.selection||!this.hasFeature(e))}hasFeature(e){let t;switch(e){case"image":t="imageRef";break;case"path":t="pathGeometry";break;case"text":t="simpleText";break;case"ptxt":t="pathText";break;case"subdoc":t="docRef"}if(this.selection){if(this.selection.hasFeature(t))return!0;const e=this.selection.getSingleSelection();if(e&&e.box.getFeature(t))return!0}return!1}get uiLabel(){return augmentLabel("Exclude",this.extendedValue)}get extendedValue(){if(this.selection&&this.property)return this.selection.getValueExtended(this.feature,this.property);throw new Error("wcOmitTransformSelect, no selection, property or feature")}get uiValue(){if(this.selection&&this.property)return this.selection.getValueExtended(this.feature,this.property).value;throw new Error("wcOmitTransformSelect, no selection, property or feature")}set uiValue(e){null!=e&&e!==this.uiValue&&this.selection&&this.property&&this.selection.setValue(this.feature,this.property,e)}toggleValue(e){if(this.uiDisabled(e))return;let t=this.uiValue;if(t||(t=""),t.indexOf(e)>=0){const o=new RegExp("(^"+e+"[, |]*|[, |]*"+e+")","gi");t=t.replace(o,"")}else t?t+=","+e:t=e;this.uiValue=t,super.requestUpdate()}};return __decorate$p([property()],e.prototype,"feature",void 0),__decorate$p([property({attribute:!1,type:Object})],e.prototype,"selection",void 0),__decorate$p([property()],e.prototype,"property",void 0),e=__decorate$p([customElement("wc-omit-transform-select")],e),e})();var __decorate$q=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n};let WcSelectionTransform=(()=>{let e=class extends LitElement{static get styles(){return[desktopPropertyStyles,css`
            :host {
                box-sizing: border-box;
                display: block;
            }
            
            .transform {
                margin: -4px;
                margin-bottom: 10px;
                padding: 5px;
            }
            .transform > * {
              margin-bottom: 7px;
            }
            .transform.selected {
                border: 2px solid white;
            }
        `]}renderPerspectiveUi(){return this.selection.allows("allowTransform","perspective")?html`
    <div class="transform ${!0===this.selection.getValueExtended("transform","perspectiveActive").value?"selected":""}">
      <wc-checker feature="transform" property="perspectiveActive" .selection=${this.selection} ></wc-checker>
      ${!0===this.selection.getValueExtended("transform","perspectiveActive").value?html`
        ${scope().perspectiveEditorActive()?html`
            <vaadin-button  theme="small" @click="${()=>scope().closePerspectiveEditor()}" theme="secondary">
                <wc-icon icon="close-square"  style="width: 16px; height: 16px" primaryColor="headline"  slot="prefix"></wc-icon>
                Close Editor
            </vaadin-button>
          `:html`
            <vaadin-button theme="small"   @click="${()=>scope().showPerspectiveEditor()}" theme="secondary">
            <wc-icon icon="pen" style="width: 16px; height: 16px" primaryColor="headline"  slot="prefix"></wc-icon>
            Edit Grid
            </vaadin-button>
          `}
          <wc-omit-transform-select .selection=${this.selection} property="perspectiveOmits" ></wc-omit-transform-select>
      `:""}
    </div>
    `:""}renderMeshUi(){return this.selection.allows("allowTransform","mesh")?html`
      <div class="transform ${!0===this.selection.getValueExtended("transform","meshActive").value?"selected":""}">
        <wc-checker feature="transform" property="meshActive" .selection=${this.selection} ></wc-checker>
        ${!0===this.selection.getValueExtended("transform","meshActive").value?html`  
          ${scope().meshEditorActive()?html`
              <vaadin-button theme="small" @click="${()=>scope().closeMeshEditor()}" theme="secondary">
                  <wc-icon icon="close-square"  style="width: 16px; height: 16px" primaryColor="headline"  slot="prefix"></wc-icon>
                  Close Editor
              </vaadin-button>
              <wc-number-box updateWcBox feature="transform" property="meshColumns" .selection=${this.selection}></wc-number-box>
              <wc-number-box updateWcBox feature="transform" property="meshRows" .selection=${this.selection}></wc-number-box>
              <div class="seperator"></div>
             <!-- <div class="two-cols">
                <wc-length-box feature="basics" property="paddingLeft" .selection=${this.selection}></wc-length-box>
                <wc-length-box feature="basics" property="paddingRight" .selection=${this.selection}></wc-length-box>
                <wc-length-box feature="basics" property="paddingTop" .selection=${this.selection}></wc-length-box>
                <wc-length-box feature="basics" property="paddingBottom" .selection=${this.selection}></wc-length-box>
              </div>-->
              <div class="seperator"></div>
              <vaadin-checkbox theme="small" ?checked=${scope().meshEditor.snapToGrid}
                    @checked-changed=${e=>scope().meshEditor.snapToGrid=!!e.target.checked}
                    >Snap to grid lines</vaadin-checkbox>
              <h5>Tip:</h5>
              <p>Select point(s) and press ...</p>
              <p><b>R</b> to select a row of points</p>
              <p><b>C</b> to select a column of points</p>
                  
                    
          `:html`
              <vaadin-button theme="small"   @click="${()=>scope().showMeshEditor()}" theme="secondary">
                <wc-icon icon="pen"  style="width: 16px; height: 16px" primaryColor="headline" slot="prefix"></wc-icon>
                Edit Grid
              </vaadin-button>
              
          `}
          <wc-omit-transform-select .selection=${this.selection} property="meshOmits" ></wc-omit-transform-select>
        `:""}
      </div>
      `:""}renderDistortUi(){return this.selection.allows("allowTransform","distort")?html`
      <div class="transform ${!0===this.selection.getValueExtended("transform","distortActive").value?"selected":""}">
          <wc-checker feature="transform" property="distortActive" .selection=${this.selection} ></wc-checker>
          ${!0===this.selection.getValueExtended("transform","distortActive").value?html`

            <wc-number-box feature="transform" property="distortFrequency" .selection=${this.selection}></wc-number-box>
            <wc-number-box feature="transform" property="distortOctaves" .selection=${this.selection}></wc-number-box>
            <wc-number-box feature="transform" property="distortScale" .selection=${this.selection}></wc-number-box>
            
            <wc-omit-transform-select feature="transform" .selection=${this.selection} property="distortOmits" ></wc-omit-transform-select>
        `:""}
      </div>
      `:""}renderArchUi(){return this.selection.allows("allowTransform","arch")?html`
      <div class="transform ${!0===this.selection.getValueExtended("transform","warpArchActive").value?"selected":""}">
        <wc-checker feature="transform" property="warpArchActive" .selection=${this.selection} ></wc-checker>
        ${!0===this.selection.getValueExtended("transform","warpArchActive").value?html`
            <wc-number-box feature="transform" property="warpArchPhi" .selection=${this.selection}></wc-number-box>

            <div class="two-cols">
              <wc-select feature="transform" property="warpArchPosition" .selection=${this.selection}></wc-select>
              <wc-select feature="transform" property="warpArchMirror" .selection=${this.selection}></wc-select>
            </div>

            <wc-omit-transform-select .selection=${this.selection} property="warpArchOmits" ></wc-omit-transform-select>
            
        `:""}
      </div>
    `:""}renderPitUi(){return this.selection.allows("allowTransform","pit")?html`
      <div class="transform ${!0===this.selection.getValueExtended("transform","warpPitActive").value?"selected":""}">
        <wc-checker feature="transform" property="warpPitActive" .selection=${this.selection} ></wc-checker>
        ${!0===this.selection.getValueExtended("transform","warpPitActive").value?html`
            <wc-select .icons="${!0}" feature="transform" property="warpPitPosition" .selection=${this.selection}></wc-select>
            <wc-number-box feature="transform" property="warpPitHeightFraction" .selection=${this.selection}></wc-number-box>
            <wc-omit-transform-select .selection=${this.selection} property="warpPitOmits" ></wc-omit-transform-select>
        `:""}
      </div>
      `:""}renderArcUi(){return this.selection.allows("allowTransform","arc")?html`
      <div class="transform ${!0===this.selection.getValueExtended("transform","warpArcActive").value?"selected":""}">
        <wc-checker feature="transform" property="warpArcActive" .selection=${this.selection} ></wc-checker>
        ${!0===this.selection.getValueExtended("transform","warpArcActive").value?html`
            <wc-select feature="transform" property="warpArcPosition" .selection=${this.selection}></wc-select>
            <wc-number-box feature="transform" property="warpArcHeightFraction" .selection=${this.selection}></wc-number-box>
            <wc-omit-transform-select .selection=${this.selection} property="warpArcOmits" ></wc-omit-transform-select>
        `:""}
      </div>
      `:""}renderCupUi(){return this.selection.allows("allowTransform","cup")?html`
      <div class="transform ${!0===this.selection.getValueExtended("transform","warpCupActive").value?"selected":""}">
        <wc-checker feature="transform" property="warpCupActive" .selection=${this.selection} ></wc-checker>
        ${!0===this.selection.getValueExtended("transform","warpCupActive").value?html`
          <wc-number-box feature="transform" property="warpCupPhi" .selection=${this.selection}></wc-number-box>
          <wc-number-box feature="transform" property="warpCupY" .selection=${this.selection}></wc-number-box>
          <wc-omit-transform-select .selection=${this.selection} property="warpCupOmits" ></wc-omit-transform-select>
        `:""}
      </div>
      `:""}renderFlagUi(){return this.selection.allows("allowTransform","flag")?html`
      <div class="transform ${!0===this.selection.getValueExtended("transform","warpFlagActive").value?"selected":""}">
        <wc-checker feature="transform" property="warpFlagActive" .selection=${this.selection} ></wc-checker>
        ${!0===this.selection.getValueExtended("transform","warpFlagActive").value?html`
          <wc-number-box feature="transform" property="warpFlagHeightFraction" .selection=${this.selection}></wc-number-box>
          <wc-number-box feature="transform" property="warpFlagWaves" .selection=${this.selection}></wc-number-box>
          <wc-number-box feature="transform" property="warpFlagPhase" .selection=${this.selection}></wc-number-box>
          <wc-omit-transform-select .selection=${this.selection} property="warpFlagOmits" ></wc-omit-transform-select>
        `:""}
      </div>
      `:""}renderFishUi(){return this.selection.allows("allowTransform","fish")?html`
      <div class="transform ${!0===this.selection.getValueExtended("transform","warpFishActive").value?"selected":""}">
        <wc-checker feature="transform" property="warpFishActive" .selection=${this.selection} ></wc-checker>
        ${!0===this.selection.getValueExtended("transform","warpFishActive").value?html`
            <wc-number-box feature="transform" property="warpFishHeightFraction" .selection=${this.selection}></wc-number-box>
            <wc-number-box feature="transform" property="warpFishWaves" .selection=${this.selection}></wc-number-box>
            <wc-omit-transform-select .selection=${this.selection} property="warpFishOmits" ></wc-omit-transform-select>
        `:""}
      </div>
      `:""}renderCustomUi(){return config.isBuyer?"":html`
      <div class="transform ${!0===this.selection.getValueExtended("transform","warpCustomActive").value?"selected":""}">
        <wc-checker feature="transform" property="warpCustomActive" .selection=${this.selection} ></wc-checker>
        ${!0===this.selection.getValueExtended("transform","warpCustomActive").value?html`
                
            <wc-select feature="transform" property="warpCustomTopTransform" .selection=${this.selection}></wc-select>

            ${this.needsTopWaveControl?html`<wc-number-box feature="transform" property="warpCustomTopWaves" .selection=${this.selection}></wc-number-box>
                          <wc-number-box feature="transform" property="warpCustomTopPhase" .selection=${this.selection}></wc-number-box>`:""}

            ${"none"!==this.selection.getValueExtended("transform","warpCustomTopTransform").value?html`<wc-number-box feature="transform" property="warpCustomTopHeightFraction" .selection=${this.selection}></wc-number-box>`:""}

            <div class="seperator"></div>
            <wc-select feature="transform" property="warpCustomBottomTransform" .selection=${this.selection}></wc-select>

            ${this.needsBottomWaveControl?html`<wc-number-box feature="transform" property="warpCustomBottomWaves" .selection=${this.selection}></wc-number-box>
                          <wc-number-box feature="transform" property="warpCustomBottomPhase" .selection=${this.selection}></wc-number-box>`:""}

            ${"none"!==this.selection.getValueExtended("transform","warpCustomBottomTransform").value?html`<wc-number-box feature="transform" property="warpCustomBottomHeightFraction" .selection=${this.selection}></wc-number-box>`:""}
                <wc-omit-transform-select .selection=${this.selection} property="warpCustomOmits" ></wc-omit-transform-select>
        `:""}
      </div>
      `}render(){return!this.selection||!(this.selection.boxes.size>0||scope().perspectiveEditorActive()||scope().meshEditorActive())||scope().filterPropertiesBySelectedFeature&&"transform"!==this.selectedTool?"transform"!==this.selectedTool||config.isBuyer?html``:html`<h3 style="margin-top: 50px;">Please select a frame to add transformations.</h3>`:this.selection.hasFeature("transform")?html`   

            ${config.isBuyer||this.selection.hasFeature("simpleText")||this.selection.hasFeature("pathGeometry")||this.selection.hasFeature("pathText")||this.selection.hasFeature("imageRef")?"":html`<p  style="color: red; margin: 10px;">This frame has no content wich supports transform!<br>Must have either Warp-Text, Shape, Text-On-Path or Image.</p>`}

            ${this.renderPerspectiveUi()}
            ${this.renderMeshUi()}
            ${this.renderDistortUi()}
            
            ${this.renderArchUi()}
            ${this.renderPitUi()}
            ${this.renderArcUi()}
            ${this.renderCupUi()}
            ${this.renderFlagUi()}
            ${this.renderFishUi()}
            ${this.renderCustomUi()}

            ${!config.isBuyer&&this.selection.hasFeature("simpleText")?html`
              <div class="seperator"></div>
              <p>Text Alignment:</p>
              <wc-select icons feature="simpleText" property="verticalSimpleTextAlign" .selection=${this.selection}></wc-select>
              <div class="two-cols">
                <wc-length-box feature="basics" property="paddingLeft" .selection=${this.selection}></wc-length-box>
                <wc-length-box feature="basics" property="paddingRight" .selection=${this.selection}></wc-length-box>
                <wc-length-box feature="basics" property="paddingTop" .selection=${this.selection}></wc-length-box>
                <wc-length-box feature="basics" property="paddingBottom" .selection=${this.selection}></wc-length-box>
              </div>
              `:""}
      
`:html`
                    <vaadin-button theme="small"   @click="${()=>scope().selectionPropertiesUi.addNewFeature()}" theme="secondary">
                    <wc-icon icon="warp-arc"  style="width: 16px; height: 16px" primaryColor="headline"  slot="prefix"></wc-icon>
                    Add Transformation
                    </vaadin-button>
                    `}needsWaves(e){return"sine"===e||"cosine"===e}get needsTopWaveControl(){return!!this.selection&&this.needsWaves(this.selection.getValueExtended("transform","warpCustomTopTransform").value)}get needsBottomWaveControl(){return!!this.selection&&this.needsWaves(this.selection.getValueExtended("transform","warpCustomBottomTransform").value)}};return __decorate$q([property({attribute:!1,type:Object})],e.prototype,"selection",void 0),__decorate$q([property()],e.prototype,"selectedTool",void 0),e=__decorate$q([customElement("wc-selection-transform")],e),e})();var __decorate$r=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n};let WcCircleControl=(()=>{let e=class extends LitElement{constructor(){super(...arguments),this.mode="xy",this.angle=0,this.x=0,this.y=0,this.radius=18,this.preview=null,this.callback=null,this.arcAngle=0,this.length=0,this.cx=0,this.cy=0,this.uponce=e=>{document.removeEventListener("mouseup",this.uponce),document.removeEventListener("mousemove",this.move),this.callback&&this.callback(this.cx,this.cy)},this.move=e=>{e.preventDefault();const t=this.positionInCircle(e);this.setMarker(t.x,t.y),this.requestUpdate()}}static get styles(){return css`
            :host, :host * {
                box-sizing: border-box;
            }

            .kreis {
                border: 1px solid #999;
                position: absolute;
                pointer-events: none;
                width:  90%;
                height: 90%;
                left: 5%;
                top: 5%;
                 
                border-radius: 50%;
            }
            .circle {
                cursor: pointer;
                width: 200px;
                height: 200px;
                position: relative;
            }
    
            .center {
                pointer-events: none;
                position: absolute;
                width: 5px;
                height: 5px;
                border-radius: 50%;
                background-color:white;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
            }
    
            .marker {
                cursor: pointer;
                pointer-events: none;
                position: absolute;
                width: 6%;
                height: 6%;
                border-radius: 50%;
                background-color: var(--printess-headlineColor); /*rgb(22, 118, 243);*/
                left: 0;
                top: 0;
                transform: translate(-50%, -50%);
            }
    
            .zeiger {
                pointer-events: none;
                background-color: #999;
                height: 1px;
                width: 130px;
                transform-origin: 0% 0%;
                top: 50%;
                left: 50%;
                position: absolute;
            }
        `}update(e){(e.has("x")||e.has("y"))&&this.setMarker(this.x,this.y),super.update(e)}render(){return html`
<div class="circle" style="width: ${2*this.radius}px; height: ${2*this.radius}px;" @mousedown=${this.down}>
    <div class="kreis"></div>
    <div class="zeiger" style="transform: rotate(${this.arcAngle}deg); width: ${this.length*this.radius}px;"></div>
    <div class="marker"  style="left: ${this.cx*this.radius+this.radius}px; top:${this.cy*this.radius+this.radius}px; width:9px; height: 9px;"> </div>  
</div>
        `}down(e){e.preventDefault(),document.addEventListener("mousemove",this.move),document.addEventListener("mouseup",this.uponce),this.move(e)}setMarker(e,t){let o=0;0!==e&&(o=t/e);let i=Math.atan(o),r=i*(180/Math.PI);e<0&&(r+=180),i=r/(180/Math.PI),e>=0&&t<0&&(r=360-Math.abs(r));let s=Math.sqrt(e*e+t*t);s=Math.min(s,1),this.length=s,this.arcAngle=r,this.cx=s*Math.cos(i),this.cy=s*Math.sin(i)}positionInCircle(e){const t=e.clientX,o=e.clientY;if(this.shadowRoot){const e=this.shadowRoot.querySelector(".circle");if(e){const i=e.getBoundingClientRect();let r=t-i.left-this.radius,s=o-i.top-this.radius;return r/=this.radius,s/=this.radius,{x:Math.max(Math.min(r,1),-1),y:Math.max(Math.min(s,1),-1)}}}throw new Error("Circle Control, cant find circle div")}};return __decorate$r([property({type:String})],e.prototype,"mode",void 0),__decorate$r([property({type:Number})],e.prototype,"angle",void 0),__decorate$r([property({type:Number})],e.prototype,"x",void 0),__decorate$r([property({type:Number})],e.prototype,"y",void 0),__decorate$r([property({type:Number})],e.prototype,"radius",void 0),__decorate$r([property({attribute:!1})],e.prototype,"preview",void 0),__decorate$r([property({attribute:!1})],e.prototype,"callback",void 0),e=__decorate$r([customElement("wc-circle-control")],e),e})();var __decorate$s=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n};const range=25;let WcCircleLengthControl=(()=>{let e=class extends LitElement{constructor(){super(...arguments),this.radius=18,this.selection=null,this.propertyX=null,this.propertyY=null,this.arcAngle=0,this.length=0,this.cx=0,this.cy=0,this.uponce=e=>{document.removeEventListener("mouseup",this.uponce),document.removeEventListener("mousemove",this.move),this.selection&&this.propertyX&&this.propertyY&&this.feature&&this.selection.setMultipleValues([{feature:this.feature,property:this.propertyX,value:new Length(Math.round(25*this.cx),"%")},{feature:this.feature,property:this.propertyY,value:new Length(Math.round(25*this.cy),"%")}])},this.move=e=>{e.preventDefault();const t=this.positionInCircle(e);this.setMarker(t.x,t.y),this.requestUpdate()}}get x(){if(this.selection&&this.propertyX&&this.feature){const e=this.selection.getValueExtended(this.feature,this.propertyX).value;if(null!==e&&"%"===e.unit)return e.value/25}return 0}get y(){if(this.selection&&this.propertyY&&this.feature){const e=this.selection.getValueExtended(this.feature,this.propertyY).value;if(e&&"%"===e.unit)return e.value/25}return 0}static get styles(){return css`
            :host, :host * {
                box-sizing: border-box;
            }

            .kreis {
                border: 1px solid #999;
                position: absolute;
                pointer-events: none;
                width:  90%;
                height: 90%;
                left: 5%;
                top: 5%;
                 
                border-radius: 50%;
            }
            .circle {
                cursor: pointer;
                width: 200px;
                height: 200px;
                position: relative;
            }
    
            .center {
                pointer-events: none;
                position: absolute;
                width: 5px;
                height: 5px;
                border-radius: 50%;
                background-color:white;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
            }
    
            .marker {
                cursor: pointer;
                pointer-events: none;
                position: absolute;
                width: 2%;
                height: 2%;
                border-radius: 50%;
                background-color: var(--printess-headlineColor); /*rgb(22, 118, 243);*/
                left: 0;
                top: 0;
                transform: translate(-50%, -50%);
            }
    
            .zeiger {
                pointer-events: none;
                background-color: #999;
                height: 1px;
                width: 130px;
                transform-origin: 0% 0%;
                top: 50%;
                left: 50%;
                position: absolute;
            }
        `}updated(e){e.has("selection")&&(this.setMarker(this.x,this.y),this.requestUpdate())}render(){return html`
<div class="circle" style="width: ${2*this.radius}px; height: ${2*this.radius}px;" @mousedown=${this.down}>
    <div class="kreis"></div>
    <div class="zeiger" style="transform: rotate(${this.arcAngle}deg); width: ${this.length*this.radius}px;"></div>
    <div class="marker"  style="left: ${this.cx*this.radius+this.radius}px; top:${this.cy*this.radius+this.radius}px; width: 9px; height: 9px;"> </div>  
</div>
        `}down(e){e.preventDefault(),document.addEventListener("mousemove",this.move),document.addEventListener("mouseup",this.uponce),this.move(e)}setMarker(e,t){let o=0;0!==e&&(o=t/e);let i=Math.atan(o),r=i*(180/Math.PI);e<0&&(r+=180),i=r/(180/Math.PI),e>=0&&t<0&&(r=360-Math.abs(r));let s=Math.sqrt(e*e+t*t);s=Math.min(s,1),this.length=s,this.arcAngle=r,this.cx=s*Math.cos(i),this.cy=s*Math.sin(i)}positionInCircle(e){const t=e.clientX,o=e.clientY;if(this.shadowRoot){const e=this.shadowRoot.querySelector(".circle");if(e){const i=e.getBoundingClientRect();let r=t-i.left-this.radius,s=o-i.top-this.radius;return r/=this.radius,s/=this.radius,{x:Math.max(Math.min(r,1),-1),y:Math.max(Math.min(s,1),-1)}}}throw new Error("Circle Control, cant find circle div")}};return __decorate$s([property({type:Number})],e.prototype,"radius",void 0),__decorate$s([property({attribute:!1,type:Object})],e.prototype,"selection",void 0),__decorate$s([property({type:String})],e.prototype,"feature",void 0),__decorate$s([property({type:String})],e.prototype,"propertyX",void 0),__decorate$s([property({type:String})],e.prototype,"propertyY",void 0),e=__decorate$s([customElement("wc-circle-length-control")],e),e})();var __decorate$t=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n};let WcSelectionEffect=(()=>{let e=class extends LitElement{static get styles(){return[desktopPropertyStyles,css`
            :host {
                box-sizing: border-box;
                display: block;
            }
            p {
                margin-top: 15px;
                margin-bottom: 0;
            }
            hr {
                border-width: 2px;  
                margin-bottom: 10px;
            }
            .transform {       
                margin: -4px;
                margin-bottom: 10px;
                padding: 5px;
            }
            .transform.selected {
                border: 2px solid white;
            }`]}renderBlurUi(){return this.selection.allows("allowEffect","blur")?html`
        <div class="transform ${!0===this.selection.getValueExtended("effect","blurActive").value?"selected":""}">
        ${this.controlledByStyle("blurActive",html`
          <wc-checker feature="effect" property="blurActive" .selection=${this.selection} ></wc-checker>
          ${!0===this.selection.getValueExtended("effect","blurActive").value?html`
              <wc-number-box feature="effect" property="blurIntensity" .selection=${this.selection}></wc-number-box>
              <wc-omit-transform-select  feature="effect" .selection=${this.selection} property="blurOmits" ></wc-omit-transform-select>     
          `:""}
        `)}
        </div>
        `:""}renderMaskUi(){const e=this.selection.getValueExtended("effect","maskImage").value;let t="background-image: none;";return e&&(t="background-image: "+e.thumbNailCssUrl()+";"),this.selection.allows("allowEffect","mask")?html`
        <div class="transform ${!0===this.selection.getValueExtended("effect","maskActive").value?"selected":""}">
        ${this.controlledByStyle("turbulenceActive",html`
          <wc-checker feature="effect" property="maskActive" .selection=${this.selection} ></wc-checker>
          ${!0===this.selection.getValueExtended("effect","maskActive").value?html`
            <div class="two-cols">
              <p>Mask-Image:</p>
              <div @click=${()=>this.openMaskImageDialog()} style=" width: 70px; height: 70px; background-color: gray; cursor: pointer; background-repeat: no-repeat; background-position: 50% 50%; background-size: contain; ${t}"></div>
            </div>
             <wc-select  style="margin-bottom: 5px;" feature="effect" property="maskChannel" .selection=${this.selection} ></wc-select> 
             <wc-checker style="margin-bottom: 5px;" theme="small" feature="effect" property="maskInverse" .selection=${this.selection} ></wc-checker>
            
              <wc-omit-transform-select  feature="effect" .selection=${this.selection} property="maskOmits" ></wc-omit-transform-select>     
          `:""}
        `)}
        </div>
        `:""}openMaskImageDialog(){new WcSelectImageDialog("effect-mask").showDialog()}renderBlendUi(){return this.selection.allows("allowEffect","blend")?html`
              <wc-select feature="effect" property="blendMode" .selection=${this.selection}></wc-select>`:""}renderOpacityUi(){return this.selection.allows("allowEffect","opacity")?html`
            <wc-number-box feature="effect" property="opacity" .selection=${this.selection}></wc-number-box>`:""}renderTurbulenceUi(){return this.selection.allows("allowEffect","turbulence")?html`
        <div class="transform ${!0===this.selection.getValueExtended("effect","turbulenceActive").value?"selected":""}">
        ${this.controlledByStyle("turbulenceActive",html`
            <wc-checker feature="effect" property="turbulenceActive" .selection=${this.selection} ></wc-checker>
            ${!0===this.selection.getValueExtended("effect","turbulenceActive").value?html`

              <wc-number-box feature="effect" property="turbulenceFrequency" .selection=${this.selection}></wc-number-box>
              <wc-number-box feature="effect" property="turbulenceOctaves" .selection=${this.selection}></wc-number-box>
              <wc-number-box feature="effect" property="turbulenceScale" .selection=${this.selection}></wc-number-box>
              
              <wc-omit-transform-select feature="effect" .selection=${this.selection} property="turbulenceOmits" ></wc-omit-transform-select>
          `:""}
        `)}
        </div>
        `:""}renderBevelUi(){return""}controlledByStyle(e,t){const o=this.selection.getValueExtended("effect",e),i=WcChecker.getLabel(e);return"class"===o.origin?html`<h5 ">${i}</h5><p style="margin-top: 5px;">Controlled by Style: [${o.selector}]</p>`:t}renderDropShadowUi(){return this.selection.allows("allowEffect","dropShadow")?html`
        <div class="transform ${!0===this.selection.getValueExtended("effect","dropActive").value?"selected":""}">
          ${this.controlledByStyle("dropActive",html`
            <wc-checker feature="effect" property="dropActive" .selection=${this.selection} ></wc-checker>
            ${!0===this.selection.getValueExtended("effect","dropActive").value?html`
              <div class="two-cols uneven" style="margin-top: 10px">
                <wc-circle-length-control radius="36" .selection=${this.selection} feature="effect" propertyX="dropXoffset" propertyY="dropYoffset"  ></wc-circle-length-control>
                <div class="two-cols">
                  <wc-length-box .slider=${!0} feature="effect" property="dropXoffset" .selection=${this.selection}></wc-length-box>
                  <wc-length-box .slider=${!0} feature="effect" property="dropYoffset" .selection=${this.selection}></wc-length-box>
                </div>
              </div>
              
              <div class="two-cols">
                <wc-length-box .updateWcBox=${!0} feature="effect" property="dropBlurRadius" .selection=${this.selection}></wc-length-box>
                <wc-length-box .updateWcBox=${!0} feature="effect" property="dropSpreadRadius" .selection=${this.selection}></wc-length-box>
              </div>
              <wc-select feature="effect" property="dropBlend" .selection=${this.selection}></wc-select>
              <wc-color-combo feature="effect" property="dropColor" .selection=${this.selection}></wc-color-combo>
            
              <wc-omit-transform-select feature="effect" .selection=${this.selection} property="dropOmits" ></wc-omit-transform-select>
            `:""}
         `)}
      </div>
        `:""}renderOuterGlowUi(){return this.selection.allows("allowEffect","outGlow")?html`
        <div class="transform ${!0===this.selection.getValueExtended("effect","outGlowActive").value?"selected":""}">
        ${this.controlledByStyle("outGlowActive",html`
          <wc-checker feature="effect" property="outGlowActive" .selection=${this.selection} ></wc-checker>
          ${!0===this.selection.getValueExtended("effect","outGlowActive").value?html`

          <div class="two-cols uneven" style="margin-top: 10px">
            <wc-circle-length-control radius="36" .selection=${this.selection} feature="effect" propertyX="outGlowXoffset" propertyY="outGlowYoffset"  ></wc-circle-length-control>
            <div class="two-cols">
              <wc-length-box .slider=${!0} feature="effect" property="outGlowXoffset" .selection=${this.selection}></wc-length-box>
              <wc-length-box   .slider=${!0} feature="effect" property="outGlowYoffset" .selection=${this.selection}></wc-length-box>
            </div>
          </div>
          
          <div class="two-cols">
            <wc-length-box .updateWcBox=${!0}  feature="effect" property="outGlowBlurRadius" .selection=${this.selection}></wc-length-box>
            <wc-length-box .updateWcBox=${!0}  feature="effect" property="outGlowSpreadRadius" .selection=${this.selection}></wc-length-box>
          </div>
          <wc-select feature="effect" property="outGlowBlend" .selection=${this.selection}></wc-select>
          <wc-color-combo feature="effect" property="outGlowColor" .selection=${this.selection}></wc-color-combo>
          
          <wc-omit-transform-select feature="effect" .selection=${this.selection} property="outGlowOmits" ></wc-omit-transform-select>
        `:""}
      `)}
      </div>
  `:""}renderStrokeUi(){return this.selection.allows("allowEffect","stroke")?html`
      
      <div class="transform ${!0===this.selection.getValueExtended("effect","strokeActive").value?"selected":""}">
        ${this.controlledByStyle("strokeActive",html`  
          <wc-checker feature="effect" property="strokeActive" .selection=${this.selection} ></wc-checker>
          ${!0===this.selection.getValueExtended("effect","strokeActive").value?html`

          <div class="two-cols uneven" style="margin-top: 10px">
            <wc-circle-length-control radius="36" .selection=${this.selection} feature="effect" propertyX="strokeXoffset" propertyY="strokeYoffset"  ></wc-circle-length-control>
            <div class="two-cols">
              <wc-length-box .slider=${!0} feature="effect" property="strokeXoffset" .selection=${this.selection}></wc-length-box>
              <wc-length-box   .slider=${!0} feature="effect" property="strokeYoffset" .selection=${this.selection}></wc-length-box>
            </div>
          </div>
          
          <div class="two-cols">
            <wc-length-box .updateWcBox=${!0}  feature="effect" property="strokeBlurRadius" .selection=${this.selection}></wc-length-box>
            <wc-length-box .updateWcBox=${!0}  feature="effect" property="strokeSpreadRadius" .selection=${this.selection}></wc-length-box>
          </div>
          <wc-select feature="effect" property="strokeBlend" .selection=${this.selection}></wc-select>
          <wc-color-combo feature="effect" property="strokeEffectColor" .selection=${this.selection}></wc-color-combo>
          
          <wc-omit-transform-select feature="effect" .selection=${this.selection} property="strokeOmits" ></wc-omit-transform-select>
        `:""}
       `)}
      </div>
        `:""}renderInnerGlowUi(){return this.selection.allows("allowEffect","inGlow")?html`
      <div class="transform ${!0===this.selection.getValueExtended("effect","inGlowActive").value?"selected":""}">
        ${this.controlledByStyle("inGlowActive",html` 
          <wc-checker feature="effect" property="inGlowActive" .selection=${this.selection} ></wc-checker>
          ${!0===this.selection.getValueExtended("effect","inGlowActive").value?html`

          <div class="two-cols uneven" style="margin-top: 10px">
            <wc-circle-length-control radius="36" .selection=${this.selection} feature="effect" propertyX="inGlowXoffset" propertyY="inGlowYoffset"  ></wc-circle-length-control>
            <div class="two-cols">
              <wc-length-box .slider=${!0} feature="effect" property="inGlowXoffset" .selection=${this.selection}></wc-length-box>
              <wc-length-box   .slider=${!0} feature="effect" property="inGlowYoffset" .selection=${this.selection}></wc-length-box>
            </div>
          </div>
          
          <div class="two-cols">
            <wc-length-box .updateWcBox=${!0}  feature="effect" property="inGlowBlurRadius" .selection=${this.selection}></wc-length-box>
            <wc-length-box .updateWcBox=${!0}  feature="effect" property="inGlowSpreadRadius" .selection=${this.selection}></wc-length-box>
          
            <wc-select feature="effect" property="inGlowBlend" .selection=${this.selection}></wc-select>
            <wc-select feature="effect" property="inGlowArea" .selection=${this.selection}></wc-select>
          </div>
          <wc-color-combo feature="effect" property="inGlowColor" .selection=${this.selection}></wc-color-combo>

          <wc-omit-transform-select feature="effect" .selection=${this.selection} property="inGlowOmits" ></wc-omit-transform-select>
 
        `:""}
      `)}
      </div>
        `:""}renderInnnerShadowUi(){return this.selection.allows("allowEffect","inShadow")?html`
        <div class="transform ${!0===this.selection.getValueExtended("effect","inShadowActive").value?"selected":""}">
        ${this.controlledByStyle("inShadowActive",html` 
          <wc-checker feature="effect" property="inShadowActive" .selection=${this.selection} ></wc-checker>
          ${!0===this.selection.getValueExtended("effect","inShadowActive").value?html`

          <div class="two-cols uneven" style="margin-top: 10px">
            <wc-circle-length-control radius="36" .selection=${this.selection} feature="effect" propertyX="inShadowXoffset" propertyY="inShadowYoffset"  ></wc-circle-length-control>
            <div class="two-cols">
              <wc-length-box .slider=${!0} feature="effect" property="inShadowXoffset" .selection=${this.selection}></wc-length-box>
              <wc-length-box   .slider=${!0} feature="effect" property="inShadowYoffset" .selection=${this.selection}></wc-length-box>
            </div>
          </div>
          
          <div class="two-cols">
            <wc-length-box .updateWcBox=${!0}  feature="effect" property="inShadowBlurRadius" .selection=${this.selection}></wc-length-box>
            <wc-length-box .updateWcBox=${!0}  feature="effect" property="inShadowSpreadRadius" .selection=${this.selection}></wc-length-box>
        
            <wc-select feature="effect" property="inShadowBlend" .selection=${this.selection}></wc-select>
            <wc-select feature="effect" property="inShadowArea" .selection=${this.selection}></wc-select>
          </div>
          <wc-color-combo feature="effect" property="inShadowColor" .selection=${this.selection}></wc-color-combo>

          <wc-omit-transform-select feature="effect" .selection=${this.selection} property="inShadowOmits" ></wc-omit-transform-select>
        `:""}
      `)}
      </div>
        `:""}render(){return this.selection&&this.selection.boxes.size>0&&(!scope().filterPropertiesBySelectedFeature||"effect"===this.selectedTool)?this.selection.hasFeature("effect")?html`   
                  ${this.renderOpacityUi()}
                  ${this.renderBlendUi()}
                  <div class="seperator"></div>
                  ${this.renderBlurUi()}
                  ${this.renderMaskUi()}
                 
                  ${this.renderTurbulenceUi()}
                  ${this.renderBevelUi()}
                  ${this.renderDropShadowUi()}
                  ${this.renderInnnerShadowUi()}
                  ${this.renderOuterGlowUi()}
                  ${this.renderInnerGlowUi()}
                  ${this.renderStrokeUi()}
                  
`:html`
                    <vaadin-button theme="small"   @click="${()=>scope().selectionPropertiesUi.addNewFeature()}" theme="secondary">
                    <wc-icon icon="effects" style="width: 16px; height: 16px" primaryColor="headline" slot="prefix"></wc-icon>
                    Add Effects
                    </vaadin-button>
                    `:"effect"===this.selectedTool?html`<h3 style="margin-top: 50px;">Please select a frame to add transformations.</h3>`:html``}get bevelLightX(){let e=0;return this.selection&&(e=this.selection.getValueExtended("effect","bevelPointLightX").value),e||0}get bevelLightY(){let e=0;return this.selection&&(e=this.selection.getValueExtended("effect","bevelPointLightY").value),e||0}setBevelXY(e,t,o){this.selection&&this.selection.setMultipleValues([{feature:"effect",property:"bevelPointLightX",value:1e4*e},{feature:"effect",property:"bevelPointLightY",value:1e4*t}],o)}};return __decorate$t([property({attribute:!1,type:Object})],e.prototype,"selection",void 0),__decorate$t([property()],e.prototype,"selectedTool",void 0),e=__decorate$t([customElement("wc-selection-effect")],e),e})();var __decorate$u=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n};let WcSelectFormFieldName=(()=>{let e=class extends LitElement{constructor(){super(...arguments),this.property="clickActionFormFieldName",this.skipUiElements=!1}static get styles(){return[desktopPropertyStyles,css`
      :host, :host * {
          box-sizing: border-box;
      }
      .form {
        width: 100%;
      }
      .form >  vaadin-text-field {
        width: 100%;
      } 
      .form >  vaadin-select {
        width: 100%;
      }`]}render(){return html` 
        <div class="form">       
          <vaadin-select theme="small" id="select" value="${this.formFieldName}"  label="Form Field"   
            @value-changed=${e=>{var t;return this.formFieldName=null===(t=e.target)||void 0===t?void 0:t.value}} >
            <template>
                <vaadin-list-box>
                  ${this.getFFs().map((e=>html`
                    <vaadin-item value="${e.name}">    
                        ${e.caption?e.caption+" ["+e.name+"]":e.name}        
                    </vaadin-item>`))}
                </vaadin-list-box>
            </template>             
        </vaadin-select > 
      </div>`}getFFs(){return[...scope().getAllGlobalFormFields(!1).values(),...scope().currentDoc.getAllDocFormFields(null,this.skipUiElements)]}set formFieldName(e){const t=this.formFieldName;this.selection&&t!==e&&null!==e&&this.selection.setValue("lock","clickActionFormFieldName",e)}get formFieldName(){return this.extendedValue||""}get extendedValue(){return this.selection?this.selection.getValueExtended("lock","clickActionFormFieldName").value:null}};return __decorate$u([property({attribute:!1,type:Object})],e.prototype,"selection",void 0),__decorate$u([property()],e.prototype,"property",void 0),__decorate$u([property({attribute:!0,type:Boolean})],e.prototype,"skipUiElements",void 0),e=__decorate$u([customElement("wc-select-form-field-name")],e),e})();var __decorate$v=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n};let WcSelectionLock=(()=>{let e=class extends LitElement{constructor(){super(...arguments),this.mode="easy"}static get styles(){return[desktopPropertyStyles,css`
            :host, :host * {
                box-sizing: border-box;
            }
            label {
                display: block;
                font-size: var(--printess-labelSize);
                white-space: nowrap;
            }
            h3 {
                margin-bottom: 2px;
                font-size: 15px;
            }
            h4 { 
                margin: 0;
                margin-top: 4px;
                color: var(--printess-headlineColor);
            }
            
            .two-cols > * {
              margin-bottom: 0px;
            }
            :host > :not(.two-cols) {
              margin-bottom: 3px;
            }
            .seperator {
              margin-top: 20px;
            }
            .label-input {
              display: grid;
              grid-template-columns: auto 1fr;
              align-items: baseline;
              font-size: var(--printess-labelSize);
              grid-column-gap: 5px;
            }
            `]}render(){return!this.selection||!1!==config.isBuyer||scope().filterPropertiesBySelectedFeature&&"lock"!==this.selectedTool?html``:html`  
        ${this.selection.boxes.size?html`
          <wc-checker .selection=${this.selection} feature="lock" property="isUiElement"></wc-checker>
          <div class="seperator" style="margin-top: 10px;"></div>
        `:""}

        ${this.isUiElement?html`
          
          <wc-checker .selection=${this.selection} feature="lock" property="hasClickAction"></wc-checker>
          ${this.hasClickAction?html`
              <wc-select-form-field-name .skipUiElements=${!0} .selection=${this.selection} property="clickActionFormFieldName" ></wc-select-form-field-name>
              <wc-form-field-value  .selection=${this.selection} feature="lock" property="clickActionFormFieldValue" ></wc-form-field-value>
          `:""}

         
          ${config.enableZoomToFrame?html`
            <div class="seperator"></div>
            <wc-checker   .selection=${this.selection} feature="lock" property="hasZoomAction"></wc-checker>
            ${this.hasZoomAction?html`
              <wc-select feature="lock" property="zoomActionOrderNo"  .selection=${this.selection}></wc-select>
              <p>Zoom to another frame if user clicks on this element.</p>
            `:""}
          
            <div class="seperator"></div>
            <h3 style="color: var(--printess-headlineColor); margin-top: 5px; margin-bottom: 10px;">Connect & Hide</h3>
            <wc-select feature="lock" property="boundToBoxSelection"  .selection=${this.selection}></wc-select>
            <p>Show this frame only if the connected frame is selected.</p>
          `:""}
        `:html`
        
          ${this.getAllAllows().map((e=>html`
            ${"allowImageFilters"!==e?html`<h3>${this.getGroupLabel(e)}</h3>`:""}
            <div class="two-cols">
              ${this.getOptions(e).map((t=>this.getCheckbox(e,t)))}
            </div>
            ${"allowText"===e&&!0===this.selection.getAllowValue("allowText","content").value||"allowPathText"===e&&!0===this.selection.getAllowValue("allowPathText","content").value?html`
                <div class="label-input">
                  <div>Caption:</div>
                  <wc-text-area style="margin-top: 10px" mode="input" feature="lock" property="textFieldCaption" .selection=${this.selection}></wc-text-area>
                
                </div>
            `:""}
          `))}

          ${this.canHaveOrderNumber()?html`
            <div class="seperator"></div>
            <div class="two-cols">           
              <wc-select feature="lock" property="buyerOrderNo"  .selection=${this.selection}></wc-select>
            </div>
        `:""}
        `}                
      `}canHaveOrderNumber(){return!1!==config.enableZoomToFrame&&!!(this.selection.getAllowValue("allowText","content").value||this.selection.getAllowValue("allowImage","content").value||this.selection.getAllowValue("allowSubDocument","formFields").value)}get hasClickAction(){return this.selection&&!0===this.selection.getValueExtended("lock","hasClickAction").value}get hasZoomAction(){return this.selection&&!0===this.selection.getValueExtended("lock","hasZoomAction").value}get isUiElement(){return this.selection&&!0===this.selection.getValueExtended("lock","isUiElement").value}get showAllows(){return!!this.isDoc||!0===this.selection.getValueExtended("lock","lockForBuyer").value}getCaption(e){switch(e){case"positionByMouse":return"easy"===this.mode?"Position":"Position (Mouse)";case"stroke":return"easy"===this.mode?"Stroke Color":camel2title(e);case"positionByInput":return"Position (Keys)";case"horizontalAlignment":return"Horiz. Align";case"verticalAlignment":return"Vert. Align";case"warpArchPhi":return"Arch"}return camel2title(e)}getCheckbox(e,t){const o=this.getValue(e,t),i=o.selector,r=o.value;let s=this.getCaption(t);i&&(s+=" ["+i+"]");let n=html``;return this.isDoc&&"allowAdd"===e&&"colors"===t&&(n=html`<h4 style="grid-column: 1 / span 2;">Resources:</h4>`),this.isDoc&&"allowAdd"===e&&"image"===t&&(n=html`<h4 style="grid-column: 1 / span 2;">Frames:</h4>`),null===r?html`${n}
    <label  style="${"Content"===s?"font-weight: bold;":""}">
        <input type="checkbox" 
            ?disabled=${!!i} .checked="${!1}"
             @click=${o=>o.target?this.setValue(e,t,o.target.checked):""} />
        ${"??? "+s}
    </label>`:html`${n}
      <label  style="${"Content"===s?"font-weight: bold;":""}">
        <input type="checkbox" 
            ?disabled="${!!i}" .checked="${r}"
            @click=${o=>o.target?this.setValue(e,t,o.target.checked):""} />
        ${s}
      </label>`}setValue(e,t,o){this.selection.setAllowValue(e,t,o)}getValue(e,t){return this.selection.getAllowValue(e,t)}getGroupLabel(e){switch(e){case"allowAdd":return"Buyer can add:";case"allowFrame":return"Frame";case"allowShape":return"Shape";case"allowText":return"Text";case"allowPathText":return"Text on Path";case"allowImage":return"Image";case"allowEffect":return"Effects";case"allowTransform":return"Transforms";case"allowImageGroups":return"Image Groups";case"allowFontGroups":return"Font Groups";case"allowColorGroups":return"Color Groups";case"allowSubDocument":return"easy"===this.mode?"":"Sub Document";case"allowImageFilters":return"Image Filters";default:assertNever$1(e)}}get isDoc(){return!this.selection.getSingleSelection||!this.selection.boxes.size}getAllAllows(){const e=this.isDoc;return enums.allAllowEnums.filter((t=>{if(e)return"allowImageFilters"===t&&!1===scope().currentDoc.showBuyerAllImageFilters;{const e=!0===this.getValue("allowImage","content").value,o=!0===this.getValue("allowText","font").value||!0===this.getValue("allowPathText","font").value,i=!0===this.getValue("allowText","color").value||!0===this.getValue("allowPathText","color").value||!0===this.getValue("allowShape","color").value;switch(t){case"allowAdd":return!1;case"allowFrame":return!0;case"allowShape":return this.selection.hasFeature("pathGeometry");case"allowImage":return this.selection.hasFeature("imageRef");case"allowText":return this.selection.hasFeature("simpleText")||this.selection.hasFeature("storyRef");case"allowPathText":return this.selection.hasFeature("pathText");case"allowTransform":case"allowEffect":return"advanced"===this.mode;case"allowImageGroups":return e&&this.selection.hasFeature("imageRef");case"allowFontGroups":return o&&(this.selection.hasFeature("simpleText")||this.selection.hasFeature("storyRef")||this.selection.hasFeature("pathText"));case"allowColorGroups":return i;case"allowSubDocument":return this.selection.hasFeature("docRef");case"allowImageFilters":return!1;default:assertNever$1(t)}}}))}getOptions(e){const t=[];if("allowImageGroups"===e)return Array.from(scope().getWcListGroup("Images").values()).map((e=>e.name)).filter((e=>e));if("allowFontGroups"===e)return Array.from(scope().getWcListGroup("Fonts").values()).map((e=>e.name)).filter((e=>e));if("allowColorGroups"===e)return Array.from(scope().getWcListGroup("Colors").values()).map((e=>e.name)).filter((e=>e));for(const o of enums[e])"allowAdd"===e?this.isDoc&&t.push(o):"allowText"===e&&"easy"===this.mode?this.selection.hasFeature("storyRef")?["content","color","font","size","horizontalAlignment","verticalAlignment"].indexOf(o)>=0&&t.push(o):["content","mandatory","color","stroke"].indexOf(o)>=0&&t.push(o):"allowFrame"===e&&"easy"===this.mode?(["rotation","positionByMouse","delete"].indexOf(o)>=0&&t.push(o),"warpArchPhi"===o&&!0===this.selection.getValueExtended("transform","warpArchActive").value&&t.push(o)):"allowPathText"===e&&"easy"===this.mode?["content","color","font","size"].indexOf(o)>=0&&t.push(o):"allowShape"===e&&"easy"===this.mode?["color","stroke"].indexOf(o)>=0&&t.push(o):"allowImage"===e&&"easy"===this.mode?["content","mandatory"].indexOf(o)>=0&&t.push(o):"allowSubDocument"===e&&"easy"===this.mode||t.push(o);return t}};return __decorate$v([property({attribute:!1,type:Object})],e.prototype,"selection",void 0),__decorate$v([property()],e.prototype,"selectedTool",void 0),__decorate$v([property()],e.prototype,"mode",void 0),e=__decorate$v([customElement("wc-selection-lock")],e),e})();var __decorate$w=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n};let WcSelectionDocBuyerSettings=(()=>{let e=class extends LitElement{constructor(){super(...arguments),this.doc=null}static get styles(){return[desktopPropertyStyles,css`
            :host, :host * {
                box-sizing: border-box;
            }`]}get dpis(){return[60,80,100,120,140,160,180,200,220,240,260,280,300,320,340,360,380,400]}render(){return!config.isBuyer&&this.doc?html`   
        
        <wc-checker theme="small" label="Rich Text Editor" .value="${this.doc.showBuyerEddi}"  .callback=${e=>this.setDocValue("showBuyerEddi",e)}></wc-checker>
        <p>Toggles between inline (rich) and form based text editing on the buyer side. Only affects multi-line text frames.</p>
        
        ${this.doc.showBuyerEddi?html`
          <vaadin-select theme="small" style="width: 100%;margin-top: 5px;" .value=${this.doc.buyerTextStyleMode}  label="Restrict Text Formatting"  
            @value-changed=${e=>this.setDocValue("buyerTextStyleMode",e.currentTarget?e.currentTarget.value:"default")} >
            <template>
              <vaadin-list-box>
                  <vaadin-item value="default">
                    <h4 style="margin:6px 0 2px 0; color: var(--printess-inputColor);">Selection or Paragraph</h4>
                    <span style="margin:0 0 3px 0; color: var(--printess-textColor);">Format only the selected characters and if there is no selection format the current paragraph.</span>
                  </vaadin-item>
                  <vaadin-item value="all-paragraphs">
                    <h4 style="margin:6px 0 2px 0; color: var(--printess-inputColor);">Entire Text</h4>
                    <span style="margin:0 0 3px 0; color: var(--printess-textColor);">Restrict the formatting to the entire text. Selection will be ignored.</span>
                  </vaadin-item>
                  <vaadin-item value="all-paragraphs-if-no-selection">
                    <h4 style="margin:6px 0 2px 0; color: var(--printess-inputColor);">Selection or Entire Text</h4>
                    <span style="margin:0 0 3px 0; color: var(--printess-textColor);">Format only the selected characters and if there is no selection format the entire text.</span>
                  </vaadin-item>
              </vaadin-list-box>
            </template>             
          </vaadin-select >
        `:""}

        <div class="seperator"></div>
        <wc-checker theme="small" style="margin-top: 3px;" label="Split Paragraphs" .value="${this.doc.splitMultilineToParagraphs}"  .callback=${e=>this.setDocValue("splitMultilineToParagraphs",e)}></wc-checker>
        <p>When editing multiline text in form mode, Printess can split all paragraphs with disparate styling to multiple form boxes.</p>
       
        <div class="seperator"></div>
        <wc-checker theme="small" style="margin-bottom: 0px;" label="Keep frames inside page" .value="${this.doc.keepFramesInsidePage}"  .callback=${e=>this.setDocValue("keepFramesInsidePage",e)}></wc-checker>
       
        <div class="seperator"></div>
        <wc-select .value=${this.doc.scaledImageMinimumDpi+" dpi"} .list=${this.dpis.map((e=>e+" dpi"))}
          label="Minimum DPI for Images" .callback=${e=>this.setDocValue("scaledImageMinimumDpi",Math.max(60,parseInt(e.replace(" dpi",""))))}> </wc-select>
       
          <div class="seperator"></div>
        <wc-checker theme="small" style="margin-bottom: 0px;" label="Show All Image Filters" .value="${this.doc.showBuyerAllImageFilters}"  .callback=${e=>this.setDocValue("showBuyerAllImageFilters",e)}></wc-checker>

       
      `:html``}setDocValue(e,t){if(this.doc){const o=new Nobs;o.setProperty(this.doc,e,t);const i=new Doc(o,this.doc);update([this.doc.serialize(scope().id)],[i.serialize(scope().id)])}}};return __decorate$w([property({attribute:!1,type:Object})],e.prototype,"doc",void 0),e=__decorate$w([customElement("wc-selection-doc-buyer-settings")],e),e})();var __decorate$x=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n};let WcmSelectionStoryText=(()=>{let e=class extends LitElement{static get styles(){return css`
        :host {
            box-sizing: border-box;
            padding: 5px;
            padding-top: 20px;
            width: 100%;
            display: block;
        }
        textarea {  
            width: calc(100% - 10px);
            height: 175px;
            font-size: 15px;
        }`}render(){return setMainMobileGridRows(200),this.selection&&this.selection.hasFeature("storyRef")&&1===this.selection.boxes.size?html`   
        <textarea @change=${e=>this.textChanged(e)} @keyup=${e=>this.textChanged(e)}>${this.text()}</textarea>
      `:html``}textKeyUp(e){}get story(){return this.selection?this.selection.getStory():null}text(){var e,t;return null!==(t=null===(e=this.story)||void 0===e?void 0:e.toText())&&void 0!==t?t:""}textChanged(e){const t=this.story;if(t){const o=e.currentTarget?e.currentTarget.value:"",i=t.fromText(o);scope().updatesBeforeBlurActiveElementOnNewSelection=1,update([t.serialize()],[i.serialize()])}}};return __decorate$x([property({attribute:!1,type:Object})],e.prototype,"selection",void 0),e=__decorate$x([customElement("wcm-selection-story-text")],e),e})();var __decorate$y=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n};let WcExternalTextArea=(()=>{let e=class extends LitElement{constructor(){super(...arguments),this.property=null,this.view="normal"}static get styles(){return[desktopBuyerGroupStyles,css`
        :host, :host * {
          box-sizing: border-box;
        }
        :host {
          --padding: 0;
        }
        :host {
         
          display: block;
          position: relative;
          padding: var(--padding);
        }
        :host > * {
          margin-bottom: 4px !important; /* to overwrite from desktopBuyerStyles */
        }
        vaadin-text-area {
              width: 100%;
              height: 200px
        }

        vaadin-text-area.singleLine {
          height: 60px;
        }

        #textinput {
          width: 100%;
        }

        input {
          padding: 6px;
        }
        
        .counter {
          position: absolute;
          right: 0;
          top: 3px;
          font-size: var(--printess-labelSize);
          color: var(--printess-textColor);
        }

        textarea {
          padding: 4px; 
          line-height :140%;
          font-size :11px;
          font-family: Lato, sans-serif;
          resize: none;
        }
        @media (max-width:  ${config.mobileDeviceWidth}px) {
            :host {
               --padding: 35px 0 0 5%;
                width: 100%;
                display: block;
            }
            textarea {
                width: 95%;
                height: 50px;
                font-size: 21px;
            }
            #textinput {
              width: calc(100% - 40px);
              height: 40px; 
              font-size: 24px; 

              border: none; 
              background-color: white;
              color: black;
            }
            #textinput.normal {
              width: calc(100% - 40px);
              height: 40px; 
              font-size: 24px; 
            }
            #textinput.full {
              width: 100%;
              height: 100%; 
              font-size: 16px; 
            }
        }

        
    `]}render(){var e;let t="";if("full"===this.view?(this.style.setProperty("padding","18px 5px 5px 5px"),this.style.setProperty("width","100%"),this.style.setProperty("height","100%")):t=`height: ${measureSimpleTextAreaHeight(this.uiValueString)+10}px;`,!this.property||"single-line-text"!==this.property.kind&&"multi-line-text"!==this.property.kind)return html`Property not supported ${null===(e=this.property)||void 0===e?void 0:e.kind}`;const o=this.isValid;return"single-line-text"===this.property.kind?html`
     
      <input type="text" id="textinput" ?disabled=${this.uiDisabled} 
        style="${o.ok?"":"background-color: #ffcccc !important;"}"
        @keyup=${e=>this.setValue(e.currentTarget?e.currentTarget.value:"")}}
        .value=${this.value}  @focus=${()=>this.focus()} />
        ${o.ok?"":html`<p style="color: red;">${o.hint}</p>`}
        `:html`<textarea id="textinput" class="${this.view}" ?disabled=${this.uiDisabled} 
        style="${t}"
        @keyup=${e=>this.setValue(e.currentTarget?e.currentTarget.value:"")}
        .value=${this.value}  @focus=${()=>this.focus()}></textarea>`}get value(){if(this.property){if("string"==typeof this.property.value)return this.property.value;if(this.property.value)return this.property.value.toString()}return""}get isValid(){var e;const t=this.uiValueString;if(null===(e=this.property)||void 0===e?void 0:e.textMeta){const e=this.property.textMeta;if(e.isMandatory&&t.toLowerCase()===this.property.textMeta.defaultValue.toLowerCase())return{ok:!1,hint:"You need to enter your own text."};if(e.isMandatory&&!t)return{ok:!1,hint:"You need to enter something here."};if(e.maxChars>0&&t.length>e.maxChars)return{ok:!1,hint:"Max "+e.maxChars+" characters allowed."}}return{ok:!0,hint:""}}get uiValueString(){if(this.shadowRoot){const e=this.shadowRoot.querySelector("#textinput");if(e)return e.value}return this.value}setValue(e){this.property&&this.isValid&&setProperty(this.property.id,e),this.requestUpdate()}charCounter(){if(this.property&&this.property.textMeta){const e=this.property.textMeta.maxChars||0,t=this.value;if(e>0)return t.length+" of "+e+" letters"}return""}focus(){}updated(e){var t;console_log("WCExternalTextArea received update = "+this.uiValueString),this.shadowRoot&&(null===(t=this.shadowRoot.querySelector("#textinput"))||void 0===t?void 0:t.matches(":focus"))&&this.focus()}get uiDisabled(){return!1}getLabel(){return this.property?this.property.label:""}};return __decorate$y([property({attribute:!1,type:Object})],e.prototype,"property",void 0),__decorate$y([property({attribute:!0,type:String})],e.prototype,"view",void 0),e=__decorate$y([customElement("wc-external-text-area")],e),e})();var __awaiter$u=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};const buyerSideOriginalValueCache=new Map;let BuyerPropertiesGroup=(()=>{class e{constructor(e){config.isBuyer||config.isMobile||buyerSideOriginalValueCache.clear();const t=new Map,o=e.length;for(const i of e.sort(((e,t)=>e.boxGeometry.top.toPixel(100,100)-t.boxGeometry.top.toPixel(100,100)))){if(i.lock.allowFrame.indexOf("rotation")>=0&&this.addGroupedProperty(t,i,o,{boxId:i.id,feature:"boxGeometry",property:"rotation"}),i.lock.allowShape.indexOf("color")>=0&&i.pathGeometry&&this.addGroupedProperty(t,i,o,{boxId:i.id,feature:"pathGeometry",property:"fillColor"}),i.lock.allowShape.indexOf("stroke")>=0&&i.pathGeometry&&i.pathGeometry.strokeWidth.toPixel(100,100)>0&&this.addGroupedProperty(t,i,o,{boxId:i.id,feature:"pathGeometry",property:"strokeColor"}),i.lock.allowText.indexOf("stroke")>=0&&i.simpleText&&i.simpleText.fontStrokeWidth.toPixel(100,100)>0&&this.addGroupedProperty(t,i,o,{boxId:i.id,feature:"simpleText",property:"fontStrokeColor"}),i.lock.allowText.indexOf("color")>=0&&i.simpleText){i.imageRef&&"simpleText"===i.imageRef.imageMasking||this.addGroupedProperty(t,i,o,{boxId:i.id,feature:"simpleText",property:"fontColor"})}if(i.lock.allowPathText.indexOf("stroke")>=0&&i.pathText&&i.pathText.pathTextStrokeWidth.toPixel(100,100)>0&&this.addGroupedProperty(t,i,o,{boxId:i.id,feature:"pathText",property:"pathTextStrokeColor"}),i.lock.allowPathText.indexOf("color")>=0&&i.pathText&&this.addGroupedProperty(t,i,o,{boxId:i.id,feature:"pathText",property:"pathTextFontColor"}),i.lock.allowPathText.indexOf("content")>=0&&i.pathText&&this.addGroupedProperty(t,i,o,{boxId:i.id,feature:"pathText",property:"textOnPath"}),i.lock.allowText.indexOf("content")>=0&&i.simpleText&&this.addGroupedProperty(t,i,o,{boxId:i.id,feature:"simpleText",property:"text"}),i.lock.allowText.indexOf("content")>=0&&i.storyRef&&(config.isMobile||!scope().currentDoc.showBuyerEddi||o>1)&&this.addGroupedProperty(t,i,o,{boxId:i.id,feature:"storyRef",property:"storyContent"}),i.lock.allowText.indexOf("color")>=0&&i.storyRef){const e=this.getParagraphColors(i);if(e)for(const r of e.values())this.addGroupedProperty(t,i,o,{boxId:i.id,feature:"storyRef",paragraphs:r.paragraphs,property:"fontColor"})}i.lock.allowFrame.indexOf("warpArchPhi")>=0&&i.transform&&i.transform.warpArchActive&&this.addGroupedProperty(t,i,o,{boxId:i.id,feature:"transform",property:"warpArchPhi"}),i.lock.allowImage.indexOf("content")>=0&&i.imageRef&&this.addGroupedProperty(t,i,o,{boxId:i.id,feature:"imageRef",property:"image"})}this.groupedProperties=t}getParagraphColors(e){if(e.storyRef){const t=e.storyRef.story;if(t){const o=t.toStoryContent(e.storyRef.verticalStoryTextAlign);if(e.lock.hasOnlyStoryColorAllow()||config.isMobile){const e=new Map;let t=-1;for(const i of o.pts){const o=[];for(let e=0;e<i.pSpan;e++)t++,o.push(t);if(i.externalFontColorRef){const t=i.externalTextStyle.color.toString(),r=e.get(t);r?r.paragraphs.push(...o):e.set(t,{paragraphs:o,color:i.externalFontColorRef})}}if(e.size)return e}}}return null}getValue(e,t,o,i,r){if("storyRef"===t){if(e.storyRef){const t=e.storyRef.story;if(t){const s=t.toStoryContent(e.storyRef.verticalStoryTextAlign);if("storyContent"===o)return s;if("fontColor"===o&&s.pts.length&&i>0&&r){const t=this.getParagraphColors(e),o=r.join("|");if(t&&o)for(const e of t.values())if(e.paragraphs.join("|")===o)return e.color}}}}else{const i=e.getValueExtended(t,o);if(!isInactive(i)){if("imageRef"===t)return e.imageRef;if(i.value instanceof ColorRef||i.value instanceof ImageRef||"string"==typeof i.value||"number"==typeof i.value)return i.value;alert("Can not get grouped property value: Feature: "+t+"property: "+o)}}return null}addGroupedProperty(e,t,o,i){let r,s="",n="",a=!1,l="",c=0;if(t.getFeature(i.feature)){const d=this.getValue(t,i.feature,i.property,o,i.paragraphs);if(n="",a=!1,"imageRef"===i.feature&&t.imageRef&&(n=t.imageRef.defaultImageId,t.lock.allowImage.indexOf("mandatory")>=0&&(a=!0)),"simpleText"===i.feature&&t.simpleText&&(n=t.simpleText.defaultText,t.lock.allowText.indexOf("mandatory")>=0&&(a=!0),c=t.simpleText.maxCharacters),null!==d){const o=i.boxId+"-"+i.feature+"-"+i.property+(i.paragraphs?"#"+i.paragraphs.join("|"):"");if(isColorProperty(i.property)){const e=d;if("[None]"===e.color.name)return null;s="CO_"+e.color.toString(),r="color",l="Color"}else if(isStringProperty(i.property)&&"string"==typeof d)s=d?"TX_"+simpleUnsecureHash(d):"emptyText",r="single-line-text",l=t.lock.textFieldCaption;else if(isStoryContentProperty(i.property))s="ST_"+i.boxId,r="story",l=t.lock.textFieldCaption;else if("rotation"===i.property&&"number"==typeof d)s="NU_"+i.property+d.toString(),r="number",l="Rotation";else if("warpArchPhi"===i.property&&"number"==typeof d)s="NU_"+i.property+d.toString(),r="number",l="Bending Arc";else{if("image"!==i.property||"imageRef"!==i.feature)return null;s="IM_"+i.boxId,r="imageRef",l="Change Image"}if(s){const e=buyerSideOriginalValueCache.get(o);e?s=e:buyerSideOriginalValueCache.set(o,s)}const h=s?e.get(s):null;if(!h){const t={boxes:[i],value:d,kind:r,label:l,id:s,isMandatory:a,defaultValue:n,maxChars:c};return e.set(s,t),t}h.boxes.push(i),""!==l&&(h.label=l),a&&(h.isMandatory=!0),n&&(h.defaultValue=n)}}return null}static storyTextChange(e,t,o){const i=scope().getBox(e.boxes[0].boxId);if(i&&i.box.storyRef){const r=i.box.storyRef.story;if(r){"upper"===i.box.getValueExtended("storyRef","textTransform").value&&(o=(o+"").toUpperCase()),"lower"===i.box.getValueExtended("storyRef","textTransform").value&&(o=(o+"").toUpperCase());const s=e.value;for(const e of s.pts)e===t&&(e.text=o);const n=r.fromParagraphTextsAndStyles(s.pts);return scope().updatesBeforeBlurActiveElementOnNewSelection++,update([r.serialize()],[n.serialize()])}}throw"storyTextChange: Box not found or Box has no story"}static setTextStyleProperty(e,t,o,i){var r;const s=[],n=[],a=e.boxes.sort(((e,t)=>t.boxId.localeCompare(e.boxId)));for(const l of a){if("storyRef"===l.feature){const a=scope().getBox(l.boxId),c=null===(r=null==a?void 0:a.box.storyRef)||void 0===r?void 0:r.story;if(c&&a){let r=null;if("vAlign"===o){if(!scope().selection.has(l.boxId)){const e=scope().docUi.getWcBox(l.boxId);if(!e)throw"Can't select box required by setTextStyleProperty id="+l.boxId;scope().selection=new Selection$1([e],null==a?void 0:a.spread)}scope().selection.setValue("storyRef","verticalStoryTextAlign",i)}else if("object"==typeof e.value){const s=e.value.pts;switch(o){case"hAlign":if("string"==typeof i&&checkEnumValue("horizontalTextAlign",i)){const e=i;s[t].paragraphStyleProps.horizontalTextAlign=e}break;case"font":{const e=scope().fonts_getByName(i);e&&(s[t].textStyleProps.font=new FontRef(e));break}case"size":if("string"==typeof i){const e=new Length(i);e&&(s[t].textStyleProps.fontSize=e)}break;case"color":if("string"==typeof i){let e=scope().colors.getSwatchByName(i);e||(e=Color.parseRgbColor(i)),e&&(s[t].textStyleProps.fontColor=new ColorRef(e))}}r=c.fromParagraphTextsAndStyles(e.value.pts)}r&&(s.push(c.serialize()),n.push(r.serialize()))}}s.length>0&&update(s,n)}}static getTextStylePropertyByNameAndValue(e,t){if("font"===e&&"string"==typeof t){const e=scope().fonts_getByName(t);if(e)return{font:new FontRef(e)}}if("color"===e&&"string"==typeof t){let e=scope().colors.getSwatchByName(t);if(e||(e=Color.parseRgbColor(t)),e)return{fontColor:new ColorRef(e)}}if("size"===e&&"string"==typeof t){const e=new Length(t);if(e)return{fontSize:e}}return null}static getParagraphStylePropertyByNameAndValue(e,t){if("hAlign"===e&&t&&"string"==typeof t&&checkEnumValue("horizontalTextAlign",t)){return{horizontalTextAlign:t}}return null}static boxPropertyChanged(t,o){var i;return __awaiter$u(this,void 0,void 0,(function*(){let r;const s=[],n=[],a=t.boxes.sort(((e,t)=>t.boxId.localeCompare(e.boxId)));let l=null,c=null;for(const d of a)if("storyRef"===d.feature){const e=scope().getBox(d.boxId);let t=null===(i=null==e?void 0:e.box.storyRef)||void 0===i?void 0:i.story;if(t){if(s.push(t.serialize()),!(o instanceof Color)){const e=o;o=Color.parseRgbColor(o);for(const t of scope().colors.getSwatches())if(t.toRgbHexColor()===e){o=t;break}}if(d.paragraphs)for(const e of d.paragraphs)t=t.setParagraphTextStyleColorKeepTintOpacityHSL(o,e);else alert("No Paragraphs found to apply color");n.push(t.serialize())}}else{if(!l||l.box.id!==d.boxId){if(l&&c){const e=l.box.serialize(l.spread.id,l.doc.id),t=new Box(c,l.box).serialize(l.spread.id,l.doc.id);JSON.stringify(e)!==JSON.stringify(t)&&(s.push(e),n.push(t)),l=null,c=null}l=scope().getBox(d.boxId),c=new Nobs}if(l&&c)if(o instanceof Color){const e=l.box.getValue(d.feature,d.property);c.setProperty(l.box.getFeature(d.feature),d.property,new ColorRef(o,e.tint,e.opacity,e.modifier))}else if("color"===t.kind&&"string"==typeof o){let e=scope().colors.getSwatchByName(o);if(!e){e=Color.parseRgbColor(o);for(const t of scope().colors.getSwatches())t.toRgbHexColor()===o&&(e=t)}if(e){const t=l.box.getValue(d.feature,d.property);c.setProperty(l.box.getFeature(d.feature),d.property,new ColorRef(e,t.tint,t.opacity,t.modifier))}}else"number"===t.kind||"single-line-text"===t.kind?(c.setProperty(l.box.getFeature(d.feature),d.property,o),yield Listeners.addNobs(d.feature,d.property,c,l.box,s,n)):"imageRef"===t.kind&&"imageRef"===d.feature&&"string"==typeof o?(r=e.assignImage(c,l,o),setOldBuyerPropertyKeys([]),l.box.lock.hasImagePlacement()&&config.enterImageCropingOnSelect&&window.setTimeout((()=>{scope().showCropEditor(),scope().selectionPropertiesUi.mobileUiState={state:"imageCrop"}}),200)):alert("Can't set groupable property: "+JSON.stringify(t))}if(l&&c){const e=l.box.serialize(l.spread.id,l.doc.id),t=new Box(c,l.box).serialize(l.spread.id,l.doc.id);JSON.stringify(e)!==JSON.stringify(t)&&(s.push(e),n.push(t)),l=null,c=null}if(s.length>0&&("single-line-text"!==t.kind&&"story"!==t.kind||(scope().updatesBeforeBlurActiveElementOnNewSelection=s.length),update(s,n),r))return r}))}static assignImage(e,t,o){if(!t)throw"Can't serialize box, boxRef is null";const i=scope().images.get(o);if(!i)throw"Can't assign image: id not found:"+o;const r=t.box.imageRef,s=r?r.verticalFocalPoint:.5,n=r?r.horizontalFocalPoint:.5,a=r?r.defaultImageId:"",l=t.box.getImagePosition(i,"fill",n,s);let c="none";t.box.pathGeometry&&(c="pathGeometry");const d={id:o,def:a,m:r?r.imageMasking:c,ip:"fill",im:i.serialize().data,px:l.px,py:l.py,ws:l.ws,hs:l.hs,hc:n,vc:s},h=new ImageRef(i.id,d);e.setProperty(t.box,"imageRef",h);const p=t.box.boxGeometry.toPixel(t.spread.width(),t.spread.height());return Selection$1.getMinMaxImageScaleX(p.width,p.height,h)}getExternalProperties(){const e=[];for(const t of this.groupedProperties.values()){if(t.value instanceof ImageRef){const o=t.value,i=scope().getBox(t.boxes[0].boxId);if(i){const r=i.box.boxGeometry.toPixel(i.spread.width(),i.spread.height()),s=i.box.getValue("effect","saturate"),n=i.box.getValue("effect","grayscale"),a=i.box.getValue("effect","hueRotate"),l=Selection$1.getMinMaxImageScaleX(r.width,r.height,o);e.push({id:t.id,label:t.label,kind:"image",value:o.image.id,imageMeta:{scale:Math.max(t.value.imageWidthScale,l.min),scaleHints:l,sepia:i.box.getValue("effect","sepia"),contrast:i.box.getValue("effect","contrast"),brightness:i.box.getValue("effect","brightness"),vivid:s>0?s:-n,hueRotate:a,thumbCssUrl:o.image.thumbNailCssUrl(),thumbUrl:o.image.thumbNailUrl(),defaultValue:o.defaultImageId,isMandatory:t.isMandatory,allows:i.doc.getImageFilters()}})}}if("single-line-text"===t.kind&&"string"==typeof t.value&&e.push({id:t.id,label:t.label,kind:t.kind,value:t.value,textMeta:{defaultValue:t.defaultValue,isMandatory:t.isMandatory,maxChars:t.maxChars}}),"number"===t.kind&&"number"==typeof t.value&&e.push({id:t.id,label:t.label,kind:"number",value:t.value}),"story"===t.kind&&!scope().eddiActive()){const o=t.boxes.length?scope().getBox(t.boxes[0].boxId):null;let i=[];o&&(i=o.box.lock.allowText);const r=t.value;if(r&&r.pts)for(let o=0;o<r.pts.length;o++){const s=r.pts[o];e.push({id:t.id+"#"+o,label:t.label,kind:"multi-line-text",value:s.text,textStyle:{color:s.externalTextStyle.color,font:s.externalTextStyle.font,hAlign:s.externalTextStyle.hAlign,vAlign:s.externalTextStyle.vAlign,size:s.externalTextStyle.size,allows:i}})}}t.value instanceof ColorRef&&e.push({id:t.id,label:t.label,kind:"color",value:t.value.color.toRgbHexColor()})}const t=[];for(const o of e)"color"===o.kind&&t.push(o);for(const o of e)"image"===o.kind&&t.push(o);for(const o of e)"color"!==o.kind&&"number"!==o.kind&&"image"!==o.kind&&t.push(o);for(const o of e)"number"===o.kind&&t.push(o);return t}}return e.storyTextChangeDebounced=promiseDebounce({},e.storyTextChange,200),e})();var __awaiter$v=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};function mergeForeignScope(e=null,t){return __awaiter$v(this,void 0,void 0,(function*(){if(e=e||prompt("Enter Template-Name:")){const o=yield loadScopeJson(e,t);if(o){let e=o.documents.filter((e=>e.data.pri))[0];e||(e=o.documents[0]),e&&(yield addSnippetInternal(o,e.id,"layout",!0))}}}))}function addSnippet(e,t,o){return __awaiter$v(this,void 0,void 0,(function*(){let i=null;if(!e&&t){scope().docs.get(t)&&(i=scope().serializeAll(),yield addSnippetInternal(i,t,o))}else try{const r=yield fetch(e);i=yield r.json(),yield addSnippetInternal(i,t,o)}catch(t){alert("Can't load snippet from ["+e+"] \n\n"+t)}}))}function addSnippetInternal(e=null,t,o,i=!1){return __awaiter$v(this,void 0,void 0,(function*(){let r=!1;if(e){const s=e.documents.filter((e=>e.id===t))[0];if(!s)return;"layout"===o&&!1===i&&(yield removeArtworkFromCurrentSpread());let n=1;if("layout"===o)n=scope().currentDoc.pageWidth*scope().docUi.currentSpread.pages.length/s.data.pw;else{n=.6*scope().docUi.currentSpread.width()/s.data.pw}if(scaleAllLengthValues(s.data,n),"group"===o){const e=scope().getVisibleTopLeftPositionForNewItems(scope().docUi.currentSpread);translateLeftTopLengthValues(s.data,e.l,e.t)}"layout"===o&&(yield addArtworkLayers(s),r=!0);const a=extractStoryFonts(e),l=[];a.forEach((e=>{const t=new Font(e.id,e.fo);l.push(loadAndCacheFont(t.name,t.url))})),yield Promise.all(l);const c=[],d=[],h=[],p=new Map,u=[],m="group"===o?generateDBID():null;if("layout"!==o||!1===i){const t=s.data.sps[0];insertBoxesToSpread(scope().docUi.currentSpread,t,m,e,c,h,d,p,u,n)}else{const t=Array.from(scope().currentDoc.spreads.values()),o=t.length;let i=-1;for(let r=0;r<o;r++){const o=t[r];if(i++,i<s.data.sps.length){insertBoxesToSpread(o,s.data.sps[i],m,e,c,h,d,p,u,n)}}}yield create([...d,...h,...c],void 0,r),"group"===o&&window.setTimeout((()=>{selectCreatedBoxes(u,scope().docUi.currentSpread)}),500)}}))}function insertBoxesToSpread(e,t,o,i,r,s,n,a,l,c){var d,h,p,u,m;let f,g=e.highestOrder(),y=e.lowestOrder();f=o?null===(d=t.boxes)||void 0===d?void 0:d.sort(((e,t)=>e.data.or-t.data.or)):null===(h=t.boxes)||void 0===h?void 0:h.sort(((e,t)=>t.data.or-e.data.or));const b=f?f.length:0;for(const t of f||[])if(o&&"BASELAYER"!==t.data.lyr)alert("Skipped frame because its not on base layer.");else{if(t.id=generateDBID(),l.push(t.id),t.parentId=scope().currentDoc.id,t.scopeId=scope().id,t.data.so=o?"group":"layout",t.data.spreadId=e.id,o&&b>1&&(t.data.bgi=o),o?(g=getOrder(g,1),t.data.or=g):(y=getOrder(0,y),t.data.or=y),o){const e=[...null!==(m=null===(u=null===(p=t.data.lock)||void 0===p?void 0:p.allows)||void 0===u?void 0:u.allowFrame)&&void 0!==m?m:[],"positionByMouse","delete"];t.data.lock&&t.data.lock.allows&&(t.data.lock.allows.allowFrame=e)}t.data.story&&addStory(n,a,i,t,c),t.data.doc&&addSubDocument(t,r,s,n,a,i,c),r.push(t)}}function addArtworkLayers(e){return __awaiter$v(this,void 0,void 0,(function*(){const t=new Map;for(const[o,i]of scope().currentDoc.layers)if("BASELAYER"===o)for(const o of e.data.lyr){o.aw=!0;const e=new Layer(o.id,o);t.set(e.id,e)}else t.set(o,i);const o=new Doc((new Nobs).replaceCollection(scope().currentDoc.layers,t),scope().currentDoc);yield update([scope().currentDoc.serialize(scope().id)],[o.serialize(scope().id)])}))}function addStory(e,t,o,i,r){const s=i.data.story;if(s){const n=o.stories.filter((e=>{var t;return e.id===(null===(t=i.data.story)||void 0===t?void 0:t.sId)}))[0];if(n){n.data.txt=JSON.parse(JSON.stringify(n.data.txt));let o=t.get(n.id);o||(o=generateDBID(),t.set(n.id,o),n.id=o,n.scopeId=scope().id,scaleAllLengthValues(n,r),e.push(n)),s.sId=o}}}function addSubDocument(e,t,o,i,r,s,n){var a,l;return __awaiter$v(this,void 0,void 0,(function*(){if(e.data.doc){const c=e.data.doc.na;if(c){const d=s.documents.filter((e=>e.data.na===c))[0];if(d){const c=(null!==(l=null===(a=s.template)||void 0===a?void 0:a.scopeId)&&void 0!==l?l:s.scope.scopeId)+"_"+d.data.na;if(d.data.na=c,e.data.doc.na=c,d.scopeId=scope().id,d.parentId=scope().id,scope().getDocByName(c))return;for(const e of d.data.sps){if(Array.isArray(e.boxes)){for(const a of e.boxes)a.data.doc&&addSubDocument(a,t,o,i,r,s,n),a.data.story&&addStory(i,r,s,a,n),a.scopeId=scope().id,t.push(a);delete e.boxes}o.push(d)}}}}}))}function selectCreatedBoxes(e,t){const o=[];for(const t of e){const e=scope().docUi.getWcBox(t);e&&o.push(e)}scope().selection=new Selection$1(o,t)}function removeArtworkFromCurrentSpread(){return __awaiter$v(this,void 0,void 0,(function*(){const e=new Set;for(const[t,o]of scope().currentDoc.layers)("BASELAYER"===t||o.mergedFromArtwork)&&e.add(t);const t=[],o=scope().docUi.currentSpread;for(const e of o.boxes.values())"layout"===e.snippetOrigin&&t.push(e.serialize(o.id,scope().currentDoc.id));yield remove(t),yield removeEmptyArtworkLayers(),yield scope().layersUi.setLayerValue("BASELAYER","mergedFromArtwork",!1)}))}function removeEmptyArtworkLayers(){return __awaiter$v(this,void 0,void 0,(function*(){const e=new Map;for(const[t,o]of scope().currentDoc.layers)if("BASELAYER"!==t&&o.mergedFromArtwork){let i=!0;for(const e of scope().currentDoc.spreads.values())for(const o of e.boxes.values())if(o.layerId===t){i=!1;break}!1===i&&e.set(t,o)}else e.set(t,o);const t=new Doc((new Nobs).replaceCollection(scope().currentDoc.layers,e),scope().currentDoc);yield update([scope().currentDoc.serialize(scope().id)],[t.serialize(scope().id)],void 0,!0)}))}const allOverlays=new Map;let overlaysVisible=!1;function getBoxesFromFrame(e){const t=[];if(e.groupMemberBoxIds)for(const o of e.groupMemberBoxIds){const e=scope().currentDoc.getBox(o);e&&t.push(e)}else if(e.id){const o=scope().currentDoc.getBox(e.id);o&&t.push(o)}return t}function optainBuyerOverlays(){if(clearOverlays(),config.isBuyer||config.isMobile)for(const e of scope().currentDoc.spreads.values()){const t=e.toHitTestFrames();if(scope().docUi.getDivForSelection(e.id)){const o=[];for(const e of t){let t;if(scope().externalGetOverlayCallbacks.length>0){const o=new BuyerPropertiesGroup(getBoxesFromFrame(e));t=scope().externalGetOverlayCallbacks[0](o.getExternalProperties())}t||(t=getBuyerOverlayDiv()),t.style.position="absolute",t.style.left=e.left+"px",t.style.top=e.top+"px",t.style.width=e.width+"px",t.style.height=e.height+"px",o.push(t)}allOverlays.set(e.id,o)}}}function drawBuyerOverlays(){if(!1===overlaysVisible){overlaysVisible=!0;for(const[e,t]of allOverlays){const o=scope().docUi.getDivForSelection(e);if(o)for(const e of t)o.appendChild(e)}}}function removeBuyerOverlays(){overlaysVisible=!1;for(const[e,t]of allOverlays){if(scope().docUi.getDivForSelection(e))for(const e of t)e.parentElement&&e.parentElement.removeChild(e)}}function getBuyerOverlayDiv(){const e=document.createElement("div");return"transparent"!==scope().currentDoc.buyerOverlayColor&&(e.style.border="4px solid "+scope().currentDoc.buyerOverlayColor,e.style.opacity="0.5"),e}function clearOverlays(){removeBuyerOverlays(),allOverlays.clear()}var __awaiter$w=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};let imageScaleTimeout=0;function toExternalImage(e){return{id:e.id,thumbUrl:e.thumbNailUrl(),thumbCssUrl:e.thumbNailCssUrl(),width:e.width,height:e.height}}function readPropertyId(e){const t=e.substr(0,2);let o=e,i=-1;if("ST"===t){const e=o.lastIndexOf("#");e&&(i=parseInt(o.substr(e+1)),o=o.substr(0,e))}return{id:o,prefix:t,paragraphIndex:i}}function getBoxFromPropertyId(e){const t=readPropertyId(e);if("ED_selection"===t.id){const e=scope().eddiActiveStory;if(e){const t=e.getBoxes();if(t.size)return t.values().next().value.box}}else{const e=scope().buyerPropertiesGroup.groupedProperties.get(t.id);if(e){const t=scope().getBox(e.boxes[0].boxId);if(t)return t.box}}}function getNumberMetaByExternalProperty(e,t=null){var o,i,r,s,n,a,l,c,d,h,p,u,m;if(t){if("image"===e.kind)switch(t){case"image-brightness":return{meta:WcNumberBox.getNumberMeta("brightness"),value:(null===(o=e.imageMeta)||void 0===o?void 0:o.brightness)||0};case"image-contrast":return{meta:WcNumberBox.getNumberMeta("contrast"),value:(null===(i=e.imageMeta)||void 0===i?void 0:i.contrast)||0};case"image-hueRotate":return{meta:WcNumberBox.getNumberMeta("hueRotate"),value:(null===(r=e.imageMeta)||void 0===r?void 0:r.hueRotate)||0};case"image-sepia":return{meta:WcNumberBox.getNumberMeta("sepia"),value:(null===(s=e.imageMeta)||void 0===s?void 0:s.sepia)||0};case"image-vivid":return{meta:WcNumberBox.getNumberMeta("saturate"),value:(null===(n=e.imageMeta)||void 0===n?void 0:n.vivid)||0};case"image-scale":return{meta:{min:(null===(a=e.imageMeta)||void 0===a?void 0:a.scaleHints.min)||0,max:(null===(l=e.imageMeta)||void 0===l?void 0:l.scaleHints.max)||1,digits:2,step:.01,postfix:"%",uiMultiplier:100,uiOffset:100*(1-((null===(c=e.imageMeta)||void 0===c?void 0:c.scaleHints.min)||1))},value:(null===(d=e.imageMeta)||void 0===d?void 0:d.scale)||0}}else if(("multi-line-text"===e.kind||"selection-text-style"===e.kind)&&"text-style-size"===t){if(null===(h=e.textStyle)||void 0===h?void 0:h.size.endsWith("%"))return{meta:{min:.5,max:30,digits:1,step:.1,postfix:"%"},value:parseFloat(null===(p=e.textStyle)||void 0===p?void 0:p.size.replace("%",""))};if(null===(u=e.textStyle)||void 0===u?void 0:u.size)return{meta:{min:3,max:100,digits:0,step:1,postfix:"pt"},value:parseFloat(null===(m=e.textStyle)||void 0===m?void 0:m.size.replace("pt",""))}}}else if("number"===e.kind){if(e.id.startsWith("NU_rotation"))return{meta:WcNumberBox.getNumberMeta("rotation"),value:"string"==typeof e.value?parseFloat(e.value):e.value};if(e.id.startsWith("NU_warpArchPhi"))return{meta:WcNumberBox.getNumberMeta("warpArchPhi"),value:"string"==typeof e.value?parseFloat(e.value):e.value}}}const api={getNumberUi(e,t=null){const o=getNumberMetaByExternalProperty(e,t);if(!o)return;function i(e){var t,i;return e*(null!==(t=null==o?void 0:o.meta.uiMultiplier)&&void 0!==t?t:1)+(null!==(i=null==o?void 0:o.meta.uiOffset)&&void 0!==i?i:0)}const r=o.meta;return{meta:{min:i(r.min),max:i(r.max),digits:r.digits,postfix:r.postfix,step:r.step,restrictRange:r.restrictRange,restrictStep:r.restrictStep},value:i(o.value)}},setNumberUiProperty(e,t=null,o){var i,r;return __awaiter$w(this,void 0,void 0,(function*(){const s=getNumberMetaByExternalProperty(e,t);if(!s)return api.setProperty(e.id,o);const n=(o-(null!==(i=null==s?void 0:s.meta.uiOffset)&&void 0!==i?i:0))/(null!==(r=null==s?void 0:s.meta.uiMultiplier)&&void 0!==r?r:1);if(t)if("image"===e.kind)switch(t){case"image-brightness":api.setImageMetaProperty(e.id,"brightness",n);break;case"image-contrast":api.setImageMetaProperty(e.id,"contrast",n);break;case"image-hueRotate":api.setImageMetaProperty(e.id,"hueRotate",n);break;case"image-scale":api.setImageMetaProperty(e.id,"scale",n);break;case"image-sepia":api.setImageMetaProperty(e.id,"sepia",n);break;case"image-vivid":api.setImageMetaProperty(e.id,"vivid",n);break;default:alert("Can't set invalid image meta property: "+t)}else"multi-line-text"!==e.kind&&"selection-text-style"!==e.kind||("text-style-size"===t?api.setTextStyleProperty(e.id,"size",n+s.meta.postfix):alert("Can't set invalid text style property: "+t));else{if("number"===e.kind)return api.setProperty(e.id,n);alert("Can't set invalid number property: "+e.kind+" / "+e.id)}}))},getJson:()=>JSON.stringify(scope().serializeAll(!0)),setJson(e){return __awaiter$w(this,void 0,void 0,(function*(){return loadScope(JSON.parse(e),void 0,"loadAlwaysFromServer")}))},clearSelection(){return __awaiter$w(this,void 0,void 0,(function*(){return scope().clearSelectionAndAllEditors()}))},deleteSelectedFrames(){return __awaiter$w(this,void 0,void 0,(function*(){return scope().removeItem()}))},selectFrames(e){return __awaiter$w(this,void 0,void 0,(function*(){yield scopeReadyAsync();const t=scope().docUi.currentSpread;if(t){const o=t.toHitTestFrames();for(const i of o){const o=getBoxesFromFrame(i),r=new BuyerPropertiesGroup(o).getExternalProperties();for(const i of r)if(i.id===e){const e=[];for(const t of o.values()){const o=scope().docUi.getWcBox(t.id);o&&e.push(o)}scope().selection=new Selection$1(e,t)}}}}))},selectSpread(e,t="entire"){return __awaiter$w(this,void 0,void 0,(function*(){yield scopeReadyAsync();const o=Array.from(scope().currentDoc.spreads.values())[e];if(!o)throw"selectSpread - Spread not found: #"+e;scope().docUi.setCurrentSpreadById(o.id,!0),scope().docUi.centerSpreadInView(t),scope().clearSelectionAndAllEditors(o)}))},getAllSpreads(){return __awaiter$w(this,void 0,void 0,(function*(){const e=[];let t=0;for(const o of scope().currentDoc.spreads.values())e.push({spreadId:o.id,index:t,name:o.name,width:o.width(),height:o.height(),thumbUrl:yield scope().currentDoc.getThumbnailUrl(o.id),pages:o.pages.length}),t++;return e}))},getAllProperties(){return __awaiter$w(this,void 0,void 0,(function*(){const e=[];yield scopeReadyAsync();for(const t of scope().currentDoc.spreads.values()){const o=yield api.getAllPropertiesBySpreadId(t.id);e.push(...o)}return e}))},getAllPropertiesBySpreadId(e){return __awaiter$w(this,void 0,void 0,(function*(){const t=[];yield scopeReadyAsync();const o=scope().currentDoc.spreads.get(e);if(!o)throw"Spread Id ["+e+"] not found.";{const e=o.toHitTestFrames();for(const o of e){const e=new BuyerPropertiesGroup(getBoxesFromFrame(o));t.push(Array.from(e.getExternalProperties()))}}return t}))},getAllRequiredProperties(){return __awaiter$w(this,void 0,void 0,(function*(){return yield scopeReadyAsync(),this.getAllRequiredPropertiesSync()}))},getAllRequiredPropertiesSync(){const e=[];for(const t of scope().currentDoc.spreads.values()){const o=api.getAllRequiredPropertiesBySpreadIdSync(t.id);e.push(...o)}return e},getAllRequiredPropertiesBySpreadId(e){return __awaiter$w(this,void 0,void 0,(function*(){return yield scopeReadyAsync(),this.getAllRequiredPropertiesBySpreadIdSync(e)}))},getAllRequiredPropertiesBySpreadIdSync(e){var t,o;const i=[],r=scope().currentDoc.spreads.get(e);if(!r)throw"Spread Id ["+e+"] not found.";{const e=r.toHitTestFrames();for(const r of e){const e=new BuyerPropertiesGroup(getBoxesFromFrame(r)),s=[];for(const i of e.getExternalProperties())(null===(t=i.textMeta)||void 0===t?void 0:t.isMandatory)?i.textMeta.defaultValue!==i.value&&s.push(i):(null===(o=i.imageMeta)||void 0===o?void 0:o.isMandatory)&&i.imageMeta.defaultValue!==i.value&&s.push(i);i.push(s)}}return i},setTextStyleProperty(e,t,o,i=scope().currentDoc.buyerTextStyleMode){return __awaiter$w(this,void 0,void 0,(function*(){if("ED_selection"===e)if("vAlign"===t){if(!scope().eddiActiveStory)throw"Set vAlign, Story not found.";if(!checkEnumValue("verticalStoryTextAlign",o))throw"Set vAlign, invalid value ["+o+"]";yield scope().closeEddi(),yield scope().selection.setValue("storyRef","verticalStoryTextAlign",o),scope().showEddi()}else if("hAlign"===t){const e=BuyerPropertiesGroup.getParagraphStylePropertyByNameAndValue(t,o);e&&scope().eddiStyleSelectedParagraph(e)}else{const e=BuyerPropertiesGroup.getTextStylePropertyByNameAndValue(t,o);if(e){let t=null;"default"!==i&&(scope().eddiHasRangeSelection&&"all-paragraphs"!==i||(t=scope().eddiGetSelection())),scope().eddiStyleSelectedContent(e,void 0,void 0,i),t&&scope().eddiSetSelection(t)}}else{const{id:i,paragraphIndex:r}=readPropertyId(e),s=scope().buyerPropertiesGroup.groupedProperties.get(i);if(!s)return void alert("setTextStyleProperty: Can't find grouped property with id=("+i+")");"story"===s.kind&&s.value.pts[r]&&BuyerPropertiesGroup.setTextStyleProperty(s,r,t,o)}const r=scope().selection.externalProperties.filter((t=>t.id===e))[0];r&&r.textStyle&&(r.textStyle[t]=o)}))},setImageMetaProperty(e,t,o){return __awaiter$w(this,void 0,void 0,(function*(){const i=scope().buyerPropertiesGroup.groupedProperties.get(e);if(!i)return void alert("setimageMetaProperty: Can't find grouped property with id=("+e+")");const r=i.boxes[0].boxId;if(scope().getBox(r)){if("imageRef"===i.kind&&"number"==typeof o){const i=scope().selection.externalProperties.filter((t=>t.id===e))[0];if(i&&"saturate"!==t&&"grayscale"!==t&&i.imageMeta&&(i.imageMeta[t]=o),"vivid"===t){let e=0,t=0;o<0?e=-o:o>0&&(t=o),yield scope().selection.setMultipleValues([{feature:"effect",property:"grayscale",value:e},{feature:"effect",property:"saturate",value:t}],!1,r)}else"scale"===t?(scope().selection.setImageScaleAbsolute(o,r),imageScaleTimeout&&window.clearTimeout(imageScaleTimeout),imageScaleTimeout=window.setTimeout((()=>{scope().selection.persistImageScale()}),500)):yield scope().selection.setValue("effect",t,o,!1,r)}}else alert("setimageMetaProperty: Can't find first box with id=("+r+")")}))},resetImageFilters(e){return __awaiter$w(this,void 0,void 0,(function*(){const t=scope().buyerPropertiesGroup.groupedProperties.get(e);if(!t)return void alert("resetImageFilters: Can't find grouped property with id=("+e+")");const o=t.boxes[0].boxId;scope().getBox(o)?yield scope().selection.setMultipleValues([{feature:"effect",property:"grayscale",value:0},{feature:"effect",property:"hueRotate",value:0},{feature:"effect",property:"sepia",value:0},{feature:"effect",property:"brightness",value:0},{feature:"effect",property:"contrast",value:0},{feature:"effect",property:"saturate",value:0}],!1,o):alert("resetImageFilters: Can't find first box with id=("+o+")")}))},setProperty(e,t){return __awaiter$w(this,void 0,void 0,(function*(){const{id:o,paragraphIndex:i}=readPropertyId(e),r=scope().buyerPropertiesGroup.groupedProperties.get(o);if(r)if("story"===r.kind){const o=r.value.pts[i];if(o)if("string"!=typeof t)alert("Invalid attempt to set story-text to type number ["+t+"]");else{BuyerPropertiesGroup.storyTextChangeDebounced(r,o,t);const i=scope().selection.externalProperties.filter((t=>t.id===e))[0];i&&(i.value=t)}}else{BuyerPropertiesGroup.boxPropertyChanged(r,t);const o=scope().selection.externalProperties.filter((t=>t.id===e))[0];!o||"string"!=typeof t&&"number"!=typeof t||(o.value=t)}else alert("Can't find grouped property with id=("+e+")")}))},uploadImages(e,t,o=!0){return __awaiter$w(this,void 0,void 0,(function*(){return(yield ImageRef.upload(e,t,o)).map((e=>toExternalImage(e)))}))},uploadImage(e,t,o=!0){return __awaiter$w(this,void 0,void 0,(function*(){const i=yield ImageRef.uploadSingleFile(e,t,o);return i?toExternalImage(i):null}))},getSerializedImage(e){const t=scope().images.get(e);return t?JSON.stringify(t.serialize()):null},addSerializedImage(e,t=!0){return __awaiter$w(this,void 0,void 0,(function*(){const o=JSON.parse(e),i=new Image$1(o.id,o.data),r=scope().resourcesImagesUi.getWcList();if(r){const e=yield r.createItems([i]);if(e.length>0){const o=scope().images.get(e[0]);o&&t&&ImageRef.createOrAssignImage(o)}}return toExternalImage(i)}))},getImages(e){const t=getBoxFromPropertyId(e);if(!t)return console.error("Can't find box for property with id=("+e+") - getImages"),[];let o=Array.from(scope().images.values());const i=t.lock.allowImageGroups;return i?(o=o.filter((e=>e.group&&i.indexOf(e.group)>=0)),o.map((e=>toExternalImage(e)))):[]},getImagesAsImage(e){const t=getBoxFromPropertyId(e);if(!t)return console.error("Can't find box for property with id=("+e+")- getImagesAsImage"),[];let o=Array.from(scope().images.values());const i=t.getValue("lock","allowImageGroups");return i?(o=o.filter((e=>e.group&&i.indexOf(e.group)>=0)),o):[]},getFonts(e){const t=getBoxFromPropertyId(e);if(!t)return console.error("Can't find box for property with id=("+e+") - getFonts"),[];let o=Array.from(scope().fonts.values());if(t){const e=t.lock.allowFontGroups;if(!e)return[];o=o.filter((t=>t.group&&e.indexOf(t.group)>=0))}return o.map((e=>({name:e.name,thumbUrl:e.thumbSvgUrl})))},getColors(e){const t=getBoxFromPropertyId(e);if(!t)return console.error("Can't find box for property with id=("+e+") - getFonts"),[];const o=new Set;if(t){const e=t.lock.allowColorGroups;if(e)for(const t of scope().colors.namedColorsSorted.values())t.group&&e.indexOf(t.group)>=0&&o.add(t.name)}const i=[];for(const e of o){const t=scope().colors.getSwatchByName(e);t&&i.push({name:t.name,color:t.toCssColor(100,100)})}return i},resizePrintess(e=!1){const t=config.providedContainerDiv,o=document.querySelector("#mainGrid");if(t)if(config.isMobile&&config.fullScreenOnMobile&&!config.hideControls)o.classList.add("printess-container-fullscreen"),t.classList.add("printess-container-fullscreen");else{o.classList.remove("printess-container-fullscreen"),t.classList.remove("printess-container-fullscreen");let e=t.offsetWidth||900,i=t.offsetHeight||600;config.hideControls||(i<400&&(i=400),e<300&&(e=300)),o.style.width=e+"px",o.style.height=i+"px"}setTimeout((()=>__awaiter$w(this,void 0,void 0,(function*(){yield scopeReadyAsync(),scope().docUi.centerSpreadInView()}))),e?100:1e3)},load(e,t="auto"){return __awaiter$w(this,void 0,void 0,(function*(){yield loadScope(e,void 0,t),window.setTimeout((function(){scope().docUi.centerSpreadInView()}),500)}))},insertLayoutSnippet(e){return __awaiter$w(this,void 0,void 0,(function*(){if(!(e&&e.indexOf("?DOC=")>=0))throw"Insert Layout-Snippet called with invalid snippeturl ["+e+"]";{yield scopeReadyAsync(),yield scope().clearSelectionAndAllEditors(scope().docUi.currentSpread);const t=e.split("?DOC=");yield addSnippet(t[0],t[1],"layout")}}))},insertGroupSnippet(e){return __awaiter$w(this,void 0,void 0,(function*(){if(!(e&&e.indexOf("?DOC=")>0))throw"Insert Group-Snippet called with invalid snippetUrl ["+e+"]";{yield scopeReadyAsync(),yield scope().clearSelectionAndAllEditors(scope().docUi.currentSpread);const t=e.split("?DOC=");yield addSnippet(t[0],t[1],"group")}}))},undo:()=>undo(),redo:()=>redo(),renderFirstPageImage(e,t="",o=400,i=400){return __awaiter$w(this,void 0,void 0,(function*(){const r=uploadProvider();if(!r)throw"No upload provider defined.";const s=[],n=scope().serializeAll(!0);let a;if("!PREVIEW!"!==t?a=n.documents.filter((e=>e.data.na=t))[0]:("!PREVIEW!"===t&&(a=n.documents.filter((e=>e.data.pre))[0]),a||(a=n.documents.filter((e=>e.data.pri))[0]),a||(a=n.documents[0])),!a)throw t?"Document not found, name="+t:"No primary Document found";a.data.sps=[a.data.sps[0]];const l=new FormData;try{const t=yield hb.Printess.renderDocumentImagesAsInMemoryData(n,a.data.na,o,i,!0);s.push(...t);for(let o=0;o<t.length;o++){const i=t[o],s=new Uint8Array(hb.heapu8().buffer,i.address,i.length),n=new Blob([s]);r.beforeAddingFormData&&r.beforeAddingFormData(l,n,e),l.append("file",n,e);return(yield r.upload(l)).url}throw"No document image rendered."}finally{s.forEach((e=>hb.free(e.address)))}}))}};var __decorate$z=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n},__awaiter$x=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};let WcExternalTextToolbar=(()=>{let e=class extends LitElement{constructor(){super(...arguments),this.propertyId="ED_selection",this.font="Noto Sans",this.size=baseTextStyleProps().fontSize.toString(),this.color="#000000",this.hAlign="left",this.vAlign="top",this.textAllows=[],this.type="area-toolbar"}static get styles(){return[desktopBuyerGroupStyles,css`
        :host, :host * {
          box-sizing: border-box;
        }
        :host {
          display: flex;
          align-items: center;
          justify-content: center;
        }
        :host > * {
          margin-bottom: 0px !important; /* to overwrite from desktopBuyerStyles */
         
        }
        
        .bar-icon {
            padding: 2px; 
            border: 1px solid var(--printess-textColor);
            background-color: var(--printess-maxContrastColorInverse);
            border-radius: 3px;
            cursor:pointer;
            height: 24px;
            width: 24px;
            margin-left: 4px;
        }
        .bar-icon:hover {
            background-color: var(--printess-panelBackgroundHover);
        }
         
        
        wc-icon {
          width: 18px;
          height: 18px;
        }
        .icon {
          width: 14px;
          height: 14px;
          margin-left: 7px;
        }
        #FONT, #SIZE {
          height: 24px; 
          font-size: 11pt;
          padding: 2px;
          width: 145px; 
          color: 1px solid var(--printess-textColor);
          background-color: var(--printess-maxContrastColorInverse);
          border: 1px solid var(--printess-textColor);
          cursor: pointer;
          white-space: nowrap; 
          display: flex;
          align-items: center;
          border-radius: 3px;
          overflow: hidden;
         
        }
        #FONT.area-toolbar {
          width: 120px;
          font-size: 10pt;
          flex-grow: 1;
        }
        #SIZE {
          width: 45px;
          font-size: 10pt;
          margin-left: 4px;
        }
        #SIZE.area-toolbar {
          font-size: 9pt;
          width: 30px;
        }
        #FONT:hover, #SIZE:hover {
          background-color: var(--printess-panelBackgroundHover);
        }

        #COLOR {
          padding: 2px; 
            border: 1px solid var(--printess-textColor);
            background-color: var(--printess-maxContrastColorInverse);
            border-radius: 3px;
            width: 24px;
            height: 24px;
            cursor: pointer;
            margin-left: 4px;
        } 
        #COLOR:hover {
          border-color:  var(--printess-maxContrastColor);
        }

        .eddi-toolbar {
          margin-left: 10px;
        }

        #FONT.eddi-toolbar {
          margin-left: 3px;
        }
        @media (max-width:  ${config.mobileDeviceWidth}px) {
            :host {
                padding-left: 5%;
                padding-top: 35px;
                width: 100%;
                display: block;
            }
            
        }
    `]}render(){return"area-toolbar"===this.type&&(this.style.justifyContent="space-between"),html`
      ${this.textAllows.indexOf("font")>=0?html`
        ${"eddi-toolbar"===this.type?html`<wc-icon class="icon" icon="font" primaryColor="head-toolbar"></wc-icon>`:""}
        <div class="${this.type}" id="FONT" style="font-family:${this.font};"  @click=${e=>this.fontClick(e,this.propertyId)}>
          ${this.font}
        </div>`:""}
      ${this.textAllows.indexOf("size")>=0?html`
        ${"eddi-toolbar"===this.type?html`<wc-icon class="icon" icon="text-size" primaryColor="head-toolbar"></wc-icon>`:""}
        <div class="${this.type}" id="SIZE" @click=${e=>this.sizeClick(e,this.propertyId)}>
          ${this.size}
        </div>`:""}
      ${this.textAllows.indexOf("color")>=0?html`
        ${"eddi-toolbar"===this.type?html`<div style="width: 10px"></div>`:""}
        <div id="COLOR" class="${this.type}" style="background-color: ${this.color}" @click=${e=>this.colorClick(e,this.propertyId,this.color)}>
        </div>`:""}
      ${this.textAllows.indexOf("horizontalAlignment")>=0?html`
      <div class="bar-icon"  @click=${e=>this.hAlignClick(e,this.propertyId)}>
        <wc-icon id="HALIGN" icon="${this.getHAlignIcon(this.hAlign)}"></wc-icon>
        </div>`:""}
      ${this.textAllows.indexOf("verticalAlignment")>=0&&"eddi-toolbar"===this.type?html`
        <div class="bar-icon"  @click=${e=>this.vAlignClick(e,this.propertyId)}>
          <wc-icon id="VALIGN" icon="${this.getVAlignIcon(this.vAlign)}"></wc-icon>
        </div>`:""}
      ${"eddi-toolbar"===this.type?html`
        <div class="bar-icon eddi-toolbar"  @click=${()=>scope().clearSelectionAndAllEditors()}>
          <wc-icon primaryColor="headline"  icon="close"></wc-icon>
        </div>`:""}
    `}getHAlignIcon(e){let t=enums.horizontalTextAlign.indexOf(e);return t<0&&(t=0),enumIcons.horizontalTextAlign[t]}getVAlignIcon(e){let t=enums.verticalStoryTextAlign.indexOf(e);return t<0&&(t=0),enumIcons.verticalStoryTextAlign[t]}hAlignClick(e,t){const o=[];for(const e of enums.horizontalTextAlign)o.push({icon:this.getHAlignIcon(e),caption:"",callback:()=>{this.hAlign=e,api.setTextStyleProperty(t,"hAlign",e)}});showCtxMenu(e,o,-e.offsetX-3,27-e.offsetY,27,!0)}vAlignClick(e,t){const o=[];for(const e of enums.verticalStoryTextAlign)o.push({icon:this.getVAlignIcon(e),caption:"",callback:()=>{this.vAlign=e,api.setTextStyleProperty(t,"vAlign",e)}});showCtxMenu(e,o,-e.offsetX-3,27-e.offsetY,27,!0)}fontClick(e,t){const o=api.getFonts(t),i=[];for(const e of o)i.push({caption:e.name,font:e.name,textOnly:!0,callback:()=>{this.font=e.name,api.setTextStyleProperty(t,"font",e.name)}});showCtxMenu(e,i,-e.offsetX-3,27-e.offsetY,180,!0)}sizeClick(e,t){const o=["6pt","7pt","8pt","10pt","12pt","14pt","16pt","20pt","24pt","28pt","32pt","36pt","42pt","48pt"],i=[];for(const e of o)i.push({caption:e,textOnly:!0,callback:()=>{this.size=e,api.setTextStyleProperty(t,"size",e)}});showCtxMenu(e,i,-e.offsetX-3,27-e.offsetY,50,!0)}colorClick(e,t,o){return __awaiter$x(this,void 0,void 0,(function*(){const i=api.getColors(t);showColorList(e.clientX,e.clientY,i.map((e=>e.color)),(e=>{this.color=e,api.setTextStyleProperty(t,"color",e)}),o)}))}};return __decorate$z([property({type:String})],e.prototype,"propertyId",void 0),__decorate$z([property({type:String})],e.prototype,"font",void 0),__decorate$z([property({type:String})],e.prototype,"size",void 0),__decorate$z([property({type:String})],e.prototype,"color",void 0),__decorate$z([property({type:String})],e.prototype,"hAlign",void 0),__decorate$z([property({type:String})],e.prototype,"vAlign",void 0),__decorate$z([property({type:Array})],e.prototype,"textAllows",void 0),__decorate$z([property({attribute:!0,type:String})],e.prototype,"type",void 0),e=__decorate$z([customElement("wc-external-text-toolbar")],e),e})();var __decorate$A=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n},__awaiter$y=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};let WcxTextArea=(()=>{let e=class extends LitElement{constructor(){super(...arguments),this.property=null,this.uploadProgress=-1,this.scaleValue=0,this.brightness=0,this.contrast=0,this.hueRotate=0,this.sepia=0,this.vivid=0,this.levels=!1,this.mode="all",this.lastPosition=null}static get styles(){return[desktopBuyerGroupStyles,css`
            :host, :host * {
                box-sizing: border-box;
            }
            :host {
              display: block;
              position: relative;
            }
            label {
              font-size: var(--printess-labelSize);
              margin-left: 10px;
            }
            .level-head {
              display: flex;
              flex-direction: row;
            /*  padding: 3px;
              border: 1px solid var(--printess-textColor);*/
            }
            .level-head > wc-icon {
              width: 14px;
              height: 14px;
            }
            .level-head > label {
              margin-left:3px;
            }
            .level-head:hover > label {
              color: var(--printess-headlineColor);
            }
            button {
              font-size: var(--printess-labelSize);
              border: 1px solid var(--printess-textColor);
              border-radius: 2px;
              max-height: 20px;
              width: fit-content;
              padding-left: 10px;
              padding-right: 10px;
              margin-left: auto;
              margin-right: auto;
              margin-top: 2px;
              cursor: pointer;
            }

            .small-icon {
              position: absolute; 
              width: 33px; 
              height: 33px;
            }
            @media (max-width:  ${config.mobileDeviceWidth}px) {
              [icon="trash-solid"] {
                width: 18px; 
                height: 23px; 
                padding-top: 5px; 
                justify-self: flex-end;
              }
              :host {  
                display: grid;
                grid-template-columns: 1fr 35px;
                padding-left: 20px;
                padding-right: 20px;
              }
              
            }
           
          
        `]}updated(e){if(e.has("property")){const e=this.property;e&&e.imageMeta&&(this.scaleValue=e.imageMeta.scale,this.vivid=e.imageMeta.vivid,this.brightness=e.imageMeta.brightness,this.contrast=e.imageMeta.contrast,this.sepia=e.imageMeta.sepia,this.hueRotate=e.imageMeta.hueRotate)}}render(){return this.property&&"image"===this.property.kind?config.isMobile?html`
        ${this.renderImageScaleUi()}
      `:html`
        ${this.renderImageUploadUi()}
        ${this.renderImageScaleUi()}
        ${this.renderImageUploadProgressUi()}
      `:html``}get isValid(){if(this.property){const e=this.property;if(e.imageMeta){const t=e.imageMeta,o=e.value;if(t.isMandatory&&o.toLowerCase()===t.defaultValue.toLowerCase())return{ok:!1,hint:"You need to replace this image."}}}return{ok:!0,hint:""}}openSelectImageDialog(){var e;new WcSelectImageDialog("callback",null===(e=this.property)||void 0===e?void 0:e.id).showDialog((e=>{this.property&&(scope().selection.externalProperties=[],api.setProperty(this.property.id,e.id))}))}getImages(){return this.property?api.getImages(this.property.id).filter((e=>{var t;return e.id!==(null===(t=this.property)||void 0===t?void 0:t.value)})):[]}renderImageScaleUi(){if(!this.property)return"";const e=this.property;return-1===this.uploadProgress&&e&&e.imageMeta&&"pick"!==this.mode?html`<wc-number-box mode="slider" .value=${this.scaleValue} title=${this.scaleValue}
        property="customMinMax" customMin="${e.imageMeta.scaleHints.min}" customMax="${e.imageMeta.scaleHints.max}"
        .callback=${(e,t)=>this.setScaleValue(e,t)}></wc-number-box>
        
        ${config.isMobile?html`<wc-icon @click=${()=>this.reset()} primaryColor="head-toolbar" icon="trash-solid" ></wc-icon>`:""}
        `:""}reset(){const e=this.property;e&&e.imageMeta&&this.setScaleValue(e.imageMeta.scaleHints.min,!1)}renderImageUploadUi(){if(!this.property)return"";const e=this.property,t=this.isValid;return-1===this.uploadProgress&&e.imageMeta&&"scale"!==this.mode?html`   
      <div class="imageListWrapper"  style="padding:0; overflow: hidden;">
        <div class="imageList">

          <div class="imageItem" @click=${()=>this.openSelectImageDialog()}  >
            <div class="imageBox" style="background-image: ${e.imageMeta.thumbCssUrl};" ></div>
          </div>


          <div class="small-image-list">
            <div class="small-image-item" style="position: relative;" @click=${()=>this.openSelectImageDialog()}  >
              <wc-icon  primaryColor="medium" class="small-icon" icon="plus" ></wc-icon>     
            </div>
            ${this.getImages().map((t=>html`
              <div class="small-image-item"  @click=${()=>setProperty(e.id,t.id)}  >
                <div class="imageBox" style="background-image: ${t.thumbCssUrl};" ></div>
              </div>
            `))}
          </div>
         
       
        </div>
        ${t.ok?"":html`<p style="color: red; margin-top: 5px;">${t.hint}</p>`}
      </div>
      
     

      ${this.renderLevelUi()}

    `:""}assignImage(e,t){return __awaiter$y(this,void 0,void 0,(function*(){yield setProperty(e,t),scope().selectionPropertiesUi.requestUpdate()}))}renderLevelUi(){if(this.property&&this.property.imageMeta&&!config.isMobile){const e=this.property.imageMeta.allows,t=e.indexOf("brightness")>=0,o=e.indexOf("contrast")>=0,i=e.indexOf("vivid")>=0,r=e.indexOf("sepia")>=0,s=e.indexOf("hueRotate")>=0;return html`
  <div class="level-head" @click=${()=>this.toggleLevels()}>
    <wc-icon  
       icon="${this.levels?"carret-down-solid":"carret-right-solid"}"></wc-icon><label>${this.levels?"Hide Image Filters":"Show Image Filters"}</label>
  </div>
  ${this.levels?html`
    <div style="display: grid; grid-template-columns: 1fr 1fr;">
      ${t?html`<div><label>Brightness</label><wc-number-box mode="slider" .value=${this.brightness} property="brightness"  .callback=${(e,t)=>this.setMetaValue("brightness",e,t)}  ></wc-number-box></div>`:""}
      ${o?html`<div><label>Contrast</label><wc-number-box mode="slider" .value=${this.contrast} property="contrast" .callback=${(e,t)=>this.setMetaValue("contrast",e,t)} ></wc-number-box></div>`:""}
      ${i?html`<div><label>Saturation</label><wc-number-box mode="slider" .value=${this.vivid} property="saturate"  .callback=${(e,t)=>this.setMetaValue("vivid",e,t)}  ></wc-number-box></div>`:""}
      ${r?html`<div><label>Sepia</label><wc-number-box mode="slider" .value=${this.sepia} property="sepia" .callback=${(e,t)=>this.setMetaValue("sepia",e,t)}  ></wc-number-box></div>`:""}
      ${s?html`<div><label>Hue Rotate</label><wc-number-box mode="slider" .value=${this.hueRotate} property="hueRotate" .callback=${(e,t)=>this.setMetaValue("hueRotate",e,t)} ></wc-number-box></div>`:""}
      ${t||o||i||s?html`
        <button @click=${()=>this.resetLevels()}>RESET</button>
      `:""} 
  </div>`:""}
  `}return""}toggleLevels(){this.levels=!this.levels}resetLevels(){this.property&&(api.resetImageFilters(this.property.id),this.sepia=0,this.brightness=0,this.contrast=0,this.hueRotate=0,this.vivid=0)}setMetaValue(e,t,o){this.property&&(setimageMetaProperty(this.property.id,e,t),o||(this[e]=t))}setScaleValue(e,t){this.property&&(t||(this.scaleValue=e),scope().selectionPropertiesUi.mobileButtonBarValue=e,setimageMetaProperty(this.property.id,"scale",e))}renderImageUploadProgressUi(){return this.uploadProgress>=0&&this.uploadProgress<=100?html`  
      <div class="image-upload-progress" >
        <div style="width: ${100*this.uploadProgress}%">${Math.round(1e4*this.uploadProgress)/100+"%"}</div>
      </div>`:""}getLabel(){return this.property?this.property.label:""}};return __decorate$A([property({attribute:!1,type:Object})],e.prototype,"property",void 0),__decorate$A([property({type:Number})],e.prototype,"uploadProgress",void 0),__decorate$A([property({type:Number})],e.prototype,"scaleValue",void 0),__decorate$A([property({type:Number})],e.prototype,"brightness",void 0),__decorate$A([property({type:Number})],e.prototype,"contrast",void 0),__decorate$A([property({type:Number})],e.prototype,"hueRotate",void 0),__decorate$A([property({type:Number})],e.prototype,"sepia",void 0),__decorate$A([property({type:Number})],e.prototype,"vivid",void 0),__decorate$A([property({type:Boolean})],e.prototype,"levels",void 0),__decorate$A([property({type:String})],e.prototype,"mode",void 0),e=__decorate$A([customElement("wc-external-image")],e),e})();var __decorate$B=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n};let WcExternalNumberBox=(()=>{let e=class extends LitElement{constructor(){super(...arguments),this.property=null,this.meta=null,this.numberValue=0}static get styles(){return[desktopBuyerGroupStyles,css`
            :host, :host * {
                box-sizing: border-box;
            }
            :host {  
              display: grid;
              grid-template-columns: 1fr;    
            }

            @media (max-width: ${config.mobileDeviceWidth}px) {
              :host {
                grid-template-columns: 1fr 35px;
                padding-left: 20px;
                padding-right: 20px;
              }
            }
          
            label {
              font-size: var(--printess-labelSize);
              margin-left: 10px;
            }
           
            button {
              font-size: var(--printess-labelSize);
              border: 1px solid var(--printess-textColor);
              border-radius: 2px;
              max-height: 20px;
              width: fit-content;
              padding-left: 10px;
              padding-right: 10px;
              margin-left: auto;
              margin-right: auto;
              margin-top: 2px;
              cursor: pointer;
            }

            wc-icon {
              width: 18px; 
              height: 23px; 
              padding-top: 5px; 
              justify-self: flex-end;
            }
           
          
        `]}updated(e){var t;if(e.has("property")){const e=this.property;if(e)if(this.meta)switch(this.meta){case"text-style-size":this.numberValue=new Length((null===(t=e.textStyle)||void 0===t?void 0:t.size)||"12pt").value}else"number"==typeof e.value&&(this.numberValue=e.value)}}get numberMeta(){if(this.property)return getNumberMetaByExternalProperty(this.property,this.meta)}render(){const e=this.numberMeta;return this.property&&e?(console.warn("value="+e.value),html`
     
     ${config.isMobile?"":html`<p>${this.property.label}</p>`}
     
      <wc-number-box mode="slider" .customMeta=${e.meta}  .value=${e.value} title=${this.property.label}
          property="customMeta"  .callback=${(e,t)=>this.setNumberValue(e,t)}></wc-number-box>
     
      ${config.isMobile?html`<wc-icon @click=${()=>this.reset()} primaryColor="head-toolbar" icon="trash-solid"  ></wc-icon>`:""}
    `):html``}reset(){var e;if("image-scale"===this.meta)this.setNumberValue(1,!1);else if(null===(e=this.property)||void 0===e?void 0:e.id.startsWith("NU_warpArchPhi"))this.setNumberValue(90,!1);else{const e=this.numberMeta;let t=0;const o=e?e.meta.min:0,i=e?e.meta.max:0;t=o<0&&i?i+o:o,this.setNumberValue(t,!1)}}setNumberValue(e,t){var o,i,r,s;if(this.property&&(config.isMobile&&("text-style-size"===this.meta?scope().selectionPropertiesUi.mobileButtonBarLengthValue=new Length(e+(null!==(i=null===(o=this.numberMeta)||void 0===o?void 0:o.meta.postfix)&&void 0!==i?i:"pt")):scope().selectionPropertiesUi.mobileButtonBarValue=e),!t||this.property.id.startsWith("NU_warpArchPhi"))){if(this.meta)switch(this.meta){case"text-style-size":setTextStyleProperty(this.property.id,"size",e+(null!==(s=null===(r=this.numberMeta)||void 0===r?void 0:r.meta.postfix)&&void 0!==s?s:"pt"));break;case"image-brightness":setImageMetaProperty(this.property.id,"brightness",e);break;case"image-contrast":setImageMetaProperty(this.property.id,"contrast",e);break;case"image-hueRotate":setImageMetaProperty(this.property.id,"hueRotate",e);break;case"image-scale":setImageMetaProperty(this.property.id,"scale",e);break;case"image-sepia":setImageMetaProperty(this.property.id,"sepia",e);break;case"image-vivid":setImageMetaProperty(this.property.id,"vivid",e);break;default:alert("Meta Property not handled in slider: "+this.meta)}else setProperty(this.property.id,e);this.numberValue=e}}};return __decorate$B([property({attribute:!1,type:Object})],e.prototype,"property",void 0),__decorate$B([property({attribute:!0,type:String})],e.prototype,"meta",void 0),__decorate$B([property({type:Number})],e.prototype,"numberValue",void 0),e=__decorate$B([customElement("wc-external-number-box")],e),e})();var __decorate$C=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n};let WcExternalColor=(()=>{let e=class extends LitElement{constructor(){super(...arguments),this.property=null}static get styles(){return[desktopBuyerGroupStyles,css`
        :host, :host * {
            box-sizing: border-box;
        }
        :host {
          display: block;
          position: relative;
        }

       
        wc-color-grid {
          margin-bottom: 4px !important; /* to overwrite from desktpoBuyerStyles */
        }

        @media (max-width:  ${config.mobileDeviceWidth}px)  {
        :host {
          height: 100%;
          overflow: scroll;
          overflow-y: hidden;
        }
      }
       
       
    `]}render(){if(!this.property||"color"!==this.property.kind)return html``;const e=this.property.value+"";let t;const o=scope().colors.getSwatchByName(e);if(o)t=new ColorRef(o);else{const o=Color.parseRgbColor(e);t=o?new ColorRef(o):ColorRef.Black_Color()}const i=config.isMobile?"inline":"popup";return html`
         <wc-color-grid mode="${i}" origin="None" selector=""  
         .colorHexValue=${t.color.toRgbHexColor()}  .colors=${api.getColors(this.property.id).map((e=>({name:e.name,value:e.color})))}
         .callback=${e=>this.setValue(e)} ></wc-color-grid>
    `}setValue(e){this.property&&e&&(e.isSwatch()?(setProperty(this.property.id,e.name),this.property.value=e.name):(setProperty(this.property.id,e.toRgbHexColor()),this.property.value=e.toRgbHexColor()),this.requestUpdate())}};return __decorate$C([property({attribute:!1,type:Object})],e.prototype,"property",void 0),e=__decorate$C([customElement("wc-external-color")],e),e})();var __decorate$D=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n},__awaiter$z=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};let WcExternalSidebar=(()=>{let e=class extends LitElement{constructor(){super(...arguments),this.mode="all",this.uploadProgress=-1,this.groupSnippets=html`loading ...`,this.groupSnippetsTags="",this._lastpropKind=null}static get styles(){return[desktopBuyerGroupStyles,css`
      :host, :host * {
          box-sizing: border-box;
      }
      .form {
        width: 100%;
      }
      .form >  vaadin-text-field {
        width: 100%;
      } 
      .form >  vaadin-select {
        width: 100%;
      }
      .colors {
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
        margin-bottom: 7px; 
      }
      .colors > * {
        width: min-content;
        display: inline-block;
        margin-right: 4px;
      } 
      .snippet-thumb {
        width: 100px; 
        height: 100%; 
        margin: 5px;
        cursor: pointer;
      }
      `]}renderGroupSnippets(){const e=scope().docUi.getSnippetClusterTags("groupSnippets");return e!==this.groupSnippetsTags?this._renderGroupSnippets().then((t=>{this.groupSnippets=t,this.groupSnippetsTags=e})):e||(this.groupSnippets=html``),html`${this.groupSnippets}`}renderProperties(){if(this._lastpropKind=null,this.selection.externalProperties.length>0){const e=this.selection.externalProperties.filter((e=>"color"===e.kind));return html`
          ${e.length?html`
            <div class="colors">
              ${e.map((e=>html`<wc-external-color .property=${e}></wc-external-color>`))}
            </div>
            <div class="seperator" style="margin-top: 5px;"></div>
          `:""}
          ${this.selection.externalProperties.map(((e,t,o)=>this.renderProperty(e,t,o)))}
          <div class="seperator"></div>
          <button @click=${()=>scope().clearSelection()}>DONE</button>`}return html``}_renderGroupSnippets(){return __awaiter$z(this,void 0,void 0,(function*(){const e=yield scope().docUi.getSnippetCluster("groupSnippets");return html`
      <div  style="display: flex; flex-wrap: wrap; flex-direction: row;">
        ${e.map((e=>this.renderCluster(e)))}
      </div>`}))}renderCluster(e){return html`
      <div class="header-bar" style="width: 100%;"><div class="header-bar-title">${e.name}</div></div>
      ${e.snippets.map((e=>html`
          <img src="${e.thumbUrl}" class="snippet-thumb"  style="background-color: ${e.bgColor};" @click=${()=>api.insertGroupSnippet(e.snippetUrl)}/>
      `))}
    `}sep(){return""}renderProperty(e,t,o){if("color"===e.kind);else if("single-line-text"===e.kind)return html`${this.sep()}<wc-external-text-area .property=${e}></wc-external-text-area>`;if("number"===e.kind)return html`${this.sep()}<wc-external-number-box .property=${e}></wc-external-number-box>`;if("multi-line-text"===e.kind){const i=t===o.length-1||o[t].id.substr(0,20)!==o[t+1].id.substr(0,20),r=0===t||o[t].id.substr(0,20)!==o[t-1].id.substr(0,20),s=e.textStyle;return s?html`${this.sep()}
        ${s.allows.length>2||-1===s.allows.indexOf("color")?html`
        <wc-external-text-toolbar style="${r?"margin-top: 12px;":"margin-top: 0px;"} margin-bottom: 4px;" type="area-toolbar" .textAllows=${s.allows}
          propertyId="${e.id}" font="${s.font}" size="${s.size}" vAlign="${s.vAlign}" hAlign="${s.hAlign}" color="${s.color}"
        ></wc-external-text-toolbar>`:""}
        <wc-external-text-area style="${i?"margin-bottom: 12px;":"margin-bottom: 0px;"}" .property=${e}></wc-external-text-area>
        
        `:html`no text style found`}return"image"===e.kind?html`${this.sep()}<wc-external-image .property=${e}></wc-external-image>`:""}shouldRenderProperties(){const e=this.selection.externalProperties;return!!this.selection&&(this.selection.boxes.size>1||1===this.selection.boxes.size&&"rookie"===scope().buyerSideMode&&(!scope().eddiActive()&&(!scope().currentDoc.showBuyerEddi||e.filter((e=>"multi-line-text"===e.kind)).length!==e.length)))}render(){return config.isBuyer?this.shouldRenderProperties()?this.renderProperties():this.renderGroupSnippets():html``}};return __decorate$D([property({attribute:!1,type:Object})],e.prototype,"selection",void 0),__decorate$D([property()],e.prototype,"selectedTool",void 0),__decorate$D([property({type:String})],e.prototype,"mode",void 0),__decorate$D([property({type:Number})],e.prototype,"uploadProgress",void 0),__decorate$D([property({type:Object,attribute:!1})],e.prototype,"groupSnippets",void 0),e=__decorate$D([customElement("wc-external-sidebar")],e),e})();var __decorate$E=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n};let WcExternalSelect=(()=>{let e=class extends LitElement{constructor(){super(...arguments),this.property=null,this.meta=null}static get styles(){return[desktopBuyerGroupStyles,css`
        :host, :host * {
            box-sizing: border-box;
        }
        :host {
             
        }

        .icon {
          width: 20px;
          height: 20px;
        }

        .icons-wrapper {
          display: flex;
          flex-direction: row;
          flex-wrap: wrap;
          width: 100%;
          min-height: 30px;
          justify-content: center;
        }
        .icons {
          display: grid;
          grid-template-rows: 26px;
          justify-content: flex-start;
          align-items: center;
          grid-column-gap: 15px;
        }
        .icon-wrapper {
          padding: 2px; 
          border: 1px solid var(--printess-panelBackgroundSelected);
          border-radius: 3px;
        }
        .icon-wrapper:hover {
          background-color: var(--printess-panelBackgroundHover);
        }
       
       
    `]}get items(){let e,t=[""];if(this.property&&this.meta)switch(this.meta){case"text-style-hAlign":t=enums.horizontalTextAlign,e=enumIcons.horizontalTextAlign}const o=[];for(let i=0;i<t.length;i++)"bullet"!==t[i]&&(e?o.push({key:t[i],label:t[i],icon:e[i]}):o.push({key:t[i],label:t[i],icon:""}));return o}render(){return this.property?html`
    <div class="icons-wrapper" >
         
        <div class="icons" style="grid-template-columns: repeat(${this.items.length}, 25px);">
            ${this.items.map((e=>html`<div class="icon-wrapper" title="${e.label}" 
                @click=${()=>this.setValue(e.key)}
                style="border-color: ${this.isSelected(e.key)?"var(--printess-headlineColor)":"var(--printess-textColor)"}; background-color: ${this.isSelected(e.key)?"var(--printess-panelBackgroundSelected)":"transparent"};">
            <wc-icon  class="icon"
                primaryColor="${this.isSelected(e.key)?"headline":"text"}"  
                icon="${e.icon||"empty"}" 
            ></wc-icon></div>`))}
        </div>
    </div>
            `:html``}isSelected(e){return!(!this.property||!this.property.textStyle||"text-style-hAlign"!==this.meta)&&this.property.textStyle.hAlign===e}setValue(e){if(this.property){if(this.property.textStyle&&"text-style-hAlign"===this.meta){const t=e;this.property.textStyle.hAlign=t,setTextStyleProperty(this.property.id,"hAlign",t),scope().selectionPropertiesUi.mobileButtonBarStringValue=t,scope().selectionPropertiesUi.requestUpdate()}this.requestUpdate()}}};return __decorate$E([property({attribute:!1,type:Object})],e.prototype,"property",void 0),__decorate$E([property({attribute:!0,type:String})],e.prototype,"meta",void 0),e=__decorate$E([customElement("wc-external-select")],e),e})();var __decorate$F=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n};let WcmSelectionStoryLength=(()=>{let e=class extends LitElement{constructor(){super(...arguments),this.lengthProperty="fontSize",this.titleChangedCallback=null}static get styles(){return css`
            :host, :host * {
                box-sizing: border-box;
                
            }

           
            wc-number-box {
                width: calc(100% - 60px);
                margin-left: 30px;
                margin-right: 30px;
                height: 30px;
            }
        `}render(){return this.selection&&this.selection.getStory()?(scope().selectionPropertiesUi.mobileButtonBarValue=this.ptValue,html`        
          
      ${this.showRange?html`
        <wc-number-box mode="slider" .value="${this.ptValue}" .callback=${e=>this.sliderChange(e)} 
              textLengthProperty="${this.lengthProperty}"
              property="${this.isPercentValue?"genericPercentProperty":"genericPtProperty"}" ></wc-number-box>
        
      `:html`
          <wc-length-box .callback=${e=>this.lengthChanged(e)} .value=${this.uiLength} label=""></wc-length-box>
      `}
        
      
`):html`Please select a text frame`}get caption(){switch(this.lengthProperty){case"fontSize":return"Font Size";case"lineHeight":return"Line Height";case"baselineShift":return"Baseline Shift";default:assertNever$1(this.lengthProperty)}}get showRange(){return!0}get uiLength(){return this.selection?this.selection.getFirstParagraphTextStyleProperty(this.lengthProperty):null}get story(){return this.selection?this.selection.getStory():null}lengthChanged(e){if(this.selection&&(!this.uiLength||e.toString()!==this.uiLength.toString())){const t={};t[this.lengthProperty]=e,this.selection.setFirstParagraphTextStyle(t)}}get isPercentValue(){const e=this.selection.getFirstParagraphTextStyleProperty(this.lengthProperty);return e&&("%"===e.unit||"%%"===e.unit)}get ptValue(){return 10}sliderChange(e){if(this.selection){const t=new Length(e,this.isPercentValue?"%":"pt"),o={};o[this.lengthProperty]=t,this.selection.setFirstParagraphTextStyle(o),this.requestUpdate()}}};return __decorate$F([property({attribute:!1,type:Object})],e.prototype,"selection",void 0),__decorate$F([property()],e.prototype,"lengthProperty",void 0),e=__decorate$F([customElement("wcm-selection-story-length")],e),e})();var __decorate$G=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n};let WcmSelectionStoryTracking=(()=>{let e=class extends LitElement{static get styles(){return css`
            :host, :host * {
                box-sizing: border-box;
            }

            wc-number-box {
                width: calc(100% - 60px);
                margin-left: 30px;
                margin-right: 30px;
                height: 30px;
            }
        `}render(){return this.selection&&this.selection.getStory()?(scope().selectionPropertiesUi.mobileButtonBarValue=this.tracking,html`              
         <wc-number-box mode="slider"  .value="${this.tracking}" .callback=${e=>this.trackingChanged(e)} 
            property="tracking" ></wc-number-box>
           `):html`Please select a text frame`}get tracking(){return this.selection?this.selection.getFirstParagraphTextStyleProperty("tracking"):0}trackingChanged(e){this.selection&&(this.selection.setFirstParagraphTextStyle({tracking:e}),scope().selectionPropertiesUi.mobileButtonBarValue=e,this.requestUpdate())}};return __decorate$G([property({attribute:!1,type:Object})],e.prototype,"selection",void 0),e=__decorate$G([customElement("wcm-selection-story-tracking")],e),e})();var __decorate$H=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n};let WcSelectionPathText=(()=>{let e=class extends LitElement{static get styles(){return[desktopPropertyStyles,css`
            :host, :host * {
                box-sizing: border-box;
            } 
            ul {
                list-style: none;
                width: 100%;
                padding: 0;
                margin: 0;
            }
            li {
                width: 100%;
                padding: 4px;
                background-color: rgba(255,255,255,0.2);
                border: 1px solid  rgba(0,0,0,0.2);
                margin: 3px;
                cursor: pointer;
                position: relative;
             
            }
            li:after {
              position: absolute; 
              right: 9px;
               
              top: 14px;
              content: '+';
              line-height: 14px;
              text-align: center;
              height: 14px;
              width: 14px;
              font-size: 17px;
              color: white;
              background-color: var(--printess-headlineColor);
            }
            li:hover {
                background-color: rgba(255,255,255,1);
                border-top: 1px solid  rgba(0,0,0,0.7);
                
            }
            svg {
              height: 32px;
              margin-left: 50px;
            }`]}reloadFonts(){if(this.shadowRoot){const e=this.shadowRoot.querySelector("WC-FONT-COMBO");e&&e.fillFontList()}}renderContentUi(){return this.selection.allows("allowPathText","content")?html`
        <wc-text-area feature="pathText" property="textOnPath" .selection=${this.selection} ></wc-text-area> 
        `:""}renderFontUi(){return this.selection.allows("allowPathText","font")?html`
            <wc-font-combo feature="pathText" property="pathTextFont" .selection=${this.selection} ></wc-font-combo>
        `:""}renderHorizontalPathTextAlignUi(){return this.selection.allows("allowPathText","alignment")?html`
             <wc-select feature="pathText" property="horizontalPathTextAlign" .selection=${this.selection}></wc-select>
        `:""}renderStartXUi(){return this.selection.allows("allowPathText","startX")?html`
            <wc-number-box feature="pathText" property="startX" .selection=${this.selection}></wc-number-box>
        `:""}renderDistanceUi(){return this.selection.allows("allowPathText","distance")?html`
         <wc-length-box feature="pathText" property="distance" .selection=${this.selection}></wc-length-box>
        `:""}renderSizeUi(){return this.selection.allows("allowPathText","size")?html`
         <wc-length-box feature="pathText" property="pathTextFontSize" .selection=${this.selection}></wc-length-box>
        `:""}renderColorUi(){return this.selection.allows("allowPathText","size")?html`
        <wc-color-combo feature="pathText" property="pathTextFontColor" .selection=${this.selection}></wc-color-combo>
        `:""}renderStrokeUi(){return this.selection.allows("allowPathText","stroke")?html`
        <div class="seperator" ></div>
        <wc-length-box feature="pathText" property="pathTextStrokeWidth" .selection=${this.selection}></wc-length-box>
        ${this.hasStrokeUi()?html`
          <wc-color-combo feature="pathText" property="pathTextStrokeColor" .selection=${this.selection}></wc-color-combo>

          <div class="two-cols">
            <wc-select ?icons="${!0}" feature="pathText" property="pathTextStrokeAlign" .selection=${this.selection}></wc-select>
            <wc-select ?icons="${!0}" feature="pathText" property="pathTextStrokeJoin" .selection=${this.selection}></wc-select>
          </div>
        `:""}
        `:""}hasStrokeUi(){const e=this.selection.getValueExtended("pathText","pathTextStrokeWidth").value;return!!(e&&e.value>0)}renderNewPathTextUi(){return!config.isBuyer||0===this.selection.boxes.size&&this.selection.allows("allowAdd","pathText")?html`
        <div class="buyer-properties-devider">Create Text on Path</div>
        ${config.isBuyer?"":html`<p>To create a text on path, draw a new frame on the page or click below:</p> `}
         
        <ul>
            <li  @click=${()=>scope().selectionPropertiesUi.addPathText()}>
            <svg xmlns="http://www.w3.org/2000/svg"   viewBox="0 -15 301.56 100.03" >
                    <g>
                    <path d="M12.29,45.16l-9.45,7.87L0,49.62l23.01-19.16l2.84,3.41l-9.5,7.91l23.03,27.67l-4.06,3.38L12.29,45.16z"/>
                    <path d="M43.4,49.48c3.84,6.02,9.27,6.14,13.77,3.37c3.22-1.98,4.82-3.74,6.06-5.49l2.75,2.75c-1.14,1.69-3.35,4.17-7.29,6.59
                        c-7.62,4.68-15.25,2.47-19.84-4.99c-4.59-7.46-3.81-16.04,3.4-20.48c8.08-4.97,14.59,0.82,17.39,5.37c0.57,0.92,0.9,1.7,1.14,2.19
                        L43.4,49.48z M54.61,38.15c-1.71-2.89-5.67-6.59-10.73-3.48c-4.55,2.8-3.97,8.22-2.41,11.55L54.61,38.15z"/>
                    <path d="M63.55,20.54l6.22,4.16c1.62,1.08,3.03,2.12,4.54,3.24l0.17-0.07c0.22-1.98,0.52-3.73,0.81-5.54l1.39-7.27l5.26-2.19
                        L78.2,29.64l15.19,9.92l-5.54,2.31l-6.45-4.4c-1.7-1.11-3.21-2.24-4.82-3.45l-0.11,0.05c-0.22,1.98-0.56,3.81-0.88,5.83l-1.36,7.65
                        l-5.37,2.24l3.82-17.65l-14.56-9.33L63.55,20.54z"/>
                    <path d="M94.29,0.79l2.18,8.05l7.3-1.97l1.05,3.88l-7.3,1.97l4.09,15.12c0.94,3.48,2.46,5.18,5.3,4.41
                        c1.33-0.36,2.27-0.8,2.86-1.15l1.27,3.76c-0.88,0.67-2.36,1.38-4.33,1.92c-2.38,0.64-4.49,0.41-6.08-0.65
                        c-1.86-1.11-3.05-3.46-3.94-6.77l-4.14-15.29l-4.34,1.18l-1.05-3.88l4.34-1.18l-1.82-6.72L94.29,0.79z"/>
                    <path d="M153.08,15.52c0.65,10.72-6.49,15.84-13.5,16.27c-7.85,0.48-14.24-4.9-14.8-14.07c-0.59-9.7,5.41-15.78,13.44-16.27
                        C146.54,0.95,152.54,6.66,153.08,15.52z M130.1,17.22c0.39,6.35,4.33,10.92,9.48,10.6c5.03-0.31,8.52-5.27,8.12-11.8
                        c-0.3-4.91-3.13-10.99-9.36-10.61S129.76,11.71,130.1,17.22z"/>
                    <path d="M161.27,9.47c0.32-2.98,0.53-5.43,0.61-7.84l4.65,0.5l-0.22,4.8l0.12,0.01c1.73-2.59,5.36-4.91,10.13-4.39
                        c4,0.43,9.94,3.49,8.87,13.39l-1.87,17.24l-5.25-0.57l1.81-16.64c0.5-4.65-0.8-8.72-5.76-9.25c-3.46-0.38-6.41,1.78-7.62,4.6
                        c-0.31,0.63-0.53,1.51-0.62,2.41l-1.88,17.36l-5.25-0.57L161.27,9.47z"/>
                    <path d="M215.75,0c2.51,0.46,5.74,1.24,9.69,2.66c4.85,1.75,8,4.16,9.53,7.01c1.44,2.56,1.68,5.77,0.46,9.16
                        c-1.24,3.44-3.23,5.79-5.86,7.07c-3.59,1.83-8.33,1.72-13.13-0.01c-1.47-0.53-2.8-1.07-3.83-1.76l-5.49,15.24l-4.91-1.77L215.75,0z
                            M214.05,20.11c0.97,0.67,2.28,1.27,3.92,1.86c5.93,2.14,10.58,0.56,12.47-4.69c1.81-5.02-0.87-8.73-6.29-10.68
                        c-2.15-0.77-3.84-1.19-4.77-1.27L214.05,20.11z"/>
                    <path d="M243.07,55.55l1.39-3.41l-0.16-0.09c-2.52,1.22-6.23,1.51-9.86-0.48c-5.16-2.83-5.8-7.9-3.78-11.58
                        c3.37-6.16,10.69-6.52,20.5-1.08l0.29-0.53c1.15-2.1,2.65-6.21-2.56-9.06c-2.37-1.3-5.24-1.92-7.67-1.74l0.62-3.63
                        c2.85-0.21,6.4,0.56,9.61,2.32c7.79,4.27,6.77,10.62,3.97,15.72l-5.22,9.52c-1.21,2.21-2.29,4.42-2.92,6.33L243.07,55.55z
                            M249.51,42.18c-4.99-2.87-11.22-5.12-13.93-0.18c-1.64,3-0.42,5.52,1.94,6.81c3.31,1.82,6.57,0.87,8.49-0.89
                        c0.42-0.39,0.81-0.86,1.07-1.33L249.51,42.18z"/>
                    <path d="M279.83,35.29l-4.94,6.72l6.09,4.48l-2.38,3.24l-6.09-4.48l-9.28,12.61c-2.13,2.9-2.52,5.15-0.15,6.89
                        c1.11,0.82,2.04,1.28,2.68,1.52l-2.15,3.33c-1.07-0.27-2.55-0.98-4.2-2.19c-1.98-1.46-3.11-3.26-3.27-5.17
                        c-0.28-2.15,0.81-4.54,2.84-7.3l9.39-12.76l-3.62-2.67l2.38-3.24l3.62,2.67l4.13-5.61L279.83,35.29z"/>
                    <path d="M297.46,42.42l3.74,3.73l-12.81,12.82l0.08,0.08c1.65-0.47,3.52-0.47,5.3,0.04c1.74,0.47,3.48,1.36,4.88,2.76
                        c2.76,2.76,5.48,8.86-1.6,15.95l-12.21,12.23l-3.74-3.73l11.79-11.8c3.31-3.31,4.88-7.34,1.35-10.86
                        c-2.42-2.42-6.03-2.63-8.74-1.27c-0.72,0.3-1.31,0.81-2.04,1.53l-12.38,12.4l-3.74-3.73L297.46,42.42z"/>
                </g>
                </svg>
       
            </li>
        </ul>
        `:""}renderSectionHead(){return config.isBuyer&&this.selection.allowsAny("allowPathText")?html`
          <div class="buyer-properties-devider">Text on Path</div>
     `:""}render(){return!this.selection||scope().filterPropertiesBySelectedFeature&&"pathText"!==this.selectedTool?html``:this.selection.hasFeature("pathText")?html`   
                ${this.renderSectionHead()}

                ${this.renderContentUi()}
                ${this.renderFontUi()}
                ${this.renderHorizontalPathTextAlignUi()}
                ${config.isBuyer?"":html` <wc-checker theme="small" feature="pathText" property="hasFormField" .selection=${this.selection}></wc-checker>`}
               
                ${this.renderStartXUi()}
                ${this.renderDistanceUi()}
                ${this.renderSizeUi()}
                ${this.renderColorUi()}
                ${this.renderStrokeUi()}
                `:html`   
                ${this.renderNewPathTextUi()}
                `}};return __decorate$H([property({attribute:!1,type:Object})],e.prototype,"selection",void 0),__decorate$H([property()],e.prototype,"selectedTool",void 0),e=__decorate$H([customElement("wc-selection-path-text")],e),e})();var __decorate$I=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n};let WcmSelectionNumber=(()=>{let e=class extends LitElement{constructor(){super(...arguments),this.feature=null,this.property=null}static get styles(){return css`
        :host, :host * {
            box-sizing: border-box;  
        }

        .grid {
          display: grid;
          width: 100vw;
          grid-template-columns: 20px 1fr 10px auto 20px;
        }
        wc-number-box {
           grid-column: 2;
           height: 30px;
        }

        .reset-button {
          grid-column: 4;

          align-self: center;
          justify-self: center;

          border:  1px solid white; 
          border-radius: 5px;
          padding: 4px; 
          font-size: var(--printess-labelSize);
          color: white;
        }
        .reset-button:active {
          border-color: var(--printess-headlineColor);
        }
        `}render(){return this.selection?(scope().selectionPropertiesUi.mobileButtonBarValue=this.value,html`<div class="grid"><wc-number-box mode="slider" .callback=${this.valueChanged} feature="${this.feature}" property="${this.property}" .selection=${this.selection}></wc-number-box>
      <div @click=${this.resetValue} class="reset-button">RESET</div></div>`):html`Please select a frame`}valueChanged(e,t){scope().selectionPropertiesUi.mobileButtonBarValue=e}resetValue(){this.selection&&this.feature&&this.property&&(this.selection.setValue(this.feature,this.property,0),scope().selectionPropertiesUi.mobileButtonBarValue=0)}get value(){if(this.selection&&this.feature&&this.property){const e=this.selection.getValueExtended(this.feature,this.property);if(null!==e.value)return e.value}return 0}};return __decorate$I([property({attribute:!1,type:Object})],e.prototype,"selection",void 0),__decorate$I([property()],e.prototype,"feature",void 0),__decorate$I([property()],e.prototype,"property",void 0),e=__decorate$I([customElement("wcm-selection-number")],e),e})();var __decorate$J=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n};let WcmSelectionImageCropSlider=(()=>{let e=class extends LitElement{static get styles(){return css`
        :host, :host * {
            box-sizing: border-box;  
        }

        .grid {
          display: grid;
          width: 100vw;
          grid-template-columns: 20px 1fr 10px auto 20px;
          align-items: center;
        }
        @media (min-width:  ${config.mobileDeviceWidth+1}px) {
          .grid {
            width: 100%;
            grid-template-columns: 0 1fr 10px auto 20px;
          }
        }
        wc-number-box {
           grid-column: 2;
          
        }

        .reset-button {
          grid-column: 4;

          align-self: center;
          justify-self: center;

          border:  1px solid white; 
          border-radius: 5px;
          padding: 4px; 
          font-size: var(--printess-labelSize);
          color: white;
        }

        .reset-button:active {
          border-color: var(--printess-headlineColor);
        }
        `}render(){return this.selection?(scope().selectionPropertiesUi.mobileButtonBarValue=this.value,html`<div class="grid"><wc-number-box mode="slider" .value=${this.value} .callback=${(e,t)=>this.valueChanged(e,t)} property="genericPercentProperty"  ></wc-number-box>
      <div @click=${this.resetValue} class="reset-button">FILL</div></div>`):html`Please select a frame`}valueChanged(e,t){if(this.selection){const o=e/100+1;this.selection.setImageScaleAbsolute(o),scope().selectionPropertiesUi.mobileButtonBarValue=Math.round(e),!1===t&&this.selection.persistImageScale()}}resetValue(){this.selection&&(scope().selection.fitOrFillImage("fill",void 0,void 0,!0),scope().selectionPropertiesUi.mobileButtonBarValue=0,this.requestUpdate())}get value(){var e;return null!==(e=Math.round(100*Math.max(this.widthScale-1,0)))&&void 0!==e?e:0}get widthScale(){if(this.selection){const e=this.selection.getSingleSelection();if(e&&e.box.imageRef)return e.box.imageRef.imageWidthScale}return 1}};return __decorate$J([property({attribute:!1,type:Object})],e.prototype,"selection",void 0),e=__decorate$J([customElement("wcm-selection-image-crop-slider")],e),e})();var __decorate$K=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n};let WcmSelectionImageCrop=(()=>{let e=class extends LitElement{constructor(){super(...arguments),this.uploadProgress=-1}static get styles(){return css`
          :host, :host * {
              box-sizing: border-box;
          }

          .grid {
              width: 100%;
              display: grid;
              grid-template-rows:  30px 1fr;
          }

          .sub {
              align-self: center;
              justify-self: center;
              font-size: 12px;
              color: var(--printess-textColor);
          }
          
        
          .button-grid {
              display: flex;
              justify-content: center;
              padding-left: 10px;
          }
          wc-fat-button {
              margin-right: 10px;
          }

          .imageList {
            display: flex;
            flex-direction: row;
            flex-wrap: no-wrap;
            margin: 5px;
          }

          .imageItem {
              width: 72px;
              height: 72px ;
              margin: 2px;
              cursor: pointer;
              position:relative;
          }
         
          .imageBox {
              width: 100%;
              height: 100%;
            
              background-size: cover;
              border: 1px solid  var(--printess-headlineColor);
              border-radius: 3px;
           } 
           .imageBox.selected {
              border: 2px solid  var(--printess-headlineColor);
          }
           
          
           .image-upload-progress {
             width: 100vw; 
             height: 22px;
             border: 1px solid black; 
           }
           .image-upload-progress > div {
              background: var(--printess-headlineColor); 
              height: 100%; 
              color: var(--printess-headlineColorInverse);
              text-align: center;
              padding: 2px;
           }
        `}render(){return this.selection?(setMainMobileGridRows(),html`  
      <div class="grid">
        ${this.renderImageUploadProgressUi()}
        
        <div class="imageList">
          
          ${this.selection.getImageList().map((e=>html`
              <div class="imageItem" title="${e.name}" @click=${()=>ImageRef.createOrAssignImage(e)}  >
                  <div class="imageBox" style="background-image: ${e.thumbNailCssUrl()};" ></div>
              </div>
          `))}
          ${this.renderImageUploadUi()}
        </div>
      </div>
      `):html``}renderImageUploadUi(){return-1===this.uploadProgress&&this.selection.hasImageUploadButton()?html`  
      <label class="imageItem" >
        <input style="z-index: 2; height: 73px; opacity: 0.0; position: absolute;" @change="${e=>{var t;return ImageRef.upload(null===(t=e.target)||void 0===t?void 0:t.files,(e=>this.uploadProgress=e))}}" type="file"  multiple />
        <wc-icon class="imageBox" style="position: absolute; top:0; left: 0; width: 100%; height: 100%" icon="plus" ></wc-icon>     
      </label>
    `:""}renderImageUploadProgressUi(){return this.uploadProgress>=0&&this.uploadProgress<=100?html`  
      <div class="image-upload-progress" >
        <div style="width: ${100*this.uploadProgress}%">${Math.round(1e4*this.uploadProgress)/100+"%"}</div>
      </div>`:html`<div class="sub">Select image or upload a new one.</div> `}};return __decorate$K([property({attribute:!1,type:Object})],e.prototype,"selection",void 0),__decorate$K([property({type:Number})],e.prototype,"uploadProgress",void 0),e=__decorate$K([customElement("wcm-selection-image-change")],e),e})();function compareStates(e,t){var o,i,r,s;switch(e.state){case"ext-value":return(null===(o=e.externalPropery)||void 0===o?void 0:o.id)===(null===(i=t.externalPropery)||void 0===i?void 0:i.id)&&e.metaProperty===t.metaProperty;case"form-field":return(null===(r=e.formField)||void 0===r?void 0:r.id)===(null===(s=t.formField)||void 0===s?void 0:s.id);default:return e.state===t.state}}function compareStatesAndValues(e,t){var o,i,r,s,n,a,l,c,d,h,p,u,m,f,g,y,b,v,x,w,_,S;const P=e.externalPropery,C=t.externalPropery,T=e.formField,A=t.formField;switch(e.state){case"ext-value":if(!P||!C)return!1;if(P.id!==C.id)return!1;if(e.metaProperty===t.metaProperty){if(P.value!==C.value)return!1;if(!e.metaProperty)return!0;switch(e.metaProperty){case"image-brightness":return(null===(o=P.imageMeta)||void 0===o?void 0:o.brightness)===(null===(i=C.imageMeta)||void 0===i?void 0:i.brightness);case"image-contrast":return(null===(r=P.imageMeta)||void 0===r?void 0:r.contrast)===(null===(s=C.imageMeta)||void 0===s?void 0:s.contrast);case"image-hueRotate":return(null===(n=P.imageMeta)||void 0===n?void 0:n.hueRotate)===(null===(a=C.imageMeta)||void 0===a?void 0:a.hueRotate);case"image-scale":return(null===(l=P.imageMeta)||void 0===l?void 0:l.scale)===(null===(c=C.imageMeta)||void 0===c?void 0:c.scale);case"image-sepia":return(null===(d=P.imageMeta)||void 0===d?void 0:d.sepia)===(null===(h=C.imageMeta)||void 0===h?void 0:h.sepia);case"image-vivid":return(null===(p=P.imageMeta)||void 0===p?void 0:p.vivid)===(null===(u=C.imageMeta)||void 0===u?void 0:u.vivid);case"text-style-color":return(null===(m=P.textStyle)||void 0===m?void 0:m.color)===(null===(f=C.textStyle)||void 0===f?void 0:f.color);case"text-style-font":return(null===(g=P.textStyle)||void 0===g?void 0:g.font)===(null===(y=C.textStyle)||void 0===y?void 0:y.font);case"text-style-hAlign":return(null===(b=P.textStyle)||void 0===b?void 0:b.hAlign)===(null===(v=C.textStyle)||void 0===v?void 0:v.hAlign);case"text-style-size":return(null===(x=P.textStyle)||void 0===x?void 0:x.size)===(null===(w=C.textStyle)||void 0===w?void 0:w.size);case"text-style-vAlign":return(null===(_=P.textStyle)||void 0===_?void 0:_.vAlign)===(null===(S=C.textStyle)||void 0===S?void 0:S.vAlign);default:assertNever$1(e.metaProperty)}}return!1;case"form-field":return!(!T||!A)&&T.id===A.id;default:return e.state===t.state}}function showButtonsAndPanel(e){if("ext-value"===e.state&&e.externalPropery){if("single-line-text"===e.externalPropery.kind)return!!e.metaProperty;if("multi-line-text"===e.externalPropery.kind)return!!e.metaProperty}return"form-field"!==e.state}function getCurrentMobileUiButtons(){const e=[],t=scope().selection.externalProperties;if(t.length>0)for(const o of t)e.push(...getMobileUiButtonsByExternalProperty(o));else{const t=[...Array.from(scope().getAllGlobalFormFields(!0).values()).sort(((e,t)=>e.order-t.order)),...Array.from(scope().currentDoc.getAllDocFormFields(null,!0).values())];for(const o of t)e.push(...getMobileUiButtonsByFormField(o))}return e}function getMobileUiButtonsByFormField(e){const t=[],o=scope().getFormFieldValue(e.id),i=e.captionLookUp.get(o);let r=shortString(""+o,22);const s=e.caption;let n;if(i&&(i.label&&(r=shortString(i.label,22)),i.imageId)){const e=scope().images.get(i.imageId);e&&(n=e.thumbNailCssUrl())}return t.push({type:"form-field",caption:s,icon:"none",thumbCssUrl:n,circleStyle:e.getCircleCss(),ffCircleCaption:r,newState:{state:"form-field",formField:e}}),t}function getMobileUiButtonsByExternalProperty(e){var t,o;const i=[];if("single-line-text"===e.kind&&i.push({type:"ext-property",caption:shortString(""+e.value,20)||"Text",icon:"text",newState:{state:"ext-value",externalPropery:e}}),"multi-line-text"===e.kind&&(i.push({type:"ext-property",caption:shortString(""+e.value,20)||"Text",icon:"text",newState:{state:"ext-value",externalPropery:e}}),e.textStyle&&(e.textStyle.allows.indexOf("size")&&i.push({type:"ext-property",caption:"Size",icon:"text",newState:{state:"ext-value",externalPropery:e,metaProperty:"text-style-size"}}),e.textStyle.allows.indexOf("horizontalAlignment")&&i.push({type:"ext-property",caption:"Align",icon:"text",newState:{state:"ext-value",externalPropery:e,metaProperty:"text-style-hAlign"}}))),"image"===e.kind&&(i.push({type:"ext-property",caption:"Image",icon:"image",thumbCssUrl:null!==(o=null===(t=e.imageMeta)||void 0===t?void 0:t.thumbCssUrl)&&void 0!==o?o:"",newState:{state:"ext-value",externalPropery:e}}),e.imageMeta)){i.push({type:"ext-property",caption:"Scale",icon:"search-light",newState:{state:"ext-value",externalPropery:e,metaProperty:"image-scale"}});for(const[t,o]of enums.allowImageFilters.entries())e.imageMeta.allows.indexOf(o)>=0&&i.push({type:"ext-property",caption:enumLabels.allowImageFilters[t],newState:{state:"ext-value",externalPropery:e,metaProperty:"image-"+o}})}return"number"===e.kind&&i.push({type:"ext-property",caption:e.label,newState:{state:"ext-value",externalPropery:e}}),"color"===e.kind&&i.push({type:"ext-property",caption:"Color",icon:"palette",newState:{state:"ext-value",externalPropery:e}}),i}function getMobileUiStateBackLink(e){switch(e.state){case"ext-value":return showButtonsAndPanel(e)?"selection":"form-fields";case"add":case"selection":case"form-field":return"form-fields";case"form-fields":return"none";default:return scope().selection.externalProperties.length?"selection":"form-fields"}}function scrollToLeft(e,t,o){const i=e.scrollLeft,r=t-i;let s=0;const n=function(){s+=10;const t=easeInOutQuad(s,i,r,o);e.scrollLeft=t,s<o&&setTimeout(n,10)};n()}function easeInOutQuad(e,t,o,i){return(e/=i/2)<1?o/2*e*e+t:-o/2*(--e*(e-2)-1)+t}var __awaiter$A=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};function isContentTool(e){return"image"===e||"story"===e||"path"===e||"pathText"===e||"doc"===e}class WcSelectionProperties extends LitElement{constructor(){super(),this.lastGeometrySelectionWasUserInduced=!0,this.lastContentToolSelectionWasUserInduced=!1,this._mobileUiState={state:"form-fields"},this.newMobileUiState=null,this.newMobileUiStateTimeOut=null,this.mobileButtonBarValue=null,this.mobileButtonBarStringValue=null,this.mobileButtonBarLengthValue=null,this.mobileButtonBarColorValue=null,this.skipOnScrollForOneTime=!1,this.lastPosition=null,this.selection=new Selection$1(null,null),this.selectedTool="geometry",this.mobileUiState={state:"form-fields"}}get mobileUiState(){return this._mobileUiState}set mobileUiState(e){var t,o;if(this._mobileUiState!==e){console_log("+++ Changed mobileUiState from "+(null!==(o=null===(t=this._mobileUiState)||void 0===t?void 0:t.state)&&void 0!==o?o:"not set")+" to "+e.state);const i=this._mobileUiState;this.mobileButtonBarValue=null,this.mobileButtonBarLengthValue=null,this.mobileButtonBarColorValue=null,this._mobileUiState=e,this.requestUpdate("mobileUiState",i)}}get selection(){return this._selection}set selection(e){if(e&&this._selection!==e){if(console_log("*** WcSelectionPropertiesUI: Selection Changed, Boxes="+e.boxes.size),e.boxes.size>0){let t=!1;if("ext-value"===this.mobileUiState.state){const o=this.mobileUiState.externalPropery,i=e.externalProperties.filter((e=>e.id===(null==o?void 0:o.id)));if(i.length){const e={state:"ext-value",externalPropery:i[0],metaProperty:this.mobileUiState.metaProperty};compareStatesAndValues(this.mobileUiState,e)?t=!0:(t=!0,this.newMobileUiState=e)}}t||("form-fields"===this.mobileUiState.state||Array.from(this.selection.boxes.keys()).join("|")!==Array.from(e.boxes.keys()).join("|"))&&(this.newMobileUiState={state:"selection"})}else scope().pathEditorActive()?console_log("do noting"):this.newMobileUiState={state:"form-fields"};this.newMobileUiState&&(this.mobileUiState=this.newMobileUiState,this.newMobileUiState=null),this._selection=e}}static get properties(){return{_selection:{type:Object},selectedTool:{type:String},mobileButtonBarValue:{type:Number},mobileButtonBarLengthValue:{type:Object},mobileButtonBarColorValue:{type:String}}}tools(){return[{tool:"geometry",title:"(Box Tool (Escape, V)",icon:"ruler",feature:"boxGeometry",addCaption:"",featureTitle:"Position"},{tool:"image",title:"Image Tool (I)",icon:"image",feature:"imageRef",addCaption:"Add Image",featureTitle:"Image"},{tool:"story",title:"Text Tool (T)",icon:"text",feature:"storyRef",addCaption:"Add Text",featureTitle:"Single- and Multi Line Text"},{tool:"textFlow",title:"Multi Line Text Flow Tool",icon:"story",feature:"storyRef",addCaption:"Add Multi Line Text Flow",featureTitle:"Multi Line Text Flow"},{tool:"pathText",title:"Text On Path (P)",icon:"pathText",feature:"pathText",addCaption:"Add Text On Path",featureTitle:"Text On Path"},{tool:"path",title:"Shape Tool (M)",icon:"shapes",feature:"pathGeometry",addCaption:"Add Path",featureTitle:"Shape"},{tool:"doc",title:"Sub Document Tool",icon:"address-card",feature:"docRef",addCaption:"Add Sub Document",featureTitle:"Sub Document"},{tool:"transform",title:"Warp",icon:"warp-arc",feature:"transform",addCaption:"",featureTitle:"Warp"},{tool:"effect",title:"Effects",icon:"printess-wand",feature:"effect",addCaption:"",featureTitle:"Effects"},{tool:"lock",title:"Buyer Side Features",icon:"shopping-cart",feature:"lock",addCaption:"Buyer Side",featureTitle:"Buyer Side"}]}getToolByEnum(e){for(const t of this.tools())if(t.tool===e)return t;throw new Error("Tool-Enum value does not exists: "+e)}getToolDef(){for(const e of this.tools())if(e.tool===this.selectedTool)return e;return this.tools()[0]}static getFeatureByTool(e){switch(e){case"path":return"pathGeometry";case"story":return"storyRef";case"transform":return"transform";case"effect":return"effect";case"pathText":return"pathText";case"doc":return"docRef";case"geometry":return"boxGeometry";case"image":return"imageRef";case"textFlow":return"storyRef";case"lock":return"lock";case"group":return"basics";default:assertNever$1(e)}}hasFeature(e){switch(e){case"path":return this.selection.hasFeature("pathGeometry");case"story":return this.selection.hasFeature("storyRef")||this.selection.hasFeature("simpleText");case"transform":return this.selection.hasFeature("transform");case"effect":return this.selection.hasFeature("effect");case"pathText":return this.selection.hasFeature("pathText");case"doc":return this.selection.hasFeature("docRef");case"geometry":return!0;case"image":return this.selection.hasFeature("imageRef");case"textFlow":return!1;case"lock":return!0;case"group":return this.selection.boxes.size>1;default:assertNever$1(e)}}selectTool(e,t=!1){scope().isRecording&&scope().e2e.record({module:"WcSelectionProperties",func:"selectTool",args:[e]}),"geometry"===e&&(this.lastGeometrySelectionWasUserInduced=t),(isContentTool(e)||"textFlow"===e)&&(this.lastContentToolSelectionWasUserInduced=t),this.selectedTool=e,scope().stage.style.cursor=this.selectToolMouseCursor(null);const o=scope().selection.getSingleSelection();let i;if(o?i=o.box:scope().selection.boxes.size>0&&(!this.hasFeature(e)||"story"===e&&this.selection.hasFeature("storyRef"))&&scope().selection.boxes.size>0&&(i=scope().selection.boxes.values().next().value.box),t&&i&&isContentTool(e)){const t=scope().docUi.getWcBox(i.id);t&&(t.selectedContentTool=e)}scope().cropEditorActive()&&scope().closeCropEditor(),"path"===e&&i&&i.pathGeometry||scope().pathEditorActive()&&scope().closePathEditor(),"transform"===e&&i&&i.transform||(scope().perspectiveEditorActive()?scope().closePerspectiveEditor():scope().meshEditorActive()&&scope().closeMeshEditor()),scope().eddiActive()&&scope().closeEddi()}selectToolCanCreateFrame(){switch(this.selectedTool){case"image":case"pathText":case"path":case"doc":case"story":case"textFlow":return!0;default:return!1}}selectToolBoxType(){switch(this.selectedTool){case"image":return boxTypeE.image;case"pathText":return boxTypeE.pathText;case"doc":return boxTypeE.doc;case"path":return boxTypeE.path;case"story":case"textFlow":return boxTypeE.story;default:return boxTypeE.rect}}selectToolMouseCursor(e){if("story"===this.selectedTool&&e&&e.box.storyRef)return"text";if("textFlow"===this.selectedTool)return"context-menu";if(this.selectToolCanCreateFrame())return"crosshair";switch(this.selectedTool){case"path":return"context-menu";default:return"default"}}firstUpdated(){this.skipOnScrollForOneTime=!0}onScroll(){if(this.shadowRoot){const e=this.shadowRoot.querySelector(".properties");e&&(this.skipOnScrollForOneTime?this.skipOnScrollForOneTime=!1:e.scrollTop&&(scope().selectionPropertiesUiScrollTop=e.scrollTop))}}updated(){if(this.shadowRoot){const e=this.shadowRoot.querySelector(".properties");e&&this.updateComplete.then((()=>{setTimeout((()=>{e.scrollTop=scope().selectionPropertiesUiScrollTop}),1)}))}}reloadFontLists(){const e=this.getWcSelectionStoryRef();e&&e.reloadFonts();const t=this.getWcSelectionSimpleText();t&&t.reloadFonts();const o=this.getWcSelectionPathText();o&&o.reloadFonts()}getWcSelectionStoryRef(){if(this.shadowRoot){const e=this.shadowRoot.querySelector("WC-SELECTION-STORY-REF");if(e)return e}return null}getWcBuyerSidebar(){if(this.shadowRoot){const e=this.shadowRoot.querySelector("WC-EXTERNAL-SIDEBAR");if(e)return e}return null}getWcSelectionPathText(){if(this.shadowRoot){const e=this.shadowRoot.querySelector("WC-SELECTION-PATH-TEXT");if(e)return e}return null}getWcSelectionSimpleText(){if(this.shadowRoot){const e=this.shadowRoot.querySelector("WC-SELECTION-SIMPLE-TEXT");if(e)return e}return null}getWcSelectionLock(){if(this.shadowRoot){const e=this.shadowRoot.querySelector("WC-SELECTION-LOCK");if(e)return e}return null}getWcSelectionDocBuyerSettings(){if(this.shadowRoot){const e=this.shadowRoot.querySelector("WC-SELECTION-DOC-BUYER-SETTINGS");if(e)return e}return null}getWcSelectionFormFields(){if(this.shadowRoot){const e=this.shadowRoot.querySelector("WC-SELECTION-FORM-FIELDS");if(e)return e}return null}getWcExternalSidebar(){if(this.shadowRoot){const e=this.shadowRoot.querySelector("WC-EXTERNAL-SIDEBAR");if(e)return e}return null}static get styles(){return css`
:host, :host * {
    box-sizing: border-box;
}
:host  {
    width: 100%;
    height: 100%;
    display: grid;
    justify-content: stretch;
    grid-row-gap: 20px;
    font-size:  var(--printess-textSize);
    color: var(--printess-textColor);
  }

  .seperator {
    height: 0px;
    opacity: 0.5;
    border-bottom: dashed 1px var(--printess-textColorDisabled);
    margin-top: 10px;
    margin-bottom: 10px;
  }
               
  .header {
  
      width: calc(100% - var(--printess-toolbar-width));
      
      position: absolute;
      right: 0;
      top:0;
      
      color: var(--printess-headlineColor);
        
      font-size: var(--printess-headlineSize);
        
      padding-top:  10px;
      
      padding-left: 15px;
      padding-right: 35px;

      box-shadow: rgba(0,0,0,0.4) 0px 4px 4px -4px;
      background: var(--printess-panelBackground);
      height: calc(20px + var(--printess-headlineSize));
      z-index: 2;
        
  }
  .header > wc-icon {
      position: absolute;
      right: 15px;
      top: 13px;
  }
  .header > .exchange-icon {
      position: absolute;
      right: 45px;
      top: 13px;

      width: 20px; 
      height: 20px
          
  }
  

        
  .properties {
      
      position: absolute;
      right: 0;
      top:35px;
      width: calc(100% - var(--printess-toolbar-width));
      height: calc(100% - 35px);
      padding: 15px; /* little bit more then on the left side */
      overflow: auto;
      
  }

  .properties.buyer {
      top: 0;
      width:  100%;
  }
  
  .toolbar {
  
      background: var(--printess-toolbarBackground);
      
      position: absolute;
      left: 0;
      top:0;
      width: var(--printess-toolbar-width);
      height: 100%;
      overflow: hidden;
  }
    
  
  .toolbar .tb-button {
      width: var(--printess-toolbar-width);
      height: var(--printess-toolbar-width);
      padding: 8px;
      color: var(--printess-toolbarColor);
      text-align: center;
      cursor: pointer;
  }

  .toolbar .tb-button:hover {
    background: var(--printess-toolbarBackgroundHover);
  }

  .toolbar .tb-button.selected, .toolbar .tb-button.selected:hover  {
      background: var(--printess-panelBackground);
      border-bottom: 3px solid var(--printess-headlineColor);
      
  }
  
  
  .app-bottom-bar {
      background-color:  var(--printess-panelBackground);
      color: white;
      width: 100vw; /* enable correct width restriction for child items and scrolling */
      height: 100%;
      overflow: auto;
      
  }
                
    .mobile-buttons-container {
      height: 80px;
      padding-top: 10px;
    }

   /* .mobile-buttons-head {
      align-self:  flex-start;
      justify-self: center;
      font-size: 13px;
      color: white;
      padding: 3px;
      padding-left: 13px;
      padding-right: 13px;
      background-color: rgba(0,0,0,0.2);
      border-radius: 0 0 13px 13px;
  }*/

  .mobile-buttons-scroll-container {
    width: 100vw;
    overflow: scroll;
    -ms-overflow-style: none;  /* IE and Edge */
    scrollbar-width: none;  /* Firefox */
    
  }

  /* hide scrollbar safari, chrome, opera */ 
  .mobile-buttons-scroll-container::-webkit-scrollbar {
    display: none;
  }
  
  .mobile-buttons {
    display: flex;
    flex-direction: row;
    justify-content: center;
    width: -webkit-fill-available;
    width: -webkit-fit-content;
    width: fit-content;
    min-width: 40px;
  }



  .mobile-property-button {
    width: fit-content;
    overflow: hidden;     
    margin-right: 20px;
    display: grid;
    grid-template-rows: 38px 3px 14px;
    align-items: center;
    justify-content: center;
    justify-items: center;
    position: relative;
    cursor: pointer;
  }
  .mobile-property-text {
    width: 50px;
    height: 50px;
    border-radius: 5px;
    border: 1px solid rgba(255,255,255, 0.6);
    padding: 3px;
    font-size: 11px;
    overflow: hidden;
    margin-right: 15px;
    display: flex;
    align-items: center;
    justify-content: center;
    justify-items: center;
    position: relative;
    cursor: pointer;
  }
  .mobile-property-text > .text {
    overflow: hidden;
    font-size: 10px;
  }
  .mobile-property-text > .icon {
    background-color: rgba(255, 255, 255, 0.7);
    border-radius: 50%;
    width: 30px;
    height: 30px;
    position: absolute;
    right: -13px;
    top: -14px;
    display: flex;
    place-items: flex-end;
    padding-left: 6px;
    font-family: serif;
  }
  .mobile-property-text > .icon > div {
    color: var(--printess-panelBackground);
    font-size: 14px;
  }
  .mobile-property-button:first-child,   .mobile-property-text:first-child {
    margin-left: 20vw;
  }
  .mobile-property-button:last-child, .mobile-property-text:last-child {
    margin-right: 45vw !important;
  }
  


  .mobile-property-circle {
    grid-row: 1;
    grid-column: 1;
    width: 38px ; 
    height: 38px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1;
  }

  .circle-button-icon {
    align-self: center;
    justify-self: center;

    width: 20px; 
    height: 20px;
    grid-row: 1;
    grid-column: 1;
  } 
  .mobile-property-caption {
    grid-row: 3;
    color: #ffffff;
    white-space: nowrap;
    font-size: 11px;
    text-align: center;
    z-index: 1;
  }
  
  .mobile-property-plus-button {
    position: absolute;
    right: 10px;
    top: -29px;
    width: 42px;
    height: 42px;
    
    display: flex;
    align-items: center;
    justify-content: center;
    align-content: center;
    z-index: 90;
  }
      
      
  .mobile-property-plus-button >  .mobile-property-circle  {
    width: 42px;
    height: 42px;
    background-color: #72ba15;
    box-shadow: 0px 10px 8px -4px rgba(0,0,0,0.38);
  }
        
  .mobile-property-plus-button > .mobile-property-circle:active {
    background-color: black;
    border: 2px solid lime;
  }
        
  .mobile-property-back-button {
    position: absolute;
    left: 10px;
    top: -30px;
    width: 44px;
    height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 90;
  }
      
  .mobile-property-back-button >  .mobile-property-circle  {
    width: 44px;
    height:44px;
    
      background-color:  var(--printess-panelBackground);
    box-shadow: 0px 10px 8px -4px rgba(0,0,0,0.38);
  }
  
  .circle-button-graphic {
    display: grid;
  }
  /* overlay all child items */
  .circle-button-graphic > * {
    display: grid;
    grid-row: 1;
    grid-column: 1;
  }
                    
  .circular-svg {
    position: relative;
    z-index: 1;
    display: block;
    width: 42px;
    height:42px;
    margin: -2px;
  }
  .circular-svg.selected  .circle-bg{
      fill: rgba(0,0,0, 0.4);
  }
  .circular-color {
      justify-self: center;
      align-self: center;
      border-radius: 50%;
      width: 24px;
      height: 24px; 
      border: 1px solid white;
  }
  .circular-color.selected {
      border: 1px solid var(--printess-headlineColor);
  }
  .circular-image {
      justify-self: center;
      align-self: center;
      border-radius: 15%; 
      height: 36px; 
      width: 42px;
      background-size: contain;
      border: 1px solid rgba(255, 255, 255, 0.5);
      background-repeat: no-repeat;
      background-position: center;
  }
  .circular-image.selected {
      border: 1px solid var(--printess-headlineColor);
  }
  .circle-bg {
    fill: none;
    stroke: rgba(255,255,255,0.4);
    stroke-width: 1;
  }

  .circle {
    fill: none;
    stroke-width: 1;
    stroke-linecap: round;
  }

  .circular-svg .circle {
    stroke: #ff9f00;
  }
  
  .circular-svg-caption {
    fill: white;
    z-index: 1;
    font-size: 10px;
    justify-self: center;
    align-self: center;
  }

  .form-field-caption {
    z-index: 1;
    place-self: center;
    padding: 3px 5px;
    background-color: rgba(0, 0, 0, 0.3);
    border-radius: 5px;
    max-width: 60px;
    text-align: center;
    font-size: 11px;
    height: 36px;
    display: flex;
    justify-content: center;
    align-items: center;
    min-width: 75px;
    overflow: hidden;
  }

  .textButtonContainer {
    display: flex; 
    justify-content: space-between;
    margin-bottom: 10px;
  }

  .textButtonContainer > button {
      padding: 4px 8px;
      font-family: Lato, sans-serif; /* is overwritten by user-agent style-sheet ??? */
      border-radius: 4px; 
      border: 0px solid var(--printess-textColor); 
      font-size: var(--printess-labelSize);
  }

               
            
        `}renderToolbarUi(){return config.isBuyer?"":html`<div class="toolbar">
            ${this.tools().filter((e=>"textFlow"!==e.tool)).map((e=>html`
            <div style="${"transform"===e.tool||"image"===e.tool?"margin-top: 20px;":""}" class="tb-button ${this.selectedTool===e.tool?"selected":""}" title="${e.title}"
            @click="${()=>this.selectTool(e.tool,!0)}">
                <wc-icon icon="${e.icon}" primaryColor="${this.hasActiveFeature(e.feature)?"headline":"toolbar"}"  ></wc-icon>
            </div> `))}
           
        </div>`}renderToolHeaderUi(){return this.featureTitle()&&scope().filterPropertiesBySelectedFeature?html`
        <div class="header">
            <span>${this.featureTitle()}</span>    
             
            ${this.canRemoveFeature()?html`
                <wc-icon icon="minus" style="width: 20px; height: 20px"
                    primaryColor="headline" 
                    @click="${()=>this.removeFeature()}" ></wc-icon>`:this.canAddFeature()?html`
                <wc-icon icon="plus-circle" style="width: 20px; height: 20px"
                    primaryColor="headline" 
                    @click="${()=>this.addNewFeature()}" ></wc-icon>
            `:""}
        </div>`:""}updateFormFieldList(){return __awaiter$A(this,void 0,void 0,(function*(){if(this.shadowRoot){const e=this.shadowRoot.querySelector("wc-selection-form-fields");e&&(yield e.requestUpdate())}}))}getBuyerBackButtonUi(){return config.isBuyer&&(this.selection.externalProperties.length>0||scope().eddiActive())?html`<wc-icon @click=${()=>scope().clearSelectionAndAllEditors()} primaryColor="headline" style="cursor: pointer;width: 32px; height: 32px; padding: 6px; border: 1px solid var(--printess-headlineColor); border-radius: 50%;" icon="arrow-left"></wc-icon>
      <div class="seperator"></div>`:html``}render(){return config.isMobile?this.newMobileUiState?(console_log("Skiped Mobile Toolbar rendering ..."),html``):html`<div class="app-bottom-bar">
                    ${this.getMobileButtonList()}
                    ${this.getMobilePlusButton()}
                    ${this.getMobileBackButton()}
                    ${this.getMobileUiPanel()}
                </div>`:html` 
            
                ${this.renderToolbarUi()}
                ${this.renderToolHeaderUi()}

  
    <div class="properties ${config.isBuyer?"buyer":"admin"}"  @scroll=${()=>this.onScroll()}>

        ${this.getBuyerBackButtonUi()}

        <wc-selection-form-fields mode="all" buyer="${config.isBuyer?"on":"off"}" .selection=${this.selection}></wc-selection-form-fields>
 
        <wc-external-sidebar .selection=${this.selection} .selectedTool=${this.selectedTool} ></wc-external-sidebar>
       
        ${!config.isBuyer||"rookie"!==scope().buyerSideMode&&this.selection.boxes.size<=1?html`
          <wc-selection-anchors  .selection=${this.selection} .selectedTool="${this.selectedTool}"></wc-selection-anchors>
          
          <wc-selection-image-ref .selection=${this.selection} .selectedTool="${this.selectedTool}"></wc-selection-image-ref>
          
          <wc-selection-story-ref .selection=${this.selection} .selectedTool="${this.selectedTool}"></wc-selection-story-ref>
          
          <wc-selection-simple-text .selection=${this.selection} .selectedTool="${this.selectedTool}"></wc-selection-simple-text>

          <wc-selection-path-text .selection=${this.selection} .selectedTool="${this.selectedTool}"></wc-selection-path-text>

          <wc-selection-new-text .selection=${this.selection} .selectedTool="${this.selectedTool}"></wc-selection-new-text>
          
          <wc-selection-path .selection=${this.selection} .selectedTool="${this.selectedTool}"></wc-selection-path>
          
          <wc-selection-doc-ref .selection=${this.selection} .selectedTool="${this.selectedTool}"></wc-selection-doc-ref>
          
          <wc-selection-transform .selection=${this.selection} .selectedTool="${this.selectedTool}"></wc-selection-transform>

          <wc-selection-effect .selection=${this.selection} .selectedTool="${this.selectedTool}"></wc-selection-effect>

        
        `:""}
       
         
        ${config.isBuyer||this.selection.hasSelection()||"geometry"!==this.selectedTool?"":scope().selectionDocUi}
        ${config.isBuyer||this.selection.hasSelection()||"lock"!==this.selectedTool?"":html`<wc-selection-doc-buyer-settings .doc=${scope().currentDoc}></wc-selection-doc-buyer-settings>`}
        ${config.isBuyer?"":html`<wc-selection-lock .selection=${this.selection} .selectedTool="${this.selectedTool}"></wc-selection-lock>`}

      
      
       
    </div>
 
        `}getMobileUiPanel(){var e,t;switch(this.lastPosition&&(document.activeElement&&"WC-SELECTION-PROPERTIES"===document.activeElement.tagName&&"WC-TEXT-AREA"===(null===(t=null===(e=scope().selectionPropertiesUi.shadowRoot)||void 0===e?void 0:e.activeElement)||void 0===t?void 0:t.tagName)||(setCurrentScrollPosition(this.lastPosition),this.lastPosition=null)),console_log("getMobileUiPanel for "+this.mobileUiState.state),"imageCrop"===this.mobileUiState.state?scope().cropEditorActive()||scope().showCropEditor():scope().cropEditorActive()&&scope().closeCropEditor(),this.mobileUiState.state){case"form-fields":return setMainMobileGridRows(),"";case"form-field":{const e=this.mobileUiState.formField;return e?("select-list"===e.uiControl?setMainMobileGridRows(200):setMainMobileGridRows(),html`<wc-form-field-value  .formField=${this.mobileUiState.formField}></wc-form-field-value>`):html`Form Field not found`}case"ext-value":{const e=this.mobileUiState.externalPropery;if(e){if("color"===e.kind)return html`<wc-external-color .property=${e} ></wc-external-color>`;if("single-line-text"===e.kind)return html`<wc-external-text-area .property=${e}></wc-external-text-area>`;if("multi-line-text"===e.kind)return"text-style-size"===this.mobileUiState.metaProperty?html`<wc-external-number-box .property=${e}  meta="text-style-size"  ></wc-external-number-box>`:"text-style-hAlign"===this.mobileUiState.metaProperty?html`<wc-external-select .property=${e} meta="text-style-hAlign"></wc-external-select>`:html`<wc-external-text-area view="full" .property=${e}></wc-external-text-area>`;if("number"===e.kind)return html`<wc-external-number-box .property=${e}></wc-external-number-box>`;if("image"===e.kind)return this.mobileUiState.metaProperty?"image-scale"===this.mobileUiState.metaProperty?html`<wc-external-image mode="scale" .property=${e}></wc-external-image>`:html`<wc-external-number-box .property=${e} meta="${this.mobileUiState.metaProperty}"  ></wc-external-number-box>`:""}return""}case"selection":case"add":return"";case"imageCrop":return html`<wcm-selection-image-crop-slider .selection=${this.selection}></wcm-selection-image-crop-slider>`;default:assertNever$1(this.mobileUiState.state)}}getMobilePlusButton(){return"add"!==this.mobileUiState.state&&this.selection.hasAddFrameButton()?html`
                <div class="mobile-property-plus-button" >
                    <div class="mobile-property-circle" @click=${e=>this.addButtonClick(e)} >
                        <wc-icon primaryColor="toolbar" style="width: 22px; height: 22px" icon="${this.mobileUiStateIcon("add")}"></wc-icon>
                    </div>
                    <div class="mobile-property-caption"></div>
                </div>`:""}getMobileBackButton(){return"none"!==getMobileUiStateBackLink(this.mobileUiState)?html`
        <div class="mobile-property-back-button" >
            <div class="mobile-property-circle" @click=${e=>this.backButtonClick(e)} >
                <wc-icon primaryColor="toolbar"  style="width: 18px; height: 18px" icon="${this.mobileUiStateIcon(getMobileUiStateBackLink(this.mobileUiState))}"></wc-icon>
            </div>
            <div class="mobile-property-caption"></div>
        </div>`:""}getMobileButtonList(){if(!showButtonsAndPanel(this.mobileUiState))return"";const e=getCurrentMobileUiButtons();if(e.length){setMainMobileGridRows(),1===e.length&&e[0].newState.externalPropery&&window.setTimeout((()=>{this.mobileButtonClick(null,e[0])}),0);for(const t of scope().selection.externalProperties)if("image"===t.kind&&"selection"===this.mobileUiState.state){window.setTimeout((()=>{for(const t of e)"ext-value"===t.newState.state&&"image-scale"===t.newState.metaProperty&&this.mobileButtonClick(null,t)}),0);break}return html`
       <div class="mobile-buttons-container">
       
          <div class="mobile-buttons-scroll-container">
            <div class="mobile-buttons">
              ${e.map((e=>{var t,o;return"ext-value"!==e.newState.state||"single-line-text"!==(null===(t=e.newState.externalPropery)||void 0===t?void 0:t.kind)&&"multi-line-text"!==(null===(o=e.newState.externalPropery)||void 0===o?void 0:o.kind)||e.newState.metaProperty?html`
                <div class="mobile-property-button ${compareStates(e.newState,this.mobileUiState)?"selected":""}" @click=${t=>this.mobileButtonClick(t,e)}>
                    ${this.getButtonCircle(e)}
                    <div class="mobile-property-caption">${e.caption}</div>
                </div>
              `:html`
                  <div class="mobile-property-text" @click=${t=>this.mobileButtonClick(t,e)}>
                    <div class="text">${e.caption}</div>
                    <div class="icon"><div>T</div></div>
                  </div>
              `}))}
            </div>
          </div>
        </div>
      </div>`}return""}getButtonCircle(e){var t,o,i,r,s,n,a,l,c,d,h,p,u,m,f,g,y,b;const v=compareStates(e.newState,this.mobileUiState);let x=null,w=0,_="",S="",P=e.icon||"arrows-circle",C="none";if("ext-property"===e.type){const w=e.newState;if("ext-value"===w.state&&w.externalPropery)switch(w.metaProperty||""){case"":switch(x=v&&null!==this.mobileButtonBarValue?this.mobileButtonBarValue:w.externalPropery.value,w.externalPropery.kind){case"color":C="color","string"==typeof w.externalPropery.value&&(S=v&&this.mobileButtonBarColorValue?this.mobileButtonBarColorValue:w.externalPropery.value);break;case"number":C="number-meta",w.externalPropery.id.startsWith("NU_warpArchPhi")?P="warp-arc":w.externalPropery.id.startsWith("NU_rotation")&&(P="rotator");break;default:C="none"}break;case"image-brightness":x=v&&null!==this.mobileButtonBarValue?this.mobileButtonBarValue:null!==(o=null===(t=w.externalPropery.imageMeta)||void 0===t?void 0:t.brightness)&&void 0!==o?o:0,C="number-meta",P="sun-light";break;case"image-contrast":x=v&&null!==this.mobileButtonBarValue?this.mobileButtonBarValue:null!==(r=null===(i=w.externalPropery.imageMeta)||void 0===i?void 0:i.contrast)&&void 0!==r?r:0,C="number-meta",P="adjust";break;case"image-hueRotate":x=v&&null!==this.mobileButtonBarValue?this.mobileButtonBarValue:null!==(n=null===(s=w.externalPropery.imageMeta)||void 0===s?void 0:s.hueRotate)&&void 0!==n?n:0,C="number-meta",P="palette";break;case"image-sepia":x=v&&null!==this.mobileButtonBarValue?this.mobileButtonBarValue:null!==(l=null===(a=w.externalPropery.imageMeta)||void 0===a?void 0:a.sepia)&&void 0!==l?l:0,C="number-meta",P="scroll-old";break;case"image-vivid":x=v&&null!==this.mobileButtonBarValue?this.mobileButtonBarValue:null!==(d=null===(c=w.externalPropery.imageMeta)||void 0===c?void 0:c.vivid)&&void 0!==d?d:0,C="number-meta",P="tint";break;case"image-scale":x=v&&null!==this.mobileButtonBarValue?this.mobileButtonBarValue:null!==(p=null===(h=w.externalPropery.imageMeta)||void 0===h?void 0:h.scale)&&void 0!==p?p:0,C="number-meta",P="search-light";break;case"text-style-color":x=v&&this.mobileButtonBarColorValue?this.mobileButtonBarColorValue:null!==(m=null===(u=w.externalPropery.textStyle)||void 0===u?void 0:u.color)&&void 0!==m?m:"#000000",C="color";break;case"text-style-size":x=v&&this.mobileButtonBarLengthValue?this.mobileButtonBarLengthValue:new Length(null!==(g=null===(f=w.externalPropery.textStyle)||void 0===f?void 0:f.size)&&void 0!==g?g:"12pt"),C="length";break;case"text-style-hAlign":x=v&&this.mobileButtonBarStringValue?this.mobileButtonBarStringValue:null!==(b=null===(y=w.externalPropery.textStyle)||void 0===y?void 0:y.hAlign)&&void 0!==b?b:"left";for(let e=0;e<enums.horizontalTextAlign.length;e++)if(enums.horizontalTextAlign[e]===x){P=enumIcons.horizontalTextAlign[e];break}C="none"}}else if("form-field"===e.type){const t=e.newState.formField;if(C="ff",_=e.ffCircleCaption||"",t&&"COLOR_SCHEME"===t.systemType){const e=scope().colors.groups.get(scope().colorScheme);e&&e.color&&(S=e.color,C="color",_="")}}"length"===C&&x instanceof Length&&(_=x.toString());let T=!1;switch(C){case"number-meta":if(e.newState.externalPropery){const t=getNumberMetaByExternalProperty(e.newState.externalPropery,e.newState.metaProperty);if(t){const e="number"==typeof x?x:0,o=t.meta.min<0?0:t.meta.min;w=Math.round((e-o)/((t.meta.max-o)/100)),(v||0!==e)&&(_=Math.ceil(e*(t.meta.uiMultiplier||1)+(t.meta.uiOffset||0))+t.meta.postfix),T=!0}}break;case"length":_=x instanceof Length?x.toString():"???",T=!0;break;case"color":x&&"string"==typeof x&&(S=x)}const A=!!e.thumbCssUrl,E=!!S&&!A,k=_&&!E&&!A,I="none"!==P&&!k&&!A&&!E,R="ff"===C?"form-field-caption":"circular-svg-caption";return html`    
      <div class="circle-button-graphic">
        ${!A&&"ff"!==C?this.getSvgCircle(T,w,v):""}
        ${A?html`<div style="background-image: ${e.thumbCssUrl}; ${e.circleStyle||""}" class="circular-image ${v?"selected":""}"></div>`:""}
        ${k?html`<div class="${R}">${_}</div> `:""}
        ${E?html`<div class="circular-color ${v?"selected":""}" style="background-color: ${S};">${_}</div>`:""}
        ${I&&"none"!==P?html`<wc-icon class="circle-button-icon" primaryColor="toolbar" icon="${P}"></wc-icon>`:""}
      </div>
    `}getSvgCircle(e,t,o){return html` 
    <svg viewBox="0 0 36 36"  class="circular-svg ${o?"selected":""} ">
      <path class="circle-bg"
        d="M18 2.0845 
          a 15.9155 15.9155 0 0 1 0 31.831
          a 15.9155 15.9155 0 0 1 0 -31.831"
      />
      ${e&&0!==t?svg`
        <path class="circle"  
              transform="${t<0?"scale(-1,1) translate(-36,0)":""}"
                stroke-dasharray="${Math.abs(t)}, 100"
          d="M18 2.0845 
            a 15.9155 15.9155 0 0 1 0 31.831
            a 15.9155 15.9155 0 0 1 0 -31.831"
        />`:""}
    </svg>
  `}mobileButtonClick(e,t){var o;if(compareStates(t.newState,this.mobileUiState))return;const i=null==e?void 0:e.currentTarget;if(i&&this.shadowRoot){const e=i.offsetLeft,t=this.shadowRoot.querySelector(".mobile-buttons-scroll-container");if(t){scrollToLeft(t,e-window.innerWidth/2+i.offsetWidth/2,300)}}const r=t.newState;"ext-value"!==t.newState.state||"image"!==(null===(o=t.newState.externalPropery)||void 0===o?void 0:o.kind)||t.newState.metaProperty||(this.openSelectImageDialog(t.newState.externalPropery),r.metaProperty="image-scale"),this.mobileUiState=r}openSelectImageDialog(e){new WcSelectImageDialog("callback",e.id).showDialog((t=>{e&&(scope().selection.externalProperties=[],api.setProperty(e.id,t.id))}))}mobileUiStateIcon(e){switch(e){case"form-fields":case"selection":return"arrow-left";case"add":return"plus";case"ext-value":return"pen";case"form-field":return"shapes";default:return"arrow-left"}}backButtonClick(e){var t;e.preventDefault();const o=this.mobileUiState.state;let i=getMobileUiStateBackLink(this.mobileUiState);if("ext-value"===o&&"single-line-text"===(null===(t=this.mobileUiState.externalPropery)||void 0===t?void 0:t.kind)&&this.lastPosition&&(setCurrentScrollPosition(this.lastPosition),this.lastPosition=null),"imageCrop"===o&&scope().closeCropEditor(),"form-fields"===i||"selection"===i){if("geometry"!==this.selectedTool&&this.selectTool("geometry"),"selection"===i){1===getCurrentMobileUiButtons().length&&(i="form-fields")}"form-fields"===i&&this.selection.boxes.size>0&&scope().clearSelectionAndAllEditors(),this.mobileUiState={state:i},this.requestUpdate("mobileUiState",o)}}addButtonClick(e){e.preventDefault();const t=this.mobileUiState;"geometry"!==this.selectedTool&&this.selectTool("geometry"),this.selection.boxes.size>0?scope().clearSelectionAndAllEditors().then((()=>{this.mobileUiState={state:"add"},this.requestUpdate("mobileUiState",t)})):(this.mobileUiState={state:"add"},this.requestUpdate("mobileUiState",t))}resourceComponent(){return config.isMobile,null}hasActiveFeature(e){if("basics"===e)return this.selection.boxes.size>1;if(scope().selection.boxes.size>1){let t=!0;for(const o of scope().selection.boxes.values())t=t&&o.box.hasActiveFeature(e);return t}{const t=scope().selection.getSingleSelection();return!!t&&t.box.hasActiveFeature(e)}}canAddFeature(){const e=this.getToolDef();return this.selection.canAddFeature(e.feature)}canRemoveFeature(){const e=this.getToolDef();return"story"===e.tool?this.selection.canRemoveFeature("simpleText")||this.selection.canRemoveFeature("storyRef"):this.selection.canRemoveFeature(e.feature)}canAddFeatureCaption(){return this.getToolDef().addCaption}featureTitle(){const e=this.getToolDef();if("story"===e.tool)return this.selection.hasFeature("storyRef")||scope().eddiActive()||this.selection.hasFeature("simpleText"),"Text";if(this.selection.boxes.size>0){if("geometry"===e.tool){const e=this.selection.getSingleSelection();if(e){const t=e.box.basics.class;let o="";if(t&&(o&&(o+=" "),o+="["+t+"]"),o)return o}}return e.featureTitle}return"pathGeometry"===e.feature&&scope().pathEditorActive()||"transform"===e.feature&&(scope().perspectiveEditorActive()||scope().meshEditorActive())||"geometry"!==e.tool||this.selection.hasSelection()?e.featureTitle:"Document"}setTextMode(e){var t,o,i,r,s,n;return __awaiter$A(this,arguments,void 0,(function*(){const a=scope().selection.getSingleSelection();if(!a)return void alert("Please select a single frame to toggle the text mode.");scope().isRecording&&scope().e2e.record({module:"WcSelectionProperties",func:"setTextMode",args:Array.from(arguments)});const l=a.box.id;let c,d,h="F Text",p=null;a.box.storyRef&&(h=null!==(r=null===(i=null===(o=null===(t=null==a?void 0:a.box)||void 0===t?void 0:t.storyRef)||void 0===o?void 0:o.story)||void 0===i?void 0:i.toText())&&void 0!==r?r:"Fancy Text",h.length>50&&(h=h.substr(0,50)+" ..."));const u=scope().eddiActive()||a.box.getFeature("storyRef");if("single"!==e&&"symbol"!==e||!u){if("multi"!==e){const t=new Nobs;t.setProperty(a.box.simpleText,"isSymbolText","symbol"===e);const o=new Box(t,a.box);return void update([a.box.serialize(a.spread.id,a.doc.id)],[o.serialize(a.spread.id,a.doc.id)])}d="storyRef",c="simpleText",a.box.simpleText&&(h=a.box.simpleText.text)}else{const e=scope().docUi.getWcBox(a.box.id);if(scope().eddiActive()){if(!e)return void alert("Can't close editor, please try again.");p=scope().eddiGetSelectedTextInfo(),h=scope().eddiFirstPararaphText()||"Fancy Text",yield scope().closeEddi(e,!1)}d="simpleText",c="storyRef"}const m=new Nobs;if(c&&m.setProperty(a.box,c,null),"simpleText"===d){let t;if(p){const o={fnt:null!==(n=null===(s=p.font.value)||void 0===s?void 0:s.serialize())&&void 0!==n?n:void 0,txc:p.fontColor.value instanceof ColorRef?p.fontColor.value.serialize():void 0,txt:h,mode:"symbol"===e?"symbol":"text"};switch(p.horizontalTextAlign.value){case"center":o.hor="center";break;case"left":o.hor="left";break;case"right":o.hor="right"}t=new SimpleText(o)}else t=new SimpleText(h);m.setProperty(a.box,"simpleText",t),m.setProperty(a.box.basics,"class","")}else{const e={};if(a.box.simpleText){const t=a.box.simpleText;e.font=t.font,e.fontColor=t.fontColor,e.fontSize=new Length("30pt")}const t=new Story(generateDBID(),h,new TextStyle(e));create([t.serialize()]);const o=new StoryRef(t.id,void 0,"off");m.setProperty(a.box,"storyRef",o)}const f=new Box(m,a.box);update([a.box.serialize(a.spread.id,a.doc.id)],[f.serialize(a.spread.id,a.doc.id)]).then((()=>{setTimeout((()=>{const e=scope().getBox(l),t=scope().docUi.getWcBox(l);t&&e&&("storyRef"===d?scope().showEddi():this.selection=new Selection$1([t],e.spread))}),500)}))}))}removeFeature(){var e,t,o,i,r,s;scope().isRecording&&scope().e2e.record({module:"WcSelectionProperties",func:"removeFeature",args:Array.from(arguments)});const n=this.getToolDef();if(scope().selection.boxes.size>0)for(const e of scope().selection.boxes.values()){const t=e.box;this.removeFeatureFromBox(t)}else if("pathGeometry"===n.feature&&scope().pathEditorActive()){const o=null===(t=null===(e=scope().pathEditor)||void 0===e?void 0:e.boxRef)||void 0===t?void 0:t.box;o&&this.removeFeatureFromBox(o)}else if("transform"===n.feature&&scope().perspectiveEditorActive()){const e=null===(i=null===(o=scope().perspectiveEditor)||void 0===o?void 0:o.boxRef)||void 0===i?void 0:i.box;e&&this.removeFeatureFromBox(e)}else if("transform"===n.feature&&scope().meshEditorActive()){const e=null===(s=null===(r=scope().meshEditor)||void 0===r?void 0:r.boxRef)||void 0===s?void 0:s.box;e&&this.removeFeatureFromBox(e)}else if("storyRef"===n.feature&&scope().eddiActive()){const e=scope().eddiGetSelectedBox();if(e){this.removeFeatureFromBox(e.box),scope().closeEddi(),scope().selectionPropertiesUi.selectTool("geometry");const t=scope().docUi.getWcBox(e.box.id);t&&(t.storyFlowIndex=0)}}}removeFeatureFromBox(e){return __awaiter$A(this,void 0,void 0,(function*(){const t=this.getToolDef(),o=new Nobs;let i=!1;switch(t.feature){case"imageRef":o.setProperty(e,"imageRef",null),i=!0;break;case"pathText":o.setProperty(e,"pathText",null),i=!0;break;case"simpleText":case"storyRef":o.setProperty(e,"simpleText",null),o.setProperty(e,"storyRef",null),e.imageRef&&"simpleText"===e.imageRef.imageMasking&&o.setProperty(e.imageRef,"imageMasking","none"),i=!0;break;case"pathGeometry":o.setProperty(e,"pathGeometry",null),e.imageRef&&"pathGeometry"===e.imageRef.imageMasking&&o.setProperty(e.imageRef,"imageMasking","none"),i=!0;break;case"transform":o.setProperty(e,"transform",null),i=!0;break;case"effect":o.setProperty(e,"effect",null),i=!0;break;case"docRef":o.setProperty(e,"docRef",null),i=!0}if(!0===i){const t=new Box(o,e),i=scope().currentDoc.getBoxRef(e.id);i&&(yield update([e.serialize(i.spread.id,i.doc.id)],[t.serialize(i.spread.id,i.doc.id)]))}}))}addNewFeature(){var e,t;scope().isRecording&&scope().e2e.record({module:"WcSelectionProperties",func:"addNewFeature",args:Array.from(arguments)});const o=this.getToolDef();if(scope().selection.boxes.size>0)for(const e of scope().selection.boxes.values()){const t=e.box;this.addNewFeatureToBox(t),o.feature}else if("pathGeometry"===o.feature&&scope().pathEditorActive()){const o=null===(t=null===(e=scope().pathEditor)||void 0===e?void 0:e.boxRef)||void 0===t?void 0:t.box;o&&(this.addNewFeatureToBox(o),scope().showPathEditor())}}addNewFeatureToBox(e,t=this.getToolDef()){return __awaiter$A(this,void 0,void 0,(function*(){if(e&&!e.getFeature(t.feature)){const o=new Nobs;let i,r=!1;switch(t.feature){case"imageRef":scope().images.size>0?(o.setProperty(e,"imageRef",ImageRef.createImageRef(scope().images.values().next().value)),r=!0):alert("Please upload an image first");break;case"pathText":e.pathGeometry||o.setProperty(e,"pathGeometry",PathGeometry.createCirclePath()),o.setProperty(e,"pathText",new PathText),r=!0;break;case"simpleText":i=new SimpleText,o.setProperty(e,"simpleText",i),r=!0;break;case"storyRef":if(!e.storyRef){const t=Story.anyStory();create([t.serialize()]);const i=new StoryRef(t.id);o.setProperty(e,"storyRef",i),r=!0}break;case"pathGeometry":o.setProperty(e,"pathGeometry",PathGeometry.createBadgePath()),e.imageRef&&o.setProperty(e.imageRef,"mask","pathGeometry"),r=!0;break;case"transform":o.setProperty(e,"transform",new Transform),r=!0;break;case"effect":o.setProperty(e,"effect",new Effect),r=!0;break;case"docRef":o.setProperty(e,"docRef",new DocRef("","")),r=!0}if(!0===r){const t=new Box(o,e),i=scope().currentDoc.getBoxRef(e.id);i&&(yield update([e.serialize(i.spread.id,i.doc.id)],[t.serialize(i.spread.id,i.doc.id)]))}}}))}addStory(e){scope().isRecording&&scope().e2e.record({module:"WcSelectionProperties",func:"addStory",args:Array.from(arguments)});const t=(null==e?void 0:e.className)||"Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Donec quam felis, ultricies nec, pellentesque eu, pretium quis, sem. Nulla consequat massa quis enim.";this.selection&&this.selection.getSingleSelection()?(new WcTipDialog).showDialog("addFeatureOrCreateBox").then((o=>{"addBox"===o?scope().createNewBox("auto",boxTypeE.story,void 0,null==e?void 0:e.className,t).then((()=>{scope().selectionPropertiesUi.selectedTool="story"})):"OK"===o&&this.addTextFeature("storyRef",e)})):(scope().skipAutoShowEddiForOneTime=!0,scope().createNewBox("auto",boxTypeE.story,void 0,null==e?void 0:e.className,t).then((()=>{scope().selectionPropertiesUi.selectedTool="story"})))}addSimpleText(e){scope().isRecording&&scope().e2e.record({module:"WcSelectionProperties",func:"addSimpleText",args:Array.from(arguments)}),this.selection&&this.selection.getSingleSelection()?(new WcTipDialog).showDialog("addFeatureOrCreateBox").then((t=>{"addBox"===t?scope().createNewBox("auto",boxTypeE.text,void 0,void 0,void 0,void 0,void 0,void 0,e).then((()=>{scope().selectionPropertiesUi.selectedTool="story"})):"OK"===t&&this.addTextFeature("simpleText",void 0,e)})):scope().createNewBox("auto",boxTypeE.text,void 0,void 0,void 0,void 0,void 0,void 0,e).then((()=>{scope().selectionPropertiesUi.selectedTool="story"}))}addPathText(){scope().isRecording&&scope().e2e.record({module:"WcSelectionProperties",func:"addSimpleText",args:Array.from(arguments)}),this.selection&&this.selection.getSingleSelection()?(new WcTipDialog).showDialog("addFeatureOrCreateBox").then((e=>{"addBox"===e?scope().createNewBox("auto",boxTypeE.pathText,void 0).then((()=>{scope().selectionPropertiesUi.selectedTool="pathText"})):"OK"===e&&this.addTextFeature("pathText")})):scope().createNewBox("auto",boxTypeE.pathText,void 0).then((()=>{scope().selectionPropertiesUi.selectedTool="pathText"}))}addTextFeature(e,t,o){if(this.selection){const i=this.selection.getSingleSelection();if(i){const r=new Nobs;if("pathText"===e)i.box.pathGeometry||r.setProperty(i.box,"pathGeometry",PathGeometry.createCirclePath()),r.setProperty(i.box,e,new PathText);else if("simpleText"===e)if("symbol"===o){const t=new FontRef(getSymbolFont());r.setProperty(i.box,e,new SimpleText({mode:"symbol",fnt:t.serialize(),txt:""}))}else r.setProperty(i.box,e,new SimpleText);else{const t=new Story(generateDBID(),"a b c");create([t.serialize()]),r.setProperty(i.box,e,new StoryRef(t.id,void 0,"off"))}t&&r.setProperty(i.box.basics,"class",t.className);const s=new Box(r,i.box).serialize(i.spread.id,i.doc.id);update([i.box.serialize(i.spread.id,i.doc.id)],[s]).then((()=>{"storyRef"===e&&setTimeout((()=>{scope().showEddi()}),500)}))}else alert("Please select a single frame.")}}}customElements.define("wc-selection-properties",WcSelectionProperties);var __awaiter$B=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};let newSelectionCallCounter=0,oldBuyerPropertyKeys=[];function setOldBuyerPropertyKeys(e){oldBuyerPropertyKeys=e}var eTriState;let lastHitTestIds;!function(e){e.on="on",e.off="off",e.mixed="mixed",e.null="null"}(eTriState||(eTriState={}));class Listener{constructor(e,t){this.feature=e,this.property=t}}class SimpleTextTextListener extends Listener{constructor(){super("simpleText","text")}getBoxesWithDistributionClass(e){const t=scope().currentDoc,o=[];for(const i of t.spreads.values())for(const t of i.boxes.values())t.simpleText&&-1!=t.basics.class.indexOf(e)&&o.push({box:t,parentId:i.id});return o}setTextEmpty(e,t,o){const i=scope().currentDoc;for(const r of e){const e=new Nobs;e.setProperty(r.box.simpleText,"text","");const s=new Box(e,r.box);t.push(r.box.serialize(r.parentId,i.id)),o.push(s.serialize(r.parentId,i.id))}}handleTextDistribution(e,t,o,i){return __awaiter$B(this,void 0,void 0,(function*(){const r=t.basics.class.match(/text-distribution-\d+(?!-)/);if(null===r)return;const s=scope().docUi.getWcBox(t.id);if(null===s)return;let n="";const a=scope().currentDoc,l=e.getChangedProperties(t[this.feature]);n=l?l.get(this.property):SimpleText.getText(s);const c=n.split(/\s+/).filter((e=>""!==e)),d=this.getBoxesWithDistributionClass(r[0]+"-").filter((e=>null!==e.box.basics.class.match(/text-distribution-\d+-(\w+)/)));if(1===c.length)return void this.setTextEmpty(d,o,i);const h=c.map((e=>e.length)).reduce(((e,t)=>e+t),0),p=new Array(d.length);for(let e=0;e<d.length;e++)p[e]=[];let u=0,m=0;const f=h/d.length;if(2==d.length){let e=0,t=c.length-1,o=c[e].length,i=c[t].length;for(p[0].push(c[e]),p[1].push(c[t]);e!=t;)o>i?(t--,e!=t&&(p[1].push(c[t]),i+=c[t].length)):(e++,e!=t&&(p[0].push(c[e]),o+=c[e].length));p[1]=p[1].reverse()}else for(let e=0;e<c.length;e++){const t=c[e];m<f?(p[u].push(t),m+=t.length):(u++,p[u].push(t),m=t.length)}const g=new Map,y=[];for(const e of d){const t=e.box.basics.class.match(/text-distribution-\d+-(\w+)/);if(null==t)throw"This cannot happen. Just to make TS happy.";g.set(t[1],e),y.push(t[1])}y.sort().forEach(((e,t)=>{const r=g.get(e);if(r){const e=new Nobs;e.setProperty(r.box.simpleText,"text",p[t].join(" "));const s=new Box(e,r.box);o.push(r.box.serialize(r.parentId,a.id)),i.push(s.serialize(r.parentId,a.id))}}))}))}addNobs(e,t,o,i){return __awaiter$B(this,void 0,void 0,(function*(){const r="font-size-1",s=t.basics.class.match(/font-size-(\d+)/);if(yield this.handleTextDistribution(e,t,o,i),t.simpleText&&null===s)return;const n=scope().currentDoc;let a=1e5;for(const o of n.spreads.values())for(const i of o.boxes.values())if(i.simpleText&&-1!=i.basics.class.indexOf(r)){const o=scope().docUi.getWcBox(i.id);let r=null;if(i.id==t.id){const o=e.getChangedProperties(t[this.feature]);o&&(r=o.get(this.property))}if(o){const e=(yield SimpleText.calculateSvgDto(o,r)).fontSize;e>0&&e<a&&(a=e)}}n.spreads.forEach((s=>{s.boxes.forEach((l=>{if(l.id==t.id)e.setProperty(t.simpleText,"hasFontSize",!0),e.setProperty(t.simpleText,"fontSize",new Length(a,"px"));else if(l.simpleText&&-1!=l.basics.class.indexOf(r)){const e=new Nobs;e.setProperty(l.simpleText,"hasFontSize",!0),e.setProperty(l.simpleText,"fontSize",new Length(a,"px"));const t=new Box(e,l);o.push(l.serialize(s.id,n.id)),i.push(t.serialize(s.id,n.id))}}))}))}))}}let Listeners=(()=>{class e{static add(t){e.items.push(t)}static addNobs(t,o,i,r,s,n){return __awaiter$B(this,void 0,void 0,(function*(){for(let a=0;a<e.items.length;a++){const l=e.items[a];t==l.feature&&o==l.property&&(yield l.addNobs(i,r,s,n))}}))}}return e.items=[],e})();Listeners.add(new SimpleTextTextListener);let Selection$1=(()=>{class e{constructor(e,t,o=!1,i="none"){if(this.mouseDownModel={x:0,y:0,hasCroppedImages:!1,hasBoxCongruentImages:!1},this.dropTargetBox=null,this.scaleStory=!1,this.newTouchImageScale=null,this.newTouchImageScaleBoxId=null,this.lastScaleFactor=1,this._setPositionCount=0,newSelectionCallCounter++,newSelectionCallCounter>2)throw alert("Recursive call of selection constructor"),new Error("Recursive call of selection constructor");this.boxes=new Map,this.innerFrame=null;const r=scope().currentDoc.layers;if(e&&(e=e.filter((e=>{if(e.box.basics.lockBox||!e.box.basics.visible)return!1;{const t=r.get(e.box.layerId);return!(t&&(t.lock||!t.isCurrentlyVisible()))}}))),e&&e.length>1&&config.isBuyer){const t=e[0].box.boxGroupId;e=t?e.filter((e=>e.box.boxGroupId===t)):[e[0]]}if(e&&e.length||scope().anyEditorActive()?noZoomForAllItems(!0):noZoomForAllItems(!1),scope().docUi.resetWcBoxSelectionFlag(),!config.hideControls)if(0===scope().updatesBeforeBlurActiveElementOnNewSelection){if(document.activeElement)try{document.activeElement.blur()}catch(e){console.error("Can't blur active element; ",e)}}else scope().updatesBeforeBlurActiveElementOnNewSelection--;if(e&&!o)for(const t of e)this.boxes.set(t.box.id,t),e.length>1&&(t.isInMultiSelection=!0),t.hover=!1,t.isInSelection=!0;if(!t&&scopeIsInitialised()){const e=scope().selection.spread;e&&scope().currentDoc.spreads.has(e.id)&&(t=scope().selection.spread)}if(this.spread=t,t){const e=scope().docUi.getDivForSelection(t.id),o=scope().boxSelection.parentNode;e&&o!==e&&(o&&o.removeChild(scope().boxSelection),e.appendChild(scope().boxSelection))}if(this.boxes.size>0)scope().boxSelection.zoom=zoomFactor(),scope().boxSelection.geo=this.boundingBoxGeo=this.boundingBox(),scope().docUi.currentLayerId=this.boxes.values().next().value.box.layerId;else if(o&&e&&1===e.length)this.innerFrame=e[0],scope().boxSelection.zoom=zoomFactor(),scope().boxSelection.geo=this.boundingBoxGeo=this.boundingBox(),scope().docUi.currentLayerId=e[0].box.layerId;else{const e=scope().boxSelection.parentNode;e&&e.removeChild(scope().boxSelection)}if("image"===i&&e&&1===e.length&&e[0].box.imageRef||"doc"===i&&e&&1===e.length&&e[0].box.docRef?(this.crop=i,scope().boxSelection.crop=!0):(this.crop="none",scope().boxSelection.crop=!1),e&&1===e.length&&e[0].box.storyRef?scope().boxSelection.showTextIcon=!0:scope().boxSelection.showTextIcon=!1,scope().boxSelection.showExitIcon=scope().eddiActive(),scope().layersVisible&&scope().layersUi.requestUpdate(),scope().colorsVisible&&scope().resourcesColorsUi.showSelectionColors(e),e&&1===e.length){const t=e[0],o=scope().selectionPropertiesUi.selectedTool,i=WcSelectionProperties.getFeatureByTool(o);let r=null;isContentTool(o)?t.selectedContentTool&&t.box[WcSelectionProperties.getFeatureByTool(t.selectedContentTool)]?r=t.selectedContentTool:t.box[i]||(r=t.getPrimaryContentTool()):"geometry"===o&&!scope().selectionPropertiesUi.lastGeometrySelectionWasUserInduced&&scope().selectionPropertiesUi.lastContentToolSelectionWasUserInduced&&(r=t.getPrimaryContentTool(),t.selectedContentTool&&t.box[WcSelectionProperties.getFeatureByTool(t.selectedContentTool)]&&(r=t.selectedContentTool)),1===newSelectionCallCounter&&r&&r!==o&&scope().selectionPropertiesUi.selectTool(r)}if(t)for(const e of scope().currentDoc.boundUiBoxesIds){const o=t.boxes.get(e);if(o){const e=scope().docUi.getWcBox(o.id);e&&e.requestUpdate()}}newSelectionCallCounter--,this.executeSelectionChangeCallbacks(Array.from(this.boxes.values()).map((e=>e.box))),scopeIsInitialised()&&(scope().toolbarUi.canDelete=this.canRemove())}get externalProperties(){return e._currentExternalProperties}set externalProperties(t){e._currentExternalProperties=t}executeSelectionChangeCallbacks(e){scope().buyerPropertiesGroup=new BuyerPropertiesGroup(e);let t=!0;if(t){const e=Array.from(scope().buyerPropertiesGroup.groupedProperties.keys());if(oldBuyerPropertyKeys&&e.length===oldBuyerPropertyKeys.length){t=!1;for(let o=0;o<e.length;o++){const i=e[o];if(oldBuyerPropertyKeys[o]!==i){t=!0;break}}}oldBuyerPropertyKeys=e}if(t){this.externalProperties=scope().buyerPropertiesGroup.getExternalProperties();for(const e of scope().externalSelectionChangedCallbacks)e(this.externalProperties)}}get restrictToDocument(){return(config.isBuyer||config.isMobile)&&scope().currentDoc.keepFramesInsidePage}get canCrop(){let e=!0;if(0===this.boxes.size)return!1;for(const t of this.boxes.values())if(t.box.imageRef){const o=t.box.getValue("imageRef","image");o?"external"===o.type?e=!1:t.boxGeometry.hasHeight()&&t.boxGeometry.hasWidth()||(e=!1):e=!1}else e=!1;return e}rotatorAngle(){return this.boundingBoxGeo.anchorRight?this.boundingBoxGeo.anchorLeft?this.boundingBoxGeo.anchorTop?-90:90:180:0}static imageIsCongruent(e){return!!e&&(1===e.imageWidthScale&&1===e.imageHeightScale&&0===e.imageXPosition&&0===e.imageYPosition)}mouseDown(t,o){var i;if(resetLastValidTransformedBox(),t.wasRightClick)return;o?this.mover=null:(this.mover=scope().boxSelection.getMover(t),"none"!==this.crop&&!1!==(null===(i=this.mover)||void 0===i?void 0:i.image)||!config.isBuyer&&!config.isMobile||this.allows("allowFrame","positionByMouse")||(this.mover=void 0)),scope().isReplaying?this.mover=scope().e2e.getCachedValue("mover"):scope().isRecording&&scope().e2e.cache("mover",this.mover),this.mouseDownModel={x:t.model.x,y:t.model.y,hasCroppedImages:Array.from(this.boxes.values()).map((e=>{var t,o;return null!==(o="crop"===(null===(t=e.imageRef)||void 0===t?void 0:t.imagePlacement))&&void 0!==o&&o})).reduce(((e,t)=>e||t),!1),hasBoxCongruentImages:Array.from(this.boxes.values()).map((t=>e.imageIsCongruent(t.imageRef))).reduce(((e,t)=>e||t),!1)};let r=scope().boxSelection.getTextOverflowCtrl(t);if(scope().isReplaying?r=scope().e2e.getCachedValue("flowi"):scope().isRecording&&scope().e2e.cache("flowi",r),r){const e=scope().selection.getSingleSelection();e&&(e&&"off"===e.box.autoSizeMode?scope().showTextFlowTool(e):scope().isReplaying||(alert("Auto size text frames can't be part of a text flow."),cancelMouseRouting()))}}mouseMove(t,o){if(SnapLine.clear_ui(),void 0===this.mover)return;if(0===this.boxes.size)return;if(!this.spread)return;let i=t.shiftKey?"shift-translate":"translate",r=!1;this.scaleStory=!1;let s=t.modelDelta.x,n=t.modelDelta.y,a=t.model.x-this.spread.left(),l=t.model.y-this.spread.top();const c=a-s,d=l-n;let h="left",p="top";if(this.mover&&("none"!==this.mover.horizontal&&(h=this.mover.horizontal),"none"!==this.mover.vertical&&(p=this.mover.vertical)),this.mover)this.mover.rotator?(i="rotate",t.shiftKey&&(i="shift-rotate")):(i="scale","none"===this.mover.horizontal||this.mover.image||this.boundingBoxGeo.isXAxisControlledByStyle(this.mover.horizontal)&&(a=c,s=0),"none"===this.mover.vertical||this.mover.image||this.boundingBoxGeo.isYAxisControlledByStyle(this.mover.vertical)&&("bottom"===this.mover.vertical&&"right"===this.mover.horizontal&&this.boundingBoxGeo.isYAxisControlledByStyle("bottom",!0)?(i="scale-prop",r=!0,this.scaleStory=!0):(l=d,n=0)));else if(this.boundingBoxGeo.moveXLocked()&&(s=0,a=c),this.boundingBoxGeo.moveYLocked()&&(n=0,l=d),this.dropTargetBox=null,1===this.boxes.size){this.boxes.values().next().value.box.lock.isUiElement&&(this.dropTargetBox=zoomstageMouseHoverCallback(t,"dropOnBuyerOrderNo"))}const u=this.toNewPixelBasedBoundingBox(o),m=this.mouseDownModel.hasCroppedImages&&this.mover&&("center"===this.mover.horizontal||"middle"===this.mover.vertical);if("doc"===this.crop&&this.mover&&this.mover.image||!this.mover&&"doc"===this.crop){if(1===this.boxes.size){const e=this.getSelectedWcBoxes()[0],t=e.box.docRef?scope().getDocByName(e.box.docRef.documentName):null;if(e&&e.box&&e.box.docRef&&t){const o=e.box.docRef,r={left:u.left.value,top:u.top.value,width:u.width.value,height:u.height.value},m={left:u.width.value*o.docXPosition,top:u.height.value*o.docYPosition,width:u.width.value*o.docWidthScale,height:u.height.value*o.docHeightScale},f=.5,g=.5,y=rotatePointInBox(a,l,r,-u.rotation,BoxGeometry.getRotationPositionX(e.boxGeometry),BoxGeometry.getRotationPositionY(e.boxGeometry));if(a=y.x-r.left,l=y.y-r.top,this.mover)i="center"===this.mover.horizontal||"middle"===this.mover.vertical?"scale":"scale-prop";else{i="translate";const t=rotatePointInBox(c,d,r,-u.rotation,BoxGeometry.getRotationPositionX(e.boxGeometry),BoxGeometry.getRotationPositionY(e.boxGeometry));s=y.x-t.x,n=y.y-t.y}const b=transformRect({left:m.left,top:m.top,width:m.width,height:m.height,rotation:0,ax:"left",ay:"top",rotXFactor:f,rotYFactor:g},a,l,s,n,h,p,i,t.pageWidth,t.pageHeight,"center","middle",this.restrictToDocument,void 0,!1),v=o.serializeNewCrop(b.left/u.width.value,b.top/u.height.value,b.width/u.width.value,b.height/u.height.value);e.imagePanOffsetX=s,e.imagePanOffsetY=n,e.docRef=new DocRef(v),scope().boxSelection.requestUpdate()}}}else if(this.mover&&this.mover.image||!this.mover&&("image"===this.crop||o)){if(1===this.boxes.size||o){const t=o||this.getSelectedWcBoxes()[0];if(t&&t.box&&t.box.imageRef){const r=t.box.imageRef,m={left:u.left.value,top:u.top.value,width:u.width.value,height:u.height.value},f={left:u.width.value*r.imageXPosition,top:u.height.value*r.imageYPosition,width:u.width.value*r.imageWidthScale,height:u.height.value*r.imageHeightScale},g=.5,y=.5,b=rotatePointInBox(a,l,m,-u.rotation,BoxGeometry.getRotationPositionX(t.boxGeometry),BoxGeometry.getRotationPositionY(t.boxGeometry));if(a=b.x-m.left,l=b.y-m.top,this.mover&&!o)i="center"===this.mover.horizontal||"middle"===this.mover.vertical?"scale":"scale-prop";else{i="translate";const e=rotatePointInBox(c,d,m,-u.rotation,BoxGeometry.getRotationPositionX(t.boxGeometry),BoxGeometry.getRotationPositionY(t.boxGeometry));s=b.x-e.x,n=b.y-e.y}const v=transformRect({left:f.left,top:f.top,width:f.width,height:f.height,rotation:0,ax:"left",ay:"top",rotXFactor:g,rotYFactor:y},a,l,s,n,h,p,i,r.image.width,r.image.height,"center","middle",this.restrictToDocument,void 0,!1),x={id:r.imageId,m:r.imageMasking,ip:"crop",im:r.image.serialize().data,ws:v.width/u.width.value,hs:v.height/u.height.value,px:v.left/u.width.value,py:v.top/u.height.value,hc:r.horizontalFocalPoint,vc:r.verticalFocalPoint};(config.isBuyer||config.isMobile)&&e.removeSpaceAroundImage(x,u.width.value,u.height.value,!1),t.imagePanOffsetX=s,t.imagePanOffsetY=n,t.imageRef=new ImageRef(t.box.imageRef.imageId,x),scope().boxSelection.requestUpdate()}}}else{this.mover&&"scale"===i&&("center"===this.mover.horizontal||"middle"===this.mover.vertical||r||(t.shiftKey&&(i="scale-prop"),(this.boxes.size>1||this.mouseDownModel.hasCroppedImages||this.mouseDownModel.hasBoxCongruentImages)&&"none"===this.crop&&(i=t.shiftKey?"scale":"scale-prop")));let e=.5,o=.5,c="center",d="middle";1===this.boxes.size&&(e=BoxGeometry.getRotationPositionX(this.boundingBoxGeo),o=BoxGeometry.getRotationPositionY(this.boundingBoxGeo),c=this.boundingBoxGeo.moverAnchorNameX,d=this.boundingBoxGeo.moverAnchorNameY);const f=transformRect({left:u.left.value,top:u.top.value,width:u.width.value,height:u.height.value,rotation:u.rotation,ax:"left",ay:"top",rotXFactor:e,rotYFactor:o},a,l,s,n,h,p,i,void 0,void 0,c,d,this.restrictToDocument,this.mover);if(this.apply(f),(scope().boxSelection.crop||m)&&1===this.boxes.size){const t=this.boxes.keys().next().value,i=scope().docUi.getWcBox(t);if("image"===this.crop&&i&&i.box.imageRef){const t=this.getCroppedImage(i.box.imageRef,u,e,o,f);i.imageRef=new ImageRef(i.box.imageRef.imageId,t)}if("doc"===this.crop&&i&&i.box.docRef){const t=this.getCroppedDoc(i.box.docRef,u,e,o,f);i.docRef=new DocRef(t)}}}}setImageScale(e,t,o){if(1===this.boxes.size){const t=this.getSelectedWcBoxes()[0];if(t&&t.box&&t.box.imageRef){const o=t.box.imageRef,i=o.imageWidthScale/2+o.imageXPosition-e*o.imageWidthScale/2,r=o.imageHeightScale/2+o.imageYPosition-e*o.imageHeightScale/2;this.newTouchImageScaleBoxId=t.box.id,this.newTouchImageScale={id:o.imageId,m:o.imageMasking,ip:"crop",im:o.image.serialize().data,ws:o.imageWidthScale*e,hs:o.imageHeightScale*e,px:i,py:r,hc:o.horizontalFocalPoint,vc:o.verticalFocalPoint},t.imageRef=new ImageRef(t.box.imageRef.imageId,this.newTouchImageScale),scope().boxSelection.requestUpdate()}}}setImageScaleAbsolute(t,o){let i=null;if(o?i=scope().docUi.getWcBox(o):1===this.boxes.size&&(i=this.getSelectedWcBoxes()[0]),i&&i.box&&i.box.imageRef){const r=i.box.imageRef;let s={ws:t,hs:t*(r.imageHeightScale/r.imageWidthScale)};if(config.isBuyer||config.isMobile||o){const o=this.spread||scope().docUi.currentSpread,n=i.box.boxGeometry.toPixel(o.width(),o.height());s=e.validateImageScale(t,r.imageWidthScale,r.imageHeightScale,n.height,n.width)}const n=r.imageWidthScale/2+r.imageXPosition-s.ws/2,a=r.imageHeightScale/2+r.imageYPosition-s.hs/2;this.newTouchImageScaleBoxId=i.box.id;const l={id:r.imageId,m:r.imageMasking,ip:"crop",im:r.image.serialize().data,ws:s.ws,hs:s.hs,px:n,py:a,hc:r.horizontalFocalPoint,vc:r.verticalFocalPoint};if(config.isBuyer||config.isMobile||o){const t=this.spread||scope().docUi.currentSpread,o=i.box.boxGeometry.toPixel(t.width(),t.height());e.removeSpaceAroundImage(l,o.height,o.width,!0)}this.newTouchImageScale=l,i.imageRef=new ImageRef(i.box.imageRef.imageId,this.newTouchImageScale),scope().boxSelection.requestUpdate()}}static validateImageScale(e,t,o,i,r){const s=e*(o/t),n={ws:e,hs:s};let a=r*s,l=i*e;return l<i&&(n.hs=o/t,n.ws=1,a=r*n.hs,l=i*n.ws),a<r&&(n.ws=t/o,n.hs=1),n}static getMinMaxImageScaleX(e,t,o){let i=o.image.width,r=o.image.height;const s=scope().images.get(o.image.id);s&&s.scales&&s.scales.length>0&&s.scales[0].width>i&&(i=s.scales[0].width,r=s.scales[0].height);const n=e/t,a=i/r;let l=1;l=a>=n?a/n:1;const c=i/1/(e/96);return{min:l,max:c/(config.scaledImageMinimumDpi||scope().currentDoc.scaledImageMinimumDpi),dpiAtScale1:c}}static removeSpaceAroundImage(e,t,o,i){if(i){let i=o*e.hs,r=t*e.ws;r<t&&(e.hs=e.hs/e.ws,e.ws=1,i=o*e.hs,r=t*e.ws),i<o&&(e.ws=e.ws/e.hs,e.hs=1)}if(e.px>0&&(e.px=0),e.py>0&&(e.py=0),e.px<0){const o=t*e.px,i=t*e.ws;if(o+i<t){const o=t-i;e.px=o/t}}if(e.py<0){const t=o*e.py,i=o*e.hs;if(t+i<o){const t=o-i;e.py=t/o}}}persistImageScale(){if(this.newTouchImageScale&&this.newTouchImageScaleBoxId){const e=scope().getBox(this.newTouchImageScaleBoxId);if(e&&e.box.imageRef){const t=(new Nobs).setProperty(e.box,"imageRef",new ImageRef(e.box.imageRef.imageId,this.newTouchImageScale)),o=new Box(t,e.box).serialize(e.spread.id,e.doc.id);update([e.box.serialize(e.spread.id,e.doc.id)],[o])}}}getCroppedImage(e,t,o,i,r){const s={x:t.width.value*e.imageXPosition+t.left.value,y:t.height.value*e.imageYPosition+t.top.value},n={left:t.left.value,top:t.top.value,width:t.width.value,height:t.height.value},a=rotatePointInBox(s.x,s.y,n,t.rotation,o,i),l=rotatePointInBox(a.x,a.y,r,-t.rotation,o,i),c={id:e.imageId,m:e.imageMasking,ip:"crop",im:e.image.serialize().data,ws:t.width.value*e.imageWidthScale/r.width,hs:t.height.value*e.imageHeightScale/r.height,px:(l.x-r.left)/r.width,py:(l.y-r.top)/r.height,hc:e.horizontalFocalPoint,vc:e.verticalFocalPoint};return console_log(c),c}getCroppedDoc(e,t,o,i,r){const s={x:t.width.value*e.docXPosition+t.left.value,y:t.height.value*e.docYPosition+t.top.value},n={left:t.left.value,top:t.top.value,width:t.width.value,height:t.height.value},a=rotatePointInBox(s.x,s.y,n,t.rotation,o,i),l=rotatePointInBox(a.x,a.y,r,-t.rotation,o,i),c=e.serializeNewCrop((l.x-r.left)/r.width,(l.y-r.top)/r.height,t.width.value*e.docWidthScale/r.width,t.height.value*e.docHeightScale/r.height);return console_log(c),c}fitFrameToImage(){scope().isRecording&&scope().e2e.record({module:"selection",func:"fitFrameToImage",args:[]});for(const e of this.boxes.values()){const t=scope().getBox(e.box.id);if(t&&t.box.imageRef){const o=t.box.imageRef,i=new Nobs,r=t.spread.width(),s=t.spread.height(),n=t.box.boxGeometry.toPixel(r,s),a=n.width*(o.image.height/o.image.width);i.setProperty(t.box,"boxGeometry",t.box.boxGeometry.fromPixel(r,s,n.left,n.top,n.width,a,t.box.boxGeometry.rotation));const l={id:o.imageId,m:o.imageMasking,ip:o.imagePlacement,im:o.image.serialize().data,ws:1,hs:1,px:0,py:0,hc:o.horizontalFocalPoint,vc:o.verticalFocalPoint};i.setProperty(t.box,"imageRef",new ImageRef(t.box.imageRef.imageId,l));const c=new Box(i,t.box).serialize(t.spread.id,t.doc.id);update([e.box.serialize(t.spread.id,t.doc.id)],[c])}}}fitFrameToDocRef(){scope().isRecording&&scope().e2e.record({module:"selection",func:"fitFrameToDocRef",args:[]});for(const e of this.boxes.values()){const t=scope().getBox(e.box.id);let o=null;if((null==t?void 0:t.box.docRef)&&(o=scope().getDocByName(t.box.docRef.documentName)),t&&t.box.docRef&&o){const i=t.box.docRef,r=new Nobs,s=t.spread.width(),n=t.spread.height(),a=t.box.boxGeometry.toPixel(s,n),l=a.width*(o.pageHeight/o.pageWidth);r.setProperty(t.box,"boxGeometry",t.box.boxGeometry.fromPixel(s,n,a.left,a.top,a.width,l,t.box.boxGeometry.rotation));const c=i.serializeNewCrop(0,0,1,1);r.setProperty(t.box,"docRef",new DocRef(c));const d=new Box(r,t.box).serialize(t.spread.id,t.doc.id);update([e.box.serialize(t.spread.id,t.doc.id)],[d])}}}fitOrFillImage(e,t,o,i=!1){scope().isRecording&&scope().e2e.record({module:"selection",func:"fitOrFillImage",args:Array.from(arguments)});for(const r of this.boxes.values())if(r&&r.box&&r.box.imageRef){const s=r.box.imageRef,n=e||s.imagePlacement;let a;if("crop"===n)a={id:s.imageId,m:s.imageMasking,ip:n,im:s.image.serialize().data,ws:s.imageWidthScale,hs:s.imageHeightScale,px:s.imageXPosition,py:s.imageYPosition,hc:s.horizontalFocalPoint,vc:s.verticalFocalPoint};else{const e=r.box.getImagePosition(s.image,n,t||s.horizontalFocalPoint,o||s.verticalFocalPoint);a={id:s.imageId,m:s.imageMasking,ip:i?"crop":n,im:s.image.serialize().data,ws:e.ws,hs:e.hs,px:e.px,py:e.py,hc:void 0!==t?t:s.horizontalFocalPoint,vc:void 0!==o?o:s.verticalFocalPoint}}const l=scope().getBox(r.box.id);if(l){const e=(new Nobs).setProperty(r.box,"imageRef",new ImageRef(r.box.imageRef.imageId,a)),t=new Box(e,r.box).serialize(l.spread.id,l.doc.id);update([r.box.serialize(l.spread.id,l.doc.id)],[t])}}}fitOrFillDocRef(e,t,o,i=!1){scope().isRecording&&scope().e2e.record({module:"selection",func:"fitOrFillDoc",args:Array.from(arguments)});for(const r of this.boxes.values())if(r&&r.box&&r.box.docRef){const s=r.box.docRef,n=e||s.documentPlacement;let a;if("crop"===n)a=s.serialize(),a.pl=n;else{const e=r.box.getDocRefPosition(s.documentName,n,t||s.horizontalFocalPointDocument,o||s.horizontalFocalPointDocument);a=s.serializeNewCrop(e.px,e.py,e.ws,e.hs),a.pl=i?"crop":n}const l=scope().getBox(r.box.id);if(l){const e=(new Nobs).setProperty(r.box,"docRef",new DocRef(a)),t=new Box(e,r.box).serialize(l.spread.id,l.doc.id);update([r.box.serialize(l.spread.id,l.doc.id)],[t])}}}up_once(t,o,i,r){var s;if(scope().boxSelection.mouseDown=!1,SnapLine.clear_ui(),void 0===this.mover){if(!o){if((config.isBuyer||config.isMobile)&&this.spread){const e=t.model.x-this.spread.left(),o=t.model.y-this.spread.top(),i=hitTest(new Rect(e,o,1,1),this.spread.toHitTestFrames(!0),!1);i.length&&scope().uiFrameClick(i[0].id||"")}return}this.mover=null}if(document.getElementById("contextMenu"))return;if(t.wasRightClick)return;if(i&&1===this.boxes.size){const e=this.boxes.values().next().value;if(e.box.storyRef&&this.allows("allowText","content"))scope().selectionPropertiesUi.selectTool("story");else{if(e.box.pathGeometry&&this.allows("allowShape","path"))return scope().selectionPropertiesUi.selectTool("path"),void scope().showPathEditor();if(e.box.imageRef&&!config.isMobile&&!config.isBuyer)return void scope().selectionPropertiesUi.selectTool("image")}}const n=[],a=[];for(const o of this.boxes.values()){const i=scope().getBox(o.box.id);if(!i)throw"Can't serialize box, boxRef is null";const s=i.spread;let l=(new Nobs).setProperty(o.box,"boxGeometry",o.boxGeometry);this.dropTargetBox&&l.setProperty(o.box.lock,"boundToBoxSelection",this.dropTargetBox.lock.buyerOrderNo),o.simpleText&&i.box.simpleText&&o.simpleText.text!==i.box.simpleText.text&&l.setProperty(o.box,"simpleText",o.simpleText);const c=this.mouseDownModel.hasCroppedImages&&this.mover&&("center"===this.mover.horizontal||"middle"===this.mover.vertical)||scope().boxSelection.crop||r===o;if(c&&(1===this.boxes.size||r)&&("doc"===this.crop?l.setProperty(o.box,"docRef",o.docRef):l.setProperty(o.box,"imageRef",o.imageRef),o.imagePanOffsetX=0,o.imagePanOffsetY=0),o.imageRef&&!c)if("crop"===o.imageRef.imagePlacement){const e=i.spread.height(),t=i.spread.width(),r=i.box.boxGeometry.width.toPixel(t,e),s=o.boxGeometry.width.toPixel(t,e),n=i.box.boxGeometry.height.toPixel(e,t),a=o.boxGeometry.height.toPixel(e,t),c=o.imageRef;let d=c.imageWidthScale,h=c.imageHeightScale;const p=n/a,u=r/s;Math.abs(s-r)>Math.abs(a-n)?h=h*p/u:d=d*u/p;const m={id:c.image.id,m:c.imageMasking,ip:c.imagePlacement,im:c.image.serialize().data,px:c.imageXPosition,py:c.imageYPosition,ws:d,hs:h,hc:c.horizontalFocalPoint,vc:c.verticalFocalPoint};l.setProperty(o.box,"imageRef",new ImageRef(c.image.id,m))}else{const e=o.imageRef,t=o.box.getImagePosition(e.image,e.imagePlacement,e.horizontalFocalPoint,e.verticalFocalPoint,o.boxGeometry),i={id:e.image.id,m:e.imageMasking,ip:e.imagePlacement,im:e.image.serialize().data,px:t.px,py:t.py,ws:t.ws,hs:t.hs,hc:e.horizontalFocalPoint,vc:e.verticalFocalPoint};l.setProperty(o.box,"imageRef",new ImageRef(e.image.id,i))}let d=new Box(l,o.box);const h=scope().currentDoc.getSpreadPasteboard(t.page.x/zoomFactor(),t.page.y/zoomFactor());let p=s.id;if(h&&s&&h!==s){let t=!0;if((this.boundingBoxGeo.isYAxisControlledByStyle("top",!1)||this.boundingBoxGeo.isYAxisControlledByStyle("bottom",!1))&&(t=!1,alert("Can't move item to another spread. Restricted by style.")),t){console_log("Change Spread for frame from "+s.id+" to "+h.id),p=h.id;const t=e.adjustPositionAfterSpreadChange(o.boxGeometry,s,h,d.boxGeometry);l=(new Nobs).setProperty(d,"boxGeometry",t),d=new Box(l,d)}}const u=d.serialize(p,i.doc.id),m=o.box.serialize(i.spread.id,i.doc.id);JSON.stringify(u)!==JSON.stringify(m)&&(n.push(u),a.push(m))}if(n.length>0)update(a,n),this.scaleSelectedStories(this.lastScaleFactor);else if(this.spread){const o=t.model.x-this.spread.left(),i=t.model.y-this.spread.top(),r=hitTest(new Rect(o,i,1,1),this.spread.toHitTestFrames(!0),!1);if(r.length)return void scope().uiFrameClick(r[0].id||"");const n=hitTest(new Rect(o,i,1,1),this.spread.toHitTestFrames(),!1),a=[],l=new Set;for(const e of n)if(!e.id&&e.groupId&&(null===(s=e.groupMemberBoxIds)||void 0===s?void 0:s.length))if(l.has(e.groupId));else{l.add(e.groupId);for(const t of e.groupMemberBoxIds)a.push({left:e.left,top:e.top,width:e.width,height:e.height,children:e.children,id:t,layer:e.layer,parent:e.parent,rotation:e.rotation,rotationPositionX:e.rotationPositionX,rotationPositionY:e.rotationPositionY,zindex:e.zindex,groupId:e.groupId})}else e.groupId?l.has(e.groupId)||(l.add(e.groupId),a.push(e)):a.push(e);console_log("Frames found at ("+o+"/"+i+"):"+a.length);const c=a.reverse(),d=c.map((e=>e.id)).join("|"),h=c.length-1;let p=null;for(let e=h;e>=1;e--){const t=c[e],o=c[e-1];if(t.id&&o.id){const e=this.boxes.has(t.id);if(!e&&d!==lastHitTestIds){p=scope().docUi.getWcBox(t.id);break}if(e&&d===lastHitTestIds&&!this.boxes.has(o.id)){p=scope().docUi.getWcBox(o.id);break}}}if(!p)for(let e=h;e>=0;e--){const t=c[e];if(t.id&&!this.boxes.has(t.id)){p=scope().docUi.getWcBox(t.id);break}}if(!p&&t.shiftKey)for(let t=h;t>=0;t--){const o=c[t];if(o.id&&this.boxes.has(o.id)){if(o.groupId){const t=Array.from(this.boxes.values()).filter((e=>e.box.boxGroupId!==o.groupId));scope().selection=new e(t,this.spread)}else{const t=Array.from(this.boxes.values()).filter((e=>e.box.id!==o.id));scope().selection=new e(t,this.spread)}break}}else if(p){let o;if(p.box.boxGroupId){const e=scope().docUi.getWcSpread(scope().docUi.currentSpread.id);if(!e)throw new Error("Current WC-Spread not found.");o=e.getWcBoxesByGroupId(p.box.boxGroupId)}else o=[p];if(!config.singleSelectionOnly&&t.shiftKey?scope().selection=new e([...this.boxes.values(),...o],this.spread):scope().selection=new e([...o],this.spread),!config.isMobile&&config.isBuyer&&1===o.length){const e=o[0];if((config.forceMultilineFormEditing||config.isMobile||!scope().currentDoc.showBuyerEddi)&&scope().closeCropEditor(),e.box.lock.hasOnlyTextContentAllow()&&e.box.storyRef&&!config.forceMultilineFormEditing&&scope().currentDoc.showBuyerEddi)return void scope().showEddi(e,t);if(config.enterImageCropingOnSelect&&e.box.lock.hasImagePlacement())return void scope().showCropEditor(e)}}lastHitTestIds=d}}static adjustHorizontalPercent(e,t,o){if(t.firstPageLeftOffsetPx()!==o.firstPageLeftOffsetPx()){const i=o.width()/t.width();return t.width()<o.width()?(100+e)/i:t.width()>o.width()?(e-50)/i:t.firstPageLeftOffsetPx()>o.firstPageLeftOffsetPx()?e+100:e-100}return e}static adjustPositionAfterSpreadChange(e,t,o,i){const r=i.toPixel(t.width(),t.height()),s=t.top()-o.top(),n=t.firstPageLeftOffsetPx()-o.firstPageLeftOffsetPx();return r.left+=n,r.top+=s,i.fromPixel(o.width(),o.height(),r.left,r.top,r.width,r.height,i.rotation,!0)}apply(e){if(this.lastScaleFactor=1,scope().boxSelection.mouseDown=!0,scope().boxSelection.geo=this.applyTransformedBox(this.boundingBoxGeo,{left:e.left,top:e.top,width:e.width,height:e.height},e.rotation),this.boxes.size>1){const t=group(this.toOrgFrames());if(t){this.scaleStory&&(this.lastScaleFactor=e.height/t.height);const o=ungroup(transformFrame(t,{left:e.left,top:e.top,width:e.width,height:e.height,children:[],parent:null,layer:"",rotation:e.rotation,id:"",zindex:0,rotationPositionX:.5,rotationPositionY:.5}));for(const e of o)if(e.id){const t=scope().docUi.getWcBox(e.id);if(t){const o=t.boxGeometry,i=BoxGeometry.getRotationPositionX(o),r=BoxGeometry.getRotationPositionY(o);let s={left:e.left,top:e.top,width:e.width,height:e.height};.5===i&&.5===r||(s=changeAnchor(s,e.rotation,.5,.5,i,r,!0)),t.boxGeometry=this.applyTransformedBox(t.box.boxGeometry,{left:s.left,top:s.top,width:s.width,height:s.height},e.rotation)}}}}else if(1===this.boxes.size){const t=this.boxes.keys().next().value,o=scope().docUi.getWcBox(t);if(o){const t=o.box.boxGeometry.includeStyle(o.box.basics.class,o.box.autoSizeMode);this.scaleStory&&this.spread&&(this.lastScaleFactor=e.height/t.toPixel(this.spread.width(),this.spread.height()).height),o.boxGeometry=this.applyTransformedBox(t,{left:e.left,top:e.top,width:e.width,height:e.height},e.rotation)}}}applyTransformedBox(e,t,o){if(this.spread){return e.fromPixel(this.spread.width(),this.spread.height(),t.left,t.top,t.width,t.height,o)}return e}has(e){return this.boxes.has(e)}hasAny(e){for(const t of e)if(this.boxes.has(t))return!0;return!1}count(){return this.boxes.size}canRemove(){if((config.isBuyer||config.isMobile)&&this.count()>0){let e=!0;for(const t of this.boxes.values())-1===t.box.lock.allowFrame.indexOf("delete")&&(e=!1);return e}return this.count()>0}hasTextFlow(){for(const e of this.boxes.values())if(e.box.storyRef){const t=e.box.storyRef.story;if(t&&t.myBoxes.size>1)return!0}return!1}toFrames(){const e=[];for(const[t,o]of this.boxes){if(!this.spread)throw"Spread not found for Box in Selection";e.push(o.boxGeometry.toFrame(this.spread.width(),this.spread.height(),t))}return e}collectStyleControlledProperties(){const e=new Map;for(const t of this.boxes.values())for(const[o,i]of t.boxGeometry.styleControlledProperties)e.set(o,i);return e}toOrgFrames(){const e=[];for(const[t,o]of this.boxes){if(!this.spread)throw"Spread not found for Box in Selection";e.push(o.box.boxGeometry.includeStyle(o.box.basics.class,o.box.autoSizeMode).toFrame(this.spread.width(),this.spread.height(),t,!0))}return e}toNewPixelBasedBoundingBox(e){if(this.spread){if(e){const t=e.boxGeometry.toFrame(this.spread.width(),this.spread.height());return new BoxGeometry(t.left,t.top,t.width,t.height,e.boxGeometry.rotation,!1,e.boxGeometry.anchorRotation)}{const e=this.boundingBoxGeo.toFrame(this.spread.width(),this.spread.height());return new BoxGeometry(e.left,e.top,e.width,e.height,this.boundingBoxGeo.rotation,!1,this.boundingBoxGeo.anchorRotation)}}throw"Spread not found for Box in Selection"}scaleSelectedStories(e){if(1===e)return;const t=[],o=[];for(const i of this.boxes.values())if(i.box.storyRef){const r=i.box.storyRef.story;if(r&&1===r.getBoxes().size){const i=JSON.parse(JSON.stringify(r.serializedText));scaleAllLengthValues(i,e);const s=(new Nobs).setProperty(r,"serializedText",i),n=new Story(s,r);t.push(r.serialize()),o.push(n.serialize())}}o.length&&update(t,o)}toIStoreObjects(){const e=[];for(const t of this.boxes.values()){const o=new Box((new Nobs).setProperty(t.box,"boxGeometry",t.boxGeometry),t.box),i=scope().getBox(t.box.id);if(!i)throw"Can't serialize box, boxRef is null";e.push(o.serialize(i.spread.id,i.doc.id))}return e}boundingBox(){if(this.innerFrame)return new BoxGeometry;if(0===this.boxes.size)throw"BoundingBox called with no selected Objects";if(1===this.boxes.size){const e=this.boxes.values().next().value;return new BoxGeometry(new Nobs,e.boxGeometry)}{const e=getBoundingBoxFromSelection(this.toFrames()),t=new BoxGeometry(e.left,e.top,e.width,e.height,0,!0),o=(new Nobs).setProperty(t,"styleControlledProperties",this.collectStyleControlledProperties());return new BoxGeometry(o,t)}}getAnchorTriState(e){let t=eTriState.null;for(const o of this.boxes.values()){t=o.boxGeometry["anchor"+e]?t===eTriState.null||t===eTriState.on?eTriState.on:eTriState.mixed:t===eTriState.null||t===eTriState.off?eTriState.off:eTriState.mixed}return t}assignShape(e,t={},o=!1){scope().isRecording&&scope().e2e.record({module:"selection",func:"assignShape",args:Array.from(arguments)});const i=[],r=[];for(const s of this.getSelectedBoxes()){const n=scope().getBox(s.id);if(n){const a=new Nobs,l=PathGeometry.getShapeGeneratorFunction(e),c=n.box.boxGeometry.toPixel(n.spread.width(),n.spread.height(),!0);let d=l?l(t,c.width,c.height):null;if(d&&d.path){if(s.pathGeometry?(a.setProperty(s.pathGeometry,"path",d.path),a.setProperty(s.pathGeometry,"closed",d.closed),a.setProperty(s.pathGeometry,"type",d.type),a.setProperty(s.pathGeometry,"gridColumns",d.gridColumns),a.setProperty(s.pathGeometry,"gridRows",d.gridRows),a.setProperty(s.pathGeometry,"shape",e),a.setProperty(s.pathGeometry,"shapeParams",d.shapeParams)):(d=new PathGeometry((new Nobs).setProperty(d,"shape",e),d),d=new PathGeometry((new Nobs).setProperty(d,"shapeParams",d.shapeParams),d),a.setProperty(s,"pathGeometry",d)),o){const e=scope().docUi.getWcBox(s.id);e&&(e.pathGeometry=new PathGeometry(a,s.pathGeometry||d));continue}s.imageRef&&a.setProperty(s.imageRef,"imageMasking","pathGeometry")}else a.setProperty(s,"pathGeometry",null);i.push(s.serialize(n.spread.id,n.doc.id)),r.push(new Box(a,s).serialize(n.spread.id,n.doc.id))}}i.length>0&&update(i,r)}assignEffectMaskImage(e){return __awaiter$B(this,arguments,void 0,(function*(){scope().isRecording&&scope().e2e.record({module:"selection",func:"assignEffectMaskImage",args:Array.from(arguments)});const t=[],o=[];for(const i of this.boxes.values()){const r=scope().getBox(i.box.id);if(!r)throw"Can't serialize box, boxRef is null";const s=(new Nobs).setProperty(r.box.effect,"maskImageId",e.id),n=new Box(s,r.box).serialize(r.spread.id,r.doc.id),a=r.box.serialize(r.spread.id,r.doc.id);t.push(n),o.push(a)}t.length>0&&(yield update(o,t))}))}assignImage(e){scope().isRecording&&scope().e2e.record({module:"selection",func:"assignImage",args:Array.from(arguments)});const t=[],o=[];for(const i of this.boxes.values()){const r=scope().getBox(i.box.id);if(!r)throw"Can't serialize box, boxRef is null";const s=r.box.imageRef;let n=s?s.imagePlacement:"fill";"crop"===n&&(n="fill");const a=s?s.verticalFocalPoint:.5,l=s?s.horizontalFocalPoint:.5,c=r.box.getImagePosition(e,n,l,a);let d="none";r.box.pathGeometry&&(d="pathGeometry");const h={id:e.id,m:s?s.imageMasking:d,ip:n,im:e.serialize().data,px:c.px,py:c.py,ws:c.ws,hs:c.hs,hc:l,vc:a},p=(new Nobs).setProperty(r.box,"imageRef",new ImageRef(e.id,h)),u=new Box(p,r.box).serialize(r.spread.id,r.doc.id),m=r.box.serialize(r.spread.id,r.doc.id);t.push(u),o.push(m)}t.length>0&&update(o,t).then((()=>{config.isMobile&&this.allowsImagePlacement()&&window.setTimeout((()=>{scope().showCropEditor(),scope().selectionPropertiesUi.mobileUiState={state:"imageCrop"}}),200)}))}assignDoc(e){scope().isRecording&&scope().e2e.record({module:"selection",func:"assignDoc",args:Array.from(arguments)});const t=[],o=[];for(const i of this.boxes.values()){const r=scope().getBox(i.box.id);if(!r)throw"Can't serialize box, boxRef is null";const s=r.box.docRef;let n=s?s.documentPlacement:"fill";"crop"===n&&(n="fit");const a=s?s.verticalFocalPointDocument:.5,l=s?s.horizontalFocalPointDocument:.5,c=r.box.getDocRefPosition(e,n,l,a),d={na:e,pl:n,px:c.px,py:c.py,ws:c.ws,hs:c.hs,fx:l,fy:a,ffv:DocRef.serializeFFVs(s?null==s?void 0:s.formFieldValues:new Map),si:"",hnp:!!s&&s.showAsNonPrintableLayers,sff:!!s&&s.hasFormField},h=(new Nobs).setProperty(r.box,"docRef",new DocRef(d)),p=new Box(h,r.box).serialize(r.spread.id,r.doc.id),u=r.box.serialize(r.spread.id,r.doc.id);t.push(p),o.push(u)}t.length>0&&update(o,t)}setAnchorValue(e,t){scope().isRecording&&scope().e2e.record({module:"selection",func:"setAnchorValue",args:Array.from(arguments)});const o=[],i=[];for(const[r,s]of this.boxes){const n="anchor"+e;if(!s.boxGeometry.styleControlledProperties.has(n)){const s=scope().getBox(r);if(!s)throw"Update Anchor, BoxRef not found";{let r=s.box;const a=new Nobs,l=s.box.boxGeometry.moverAnchor,c=l.substr(0,1),d=l.substr(1,1);let h=l.substr(0,1),p=l.substr(1,1),u=l.substr(0,1),m=l.substr(1,1);const f=t&&("Right"===e&&r.boxGeometry.anchorLeft||"Left"===e&&r.boxGeometry.anchorRight),g=t&&("Top"===e&&r.boxGeometry.anchorBottom||"Bottom"===e&&r.boxGeometry.anchorTop),y=!(t||"Right"!==e&&"Left"!==e||r.boxGeometry.hasWidth()),b=!(t||"Top"!==e&&"Bottom"!==e||r.boxGeometry.hasHeight()),v=!t&&"Right"===e&&r.boxGeometry.anchorRight,x=!t&&"Left"===e&&r.boxGeometry.anchorLeft,w=!t&&"Bottom"===e&&r.boxGeometry.anchorBottom,_=!t&&"Top"===e&&r.boxGeometry.anchorTop;if(x&&("l"!==c&&(h="l"),u="r"),v&&!y&&("r"!==c&&(h="r"),u="l"),_&&("t"!==d&&(p="t"),m="b"),w&&!b&&("b"!==d&&(p="b"),m="t"),f&&(r.boxGeometry.anchorRight&&"r"!==c&&(h="r"),r.boxGeometry.anchorLeft&&"l"!==c&&(h="l"),u="l"),g&&(r.boxGeometry.anchorBottom&&"b"!==d&&(p="b"),r.boxGeometry.anchorTop&&"t"!==d&&(p="t"),m="t"),l!==h+p){const e=BoxGeometry.getRotationPositionX(r.boxGeometry.moverAnchor),t=BoxGeometry.getRotationPositionY(r.boxGeometry.moverAnchor),o=BoxGeometry.getRotationPositionX(h+p),i=BoxGeometry.getRotationPositionY(h+p),n=0,a=changeAnchor(r.boxGeometry.toPixel(s.spread.width(),s.spread.height()),n,e,t,o,i),l=r.boxGeometry.fromPixel(s.spread.width(),s.spread.height(),a.left,a.top,a.width,a.height,n,!1),c=new Nobs;c.setProperty(r,"boxGeometry",l),r=new Box(c,r)}a.setProperty(r.boxGeometry,"moverAnchor",u+m),a.setProperty(r.boxGeometry,"rotation",0),(g||f)&&r.imageRef&&a.setProperty(r.imageRef,"imagePlacement","fill"),a.setProperty(r.boxGeometry,n,t),!1===t&&("Top"===e&&!1===r.boxGeometry.anchorBottom&&a.setProperty(r.boxGeometry,"anchorBottom",!0),"Bottom"===e&&!1===r.boxGeometry.anchorTop&&a.setProperty(r.boxGeometry,"anchorTop",!0),"Left"===e&&!1===r.boxGeometry.anchorRight&&a.setProperty(r.boxGeometry,"anchorRight",!0),"Right"===e&&!1===r.boxGeometry.anchorLeft&&a.setProperty(r.boxGeometry,"anchorLeft",!0));let S=new Box(a,r);S.boxGeometry.anchorRotation&&!S.boxGeometry.hasAnchorRotation()&&(S=new Box((new Nobs).setProperty(S.boxGeometry,"anchorRotation",0),S)),o.push(s.box.serialize(s.spread.id,s.doc.id)),i.push(S.serialize(s.spread.id,s.doc.id))}}}i.length&&update(o,i)}getMoverAnchorTriState(e){let t=eTriState.null;for(const o of this.boxes.values()){t=o.boxGeometry.moverAnchor===e?t===eTriState.null||t===eTriState.on?eTriState.on:eTriState.mixed:t===eTriState.null||t===eTriState.off?eTriState.off:eTriState.mixed}return t}getMoverAnchorDisabled(e){const t=e.substr(0,1),o=e.substr(1,1);for(const i of this.boxes.values()){if(i.boxGeometry.hasAnchorRotation()&&"lt"!==e)return"disabled";if(("c"===t||"r"===t)&&!i.boxGeometry.hasWidth())return"disabled";if(("m"===o||"b"===o)&&!i.boxGeometry.hasHeight())return"disabled"}return""}setMoverAnchorValue(e){return __awaiter$B(this,arguments,void 0,(function*(){scope().isRecording&&scope().e2e.record({module:"selection",func:"setMoverAnchorValue",args:Array.from(arguments)});const t=[],o=[];for(const[i,r]of this.boxes){const s=scope().getBox(i);if(!s)throw"Update Mover-Anchor, BoxRef not found";{let i=r.boxGeometry,n=e.substr(0,1),a=e.substr(1,1);const l=s.box.boxGeometry,c=l.toPixel(s.spread.width(),s.spread.height()),d=BoxGeometry.getRotationPositionX(l),h=BoxGeometry.getRotationPositionY(l);let p=BoxGeometry.getRotationPositionX(e),u=BoxGeometry.getRotationPositionY(e);l.hasWidth()||(p=0,n="l"),l.hasHeight()||(u=0,a="t");const m=changeAnchor(c,l.rotation,d,h,p,u);i=i.fromPixel(s.spread.width(),s.spread.height(),m.left,m.top,c.width,c.height,s.box.boxGeometry.rotation,!1);const f=(new Nobs).setProperty(i,"moverAnchor",n+a);i=new BoxGeometry(f,i);const g=(new Nobs).replaceObject(s.box.boxGeometry,i),y=new Box(g,s.box);t.push(s.box.serialize(s.spread.id,s.doc.id)),o.push(y.serialize(s.spread.id,s.doc.id))}}o.length&&(yield update(t,o))}))}getStyleSelector(e){var t;let o,i;if(1===this.boxes.size){i=this.boxes.values().next().value.boxGeometry,i&&(o=null===(t=i.styleControlledProperties.get(e))||void 0===t?void 0:t.selector)}return o}addOffsetToBoxPosition(e,t){return __awaiter$B(this,void 0,void 0,(function*(){const o=scope().docUi.currentSpread,i=o.width(),r=o.height(),s=[],n=[];for(const a of this.boxes.values()){const l=a.box.boxGeometry.toPixel(i,r),c=t*Math.min(i,r)/500,d=l.top+("top"===e?c:0),h=l.left+("left"===e?c:0),p=a.box.boxGeometry.fromPixel(i,r,h,d,l.width,l.height,a.box.boxGeometry.rotation),u=new Box((new Nobs).replaceObject(a.box.boxGeometry,p),a.box);s.push(a.box.serialize(o.id,scope().currentDoc.id)),n.push(u.serialize(o.id,scope().currentDoc.id))}n.length&&(yield update(s,n))}))}getPosition(e){let t=0,o="px",i="";let r,s="",n="unset",a=null;if(1===this.boxes.size){const t=this.boxes.values().next().value;if(r=t.boxGeometry,r){r.rotation&&(a=scope().getBox(t.box.id));const o=r.styleControlledProperties.get(e);o&&(s=o.selector,n=o.origin)}}else if(this.boxes.size>1){r=this.boundingBoxGeo;for(const t of this.boxes.values()){const o=t.boxGeometry.styleControlledProperties.get(e);o&&(s=o.selector,n=o.origin)}}if(r){const l=this.getPropertyRotated(a,r,r[e],e,!1,!1);o=l.unit,t=l.value,i=l.equation,s&&"unset"!==origin||("top"!==e||r.anchorTop||(n="inactive"),"bottom"!==e||r.anchorBottom||(n="inactive"),"left"!==e||r.anchorLeft||(n="inactive"),"right"!==e||r.anchorRight||(n="inactive"),"width"===e&&r.anchorLeft&&r.anchorRight&&(n="inactive"),"height"===e&&r.anchorTop&&r.anchorBottom&&(n="inactive"))}return{value:new Length(Math.floor(1e4*t)/1e4,o,!1,i),selector:s,origin:n}}getRotation(){let e;return 1===this.boxes.size&&(e=this.boxes.values().next().value.boxGeometry),this.boxes.size>1&&(e=this.boundingBoxGeo),e?e.rotation:0}getPropertyRotated(e,t,o,i,r,s){if(e&&t.rotation&&"equation"!==o.unit&&("left"===i||"top"===i||"bottom"===i||"right"===i)){const n=e.spread.height(),a=e.spread.width(),l=t.toPixel(a,n);let c,d;"left"==i||"right"===i?(c=o.toPixel(a,n),d=t.top.toPixel(n,a)):(c=t.left.toPixel(a,n),d=o.toPixel(n,a));const h=rotatePointInBox(c,d,l,r?-t.rotation:t.rotation,BoxGeometry.getRotationPositionX(t),BoxGeometry.getRotationPositionY(t));return s?new Length("left"===i||"right"===i?h.x:h.y,"px"):"left"===i||"right"===i?o.fromPixel(h.x,a,n):o.fromPixel(h.y,n,a)}if(s){if(e)return new Length(o.toPixel_boxGeoProperty(i,e.spread.width(),e.spread.height()),"px");throw new Error("getPropertyRotated called with asPixel but no BoxRef.")}return o}setPropertyRotated(e,t,o,i){if(!e||"equation"===o.unit||"left"!==i&&"top"!==i&&"bottom"!==i&&"right"!==i)return o;{const r=e.spread.height(),s=e.spread.width(),n=t.toPixel(s,r);let a=0,l=0,c=0;if("left"===i||"right"===i){if(!t.hasWidth())return o;a=BoxGeometry.getRotationPositionX(t),l=n.width,t.anchorRight?(c=s-l-n.left,a=1-a):(c=n.left,"right"===i&&(c+=l))}else{if(!t.hasHeight())return o;a=BoxGeometry.getRotationPositionY(t),l=n.height,t.anchorBottom?(c=r-l-n.top,a=1-a):(c=n.top,"bottom"===i&&(c+=l))}const d=this.getPropertyRotated(e,t,t[i],i,!1,!0).value,h=o.toPixel_boxGeoProperty(i,s,r)-d;return o.fromPixel_boxGeoProperty(c+h+l*a,i,s,r)}}setPosition(e,t,o=!0){scope().isRecording&&scope().e2e.record({module:"selection",func:"setPosition",args:Array.from(arguments)}),o&&showTip("enterPercentUnits");const i=[],r=[];let s=new Length(t+""),n=!0;if(s.value.toString()===t&&(n=!1),1===this.boxes.size){const o=scope().getBox(this.boxes.values().next().value.box.id);if(!o)throw"Update Position, BoxRef not found";{const a=o.spread.width(),l=o.spread.height(),c=new Nobs;if(!1===n&&"rotation"!==e&&"equation"!==o.box.boxGeometry[e].unit&&(s=new Length(parseFloat(t),o.box.boxGeometry[e].unit)),"rotation"===e)c.setProperty(o.box.boxGeometry,"rotation",s.value);else if("width"===e||"height"===e)c.setProperty(o.box.boxGeometry,e,s);else{const t=("left"===e||"right"===e)&&!o.box.boxGeometry.hasWidth(),i=("top"===e||"bottom"===e)&&!o.box.boxGeometry.hasHeight();if(t||i){const t=o.box.boxGeometry.toPixel(a,l,!1);let i=s.toPixel_boxGeoProperty(e,a,l);"right"===e?(i+t.left>a&&(i=a-t.left-1),t.width=a-(t.left+i)):"left"===e?(i>t.width+t.left&&(i=t.width+t.left-1),t.width=t.width+t.left-i,t.left=i):"bottom"===e?(i+t.top>l&&(i=l-t.top-1),t.height=l-(t.top+i)):"top"===e?(i>t.height+t.top&&(i=t.height+t.top-1),t.height=t.height+t.top-i,t.top=i):assertNever$1(e);const r=o.box.boxGeometry.fromPixel(a,l,t.left,t.top,t.width,t.height,0,void 0,e,s.unit);c.setProperty(o.box,"boxGeometry",r)}else s=this.setPropertyRotated(o,o.box.boxGeometry,s,e),c.setProperty(o.box.boxGeometry,e,s)}const d=new Box(c,o.box);i.push(o.box.serialize(o.spread.id,o.doc.id)),r.push(d.serialize(o.spread.id,o.doc.id))}}else if(this.boxes.size>1&&this.spread){const o=this.toNewPixelBasedBoundingBox(),i=new Length(t+""),r={left:"left"===e?i.toPixel_1Axis(this.spread.width()):o.left.value,top:"top"===e?i.toPixel_1Axis(this.spread.height()):o.top.value,width:"width"===e?i.toPixel_1Axis(this.spread.width()):o.width.value,height:"height"===e?i.toPixel_1Axis(this.spread.height()):o.height.value,rotation:"rotation"===e?i.value:o.rotation,ax:"left",ay:"top",rotXFactor:.5,rotYFactor:.5};this.apply(r)}r.length&&update(i,r)}setLengthValue(e,t,o){return __awaiter$B(this,arguments,void 0,(function*(){scope().isRecording&&scope().e2e.record({module:"selection",func:"setLengthValue",args:Array.from(arguments)});const i=[],r=[],s=new Length(o);for(const o of this.getSelectedBoxes()){const n=scope().getBox(o.id);if(!n||!o[e])throw"Update Length Value, BoxRef not found";{const a=o[e];if(!a)throw"setLengthValue: "+e+" does nor exists on box="+o.id;const l=(new Nobs).setProperty(a,t,s),c=new Box(l,n.box);i.push(n.box.serialize(n.spread.id,n.doc.id)),r.push(c.serialize(n.spread.id,n.doc.id))}}r.length&&(yield update(i,r))}))}convertAllLengthValues(e,t=["top","left","bottom","right","width","height"]){scope().isRecording&&scope().e2e.record({module:"selection",func:"convertAllLengthValues",args:Array.from(arguments)});const o=[],i=[];for(const r of this.boxes.values()){const s=scope().getBox(r.box.id);if(!s)throw"Convert Position, BoxRef not found";{const r=new Nobs,n=s.box.boxGeometry.includeStyle(s.box.basics.class,s.box.autoSizeMode);for(const o of t){const i=s.box.boxGeometry[o];if(!n.styleControlledProperties.get(o)&&i.unit!==e&&("equation"!==i.unit||1===t.length)){const t="left"===o||"right"===o||"width"===o?s.spread.width():s.spread.height(),n="left"===o||"right"===o||"width"===o?s.spread.height():s.spread.width(),a=i.toPixel(t,n);let l="%%H"===e||"%%W"===e?"%%":e;"%%H"!==e||"height"!==o&&"bottom"!==o&&"top"!==o||(l="%"),"%%W"!==e||"width"!==o&&"right"!==o&&"left"!==o||(l="%");const c=new Length(0,l).fromPixel(a,t,n);r.setProperty(s.box.boxGeometry,o,c)}}const a=new Box(r,s.box);o.push(s.box.serialize(s.spread.id,s.doc.id)),i.push(a.serialize(s.spread.id,s.doc.id))}}i.length&&(update(o,i),this.boxes.size>1&&setTimeout((()=>scope().clearSelection()),100))}getValueExtended(e,t){let o=null;const i=new Set;for(const r of this.getSelectedBoxes()){if(r.getFeature(e)){const s=r.getValueExtended(e,t);if(s&&null!==s.value){if(o&&null!==o.value&&!compareValues(t,o.value,s.value))return s.selector&&i.add(s.selector),{value:null,origin:"mixed",selector:i.size?Array.from(i).join(","):null};s.selector&&i.add(s.selector),o=s}}}return o&&o.value||!isColorProperty(t)?o||{value:null,selector:"",origin:"unset"}:{value:new ColorRef("[None]"),selector:"",origin:"unset"}}setValue(e,t,o,i=!1,r){const s=this.setMultipleValues([{feature:e,property:t,value:o}],i,r);return"meshActive"===t&&scope().meshEditorActive()&&!o&&scope().closeMeshEditor(),"meshActive"===t&&!scope().meshEditorActive()&&o&&scope().showMeshEditor(),"perspectiveActive"===t&&scope().perspectiveEditorActive()&&!o&&scope().closePerspectiveEditor(),"perspectiveActive"===t&&!scope().perspectiveEditorActive()&&o&&scope().showPerspectiveEditor(),s}setMultipleValues(e,t=!1,o){return __awaiter$B(this,void 0,void 0,(function*(){if(scope().isRecording&&!1===t&&!o)for(const t of e)scope().e2e.record({module:"selection",func:"setValue",args:[t.feature,t.property,t.value]});let i;if(o){t=!1;const e=scope().getBox(o);if(!e)throw"Can't set property via box-id. Box not found: ("+o+")";i=[e.box]}else i=this.getSelectedBoxes();const r=[],s=[];if(t)for(const t of this.getSelectedWcBoxes())for(const{feature:o,property:i,value:r}of e)if("pathGeometry"===o||"transform"===o||"effect"===o||"simpleText"===o||"pathText"===o||"boxGeometry"===o){if(t[o]){const e=t[o];if(!e)throw"setValue of ["+i+"]: Feature ["+o+"] does not exists on box="+t.box.id;if(!Object.prototype.hasOwnProperty.call(e,i))throw"setValue of ["+o+"."+i+"]: Feature does not have property. box="+t.box.id;if(!checkValue(i,r))throw"value ["+r+"] is not valid for ["+o+"."+i+"]";const s=(new Nobs).setProperty(e,i,r);"transform"===o?t.transform=new Transform(s,e):"effect"===o?t.effect=new Effect(s,e):"pathText"===o?t.pathText=new PathText(s,e):"simpleText"===o?t.simpleText=new SimpleText(s,e):"boxGeometry"===o?(t.boxGeometry=new BoxGeometry(s,e),t.requestUpdate()):"pathGeometry"===o&&(t.pathGeometry=new PathGeometry(s,e))}}else alert("Can't set "+o+"."+i+" on WcBox.");else{for(const t of i){const o=scope().getBox(t.id);if(!o)throw"Update Multiple Values - BoxRef not found";{const i=new Nobs;for(const{feature:o,property:n,value:a}of e){if(t[o]){const e=t[o];if(!e)throw"setValue of ["+n+"]: Feature ["+o+"] does not exists on box="+t.id;if(!Object.prototype.hasOwnProperty.call(e,n))throw"setValue of ["+o+"."+n+"]: Feature does not have property. box="+t.id;if(!checkValue(n,a))throw"value ["+a+"] is not valid for ["+o+"."+n+"]";i.setProperty(e,n,a)}yield Listeners.addNobs(o,n,i,t,r,s)}const n=new Box(i,o.box);r.push(o.box.serialize(o.spread.id,o.doc.id)),s.push(n.serialize(o.spread.id,o.doc.id))}}s.length&&(yield update(r,s))}}))}groupBoxes(e){if(!(this.boxes.size<=1)&&this.spread)if(scope().isRecording&&scope().e2e.record({module:"selection",func:"groupBoxes",args:[e]}),"group"===e){const e=this.boxes.values().next().value.box,t=generateDBID();let o=0,i=null,r=1,s=null;const n=this.spread.boxesByLayer(e.layerId,"bottom-up");for(let t=0;t<n.length;t++)n[t]===e&&(t>0&&(o=n[t-1].order,i=n[t-1]),t<n.length-1&&(r=n[t+1].order,s=n[t+1]));this.setNewOrder(o,i,r,s,e.layerId,t)}else{const e=[],t=[];for(const o of this.boxes.values()){const i=scope().getBox(o.box.id);if(!i)throw"groupBoxes - BoxRef not found";{const o=new Nobs;o.setProperty(i.box,"boxGroupId","");const r=new Box(o,i.box);e.push(i.box.serialize(i.spread.id,i.doc.id)),t.push(r.serialize(i.spread.id,i.doc.id))}}t.length&&update(e,t)}}setMask(e){if(1===this.boxes.size){const t=this.boxes.values().next().value;if(t&&"simpleText"===e&&!t.box.simpleText)return scope().isRecording&&scope().e2e.record({module:"selection",func:"setMask",args:Array.from(arguments)}),void this.setValue("imageRef","imageMasking",e).then((()=>{const e=scope().currentDoc.getBoxRef(t.box.id);if(e){const t=new Nobs;t.setProperty(e.box,"simpleText",new SimpleText);const o=new Box(t,e.box);update([e.box.serialize(e.spread.id,e.doc.id)],[o.serialize(e.spread.id,e.doc.id)])}}));if(t&&"pathGeometry"===e&&!t.box.pathGeometry)return scope().isRecording&&scope().e2e.record({module:"selection",func:"setMask",args:Array.from(arguments)}),void this.setValue("imageRef","imageMasking",e).then((()=>{const e=scope().currentDoc.getBoxRef(t.box.id);if(e){const t=new Nobs;t.setProperty(e.box,"pathGeometry",PathGeometry.createFlowerPath());const o=new Box(t,e.box);update([e.box.serialize(e.spread.id,e.doc.id)],[o.serialize(e.spread.id,e.doc.id)])}}))}this.setValue("imageRef","imageMasking",e)}getFirstParagraphTextStyleProperty(e){let t=new TextStyle;if(this.hasFeature("storyRef")&&1===this.boxes.size){const o=this.getStory(),i=scope().getBox(this.boxes.values().next().value.box.id);if(i){if(o&&o.serializedText.a.length>0){t=o.getFirstParagraphTextStyle();const i=t.properties[e];if(i)return i}const r=i.spread.height(),s=i.spread.width(),n=scope().getStyleProperty(i.box.basics.class,e,i.box.boxGeometry.width.toPixel(s,r),i.box.boxGeometry.height.toPixel(r,s));if(n)return n.value}}return baseTextStyleProps()[e]}setFirstParagraphTextStyle(e){scope().isRecording&&scope().e2e.record({module:"selection",func:"setFirstParagraphTextStyle",args:Array.from(arguments)});const t=this.getStory();if(t){const o=new Eddi(scope().eddiConfig,"",null,[null],[null],"preview");o.deserialize(t.serializedText),o.selectAll(),o.styleSelectedContent(e);const i=(new Nobs).setProperty(t,"serializedText",o.serialize()),r=new Story(i,t);update([t.serialize()],[r.serialize()])}}getStory(){var e;if(this.hasFeature("storyRef")&&1===this.boxes.size){const t=this.boxes.values().next().value;if(null===(e=t.box)||void 0===e?void 0:e.storyRef)return t.box.storyRef.story}return null}setColorValue(e,t,o){scope().isRecording&&scope().e2e.record({module:"selection",func:"setColorValue",args:Array.from(arguments)});const i=[],r=[];for(const s of this.getSelectedBoxes()){const n=scope().getBox(s.id);if(!n||!s[e])throw"Update Color-Value, BoxRef not found";{const a=s[e];if(!a)throw"setColorValue: "+e+" does nor exists on box="+s.id;const l=a[t],c=(new Nobs).setProperty(a,t,new ColorRef(o,l.tint,l.opacity,l.modifier)),d=new Box(c,n.box);i.push(n.box.serialize(n.spread.id,n.doc.id)),r.push(d.serialize(n.spread.id,n.doc.id))}}r.length&&update(i,r)}setPrimaryColorValue(e){scope().isRecording&&scope().e2e.record({module:"selection",func:"setColorValue",args:Array.from(arguments)});const t=[],o=[];for(const i of this.getSelectedBoxes()){const r=scope().getBox(i.id);if(r){const i=r.box;let s,n=null;if(i.simpleText?(s=i.simpleText,n="fontColor"):i.pathText?(s=i.pathText,n="pathTextFontColor"):i.pathGeometry&&(s=i.pathGeometry,n="fillColor"),s&&n){const i=s[n],a=(new Nobs).setProperty(s,n,new ColorRef(e,i.tint,i.opacity,i.modifier)),l=new Box(a,r.box);t.push(r.box.serialize(r.spread.id,r.doc.id)),o.push(l.serialize(r.spread.id,r.doc.id))}}}o.length&&update(t,o)}setColorRefProperty(e,t,o,i,r){scope().isRecording&&scope().e2e.record({module:"selection",func:"setColorRefProperty",args:Array.from(arguments)});const s=[],n=[];for(const a of this.getSelectedBoxes()){const l=scope().getBox(a.id);if(!l||!a[e])throw"Update Color-Ref Property ("+o+"), BoxRef not found";{const c=a[e];if(!c)throw"setColorRefProperty: "+e+" does nor exists on box="+a.id;const d=new Nobs;if("modifier"===o){if(r){const e=c[t].modifier,s=Object.assign({},e);s[r]=i,d.setProperty(c[t],o,s)}}else d.setProperty(c[t],o,i);const h=new Box(d,l.box);s.push(l.box.serialize(l.spread.id,l.doc.id)),n.push(h.serialize(l.spread.id,l.doc.id)),n.length&&update(s,n)}}}setAllowValue(e,t,o){scope().isRecording&&scope().e2e.record({module:"selection",func:"setAllowValue",args:Array.from(arguments)});const i=this.getSelectedBoxes();if(0===i.length){const i=scope().currentDoc;let r=i.lock[e];r=r.filter((e=>e!==t)),o&&r.push(t);const s=(new Nobs).setProperty(i.lock,e,r),n=new Doc(s,i);update([i.serialize(scope().id)],[n.serialize(scope().id)])}else{const r=[],s=[];for(const n of i){const i=scope().getBox(n.id);if(!i)throw"Update Allow-Value, BoxRef not found";{let n=i.box.lock[e];n=n.filter((e=>e!==t)),o&&n.push(t);const a=(new Nobs).setProperty(i.box.lock,e,n),l=new Box(a,i.box);r.push(i.box.serialize(i.spread.id,i.doc.id)),s.push(l.serialize(i.spread.id,i.doc.id))}}s.length&&update(r,s)}}getAllowValue(e,t){let o=null,i="",r=null;const s=this.getSelectedBoxes();if(0===s.length){return{selector:null,origin:null,value:scope().currentDoc.lock[e].indexOf(t)>=0}}for(const n of s){const s=scope().getBox(n.id);if(!s)throw"Update Allow-Value, BoxRef not found";{const n=s.box.getValueExtended("lock",e);if(n.selector&&(i+=n.selector,r="class"),n.value){o=n.value.indexOf(t)>=0?!1!==o||null:!0===o&&null}}}return{value:o,selector:i,origin:r}}setNumericValue(e,t,o){scope().isRecording&&scope().e2e.record({module:"selection",func:"setNumericValue",args:Array.from(arguments)});const i=[],r=[];for(const s of this.getSelectedBoxes()){const n=scope().getBox(s.id);if(!n||!s[e])throw"Update Numeric Value ("+t+") -, BoxRef not found";{const a=s[e];if(!a)throw"setNumericValue: "+e+" does nor exists on box="+s.id;const l=new Nobs;l.setProperty(a,t,o);const c=new Box(l,n.box);i.push(n.box.serialize(n.spread.id,n.doc.id)),r.push(c.serialize(n.spread.id,n.doc.id))}}r.length&&update(i,r)}hasSelection(){return!!(this.boxes.size>0||this.getSingleSelection())}isSelected(e){if(this.boxes.has(e))return!0;{const t=this.getSingleSelection();return!(!t||t.box.id!==e)}}getSingleSelection(){if(scope().pathEditorActive())return scope().pathEditor.boxRef||null;if(scope().perspectiveEditorActive())return scope().perspectiveEditor.boxRef||null;if(scope().meshEditorActive())return scope().meshEditor.boxRef||null;if(scope().eddiActive()){const e=scope().eddiActiveStory;if(e){const t=e.getBoxes();if(t&&t.size>0){const e=t.keys().next().value;return scope().getBox(e)||null}}}else if(1===this.boxes.size)return scope().getBox(this.boxes.values().next().value.box.id);return null}getSelectedBoxes(){const e=[];if(scope().pathEditorActive()){const t=scope().pathEditor.boxRef;t&&e.push(t.box)}else if(scope().perspectiveEditorActive()){const t=scope().perspectiveEditor.boxRef;t&&e.push(t.box)}else if(scope().meshEditorActive()){const t=scope().meshEditor.boxRef;t&&e.push(t.box)}else if(scope().eddiActive()){const t=scope().eddiActiveStory;if(t)for(const o of t.getWcBoxes())e.push(o.box)}else for(const t of this.boxes.values())e.push(t.box);return e}getSelectedWcBoxes(){const e=[];if(scope().pathEditorActive()){const t=scope().pathEditor.boxRef;if(t){const o=scope().docUi.getWcBox(t.box.id);o&&e.push(o)}}else if(scope().perspectiveEditorActive()){const t=scope().perspectiveEditor.boxRef;if(t){const o=scope().docUi.getWcBox(t.box.id);o&&e.push(o)}}else if(scope().meshEditorActive()){const t=scope().meshEditor.boxRef;if(t){const o=scope().docUi.getWcBox(t.box.id);o&&e.push(o)}}else if(scope().eddiActive()){const t=scope().eddiActiveStory;if(t)for(const o of t.getWcBoxes())e.push(o)}else for(const t of this.boxes.values())e.push(t);return e}get boxJsName(){let e=null;for(const t of this.boxes.values())if(null===e)e=t.box.jsName;else if(e!==t.box.jsName)return null;return e}setBoxJsName(e){if(e&&!e.match(jsNameRegex))return void alert("Name must be a valid javascript identifier. No spaces and special charracters are allowed. Must start with a letter.");scope().isRecording&&scope().e2e.record({module:"selection",func:"setBoxJsName",args:Array.from(arguments)});const t=[],o=[];for(const i of this.boxes.values()){const r=scope().getBox(i.box.id);if(r&&e!==i.box.jsName){const i=(new Nobs).setProperty(r.box,"jsName",e),s=new Box(i,r.box);t.push(r.box.serialize(r.spread.id,r.doc.id)),o.push(s.serialize(r.spread.id,r.doc.id))}}t.length&&update(t,o)}allowsAny(e){let t=!0;if(!config.isMobile&&!config.isBuyer)return!0;if("allowAdd"===e){return scope().currentDoc.lock[e].length>0&&!this.hasSelection()}let o=Lock.getfeatureByAllow(e);if(t=this.hasFeature(o),t||"simpleText"!==o||(o="storyRef",t=this.hasFeature(o)),t)if(this.boxes.size>0)for(const o of this.boxes.values())t=t&&o.box.lock[e].length>0;else{const o=this.getSingleSelection();t=!!o&&o.box.lock[e].length>0}return t}allowsImageUpload(){const e=this.getSingleSelection();return!!e&&e.box.lock.hasImageUpload()}allowsImagePlacement(){const e=this.getSingleSelection();return!!e&&e.box.lock.hasImagePlacement()}allows(e,t){let o=!0;if(!config.isMobile&&!config.isBuyer)return!0;if("allowAdd"===e){return scope().currentDoc.lock.allows(e,t)&&!this.hasSelection()}let i=Lock.getfeatureByAllow(e);if(o=this.hasFeature(i),o||"simpleText"!==i||(i="storyRef",o=this.hasFeature(i)),o)if(this.boxes.size>0)for(const i of this.boxes.values())o=o&&i.box.lock.allows(e,t);else{const i=this.getSingleSelection();o=!!i&&i.box.lock.allows(e,t)}return!0===o&&"allowImage"===e&&"content"===t&&(0!==scope().selection.getImageList().length||this.hasImageUploadButton()||(o=!1)),o}hasAddFrameButton(){const e=["image","text","warpText","pathText","shape"];for(const t of e)if(this.allows("allowAdd",t))return!0;return!1}hasImageUploadButton(){if(config.isBuyer||config.isMobile){if(scope().currentDoc.lock.allows("allowAdd","images")){const e=this.getValueExtended("lock","allowImageGroups").value;if(e)return-1!==e.indexOf("Buyer Upload")}return!1}return!0}hasFeature(e){var t,o,i,r;if("pathGeometry"===e&&scope().pathEditorActive())return!!scope().pathEditor.path;if(scope().perspectiveEditorActive())return"transform"===e?!!scope().perspectiveEditor.path:null!==(o=null!==(null===(t=scope().perspectiveEditor.boxRef)||void 0===t?void 0:t.box[e]))&&void 0!==o&&o;if(scope().meshEditorActive())return"transform"===e?!!scope().meshEditor.path:null!==(r=null!==(null===(i=scope().meshEditor.boxRef)||void 0===i?void 0:i.box[e]))&&void 0!==r&&r;if("storyRef"===e&&scope().eddiActive())return!!scope().eddiActiveStory;{let t=!1;for(const o of this.boxes.values()){if(!o.box.getFeature(e))return!1;t=!0}return t}}canAddFeature(e){if(1===this.boxes.size){if("imageRef"===e||"storyRef"===e||"simpleText"===e||"pathGeometry"===e||"pathText"===e)return!1;const t=this.boxes.values().next().value.box.getFeature(e);return null==t}return!("pathGeometry"!==e||!scope().pathEditorActive())&&!scope().pathEditor.path}canRemoveFeature(e){if(1===this.boxes.size){return!(!this.boxes.values().next().value.box.getFeature(e)||"boxGeometry"===e||"transform"===e||"effect"===e||"lock"===e)}return"pathGeometry"===e&&scope().pathEditorActive()?!!scope().pathEditor.path:!("storyRef"!==e||!scope().eddiActive())&&!!scope().eddiActiveStory}getClipboardData(){const e=Array.from(scope().selection.boxes.values()).map((e=>e.box)).sort(((e,t)=>e.order-t.order)).map((e=>{const t=scope().getBox(e.id);if(t)return t.box.serialize(t.spread.id,t.doc.id,!0,!0);throw"Cant find box;"+e.id}));return e.length>0?{context:"Selection",objects:e,scopeId:scope().id}:null}setClipboardData(e,t,o=10,i=10){t&&(o=0,i=0);const r=[],s=[],n=new Map;scope().lastCreatedBoxIds=[];let a=0;for(const t of e.objects){const e=t;if(e.data.story&&e.data.story.story)if("none"!==e.data.story.rep&&scope().getStory(e.data.story.sId))alert("auto flow");else{const t=new Story(generateDBID(),e.data.story.story);r.push(t.serialize()),e.data.story.sId=t.id}if(e.data.bgi){let t=n.get(e.data.bgi);t||(t=generateDBID(),n.set(e.data.bgi,t)),e.data.bgi=t}const l=scope().docUi.currentSpread,c=new Box(boxTypeE.rect,scope().docUi.currentLayerId,void 0,t),d=1;if(l.boxes.size>0&&0===a){const e=Array.from(l.boxes.values()).sort(((e,t)=>e.order-t.order));a=e[e.length+-1].order}const h=getOrder(a,d);a=h;const p=l.height(),u=l.width(),m=c.boxGeometry.width.toPixel(u,p),f=c.boxGeometry.height.toPixel(p,u);let g=c.boxGeometry.left.addPixel(u,o),y=c.boxGeometry.top.addPixel(p,i);const b=y.toPixel(p,u),v=g.toPixel(p,u),x=scope().getVisibleTopLeftPositionForNewItems(l);x.l>v+m||v>x.l+x.w?g=new Length(x.l,"px"):(x.t>b+f||b>x.t+x.h)&&(y=new Length(x.t,"px"));const w=(new Nobs).setProperty(c.boxGeometry,"left",g).setProperty(c.boxGeometry,"top",y).setProperty(c,"order",h);s.push(new Box(w,c).serialize(l.id,scope().currentDoc.id)),scope().lastCreatedBoxIds.push(c.id)}return!!s.length&&(create([...r,...s]),!0)}getOrderPairUnderSelection(e){let t=-1;if(this.spread){const o=this.spread.boxesByLayer(e,"bottom-up");for(let e=0;e<o.length;e++)if(this.boxes.has(o[e].id)){t=e;break}return t>1?{beforeOrder:o[t-2].order,beforeItem:o[t-2],afterOrder:o[t-1].order,afterItem:o[t-1],smallestOrLargestOrder:o[0].order,layerId:e}:t>0?{beforeOrder:0,beforeItem:null,afterOrder:o[t-1].order,afterItem:o[t-1],smallestOrLargestOrder:o[0].order,layerId:e}:null}return null}getOrderPairOverSelection(e,t=!1){let o=-1;if(this.spread){const i=this.spread.boxesByLayer(e,"bottom-up"),r=i.length-1;for(let e=r;e>=0;e--)if(this.boxes.has(i[e].id)){o=e;break}return o<r-1?{beforeOrder:i[o+1].order,beforeItem:i[o+1],afterOrder:i[o+2].order,afterItem:i[o+2],smallestOrLargestOrder:i[r].order,layerId:e}:o<r?{beforeOrder:i[o+1].order,beforeItem:i[o+1],afterOrder:1,afterItem:null,smallestOrLargestOrder:i[r].order,layerId:e}:t?{beforeOrder:i[r].order,beforeItem:i[r],afterOrder:1,afterItem:null,smallestOrLargestOrder:i[r].order,layerId:e}:null}return null}getBoxOverSelection(){let e=null;if(this.spread)for(const t of Array.from(this.spread.boxes.values()).sort(((e,t)=>t.order-e.order))){if(this.boxes.has(t.id))return e;e=t}return e}setNewOrder(e,t,o,i,r,s){scope().isRecording&&scope().e2e.record({module:"selection",func:"setNewOrder",args:Array.from(arguments)});const n=[],a=[],l=Array.from(this.boxes.values()).map((e=>e.box)).sort(((e,t)=>e.order-t.order)),c=this.spread||scope().docUi.currentSpread,d=new Map,h=new Set;for(const e of l)if(e.boxGroupId){const t=d.get(e.boxGroupId);d.set(e.boxGroupId,void 0!==t?t+1:1)}for(const[e,t]of d){Array.from(c.boxes.values()).filter((t=>t.boxGroupId===e)).length===t&&h.add(e)}for(const c of l){const l=scope().getBox(c.id);if(!l)throw"Update Order Value: BoxRef not found: "+c.id;{const d=new Nobs,p=getOrder(e,o);let u=c.boxGroupId;e=p,s||(t&&i?t.boxGroupId===i.boxGroupId?u=t.boxGroupId:c.boxGroupId&&c.boxGroupId!==t.boxGroupId&&c.boxGroupId!==i.boxGroupId&&(h.has(u)||(u="")):t?c.boxGroupId&&c.boxGroupId!==t.boxGroupId&&(h.has(u)||(u="")):i?c.boxGroupId&&c.boxGroupId!==i.boxGroupId&&(h.has(u)||(u="")):h.has(u)||(u="")),d.setProperty(l.box,"order",p),d.setProperty(l.box,"layerId",r),s?d.setProperty(l.box,"boxGroupId",s):u!==l.box.boxGroupId&&d.setProperty(l.box,"boxGroupId",u);const m=new Box(d,l.box);n.push(l.box.serialize(l.spread.id,l.doc.id)),a.push(m.serialize(l.spread.id,l.doc.id))}}a.length&&update(n,a)}getSelectedLayerId(){let e=null;for(const t of this.boxes.values())if(e){if(e!==t.box.layerId)return null}else e=t.box.layerId;return e}getImageList(){const e=Array.from(scope().images.values());if(config.isBuyer||config.isMobile){const t=this.getValueExtended("lock","allowImageGroups").value;return t?e.filter((e=>e.group&&t.indexOf(e.group)>=0)):[]}return e}setPasteBoardToCurrentSelection(){return __awaiter$B(this,void 0,void 0,(function*(){if(this.boxes.size>0){const e=getBoundingBoxFromSelection(this.toFrames()),t=scope().currentDoc,o=new Nobs;let i=0,r=0,s=0,n=0;e.left<0&&(i=-e.left),e.top<0&&(r=-e.top),e.width+e.left>t.pageWidth&&(s=e.width+e.left-t.pageWidth),e.height+e.top>t.pageHeight&&(n=e.height+e.top-t.pageHeight),o.setProperty(t,"pasteBoardLeft",i),o.setProperty(t,"pasteBoardTop",r),o.setProperty(t,"pasteBoardRight",s),o.setProperty(t,"pasteBoardBottom",n);const a=new Doc(o,t);return update([t.serialize(scope().id)],[a.serialize(scope().id)])}throw new Error("setPasteBoardToCurrentSelection: Selection is empty!")}))}getContextMenu(e,t,o){const i=this.getSelectedLayerId();if(this.spread&&this.boxes.size>0&&!config.isBuyer&&!config.isMobile){const e=!!i&&this.getOrderPairUnderSelection(i),t=!!i&&this.getOrderPairOverSelection(i),o=i?this.spread.boxesByLayer(i,"top-down"):[],r=o.length?o[0]:null,s=o.length?o[o.length-1]:null,n=[],a=this.boundingBoxGeo.isYAxisControlledByStyle("top",!1),l=this.boundingBoxGeo.isXAxisControlledByStyle("left",!1);if(n.push({caption:"Arange",icon:void 0,sub:[{caption:"Send Backward",icon:"send-backward",disabled:!e,callback:()=>{e&&this.setNewOrder(e.beforeOrder,e.beforeItem,e.afterOrder,e.afterItem,e.layerId)},bold:!1},{caption:"Send to Back",icon:"send-back",disabled:!e,callback:()=>{e&&this.setNewOrder(0,null,e.smallestOrLargestOrder,r,e.layerId)},bold:!1},{caption:"Bring Forward",icon:"bring-forward",disabled:!t,callback:()=>{t&&this.setNewOrder(t.beforeOrder,t.beforeItem,t.afterOrder,t.afterItem,t.layerId)},bold:!1},{caption:"Bring to Front",icon:"bring-front",disabled:!t,callback:()=>{t&&this.setNewOrder(t.smallestOrLargestOrder,s,1,null,t.layerId)},bold:!1}]}),n.push({caption:"Spacing",icon:void 0,disabled:this.boxes.size<2,sub:this.boxes.size<2?void 0:[{caption:"Horizontal Between",disabled:l,icon:"space-horizontal-between",callback:()=>this.distributeSpacing("horizontal","between")},{caption:"Vertical Between",disabled:a,icon:"space-vertical-between",callback:()=>this.distributeSpacing("vertical","between")},{caption:"-"},{caption:"Horizontal Around",disabled:l,icon:"space-horizontal-around",callback:()=>this.distributeSpacing("horizontal","around")},{caption:"Vertical Around",disabled:a,icon:"space-vertical-around",callback:()=>this.distributeSpacing("vertical","around")}],bold:!0}),n.push({caption:"Spacing (Page)",icon:void 0,sub:[{caption:"Horizontal Between",disabled:l,icon:"space-horizontal-between",callback:()=>this.distributeSpacing("horizontal","between",!0)},{caption:"Vertical Between",disabled:a,icon:"space-vertical-between",callback:()=>this.distributeSpacing("vertical","between",!0)},{caption:"-"},{caption:"Horizontal Around",disabled:l,icon:"space-horizontal-around",callback:()=>this.distributeSpacing("horizontal","around",!0)},{caption:"Vertical Around",disabled:a,icon:"space-vertical-around",callback:()=>this.distributeSpacing("vertical","around",!0)}],bold:!0}),n.push({caption:"Align",icon:void 0,disabled:this.boxes.size<2,sub:this.boxes.size<2?void 0:[{caption:"Left",disabled:l,icon:"align-left",callback:()=>this.alignItems("left")},{caption:"Center",disabled:l,icon:"align-center",callback:()=>this.alignItems("center")},{caption:"Right",disabled:l,icon:"align-right",callback:()=>this.alignItems("right")},{caption:"-"},{caption:"Top",disabled:a,icon:"align-top",callback:()=>this.alignItems("top")},{caption:"Middle",disabled:a,icon:"align-middle",callback:()=>this.alignItems("middle")},{caption:"Bottom",disabled:a,icon:"align-bottom",callback:()=>this.alignItems("bottom")}],bold:!0}),n.push({caption:"Align (Page)",icon:void 0,sub:[{caption:"Left",disabled:l,icon:"align-left",callback:()=>this.alignItems("left",!0)},{caption:"Center",disabled:l,icon:"align-center",callback:()=>this.alignItems("center",!0)},{caption:"Right",disabled:l,icon:"align-right",callback:()=>this.alignItems("right",!0)},{caption:"-"},{caption:"Top",disabled:a,icon:"align-top",callback:()=>this.alignItems("top",!0)},{caption:"Middle",disabled:a,icon:"align-middle",callback:()=>this.alignItems("middle",!0)},{caption:"Bottom",disabled:a,icon:"align-bottom",callback:()=>this.alignItems("bottom",!0)}],bold:!0}),n.push({caption:"-"}),n.push({caption:"Copy",disabled:!1,callback:()=>{clipboardCopy(!1)}}),n.push({caption:"Cut",callback:()=>{clipboardCopy(!0)}}),n.push({caption:"Paste",callback:()=>{clipboardPaste(!1)}}),n.push({caption:"Paste in Place",callback:()=>{clipboardPaste(!0)}}),n.push({caption:"-"}),this.boxes.values().next().value.box.boxGroupId?n.push({caption:"Un-Group",callback:()=>this.groupBoxes("ungroup"),bold:!1,disabled:this.boxes.size<=1}):n.push({caption:"Group",callback:()=>this.groupBoxes("group"),bold:!1,disabled:this.boxes.size<=1}),n.push({caption:"-"}),n.push({caption:"Delete",icon:"trash",callback:()=>scope().removeItem(),bold:!1,disabled:0===this.boxes.size}),n.push({caption:"-"}),n.push({caption:"Set as Pasteboard",callback:()=>this.setPasteBoardToCurrentSelection(),bold:!1,disabled:0===this.boxes.size}),n.length)return n}return null}alignItems(e,t=!1){const o=this.boundingBoxGeo.isYAxisControlledByStyle("top"),i=this.boundingBoxGeo.isXAxisControlledByStyle("left");if(o&&("top"===e||"middle"===e||"bottom"===e))return void beep();if(i&&("left"===e||"center"===e||"right"===e))return void beep();const r=this.getAlignRect(t),s=[],n=[];for(const t of this.boxes.keys()){const o=scope().getBox(t);if(o){const t=o.box.boxGeometry.toPixel(o.spread.width(),o.spread.height());switch(e){case"left":t.left=r.left;break;case"center":t.left=r.left+(r.width-t.width)/2;break;case"right":t.left=r.left+r.width-t.width;break;case"top":t.top=r.top;break;case"middle":t.top=r.top+(r.height-t.height)/2;break;case"bottom":t.top=r.top+r.height-t.height}const i=new Nobs;i.setProperty(o.box,"boxGeometry",o.box.boxGeometry.fromPixel(o.spread.width(),o.spread.height(),t.left,t.top,t.width,t.height,o.box.boxGeometry.rotation));const a=new Box(i,o.box).serialize(o.spread.id,o.doc.id),l=o.box.serialize(o.spread.id,o.doc.id);JSON.stringify(a)!==JSON.stringify(l)&&(s.push(a),n.push(l))}}s.length&&update(n,s)}distributeSpacing(e,t,o=!1){const i=this.boundingBoxGeo.isYAxisControlledByStyle("top"),r=this.boundingBoxGeo.isXAxisControlledByStyle("left");if(i&&"vertical"===e)return void beep();if(r&&"horizontal"===e)return void beep();const s=this.getAlignRect(o),n=this.spread||scope().docUi.currentSpread,a=Array.from(this.boxes.values()).map((e=>{const t=e.box.boxGeometry.toPixel(n.width(),n.height());return{id:e.box.id,left:t.left,top:t.top,width:t.width,height:t.height}})).sort(((t,o)=>"vertical"===e?t.top-o.top:t.left-o.left)),l="between"===t?a.length-1:a.length+1,c=a.map((e=>e.width)).reduce(((e,t)=>e+t),0),d=a.map((e=>e.height)).reduce(((e,t)=>e+t),0),h=(s.width-c)/l,p=(s.height-d)/l,u=[],m=[];let f=s.left,g=s.top;"around"===t&&(g+=p,f+=h);for(const t of a){const o=scope().getBox(t.id);if(o){switch(e){case"horizontal":t.left=f,f+=t.width+h;break;case"vertical":t.top=g,g+=t.height+p}const i=new Nobs;i.setProperty(o.box,"boxGeometry",o.box.boxGeometry.fromPixel(o.spread.width(),o.spread.height(),t.left,t.top,t.width,t.height,o.box.boxGeometry.rotation));const r=new Box(i,o.box).serialize(o.spread.id,o.doc.id),s=o.box.serialize(o.spread.id,o.doc.id);JSON.stringify(r)!==JSON.stringify(s)&&(u.push(r),m.push(s))}}u.length&&update(m,u)}getAlignRect(e){if(e){const e=this.spread||scope().docUi.currentSpread,t=scope().currentDoc.pageWidth;let o=0;return e.pages.length>1&&this.boundingBoxGeo.left.value>t&&(o=t),{left:o,top:0,width:t,height:e.height()}}return{left:this.boundingBoxGeo.left.value,top:this.boundingBoxGeo.top.value,width:this.boundingBoxGeo.width.value,height:this.boundingBoxGeo.height.value}}}return e._currentExternalProperties=[],e})();function deleteBox(e,t){const o=scope().getBox(t);if(o)return new Doc((new Nobs).removeObject(o.box),e);throw"Can't find Box to delete."}function addOrUpdateBox(e,t){const o=new Nobs,i=e.spreads.get(t.data.spreadId);if(i){const r=e.getBoxRef(t.id);let s=new Box(boxTypeE.rect,"",t.id,t);if(!e.layers.has(s.layerId)){const e=(new Nobs).setProperty(s,"layerId","BASELAYER");s=new Box(e,s)}if(r){s.setOffsetsFromBox(r.box),r.box.order===s.order&&r.box.layerId===s.layerId||(i.boxOrderHasChanged=!0);const t=e.spreads.get(r.spread.id);t!==i?(o.removeObject(r.box),o.addToCollection(i.boxes,s),null==t||t.snapLinesX):(r.box.basics.textWrapMode!==s.basics.textWrapMode&&(s.basics.tempFlag_TextWrapModeChanged=!0),o.replaceObject(r.box,s))}else o.addToCollection(i.boxes,s)}else console.error("addOrUpdateBox - Target spread not found in current document: "+e.name,t);return new Doc(o,e)}function addSpread(e,t=1){const o=new Nobs;for(let i=1;i<=t;i++)o.addToCollection(e.spreads,new Spread(e,void 0,void 0,i===t||1===i?1:2));return new Doc(o,e)}function addOrUpdateColor(e){const t=new Nobs,o=scope().colors;for(const i of e){const r=o.getSwatchById(i.id);r?(t.replaceObject(r,new Color(i.id,i.data)),1===e.length&&r.isSwatch()&&window.setTimeout((()=>{scope().colors.notifySwatchChange(i.data.na),scope().colors.notifySwatchChange(r.name)}),0)):t.addToCollection(o.getCollection(),new Color(i.id,i.data))}return new Colors(t,o)}function addOrUpdateImage(e){const t=new Map(scope().images);for(const o of e)t.set(o.id,new Image$1(o.id,o.data));return new Map(t)}function addOrUpdateStory(e){var t;if(scope().eddiActiveStory&&1===e.length&&(null===(t=scope().eddiActiveStory)||void 0===t?void 0:t.id)===e[0].id)return null;const o=new Map(scope().stories);for(const t of e){const e=new Story(t.id,t.data);"off"===e.hyphenationLanguage||getHyphenationPattern(e.hyphenationLanguage)||loadHyphenationPattern(e.hyphenationLanguage).then((()=>{e.resetStoryCache(),e.render(null),e.pushCacheToWcBoxes()}));const i=scope().stories.get(t.id);i&&(e.myBoxes=i.myBoxes),o.set(t.id,e),e.render(null),e.pushCacheToWcBoxes()}return new Map(o)}function addOrUpdateFont(e){const t=new Map(scope().fonts),o=new Set;for(const i of e)if(!i.id.startsWith("DEFAULT")){let e=i.data.fa;i.data.fc&&(e=i.data.fa+" "+i.data.fc),scope().fonts_getByName(e)||o.has(e)?t.set(i.id,new Font(i.id,i.data)):(t.set(i.id,new Font(i.id,i.data)),o.add(e))}return new Map(t)}function removeColor(e){const t=new Nobs,o=scope().colors,i=o.getSwatchById(e);return i?(t.removeObject(i),new Colors(t,o)):o}function removeImage(e){const t=scope().images;if(t.get(e)){const o=new Map(t);return o.delete(e),new Map(o)}return t}function removeFont(e){const t=new Map(scope().fonts);return t.get(e)?(t.delete(e),new Map(t)):scope().fonts}var __awaiter$C=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};let _initalDocLoading=!0;const allSubscriberIds=[];function initalDocLoading(){return _initalDocLoading}function loadScopeJson(e,t){return __awaiter$C(this,void 0,void 0,(function*(){try{const o=yield documentProvider("load").loadCore({id:e,fromUserId:t});if(o&&Object.prototype.hasOwnProperty.call(o,"documents"))return o}catch(o){console.error("Loading template: "+(t?t+"/":"")+e+" failed.\n"+o)}return null}))}function loadJsonToLocalStorage(e,t="auto"){var o;return __awaiter$C(this,void 0,void 0,(function*(){if(e&&Object.prototype.hasOwnProperty.call(e,"documents")){console_log(e);const i=(null===(o=e.template)||void 0===o?void 0:o.id)||e.scope.id;if(!i)return alert("Can't load Scope without id."),!1;const r=e.dateISO||"",s=localStorage.getItem(i+"*TS-ISO")||"";return"loadAlwaysFromServer"!==t&&!1===config.hideControls&&!1===config.isBuyer&&(!r&&s||s&&r&&s>r)&&!config.isAutomationMode&&confirm("Found unsaved version of ["+i+"] on your local computer.\nPress <OK> to load LOCAL version?\nPress <Cancel> to load server version.")?(yield loadHyphenationPatternsFromLocalStorage(i),!0):(yield loadHyphenationPatterns(e),deleteOldScopesFromStorage(),removeUnusedStories(e),saveDataToLocalStorage(i,e),!0)}return!1}))}function loadHyphenationPatterns(e){return __awaiter$C(this,void 0,void 0,(function*(){if(Array.isArray(e.documents))for(const t of e.stories)t.data&&t.data.hy&&"off"!==t.data.hy&&(yield loadHyphenationPattern(t.data.hy))}))}function loadHyphenationPatternsFromLocalStorage(e){return __awaiter$C(this,void 0,void 0,(function*(){for(let t=0;t<localStorage.length;t++){const o=localStorage.key(t);if(o&&o.startsWith(e+"*story")){const e=localStorage.getItem(o);if(e){const t=JSON.parse(e);t&&t.data&&t.data.hy&&"off"!==t.data.hy&&(yield loadHyphenationPattern(t.data.hy))}}}}))}function removeUnusedStories(e){const t=new Set;if(Array.isArray(e.documents))for(const o of e.documents)for(const e of o.data.sps)if(Array.isArray(e.boxes))for(const o of e.boxes)o.data.story&&t.add(o.data.story.sId);for(let o=e.stories.length-1;o>=0;o--)t.has(e.stories[o].id)||e.stories.splice(o,1)}function saveDataToLocalStorage(e,t){deleteScopeFromStorage(e);const o=JSON.parse(JSON.stringify(t));if(Array.isArray(o.documents))for(const t of o.documents)for(const o of t.data.sps)if(Array.isArray(o.boxes)){for(const t of o.boxes)localStorage.setItem(e+"*"+t.type+":"+t.id,JSON.stringify(t));delete o.boxes}let i;for(i of Object.keys(o))if(Array.isArray(o[i]))for(const t of o[i])"style"===t.type?(t.id="global",localStorage.setItem(e+"*style:global",JSON.stringify(t)),config.isAutomationMode||alert("Global style format updates. Please save Template again.")):localStorage.setItem(e+"*"+t.type+":"+t.id,JSON.stringify(t));else"productMatrix"===i?localStorage.setItem(e+"*matrix:PRODUCTMATRIX",JSON.stringify(o[i])):"style"===i?localStorage.setItem(e+"*style:global",JSON.stringify(o[i])):"template"===i&&localStorage.setItem(e+"*template:"+o[i].id,JSON.stringify(o[i]));localStorage.setItem(e+"*TS-ISO",o.dateISO||(new Date).toISOString())}function deleteScopeFromStorage(e){const t=[];for(let o=0;o<localStorage.length;o++){const i=localStorage.key(o);i&&i.startsWith(e+"*")&&t.push(i)}t.push("open:"+e);for(const e of t)localStorage.removeItem(e)}function deleteOldScopesFromStorage(){const e=new Date;e.setHours(e.getHours()-1);const t=e.toISOString(),o=[],i=new Map;for(let e=0;e<localStorage.length;e++){const r=localStorage.key(e);if(r&&r.indexOf("*")>0){const e=r.split("*")[0];if(!i.has(e)){const r=localStorage.getItem("open:"+e);if(r){const s=JSON.parse(r).ts;s&&s>t?i.set(e,"keep"):(i.set(e,"remove"),o.push("open:"+e))}else i.set(e,"remove")}"remove"===i.get(e)&&o.push(r)}}for(const e of o)localStorage.removeItem(e)}function loadMacroList(){return __awaiter$C(this,void 0,void 0,(function*(){if(yield scopeReadyAsync(),!config.enableMacros)return void(scope().resourcesMacrosUi.macros=new Map);const e=yield documentProvider().load("__macrolist");if(!e||!Array.isArray(e))return void(scope().resourcesMacrosUi.macros=new Map);console_log(e);const t=scope().resourcesMacrosUi.macros;t.clear();for(const o of e)t.set(o,new Macro(o))}))}function saveMacroList(){return __awaiter$C(this,void 0,void 0,(function*(){const e=JSON.stringify(Array.from(scope().resourcesMacrosUi.macros.keys()));yield documentProvider().save("__macrolist",e)}))}function loadScope(e,t=null,o="auto",i){var r,s;return __awaiter$C(this,void 0,void 0,(function*(){if(!e)throw new Error("Load called without scopeId or data object.");clearUndoAndRedos(),BoxCacheEntries.clear(),config.loadingFadeCallback&&config.loadingFadeCallback();for(const e of allSubscriberIds)unsubscribe(e);scope().selection=new Selection$1(null,null),_initalDocLoading=!0,setOldBuyerPropertyKeys([]),scope().setGlobalFormFields(new Map),scope().productMatrixUi.productMatrix=new ProductMatrix({}),scope().resetWcListGroupCache(),scope().templateProperties=new TemplateProperties({}),scope().toolbarUi.pageIndex=0,scope().fonts=new Map(getDefaultFonts().map((e=>[e.id,e]))),scope().fontsLoaded=!1,scope().images=new Map,scope().stories=new Map,scope().style=Style.getNewGlobalStyle(),scope().colors=new Colors;let n,a=null;if("new"===e?n="new":"string"==typeof e?(a=yield loadScopeJson(e),n=e):(a=e,n=null!==(s=null===(r=a.template)||void 0===r?void 0:r.id)&&void 0!==s?s:a.scope.id),a){!0===(yield loadJsonToLocalStorage(a,o))?(subscribe(null,n,t),scope().templateProperties.applyCurrentSettings()):subscribe(null)}else subscribe(null,n,void 0,i);scope().toolbarUi.requestUpdate()}))}function subscribe(e,t=null,o=null,i){scope()||loadMacroList();if((localStorage.getItem((t||"new")+"*TS-ISO")||"")&&"new"!==t)t||(t="new");else{const e=addSpread(new Doc(void 0,void 0,"Document",null==i?void 0:i.width,null==i?void 0:i.height,null==i?void 0:i.unit),1);t="new",deleteScopeFromStorage("new");const o=e.serialize(t);localStorage.setItem("new*doc:"+o.id,JSON.stringify(o)),localStorage.setItem("new*TS-ISO",(new Date).toISOString())}allSubscriberIds.push(subscribe$1(t,"doc","",(i=>{const r=[];for(const e of i)switch(e.event){case"added":r.push(e.data);break;case"modified":scope().update_DocAndSpreads_KeepBoxes(e.data);break;case"removed":scope().removeDoc(e.id),unSubscribeDocument(e.id)}if(r.length)if(!scope()||_initalDocLoading){_initalDocLoading=!1;const i=r[0].scopeId||r[0].parentId;if(i?(t!==i&&alert("Loaded doc scopeId("+i+") differs from subscribed scopeId("+t+")"),t=i):alert("Subscribed first doc does not have scopeID"),t||(alert("No Scope, set to scope#1"),t="scope#1"),scope())scope().readDocuments(r),scope().id=t||generateDBID();else{if(!e)throw new Error("Initial Subscribe called without content-div. Can't initialize scope.");new Scope(e,r,t)}subscribeTemplateProperties(t),subscribeStories(t),subscribeColors(t),subscribeFonts(t),subscribeImages(t),subscribeGlobalFormFields(t),subscribeProductMatrix(t),subscribeStyle(t);for(const e of scope().docs.keys())subscribeDocument(t,e);const s=Array.from(scope().docs.values()).filter((e=>e.isLayoutSnippet));let n=new Doc(new Nobs,scope().docs.values().next().value);s.length&&(n=s[0]),scope().updateDocReference(n,[],null,!1,!0,!0).then((()=>{config.isBuyer&&scope().selectionPropertiesUi.requestUpdate();const e=Date.now()-window.printessLoadingStart;console_log("Printess Loading time: "+e+"ms");const t=document.querySelector("#printess_loadingOverlay > .caption");t&&(t.textContent="loaded with magic in "+e/1e3+"s"),scanContentDimensions(n.id,!1),setTimeout((()=>__awaiter$C(this,void 0,void 0,(function*(){if(config.loadingDoneCallback){const e=yield api.getAllSpreads();config.loadingDoneCallback(e)}forceZoomCallback();const e=document.getElementById("mainGrid");if(e&&(e.style.opacity="1"),(isMobile()||config.isBuyer)&&1===scope().currentDoc.spreads.size){const e=scope().currentDoc.spreads.values().next().value,t=e.getSelectableBoxes();if(1===t.length){const o=scope().docUi.getWcBox(t[0].id);o&&(scope().selection=new Selection$1([o],e))}}}))),600),o&&scope().e2e.playMacro(o)}))}else{if(!t)return void alert("Missing scope-id to subscribe document.");for(const e of r)scope().addDoc(e),subscribeDocument(t,e.id)}})))}function subscribeColors(e){let t=[];allSubscriberIds.push(subscribe$1(e,"color","",(e=>{0===e.length&&create(Colors.getDefaultColors().map((e=>e.serialize())));for(const o of e)switch(o.event){case"added":t.push(o.data);break;case"modified":scope().colors=addOrUpdateColor([o.data]);break;case"removed":scope().colors=removeColor(o.id)}t.length>0&&(scope().colors=addOrUpdateColor(t),t=[])})))}function subscribeImages(e){let t=[];allSubscriberIds.push(subscribe$1(e,"image","",(e=>{for(const o of e)switch(o.event){case"added":t.push(o.data);break;case"modified":scope().images=addOrUpdateImage([o.data]);break;case"removed":scope().images=removeImage(o.id)}t.length>0&&(scope().images=addOrUpdateImage(t),t=[])})))}function subscribeGlobalFormFields(e){let t=[];allSubscriberIds.push(subscribe$1(e,"form","",(e=>{for(const o of e)switch(o.event){case"added":t.push(o.data);break;case"modified":scope()._SubscriberCallbackCommand_addOrUpdateGlobalFormField([o.data]);break;case"removed":scope()._SubscriberCallbackCommand_removeGlobalFormField(o.id)}t.length>0&&(scope()._SubscriberCallbackCommand_addOrUpdateGlobalFormField(t),t=[])})))}function subscribeFonts(e){let t=[];allSubscriberIds.push(subscribe$1(e,"font","",(e=>{for(const o of e)switch(o.event){case"added":t.push(o.data);break;case"modified":scope().fonts=addOrUpdateFont([o.data]);break;case"removed":scope().fonts=removeFont(o.id)}const o=scope().fonts.size===getDefaultFonts().length;(t.length>0||o)&&(t.length>0&&(scope().fonts=addOrUpdateFont(t)),addFontStyleSheet(Array.from(scope().fonts.values())),t=[])})))}function subscribeStyle(e){allSubscriberIds.push(subscribe$1(e,"style","",(e=>{let t=null;if(1===e.length){const o=e[0];("added"===o.event||"modified"===o.event&&o.data.data)&&(t=o.data.data.txt,"global"!==o.id&&alert("Error: Global style with other id then 'global' found! - please reload Template from Server."),scope().style=new Style("global",{txt:t},void 0,void 0,scope().style),scope().redrawAllItemsWithClassesDebounced())}else e.length>1&&alert("Error: More then a single global style incomming! - please reload Template from Server.");scope().resourcesStylesUi.globalStyleEditorActive()?scope().resourcesStylesUi.requestUpdate():scope().resourcesStylesUi.refreshGlobalStyleEddi()})))}function subscribeProductMatrix(e){allSubscriberIds.push(subscribe$1(e,"matrix","",(e=>{for(const t of e)switch(t.event){case"added":case"modified":scope().productMatrixUi.productMatrix=new ProductMatrix(t.data.data),scope().productMatrixUi.productMatrix.apply(scope().productMatrixUi.selectedRow,"modified"===t.event)}})))}function subscribeTemplateProperties(e){allSubscriberIds.push(subscribe$1(e,"template","",(e=>{for(const t of e)switch(t.event){case"added":case"modified":scope().templateProperties=new TemplateProperties(t.data.data)}})))}function subscribeStories(e){let t=[];allSubscriberIds.push(subscribe$1(e,"story","",(e=>{for(const o of e)switch(o.event){case"added":t.push(o.data);break;case"modified":{const e=addOrUpdateStory([o.data]);null!==e&&(scope().stories=e);break}}if(t.length>0){const e=addOrUpdateStory(t);if(null!==e){scope().stories=e;for(const e of scope().stories.values())e.render(null)}t=[]}})))}function unSubscribeDocument(e){unsubscribe(e)}function subscribeDocument(e,t){allSubscriberIds.push(subscribe$1(e,"box",t,(e=>{let o=0;const i=[];let r=scope().docs.get(t);if(!r)throw"Subscriber; Document not found";for(const t of e)switch(t.event){case"added":r=addOrUpdateBox(r,t.data),i.push(t.id),o++;break;case"modified":r=addOrUpdateBox(r,t.data),scope().updateDocReference(r,[t.id]);break;case"removed":r=deleteBox(r,t.id),scope().updateDocReference(r,[],[t.id])}if(o){const e=intersectStringArray(i,scope().lastCreatedBoxIds);e.length>0?(scope().lastCreatedBoxIds=e,scope().updateDocReference(r,e,null,!0)):initalDocLoading()?scope().docs.set(r.id,r):scope().updateDocReference(r,[])}})))}var __awaiter$D=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};function sha1hex(e){return __awaiter$D(this,void 0,void 0,(function*(){const t=(new TextEncoder).encode(e),o=yield crypto.subtle.digest("SHA-1",t);return Array.from(new Uint8Array(o)).map((e=>e.toString(16).padStart(2,"0"))).join("")}))}function hasActiveWarpTransform(e){return null!=e&&(e.warpArcActive||e.warpCupActive||e.warpPitActive||e.warpFishActive||e.warpFlagActive||e.warpCustomActive||e.warpArchActive||e.distortActive)}const HB_MEMORY_MODE_WRITABLE=2;var StrokeCap,StrokeJoin,StrokePosition;function convertLengthUnit(e){switch(e){case"px":return hb.Printess.Exports.LengthUnitE.Pixel;case"%":return hb.Printess.Exports.LengthUnitE.Percent;case"%%":return hb.Printess.Exports.LengthUnitE.PercentPercent;case"cm":return hb.Printess.Exports.LengthUnitE.Centimeter;case"mm":return hb.Printess.Exports.LengthUnitE.Millimeter;case"inch":return hb.Printess.Exports.LengthUnitE.Inch;case"pt":return hb.Printess.Exports.LengthUnitE.Point;case"equation":return hb.Printess.Exports.LengthUnitE.Equation}assertNever(e)}function convertArchPosition(e){switch(e){case"inner":return hb.Printess.Exports.ArcTransformE.Inner;case"outer":return hb.Printess.Exports.ArcTransformE.Outer}assertNever(e)}function convertArchMirror(e){switch(e){case"on":return hb.Printess.Exports.ArcMirrorE.Mirror;case"off":return hb.Printess.Exports.ArcMirrorE.Normal}assertNever(e)}function convertInnerEffectsMode(e){switch(e){case"combined":return hb.Printess.Exports.InnerEffectsModeE.Combined;case"fill":return hb.Printess.Exports.InnerEffectsModeE.Fill;case"stroke":return hb.Printess.Exports.InnerEffectsModeE.Stroke;case"separate":return hb.Printess.Exports.InnerEffectsModeE.FillAndStrokeSeparate}assertNever(e)}!function(e){e[e.Butt=0]="Butt",e[e.Round=1]="Round",e[e.Square=2]="Square"}(StrokeCap||(StrokeCap={})),function(e){e[e.Miter=0]="Miter",e[e.Round=1]="Round",e[e.Bevel=2]="Bevel"}(StrokeJoin||(StrokeJoin={})),function(e){e[e.Middle=0]="Middle",e[e.Outer=1]="Outer",e[e.Inner=2]="Inner"}(StrokePosition||(StrokePosition={}));class PathPropertiesWrapper{constructor(e){this.Pointer=e}SetStrokeWidth(e){hb.Printess.PathProperties.SetStrokeWidth(this.Pointer,e)}SetIsStrokeWidthPercent(e){hb.Printess.PathProperties.SetIsStrokeWidthPercent(this.Pointer,e)}SetStrokeColorArgb(e){hb.Printess.PathProperties.SetStrokeColorArgb(this.Pointer,e)}SetFillColorArgb(e){hb.Printess.PathProperties.SetFillColorArgb(this.Pointer,e)}SetStrokeCap(e){hb.Printess.PathProperties.SetStrokeCap(this.Pointer,e)}SetStrokeJoin(e){hb.Printess.PathProperties.SetStrokeJoin(this.Pointer,e)}SetStrokePosition(e){hb.Printess.PathProperties.SetStrokePosition(this.Pointer,e)}SetMiterLimit(e){hb.Printess.PathProperties.SetMiterLimit(this.Pointer,e)}SetIsImageMask(e){hb.Printess.PathProperties.SetIsImageMask(this.Pointer,e)}SetIsClosed(e){hb.Printess.PathProperties.SetIsClosed(this.Pointer,e)}SetStrokeType(e){hb.Printess.PathProperties.SetStrokeType(this.Pointer,e)}SetDashGap(e,t){hb.Printess.PathProperties.SetDashGap(this.Pointer,e,t)}SetDashGapDashGap(e,t,o,i){hb.Printess.PathProperties.SetDashGapDashGap(this.Pointer,e,t,o,i)}}class PathPropertiesBindings{constructor(e){this.exports=e}SetStrokeWidth(e,t){this.exports.asm.PathProperties_SetStrokeWidth(e,t)}SetIsStrokeWidthPercent(e,t){this.exports.asm.PathProperties_SetIsStrokeWidthPercent(e,t)}SetStrokeColorArgb(e,t){this.exports.asm.PathProperties_SetStrokeColorArgb(e,t.a,t.r,t.g,t.b)}SetFillColorArgb(e,t){this.exports.asm.PathProperties_SetFillColorArgb(e,t.a,t.r,t.g,t.b)}SetStrokeCap(e,t){this.exports.asm.PathProperties_SetStrokeCap(e,t)}SetStrokeJoin(e,t){this.exports.asm.PathProperties_SetStrokeJoin(e,t)}SetStrokePosition(e,t){this.exports.asm.PathProperties_SetStrokePosition(e,t)}SetMiterLimit(e,t){this.exports.asm.PathProperties_SetMiterLimit(e,t)}SetIsImageMask(e,t){this.exports.asm.PathProperties_SetIsImageMask(e,t)}SetIsClosed(e,t){this.exports.asm.PathProperties_SetIsClosed(e,t)}SetStrokeType(e,t){this.exports.asm.PathProperties_SetStrokeType(e,t)}SetDashGap(e,t,o){this.exports.asm.PathProperties_SetDashGap(e,t,o)}SetDashGapDashGap(e,t,o,i,r){this.exports.asm.PathProperties_SetDashGapDashGap(e,t,o,i,r)}}class EffectsSetWrapper{constructor(e){this.Pointer=e}destroy(){hb.Printess.EffectsSet.destroy(this.Pointer)}calculateBounds(e,t){return hb.Printess.EffectsSet.calculateBounds(this.Pointer,e,t)}drawImage(e,t,o){hb.Printess.EffectsSet.drawImage(this.Pointer,e,t,o)}drawDropShadow(e,t,o){hb.Printess.EffectsSet.drawDropShadow(this.Pointer,e,t,o)}drawOuterGlow(e,t,o){hb.Printess.EffectsSet.drawOuterGlow(this.Pointer,e,t,o)}drawStroke(e,t,o){hb.Printess.EffectsSet.drawStroke(this.Pointer,e,t,o)}transformImage(e){return hb.Printess.EffectsSet.transformImage(this.Pointer,e)}setBlur(e){hb.Printess.EffectsSet.setBlur(this.Pointer,e)}setHueRotate(e){hb.Printess.EffectsSet.setHueRotate(this.Pointer,e)}setSepia(e){hb.Printess.EffectsSet.setSepia(this.Pointer,e)}setGrayscale(e){hb.Printess.EffectsSet.setGrayscale(this.Pointer,e)}setBrightness(e){hb.Printess.EffectsSet.setBrightness(this.Pointer,e)}setSaturation(e){hb.Printess.EffectsSet.setSaturation(this.Pointer,e)}setContrast(e){hb.Printess.EffectsSet.setContrast(this.Pointer,e)}setInvert(e){hb.Printess.EffectsSet.setInvert(this.Pointer,e)}setInnerEffectAreas(e,t){hb.Printess.EffectsSet.setInnerEffectAreas(this.Pointer,e,t)}setPerlinNoise(e,t,o,i){hb.Printess.EffectsSet.setPerlinNoise(this.Pointer,e,t,o,i)}setDropShadow(e,t,o,i,r,s){hb.Printess.EffectsSet.setDropShadow(this.Pointer,e,t,o,i,r,s)}setOuterGlow(e,t,o,i,r,s){hb.Printess.EffectsSet.setOuterGlow(this.Pointer,e,t,o,i,r,s)}setInnerShadow(e,t,o,i,r,s){hb.Printess.EffectsSet.setInnerShadow(this.Pointer,e,t,o,i,r,s)}setInnerGlow(e,t,o,i,r,s){hb.Printess.EffectsSet.setInnerGlow(this.Pointer,e,t,o,i,r,s)}setStroke(e,t,o,i,r,s){hb.Printess.EffectsSet.setStroke(this.Pointer,e,t,o,i,r,s)}setBevel(e,t,o,i,r,s,n,a,l){hb.Printess.EffectsSet.setBevel(this.Pointer,e,t,o,i,r,s,n,a,l)}}class EffectsSetBindings{constructor(e){this.exports=e}create(){const e=this.exports.EffectsSet_Create();return new EffectsSetWrapper(e)}destroy(e){this.exports.EffectsSet_Destroy(e)}calculateBounds(e,t,o){return this.exports.EffectsSet_CalculateBounds(e,t,o)}drawImage(e,t,o,i){this.exports.EffectsSet_DrawImage(e,t,o,i)}drawDropShadow(e,t,o,i){this.exports.EffectsSet_DrawDropShadow(e,t,o,i)}drawOuterGlow(e,t,o,i){this.exports.EffectsSet_DrawOuterGlow(e,t,o,i)}drawStroke(e,t,o,i){this.exports.EffectsSet_DrawStroke(e,t,o,i)}transformImage(e,t){return this.exports.EffectsSet_TransformImage(e,t)}setBlur(e,t){this.exports.EffectsSet_SetBlur(e,t.value,convertLengthUnit(t.unit))}setHueRotate(e,t){this.exports.EffectsSet_SetHueRotate(e,t)}setSepia(e,t){this.exports.EffectsSet_SetSepia(e,t)}setGrayscale(e,t){this.exports.EffectsSet_SetGrayscale(e,t)}setBrightness(e,t){this.exports.EffectsSet_SetBrightness(e,t)}setSaturation(e,t){this.exports.EffectsSet_SetSaturation(e,t)}setContrast(e,t){this.exports.EffectsSet_SetContrast(e,t)}setInvert(e,t){this.exports.EffectsSet_SetInvert(e,t)}setInnerEffectAreas(e,t,o){this.exports.EffectsSet_SetInnerEffectAreas(e,convertInnerEffectsMode(t),convertInnerEffectsMode(o))}setDropShadow(e,t,o,i,r,s,n){this.exports.EffectsSet_SetDropShadow(e,t,o.value,convertLengthUnit(o.unit),i.value,convertLengthUnit(i.unit),r.value,convertLengthUnit(r.unit),s.value,convertLengthUnit(s.unit),n.a,n.r,n.g,n.b)}setOuterGlow(e,t,o,i,r,s,n){this.exports.EffectsSet_SetOuterGlow(e,t,o.value,convertLengthUnit(o.unit),i.value,convertLengthUnit(i.unit),r.value,convertLengthUnit(r.unit),s.value,convertLengthUnit(s.unit),n.a,n.r,n.g,n.b)}setInnerShadow(e,t,o,i,r,s,n){this.exports.EffectsSet_SetInnerShadow(e,t,o.value,convertLengthUnit(o.unit),i.value,convertLengthUnit(i.unit),r.value,convertLengthUnit(r.unit),s.value,convertLengthUnit(s.unit),n.a,n.r,n.g,n.b)}setInnerGlow(e,t,o,i,r,s,n){this.exports.EffectsSet_SetInnerGlow(e,t,o.value,convertLengthUnit(o.unit),i.value,convertLengthUnit(i.unit),r.value,convertLengthUnit(r.unit),s.value,convertLengthUnit(s.unit),n.a,n.r,n.g,n.b)}setStroke(e,t,o,i,r,s,n){this.exports.EffectsSet_SetStroke(e,t,o.value,convertLengthUnit(o.unit),i.value,convertLengthUnit(i.unit),r.value,convertLengthUnit(r.unit),s.value,convertLengthUnit(s.unit),n.a,n.r,n.g,n.b)}setPerlinNoise(e,t,o,i,r){this.exports.EffectsSet_SetPerlinNoise(e,t,o,i,r)}setBevel(e,t,o,i,r,s,n,a,l,c){this.exports.EffectsSet_SetBevel(e,t.value,convertLengthUnit(t.unit),o,i,r,s,n,a,l.a,l.r,l.g,l.b,c.a,c.r,c.g,c.b)}}class OneLineShaperWrapper{constructor(e){this.Pointer=e,this.TransformSetPointer=hb.Printess.OneLineShaper.getTransformSetPointer(this.Pointer),this.TextPathProperties=this.getTextPathProperties(),this.EffectsSet=this.getEffectsSet()}getTextPathProperties(){const e=hb.Printess.OneLineShaper.getTextPathPropertiesPointer(this.Pointer);return new PathPropertiesWrapper(e)}getEffectsSet(){const e=hb.Printess.OneLineShaper.getEffectsSetPointer(this.Pointer);return new EffectsSetWrapper(e)}destroy(){hb.Printess.OneLineShaper.destroy(this.Pointer)}setText(e,t){hb.Printess.OneLineShaper.setText(this.Pointer,e,t)}setTextBefore(e){hb.Printess.OneLineShaper.setTextBefore(this.Pointer,e)}setTextAfter(e){hb.Printess.OneLineShaper.setTextAfter(this.Pointer,e)}setFont(e){hb.Printess.OneLineShaper.setFont(this.Pointer,e)}setMaximumFontSize(e){hb.Printess.OneLineShaper.setMaximumFontSize(this.Pointer,e)}setUseWinAscender(e){hb.Printess.OneLineShaper.setUseWinAscender(this.Pointer,e)}setSize(e,t){hb.Printess.OneLineShaper.setSize(this.Pointer,e,t)}setAlignment(e,t){hb.Printess.OneLineShaper.setAlignment(this.Pointer,e,t)}setPadding(e,t,o,i){hb.Printess.OneLineShaper.setPadding(this.Pointer,e,t,o,i)}setStretch(e,t,o,i){hb.Printess.OneLineShaper.setStretch(this.Pointer,e,t,o,i)}setUseFontMetrics(e){hb.Printess.OneLineShaper.setUseFontMetrics(this.Pointer,e)}buildSvg(){return hb.Printess.OneLineShaper.buildSvg(this.Pointer)}addStrokeExtents(e){return hb.Printess.OneLineShaper.addStrokeExtents(this.Pointer,e)}calculateBounds(){return hb.Printess.OneLineShaper.calculateBounds(this.Pointer)}drawImage(e,t,o,i,r){hb.Printess.OneLineShaper.drawImage(this.Pointer,e,t,o,i,r)}drawDropShadow(e,t){hb.Printess.OneLineShaper.drawDropShadow(this.Pointer,e,t)}drawOuterGlow(e,t){hb.Printess.OneLineShaper.drawOuterGlow(this.Pointer,e,t)}drawStroke(e,t){hb.Printess.OneLineShaper.drawStroke(this.Pointer,e,t)}}class OneLineShaperBindings{constructor(e){this.exports=e}create(){const e=this.exports.asm.OneLineShaper_Create();return new OneLineShaperWrapper(e)}destroy(e){this.exports.asm.OneLineShaper_Destroy(e)}getTransformSetPointer(e){return this.exports.asm.OneLineShaper_GetTransformSetPointer(e)}getTextPathPropertiesPointer(e){return this.exports.asm.OneLineShaper_GetTextPathPropertiesPointer(e)}getEffectsSetPointer(e){return this.exports.asm.OneLineShaper_GetEffectsSetPointer(e)}setText(e,t,o){this.exports.asm.OneLineShaper_SetText(e,t,o)}setTextBefore(e,t){t&&this.exports.OneLineShaper_SetTextBefore(e,t)}setTextAfter(e,t){t&&this.exports.OneLineShaper_SetTextAfter(e,t)}setFont(e,t){this.exports.asm.OneLineShaper_SetFont(e,t)}setSize(e,t,o){this.exports.asm.OneLineShaper_SetSize(e,t,o)}setAlignment(e,t,o){this.exports.asm.OneLineShaper_SetAlignment(e,t,o)}setPadding(e,t,o,i,r){this.exports.OneLineShaper_SetPadding(e,t.value,convertLengthUnit(t.unit),o.value,convertLengthUnit(o.unit),i.value,convertLengthUnit(i.unit),r.value,convertLengthUnit(r.unit))}setMaximumFontSize(e,t){this.exports.OneLineShaper_SetMaximumFontSize(e,t.value,convertLengthUnit(t.unit))}setUseWinAscender(e,t){this.exports.OneLineShaper_SetUseWinAscender(e,t)}setStretch(e,t,o,i,r){this.exports.asm.OneLineShaper_SetStretch(e,t,o,i,r)}setUseFontMetrics(e,t){this.exports.asm.OneLineShaper_SetUseFontMetrics(e,t)}buildSvg(e){return this.exports.OneLineShaper_BuildSvg(e)}addStrokeExtents(e,t){return this.exports.OneLineShaper_AddStrokeExtents(e,t)}calculateBounds(e){return this.exports.OneLineShaper_CalculateBounds(e)}drawImage(e,t,o,i,r,s){this.exports.OneLineShaper_DrawImage(e,t,o,i,r,s)}drawDropShadow(e,t,o){this.exports.OneLineShaper_DrawDropShadow(e,t,o)}drawOuterGlow(e,t,o){this.exports.OneLineShaper_DrawOuterGlow(e,t,o)}drawStroke(e,t,o){this.exports.OneLineShaper_DrawStroke(e,t,o)}}class TextOnPathWrapper{constructor(e){this.Pointer=e,this.TransformSetPointer=hb.Printess.TextOnPath.getTransformSetPointer(this.Pointer),this.TextPathProperties=this.GetTextPathProperties(),this.ShapePathProperties=this.GetShapePathProperties(),this.EffectsSet=this.getEffectsSet()}GetTextPathProperties(){const e=hb.Printess.TextOnPath.getTextPathPropertiesPointer(this.Pointer);return new PathPropertiesWrapper(e)}GetShapePathProperties(){const e=hb.Printess.TextOnPath.getShapePathPropertiesPointer(this.Pointer);return new PathPropertiesWrapper(e)}getEffectsSet(){const e=hb.Printess.TextOnPath.getEffectsSetPointer(this.Pointer);return new EffectsSetWrapper(e)}destroy(){hb.Printess.TextOnPath.destroy(this.Pointer)}setText(e,t){hb.Printess.TextOnPath.setText(this.Pointer,e,t)}setFont(e){hb.Printess.TextOnPath.setFont(this.Pointer,e)}setPath(e){hb.Printess.TextOnPath.setPath(this.Pointer,e)}setSize(e,t){hb.Printess.TextOnPath.setSize(this.Pointer,e,t)}setFontSize(e){hb.Printess.TextOnPath.setFontSize(this.Pointer,e)}setStartX(e){hb.Printess.TextOnPath.setStartX(this.Pointer,e)}setHorizontalAlignment(e){hb.Printess.TextOnPath.setHorizontalAlignment(this.Pointer,e)}setDistance(e){hb.Printess.TextOnPath.setDistance(this.Pointer,e)}setDistanceIsPercent(e){hb.Printess.TextOnPath.setDistanceIsPercent(this.Pointer,e)}setHasBoxOpacity(e){hb.Printess.TextOnPath.setHasBoxOpacity(this.Pointer,e)}buildSvg(){return hb.Printess.TextOnPath.buildSvg(this.Pointer)}addStrokeExtents(e){return hb.Printess.TextOnPath.addStrokeExtents(this.Pointer,e)}calculateBounds(){return hb.Printess.TextOnPath.calculateBounds(this.Pointer)}drawImage(e,t){hb.Printess.TextOnPath.drawImage(this.Pointer,e,t)}drawDropShadow(e,t){hb.Printess.TextOnPath.drawDropShadow(this.Pointer,e,t)}drawOuterGlow(e,t){hb.Printess.TextOnPath.drawOuterGlow(this.Pointer,e,t)}drawStroke(e,t){hb.Printess.TextOnPath.drawStroke(this.Pointer,e,t)}}class TextOnPathBindings{constructor(e){this.exports=e}create(){const e=this.exports.asm.TextOnPath_Create();return new TextOnPathWrapper(e)}destroy(e){this.exports.asm.TextOnPath_Destroy(e)}getTransformSetPointer(e){return this.exports.asm.TextOnPath_GetTransformSetPointer(e)}getShapePathPropertiesPointer(e){return this.exports.asm.TextOnPath_GetShapePathPropertiesPointer(e)}getTextPathPropertiesPointer(e){return this.exports.asm.TextOnPath_GetTextPathPropertiesPointer(e)}getEffectsSetPointer(e){return this.exports.asm.TextOnPath_GetEffectsSetPointer(e)}setText(e,t,o){this.exports.asm.TextOnPath_SetText(e,t,o)}setFont(e,t){this.exports.asm.TextOnPath_SetFont(e,t)}setPath(e,t){this.exports.asm.TextOnPath_SetPath(e,t)}setSize(e,t,o){this.exports.asm.TextOnPath_SetSize(e,t,o)}setFontSize(e,t){this.exports.asm.TextOnPath_SetFontSize(e,t)}setStartX(e,t){this.exports.asm.TextOnPath_SetStartX(e,t)}setHorizontalAlignment(e,t){this.exports.asm.TextOnPath_SetHorizontalAlignment(e,t)}setDistance(e,t){this.exports.asm.TextOnPath_SetDistance(e,t)}setDistanceIsPercent(e,t){this.exports.asm.TextOnPath_SetDistanceIsPercent(e,t)}setHasBoxOpacity(e,t){this.exports.asm.TextOnPath_SetHasBoxOpacity(e,t)}buildSvg(e){return this.exports.TextOnPath_BuildSvg(e)}addStrokeExtents(e,t){return this.exports.TextOnPath_AddStrokeExtents(e,t)}calculateBounds(e){return this.exports.TextOnPath_CalculateBounds(e)}drawImage(e,t,o){this.exports.TextOnPath_DrawImage(e,t,o)}drawDropShadow(e,t,o){this.exports.TextOnPath_DrawDropShadow(e,t,o)}drawOuterGlow(e,t,o){this.exports.TextOnPath_DrawOuterGlow(e,t,o)}drawStroke(e,t,o){this.exports.TextOnPath_DrawStroke(e,t,o)}}class GeneralTransformerWrapper{constructor(e){this.Pointer=e,this.TransformSetPointer=hb.Printess.GeneralTransformer.GetTransformSetPointer(this.Pointer),this.ShapePathProperties=this.GetShapePathProperties(),this.EffectsSet=this.getEffectsSet()}GetShapePathProperties(){const e=hb.Printess.GeneralTransformer.GetShapePathPropertiesPointer(this.Pointer);return new PathPropertiesWrapper(e)}getEffectsSet(){const e=hb.Printess.GeneralTransformer.getEffectsSetPointer(this.Pointer);return new EffectsSetWrapper(e)}Destroy(){hb.Printess.GeneralTransformer.Destroy(this.Pointer)}SetPath(e){hb.Printess.GeneralTransformer.SetPath(this.Pointer,e)}SetSize(e,t){hb.Printess.GeneralTransformer.SetSize(this.Pointer,e,t)}SetHasBoxOpacity(e){hb.Printess.GeneralTransformer.SetHasBoxOpacity(this.Pointer,e)}BuildPathSvg(){hb.Printess.GeneralTransformer.BuildPathSvg(this.Pointer);const e=hb.Printess.GeneralTransformer.GetPathSvgByteLength(this.Pointer),t=hb.malloc(e);try{hb.Printess.GeneralTransformer.CopyPathSvgToBuffer(this.Pointer,t);return hb.utf8Decoder.decode(hb.heapu8().slice(t,t+e))}finally{hb.free(t)}}GetAdjustmentTop(){return hb.Printess.GeneralTransformer.GetAdjustmentTop(this.Pointer)}GetAdjustmentLeft(){return hb.Printess.GeneralTransformer.GetAdjustmentLeft(this.Pointer)}GetFinalWidth(){return hb.Printess.GeneralTransformer.GetFinalWidth(this.Pointer)}GetFinalHeight(){return hb.Printess.GeneralTransformer.GetFinalHeight(this.Pointer)}addStrokeExtents(e){return hb.Printess.GeneralTransformer.addStrokeExtents(this.Pointer,e)}calculateBounds(){return hb.Printess.GeneralTransformer.calculateBounds(this.Pointer)}drawImage(e,t){hb.Printess.GeneralTransformer.drawImage(this.Pointer,e,t)}drawDropShadow(e,t){hb.Printess.GeneralTransformer.drawDropShadow(this.Pointer,e,t)}drawOuterGlow(e,t){hb.Printess.GeneralTransformer.drawOuterGlow(this.Pointer,e,t)}drawStroke(e,t){hb.Printess.GeneralTransformer.drawStroke(this.Pointer,e,t)}}class GeneralTransformerBindings{constructor(e){this.exports=e}Create(){const e=this.exports.asm.GeneralTransformer_Create();return new GeneralTransformerWrapper(e)}Destroy(e){this.exports.asm.GeneralTransformer_Destroy(e)}GetTransformSetPointer(e){return this.exports.asm.GeneralTransformer_GetTransformSetPointer(e)}GetShapePathPropertiesPointer(e){return this.exports.asm.GeneralTransformer_GetShapePathPropertiesPointer(e)}getEffectsSetPointer(e){return this.exports.asm.GeneralTransformer_GetEffectsSetPointer(e)}SetPath(e,t){this.exports.asm.GeneralTransformer_SetPath(e,t)}SetSize(e,t,o){this.exports.asm.GeneralTransformer_SetSize(e,t,o)}SetHasBoxOpacity(e,t){this.exports.asm.GeneralTransformer_SetHasBoxOpacity(e,t)}BuildPathSvg(e){this.exports.asm.GeneralTransformer_BuildPathSvg(e)}GetPathSvgByteLength(e){return this.exports.asm.GeneralTransformer_GetPathSvgByteLength(e)}CopyPathSvgToBuffer(e,t){this.exports.asm.GeneralTransformer_CopyPathSvgToBuffer(e,t)}GetAdjustmentTop(e){return this.exports.asm.GeneralTransformer_GetAdjustmentTop(e)}GetAdjustmentLeft(e){return this.exports.asm.GeneralTransformer_GetAdjustmentLeft(e)}GetFinalWidth(e){return this.exports.asm.GeneralTransformer_GetFinalWidth(e)}GetFinalHeight(e){return this.exports.asm.GeneralTransformer_GetFinalHeight(e)}addStrokeExtents(e,t){return this.exports.GeneralTransformer_AddStrokeExtents(e,t)}calculateBounds(e){return this.exports.GeneralTransformer_CalculateBounds(e)}drawImage(e,t,o){this.exports.GeneralTransformer_DrawImage(e,t,o)}drawDropShadow(e,t,o){this.exports.GeneralTransformer_DrawDropShadow(e,t,o)}drawOuterGlow(e,t,o){this.exports.GeneralTransformer_DrawOuterGlow(e,t,o)}drawStroke(e,t,o){this.exports.GeneralTransformer_DrawStroke(e,t,o)}}class FontBindings{constructor(e){this.exports=e}loadFontInfoFromUrl(e){return fetch(e+"?_",{method:"GET",mode:"cors"}).then((e=>e.arrayBuffer().then((e=>this.loadFontInfoFromArrayBuffer(e)))))}loadFontUnicodesFromUrl(e){const t=fontUnicodesCache.get(e);return t?new Promise((e=>e(t))):fetch(e+"?_",{method:"GET",mode:"cors"}).then((t=>t.arrayBuffer().then((t=>{const o=this.loadFontUnicodesFromArrayBuffer(t).filter((e=>parseInt(e.substr(e.length-5,4),16)>32));return fontUnicodesCache.set(e,o),o}))))}loadFontInfoFromArrayBuffer(e){const t=new Uint8Array(e),o=hb.malloc(t.byteLength);try{hb.heapu8().set(t,o);return this.exports.loadFontInfo(o,t.byteLength)}finally{hb.free(o)}}loadFontSvgFromArrayBuffer(e){const t=new Uint8Array(e),o=hb.malloc(t.byteLength);try{hb.heapu8().set(t,o);return this.exports.createFontSvg(o,t.byteLength).svg}finally{hb.free(o)}}loadFontUnicodesFromArrayBuffer(e){const t=new Uint8Array(e),o=hb.malloc(t.byteLength);try{hb.heapu8().set(t,o);const e=this.exports.loadFontUnicodes(o,t.byteLength),i=[];for(let t=0;t<e.size();t++)i.push(e.get(t));return i}finally{hb.free(o)}}}class HelperBindings{constructor(e){this.exports=e}deleteIntArray(e){this.exports.deleteIntArray(e)}deleteUnsignedIntArray(e){this.exports.deleteUnsignedIntArray(e)}}class InMemoryArrays{constructor(){this.inMemory=[],this.inMemoryRgba=[]}}function loadImageToMemory(e,t,o){const i=document.createElement("canvas");try{i.width=t,i.height=o;const r=i.getContext("2d");if(!r)throw"Cannot create canvas context.";r.drawImage(e,0,0,t,o,0,0,t,o);const s=r.getImageData(0,0,t,o),n=hb.calloc(s.data.length,1),a={id:"unknown",address:n,length:s.data.length,width:t,height:o,tookOwnership:!1};return hb.heapu8().set(s.data,n),a}finally{i.width=0,i.height=0}}function loadSvgAsImage(e){return __awaiter$D(this,void 0,void 0,(function*(){const t=new Blob([e],{type:"image/svg+xml"}),o=URL.createObjectURL(t),i=loadImage(o),r=yield i;return i.finally((()=>{URL.revokeObjectURL(o)})),r}))}class Printess{constructor(e){this.Raw=e.asm,this.Exports=e,this.PathProperties=new PathPropertiesBindings(e),this.EffectsSet=new EffectsSetBindings(e),this.OneLineShaper=new OneLineShaperBindings(e),this.TextOnPath=new TextOnPathBindings(e),this.GeneralTransformer=new GeneralTransformerBindings(e),this.Font=new FontBindings(e),this.Helper=new HelperBindings(e)}evaluateResources(e,t){const o=this.Exports.evaluateResources(JSON.stringify(e),t);if(o.errorMessage)throw o.errorMessage;const i=JSON.parse(o.json);i.fonts.push({id:"DEFAULT1",url:"./printess-editor/fonts/NotoSans-Regular.ttf"}),i.fonts.push({id:"DEFAULT2",url:"./printess-editor/fonts/PrintessSummer.ttf"}),i.images.push({id:"printess_sample_mask_image_4711",url:"./printess-editor/img/sample-image-mask.png",imageHint:""}),i.storySvgs=[];for(const t of e.documents)for(const e of t.data.sps)if(e.boxes)for(const t of e.boxes)if(t.data.storySvg){const e=t.data.storySvg;i.storySvgs.push({id:t.id,svg:e})}return i}loadAsDataUrl(e){return __awaiter$D(this,void 0,void 0,(function*(){const t=yield fetch(e+"?_");if(!t.ok)throw new Error("Cannot load: "+t.statusText);const o=yield t.blob();return yield loadBlobAsDataUrl(o)}))}cleanFontName(e){return e.startsWith("'")?this.cleanFontName(e.substr(1)):e.endsWith("'")?this.cleanFontName(e.substr(0,e.length-1)):e}findFontFamilies(e){const t=new RegExp("font-family:\\s*(.+?)\\s*;","g"),o=new Set;let i=null;for(;null!==(i=t.exec(e));)o.add(i[1]);return Array.from(o)}loadFonts(e){return __awaiter$D(this,void 0,void 0,(function*(){const t=[];for(let o=0;o<e.length;o++){const i=this.cleanFontName(e[o]),r=scope().fonts_getByName(i);if(r){const i=yield this.loadAsDataUrl(r.url);t.push({family:e[o],dataUrl:i,url:r.url})}}return t}))}embedFonts(e){return __awaiter$D(this,void 0,void 0,(function*(){const t=-1===e.indexOf("xmlns")?e.replace("<svg ",'<svg xmlns="http://www.w3.org/2000/svg" '):e,o=this.findFontFamilies(e),i=(yield this.loadFonts(o)).map((e=>`@font-face {\n font-family: ${e.family};\n src: url("${e.dataUrl}");\n }\n`)).join("\n"),r=t.indexOf(">",t.indexOf("<svg"));return t.substr(0,r+1)+"<defs><style>"+i+"</style></defs>"+t.substr(r+1)}))}parseIntAttribute(e,t,o){const i=new RegExp(t+"=(\"|'|)(\\d+)\\1").exec(e);return i?parseInt(i[2],10):o}parseFloatAttribute(e,t,o){const i=new RegExp(t+"=(\"|'|)(\\d+(\\.\\d+)?)\\1").exec(e);return i?parseFloat(i[2]):o}parseSvgWidthHeight(e){const t=e.indexOf(">",e.indexOf("<svg")),o=e.substring(0,t+1);return{width:this.parseFloatAttribute(o,"width",200),height:this.parseFloatAttribute(o,"height",200)}}addInMemorySvg(e,t,o,i){return __awaiter$D(this,void 0,void 0,(function*(){const r=yield this.embedFonts(t),s=this.parseSvgWidthHeight(r),n=yield loadSvgAsImage(r),a=yield loadImageToMemory(n,s.width,s.height);o.push(a.address),a.id=e,i.push(a)}))}downloadEvaluatedResources(e){return __awaiter$D(this,void 0,void 0,(function*(){const t=new InMemoryArrays,o=[],i=createPrintessApiFromExternalConfig(),r=(e,i,r)=>__awaiter$D(this,void 0,void 0,(function*(){const s=yield downloadBytes(i),n=hb.calloc(s.length,1);o.push(n),t.inMemory.push({id:e,resourceType:r,length:s.length,address:n,tookOwnership:!1}),hb.heapu8().set(s,n)}));try{for(const i of e.images)if(""==i.imageHint)yield r(i.id,i.url,1);else{if("svg"!=i.imageHint)throw"Unknown image hint.";{const e=yield downloadString(i.url);yield this.addInMemorySvg(i.id,e,o,t.inMemoryRgba)}}for(const t of e.fonts)yield r(t.id,t.url,2);for(const i of e.storySvgs)yield this.addInMemorySvg(i.id,i.svg,o,t.inMemoryRgba);for(const r of e.barcodes){const e=r.properties?JSON.parse(r.properties):void 0,s=yield i.renderSvgBarcode(r.symbology,r.text,r.width,r.height,r.unit,r.color,e);yield this.addInMemorySvg(r.id,s,o,t.inMemoryRgba)}}catch(e){throw o.forEach((e=>hb.free(e))),console.error(e),alert(e),e}return t}))}renderDocumentImagesAsInMemoryData(e,t,o,i,r){return __awaiter$D(this,void 0,void 0,(function*(){const s=e.documents.find((e=>e.data.na===t));if(!s)throw"Document "+t+" not found.";const n=this.evaluateResources(e,t),a=yield this.downloadEvaluatedResources(n),l=[],c=n.documents.map((e=>e.id)),d=e.documents;e.documents=e.documents.filter((e=>-1!==c.indexOf(e.id)));const h=this.renderDocumentImagesForDocument(a,e,s,o,i,r);try{for(let e=0;e<h.size();e++)l.push(h.get(e))}finally{h.delete(),e.documents=d}return l}))}renderDocumentImagesAsDataUrl(e,t,o,i,r){return __awaiter$D(this,void 0,void 0,(function*(){const s=yield this.renderDocumentImagesAsInMemoryData(e,t,o,i,r),n=[];for(let e=0;e<s.length;e++){const t=s[e],o=new Uint8Array(hb.heapu8().buffer,t.address,t.length);try{const e=new Blob([o]),i=yield loadBlobAsDataUrl(e);n.push(i)}finally{hb.free(t.address)}}return n}))}renderDocumentImagesForDocument(e,t,o,i,r,s){const n=createOrGetWebGlCanvas(o.data.pw,o.data.ph),a=JSON.stringify(t),l=new this.Exports.VectorInMemoryData,c=new this.Exports.VectorInMemoryRgbaData;try{e.inMemory.forEach((e=>l.push_back(e))),e.inMemoryRgba.forEach((e=>c.push_back(e)));return this.Exports.renderDocumentImage(l,c,a,o.data.na,n.surface,i,r,s)}finally{l.delete(),c.delete()}}renderSubDocumentImageCore(e,t,o,i){const r=createOrGetWebGlCanvas(o.data.pw,o.data.ph),s=JSON.stringify(t),n=new this.Exports.VectorInMemoryData,a=new this.Exports.VectorInMemoryRgbaData;try{e.inMemory.forEach((e=>n.push_back(e))),e.inMemoryRgba.forEach((e=>a.push_back(e)));return this.Exports.renderSubDocumentImage(n,a,s,o.data.na,i,r.surface)}finally{n.delete(),a.delete()}}renderSubDocumentImage(e,t,o){return __awaiter$D(this,void 0,void 0,(function*(){const i=e.documents.find((e=>e.data.na===t));if(!i)throw"Document "+t+" not found.";const r=this.evaluateResources(e,t),s=yield this.downloadEvaluatedResources(r),n=r.documents.map((e=>e.id));e.documents=e.documents.filter((e=>-1!==n.indexOf(e.id)));return this.renderSubDocumentImageCore(s,e,i,o)}))}renderSubDocumentImageAsDataUrl(e,t,o){return __awaiter$D(this,void 0,void 0,(function*(){const i=yield this.renderSubDocumentImage(e,t,o);if(0!=i.data)try{const e=new Uint8Array(hb.heapu8().buffer,i.data,i.size),t=new Blob([e],{type:"image/png"});return{dataUrl:yield loadBlobAsDataUrl(t),x:i.x,y:i.y}}finally{hb.free(i.data)}return{dataUrl:"",x:0,y:0}}))}findDocument(e,t){const o=e.documents.find((e=>e.data.na===t));if(!o)throw"Document "+t+" not found.";return o}keepOnlyUsedDocuments(e,t){const o=JSON.parse(JSON.stringify(e)),i=t.documents.map((e=>e.id));return o.documents=o.documents.filter((e=>-1!==i.indexOf(e.id))),removeUnusedStories(o),o}renderAllSnippets(e,t){return __awaiter$D(this,void 0,void 0,(function*(){const o=[],i=e.documents.filter((e=>e.data.ils||e.data.igs)),r=2*i.length;let s=0;for(let n=0;n<i.length;n++){const a=i[n],l=this.evaluateResources(e,a.data.na),c=yield this.downloadEvaluatedResources(l),d=this.keepOnlyUsedDocuments(e,l);s++,t&&t(s/r);const h=yield this.uploadSnippets(c,d,a);s++,t&&t(s/r),h.forEach((e=>o.push(e)))}return t&&t(1),o}))}loadSnippetTags(e){return __awaiter$D(this,void 0,void 0,(function*(){const t=createPrintessApiFromExternalConfig();return yield t.loadSnippetTags(e)}))}loadSnippets(e,t,o){return __awaiter$D(this,void 0,void 0,(function*(){const i=createPrintessApiFromExternalConfig();return yield i.loadSnippets(e,t,o)}))}getCssColor(e){if(e){return new ColorRef("____noid",e).toCssColor()}return"rgb(255,255,255)"}uploadSnippets(e,t,o){return __awaiter$D(this,void 0,void 0,(function*(){const i=[],r=JSON.stringify(t),s=this.renderDocumentImagesForDocument(e,t,o,200,200,!0);try{const e=createPrintessApiFromExternalConfig();for(let n=0;n<s.size();n++){const a=s.get(n),l=new Uint8Array(hb.heapu8().buffer,a.address,a.length);try{const s=new FormData;s.append("scopeId",t.template.scopeId),s.append("documentId",o.id),s.append("title",o.data.snl||o.data.na),s.append("backgroundColor",this.getCssColor(o.data.bg)),s.append("isLayoutSnippet",o.data.ils?"true":"false"),s.append("isGroupSnippet",o.data.igs?"true":"false"),s.append("tags",JSON.stringify(o.data.snt)),s.append("json",new Blob([r],{type:"application/json"})),s.append("image",new Blob([l]));const n=yield e.uploadSnippet(s);i.push(n)}finally{hb.free(a.address)}}return i}finally{s.delete()}}))}}class HarfBuzzExports{constructor(e){let t="";this.utf8Encoder=new TextEncoder,this.utf8Decoder=new TextDecoder,t="_",this.heapu8=function(){return e.HEAPU8},this.heapu32=function(){return e.HEAPU32},this.heapi32=function(){return e.HEAP32},this.heapf32=function(){return e.HEAPF32},this.free_ptr=e._free,this.create_spline_mesh=e._create_spline_mesh,this.mesh_has_overflow=e._mesh_has_overflow,this.mesh_result_width=e._mesh_result_width,this.mesh_result_height=e._mesh_result_height,this.mesh_result_top=e._mesh_result_top,this.mesh_result_left=e._mesh_result_left,this.mesh_transform=e._mesh_transform,this.malloc=e._malloc,this.calloc=e._calloc,this.free=e._free,this.hb_blob_destroy=e._hb_blob_destroy,this.hb_blob_create=e._hb_blob_create,this.hb_face_create=e._hb_face_create,this.hb_face_get_upem=e._hb_face_get_upem,this.hb_face_destroy=e._hb_face_destroy,this.hb_font_create=e._hb_font_create,this.hb_font_set_scale=e._hb_font_set_scale,this.hb_font_destroy=e._hb_font_destroy,this.hb_buffer_create=e._hb_buffer_create,this.hb_buffer_add_utf8=e._hb_buffer_add_utf8,this.hb_buffer_guess_segment_properties=e._hb_buffer_guess_segment_properties,this.hb_buffer_set_direction=e._hb_buffer_set_direction,this.hb_shape=e._hb_shape,this.hb_buffer_get_length=e._hb_buffer_get_length,this.hb_buffer_get_glyph_infos=e._hb_buffer_get_glyph_infos,this.hb_buffer_get_glyph_positions=e._hb_buffer_get_glyph_positions,this.hb_buffer_destroy=e._hb_buffer_destroy,this.hb_font_get_glyph_extents=e._hb_font_get_glyph_extents,this.hb_font_get_h_extents=e._hb_font_get_h_extents,this.hbjs_add_glyph_path=e._hbjs_add_glyph_path,this.hbjs_create_svg_path=e._hbjs_create_svg_path,this.path_create=e._path_create,this.path_destroy=e._path_destroy,this.path_move_to=e._path_move_to,this.path_line_to=e._path_line_to,this.path_cubic_to=e._path_cubic_to,this.path_close=e._path_close,this.create_sine_transformer=e._create_sine_transformer,this.create_cosine_transformer=e._create_cosine_transformer,this.create_parable_transformer=e._create_parable_transformer,this.create_inverse_parable_transformer=e._create_inverse_parable_transformer,this.create_arc_transformer=e.create_arc_transformer,this.create_cup_transformer=e._create_cup_transformer,this.create_turbulence_transformer=e._create_turbulence_transformer,this.create_mesh_transformer=e._create_mesh_transformer,this.transform_points=e._transform_points,this.one_line_set_alignment=e._one_line_set_alignment,this.one_line_set_is_image_mask=e._one_line_set_is_image_mask,this.one_line_build_svg=e._one_line_build_svg,this.one_line_get_adjustment_top=e._one_line_get_adjustment_top,this.one_line_get_adjustment_left=e._one_line_get_adjustment_left,this.one_line_get_adjustment_width=e._one_line_get_adjustment_width,this.one_line_get_adjustment_height=e._one_line_get_adjustment_height,this.one_line_get_is_mask_even_odd=e._one_line_get_is_mask_even_odd,this.one_line_get_is_fill_even_odd=e._one_line_get_is_fill_even_odd,this.one_line_get_is_stroke_even_odd=e._one_line_get_is_stroke_even_odd,this.general_transformer_transform_points=e._general_transformer_transform_points,this.general_transformer_get_adjustment_top=e._general_transformer_get_adjustment_top,this.general_transformer_get_adjustment_left=e._general_transformer_get_adjustment_left,this.transform_set_create=e._transform_set_create,this.transform_set_set_taper_transform=e._transform_set_set_taper_transform,this.transform_set_set_top_transformer=e._transform_set_set_top_transformer,this.transform_set_set_bottom_transformer=e._transform_set_set_bottom_transformer,this.transform_set_set_top_fish_transformer=e._transform_set_set_top_fish_transformer,this.transform_set_set_bottom_fish_transformer=e._transform_set_set_bottom_fish_transformer,this.transform_set_set_top_flag_transformer=e._transform_set_set_top_flag_transformer,this.transform_set_set_bottom_flag_transformer=e._transform_set_set_bottom_flag_transformer,this.transform_set_set_top_arc_transformer=e._transform_set_set_top_arc_transformer,this.transform_set_set_bottom_arc_transformer=e._transform_set_set_bottom_arc_transformer,this.transform_set_set_top_pit_transformer=e._transform_set_set_top_pit_transformer,this.transform_set_set_bottom_pit_transformer=e._transform_set_set_bottom_pit_transformer,this.transform_set_set_arch_transformer=e._transform_set_set_arch_transformer,this.transform_set_set_cup_transformer=e._transform_set_set_cup_transformer,this.transform_set_set_turbulence_transformer=e._transform_set_set_turbulence_transformer,this.transform_set_set_mesh_transformer=e._transform_set_set_mesh_transformer,this.transform_set_transform_image=e._transform_set_transform_image,this.image_test=e._image_test,this.fall19=e,this.Printess=new Printess(e)}}let hb;class CString{constructor(e){const t=hb.utf8Encoder.encode(e);this.ptr=hb.malloc(t.byteLength),hb.heapu8().set(t,this.ptr),this.length=t.byteLength}destroy(){hb.free(this.ptr)}}class HarfBuzzBlob{constructor(e){const t=hb.malloc(e.length);hb.heapu8().set(e,t),this.ptr=hb.hb_blob_create(t,e.byteLength,2,t,hb.free_ptr())}destroy(){hb.hb_blob_destroy(this.ptr)}}class HarfBuzzFace{constructor(e,t){this.ptr=hb.hb_face_create(e.ptr,t)}getUnitsPerEM(){return hb.hb_face_get_upem(this.ptr)}destroy(){hb.hb_face_destroy(this.ptr)}}class HarfBuzzFont{constructor(e){this.ptr=hb.hb_font_create(e.ptr),this.unitsPerEM=e.getUnitsPerEM()}setScale(e,t){hb.hb_font_set_scale(this.ptr,e,t)}getFontExtents(){const e=hb.malloc(48);hb.hb_font_get_h_extents(this.ptr,e);const t=e/4,o=new FontExtents(hb.heapi32()[t],hb.heapi32()[t+1],hb.heapi32()[t+2]);return hb.free(e),o}getGylphExtents(e){const t=hb.malloc(64);hb.hb_font_get_glyph_extents(this.ptr,e,t);const o=t/4,i=new GlyphExtents(hb.heapi32()[o],hb.heapi32()[o+1],hb.heapi32()[o+2],hb.heapi32()[o+3]);return hb.free(t),i}destroy(){hb.hb_font_destroy(this.ptr)}}class GlyphInformation{constructor(e,t,o,i,r,s){this.GlyphId=e,this.Cluster=t,this.XAdvance=o,this.YAdvance=i,this.XOffset=r,this.YOffset=s}}class GlyphExtents{constructor(e,t,o,i){this.XBearing=e,this.YBearing=t,this.Width=o,this.Height=i}}class FontExtents{constructor(e,t,o){this.Ascender=e,this.Descender=t,this.LineGap=o}}class HarfBuzzBuffer{constructor(){this.ptr=hb.hb_buffer_create()}addText(e){const t=new CString(e);hb.hb_buffer_add_utf8(this.ptr,t.ptr,t.length,0,t.length),t.destroy()}guessSegmentProperties(){hb.hb_buffer_guess_segment_properties(this.ptr)}setDirection(e){const t={ltr:4,rtl:5,ttb:6,btt:7}[e];hb.hb_buffer_set_direction(this.ptr,t)}shape(e){hb.hb_shape(e.ptr,this.ptr,0,0)}json(){const e=hb.hb_buffer_get_length(this.ptr),t=new Array,o=hb.hb_buffer_get_glyph_infos(this.ptr,0)/4,i=hb.hb_buffer_get_glyph_positions(this.ptr,0)/4,r=hb.heapu32().slice(o,o+5*e),s=hb.heapi32().slice(i,i+5*e);for(let o=0;o<e;++o)t.push(new GlyphInformation(r[5*o+0],r[5*o+2],s[5*o+0],s[5*o+1],s[5*o+2],s[5*o+3]));return t}destroy(){hb.hb_buffer_destroy(this.ptr)}}const fontUnicodesCache=new Map,ShapeCache=new Map;function shape(e,t){let o=ShapeCache.get(t);o||(o=new Map,ShapeCache.set(t,o));let i=o.get(e);if(!i){const r=new HarfBuzzBuffer;r.addText(e),r.guessSegmentProperties(),r.shape(t),i=r.json(),r.destroy(),o.set(e,i)}return i}function assertNever(e,t){if(t)return e;throw new Error(`Unhandled discriminated union member: ${JSON.stringify(e)}`)}function transformPoints(e,t,o,i){const r=[];t.forEach((e=>{r.push(e.x),r.push(e.y)}));const s=new Float32Array(r),n=hb.malloc(4*s.length),a=hb.malloc(4*s.length);hb.heapf32().set(s,n/4),hb.transform_points(e,o,i,n,a,t.length);const l=hb.heapf32().slice(a/4,a/4+r.length),c=[];for(let e=0;e<t.length;e++){const t=l[2*e],o=l[2*e+1];c.push({x:t,y:o})}return hb.free(n),hb.free(a),c}function transformMeshPoints(e,t,o,i){const r=[];e.points.forEach((e=>{r.push(e.x),r.push(e.y)}));const s=new Float32Array(r),n=hb.malloc(4*s.length);hb.heapf32().set(s,n/4);const a=hb.create_mesh_transformer(e.cols,e.rows,n,2),l=transformPoints(a,t,o,i);return hb.free(a),hb.free(n),l}function scaleTaperTransform(e,t,o){return e?{topLeft:{x:e.topLeft.x*t,y:e.topLeft.y*o},topRight:{x:e.topRight.x*t,y:e.topRight.y*o},bottomLeft:{x:e.bottomLeft.x*t,y:e.bottomLeft.y*o},bottomRight:{x:e.bottomRight.x*t,y:e.bottomRight.y*o}}:null}function createTopBottomTransfomer(e,t){if(!e)return null;let o;switch(e.transform){case"sine":return o=hb.create_sine_transformer(e.heightFraction,e.waves,e.phase),t.push((()=>hb.Printess.Raw.delete_sine_transformer(o))),o;case"cosine":return o=hb.create_cosine_transformer(e.heightFraction,e.waves,e.phase),t.push((()=>hb.Printess.Raw.delete_cosine_transformer(o))),o;case"parabel":return o=hb.create_parable_transformer(e.heightFraction),t.push((()=>hb.Printess.Raw.delete_parable_transformer(o))),o;case"inverseparabel":return o=hb.create_inverse_parable_transformer(e.heightFraction),t.push((()=>hb.Printess.Raw.delete_inverse_parable_transformer(o))),o}return null}function createPath(e,t,o,i){const r=hb.path_create(),s=.01*e,n=.01*t;return o.forEach((e=>{switch(e.t){case"M":hb.path_move_to(r,e.x*s,e.y*n);break;case"L":hb.path_line_to(r,e.x*s,e.y*n);break;case"C":hb.path_cubic_to(r,e.x1*s,e.y1*n,e.x2*s,e.y2*n,e.x*s,e.y*n)}})),!0===i&&hb.path_close(r),r}function getColor(e){let t=e.toLowerCase();if("transparent"===t)return{a:0,r:0,g:0,b:0};if(t.startsWith("#")){let e=255,o=0,i=0,r=0;switch(t.length){case 9:e=parseInt(t.slice(7,9),16),o=parseInt(t.slice(1,3),16),i=parseInt(t.slice(3,5),16),r=parseInt(t.slice(5,7),16);break;case 7:o=parseInt(t.slice(1,3),16),i=parseInt(t.slice(3,5),16),r=parseInt(t.slice(5,7),16);break;case 5:e=17*parseInt(t.slice(4,5),16),o=17*parseInt(t.slice(1,2),16),i=17*parseInt(t.slice(2,3),16),r=17*parseInt(t.slice(3,4),16);break;case 4:o=17*parseInt(t.slice(1,2),16),i=17*parseInt(t.slice(2,3),16),r=17*parseInt(t.slice(3,4),16)}return{a:e,r:o,g:i,b:r}}if(t.startsWith("rgba")){t=t.slice(5,-1);const e=t.split(",");return{a:255*+e[3],r:+e[0],g:+e[1],b:+e[2]}}if(t.startsWith("rgb")){t=t.slice(4,-1);const e=t.split(",");return{a:255,r:+e[0],g:+e[1],b:+e[2]}}return{a:255,r:0,g:0,b:0}}function getStrokeWidth(e){return-1!==e.indexOf("%")?{width:parseFloat(e.replace("%","")),isPercent:!0}:{width:parseFloat(e.replace("px","")),isPercent:!1}}function getStrokePosition(e){switch(e){case"center":return 0;case"outside":return 1;case"inside":return 2;default:assertNever(e)}}function getStrokeJoin(e){switch(e){case"miter":return 0;case"round":return 1;case"bevel":return 2;default:assertNever(e)}}function getStrokeCap(e){switch(e){case"butt":return 0;case"round":return 1;case"projecting":return 2;default:assertNever(e)}}function getPathStyle(e){switch(e){case"solid":return 0;case"dotted":return 1;case"dashed n":return 2;case"dashed 1":return 11;case"dashed 2":return 12;case"dashed 3":return 13;case"dashed 4":return 14;case"dashed 5":return 15;case"dashed 6":return 16;default:assertNever(e)}}function setAbsoluteTopLeftBlend(e,t,o,i){e.style.position="absolute",e.style.left=o,e.style.top=t,e.style.setProperty("mix-blend-mode",i)}class EffectsSet{constructor(){this.hueRotateAngleInDegrees=0,this.saturation=1,this.brightness=1,this.grayscale=0,this.sepia=0,this.contrast=1,this.invert=0,this.innerShadowArea="combined",this.innerGlowArea="combined"}hasHueRotate(){return this.hueRotateAngleInDegrees>0}hasSepia(){return this.sepia>0}hasGrayscale(){return this.grayscale>0}hasSaturation(){return 1!==this.saturation}hasBrightness(){return 1!==this.brightness}hasContrast(){return 1!==this.contrast}hasInvert(){return this.invert>0}hasLevels(){return this.hasHueRotate()||this.hasSepia()||this.hasGrayscale()||this.hasSaturation()||this.hasBrightness()||this.hasContrast()||this.hasInvert()}hasShadows(){return this.isInnerGlowActive||this.isInnerShadowActive||this.isDropShadowActive||this.isOuterGlowActive}resultsInVector(){return!(this.isTurbulenceActive||this.isBlurActive||this.isBevelActive||this.isInnerGlowActive||this.isInnerShadowActive)}resultsInMaskAsVector(){return!(this.isTurbulenceActive||this.isBlurActive)}hasOuterEffect(){return this.isDropShadowActive||this.isOuterGlowActive||this.isStrokeEffectActive}anyActive(){return this.isBlurActive||this.isBevelActive||this.isTurbulenceActive||this.hasShadows()||this.hasLevels()}setValues(e){this.isBlurActive&&e.setBlur(this.blurRadius),this.isDropShadowActive&&e.setDropShadow(this.dropShadowBlendMode,this.dropShadowOffsetX,this.dropShadowOffsetY,this.dropShadowBlurRadius,this.dropShadowSpreadRadius,getColor(this.dropShadowColor)),this.isOuterGlowActive&&e.setOuterGlow(this.outerGlowBlendMode,this.outerGlowOffsetX,this.outerGlowOffsetY,this.outerGlowBlurRadius,this.outerGlowSpreadRadius,getColor(this.outerGlowColor)),this.isInnerShadowActive&&e.setInnerShadow(this.innerShadowBlendMode,this.innerShadowOffsetX,this.innerShadowOffsetY,this.innerShadowBlurRadius,this.innerShadowSpreadRadius,getColor(this.innerShadowColor)),this.isInnerGlowActive&&e.setInnerGlow(this.innerGlowBlendMode,this.innerGlowOffsetX,this.innerGlowOffsetY,this.innerGlowBlurRadius,this.innerGlowSpreadRadius,getColor(this.innerGlowColor)),this.isStrokeEffectActive&&e.setStroke(this.strokeEffectBlendMode,this.strokeEffectOffsetX,this.strokeEffectOffsetY,this.strokeEffectBlurRadius,this.strokeEffectSpreadRadius,getColor(this.strokeEffectColor)),this.isTurbulenceActive&&e.setPerlinNoise(this.turbulenceFrequency/100,this.turbulenceFrequency/100,this.turbulenceOctaves,this.turbulenceScale),this.isBevelActive&&e.setBevel(this.bevelBlur,this.bevelPointLightX,this.bevelPointLightY,this.bevelPointLightZ,this.bevelSurfaceScale,this.bevelSpecularConstant,this.bevelSpecularExponent,getColor("#ffffff"),getColor("#ffffff")),this.hasHueRotate()&&e.setHueRotate(this.hueRotateAngleInDegrees),this.hasSepia()&&e.setSepia(this.sepia),this.hasGrayscale()&&e.setGrayscale(this.grayscale),this.hasBrightness()&&e.setBrightness(this.brightness),this.hasSaturation()&&e.setSaturation(this.saturation),this.hasContrast()&&e.setContrast(this.contrast),this.hasInvert()&&e.setInvert(this.invert),e.setInnerEffectAreas(this.innerShadowArea,this.innerGlowArea)}}class PathDefinedImage{constructor(){this.imageWidthScale=1,this.imageHeightScale=1,this.imageXPosition=1,this.imageYPosition=1,this.imageWidth=100,this.imageHeight=100}}class OneLineShaper{constructor(e,t,o,i,r,s,n,a,l,c,d,h,p){this.useWinAscender=!1,this.effects=new EffectsSet,this.effectImage=null,this.maskImage=new PathDefinedImage,this.Text=e,this.Font=t,this.Width=o,this.Height=i,this.HorizontalTextAlignment=r,this.VerticalTextAlignment=s,this.StrokeWidth=n,this.StrokeColor=a,this.FillColor=l,this.StrokeAlign=c,this.StrokeJoin=d,this.strokeType=h,this.IsImageMask=p,this.WarpTransform=null,this.TaperTransform=null,this.MeshTransform=null,this.adjustmentTop=0,this.adjustmentLeft=0,this.adjustmentBottom=0,this.adjustmentRight=0,this.isMaskEvenOdd=!1,this.isStrokeEvenOdd=!1,this.isFillEvenOdd=!1}getHash(){return JSON.stringify(this,((e,t)=>{if(-1===["adjustmentTop","adjustmentLeft","adjustmentBottom","adjustmentRight","isMaskEvenOdd","isStrokeEvenOdd","isFillEvenOdd"].indexOf(e))return"number"==typeof t?t.toFixed(4):t}))}ScaledTaperTransform(){return scaleTaperTransform(this.TaperTransform,this.Width,this.Height)}getHorizontalAlignment(){switch(this.HorizontalTextAlignment){case"left":return 0;case"center":return 1;case"right":return 2;default:assertNever(this.HorizontalTextAlignment)}}getVerticalAlignment(){switch(this.VerticalTextAlignment){case"top":return 0;case"center":return 1;case"centerBaseline":return 2;case"bottom":return 3;case"bottomBaseline":return 4;default:assertNever(this.VerticalTextAlignment)}}createShaper(e){const t=hb.Printess.OneLineShaper.create();e.push((()=>t.destroy()));const o=new CString(this.Text);e.push((()=>o.destroy()));const i=getStrokeWidth(this.StrokeWidth),r=getColor(this.StrokeColor),s=getColor(this.FillColor);t.setText(o.ptr,o.length),t.setTextBefore(this.textBefore),t.setTextAfter(this.textAfter),t.setFont(this.Font.ptr),t.setSize(this.Width,this.Height),t.setAlignment(this.getHorizontalAlignment(),this.getVerticalAlignment()),t.setPadding(this.paddingTop,this.paddingLeft,this.paddingBottom,this.paddingRight),t.setStretch(this.minLetterSpacing,this.maxLetterSpacing,this.minLetterWidth,this.maxLetterWidth),t.setUseFontMetrics(this.useFontMetrics),t.setUseWinAscender(this.useWinAscender),this.applyMaximumFontSize&&t.setMaximumFontSize(this.maximumFontSize),t.TextPathProperties.SetStrokeWidth(i.width),t.TextPathProperties.SetIsStrokeWidthPercent(i.isPercent),t.TextPathProperties.SetFillColorArgb(s),t.TextPathProperties.SetStrokeColorArgb(r),t.TextPathProperties.SetStrokePosition(getStrokePosition(this.StrokeAlign)),t.TextPathProperties.SetStrokeJoin(getStrokeJoin(this.StrokeJoin)),t.TextPathProperties.SetStrokeType(getPathStyle(this.strokeType)),t.TextPathProperties.SetDashGap(this.dash1,this.gap1),t.TextPathProperties.SetIsImageMask(this.IsImageMask),this.effects.setValues(t.EffectsSet);const n=new TransformSet(t.TransformSetPointer,this.ScaledTaperTransform(),this.WarpTransform,this.MeshTransform);return e.push((()=>n.delete())),t}buildSvg(){const e=[];try{const t=this.createShaper(e).buildSvg();return this.adjustmentTop=t.top,this.adjustmentLeft=t.left,this.adjustmentRight=this.Width-t.width-this.adjustmentLeft,this.adjustmentBottom=this.Height-t.height-this.adjustmentTop,this.isMaskEvenOdd=t.isMaskEvenOdd,this.isFillEvenOdd=t.isFillEvenOdd,this.isStrokeEvenOdd=t.isStrokeEvenOdd,t.svg}finally{e.forEach((e=>e()))}}buildSvgDto(){const e=[];try{return this.createShaper(e).buildSvg()}finally{e.forEach((e=>e()))}}buildImage(e){return __awaiter$D(this,void 0,void 0,(function*(){const t=[];try{const o=this.createShaper(t),i=o.calculateBounds(),r=o.addStrokeExtents(i),s=o.EffectsSet.calculateBounds(r.width,r.height),n={x:s.x,y:s.y,width:s.width,height:s.height};n.x<0&&(s.width-=n.x,s.x-=n.x,n.x=0);let a=0,l=0,c=0;if(e){const o=this.Width*this.maskImage.imageWidthScale/this.maskImage.imageWidth,r=this.maskImage.imageXPosition*this.Width/-o,n=r+this.maskImage.imageWidth/this.maskImage.imageWidthScale,d=r,h=n-r,p=this.Height*this.maskImage.imageHeightScale/this.maskImage.imageHeight,u=this.maskImage.imageYPosition*this.Height/-p,m=u+this.maskImage.imageHeight/this.maskImage.imageHeightScale,f=u,g=m-u,y=Math.max(-i.y,0),b=Math.max(s.height-this.Height-y,0),v=this.Width,x=this.Height+y+b,w=document.createElement("canvas");w.width=v,w.height=x;const _=w.getContext("2d");if(_){const o=yield loadImage(e);console_log("source width="+h+", height="+(g+y+b)+", x="+d+", y="+(f-y)),console_log("destination width="+v+", height="+x),_.drawImage(o,d,f-y,h,g+y+b,0,0,v,x);const i=_.getImageData(0,0,w.width,w.height);a=hb.calloc(i.data.length,1),l=w.width,c=w.height,hb.heapu8().set(i.data,a),t.push((()=>hb.free(a)))}w.width=0,w.height=0}console_log("bounds width="+s.width+", height="+s.height+", x="+s.x+", y="+s.y),console_log("position width="+n.width+", height="+n.height+", x="+n.x+", y="+n.y);const d=createOrGetWebGlCanvas(s.width,s.height),h={width:s.width,height:s.height,left:s.x-i.x,top:s.y-i.y,div:document.createElement("div"),dropShadowDataUrl:null,outerGlowDataUrl:null,strokeDataUrl:null,imageDataUrl:null,dropShadowElement:null,outerGlowElement:null,strokeElement:null,imageElement:null};{const e=new Image;o.drawImage(d.surface,n,a,l,c),h.imageDataUrl=d.createDataUrl(),e.src=h.imageDataUrl,e.style.top="0",e.style.left="0",e.style.position="absolute",h.imageElement=e}if(this.effects.isDropShadowActive){const e=new Image;o.drawDropShadow(d.surface,n),h.dropShadowDataUrl=d.createDataUrl(),e.src=h.dropShadowDataUrl,e.style.top="0",e.style.left="0",e.style.position="absolute",e.style.setProperty("mix-blend-mode",this.effects.dropShadowBlendMode),h.div.appendChild(e),h.dropShadowElement=e}if(this.effects.isOuterGlowActive){const e=new Image;o.drawOuterGlow(d.surface,n),h.outerGlowDataUrl=d.createDataUrl(),e.src=h.outerGlowDataUrl,e.style.top="0",e.style.left="0",e.style.position="absolute",e.style.setProperty("mix-blend-mode",this.effects.outerGlowBlendMode),h.div.appendChild(e),h.outerGlowElement=e}if(this.effects.isStrokeEffectActive){const e=new Image;o.drawStroke(d.surface,n),h.strokeDataUrl=d.createDataUrl(),e.src=h.strokeDataUrl,e.style.top="0",e.style.left="0",e.style.position="absolute",e.style.setProperty("mix-blend-mode",this.effects.strokeEffectBlendMode),h.div.appendChild(e),h.strokeElement=e}return h.imageElement&&h.div.appendChild(h.imageElement),this.adjustmentTop=-h.top,this.adjustmentLeft=-h.left,this.adjustmentRight=this.Width-s.width-this.adjustmentLeft,this.adjustmentBottom=this.Height-s.height-this.adjustmentTop,h}finally{t.forEach((e=>e()))}}))}}class WebGlSurface{constructor(){this.canvas=document.createElement("canvas"),this.canvas.width=100,this.canvas.height=100,this.canvas.style.position="absolute",this.surface=hb.Printess.Exports.MakeWebGLCanvasSurface(this.canvas)}adjustSize(e,t){hb.Printess.Exports.makeContextCurrent(this.canvas),this.canvas.style.left="0px",this.canvas.style.top="0px",this.canvas.width==e&&this.canvas.height==t||(this.canvas.width=e,this.canvas.height=t,this.surface=hb.Printess.Exports.MakeOnScreenGLSurface(this.canvas.grContext,e,t))}createDataUrl(){return this.canvas.toDataURL()}}let memoizedWebGlSurface;function createOrGetWebGlCanvas(e,t){return memoizedWebGlSurface.adjustSize(e,t),memoizedWebGlSurface}class TextOnPathShaper{constructor(e,t,o,i,r,s,n,a,l,c,d,h,p,u,m,f,g,y,b,v,x,w,_){this.effects=new EffectsSet,this.Path=e,this.IsClosedPath=t,this.Text=o,this.Font=i,this.FontSize=r,this.Width=s,this.Height=n,this.HorizontalTextAlignment=a,this.StartX=l,this.Distance=w,this.hasBoxOpacity=_,this.TextStrokeWidth=c,this.TextStrokeColor=d,this.TextFillColor=h,this.TextStrokeAlign=p,this.TextStrokeJoin=u,this.ShapeStrokeWidth=m,this.ShapeStrokeColor=f,this.ShapeFillColor=g,this.ShapeStrokeAlign=y,this.ShapeStrokeJoin=b,this.ShapeStrokeCap=v,this.ShapeIsImageMask=x,this.TaperTransform=null,this.MeshTransform=null,this.WarpTransform=null,this.adjustmentTop=0,this.adjustmentLeft=0,this.adjustmentBottom=0,this.adjustmentRight=0}getHash(){return JSON.stringify(this,((e,t)=>{if(-1===["adjustmentTop","adjustmentLeft","adjustmentBottom","adjustmentRight"].indexOf(e))return t}))}ScaledTaperTransform(){return scaleTaperTransform(this.TaperTransform,this.Width,this.Height)}getHorizontalAlignment(){switch(this.HorizontalTextAlignment){case"left":return 0;case"center":return 1;case"right":return 2;case"useStartX":return 3;default:assertNever(this.HorizontalTextAlignment)}}createShaper(e,t=!1){const o=hb.Printess.TextOnPath.create();e.push((()=>o.destroy()));const i=new CString(this.Text);e.push((()=>i.destroy()));const r=getStrokeWidth(this.Distance),s=getStrokeWidth(this.TextStrokeWidth),n=getColor(this.TextStrokeColor),a=getColor(this.TextFillColor),l=getStrokeWidth(this.ShapeStrokeWidth),c=getColor(this.ShapeStrokeColor),d=getColor(this.ShapeFillColor),h=createPath(this.Width,this.Height,this.Path,this.IsClosedPath);e.push((()=>hb.Printess.Raw.path_destroy(h))),o.setText(i.ptr,i.length),o.setPath(h),o.setFont(this.Font.ptr),o.setSize(this.Width,this.Height),o.setFontSize(this.FontSize),o.setHorizontalAlignment(this.getHorizontalAlignment()),o.setStartX(this.StartX),o.setDistance(r.width),o.setDistanceIsPercent(r.isPercent),o.setHasBoxOpacity(this.hasBoxOpacity),o.TextPathProperties.SetStrokeWidth(s.width),o.TextPathProperties.SetIsStrokeWidthPercent(s.isPercent),o.TextPathProperties.SetFillColorArgb(a),o.TextPathProperties.SetStrokeColorArgb(n),o.TextPathProperties.SetStrokePosition(getStrokePosition(this.TextStrokeAlign)),o.TextPathProperties.SetStrokeJoin(getStrokeJoin(this.TextStrokeJoin)),o.ShapePathProperties.SetStrokeWidth(l.width),o.ShapePathProperties.SetIsStrokeWidthPercent(l.isPercent),o.ShapePathProperties.SetFillColorArgb(d),o.ShapePathProperties.SetStrokeColorArgb(c),o.ShapePathProperties.SetStrokePosition(getStrokePosition(this.ShapeStrokeAlign)),o.ShapePathProperties.SetStrokeJoin(getStrokeJoin(this.ShapeStrokeJoin)),o.ShapePathProperties.SetStrokeCap(getStrokeCap(this.ShapeStrokeCap)),o.ShapePathProperties.SetIsImageMask(this.ShapeIsImageMask),o.ShapePathProperties.SetIsClosed(this.IsClosedPath),t&&this.effects.setValues(o.EffectsSet);const p=new TransformSet(o.TransformSetPointer,this.ScaledTaperTransform(),this.WarpTransform,this.MeshTransform);return e.push((()=>p.delete())),o}buildSvg(){const e=[];try{const t=this.createShaper(e).buildSvg();return this.adjustmentTop=t.top,this.adjustmentLeft=t.left,this.adjustmentRight=this.Width-t.width+this.adjustmentLeft,this.adjustmentBottom=this.Height-t.height-this.adjustmentTop,t.svg}finally{e.forEach((e=>e()))}}buildImage(e=!0){const t=[];try{const o=this.createShaper(t,!0),i=o.calculateBounds(),r=o.addStrokeExtents(i),s=o.EffectsSet.calculateBounds(r.width,r.height),n={x:s.x,y:s.y,width:s.width,height:s.height};n.x<0&&(s.width-=n.x,s.x-=n.x,n.x=0);const a=createOrGetWebGlCanvas(s.width,s.height),l={width:s.width,height:s.height,left:s.x-i.x,top:s.y-i.y,div:document.createElement("div"),dropShadowDataUrl:null,outerGlowDataUrl:null,strokeDataUrl:null,imageDataUrl:null,dropShadowElement:null,outerGlowElement:null,strokeElement:null,imageElement:null};if(e){const e=new Image;o.drawImage(a.surface,n),l.imageDataUrl=a.createDataUrl(),e.src=l.imageDataUrl,e.style.top="0",e.style.left="0",e.style.position="absolute",l.imageElement=e}if(this.effects.isDropShadowActive){const e=new Image;o.drawDropShadow(a.surface,n),l.dropShadowDataUrl=a.createDataUrl(),e.src=l.dropShadowDataUrl,e.style.top="0",e.style.left="0",e.style.position="absolute",e.style.setProperty("mix-blend-mode",this.effects.dropShadowBlendMode),l.div.appendChild(e),l.dropShadowElement=e}if(this.effects.isOuterGlowActive){const e=new Image;o.drawOuterGlow(a.surface,n),l.outerGlowDataUrl=a.createDataUrl(),e.src=l.outerGlowDataUrl,e.style.top="0",e.style.left="0",e.style.position="absolute",e.style.setProperty("mix-blend-mode",this.effects.outerGlowBlendMode),l.div.appendChild(e),l.outerGlowElement=e}if(this.effects.isStrokeEffectActive){const e=new Image;o.drawStroke(a.surface,n),l.strokeDataUrl=a.createDataUrl(),e.src=l.strokeDataUrl,e.style.top="0",e.style.left="0",e.style.position="absolute",e.style.setProperty("mix-blend-mode",this.effects.strokeEffectBlendMode),l.div.appendChild(e),l.strokeElement=e}return l.imageElement&&l.div.appendChild(l.imageElement),this.adjustmentTop=-l.top,this.adjustmentLeft=-l.left,this.adjustmentRight=this.Width-s.width+this.adjustmentLeft,this.adjustmentBottom=this.Height-s.height-this.adjustmentTop,l}finally{t.forEach((e=>e()))}}}let shaperInstances=0;class GeneralShaper{constructor(e,t,o,i,r,s,n,a,l,c,d,h,p){this.effects=new EffectsSet,this.Path=e,this.IsClosedPath=t,this.Width=o,this.Height=i,this.hasBoxOpacity=p,this.ShapeStrokeWidth=r,this.ShapeStrokeColor=s,this.ShapeFillColor=n,this.ShapeStrokeAlign=a,this.ShapeStrokeJoin=l,this.ShapeStrokeCap=c,this.ShapeIsImageMask=d,this.strokeType=h,this.TaperTransform=null,this.MeshTransform=null,this.WarpTransform=null,this.adjustmentTop=0,this.adjustmentLeft=0,this.adjustmentBottom=0,this.adjustmentRight=0}getHash(){return JSON.stringify(this,((e,t)=>{if(-1===["adjustmentTop","adjustmentLeft","adjustmentBottom","adjustmentRight"].indexOf(e))return t}))}ScaledTaperTransform(){return scaleTaperTransform(this.TaperTransform,this.Width,this.Height)}transformPoints(e){const t=hb.Printess.GeneralTransformer.Create(),o=[];try{o.push((()=>t.Destroy())),t.SetSize(this.Width,this.Height),t.SetHasBoxOpacity(this.hasBoxOpacity);const i=new TransformSet(t.TransformSetPointer,this.ScaledTaperTransform(),this.WarpTransform,this.MeshTransform);o.push((()=>i.delete()));const r=Math.floor(e.length/2),s=new Float32Array(e),n=hb.malloc(4*s.length);o.push((()=>hb.free(n)));const a=hb.malloc(4*s.length);o.push((()=>hb.free(a))),hb.heapf32().set(s,n/4),hb.general_transformer_transform_points(t.Pointer,n,a,r),this.adjustmentTop=hb.general_transformer_get_adjustment_top(t.Pointer),this.adjustmentLeft=hb.general_transformer_get_adjustment_left(t.Pointer);const l=hb.heapf32().slice(a/4,a/4+e.length),c=[];for(let e=0;e<r;e++){const t=l[2*e],o=l[2*e+1];c.push({x:t,y:o})}return c}finally{o.forEach((e=>e()))}}buildSvg(){shaperInstances++;const e=hb.Printess.GeneralTransformer.Create(),t=[];shaperInstances>1&&console_warn("multiple shapers...");try{t.push((()=>e.Destroy()));const o=createPath(this.Width,this.Height,this.Path,this.IsClosedPath);t.push((()=>hb.path_destroy(o)));const i=getStrokeWidth(this.ShapeStrokeWidth),r=getColor(this.ShapeStrokeColor),s=getColor(this.ShapeFillColor);e.SetSize(this.Width,this.Height),e.SetPath(o),e.SetHasBoxOpacity(this.hasBoxOpacity),e.ShapePathProperties.SetStrokeWidth(i.width),e.ShapePathProperties.SetIsStrokeWidthPercent(i.isPercent),e.ShapePathProperties.SetFillColorArgb(s),e.ShapePathProperties.SetStrokeColorArgb(r),e.ShapePathProperties.SetStrokePosition(getStrokePosition(this.ShapeStrokeAlign)),e.ShapePathProperties.SetStrokeJoin(getStrokeJoin(this.ShapeStrokeJoin)),e.ShapePathProperties.SetStrokeCap(getStrokeCap(this.ShapeStrokeCap)),e.ShapePathProperties.SetStrokeType(getPathStyle(this.strokeType)),e.ShapePathProperties.SetDashGap(this.dash1,this.gap1),e.ShapePathProperties.SetIsImageMask(this.ShapeIsImageMask),e.ShapePathProperties.SetIsClosed(this.IsClosedPath);const n=new TransformSet(e.TransformSetPointer,this.ScaledTaperTransform(),this.WarpTransform,this.MeshTransform);t.push((()=>n.delete()));let a="";return a=e.BuildPathSvg(),this.adjustmentTop=e.GetAdjustmentTop(),this.adjustmentLeft=e.GetAdjustmentLeft(),this.adjustmentRight=this.Width-e.GetFinalWidth()-this.adjustmentLeft,this.adjustmentBottom=this.Height-e.GetFinalHeight()-this.adjustmentTop,a}finally{t.forEach((e=>e())),shaperInstances--}}buildImage(e=!0){const t=hb.Printess.GeneralTransformer.Create(),o=[];try{o.push((()=>t.Destroy()));const i=createPath(this.Width,this.Height,this.Path,this.IsClosedPath);o.push((()=>hb.path_destroy(i)));const r=getStrokeWidth(this.ShapeStrokeWidth),s=getColor(this.ShapeStrokeColor),n=getColor(this.ShapeFillColor);t.SetSize(this.Width,this.Height),t.SetPath(i),t.SetHasBoxOpacity(this.hasBoxOpacity),t.ShapePathProperties.SetStrokeWidth(r.width),t.ShapePathProperties.SetIsStrokeWidthPercent(r.isPercent),t.ShapePathProperties.SetFillColorArgb(n),t.ShapePathProperties.SetStrokeColorArgb(s),t.ShapePathProperties.SetStrokePosition(getStrokePosition(this.ShapeStrokeAlign)),t.ShapePathProperties.SetStrokeJoin(getStrokeJoin(this.ShapeStrokeJoin)),t.ShapePathProperties.SetStrokeCap(getStrokeCap(this.ShapeStrokeCap)),t.ShapePathProperties.SetStrokeType(getPathStyle(this.strokeType)),t.ShapePathProperties.SetDashGap(this.dash1,this.gap1),t.ShapePathProperties.SetIsImageMask(this.ShapeIsImageMask),t.ShapePathProperties.SetIsClosed(this.IsClosedPath),this.effects.setValues(t.EffectsSet);const a=new TransformSet(t.TransformSetPointer,this.ScaledTaperTransform(),this.WarpTransform,this.MeshTransform);o.push((()=>a.delete()));const l=t.calculateBounds(),c=t.addStrokeExtents(l),d=t.EffectsSet.calculateBounds(c.width,c.height),h={x:d.x,y:d.y,width:d.width,height:d.height};h.x<0&&(d.width-=h.x,d.x-=h.x,h.x=0);const p=createOrGetWebGlCanvas(d.width,d.height),u={width:d.width,height:d.height,left:d.x-l.x,top:d.y-l.y,div:document.createElement("div"),dropShadowDataUrl:null,outerGlowDataUrl:null,strokeDataUrl:null,imageDataUrl:null,dropShadowElement:null,outerGlowElement:null,strokeElement:null,imageElement:null};if(e){const e=new Image;t.drawImage(p.surface,h),u.imageDataUrl=p.createDataUrl(),e.src=u.imageDataUrl,e.style.top="0",e.style.left="0",e.style.position="absolute",u.imageElement=e}if(this.effects.isDropShadowActive){const e=new Image;t.drawDropShadow(p.surface,h),u.dropShadowDataUrl=p.createDataUrl(),e.src=u.dropShadowDataUrl,e.style.top="0",e.style.left="0",e.style.position="absolute",e.style.setProperty("mix-blend-mode",this.effects.dropShadowBlendMode),u.div.appendChild(e),u.dropShadowElement=e}if(this.effects.isOuterGlowActive){const e=new Image;t.drawOuterGlow(p.surface,h),u.outerGlowDataUrl=p.createDataUrl(),e.src=u.outerGlowDataUrl,e.style.top="0",e.style.left="0",e.style.position="absolute",e.style.setProperty("mix-blend-mode",this.effects.outerGlowBlendMode),u.div.appendChild(e),u.outerGlowElement=e}if(this.effects.isStrokeEffectActive){const e=new Image;t.drawStroke(p.surface,h),u.strokeDataUrl=p.createDataUrl(),e.src=u.strokeDataUrl,e.style.top="0",e.style.left="0",e.style.position="absolute",e.style.setProperty("mix-blend-mode",this.effects.strokeEffectBlendMode),u.div.appendChild(e),u.strokeElement=e}return u.imageElement&&u.div.appendChild(u.imageElement),this.adjustmentTop=-u.top,this.adjustmentLeft=-u.left,this.adjustmentRight=this.Width-d.width-this.adjustmentLeft,this.adjustmentBottom=this.Height-d.height-this.adjustmentTop,u}finally{o.forEach((e=>e()))}}}function getWidth(e,t,o){const i=o/t.unitsPerEM;return shape(e,t).map((e=>e.XAdvance)).reduce(((e,t)=>e+t),0)*i}function downloadBytes(e){return __awaiter$D(this,void 0,void 0,(function*(){try{const t=yield fetch(e+"?_",{method:"GET",mode:"cors"}),o=yield t.arrayBuffer();return new Uint8Array(o)}catch(t){throw config.isAutomationMode||alert("Cannot download file (please check the console for CORS errors and make sure the file is accessible from JavaScript): "+e+" Error: "+t),t}}))}function downloadString(e){return __awaiter$D(this,void 0,void 0,(function*(){try{const t=yield fetch(e+"?_",{method:"GET",mode:"cors"});return yield t.text()}catch(t){throw config.isAutomationMode||alert("Cannot download file (please check the console for CORS errors and make sure the file is accessible from JavaScript): "+e+" Error: "+t),t}}))}function loadImage(e){return new Promise(((t,o)=>{const i=new Image;i.crossOrigin="anonymous",i.onload=function(){t(i)},i.onerror=function(t){config.isAutomationMode||alert("Cannot download image (please check the console for CORS errors and make sure the file is accessible from JavaScript): "+e+" Error: "+t),o(t)},e.startsWith("data:")||e.startsWith("blob:")?i.src=e:i.src=e+"?_"}))}class TransformSet{constructor(e,t,o,i){let r,s;if(this.cleaner=[],this.hasActiveTransforms=!1,e<=0&&(e=hb.transform_set_create(),this.cleaner.push((()=>hb.Printess.Raw.transform_set_delete(e)))),this.Pointer=e,null!==t&&(this.hasActiveTransforms=!0,hb.transform_set_set_taper_transform(e,t.topLeft.x,t.topLeft.y,t.topRight.x,t.topRight.y,t.bottomLeft.x,t.bottomLeft.y,t.bottomRight.x,t.bottomRight.y)),i){this.hasActiveTransforms=!0;const t=[];i.points.forEach((e=>{t.push(e.x),t.push(e.y)}));const o=new Float32Array(t),r=hb.malloc(4*o.length);hb.heapf32().set(o,r/4);const s=hb.create_mesh_transformer(i.cols,i.rows,r,2);hb.free(r),this.cleaner.push((()=>hb.Printess.Raw.delete_mesh_transformer(s))),hb.transform_set_set_mesh_transformer(e,s)}if(o){const t=o;if(t.distortActive&&(this.hasActiveTransforms=!0,this.setTurbulenceTransformer(t.distortScale,t.distortFrequency,t.distortOctaves,t.distortSeed)),t.warpArchActive){this.hasActiveTransforms=!0;const o=-2*(t.warpArchPhi-90),i=hb.create_arc_transformer(t.warpArchPhi,o,convertArchPosition(t.warpArchPosition),convertArchMirror(t.warpArchMirror));this.cleaner.push((()=>hb.Printess.Raw.delete_arc_transformer(i))),hb.transform_set_set_arch_transformer(e,i)}if(t.warpCupActive){this.hasActiveTransforms=!0;const o=-2*(t.warpCupPhi-90),i=hb.create_cup_transformer(t.warpCupPhi,o,t.warpCupY);this.cleaner.push((()=>hb.Printess.Raw.delete_cup_transformer(i))),hb.transform_set_set_cup_transformer(e,i)}t.warpArcActive&&(this.hasActiveTransforms=!0,"bulge"!==t.warpArcPosition&&"upper"!==t.warpArcPosition||(r=createTopBottomTransfomer({transform:t.warpArcHeightFraction>0?"parabel":"inverseparabel",heightFraction:t.warpArcHeightFraction,phase:0,waves:0},this.cleaner),r&&hb.transform_set_set_top_arc_transformer(e,r)),"bulge"!==t.warpArcPosition&&"lower"!==t.warpArcPosition||(s=createTopBottomTransfomer({transform:t.warpArcHeightFraction<0?"parabel":"inverseparabel",heightFraction:t.warpArcHeightFraction,phase:0,waves:0},this.cleaner),s&&hb.transform_set_set_bottom_arc_transformer(e,s))),t.warpPitActive&&(this.hasActiveTransforms=!0,"squeeze"!==t.warpPitPosition&&"upper"!==t.warpPitPosition||(r=createTopBottomTransfomer({transform:t.warpPitHeightFraction<0?"parabel":"inverseparabel",heightFraction:t.warpPitHeightFraction,phase:0,waves:0},this.cleaner),r&&hb.transform_set_set_top_pit_transformer(e,r)),"squeeze"!==t.warpPitPosition&&"lower"!==t.warpPitPosition||(s=createTopBottomTransfomer({transform:t.warpPitHeightFraction>0?"parabel":"inverseparabel",heightFraction:t.warpPitHeightFraction,phase:0,waves:0},this.cleaner),s&&hb.transform_set_set_bottom_pit_transformer(e,s))),t.warpFlagActive&&(this.hasActiveTransforms=!0,r=createTopBottomTransfomer({transform:"sine",heightFraction:t.warpFlagHeightFraction,phase:t.warpFlagPhase,waves:t.warpFlagWaves},this.cleaner),r&&hb.transform_set_set_top_flag_transformer(e,r),s=createTopBottomTransfomer({transform:"sine",heightFraction:t.warpFlagHeightFraction,phase:t.warpFlagPhase,waves:t.warpFlagWaves},this.cleaner),s&&hb.transform_set_set_bottom_flag_transformer(e,s)),t.warpFishActive&&(this.hasActiveTransforms=!0,r=createTopBottomTransfomer({transform:"sine",heightFraction:t.warpFishHeightFraction,phase:t.warpFishHeightFraction<0?0:Math.PI,waves:t.warpFishWaves},this.cleaner),r&&hb.transform_set_set_top_fish_transformer(e,r),s=createTopBottomTransfomer({transform:"sine",heightFraction:t.warpFishHeightFraction,phase:t.warpFishHeightFraction>0?0:Math.PI,waves:t.warpFishWaves},this.cleaner),s&&hb.transform_set_set_bottom_fish_transformer(e,s)),t.warpCustomActive&&(this.hasActiveTransforms=!0,r=createTopBottomTransfomer({transform:t.warpCustomTopTransform,heightFraction:t.warpCustomTopHeightFraction,phase:t.warpCustomTopPhase,waves:t.warpCustomTopWaves},this.cleaner),r&&hb.transform_set_set_top_transformer(e,r),s=createTopBottomTransfomer({transform:t.warpCustomBottomTransform,heightFraction:t.warpCustomBottomHeightFraction,phase:t.warpCustomBottomPhase,waves:t.warpCustomBottomWaves},this.cleaner),s&&hb.transform_set_set_bottom_transformer(e,s))}}delete(){this.cleaner.forEach((e=>e()))}setTurbulenceTransformer(e,t,o,i){const r=hb.create_turbulence_transformer(e,t/100,o,i);this.cleaner.push((()=>hb.Printess.Raw.delete_turbulence_transformer(r))),hb.transform_set_set_turbulence_transformer(this.Pointer,r)}}function maskImageImageIsRgba(e,t,o,i,r,s){const n=createOrGetWebGlCanvas(e,t),a=hb.calloc(r.length,1);hb.heapu8().set(r,a),hb.Printess.Exports.MaskImageImageIsRgba(n.surface,e,t,o,i,a,r.length,s)}function maskImageInverseImageIsRgba(e,t,o,i,r,s){const n=createOrGetWebGlCanvas(e,t),a=hb.calloc(r.length,1);hb.heapu8().set(r,a),hb.Printess.Exports.MaskImageInverseImageIsRgba(n.surface,e,t,o,i,a,r.length,s)}class ImageTransformer{constructor(e,t,o,i,r,s){this.imageUrl=e,this.maskImage=t,this.TransformSet=new TransformSet(0,o,i,r),this.EffectsSet=hb.Printess.EffectsSet.create(),this.effects=s,s.setValues(this.EffectsSet)}delete(){this.TransformSet.delete(),this.EffectsSet.destroy()}transform(e,t,o,i,r,s){return __awaiter$D(this,void 0,void 0,(function*(){console_log("Starting image transform..."),r=Math.floor(r),s=Math.floor(s);const n=document.createElement("canvas");n.width=r,n.height=s;const a=n.getContext("2d");if(!a)return n.width=0,n.height=0,null;const l=yield loadImage(this.imageUrl);a.drawImage(l,e,t,o,i,0,0,r,s);let c=a.getImageData(0,0,r,s),d=hb.calloc(c.data.length,1);if(hb.heapu8().set(c.data,d),this.maskImage.hasMaskImage){let e;try{e=yield downloadBytes(this.maskImage.maskImage.url)}catch(e){throw hb.free(d),e}!0===this.maskImage.maskInverse?maskImageInverseImageIsRgba(r,s,d,c.data.length,e,"alpha"===this.maskImage.maskChannel):maskImageImageIsRgba(r,s,d,c.data.length,e,"alpha"===this.maskImage.maskChannel),hb.free(d),a.clearRect(0,0,r,s),a.drawImage(memoizedWebGlSurface.canvas,0,0),c=a.getImageData(0,0,r,s),d=hb.calloc(c.data.length,1),hb.heapu8().set(c.data,d)}n.width=0,n.height=0;const h=new hb.fall19.TransformSetWrapper;try{let e;if(this.TransformSet.hasActiveTransforms)try{console_log("Before transforming image data"),e=h.TransformImageWasm(this.TransformSet.Pointer,d,c.width,c.height),console_log("After transforming image data")}catch(e){throw console.error(e),hb.free(d),e}else e={width:c.width,height:c.height,left:0,top:0,pixelsPtr:d};try{const t=this.EffectsSet.calculateBounds(e.width,e.height),o=createOrGetWebGlCanvas(t.width,t.height),i={width:t.width,height:t.height,top:-t.y+e.top,left:-t.x+e.left,div:document.createElement("div"),dropShadowDataUrl:null,outerGlowDataUrl:null,imageDataUrl:null,strokeDataUrl:null,dropShadowElement:null,outerGlowElement:null,strokeElement:null,imageElement:null};{const r=new Image;this.EffectsSet.drawImage(o.surface,e,t),i.imageDataUrl=o.createDataUrl(),i.div.appendChild(r),i.imageElement=r,r.src=i.imageDataUrl}if(this.effects.isDropShadowActive){const r=new Image;this.EffectsSet.drawDropShadow(o.surface,e,t),i.dropShadowDataUrl=o.createDataUrl(),r.src=i.dropShadowDataUrl,r.style.top="0",r.style.left="0",r.style.position="absolute",r.style.setProperty("mix-blend-mode",this.effects.dropShadowBlendMode),i.div.appendChild(r),i.dropShadowElement=r}if(this.effects.isOuterGlowActive){const r=new Image;this.EffectsSet.drawOuterGlow(o.surface,e,t),i.outerGlowDataUrl=o.createDataUrl(),r.src=i.outerGlowDataUrl,r.style.top="0",r.style.left="0",r.style.position="absolute",r.style.setProperty("mix-blend-mode",this.effects.outerGlowBlendMode),i.div.appendChild(r),i.outerGlowElement=r}if(this.effects.isStrokeEffectActive){const r=new Image;this.EffectsSet.drawStroke(o.surface,e,t),i.strokeDataUrl=o.createDataUrl(),r.src=i.strokeDataUrl,r.style.top="0",r.style.left="0",r.style.position="absolute",r.style.setProperty("mix-blend-mode",this.effects.strokeEffectBlendMode),i.div.appendChild(r),i.strokeElement=r}if(i.imageDataUrl){const e=new Image;e.src=i.imageDataUrl,i.div.appendChild(e)}return i}catch(e){throw console.error(e),e}finally{hb.free(e.pixelsPtr)}}finally{h.delete()}}))}}const harfBuzzFonts=new Map,harfBuzzPromises=new Map;function loadHarfBuzzEm(e){return e.then((e=>{hb=new HarfBuzzExports(e),memoizedWebGlSurface=new WebGlSurface}))}function loadAndCacheFont(e,t){const o=harfBuzzPromises.get(e);if(o)return o;const i=fetch(t+"?_").then((o=>{if(!o.ok)throw new Error("Can't load font ["+e+"] ("+t+") "+o.statusText);return o.arrayBuffer().then((t=>{const o=new Uint8Array(t),i=new HarfBuzzBlob(o),r=new HarfBuzzFace(i,0),s=new HarfBuzzFont(r);return harfBuzzFonts.set(e,s),r.destroy(),i.destroy(),s}))}));return harfBuzzPromises.set(e,i),i}var __awaiter$E=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};class SimpleText extends NobsBase{constructor(e,t){if(super(e,t),this.usedFormFields=new Map,!(e instanceof Nobs))if("string"==typeof e)this.text=e;else if(e){const t=e;void 0!==t.txt&&null!==t.txt&&(this.text=t.txt),void 0!==t.def&&null!==t.def&&(this.defaultText=t.def),void 0!==t.tbe&&null!==t.tbe&&(this.textBefore=t.tbe),void 0!==t.taf&&null!==t.taf&&(this.textAfter=t.taf),t.fnt&&(this.font=new FontRef(t.fnt.id,t.fnt)),t.hor&&(this.horizontalSimpleTextAlign=t.hor),t.ver&&(this.verticalSimpleTextAlign=t.ver),this.barcodeType=t.bct||"QRCode",this.barcodeOptions=t.bco||"",this.hasFormField=!0===t.hff,this.hasFontSize=!0===t.hfs,t.fs&&(this.fontSize=Length.deserialize(t.fs)),t.stw&&(this.fontStrokeWidth=Length.deserialize(t.stw)),t.sta&&(this.fontStrokeAlign=t.sta),t.stj&&(this.fontStrokeJoin=t.stj),t.sgf&&(this.fontStrokeGapFactor=t.sgf),t.sdf&&(this.fontStrokeDashFactor=t.sdf),t.stt&&(this.fontStrokeType=t.stt),t.ddi&&(this.fontDashDistribution=t.ddi),t.fhe&&(this.fontHeights=t.fhe),t.mins&&(this.minLetterSpacing=t.mins),t.maxs&&(this.maxLetterSpacing=t.maxs),t.minw&&(this.minLetterWidth=t.minw),t.maxw&&(this.maxLetterWidth=t.maxw),t.stc&&(this.fontStrokeColor=new ColorRef(t.stc.id,t.stc)),t.txc&&(this.fontColor=new ColorRef(t.txc.id,t.txc)),t.trans&&(this.textTransform=t.trans),t.maxc&&(this.maxCharacters=t.maxc),this.simpleTextMode="text",t.mode?this.simpleTextMode=t.mode:!0===t.sym&&(this.simpleTextMode="symbol"),!1!==t.sykr&&!0!==t.sykr||(this.symbolKeepRatio=t.sykr),null!=t.sypx&&(this.symbolPosX=t.sypx),null!=t.sypy&&(this.symbolPosY=t.sypy)}this.font||(this.font=new FontRef("")),this.hasFormField=this.hasFormField||!1,this.hasFontSize=this.hasFontSize||!1,this.fontSize||(this.fontSize=new Length(30,"pt")),void 0===this.text&&(this.text="Fancy Text"),void 0===this.defaultText&&(this.defaultText=""),void 0===this.textBefore&&(this.textBefore=""),void 0===this.textAfter&&(this.textAfter=""),this.fontColor||(this.fontColor=new ColorRef("[Black]")),this.fontStrokeColor||(this.fontStrokeColor=new ColorRef("[Black]")),this.fontStrokeWidth||(this.fontStrokeWidth=new Length(0,"%")),this.horizontalSimpleTextAlign||(this.horizontalSimpleTextAlign="center"),this.verticalSimpleTextAlign||(this.verticalSimpleTextAlign="center"),this.fontStrokeAlign||(this.fontStrokeAlign="center"),this.fontStrokeJoin||(this.fontStrokeJoin="miter"),this.fontStrokeType||(this.fontStrokeType="solid"),this.fontDashDistribution||(this.fontDashDistribution="align"),this.fontHeights||(this.fontHeights="font"),this.fontStrokeGapFactor||(this.fontStrokeGapFactor=1.5),this.fontStrokeDashFactor||(this.fontStrokeDashFactor=1),this.minLetterSpacing||(this.minLetterSpacing=100),this.maxLetterSpacing||(this.maxLetterSpacing=100),this.minLetterWidth||(this.minLetterWidth=100),this.maxLetterWidth||(this.maxLetterWidth=100),this.minLetterSpacing>this.maxLetterSpacing&&(this.maxLetterSpacing=this.minLetterSpacing),this.minLetterWidth>this.maxLetterWidth&&(this.maxLetterWidth=this.minLetterWidth),this.maxCharacters||(this.maxCharacters=0),this.textTransform||(this.textTransform="mixed"),void 0===this.simpleTextMode&&(this.simpleTextMode="text"),void 0===this.barcodeType&&(this.barcodeType="QRCode"),void 0===this.symbolPosX&&(this.symbolPosX=.5),void 0===this.symbolPosY&&(this.symbolPosY=.5),void 0===this.symbolKeepRatio&&(this.symbolKeepRatio=!0)}createShaper(e,t,o,i){return __awaiter$E(this,void 0,void 0,(function*(){const r=e.box.getValue("simpleText","font",e).font,s=yield loadAndCacheFont(r.name,r.url);let n=e.box.getValue("simpleText","textBefore",e)||"",a=e.box.getValue("simpleText","textAfter",e)||"";if(n.indexOf("${")>=0){const t=evaluateText(e.parentBoxIdForEvaluation,n);if(t.errors.length)n=t.errors.join("|");else if(n=t.text||"",e.box.simpleText&&t.fields&&t.fields.size>0)for(const[o,i]of t.fields)e.box.simpleText.usedFormFields.set(o,i)}if(a.indexOf("${")>=0){const t=evaluateText(e.parentBoxIdForEvaluation,a);if(t.errors.length)a=t.errors.join("|");else if(a=t.text||"",e.box.simpleText&&t.fields&&t.fields.size>0)for(const[o,i]of t.fields)e.box.simpleText.usedFormFields.set(o,i)}const l=new OneLineShaper(t,s,o.width,o.height,e.box.getValue("simpleText","horizontalSimpleTextAlign",e),e.box.getValue("simpleText","verticalSimpleTextAlign",e),e.box.getValue("simpleText","fontStrokeWidth",e).toPixelOrPercent(),e.box.getValue("simpleText","fontStrokeColor",e).toPrintColor(),e.box.getValue("simpleText","fontColor",e).toPrintColor(),e.box.getValue("simpleText","fontStrokeAlign",e),e.box.getValue("simpleText","fontStrokeJoin",e),e.box.getValue("simpleText","fontStrokeType",e),i);l.TaperTransform=e.box.taperTransform("text"),l.MeshTransform=e.box.meshTransform("text"),l.WarpTransform=e.box.warpTransform(e,"text"),l.dash1=e.box.getValue("simpleText","fontStrokeDashFactor",e),l.gap1=e.box.getValue("simpleText","fontStrokeGapFactor",e),l.paddingTop=e.box.getValue("basics","paddingTop",e).resolveEquations(o.width,o.height),l.paddingLeft=e.box.getValue("basics","paddingLeft",e).resolveEquations(o.width,o.height),l.paddingBottom=e.box.getValue("basics","paddingBottom",e).resolveEquations(o.width,o.height),l.paddingRight=e.box.getValue("basics","paddingRight",e).resolveEquations(o.width,o.height),l.useWinAscender=-1!==e.box.getValue("basics","class",e).indexOf("use-win-ascender"),l.textBefore=n,l.textAfter=a;const c=e.box.getValue("simpleText","simpleTextMode",e);if("symbol"===c){const t=e.box.getValue("simpleText","symbolKeepRatio",e);l.minLetterSpacing=1,l.maxLetterSpacing=1,l.useFontMetrics=!1,t?(l.minLetterWidth=1,l.maxLetterWidth=1):(l.minLetterWidth=.01,l.maxLetterWidth=100)}else"text"===c&&(l.useFontMetrics="font"==e.box.getValue("simpleText","fontHeights",e),l.minLetterSpacing=e.box.getValue("simpleText","minLetterSpacing",e)/100,l.maxLetterSpacing=e.box.getValue("simpleText","maxLetterSpacing",e)/100,l.minLetterWidth=e.box.getValue("simpleText","minLetterWidth",e)/100,l.maxLetterWidth=e.box.getValue("simpleText","maxLetterWidth",e)/100,l.applyMaximumFontSize=e.box.getValue("simpleText","hasFontSize",e),l.maximumFontSize=e.box.getValue("simpleText","fontSize",e));e.setEffects("text",l.effects,o);const d=e.getFeatureFromWCBoxOrBox("imageRef");return d&&(l.maskImage.imageWidth=d.image.width,l.maskImage.imageHeight=d.image.height,l.maskImage.imageWidthScale=e.box.getValue("imageRef","imageWidthScale",e),l.maskImage.imageHeightScale=e.box.getValue("imageRef","imageHeightScale",e),l.maskImage.imageXPosition=e.box.getValue("imageRef","imageXPosition",e),l.maskImage.imageYPosition=e.box.getValue("imageRef","imageYPosition",e)),l}))}static getText(e){let t=e.box.getValue("simpleText","text",e),o=null;if(t.indexOf("${")>=0){const i=evaluateText(e.parentBoxIdForEvaluation,t);t=null===i.text?i.errors.join("\n"):i.text,o=i.fields}else if(e.parentBoxIdForEvaluation&&e.simpleText&&e.simpleText.hasFormField){const i=evaluateText(e.parentBoxIdForEvaluation,"${form.BOX_STEXT_"+e.box.id+"}");t=null===i.text?i.errors.join("\n"):i.text,o=i.fields}return e.box.simpleText&&o&&o.size>0&&(e.box.simpleText.usedFormFields=o),t}getFinalText(e){let t=SimpleText.getText(e);return e.box.basics.class.match(/text-distribution-\d+(?!-)/)&&t.split(/\s+/).filter((e=>""!==e)).length>1?"":("upper"===this.textTransform?t=t.toUpperCase():"lower"===this.textTransform&&(t=t.toLowerCase()),t)}getMaskImageUrl(e){let t=null;const o=e.getFeatureFromWCBoxOrBox("imageRef");if(o&&"simpleText"==o.imageMasking){t=e.box.getValue("imageRef","image",e).url}return t}generateTextStampedImage(e){var t;return __awaiter$E(this,void 0,void 0,(function*(){if(!e.isSimpleTextImage)return;const o=getOrCreateBoxCache(e.uniqueBoxId()),i=e.getParentDimensions(),r=e.boxGeometry.toPixel(i.width,i.height,!0),s=this.getFinalText(e),n=yield this.createShaper(e,s,r,!1),a=n.getHash();if(a!=o.stampedImageCache.hash){o.stampedImageCache.hash=a;const i=yield n.buildImage(this.getMaskImageUrl(e)),r=-i.left+"px",s=-i.top+"px";o.stampedImageCache.left=n.adjustmentLeft,o.stampedImageCache.top=n.adjustmentTop,i.div=document.createElement("div"),i.imageElement&&setAbsoluteTopLeftBlend(i.imageElement,s,r,"normal"),o.simpleTextImage=i.imageElement,null===(t=getWcBox(e.box.id,e.parentBoxIdForEvaluation))||void 0===t||t.requestUpdate()}}))}generateTextVector(e){var t;return __awaiter$E(this,void 0,void 0,(function*(){if(e.isSimpleTextImage)return;const o=getOrCreateBoxCache(e.uniqueBoxId()),i=e.getParentDimensions(),r=e.boxGeometry.toPixel(i.width,i.height,!0),s=this.getFinalText(e),n=yield this.createShaper(e,s,r,!1),a=n.getHash();if(a!=o.vectorCache.hash){o.vectorCache.hash=a;const i=parseSvg(n.buildSvg());o.vectorCache.left=n.adjustmentLeft,o.vectorCache.top=n.adjustmentTop,i.setAttribute("class","text"),i.dataset.isEvenOdd=n.isMaskEvenOdd.toString(),i.style.left=n.adjustmentLeft+"px",i.style.top=n.adjustmentTop+"px",e.box.setOffsets("simpleText",n.adjustmentLeft,n.adjustmentTop,n.adjustmentRight,n.adjustmentBottom),o.simpleTextVector=i,null===(t=getWcBox(e.box.id,e.parentBoxIdForEvaluation))||void 0===t||t.requestUpdate()}}))}generateBarcode(e){var t;return __awaiter$E(this,void 0,void 0,(function*(){const o=getOrCreateBoxCache(e.uniqueBoxId()),i=createPrintessApiFromExternalConfig(),r=e.getParentDimensions(),s=e.box.getValue("simpleText","barcodeType",e),n=e.box.getValue("simpleText","fontColor",e).toCssColor(),a=evaluateText(e.parentBoxIdForEvaluation,e.box.getValue("simpleText","barcodeOptions",e)).text,l=e.boxGeometry.toPixel(r.width,r.height,!0),c=this.getFinalText(e),d=JSON.stringify({text:c,rect:l,type:s,fontColor:n,properties:a});let h;if(a)try{h=JSON.parse(a)}catch(e){console.log(e)}if(d!=o.vectorCache.hash){o.vectorCache.hash=d;const r=parseSvg(yield i.renderSvgBarcode(s,c,l.width,l.height,"Pixel",n,h));o.vectorCache.left=0,o.vectorCache.top=0,r.setAttribute("class","barcode"),e.box.setOffsets("simpleText",0,0,0,0),o.simpleTextVector=r,null===(t=getWcBox(e.box.id,e.parentBoxIdForEvaluation))||void 0===t||t.requestUpdate()}}))}hasOuterEffects(e){let t=!1;return-1===e.box.effect.dropOmits.indexOf("text")&&(t=t||e.box.getValue("effect","dropActive",e)),-1===e.box.effect.outGlowOmits.indexOf("text")&&(t=t||e.box.getValue("effect","outGlowActive",e)),-1===e.box.effect.strokeOmits.indexOf("text")&&(t=t||e.box.getValue("effect","strokeActive",e)),t}generateOuterEffects(e){var t;return __awaiter$E(this,void 0,void 0,(function*(){const o=getOrCreateBoxCache(e.uniqueBoxId());if(!this.hasOuterEffects(e))return o.simpleTextDropShadow=null,o.simpleTextOuterGlow=null,o.simpleTextStroke=null,void(o.outerEffectsCache.hash="");const i=e.getParentDimensions(),r=e.boxGeometry.toPixel(i.width,i.height,!0),s=this.getFinalText(e),n=yield this.createShaper(e,s,r,!1);n.effects.isInnerGlowActive=!1,n.effects.isInnerShadowActive=!1,n.effects.isBevelActive=!1;const a=n.getHash();if(a!=o.outerEffectsCache.hash){o.outerEffectsCache.hash=a;const i=yield n.buildImage(this.getMaskImageUrl(e)),r=-i.left+"px",s=-i.top+"px";o.outerEffectsCache.left=n.adjustmentLeft,o.outerEffectsCache.top=n.adjustmentTop,i.dropShadowElement&&setAbsoluteTopLeftBlend(i.dropShadowElement,s,r,n.effects.dropShadowBlendMode),i.outerGlowElement&&setAbsoluteTopLeftBlend(i.outerGlowElement,s,r,n.effects.outerGlowBlendMode),i.strokeElement&&setAbsoluteTopLeftBlend(i.strokeElement,s,r,n.effects.strokeEffectBlendMode),o.simpleTextDropShadow=i.dropShadowElement,o.simpleTextOuterGlow=i.outerGlowElement,o.simpleTextStroke=i.strokeElement,null===(t=getWcBox(e.box.id,e.parentBoxIdForEvaluation))||void 0===t||t.requestUpdate()}}))}generateSimpleTextUi(e){var t;return __awaiter$E(this,void 0,void 0,(function*(){"barcode"===(null===(t=e.simpleText)||void 0===t?void 0:t.simpleTextMode)?yield this.generateBarcode(e):(yield this.generateOuterEffects(e),yield this.generateTextStampedImage(e),yield this.generateTextVector(e))}))}static calculateSvgDto(e,t=null){return __awaiter$E(this,void 0,void 0,(function*(){const o=e.getParentDimensions(),i=e.boxGeometry.toPixel(o.width,o.height,!0),r=e.box.getValue("simpleText","textTransform",e);let s="";s=t||SimpleText.getText(e),"upper"===r&&(s=s.toUpperCase()),"lower"===r&&(s=s.toLowerCase());const n=e.box.getValue("simpleText","font",e).font,a=yield loadAndCacheFont(n.name,n.url),l=new OneLineShaper(s,a,i.width,i.height,"center","center","0px","rgb(0,0,0)","rgb(0,0,0)","center","miter","solid",!1);l.TaperTransform=null,l.MeshTransform=null,l.WarpTransform=null,l.paddingTop=e.box.getValue("basics","paddingTop",e).resolveEquations(i.width,i.height),l.paddingLeft=e.box.getValue("basics","paddingLeft",e).resolveEquations(i.width,i.height),l.paddingBottom=e.box.getValue("basics","paddingBottom",e).resolveEquations(i.width,i.height),l.paddingRight=e.box.getValue("basics","paddingRight",e).resolveEquations(i.width,i.height),l.useFontMetrics="font"==e.box.getValue("simpleText","fontHeights",e),l.minLetterSpacing=e.box.getValue("simpleText","minLetterSpacing",e)/100,l.maxLetterSpacing=e.box.getValue("simpleText","maxLetterSpacing",e)/100,l.minLetterWidth=e.box.getValue("simpleText","minLetterWidth",e)/100,l.maxLetterWidth=e.box.getValue("simpleText","maxLetterWidth",e)/100,l.applyMaximumFontSize=!1;return l.buildSvgDto()}))}toString(){return this.text}serialize(){return{txt:this.text,def:config.isBuyer||config.isMobile?this.defaultText:this.text,fnt:this.font.serialize(),hor:this.horizontalSimpleTextAlign,ver:this.verticalSimpleTextAlign,txc:this.fontColor.serialize(),stc:this.fontStrokeColor.serialize(),stw:this.fontStrokeWidth.serialize(),sta:this.fontStrokeAlign,stj:this.fontStrokeJoin,stt:this.fontStrokeType,sdf:this.fontStrokeDashFactor,sgf:this.fontStrokeGapFactor,ddi:this.fontDashDistribution,fhe:this.fontHeights,mins:this.minLetterSpacing,maxs:this.maxLetterSpacing,maxw:this.maxLetterWidth,minw:this.minLetterWidth,maxc:this.maxCharacters,trans:this.textTransform,mode:this.simpleTextMode,bct:this.barcodeType,bco:this.barcodeOptions,sykr:this.symbolKeepRatio,sypx:this.symbolPosX,sypy:this.symbolPosY,fs:this.fontSize.serialize(),hfs:this.hasFontSize,hff:this.hasFormField,tbe:this.textBefore,taf:this.textAfter}}}const stateMap=new WeakMap,createAndAppendPart=e=>{const t=new NodePart(e.options);return t.appendIntoPart(e),t},createAndInsertAfterPart=(e,t)=>{const o=new NodePart(e.options);return o.insertAfterPart(t),o},boxRepeater=directive(((e,t,o,i,r,s=!1)=>n=>{if(!(n instanceof NodePart))throw new Error("Directive can only be used in content bindings");let a;r&&r.boxOrderHasChanged?(r.boxOrderHasChanged=!1,n.clear(),a=null):a=stateMap.get(n),a||(a={domCache:new Map},stateMap.set(n,a));const l=new Set;let c=null,d=a.domCache.get("DUMMY");if(d||(a.domCache.size>0&&alert("cache has entries but no DUMMY"),d=createAndAppendPart(n),d.setValue(document.createElement("i")),d.commit,a.domCache.set("DUMMY",d)),c=d,e&&t){const r=Array.from(t.layers.values());for(let t=r.length-1;t>=0;t--){const d=r[t];if(d.isCurrentlyVisible(i||void 0)&&(d.print||!s)){const t=Array.from(e.values()).filter((e=>e.layerId===d.id)).sort(((e,t)=>e.order-t.order));for(const e of t){let t=a.domCache.get(e.id);if(t){if(c=t,l.add(e.id),!(t.value instanceof WcBox))throw new Error("boxRepeater: np.value is not of type WcBox");const o=t.value;o.box!==e&&(o.box=e,setWcBox(o,o.box.id,o.parentBoxIdForEvaluation),o.boxGeometry=e.boxGeometry.includeStyle(e.basics.class,e.autoSizeMode),o.pathGeometry=e.pathGeometry,o.simpleText=e.simpleText,o.pathText=e.pathText,o.docRef=e.docRef,o.imageRef=e.imageRef,o.transform=e.transform,o.effect=e.effect,o.refreshFlowIndex(),a.domCache.set(e.id,t))}else{t=c?createAndInsertAfterPart(n,c):createAndAppendPart(n);const r=new WcBox(e,o,o||i);r.classList.add("no-zoom"),t.setValue(r),t.commit(),l.add(e.id),a.domCache.set(e.id,t),c=t}}}}}for(const[e,t]of a.domCache)"DUMMY"===e||l.has(e)||(a.domCache.delete(e),t.clear())})),eddiStyles=css` 
  
        .noselect {
            -webkit-touch-callout: none; /* iOS Safari */
              -webkit-user-select: none; /* Safari */
              -khtml-user-select: none; /* Konqueror HTML */
                -moz-user-select: none; /* Old versions of Firefox */
                  -ms-user-select: none; /* Internet Explorer/Edge */
                      user-select: none; /* Non-prefixed version, currently
                                            supported by Chrome, Edge, Opera and Firefox */
        }
        .printess-eddi-selection-box {
            fill: cornsilk;
            mix-blend-mode: difference;
        }

        .printess-eddi-blinking-cursor {  
            fill: pink;
            mix-blend-mode: difference;
            -webkit-animation: 1s printess-eddi-blink step-end infinite;
            animation: 1s printess-eddi-blink step-end infinite;
        }

        .printess-eddi-steady-cursor {
            fill: pink;
            mix-blend-mode: difference;
        }

        @keyframes printess-eddi-blink {
            from, to {
                fill: transparent;
            }
            50% {
                fill: pink;
            }
        }

        @-webkit-keyframes printess-eddi-blink {
            from, to {
                fill: transparent;
            }
            50% {
                fill: pink;
            }
        }

        #eddiSenseBox {
            position: absolute;
            background: #f7f8ef;
            box-shadow: 3px 3px 3px 0px rgba(0, 0, 0, 0.21);
            overflow: auto;
        }

        #eddiSenseBox > .content {
            width: 100%;
            height: auto;
           
            display: flex;
            flex-direction: column;
            align-content: center;
        }

        #eddiSenseBox > .content > .line {
            font-family: monospace;
            height: 21px;
            font-size: 12px;
           line-height: 21px;
           height: auto;
            width: 100%;
            color: #2E3D48;
            cursor: pointer;
            position: relative;
        }


        #eddiSenseBox > .content > .line.selected {
            background: #2E3D48;
            color: white;
        }

        #eddiSenseBox  i  {
            background: #2e6a96;
            border-radius: 3px;
            line-height: 11px;
            font-size: 11px;
            color: white;
            padding-left: 3px;
            padding-right: 3px;
            padding-top: 1px;
            padding-bottom: 1px;
            font-style: normal;
            white-space: nowrap;
            font-family: sans-serif;
        }

        #eddiSenseBox > .content > .line * {
            pointer-events: none;
        }
        #eddiSenseBox > .content > .line > .type {
            background: darkblue;
            color: white;
            width: 17px;
            height: 17px;
            border-radius: 50%;
            text-align: center;
            top: 2px;
            left: 2px;
            line-height: 17px;
            position: absolute;
        }


        #eddiSenseBox > .content > .line.selected > .type {
            background: #f7f8ef;
            color: darkblue;
        }

        #eddiSenseBox > .content > .line > .main {
            pointer-events: none;
            padding-left: 24px;
            display: flex;
            align-items: center;
        }


        #eddiSenseBox > .content > .line > .main > strong {
            color: darkmagenta;

        }


        #eddiSenseBox > .content > .line.selected > .main > strong {
            color: #ffe9c3;

        }


        .eddi-svg-frame {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;

        }

        .eddi-svg-frame > * {
            pointer-events: none;
        }

        .eddi-svg-frame text {
            position: absolute;
            pointer-events: none;
        }

        .eddi-svg-padding-rect {
            position: absolute;
            pointer-events: none;
            left: 0;
            top: 0;
            width: 100%;
            height: calc(100% - 100px);
            border: 1px solid blue;

        }

        .eddi-svg-outer-rect {
            position: absolute;
            pointer-events: none;
            left: -1px;
            top: -1px;
            width: calc(100% + 2px);
            height: calc(100% + 2px);
            border: 1px solid #a89a8d;
        }


    `;var __awaiter$F=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};class BoxCache{constructor(){this.subDocumentCache={hash:"",left:0,top:0},this.subDocumentTemplate=html``,this.subDocumentPromise=null,this.outerEffectsCache={hash:"",left:0,top:0},this.stampedImageCache={hash:"",left:0,top:0},this.vectorCache={hash:"",left:0,top:0},this.pathGeometryCacheHash="",this.pathGeometryCache=html``,this.pathTextCache=html`<p>text on path</p>`,this.pathTextCacheHash="...",this.simpleTextDropShadow=null,this.simpleTextOuterGlow=null,this.simpleTextStroke=null,this.simpleTextImage=null,this.simpleTextVector=null,this.imageTransformCache={hash:"",dataUrl:"",dropShadowUrl:"",outerGlowUrl:"",width:0,height:0,left:0,top:0,started:0},this.imageTransformRunning=!1}}const WcBoxCache=new Map;function setWcBox(e,t,o){const i=t+(o?"_"+o:"");WcBoxCache.set(i,e)}function getWcBox(e,t){const o=e+(t?"_"+t:"");return WcBoxCache.get(o)}const BoxCacheEntries=new Map;function getOrCreateBoxCache(e){let t=BoxCacheEntries.get(e);return t||(t=new BoxCache,BoxCacheEntries.set(e,t)),t}class WcBox extends LitElement{constructor(e,t,o){var i,r;if(super(),this.selectedContentTool=null,this.refreshSimpleTextDebounced=debounce$1(600,(()=>{this.simpleText&&this.simpleText.generateSimpleTextUi(this)})),this.imageRefLastResult=html`<p>rendering image ...</p>`,this.imageRefLastResultForCropBackground=html`<p>rendering crop ...</p>`,this.previewTimeOutSimpleText=0,this.previewTimeOutPathText=0,this.meshScale=2,this.id=generateDBID(),this.imagePanOffsetX=0,this.imagePanOffsetY=0,!e)throw new Error("WcBox initialized without a box passed to constructor");this.parentBoxId=null!==(i=null==t?void 0:t.id)&&void 0!==i?i:null,this.parentBoxIdForEvaluation=null!==(r=null==o?void 0:o.id)&&void 0!==r?r:null,this.isInSelection=!1,this.isInMultiSelection=!1,this.hover=!1,this.cropImg=!1,this.cropDoc=!1,this.box=e,setWcBox(this,this.box.id,this.parentBoxIdForEvaluation),this.boxGeometry=e.boxGeometry.includeStyle(e.basics.class,e.autoSizeMode),this.pathGeometry=e.pathGeometry,this.simpleText=e.simpleText,this.transform=e.transform,this.effect=e.effect,this.imageRef=e.imageRef,this.docRef=e.docRef,this.pathText=e.pathText,this.zoom=1,this.refreshFlowIndex()}get boxGeometry(){return this._boxGeometry}set boxGeometry(e){this._boxGeometry=e}getPrimaryContentTool(){return this.box.storyRef||this.box.simpleText?"story":this.box.imageRef?"image":this.box.pathText?"pathText":this.box.pathGeometry?"path":this.box.docRef?"doc":null}hasBoxOpacity(){return!!(this.effect&&this.effect.opacity<100)}hasPerspectiveEditor(){if(scope().perspectiveEditorActive()){const e=scope().perspectiveEditor.boxRef;if(e&&e.box===this.box)return!0}if(scope().meshEditorActive()){const e=scope().meshEditor.boxRef;if(e&&e.box===this.box)return!0}return!1}static get properties(){return{isInMultiSelection:{type:Boolean},isInSelection:{type:Boolean},hover:{type:Boolean},crop:{type:Boolean},box:{type:Object,attribute:!1},boxGeometry:{type:Object,attribute:!1},simpleText:{type:Object,attribute:!1},pathText:{type:Object,attribute:!1},imageRef:{type:Object,attribute:!1},pathGeometry:{type:Object,attribute:!1},storyTextSvg:{type:Object,attribute:!1},storyFlowIndex:{type:Number},zoom:{type:Number}}}uniqueBoxId(){return this.box.id+"_"+this.parentBoxIdForEvaluation}refreshFlowIndex(){let e=0;this.box.storyRef&&(e=this.box.storyRef.flowIndex(this.box.id)),this.storyFlowIndex!==e&&(this.storyFlowIndex=e)}updated(){}replaceStoryTextSvg(e){if(this.shadowRoot){const t=this.shadowRoot.querySelector(".eddi-svg-frame");t===e?console_log("Skip replaceStoryTextSvg"):t&&t.parentNode&&e&&t.parentNode.replaceChild(e,t)}}getFeature(e){return"simpleText"===e&&this.simpleText?this.simpleText:"pathText"===e&&this.pathText?this.pathText:null}getParentDimensions(){if(this.parentBoxId){const e=scope().getBox(this.parentBoxId),t=scope().docUi.getWcBox(this.parentBoxId);if(e&&t){const o=t.boxGeometry.toPixel(e.spread.width(),e.spread.height());return{width:o.width,height:o.height}}}else{const e=scope().getBox(this.box.id);if(e)return{width:e.spread.width(),height:e.spread.height()}}return console.error("getParentDimensions: box ref not found. parent=",this.parentBoxId),{width:100,height:100}}getActiveElement(){if(this.shadowRoot){return this.shadowRoot.activeElement}return null}getFeatureFromWCBoxOrBox(e){switch(e){case"boxGeometry":return this.boxGeometry||this.box.boxGeometry;case"simpleText":return this.simpleText||this.box.simpleText;case"pathGeometry":return this.pathGeometry||this.box.pathGeometry;case"transform":return this.transform||this.box.transform;case"effect":return this.effect||this.box.effect;case"imageRef":return this.imageRef||this.box.imageRef;case"pathText":return this.pathText||this.box.pathText;case"docRef":return this.box.docRef;case"storyRef":return this.box.storyRef;case"basics":return this.box.basics;case"lock":return this.box.lock;default:assertNever$1(e)}}inverseZoomTransform(e){let t="";t=e-e*this.zoom+"px",console_log("ZOOOM="+this.zoom+"   1/ZOOM="+1/this.zoom);return"scale("+1/this.zoom+") translate("+t+","+t+")"}getMaskObject(){return{hasMaskImage:this.box.getValue("effect","maskActive",this),maskImage:this.box.getValue("effect","maskImage",this),maskChannel:this.box.getValue("effect","maskChannel",this),maskInverse:this.box.getValue("effect","maskInverse",this)}}setEffects(e,t,o){if(-1===this.box.effect.blurOmits.indexOf(e)&&(t.isBlurActive=this.box.getValue("effect","blurActive",this),t.blurRadius=new Length(this.box.getValue("effect","blurIntensity",this),"%")),-1===this.box.effect.dropOmits.indexOf(e)&&(t.isDropShadowActive=this.box.getValue("effect","dropActive",this),t.dropShadowBlendMode=this.box.getValue("effect","dropBlend",this),t.dropShadowBlurRadius=this.box.getValue("effect","dropBlurRadius",this).resolveEquations(o.width,o.height),t.dropShadowSpreadRadius=this.box.getValue("effect","dropSpreadRadius",this).resolveEquations(o.width,o.height),t.dropShadowOffsetX=this.box.getValue("effect","dropXoffset",this).resolveEquations(o.width,o.height),t.dropShadowOffsetY=this.box.getValue("effect","dropYoffset",this).resolveEquations(o.width,o.height),t.dropShadowColor=this.box.getValue("effect","dropColor",this).toPrintColor()),-1===this.box.effect.outGlowOmits.indexOf(e)&&(t.isOuterGlowActive=this.box.getValue("effect","outGlowActive",this),t.outerGlowBlendMode=this.box.getValue("effect","outGlowBlend",this),t.outerGlowBlurRadius=this.box.getValue("effect","outGlowBlurRadius",this).resolveEquations(o.width,o.height),t.outerGlowSpreadRadius=this.box.getValue("effect","outGlowSpreadRadius",this).resolveEquations(o.width,o.height),t.outerGlowOffsetX=this.box.getValue("effect","outGlowXoffset",this).resolveEquations(o.width,o.height),t.outerGlowOffsetY=this.box.getValue("effect","outGlowYoffset",this).resolveEquations(o.width,o.height),t.outerGlowColor=this.box.getValue("effect","outGlowColor",this).toPrintColor()),-1===this.box.effect.inShadowOmits.indexOf(e)&&(t.isInnerShadowActive=this.box.getValue("effect","inShadowActive",this),t.innerShadowBlendMode=this.box.getValue("effect","inShadowBlend",this),t.innerShadowBlurRadius=this.box.getValue("effect","inShadowBlurRadius",this).resolveEquations(o.width,o.height),t.innerShadowSpreadRadius=this.box.getValue("effect","inShadowSpreadRadius",this).resolveEquations(o.width,o.height),t.innerShadowOffsetX=this.box.getValue("effect","inShadowXoffset",this).resolveEquations(o.width,o.height),t.innerShadowOffsetY=this.box.getValue("effect","inShadowYoffset",this).resolveEquations(o.width,o.height),t.innerShadowColor=this.box.getValue("effect","inShadowColor",this).toPrintColor()),-1===this.box.effect.inGlowOmits.indexOf(e)&&(t.isInnerGlowActive=this.box.getValue("effect","inGlowActive",this),t.innerGlowBlendMode=this.box.getValue("effect","inGlowBlend",this),t.innerGlowBlurRadius=this.box.getValue("effect","inGlowBlurRadius",this).resolveEquations(o.width,o.height),t.innerGlowSpreadRadius=this.box.getValue("effect","inGlowSpreadRadius",this).resolveEquations(o.width,o.height),t.innerGlowOffsetX=this.box.getValue("effect","inGlowXoffset",this).resolveEquations(o.width,o.height),t.innerGlowOffsetY=this.box.getValue("effect","inGlowYoffset",this).resolveEquations(o.width,o.height),t.innerGlowColor=this.box.getValue("effect","inGlowColor",this).toPrintColor()),-1===this.box.effect.strokeOmits.indexOf(e)&&(t.isStrokeEffectActive=this.box.getValue("effect","strokeActive",this),t.strokeEffectBlendMode=this.box.getValue("effect","strokeBlend",this),t.strokeEffectBlurRadius=this.box.getValue("effect","strokeBlurRadius",this).resolveEquations(o.width,o.height),t.strokeEffectSpreadRadius=this.box.getValue("effect","strokeSpreadRadius",this).resolveEquations(o.width,o.height),t.strokeEffectOffsetX=this.box.getValue("effect","strokeXoffset",this).resolveEquations(o.width,o.height),t.strokeEffectOffsetY=this.box.getValue("effect","strokeYoffset",this).resolveEquations(o.width,o.height),t.strokeEffectColor=this.box.getValue("effect","strokeEffectColor",this).toPrintColor()),-1===this.box.effect.turbulenceOmits.indexOf(e)){const o="image"===e?this.meshScale:1;t.isTurbulenceActive=this.box.getValue("effect","turbulenceActive",this),t.turbulenceFrequency=this.box.getValue("effect","turbulenceFrequency",this)/o,t.turbulenceOctaves=this.box.getValue("effect","turbulenceOctaves",this),t.turbulenceScale=this.box.getValue("effect","turbulenceScale",this)*o}this.box.hasActiveFeature("imageRef")&&(t.hueRotateAngleInDegrees=this.box.getValue("effect","hueRotate",this),t.sepia=this.box.getValue("effect","sepia",this)/100,t.grayscale=this.box.getValue("effect","grayscale",this)/100,t.invert=this.box.getValue("effect","invert",this)/100,t.brightness=1+this.box.getValue("effect","brightness",this)/100,t.saturation=1+this.box.getValue("effect","saturate",this)/100,t.contrast=1+this.box.getValue("effect","contrast",this)/100),"image"!==e&&-1===this.box.effect.bevelOmits.indexOf(e)&&(t.isBevelActive=this.box.getValue("effect","bevelActive",this),t.bevelBlur=this.box.getValue("effect","bevelBlur",this),t.bevelPointLightX=this.box.getValue("effect","bevelPointLightX",this),t.bevelPointLightY=this.box.getValue("effect","bevelPointLightY",this),t.bevelPointLightZ=this.box.getValue("effect","bevelPointLightZ",this),t.bevelSurfaceScale=t.bevelBlur.value+1,t.bevelSpecularConstant=this.box.getValue("effect","bevelSpecularConstant",this),t.bevelSpecularExponent=this.box.getValue("effect","bevelspecularExponent",this),t.bevelLightColor=this.box.getValue("effect","bevelLightColor",this).toPrintColor()),t.innerShadowArea=this.box.getValue("effect","inShadowArea",this),t.innerGlowArea=this.box.getValue("effect","inGlowArea",this)}static get styles(){return[eddiStyles,css`
            :host, :host * {
                box-sizing: border-box;
            }

           
            :host { 
                pointer-events: auto;
                position: absolute;
                transition-property: opacity;
                transition-duration: 800ms;
                /*box-sizing: content-box !important;  the indication border should not change our dimensions */
            }

            .doc-ref-container.click-action:hover {
              filter: brightness(115%);
            }

            .badge {
                left: 0px;
             
                top: -16px;
                background-color: #649ae9;
                color: white;
                /*text-transform: uppercase;*/
                letter-spacing: 0.0em;
                font-size: 10px;
                font-family: Roboto, sans-serif;
                padding: 2px;
                padding-left: 5px;
                padding-right: 5px;
                position: absolute;
                transform-origin: 0% 100%;
            }

            .buyer-order-badge {
                left: 50%;
                top: 50%;
                background-color: red;
                color: white;
                min-width: 32px;  
                height: 32px;
                font-size: 20px;
                font-family: Roboto, sans-serif;
                text-align: center;
                padding-top: 4px;
                position: absolute;
                border-radius: 50%;
                transform-origin: 100% 100%;
            }
            .buyer-order-frame {
                content: '';
                left: 0;
                top: 0;
                right: 0; 
                bottom: 0;
                position: absolute;
                border: 4px solid red;
                transform-origin: 100% 100%;
            }

            .text-flow-badge {
                left: -16px;
                top: -16px;
                background-color: #cd4b78;
                color: white;
                min-width: 16px;
                height: 16px;
                font-size: 10px;
                font-family: Roboto, sans-serif;
                text-align: center;
                padding-top: 2px;
                position: absolute;
                border-radius: 50%;

                transform-origin: 100% 100%;


            }

            .text-overflow-badge {
                left: calc(100% - 5px);
                top: calc(70% - 5px);

                height: 10px;
                width: 10px;

                position: absolute;
                cursor: context-menu;

                transform-origin: 50% 50%;

            }

            svg.text {
                position: absolute;
                left: 0;
            }


            svg.text-on-path {
                position: absolute;
                pointer-events: none;
            }

            svg.image {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
            }

            .doc-ref-container {
                overflow: hidden;
                position: absolute;
                width: 100%;
                height: 100%;

            }
 
            .image-svg-wrapper {
                width: 100%; 
                height: 100%; 
                position: absolute; 
                top: 0; 
                left: 0; 
                pointer-events: none; /* Image overlaps frame and absorbs mouse events  */
            
            }

            .progress {
                position: absolute;
                z-index: 100;
                left: 0;
                top: 0;
                right: 0;
                bottom: 0;
                background-color: rgba(0, 0, 0, 0.3);
                
                display: flex;
                justify-content: center;
                align-items: center;
                flex-direction: column;
            }

            .spinner {
                width: 50px;
                height: 50px;
                border: 3px solid rgba(255, 255, 255, 0.5);
                border-radius: 50%;
                border-top-color: #fff;
              /*  kills safari on iOs 
                animation: spin 1s ease-in-out infinite;
                -webkit-animation: spin 1s ease-in-out infinite;
               */
            }

           .exit-text-edit {

              width: calc(var(--printess-frame-mover-size) * 6);
              height: calc(var(--printess-frame-mover-size) * 6);
              top: calc(var(--printess-frame-mover-size) * -6);
              left: 0;
              transform-origin: bottom left;
              position: absolute;
              cursor: pointer;
              border: 1px solid var(--printess-frameColor);
              background: white;
              padding: 2px;

            }
            .exit-text-edit:hover {
              box-shadow: 0px 0px 2px 0px rgba(0,0,0,0.5);
              border: 1px solid var(--printess-frameColorHover);;
            }
            .exit-text-edit > svg {
              pointer-events: none;
            }
            
            .image-pan-icon {
              width: calc(var(--printess-frame-mover-size) * 14);
              height: calc(var(--printess-frame-mover-size) * 14);
              top: calc(50% - var(--printess-frame-mover-size) * 7);
              left: calc(50% - var(--printess-frame-mover-size) * 7);
              transform-origin: center center;
              position: absolute;
              cursor: pointer;
              border: 2px solid rgba(0,0,0,0.4) ;/* var(--printess-frameColor);*/
              border-radius: 50%;
              padding: 0px;
            }
            .image-pan-icon :hover {
              box-shadow: 0px 0px 2px 0px rgba(0,0,0,0.5);
              border: 1px solid var(--printess-frameColorHover);;
            }
            .image-pan-icon > svg {
              pointer-events: none;
            }


            @keyframes spin {
                to {
                    -webkit-transform: rotate(360deg);
                }
            }
            @-webkit-keyframes spin {
                to {
                    -webkit-transform: rotate(360deg);
                }
            }


        `]}renderPathGeometry(){var e,t;if(!this.pathGeometry)return html``;const o=getOrCreateBoxCache(this.uniqueBoxId()),i=this.getParentDimensions(),r=this.boxGeometry.toPixel(i.width,i.height,!0);try{if(scope().pathEditorActive()){const e=this.pathGeometry.strokeWidth.toPixel(i.width,i.height);return this.pathGeometry.toSvg(!1,e,this.pathGeometry.strokeCap,this.pathGeometry.strokeJoin)}{let i;i="Rectangle"===this.pathGeometry.shape&&this.pathGeometry.shapeParams.radius>0?PathGeometry.createRoundedRectPath(this.pathGeometry.shapeParams,r.width,r.height).serialize(1).p:this.pathGeometry.serialize(1).p;const s=this.pathGeometry.closed,n=this.getFeatureFromWCBoxOrBox("imageRef");let a=!1;n&&(a="pathGeometry"===n.imageMasking);let l=this.box.getValue("pathGeometry","strokeWidth",this);if(a&&0===l.value)return html``;let c=this.box.getValue("pathGeometry","strokeAlign",this);const d=!1===this.box.getValue("pathGeometry","closed",this);let h=this.box.getValue("pathGeometry","fillColor",this).toPrintColor();(a||d)&&(h=ColorRef.None_Color().toPrintColor());let p=this.box.getValue("pathGeometry","strokeColor",this).toPrintColor();d&&(c="center",0===l.value&&this.isInSelection&&(p=null!==(t=null===(e=scope().currentDoc.layers.get(this.box.layerId))||void 0===e?void 0:e.color)&&void 0!==t?t:"red",l=new Length(1,"px")));const u=new GeneralShaper(i,s,r.width,r.height,l.toPixel(r.width,r.height)+"px",p,h,c,this.box.getValue("pathGeometry","strokeJoin",this),this.box.getValue("pathGeometry","strokeCap",this),!1,this.box.getValue("pathGeometry","strokeType",this),this.hasBoxOpacity());u.TaperTransform=this.box.taperTransform("path"),u.MeshTransform=this.box.meshTransform("path"),u.WarpTransform=this.box.warpTransform(this,"path"),u.dash1=this.box.getValue("pathGeometry","strokeDashFactor",this),u.gap1=this.box.getValue("pathGeometry","strokeGapFactor",this),u.paddingTop=this.box.getValue("basics","paddingLeft",this),u.paddingLeft=this.box.getValue("basics","paddingLeft",this),u.paddingBottom=this.box.getValue("basics","paddingBottom",this),u.paddingRight=this.box.getValue("basics","paddingRight",this),this.setEffects("path",u.effects,r);const m=u.getHash();if(m==o.pathGeometryCacheHash)return o.pathGeometryCache;if(o.pathGeometryCacheHash=m,u.effects.resultsInVector()){const e=parseSvg(u.buildSvg());if(e.style.position="absolute",e.style.top=u.adjustmentTop.toString()+"px",e.style.left=u.adjustmentLeft.toString()+"px",this.box.setOffsets("pathGeometry",u.adjustmentLeft,u.adjustmentTop,u.adjustmentRight,u.adjustmentBottom),u.effects.hasOuterEffect()){const t=u.buildImage(!1),i=-t.left+"px",r=-t.top+"px";t.div=document.createElement("div"),t.dropShadowElement&&(t.div.appendChild(t.dropShadowElement),setAbsoluteTopLeftBlend(t.dropShadowElement,r,i,u.effects.dropShadowBlendMode)),t.outerGlowElement&&(t.div.appendChild(t.outerGlowElement),setAbsoluteTopLeftBlend(t.outerGlowElement,r,i,u.effects.outerGlowBlendMode)),t.strokeElement&&(t.div.appendChild(t.strokeElement),setAbsoluteTopLeftBlend(t.strokeElement,r,i,u.effects.strokeEffectBlendMode)),t.div.appendChild(e),o.pathGeometryCache=html`${t.div}`,this.requestUpdate()}else o.pathGeometryCache=html`${e}`,this.requestUpdate()}else{const e=u.buildImage();this.box.setOffsets("pathGeometry",u.adjustmentLeft,u.adjustmentTop,u.adjustmentRight,u.adjustmentBottom),e.div.style.position="absolute",e.div.style.top=u.adjustmentTop.toString()+"px",e.div.style.left=u.adjustmentLeft.toString()+"px",o.pathGeometryCache=html`${e.div}`,this.requestUpdate()}}}catch(e){console.error("renderPathGeometry",e)}return o.pathGeometryCache}getRotationStyle(){return this.boxGeometry.cssRotation(!0,!1,this.box.basics.class,this.box.autoSizeMode)}getDynamicHostStyle(){var e,t;const o=[],i=getOrCreateBoxCache(this.uniqueBoxId());if(this.boxGeometry){const e=this.getParentDimensions();o.push(this.boxGeometry.css(e.width,e.height,!0,!1,this.box.basics.class,this.box.autoSizeMode,void 0,this.box.getValue("basics","mirrorX",this),this.box.getValue("basics","mirrorY",this)))}if(this.isInMultiSelection&&!this.box.boxGroupId){const e=scope().currentDoc.layers.get(this.box.layerId);e?o.push(`box-shadow: 0 0 0 ${1/this.zoom}px ${e.color};`):o.push(`box-shadow: 0 0 0 ${1/this.zoom}px green;`)}else this.hover&&o.push(`box-shadow: 0 0 0 ${1/this.zoom/2}px gray;`);if(i.imageTransformRunning&&o.push(`box-shadow: 0 0 0 ${4/this.zoom/2}px blue;`),this.hasPerspectiveEditor()&&o.push("outline: 1px solid gray;"),this.panImageRunning()&&!this.cropImg&&(o.push("outline: 2px dotted black;"),o.push("box-shadow: 0 0 0 2px white;")),"story"===scope().selectedTool&&this.box.storyRef&&this.box.storyRef.story===scope().eddiActiveStory&&(scope().eddiHasOverflow()?o.push(" box-shadow: 0 0 0 "+2/this.zoom+"px red;"):o.push(" box-shadow: 0 0 0 "+1/this.zoom+"px #ddd;")),this.box.lock&&this.box.lock.isUiElement)this.box.lock.hasClickAction&&o.push("cursor: pointer;"),o.push("z-index: var(--printess-z-index-click-action-boxes);");else if(this.box.basics.lockBox)o.push("pointer-events: none;");else{const e=scope().currentDoc.layers.get(this.box.layerId);e&&e.lock&&o.push("pointer-events: none;")}const r=[],s=this.effect,n=this.box.getValue("effect","blendMode",this),a=this.box.getValue("effect","opacity",this);if("normal"===n||scope().eddiActive()||o.push("mix-blend-mode: "+n+";"),100!==a?o.push("opacity: "+a/100+";"):o.push("opacity: 1.0;"),0!==this.boxGeometry.rotation&&scope().eddiActive()){let i=!1;for(const o of null!==(t=null===(e=scope().eddiActiveStory)||void 0===e?void 0:e.myBoxes.values())&&void 0!==t?t:[])if(o.box.id===this.box.id){i=!0;break}i&&o.push("background-color: rgba(255,255,255,0.5);")}if(null==s?void 0:s.dropActive){const e=scope().getBox(this.box.id);if(e){const t=e.spread.width(),o=e.spread.height();r.push("drop-shadow("+s.dropXoffset.toPixel(t,o)+"px "+s.dropYoffset.toPixel(o,t)+"px "+s.dropBlurRadius.toPixel_1Axis(t+o/2)+"px "+s.dropSpreadRadius.toPixel_1Axis(t+o/2)+"px "+s.dropColor.toCssColor()+")")}}return s&&(0!==s.brightness&&r.push("brightness("+(s.brightness+100)+"%)"),0!==s.contrast&&r.push("contrast("+(s.contrast+100)+"%)"),0!==s.hueRotate&&r.push("hue-rotate("+s.hueRotate+"deg)"),0!==s.saturate&&r.push("saturate("+(s.saturate+100)+"%)"),0!==s.grayscale&&r.push("grayscale("+s.grayscale+"%)"),0!==s.sepia&&r.push("sepia("+s.sepia+"%)"),0!==s.invert&&r.push("invert("+s.invert+"%)")),this.cropImg||this.cropDoc||(r.length=0),r.length&&o.push(" filter: "+r.join(" ")+";"),o.join("")}isZoomDepended(){var e;const t=!!this.storyFlowIndex,o=!this.isInSelection&&this.box.storyRef&&this.box.storyRef.story&&this.box.storyRef.story.boxHasOverflowIcon(this.box.id),i=!config.isMobile&&scope().eddiActiveStory===(null===(e=this.box.storyRef)||void 0===e?void 0:e.story),r="none"!==this.box.lock.buyerOrderNo,s=!(this.cropImg||!this.box.imageRef||!this.box.lock.hasChangeImageAllow());return this.hasBadge||t||o||i||r||s}get hasBadge(){return!(!scope().templateProperties.showStyleBadges||!this.box.basics.class||this.parentBoxIdForEvaluation||config.isMobile||config.isBuyer)}get badge(){return this.hasBadge?html`<div class="badge" style="transform: scale(${1/this.zoom});  background-color: ${scope().style_classNameColorLookUp(this.box.basics.class.split(" ")[0])};">${this.box.basics.class}</div>`:""}get hasMaskedSimpleText(){return this.box.hasActiveFeature("imageRef")&&"simpleText"===this.box.getValue("imageRef","imageMasking",this)}get isSimpleTextImage(){if(this.simpleText){if(-1===this.box.effect.inShadowOmits.indexOf("text")&&this.box.getValue("effect","inShadowActive",this))return!0;if(-1===this.box.effect.inGlowOmits.indexOf("text")&&this.box.getValue("effect","inGlowActive",this))return!0;if(-1===this.box.effect.blurOmits.indexOf("text")&&this.box.getValue("effect","blurActive",this))return!0;if(-1===this.box.effect.bevelOmits.indexOf("text")&&this.box.getValue("effect","bevelActive",this))return!0;if(-1===this.box.effect.turbulenceOmits.indexOf("text")&&this.box.getValue("effect","turbulenceActive",this))return!0}return!1}get imageTemplateResult(){return this.hasMaskedSimpleText&&this.isSimpleTextImage?html``:html`image stuff`}get simpleTextTemplateResult(){if(!this.simpleText)return html``;const e=getOrCreateBoxCache(this.uniqueBoxId());return this.isSimpleTextImage?html`
      ${e.simpleTextDropShadow?html`${e.simpleTextDropShadow}`:""}
      ${e.simpleTextOuterGlow?html`${e.simpleTextOuterGlow}`:""}
      ${e.simpleTextStroke?html`${e.simpleTextStroke}`:""}
      ${e.simpleTextImage}`:this.hasMaskedSimpleText?html``:html`
      ${e.simpleTextDropShadow?html`${e.simpleTextDropShadow}`:""}
      ${e.simpleTextOuterGlow?html`${e.simpleTextOuterGlow}`:""}
      ${e.simpleTextStroke?html`${e.simpleTextStroke}`:""}
      ${e.simpleTextVector}`}get showVectorImageMask(){const e=!(this.hasMaskedSimpleText&&this.isSimpleTextImage);return console_log("showVectorImageMask="+e),e}render(){var e;this.box.lastRenderTimeStamp=Date.now(),this.box.existingClassNames=new Set;for(const e of this.box.basics.class.split(" "))(e&&scope().style.classNameLookUp.has(e)||scope().currentDoc.hasClassName(e))&&this.box.existingClassNames.add(e);if(!this.box.getValue("basics","visible"))return html``;let t=null;if(this.box.lock.isUiElement&&"none"!==this.box.lock.boundToBoxSelection){const e=scope().selection.getSelectedBoxes();1===e.length&&e[0].lock.buyerOrderNo===this.box.lock.boundToBoxSelection||(t=config.isBuyer||config.isMobile?0:.5)}this.setAttribute("style",this.getDynamicHostStyle()),null!==t&&(this.style.opacity=t.toString()),this.simpleText&&(SimpleText.getText(this),this.refreshSimpleTextDebounced());return html`


${this.renderPathGeometry()}

${this.imageRef&&(this.cropImg||this.panImageRunning())?html`
    <div style="width: 100%; height: 100%; position: absolute; top: 0; left: 0; opacity: 0.3">${until(this.imageRef.getSvg(this,!0),this.imageRefLastResultForCropBackground)}</div>   
`:""}
            
${this.imageRef&&this.showVectorImageMask?until(this.imageRef.getSvg(this),this.imageRefLastResult):""}

${until(this.embeddedBoxes(),html``)} 

${this.simpleTextTemplateResult}
  
${this.pathText&&this.pathGeometry?until(this.pathText.getHtml(this),html`<p>generating path text ...</p>`):""}

${this.badge}

${this.box.storyRef&&this.box.storyRef.story?svg`${this.box.storyRef.story.getSvg(this.box.id,this.box.parentBoxIdForEvaluation)}`:""}

${this.storyFlowIndex?html`<div class="text-flow-badge" style="transform: scale(${1/this.zoom})">${this.storyFlowIndex}</div>`:""}

${"none"!==this.box.lock.buyerOrderNo?html`
  <div class="buyer-order-badge" style="transform: scale(${1/this.zoom})">${this.box.lock.buyerOrderNo}</div>
  `:""}

${!this.isInSelection&&this.box.storyRef&&this.box.storyRef.story&&this.box.storyRef.story.boxHasOverflowIcon(this.box.id)?html`<wc-icon @click=${this.textOverflowClick} class="text-overflow-badge"  
  style="transform: scale(${1/this.zoom}); width: 10px; height: 10px" 
  primaryColor="red"  icon="plus-square" ></wc-icon>`:""}        

${config.isMobile||config.isBuyer&&this.box.lock.hasOnlyTextContentAllow()||scope().eddiActiveStory!==(null===(e=this.box.storyRef)||void 0===e?void 0:e.story)||this.box.boxGroupId?"":html`
  <wc-icon style="transform: scale(${1/this.zoom});" 
          @mousedown=${e=>{e.stopImmediatePropagation(),scope().closeEddi()}} 
          class="exit-text-edit strict-no-zoom"  icon="arrows" primaryColor="frame"></wc-icon>`}

${this.hasImagePanIcon()?html`
  <wc-icon style="transform: scale(${1/this.zoom})  translate(${this.imagePanOffsetX*this.zoom+"px"},${this.imagePanOffsetY*this.zoom+"px"}); transition: ${this.panImageRunning()?"0.0s":"0.2s"} transform ease-out;" 
          @mousedown=${e=>{this.imagePanIconDown(e)}} 
          class="image-pan-icon strict-no-zoom"  icon="arrows-circle" primaryColor="arrows"></wc-icon>`:""}
 


    `}panImageRunning(){return 0!==this.imagePanOffsetX||0!==this.imagePanOffsetY}hasImagePanIcon(){if(!this.cropImg&&!this.cropDoc&&this.box.imageRef&&this.box.lock.hasChangeImageAllow()&&scope().selection.boxes.size>0&&scope().selection.has(this.box.id)){if(!this.box.lock.hasChangePositionAllow())return!0;const e=this.getParentDimensions(),t=this.boxGeometry.width.toPixel(e.width,e.height),o=this.boxGeometry.height.toPixel(e.width,e.height),i=14*config.moverSize()*(1/this.zoom),r=i;if(t>1.5*i&&o>1.5*r)return!0}return!1}imagePanIconDown(e){alert("Pan Down")}hasBuyerBorder(){return!(!config.isBuyer||!this.box.lock.hasFrameAllows(this.box))&&!this.isInSelection}textOverflowClick(){const e=scope().getBox(this.box.id);e&&(scope().selection=new Selection$1([this],e.spread,!1),scope().showTextFlowTool(e))}embeddedBoxes(){var e,t;return __awaiter$F(this,void 0,void 0,(function*(){if(this.docRef&&!this.parentBoxId){const o=scope().getDocByName(this.box.getValue("docRef","documentName"));if(o&&o!==scope().currentDoc){if(this.box.transform.anyTransformActive()||this.box.effect.blurActive||this.box.effect.inGlowActive||this.box.effect.inShadowActive||this.box.effect.turbulenceActive){const e=scope().serializeAll(!0,o.id),t=this.box.serialize("",o.id);e.dateISO="";const i=JSON.stringify([e,t]),r=yield sha1hex(i),s=getOrCreateBoxCache(this.uniqueBoxId());if(r!=s.subDocumentCache.hash){let e=()=>{};s.subDocumentPromise?yield s.subDocumentPromise:s.subDocumentPromise=new Promise(((t,o)=>{e=t}));const t=yield hb.Printess.renderSubDocumentImageAsDataUrl(scope().serializeAll(!0),scope().currentDoc.name,this.box.id);if(t.dataUrl){const e=yield loadImage(t.dataUrl);e.style.position="absolute",e.style.left=t.x+"px",e.style.top=t.y+"px",s.subDocumentTemplate=html`${e}`}else s.subDocumentTemplate=html``;s.subDocumentPromise=null,s.subDocumentCache.hash=r,e&&e()}return s.subDocumentTemplate}const i=DocRef.getSelectedSpread(this.box);let r="";this.box.lock.isUiElement&&this.box.lock.hasClickAction&&(r="click-action"),o.setTemporaryParentBoxId(this.box.id);const s=this.box.getValue("docRef","documentPlacement",this),n=this.box.getValue("docRef","horizontalFocalPointDocument",this),a=this.box.getValue("docRef","verticalFocalPointDocument",this),l=new Map;let c={ws:this.box.getValue("docRef","docWidthScale",this),hs:this.box.getValue("docRef","docHeightScale",this),px:this.box.getValue("docRef","docXPosition",this),py:this.box.getValue("docRef","docYPosition",this)};"crop"!==s&&(c=this.box.getDocRefPosition(this.docRef.documentName,s,n,a));const d=this.boxGeometry.toPixel(this.getParentDimensions().width,this.getParentDimensions().height),h=o.pageWidth*(d.width/o.pageWidth*c.px),p=o.pageHeight*(d.height/o.pageHeight*c.py),u=c.ws*(d.width/o.pageWidth),m=c.hs*(d.height/o.pageHeight);console_log(c);for(const[r,s]of i.boxes){let i=!0;const n=o.layers.get(s.layerId);if(n&&n.visibilityFormField){"OFF"===this.docRef.formFieldValues.get("LAYER_"+n.id)&&(i=!1)}if(i){let i=new Box((new Nobs).setProperty(s,"parentBoxIdForEvaluation",this.box.id),s);if(scope().fontsLoaded)if(i.storyRef&&i.storyRef.story&&"off"!==i.storyRef.autoTextMode){i.storyRef.story.render(this.box.id);const e=scope().getDocByName(o.name);if(e){const t=e.getBox(i.id);t&&(i=new Box((new Nobs).setProperty(t,"parentBoxIdForEvaluation",this.box.id),t))}}else null===(t=null===(e=i.storyRef)||void 0===e?void 0:e.story)||void 0===t||t.render(this.box.id);l.set(r,i)}}for(const e of l.values())if(e.basics.class&&(!e.storyRef||"off"===e.storyRef.autoTextMode)){const t=e.boxGeometry.includeStyle(e.basics.class,e.autoSizeMode,o),i=new Box((new Nobs).setProperty(e,"boxGeometry",t),e);l.set(i.id,i)}return"adjust"!==s?html`
          <div  class="doc-ref-container ${r}">
            <div  style="width: ${o.pageWidth}px; height: ${o.pageHeight}px; transform:  scale(${u},${m}); left: ${h}px; top: ${p}px; transform-origin: ${"top left"} " 
            class="doc-ref-container embedded-doc-repeater">
              ${boxRepeater(l,o,null,this.box,void 0,this.docRef.hideNonPrintableLayers)} 
            </div>
          </div>
          `:html`
            <div style="transform scale(0.5,0.5)" class="doc-ref-container ${r} embedded-doc-repeater">
              ${boxRepeater(l,o,this.box,this.box,void 0,this.docRef.hideNonPrintableLayers)} 
            </div>
                  `}}return html``}))}getWcBoxesWithStoryFromEmbeddedDocRepeater(e){const t=[];if(this.shadowRoot)for(const o of this.shadowRoot.querySelectorAll(".embedded-doc-repeater > WC-BOX")){const i=o.box;!i.storyRef||e&&i.storyRef.storyId!==e||t.push(o)}return t}}customElements.define("wc-box",WcBox);var boxTypeE,__awaiter$G=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};class ImageRef extends NobsBase{constructor(e,t){if(super(e,t),"string"==typeof e&&"object"==typeof t){const o=t;if(this.imageId=e,this.defaultImageId=o.def||"",this.imageMasking=o.m,this.imagePlacement=o.ip,this.imageXPosition=o.px,this.imageYPosition=o.py,this.imageWidthScale=o.ws,this.imageHeightScale=o.hs,this.horizontalFocalPoint=o.hc,this.verticalFocalPoint=o.vc,"object"!=typeof o.im)throw new Error("Can't create imageRef from Serialization, o.im is nothing");if("external"===o.im.t){const e=scope().images_getByUrl(o.im.u);e?this.imageId=e.id:this.externalImage=new Image$1("",o.im)}else"dataurl"===o.im.t?this.externalImage=new Image$1("",o.im):"fallback"!==o.im.t&&"printess-editor/img/default.png"!==o.im.u&&(scope().images.has(this.imageId)||create([new Image$1(this.imageId,o.im).serialize()]))}void 0===this.defaultImageId&&(this.defaultImageId=""),this.imageMasking||(this.imageMasking="none"),this.imagePlacement||(this.imagePlacement="fill"),void 0===this.horizontalFocalPoint&&(this.horizontalFocalPoint=.5),void 0===this.verticalFocalPoint&&(this.verticalFocalPoint=.5),this.imageXPosition||0===this.imageXPosition||(this.imageXPosition=0),this.imageYPosition||0===this.imageYPosition||(this.imageYPosition=0),(!this.imageWidthScale||this.imageWidthScale<=0)&&(this.imageWidthScale=1),(!this.imageHeightScale||this.imageHeightScale<=0)&&(this.imageHeightScale=1)}get hasKnownImageDimensions(){return!this.externalImage}get image(){if(this.externalImage)return this.externalImage;const e=scope().images.get(this.imageId);return e||Image$1.anyImage()}static createImageRef(e,t,o="none"){var i,r,s,n;!e&&scope().images.size>0&&(e=scope().images.values().next().value);const a={id:e?e.id:generateDBID(),im:e?e.serialize().data:Image$1.anyImage().serialize().data,ip:"fill",py:null!==(i=null==t?void 0:t.py)&&void 0!==i?i:0,px:null!==(r=null==t?void 0:t.px)&&void 0!==r?r:0,ws:null!==(s=null==t?void 0:t.ws)&&void 0!==s?s:1,hs:null!==(n=null==t?void 0:t.hs)&&void 0!==n?n:1,m:o,hc:.5,vc:.5};return new ImageRef(a.id,a)}src(){return this.toString()}cssUrl(){return this.toString()?"url('"+this.toString()+"')":"none"}css(){return this.toString()?`\n                background-image: url('${this.toString()}');\n                background-size: cover;\n                background-position: 35% 90%;\n            `:"none"}getSvg(e,t=!1){return __awaiter$G(this,void 0,void 0,(function*(){let o=e.getFeatureFromWCBoxOrBox("imageRef");const i=getOrCreateBoxCache(e.uniqueBoxId()),r=scope().getBox(e.box.id),s=e.cropImg||e.panImageRunning();if(!o||!r)return html``;console_log("++++ START RENDER IMAGE ++++");let n=e.box.getValue("imageRef","image",e);if(0===n.width||0===n.height){const e=yield getImageSizeAsync(n.url);if("string"==typeof e)return html`<div style="overflow-wrap: break-word; background: yellow; color: black; height: 100%;">${e}</div>`;n=new Image$1(n.id,n.url,"",e.width,e.height,n.type)}let a={ws:e.box.getValue("imageRef","imageWidthScale",e),hs:e.box.getValue("imageRef","imageHeightScale",e),px:e.box.getValue("imageRef","imageXPosition",e),py:e.box.getValue("imageRef","imageYPosition",e)};const l=e.box.getValue("imageRef","horizontalFocalPoint",e),c=e.box.getValue("imageRef","verticalFocalPoint",e),d=e.box.getValue("imageRef","imagePlacement",e),h=e.box.getValue("imageRef","imageMasking",e);"crop"===d&&"external"!==n.type||(a=e.box.getImagePosition(n,d,l,c));const p={id:n.id,m:h,ip:d,im:n.serialize().data,ws:a.ws,hs:a.hs,px:a.px,py:a.py,hc:l,vc:c};o=new ImageRef(p.id,p);const u=e.getParentDimensions(),m=e.boxGeometry.toPixel(u.width,u.height,!0),f=e.box.meshTransform("image",!1),g=e.box.meshTransform("image"),y=e.box.warpTransform(e,"image"),b=e.box.taperTransform("image"),v=new EffectsSet;e.setEffects("image",v,m);const x="simpleText"===h&&v.hasLevels()&&!(hasActiveWarpTransform(y)||b||g);let w=!1;const _=v.anyActive(),S=e.getMaskObject();if(!s&&(g||b||hasActiveWarpTransform(y)||_||S.hasMaskImage&&!t)){w=!0;const r=s,n=this.getImageTransformHash(m,f,b,y,v,o,x,S,r);if(n!==i.imageTransformCache.hash){let s;try{s=yield this.renderImageTransform(e,m,f,g,y,b,v,o,x,r)}catch(e){i.imageTransformCache.hash=n,s=!1}if(!1===s)return console_log("Exit renderImageTransform"),t?e.imageRefLastResultForCropBackground:e.imageRefLastResult}const a=o.image,p=new Image$1("T"+a.id,i.imageTransformCache.dataUrl,a.name,i.imageTransformCache.width,i.imageTransformCache.height,"dataurl").serialize().data,u={id:"T"+a.id,m:h,ip:d,im:p,ws:i.imageTransformCache.width/m.width/e.meshScale,hs:i.imageTransformCache.height/m.height/e.meshScale,px:i.imageTransformCache.left/m.width/e.meshScale,py:i.imageTransformCache.top/m.height/e.meshScale,hc:l,vc:c};x&&(u.ws=o.imageWidthScale,u.hs=o.imageHeightScale,u.px=o.imageXPosition,u.py=o.imageYPosition),o=new ImageRef(u.id,u)}const P=o.getImagePositionStyle(),C="CLIP"+e.box.id,T="IMG"+e.box.id;let A="",E=null;if(!t&&"simpleText"===o.imageMasking&&e.box.simpleText){yield e.box.simpleText.generateSimpleTextUi(e);let t=i.vectorCache.left,r=i.vectorCache.top;if(t-=m.width*o.imageXPosition,r-=m.height*o.imageYPosition,e.isSimpleTextImage)throw"This case should be covered by simple text rendering already... Should never reach here.";{const e=i.simpleTextVector;if(!e)throw"There should be a simple text svg.";{E=e.cloneNode(!0);const i=e.querySelector("[class=fnz-fill]");let s="";i&&(s=i.outerHTML);const n=E.querySelector("[class=fnz-fill]");n&&n.remove(),A=`<svg class="image" style="${P}" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> \n                        <defs>\n                            <clipPath \n                              transform="translate(${t} ${r})" ${"1"===e.dataset.isEvenOdd?'style="clip-rule:evenodd;"':""} \n                              id="${C}">${s}</clipPath>   \n                            <image preserveAspectRatio="none" id="${T}" \n                              href="${o.image.getConfigurationBasedImageUrl()}" height="100%" width="100%" />\n                        </defs> \n                        <g>\n                            <use clip-path="url(#${C})" href="#${T}"  />\n                        </g>\n                    </svg>                    \n                    `}}}else if(!t&&e.pathGeometry&&"pathGeometry"===o.imageMasking){let t;t="Rectangle"===e.pathGeometry.shape&&e.pathGeometry.shapeParams.radius>0?PathGeometry.createRoundedRectPath(e.pathGeometry.shapeParams,m.width,m.height).serialize(1).p:e.pathGeometry.serialize(1).p;const i=e.pathGeometry.closed,r=new GeneralShaper(t,i,m.width,m.height,"0px",e.box.getValue("pathGeometry","strokeColor",e).toPrintColor(),e.box.getValue("pathGeometry","fillColor",e).toPrintColor(),e.box.getValue("pathGeometry","strokeAlign",e),e.box.getValue("pathGeometry","strokeJoin",e),e.box.getValue("pathGeometry","strokeCap",e),!0,e.box.getValue("pathGeometry","strokeType",e),e.hasBoxOpacity());r.dash1=e.box.getValue("pathGeometry","strokeDashFactor",e),r.gap1=e.box.getValue("pathGeometry","strokeGapFactor",e),r.paddingTop=e.box.getValue("basics","paddingLeft",e),r.paddingLeft=e.box.getValue("basics","paddingLeft",e),r.paddingBottom=e.box.getValue("basics","paddingBottom",e),r.paddingRight=e.box.getValue("basics","paddingRight",e),r.TaperTransform=e.box.taperTransform("path"),r.MeshTransform=e.box.meshTransform("path"),r.WarpTransform=e.box.warpTransform(e,"path");const s=parseSvg(r.buildSvg());e.box.setOffsets("pathGeometry",r.adjustmentLeft,r.adjustmentTop,r.adjustmentRight,r.adjustmentBottom);let n=r.adjustmentLeft,a=r.adjustmentTop;n-=m.width*o.imageXPosition,a-=m.height*o.imageYPosition,A=`<svg class="image" style="${P}" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n                       <defs>\n                           <clipPath id="${C}" transform="translate(${n} ${a})" >\n                                ${s.innerHTML}\n                           </clipPath>\n                           <image preserveAspectRatio="none" id="${T}" href="${o.image.getConfigurationBasedImageUrl()}" height="100%" width="100%" />\n                       </defs>\n                       <g>\n                          <use clip-path="url(#${C})" href="#${T}"  />\n                       </g>\n                   </svg>`}else A=S.hasMaskImage&&!t&&s?`<svg class="image"  style="${P}"  xmlns="http://www.w3.org/2000/svg">\n                 ${this.getSvgMaskFilter(e,o.imageXPosition*-m.width,o.imageYPosition*-m.height,m.width,m.height)}\n                 ${_&&i.imageTransformCache.dropShadowUrl?`<image preserveAspectRatio="none" href="${i.imageTransformCache.dropShadowUrl}" height="100%" width="100%" style="mix-blend-mode:${v.dropShadowBlendMode}" />`:""}\n                 ${_&&i.imageTransformCache.outerGlowUrl?`<image preserveAspectRatio="none" href="${i.imageTransformCache.outerGlowUrl}" height="100%" width="100%" style="mix-blend-mode:${v.outerGlowBlendMode}" />`:""}\n                 <image preserveAspectRatio="none" filter="url(#mask)" id="${T}" href="${o.image.getConfigurationBasedImageUrl()}" height="100%" width="100%"/>\n              </svg>`:`<svg class="image"  style="${P}"  xmlns="http://www.w3.org/2000/svg">\n                   ${_&&i.imageTransformCache.dropShadowUrl?`<image preserveAspectRatio="none" href="${i.imageTransformCache.dropShadowUrl}" height="100%" width="100%" style="mix-blend-mode:${v.dropShadowBlendMode}" />`:""}\n                   ${_&&i.imageTransformCache.outerGlowUrl?`<image preserveAspectRatio="none" href="${i.imageTransformCache.outerGlowUrl}" height="100%" width="100%" style="mix-blend-mode:${v.outerGlowBlendMode}" />`:""}\n                   <image preserveAspectRatio="none" id="${T}" href="${o.image.getConfigurationBasedImageUrl()}" height="100%" width="100%"/>\n                </svg>`;const k=parseSvg(A);let I="";return"simpleText"===o.imageMasking||"pathGeometry"===o.imageMasking||w||t||(I="overflow:hidden;"),console_log("++++ END RENDER IMAGE ++++"),t?(e.imageRefLastResultForCropBackground=html`<div class="image-svg-wrapper" style="${I}">${k}</div>`,e.imageRefLastResultForCropBackground):(e.imageRefLastResult=html`<div class="image-svg-wrapper" style="${I}">${k}${E}</div>`,e.imageRefLastResult)}))}getSvgMaskFilter(e,t,o,i,r){const s=e.getMaskObject();return`<filter id="mask">\n      <feImage preserveAspectRatio="none" x="${t}" y="${o}" width="${i}" height="${r}" result="imageMask" href="${s.maskImage.url}"/>\n      \n      <feColorMatrix result="imageChannel" in="imageMask"\n        type="matrix"\n        values="0 0 0 0 0\n                0 0 0 0 0\n                0 0 0 0 0\n                0.3333 0.3333 0.3333 0 0" />\n     \n     <feComposite result="maskedImage" operator='${s.maskInverse?"out":"in"}' in2='imageChannel' in='SourceGraphic' />\n      \n    </filter>`}getImagePositionStyle(){return`left: ${100*this.imageXPosition}%; top: ${100*this.imageYPosition}%; width: ${100*this.imageWidthScale}%; height: ${100*this.imageHeightScale}%`}renderImageTransform(e,t,o=null,i,r,s,n,a,l,c){var d,h,p,u,m;return __awaiter$G(this,void 0,void 0,(function*(){const f=getOrCreateBoxCache(e.uniqueBoxId());if(0===a.image.width||0===a.image.height)throw new Error("meshTransformImage called with no image dimensions");if(f.imageTransformRunning)return!1;f.imageTransformRunning=!0,null===(d=getWcBox(e.box.id,e.parentBoxIdForEvaluation))||void 0===d||d.requestUpdate();const g=e.getMaskObject(),y=a.image.getConfigurationBasedImage(),b=new ImageTransformer(y.url,g,s,r,i,n);console_log("===> START RENDER MESH");const v=e.getParentDimensions(),x=e.boxGeometry.toPixel(v.width,v.height),w=x.width*a.imageWidthScale/y.width,_=a.imageXPosition*x.width/-w,S=_,P=_+y.width/a.imageWidthScale-_,C=x.height*a.imageHeightScale/y.height,T=a.imageYPosition*x.height/-C,A=T,E=T+y.height/a.imageHeightScale-T,k=x.width,I=x.height;let R;try{R=l?yield b.transform(0,0,y.width,y.height,y.width*e.meshScale,y.height*e.meshScale):yield b.transform(S,A,P,E,k*e.meshScale,I*e.meshScale)}finally{b.delete(),f.imageTransformRunning=!1,null===(h=getWcBox(e.box.id,e.parentBoxIdForEvaluation))||void 0===h||h.requestUpdate()}return R&&(f.imageTransformCache.dataUrl=null!==(p=R.imageDataUrl)&&void 0!==p?p:"",f.imageTransformCache.dropShadowUrl=null!==(u=R.dropShadowDataUrl)&&void 0!==u?u:"",f.imageTransformCache.outerGlowUrl=null!==(m=R.outerGlowDataUrl)&&void 0!==m?m:"",f.imageTransformCache.hash=this.getImageTransformHash(t,o,s,r,n,a,l,g,c),f.imageTransformCache.left=R.left,f.imageTransformCache.top=R.top,f.imageTransformCache.width=R.width,f.imageTransformCache.height=R.height,"none"===a.imageMasking&&e.box.setOffsets("imageRef",R.left/e.meshScale,R.top/e.meshScale,t.width-(R.width+R.left)/e.meshScale,t.height-(R.height+R.top)/e.meshScale)),!0}))}getImageTransformHash(e,t,o,i,r,s,n,a,l){const c=[],d=n?"Y":"N";if(c.push(d+e.height.toFixed(4)+"|"+e.width.toFixed(4)+"|"),o&&(c.push(Math.floor(1e5*o.bottomLeft.x).toString()+Math.floor(1e5*o.bottomLeft.y).toString()),c.push(Math.floor(1e5*o.bottomRight.x).toString()+Math.floor(1e5*o.bottomRight.y).toString()),c.push(Math.floor(1e5*o.topLeft.x).toString()+Math.floor(1e5*o.topLeft.y).toString()),c.push(Math.floor(1e5*o.topRight.x).toString()+Math.floor(1e5*o.topRight.y).toString())),t){for(const e of t.points)c.push(Math.floor(1e5*e.x).toString()+Math.floor(1e5*e.y).toString());c.push("r"+t.rows+"c"+t.cols)}return i&&c.push(JSON.stringify(i)),c.push(s.hash(l)),c.push(JSON.stringify(r)),c.push(JSON.stringify(a)),c.join("")}toString(){return this.image.url}static createAndAssignImage(e,t=!0){return __awaiter$G(this,void 0,void 0,(function*(){const o=[];for(const t of e){console_log(t);let e=t.original;if(t.original.width>2e3&&t.scaledVersions){const o=t.scaledVersions.sort(((e,t)=>e.width-t.width));for(const i of o)if(i.width>=1600){e=i,t.scaledVersions.unshift(t.original);break}}const i=config.isBuyer||config.isMobile?"Buyer Upload":"";o.push(new Image$1(e.id,e.url,t.fileName,e.width,e.height,"uploaded",t.scaledVersions,i))}const i=scope().resourcesImagesUi.getWcList();if(i){const e=yield i.createItems(o);if(e.length>0){const o=scope().images.get(e[0]);o&&t&&this.createOrAssignImage(o)}}return o}))}static uploadSingleFile(e,t,o=!0){return __awaiter$G(this,void 0,void 0,(function*(){const i=new TheUploader(uploadProvider(),t),r=yield i.uploadImage(e),s=yield this.createAndAssignImage([r],o);return s.length>0?s[0]:null}))}static upload(e,t,o=!0){return __awaiter$G(this,void 0,void 0,(function*(){const i=new TheUploader(uploadProvider(),t),r=yield i.uploadImages(e);return this.createAndAssignImage(r,o)}))}static createOrAssignImage(e,t){var o;"effect-mask"!==t?scope().selection.getSelectedBoxes().length>0?(null===(o=scope().selection.getSingleSelection())||void 0===o?void 0:o.box.getFeature("imageRef"))?scope().selection.assignImage(e):(new WcTipDialog).showDialog("addFeatureOrCreateBox").then((t=>{"addBox"===t?scope().createNewBox("auto",boxTypeE.image,void 0,void 0,void 0,void 0,e):"OK"===t&&scope().selection.assignImage(e)})):scope().createNewBox("auto",boxTypeE.image,void 0,void 0,void 0,void 0,e):scope().selection.assignEffectMaskImage(e)}serialize(){return{id:this.imageId,def:config.isMobile||config.isBuyer?this.defaultImageId:this.imageId,m:this.imageMasking,ip:this.imagePlacement,im:this.image.serialize().data,px:this.imageXPosition,py:this.imageYPosition,ws:this.imageWidthScale,hs:this.imageHeightScale,hc:this.horizontalFocalPoint,vc:this.verticalFocalPoint}}hash(e=!1){const t=this.serialize();return JSON.stringify(t,((t,o)=>!e||"px"!==t&&"py"!==t?"number"==typeof o?o.toFixed(4):o:0))}}!function(e){e.rect="rect",e.image="image",e.pathText="pathText",e.path="path",e.text="text",e.story="story",e.doc="doc"}(boxTypeE||(boxTypeE={}));const offsetKeys=["imageRef","pathText","simpleText","pathGeometry"];let Box=(()=>{class e extends NobsBase{constructor(t,o,i,r,s,n,a,l,c="off",d="text",h){var p,u;if(super(t,o),this._offsetLeft=0,this._offsetRight=0,this._offsetTop=0,this._offsetBottom=0,this._offsets=new Map,this.existingClassNames=void 0,this.lastRenderTimeStamp=0,e._lastFrameCreationTimestamp=Date.now(),!(t instanceof Nobs&&o instanceof e)){if(this.parentBoxIdForEvaluation="",this.id=i||generateDBID(),s&&(this.order=s),this.hasEmbeddedExpressions=!1,this.jsName="",this.snippetOrigin=null,this.boxGeometry=new BoxGeometry,this.basics=new Basics,config.isBuyer||config.isMobile?this.lock=new Lock(scope().currentDoc.lock.serialize()):this.lock=new Lock,this.pathGeometry=null,this.transform=new Transform,this.effect=new Effect,this.imageRef=null,this.pathText=null,this.simpleText=null,this.storyRef=null,t===boxTypeE.image&&(!l&&scope().images.size>0&&(l=scope().images.values().next().value),l?this.imageRef=ImageRef.createImageRef(l,this.getImagePosition(l)):t=boxTypeE.rect),t===boxTypeE.text)if("symbol"===d){const e=new FontRef(getSymbolFont());this.simpleText=new SimpleText({mode:"symbol",fnt:e.serialize(),txt:""})}else this.simpleText="barcode"===d?new SimpleText({mode:"barcode",txt:"123456"}):n?new SimpleText(n):new SimpleText;if(t===boxTypeE.pathText&&(this.pathGeometry=PathGeometry.createCirclePath(),this.pathText=new PathText),t===boxTypeE.path){const e=a?PathGeometry.getShapeGeneratorFunction(a):null;if(e){const t=e();this.pathGeometry=new PathGeometry((new Nobs).setProperty(t,"shape",a),t)}else{const e=PathGeometry.createBadgePath();this.pathGeometry=new PathGeometry((new Nobs).setProperty(e,"shape","Badge"),e)}}if(t===boxTypeE.doc){if(!h)for(const e of scope().docs.values())if(e!==scope().currentDoc){h=e.name;break}if(!h)throw"Can't create doc-ref-box, no second doc in scope found.";this.docRef=new DocRef(h,"")}if(t===boxTypeE.story){const e=new Story(generateDBID(),n||"");create([e.serialize()]),this.storyRef=new StoryRef(e.id,void 0,c)}if(r&&(setNextUndoStepForAll(!0),r.data.bg&&(this.boxGeometry=new BoxGeometry(r.data.bg)),r.data.so&&(this.snippetOrigin=r.data.so),r.data.ba&&(this.basics=new Basics(r.data.ba)),r.data.img&&(this.imageRef=new ImageRef(r.data.img.id,r.data.img)),r.data.doc&&(this.docRef=new DocRef(r.data.doc),this.hasEmbeddedExpressions=this.hasEmbeddedExpressions||this.docRef.spreadName.indexOf("${")>=0),r.data.story&&(this.storyRef=new StoryRef(r.data.story),this.hasEmbeddedExpressions=this.hasEmbeddedExpressions||null!==(u=null===(p=this.storyRef.story)||void 0===p?void 0:p.hasFormFields())&&void 0!==u&&u),r.data.stxt&&(this.simpleText=new SimpleText(r.data.stxt),this.hasEmbeddedExpressions=this.hasEmbeddedExpressions||this.simpleText.text.indexOf("${")>=0),r.data.ptxt&&(this.pathText=new PathText(r.data.ptxt),this.hasEmbeddedExpressions=this.hasEmbeddedExpressions||this.pathText.textOnPath.indexOf("${")>=0),r.data.path&&(this.pathGeometry=new PathGeometry(r.data.path)),r.data.trans&&(this.transform=new Transform(r.data.trans)),r.data.effect&&(this.effect=new Effect(r.data.effect)),r.data.lock&&(this.lock=new Lock(r.data.lock)),r.data.jsn&&(this.jsName=r.data.jsn),r.data.bgi&&(this.boxGroupId=r.data.bgi),r.data.lyr&&(this.layerId=r.data.lyr),this.order=r.data.or,setNextUndoStepForAll(!1)),this.boxGroupId||(this.boxGroupId=""),"string"==typeof o&&o&&(this.layerId=o),this.layerId||(this.layerId="BASELAYER"),this.order||(alert("Setting random box number"),this.order=.5*Math.random()),this.basics||(this.basics=new Basics),this.storyRef){const e=scope().getStory(this.storyRef.storyId);if(e){let t=!1;const o=Array.from(e.getBoxes().values());for(const i of o)i.box.id!==this.id&&i.box.storyRef&&i.box.storyRef.storyId===e.id&&i.box.storyRef.order===this.storyRef.order&&(t=!0);t&&(this.storyRef=new StoryRef(e.id,getOrder(e.getMaxOrder())))}}}}resetOffsets(){this._offsetLeft=0,this._offsetRight=0,this._offsetTop=0,this._offsetBottom=0}setOffsetsFromBox(e){this._offsets=e._offsets}setOffsets(e,t,o,i,r){this._offsets.set(e,{left:t,top:o,right:i,bottom:r});const s=this.getOffsets();Spread.setBoxOffsetInCache(this,"offsetBottom",s.bottom),Spread.setBoxOffsetInCache(this,"offsetTop",s.top),Spread.setBoxOffsetInCache(this,"offsetLeft",s.left),Spread.setBoxOffsetInCache(this,"offsetRight",s.right)}getOffset(e){var t;let o=0;for(const i of offsetKeys)if(this.getFeature(i)&&("imageRef"!==i||"none"===(null===(t=this.imageRef)||void 0===t?void 0:t.imageMasking))){const t=this._offsets.get(i);t&&t[e]<o&&(o=t[e])}return o}getOffsets(){var e;const t={left:0,top:0,right:0,bottom:0};for(const o of offsetKeys)if(this.getFeature(o)&&("imageRef"!==o||"none"===(null===(e=this.imageRef)||void 0===e?void 0:e.imageMasking))){const e=this._offsets.get(o);e&&(e.left<t.left&&(t.left=e.left),e.top<t.top&&(t.top=e.top),e.bottom<t.bottom&&(t.bottom=e.bottom),e.right<t.right&&(t.right=e.right))}return t}getOffsetCssProps(){const e=this.getOffsets();return`left: ${e.left}px; top:  ${e.top}px; right:  ${e.right}px; bottom:  ${e.bottom}px;`}get hasOffsets(){const e=this.getOffsets();return!!(Math.abs(e.left)>10||Math.abs(e.top)>10||Math.abs(e.bottom)>10||Math.abs(e.right)>10)}static get lastFrameCreationTimestamp(){return e._lastFrameCreationTimestamp}getAllVariables(e,t){if(e||((e=new VariableState("box")).lastRenderTimeStamp=this.lastRenderTimeStamp),this.basics.class)for(const t of this.basics.class.split(" "))t&&e.classNames.add(t);if(this.simpleText)for(const[o,i]of this.simpleText.usedFormFields){const r=t?o.split("#")[0]+"#"+t:o;e.formFields.set(r,i)}if(this.pathText)for(const[o,i]of this.pathText.usedFormFields.keys()){const r=t?o.split("#")[0]+"#"+t:o;e.formFields.set(r,i)}if(this.storyRef){const o=this.storyRef.story;if(o)for(const i of o.variableStates.states.values()){for(const t of i.classNames)e.classNames.add(t);for(const[o,r]of i.formFields)if(-1===o.indexOf("#")||o.indexOf("#"+t)>=0){const i=t?o.split("#")[0]+"#"+t:o;e.formFields.set(i,r)}}}if(this.docRef){const t=scope().getDocByName(this.docRef.documentName);t&&t.getAllVariables(e,this.id)}return e}get autoSizeMode(){return this.storyRef?this.storyRef.autoTextMode:"off"}get canHavePadding(){return!(!this.hasActiveFeature("storyRef")&&!this.hasActiveFeature("simpleText"))}getAllColorIDs(){const e=new Set;return this.pathGeometry&&(e.add(this.pathGeometry.fillColor.color.id),this.pathGeometry.strokeWidth.value>0&&e.add(this.pathGeometry.strokeColor.color.id)),this.simpleText&&(e.add(this.simpleText.fontColor.color.id),this.simpleText.fontStrokeWidth.value>0&&e.add(this.simpleText.fontStrokeColor.color.id)),this.pathText&&(e.add(this.pathText.pathTextFontColor.color.id),this.pathText.pathTextStrokeWidth.value>0&&e.add(this.pathText.pathTextStrokeColor.color.id)),e}hasActiveFeature(e){let t=this.getFeature(e);if(t||"storyRef"!==e||(t=this.getFeature("simpleText")),t&&"transform"===e){const e=t;return e.warpArcActive||e.warpArchActive||e.warpCupActive||e.warpCustomActive||e.warpFishActive||e.warpFlagActive||e.warpPitActive||e.perspectiveActive||e.meshActive||e.distortActive}if(t&&"effect"===e){const e=t;return 100!==e.opacity||"normal"!==e.blendMode||e.turbulenceActive||e.dropActive||e.outGlowActive||e.inShadowActive||e.inGlowActive||e.strokeActive||e.bevelActive||e.maskActive||"normal"!==e.blendMode||e.blurActive}if(t&&"lock"===e){const e=t;return e.hasFrameAllows(this)||e.isUiElement}return null!=t}getFeature(e){switch(e){case"boxGeometry":return this.boxGeometry;case"simpleText":return this.simpleText;case"pathGeometry":return this.pathGeometry;case"transform":return this.transform;case"imageRef":return this.imageRef;case"pathText":return this.pathText;case"docRef":return this.docRef;case"storyRef":return this.storyRef;case"basics":return this.basics;case"effect":return this.effect;case"lock":return this.lock}}getValue(e,t,o){let i;if(this.parentBoxIdForEvaluation){const e=scope().getBox(this.id);e&&(i=e.doc,i.setTemporaryParentBoxId(this.parentBoxIdForEvaluation))}null==o||o.parentBoxIdForEvaluation;const r=scope().getStyleProperty(this.basics.class,t,void 0,void 0,i);if(r)return r.value;let s;if(s=o?o.getFeatureFromWCBoxOrBox(e):this.getFeature(e),s&&Object.prototype.hasOwnProperty.call(s,t))return s[t];if(s instanceof ImageRef&&"image"===t)return s[t];if(s instanceof Effect&&"maskImage"===t)return s[t];throw"Can not get Value, Property ("+t+") type does not match or Feature ("+e+") does not exists "}niemalsaufgerufen(){alert("nscht ")}getValueExtended(e,t){if("class"!==t){const e=scope().getStyleProperty(this.basics.class,t);if(e)return{value:e.value,selector:e.selector,origin:"class"}}const o=this.getFeature(e);if(o&&Object.prototype.hasOwnProperty.call(o,t)){return{value:o[t],selector:null,origin:"box"}}if(o&&("image"===t&&"imageRef"===e||"maskImage"===t&&"effect"===e))return{value:o[t],selector:null,origin:"box"};throw"Can not get Value, Property ("+t+") type does not match or Feature ("+e+") does not exists "}serialize(e,t,o=!1,i=!1,r,s=!0,n){const a={or:this.order,bg:(r||this.boxGeometry).serialize(),so:this.snippetOrigin,ba:this.basics.serialize(),lyr:this.layerId,lock:this.lock.serialize(),spreadId:e};if(this.imageRef&&(a.img=this.imageRef.serialize()),this.simpleText&&(a.stxt=this.simpleText.serialize(),n&&this.simpleText.hasFormField)){const e=evaluateText(n,"${form.BOX_STEXT_"+this.id+"}");null!==e.text?a.stxt.txt=e.text:a.stxt.txt=e.errors.join(" - ")}if(this.pathText&&(a.ptxt=this.pathText.serialize(),n&&this.pathText.hasFormField)){const e=evaluateText(n,"${form.BOX_PTEXT_"+this.id+"}");null!==e.text?a.ptxt.txt=e.text:a.ptxt.txt=e.errors.join(" - ")}if(this.pathGeometry&&(a.path=this.pathGeometry.serialize()),this.transform&&(a.trans=this.transform.serialize()),this.effect&&(a.effect=this.effect.serialize()),this.docRef&&(a.doc=this.docRef.serialize()),this.storyRef&&(a.story=this.storyRef.serialize(i)),this.jsName&&(a.jsn=this.jsName),this.boxGroupId&&(a.bgi=this.boxGroupId),s&&this.storyRef){const e=this.storyRef.story;if(e){const t=e.svgCache.get(e.getCacheKey(this.id,n||null));if(t)a.storySvg=t.svg.outerHTML;else{const t=e.getSvg(this.id,this.parentBoxIdForEvaluation,"serialize");t&&"string"!=typeof t&&(a.storySvg=t.outerHTML)}}}return{type:"box",id:o?generateDBID():this.id,scopeId:scope().id,parentId:t,data:a}}getStyleProperty(e){return scope().getStyleProperty(this.basics.class,e)}taperTransform(e){let t=null;const o=this.getValue("transform","perspectiveActive");if(this.transform&&o&&-1===this.transform.perspectiveOmits.indexOf(e)&&this.transform.perspectiveGeometry&&5===this.transform.perspectiveGeometry.path.length){const e=this.transform.perspectiveGeometry.serialize(1).p,o=this.getStyleProperty("transformTopLeftX"),i=this.getStyleProperty("transformTopLeftY"),r=this.getStyleProperty("transformTopRightX"),s=this.getStyleProperty("transformTopRightY"),n=this.getStyleProperty("transformBottomRightX"),a=this.getStyleProperty("transformBottomRightY"),l=this.getStyleProperty("transformBottomLeftX"),c=this.getStyleProperty("transformBottomLeftY");let d=o?o.value:e[0].x;const h=i?i.value:e[0].y,p=r?r.value:e[1].x,u=s?s.value:e[1].y,m=n?n.value:e[2].x,f=a?a.value:e[2].y,g=l?l.value:e[3].x,y=c?c.value:e[3].y;d||(d=e[0].x),t={topLeft:{x:d/100,y:h/100},topRight:{x:p/100,y:u/100},bottomRight:{x:m/100,y:f/100},bottomLeft:{x:g/100,y:y/100}}}return t}meshTransform(e,t=!0){let o=null;const i=this.getValue("transform","meshActive");if(this.transform&&i&&-1===this.transform.meshOmits.indexOf(e)&&this.transform.meshGeometry&&this.transform.meshGeometry.isGrid()){let e=this.transform.meshGeometry;if(t&&(this.transform.meshRows<20||this.transform.meshColumns<20)){const t=Math.max(this.transform.meshRows,20),o=Math.max(this.transform.meshColumns,20);e=this.transform.meshGeometry.getAdjustedGridPath(o,t)}const i=[];for(const t of e.path)i.push({x:t.x/100,y:t.y/100});o={cols:e.gridColumns,rows:e.gridRows,points:i}}return o}warpTransform(e,t){if(!this.transform)return null;const o=-this.getValue("transform","warpFishHeightFraction",e),i=-this.getValue("transform","warpFlagHeightFraction",e),r=this.getValue("transform","warpArcPosition",e);let s=-this.getValue("transform","warpArcHeightFraction",e);"bulge"===r&&(s/=2);const n=this.getValue("transform","warpPitPosition",e);let a=-this.getValue("transform","warpPitHeightFraction",e);return"squeeze"===n&&(a/=2),{distortActive:this.getValue("transform","distortActive",e)&&-1===this.getValue("transform","distortOmits",e).indexOf(t),distortFrequency:this.getValue("transform","distortFrequency",e),distortOctaves:this.getValue("transform","distortOctaves",e),distortScale:this.getValue("transform","distortScale",e),distortSeed:1985,warpArchActive:this.getValue("transform","warpArchActive",e)&&-1===this.getValue("transform","warpArchOmits",e).indexOf(t),warpArchPhi:this.getValue("transform","warpArchPhi",e),warpArchPosition:this.getValue("transform","warpArchPosition",e),warpArchMirror:this.getValue("transform","warpArchMirror",e),warpCupActive:this.getValue("transform","warpCupActive",e)&&-1===this.getValue("transform","warpCupOmits",e).indexOf(t),warpCupY:this.getValue("transform","warpCupY",e),warpCupPhi:this.getValue("transform","warpCupPhi",e),warpFishActive:this.getValue("transform","warpFishActive",e)&&-1===this.getValue("transform","warpFishOmits",e).indexOf(t),warpFishHeightFraction:o,warpFishWaves:this.getValue("transform","warpFishWaves",e),warpFlagActive:this.getValue("transform","warpFlagActive",e)&&-1===this.getValue("transform","warpFlagOmits",e).indexOf(t),warpFlagHeightFraction:i,warpFlagWaves:this.getValue("transform","warpFlagWaves",e),warpFlagPhase:this.getValue("transform","warpFlagPhase",e),warpArcActive:this.getValue("transform","warpArcActive",e)&&-1===this.getValue("transform","warpArcOmits",e).indexOf(t),warpArcPosition:r,warpArcHeightFraction:s,warpPitActive:this.getValue("transform","warpPitActive",e)&&-1===this.getValue("transform","warpPitOmits",e).indexOf(t),warpPitPosition:n,warpPitHeightFraction:a,warpCustomActive:this.getValue("transform","warpCustomActive",e)&&-1===this.getValue("transform","warpCustomOmits",e).indexOf(t),warpCustomTopTransform:this.getValue("transform","warpCustomTopTransform",e),warpCustomTopWaves:this.getValue("transform","warpCustomTopWaves",e),warpCustomTopPhase:this.getValue("transform","warpCustomTopPhase",e),warpCustomTopHeightFraction:this.getValue("transform","warpCustomTopHeightFraction",e),warpCustomBottomTransform:this.getValue("transform","warpCustomBottomTransform",e),warpCustomBottomWaves:this.getValue("transform","warpCustomBottomWaves",e),warpCustomBottomPhase:this.getValue("transform","warpCustomBottomPhase",e),warpCustomBottomHeightFraction:this.getValue("transform","warpCustomBottomHeightFraction",e)}}addSvgFilters(e,t,o,i){this.effect}static appendSvgFilters(e,t){const o=parseSvg(t).getElementsByTagNameNS("http://www.w3.org/2000/svg","filter")[0];for(;o.children.length;)e.appendChild(o.children[0])}appendBevelFilter(e,t){const o=parseSvg(`<svg xmlns="http://www.w3.org/2000/svg"  >           <filter >\n                <feGaussianBlur in="SourceAlpha" stdDeviation="${t}" result="blur"/>\n                <feSpecularLighting in="blur" surfaceScale="5" specularConstant="0.5" specularExponent="10" result="specOut" lighting-color="white">\n                    <fePointLight x="-5000" y="-5000" z="8000"/>\n                </feSpecularLighting>\n                <feComposite in="specOut" in2="SourceAlpha" operator="in" result="specOut2"/>\n                <feComposite in="SourceGraphic" in2="specOut2" operator="arithmetic" k1="0" k2="1" k3="1" k4="0" result="litPaint" />\n            </filter></svg>`).getElementsByTagNameNS("http://www.w3.org/2000/svg","filter")[0];for(;o.children.length;)e.appendChild(o.children[0])}appendExtrusionFilter(e){const t=parseSvg('<svg xmlns="http://www.w3.org/2000/svg" viewBox="-10 -10 120 100">\n           \n            <filter >\n                <feConvolveMatrix order="4,4" \n                    kernelMatrix="\n                    1 0 0 0\n                    0 1 0 0\n                    0 0 1 0 \n                    0 0 0 1" in="SourceAlpha" result="BEVEL" />\n                \n                \x3c!-- offset extrusion: --\x3e\n                \n                <feOffset dx="0" dy="0" in="BEVEL" result="OFFSET" />\n                \n                \x3c!-- merge offset with Source: --\x3e\n                \n                <feMerge>\n                    <feMergeNode in="OFFSET" />\n                    <feMergeNode in="SourceGraphic" />\n                </feMerge>\n            </filter>\n         \n        </svg>').getElementsByTagNameNS("http://www.w3.org/2000/svg","filter")[0];for(;t.children.length;)e.appendChild(t.children[0])}appendTurbulenceFilter(e){const t=parseSvg('<svg version="1.1"   xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n\n            <defs>\n            \n            <filter id="displacementFilter">\n    <feTurbulence type="turbulence" baseFrequency="0.2" numOctaves="2" result="turbulence"/>\n        <feDisplacementMap in2="turbulence" in="SourceGraphic"  scale="50" xChannelSelector="R" yChannelSelector="G"/>\n </filter>\n </defs></svg>').getElementsByTagNameNS("http://www.w3.org/2000/svg","filter")[0];for(;t.children.length;)e.appendChild(t.children[0])}appendFancySvgFilter(e){const t=parseSvg('<svg version="1.1"   xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n\n            <defs>\n            <filter id="filter" width="150%" height="160%" x="-25%" y="-25%">\n            \x3c!-- COLORS --\x3e\n                <feFlood flood-color="#16B5FF" result="COLOR-blue" />\n                <feFlood flood-color="#9800FF" result="COLOR-violet" />\n                <feFlood flood-color="#A64DFF" result="COLOR-violet-light" />\n            \x3c!-- COLORS END --\x3e\n        \n            \x3c!-- BOTTOM SPLASH --\x3e\n                <feTurbulence baseFrequency="0.05" type="fractalNoise" numOctaves="1" seed="2" result="BOTTOM-SPLASH_10" />\n                <feGaussianBlur stdDeviation="6.5"  in="SourceAlpha" result="BOTTOM-SPLASH_20" />\n                <feDisplacementMap scale="420" in="BOTTOM-SPLASH_20" in2="BOTTOM-SPLASH_10" result="BOTTOM-SPLASH_30"/>\n                <feComposite operator="in" in="COLOR-blue" in2="BOTTOM-SPLASH_30" result="BOTTOM-SPLASH_40" />\n            \x3c!-- BOTTOM END --\x3e\n        \n            \x3c!-- MIDDLE SPLASH --\x3e\n                <feTurbulence baseFrequency="0.1" type="fractalNoise" numOctaves="1" seed="1" result="MIDDLE-SPLASH_10" />\n                <feGaussianBlur in="SourceAlpha" stdDeviation="0.1" result="MIDDLE-SPLASH_20" />\n                <feDisplacementMap in="MIDDLE-SPLASH_20" in2="MIDDLE-SPLASH_10" scale="25" result="MIDDLE-SPLASH_30"/>\n                <feComposite in="COLOR-violet-light" in2="MIDDLE-SPLASH_30" operator="in" result="MIDDLE-SPLASH_40" />\n            \x3c!-- MIDDLE END --\x3e\n        \n            \x3c!-- TOP SPLASH --\x3e\n                <feTurbulence baseFrequency="0.07" type="fractalNoise" numOctaves="1" seed="1" result="TOP-SPLASH_10" />\n                <feGaussianBlur stdDeviation="3.5" in="SourceAlpha" result="TOP-SPLASH_20" />\n                <feDisplacementMap scale="220" in="TOP-SPLASH_20" in2="TOP-SPLASH_10" result="TOP-SPLASH_30"/>\n                <feComposite operator="in" in="COLOR-violet" in2="TOP-SPLASH_30" result="TOP-SPLASH_40" />\n            \x3c!-- TOP END --\x3e\n        \n            \x3c!-- LIGHT EFFECTS --\x3e\n                <feMerge  result="LIGHT-EFFECTS_10">\n                    <feMergeNode in="BOTTOM-SPLASH_40" />\n                    <feMergeNode in="MIDDLE-SPLASH_40" />\n                    <feMergeNode in="TOP-SPLASH_40" />\n                </feMerge>\n                <feColorMatrix type="matrix"\n                    values="0 0 0 0 0,\n                    0 0 0 0 0,\n                    0 0 0 0 0,\n                    0 0 0 1 0" in="LIGHT-EFFECTS_10" result="LIGHT-EFFECTS_20" />\n                <feGaussianBlur stdDeviation="2" in="LIGHT-EFFECTS_20" result="LIGHT-EFFECTS_30" />\n                <feSpecularLighting surfaceScale="5" specularConstant=".75" specularExponent="30" lighting-color="#white" in="LIGHT-EFFECTS_30" result="LIGHT-EFFECTS_40">\n                    <fePointLight x="-50" y="-100" z="400" />\n                </feSpecularLighting>\n                <feComposite operator="in" in="LIGHT-EFFECTS_40" in2="LIGHT-EFFECTS_20" result="LIGHT-EFFECTS_50"/>\n                <feComposite operator="arithmetic" k1="0" k2="1" k3="1" k4="0" in="LIGHT-EFFECTS_10" in2="LIGHT-EFFECTS_50" result="LIGHT-EFFECTS_60"/>\n                    \n                </filter>\n             \n            </defs>\n      </svg>').getElementsByTagNameNS("http://www.w3.org/2000/svg","filter")[0];for(;t.children.length;)e.appendChild(t.children[0])}appendFancySvgFilter2(e){const t=parseSvg('<svg version="1.1"   xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n\n            <defs>\n            <filter id="filter" filterUnits="userSpaceOnUse">\n            \x3c!-- COLORS --\x3e\n              <feFlood flood-color="#663300" result="COLOR-red"></feFlood>\n              <feFlood flood-color="#D7A500" result="COLOR-y"></feFlood>\n            \x3c!-- COLORS END --\x3e\n  \n            \x3c!-- STRIPE FILL --\x3e\n                <feImage xlink:href="data:image/svg+xml;charset=utf-8,%3Csvg%20version%3D%221.1%22%20id%3D%22Untitled-Seite_x25_201%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20xmlns%3Axlink%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxlink%22%20width%3D%2210px%22%20height%3D%224px%22%3E%0A%3Crect%20fill%3D%22%239F6B00%22%20width%3D%2210%22%20height%3D%222%22%2F%3E%3C%2Fsvg%3E" x="0" y="0" width="10" height="4" result="STRIPE FILL_10"></feImage>\n              <feTile in="STRIPE FILL_10" result="STRIPE FILL_20"></feTile>\n              <feComposite operator="in" in="STRIPE FILL_20" in2="SourceAlpha" result="STRIPE FILL_30"></feComposite>\n            \x3c!-- STRIPE FILL END --\x3e\n  \n            \x3c!-- THIN BEVEL --\x3e\n              <feMorphology operator="dilate" radius="2" in="SourceAlpha" result="THIN-BEVEL_10"></feMorphology>\n              <feComposite operator="out" in="THIN-BEVEL_10" in2="SourceAlpha" result="THIN-BEVEL_20"></feComposite>\n              <feComposite operator="in" in="COLOR-y" in2="THIN-BEVEL_20" result="THIN-BEVEL_30"></feComposite>\n            \x3c!-- THIN BEVEL END --\x3e\n  \n            \x3c!-- OUTER BEVEL --\x3e\n            <feConvolveMatrix order="8,8" divisor="1" kernelMatrix="1 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 1 " in="SourceGraphic" result="OUTER-BEVEL_10"></feConvolveMatrix>\n              <feOffset dx="4" dy="4" in="OUTER-BEVEL_10" result="OUTER-BEVEL_20"></feOffset>\n              <feComposite operator="in" in="COLOR-red" in2="OUTER-BEVEL_20" result="OUTER-BEVEL_30"></feComposite>\n             \x3c!-- OUTER BEVEL END --\x3e\n  \n            \x3c!-- INNER BEVEL --\x3e\n              <feOffset in="SourceAlpha" dx="4" dy="4" result="INNER-BEVEL_10"></feOffset>\n              <feComposite operator="out" in="SourceAlpha" in2="INNER-BEVEL_10" result="INNER-BEVEL_20"></feComposite>\n              <feComposite in="COLOR-red" operator="in" in2="INNER-BEVEL_20" result="INNER-BEVEL_30"></feComposite>\n            \x3c!--  INNER BEVEL END --\x3e\n  \n            \x3c!-- FAT OUTLINE --\x3e\n              <feMorphology operator="dilate" radius="6" in="OUTER-BEVEL_30" result="FAT-OUTLINE_10"></feMorphology>\n              <feComposite operator="in" in="COLOR-y" in2="FAT-OUTLINE_10" result="FAT-OUTLINE_20"></feComposite>\n            \x3c!-- FAT OUTLINE END --\x3e\n  \n              <feMerge result="merge2">\n                <feMergeNode in="FAT-OUTLINE_20"></feMergeNode>\n                <feMergeNode in="OUTER-BEVEL_30"></feMergeNode>\n                <feMergeNode in="STRIPE FILL_30"></feMergeNode>\n                <feMergeNode in="INNER-BEVEL_30"></feMergeNode>\n                <feMergeNode in="THIN-BEVEL_30"></feMergeNode>\n              </feMerge>\n            </filter>\n             \n            </defs>\n      </svg>').getElementsByTagNameNS("http://www.w3.org/2000/svg","filter")[0];for(;t.children.length;)e.appendChild(t.children[0])}appendExtrude3d(e){const t=parseSvg('<svg version="1.1"   xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n\n            <defs>\n            <filter id="filter">\n            \x3c!-- COLORS --\x3e\n              <feFlood flood-color="#582D1B" result="COLOR-red"></feFlood>\n            \x3c!-- COLORS END --\x3e\n    \n            \x3c!-- FRACTAL TEXTURE --\x3e\n              <feTurbulence baseFrequency=".05,.004" top="-50%" type="fractalNoise" numOctaves="4" seed="0" result="FRACTAL-TEXTURE_10"></feTurbulence>\n              <feColorMatrix type="matrix" values="0 0 0 0 0,\n              0 0 0 0 0,\n              0 0 0 0 0,\n              0 0 0 -1.2 1.1" in="FRACTAL-TEXTURE_10" result="FRACTAL-TEXTURE_20"></feColorMatrix>\n            \x3c!-- FRACTAL TEXTURE END --\x3e\n    \n            \x3c!-- STROKE --\x3e\n              <feMorphology operator="dilate" radius="4" in="SourceAlpha" result="STROKE_10"></feMorphology>\n            \x3c!-- STROKE END --\x3e\n    \n            \x3c!-- EXTRUDED BEVEL --\x3e\n             <feConvolveMatrix order="8,8" divisor="1" kernelMatrix="1 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 1" in="STROKE_10" result="BEVEL_20"></feConvolveMatrix>\n    \n              <feOffset dx="4" dy="4" in="BEVEL_20" result="BEVEL_25"></feOffset>\n              <feComposite operator="out" in="BEVEL_25" in2="STROKE_10" result="BEVEL_30"></feComposite>\n              <feComposite in="COLOR-red" in2="BEVEL_30" operator="in" result="BEVEL_40"></feComposite>\n              <feMerge result="BEVEL_50">\n                <feMergeNode in="BEVEL_40"></feMergeNode>\n                <feMergeNode in="SourceGraphic"></feMergeNode>\n              </feMerge>\n             \x3c!-- EXTRUDED BEVEL END --\x3e\n    \n            <feComposite in2="FRACTAL-TEXTURE_20" in="BEVEL_50" operator="in"></feComposite>\n          </filter>\n            </defs>\n      </svg>').getElementsByTagNameNS("http://www.w3.org/2000/svg","filter")[0];for(;t.children.length;)e.appendChild(t.children[0])}appendExtrude3d_2(e){const t=parseSvg('<svg version="1.1"   xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n\n            <defs>\n            <filter id="filter">\n            \x3c!-- COLORS --\x3e\n              <feFlood flood-color="#582D1B" result="COLOR-red"></feFlood>\n            \x3c!-- COLORS END --\x3e\n     \n            \x3c!-- STROKE --\x3e\n              <feMorphology operator="dilate" radius="4" in="SourceAlpha" result="STROKE_10"></feMorphology>\n            \x3c!-- STROKE END --\x3e\n    \n            \x3c!-- EXTRUDED BEVEL --\x3e\n             <feConvolveMatrix order="8,8" divisor="1" kernelMatrix="1 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 1" in="STROKE_10" result="BEVEL_20"></feConvolveMatrix>\n    \n              <feOffset dx="4" dy="4" in="BEVEL_20" result="BEVEL_25"></feOffset>\n              <feComposite operator="out" in="BEVEL_25" in2="STROKE_10" result="BEVEL_30"></feComposite>\n              <feComposite in="COLOR-red" in2="BEVEL_30" operator="in" result="BEVEL_40"></feComposite>\n              <feMerge result="BEVEL_50">\n                <feMergeNode in="BEVEL_40"></feMergeNode>\n                <feMergeNode in="SourceGraphic"></feMergeNode>\n              </feMerge>\n             \x3c!-- EXTRUDED BEVEL END --\x3e\n    \n           \n          </filter>\n            </defs>\n      </svg>').getElementsByTagNameNS("http://www.w3.org/2000/svg","filter")[0];for(;t.children.length;)e.appendChild(t.children[0])}getImagePosition(e,t="fill",o=.5,i=.5,r){var s,n,a,l;let c=100,d=100;const h=scope().getBox(this.id);if(h)d=h.spread.width(),c=h.spread.height();else{if(!scope().rubberBand.spread)return console.error("getImagePosition, boxRef not found for id="+this.id),{ws:1,hs:1,px:0,py:0};d=null!==(n=null===(s=scope().rubberBand.spread)||void 0===s?void 0:s.width())&&void 0!==n?n:100,c=null!==(l=null===(a=scope().rubberBand.spread)||void 0===a?void 0:a.height())&&void 0!==l?l:100}const p=(null!=r?r:this.boxGeometry).toPixel(d,c,!0),u=p.width/p.height,m=p.height/p.width;let f=0,g=0,y=e.width/e.height/u,b=e.height/e.width/m;if("fit"===t?y>b?(y=1,g=(1-b)*i):(b=1,f=(1-y)*o):y>b?(b=1,f=-y*o+o):(y=1,g=-b*i+i),"fill"===t){const e=1e-4;Math.abs(y-1)<e&&Math.abs(b-1)<e&&Math.abs(g)<e&&Math.abs(f)<e&&(y=1,b=1,f=0,g=0)}return{ws:y,hs:b,px:f,py:g}}getDocRefPosition(e,t="fill",o=.5,i=.5,r){var s,n,a,l;const c=scope().getDocByName(e);if(!c)return console.error("getDocRefPosition, doc not found for name="+e),{ws:1,hs:1,px:0,py:0};let d=100,h=100;const p=scope().getBox(this.id);if(p)h=p.spread.width(),d=p.spread.height();else{if(!scope().rubberBand.spread)return console.error("getDocRefPosition, boxRef not found for id="+this.id),{ws:1,hs:1,px:0,py:0};h=null!==(n=null===(s=scope().rubberBand.spread)||void 0===s?void 0:s.width())&&void 0!==n?n:100,d=null!==(l=null===(a=scope().rubberBand.spread)||void 0===a?void 0:a.height())&&void 0!==l?l:100}const u=(null!=r?r:this.boxGeometry).toPixel(h,d,!0),m=u.width/u.height,f=u.height/u.width;let g=0,y=0,b=c.pageWidth/c.pageHeight/m,v=c.pageHeight/c.pageWidth/f;if("fit"===t?b>v?(b=1,y=(1-v)*i):(v=1,g=(1-b)*o):b>v?(v=1,g=-b*o+o):(b=1,y=-v*i+i),"fill"===t){const e=1e-4;Math.abs(b-1)<e&&Math.abs(v-1)<e&&Math.abs(y)<e&&Math.abs(g)<e&&(b=1,v=1,g=0,y=0)}return{ws:b,hs:v,px:g,py:y}}getDescription(){var e,t,o;const i=[];let r="",s=!1;if("layout"===this.snippetOrigin&&i.push("["+this.snippetOrigin+"-snippet]"),this.hasActiveFeature("imageRef")&&(i.push("Image"),this.imageRef)){s=!0;let e=this.imageRef.image.name;e&&e.indexOf("/")&&(e=e.substr(e.lastIndexOf("/")+1)),e.length>20&&(e="..."+e.substr(e.length-20,20)),r=e}return this.hasActiveFeature("simpleText")?(i.push("Text(Single)"),this.simpleText&&(r=this.simpleText.text)):this.hasActiveFeature("storyRef")&&(i.push("Text"),this.storyRef&&(r=null!==(t=null===(e=this.storyRef.story)||void 0===e?void 0:e.shortText)&&void 0!==t?t:"")),this.hasActiveFeature("pathGeometry")&&i.push("Shape"),this.hasActiveFeature("pathText")&&i.push("Text-on-Path"),this.hasActiveFeature("docRef")&&i.push(null===(o=this.docRef)||void 0===o?void 0:o.documentName),r.length>12&&!s&&(r=r.substr(0,10)+"..."),i.length?i.join(", ")+(r?" ["+r+"]":""):"Frame"}}return e._lastFrameCreationTimestamp=Date.now(),e})();function off(e){return e+config.pathLeftOffset}function trans(e,t,o){return e/100*t+o}function f(e,t){return e>1?t/e+100/(2*e):t}class PathSegment extends NobsBase{static deserialize(e){switch(e.t){case"M":return new StartPoint(e.x,e.y);case"L":return new LinePoint(e.x,e.y);case"C":return new CubicPoint(e.x,e.y,e.x1,e.y1,e.x2,e.y2);case"S":return new CubicNextPoint(e.x,e.y,e.x1,e.y1)}throw new Error("Can't deserialize path point"+JSON.stringify(e))}modelX(e){return trans(this.x,e,0)}modelY(e){return trans(this.y,e,0)}}class StartPoint extends PathSegment{constructor(e,t){super(e,t),"number"==typeof e&&"number"==typeof t&&(this.x=e,this.y=t)}name(){return"Start"}toString(){return"M "+off(this.x)+" "+off(this.y)}toStringNoOffset(){return"M "+this.x+" "+this.y}getPathTransformed(e,t,o,i){return"M "+trans(this.x,e,o)+" "+trans(this.y,t,i)}serialize(e=1){return{t:"M",x:f(e,this.x),y:f(e,this.y)}}}class LinePoint extends PathSegment{constructor(e,t){super(e,t),"number"==typeof e&&"number"==typeof t&&(this.x=e,this.y=t)}name(){return"Line"}toString(){return" L "+off(this.x)+" "+off(this.y)}toStringNoOffset(){return" L "+this.x+" "+this.y}getPathTransformed(e,t,o,i){return"L "+trans(this.x,e,o)+" "+trans(this.y,t,i)}serialize(e=1){return{t:"L",x:f(e,this.x),y:f(e,this.y)}}}class CubicPoint extends PathSegment{constructor(e,t,o=0,i=0,r=0,s=0){super(e,t),"number"==typeof e&&"number"==typeof t&&(this.x=e,this.y=t,this.x1=o,this.y1=i,this.x2=r,this.y2=s)}name(){return"Bezier"}toString(){return" C "+off(this.x1)+" "+off(this.y1)+", "+off(this.x2)+" "+off(this.y2)+", "+off(this.x)+" "+off(this.y)}toStringNoOffset(){return" C "+this.x1+" "+this.y1+", "+this.x2+" "+this.y2+", "+this.x+" "+this.y}getPathTransformed(e,t,o,i){return" C "+trans(this.x1,e,o)+" "+trans(this.y1,t,i)+", "+trans(this.x2,e,o)+" "+trans(this.y2,t,i)+", "+trans(this.x,e,o)+" "+trans(this.y,t,i)}serialize(e=1){return{t:"C",x:f(e,this.x),y:f(e,this.y),x1:f(e,this.x1),y1:f(e,this.y1),x2:f(e,this.x2),y2:f(e,this.y2)}}}class CubicNextPoint extends PathSegment{constructor(e,t,o=0,i=0){super(e,t),"number"==typeof e&&"number"==typeof t&&(this.x=e,this.y=t,this.x1=o,this.y1=i)}name(){return"Bezier (Simple)"}toString(){return" S "+off(this.x1)+" "+off(this.y1)+", "+off(this.x)+" "+off(this.y)}toStringNoOffset(){return" S "+this.x1+" "+this.y1+", "+this.x+" "+this.y}getPathTransformed(e,t,o,i){return" S "+trans(this.x1,e,o)+" "+trans(this.y1,t,i)+", "+trans(this.x,e,o)+" "+trans(this.y,t,i)}serialize(e=1){return{t:"S",x:f(e,this.x),y:f(e,this.y),x1:f(e,this.x1),y1:f(e,this.y1)}}}class BezierCurve{constructor(e,t,o,i){this.p0=e,this.p1=t,this.p2=o,this.p3=i}calculateCoordinatesAt(e){const t=1-e,o=t*t,i=e*e,r=o*t,s=o*e*3,n=t*i*3,a=e*i;return new Point(r*this.p0.x+s*this.p1.x+n*this.p2.x+a*this.p3.x,r*this.p0.y+s*this.p1.y+n*this.p2.y+a*this.p3.y)}flattenStepwise(e){const t=[];for(let o=0;o<e;o++){const i=o/(e-1);t.push(this.calculateCoordinatesAt(i))}return t}}class PathGeometry extends NobsBase{constructor(e,t=0,o=0){if(super(e,t),!(e instanceof Nobs)){const t=e;"boolean"==typeof t.closed?this.closed=t.closed:this.closed=!0,this.path=[];for(const e of t.p)this.path.push(PathSegment.deserialize(e));this.shape=t.shp?t.shp:"",this.shapeParams=t.prms?t.prms:{},!1===t.pdbs||!0===t.pdbs?this.pathDefinesBoxSize=t.pdbs:this.pathDefinesBoxSize=!0,t.stc?this.strokeColor=new ColorRef(t.stc.id,t.stc):this.strokeColor=ColorRef.Black_Color(),t.fic?this.fillColor=new ColorRef(t.fic.id,t.fic):this.fillColor=ColorRef.None_Color(),t.stw?this.strokeWidth=Length.deserialize(t.stw):this.strokeWidth=new Length(0,"%"),t.stt?this.strokeType=t.stt:this.strokeType="solid",t.ddi?this.dashDistribution=t.ddi:this.dashDistribution="align",t.sgf?this.strokeGapFactor=t.sgf:this.strokeGapFactor=1.5,t.sdf?this.strokeDashFactor=t.sdf:this.strokeDashFactor=1,t.stj?this.strokeJoin=t.stj:this.strokeJoin="miter",t.stp?this.strokeCap=t.stp:this.strokeCap="butt",t.sta?this.strokeAlign=t.sta:this.strokeAlign="center",!0===t.ftx||!1===t.ftx?this.wrapTextInShape=t.ftx:this.wrapTextInShape=!0,t.typ?this.type=t.typ:this.type="path",t.col&&t.col>=3?this.gridColumns=t.col:this.gridColumns=0,t.row&&t.row>=3?this.gridRows=t.row:this.gridRows=0}if("grid"===this.type&&t>=3&&t!==this.gridColumns||o>=3&&o!==this.gridRows){this.gridColumns=t,this.gridRows=o;const e=PathGeometry.createGridPath(this.gridColumns,this.gridRows);this.path=e.path}}getAdjustedGridPath(e,t){if(this.path.length===this.gridColumns*this.gridRows){const o=PathGeometry.createGridPath(e,t),i=transformMeshPoints({cols:this.gridColumns,rows:this.gridRows,points:this.path.map((e=>({x:e.x/100,y:e.y/100})))},o.path.map((e=>({x:e.x,y:e.y}))),100,100);return new PathGeometry({closed:!1,typ:"grid",col:e,row:t,fic:ColorRef.Gray_Color().serialize(),stc:ColorRef.Gray_Color().serialize(),sta:"center",stw:new Length(1,"px").serialize(),p:i.map((e=>({t:"M",x:e.x,y:e.y})))})}return PathGeometry.createGridPath(e,t)}getPIndex(e,t){return e*this.gridRows+t}isGrid(){return"grid"===this.type&&this.gridColumns>=3&&this.gridRows>=3&&this.path.length===this.gridRows*this.gridColumns}toString(){const e=[];if(this.isGrid()){const t=this.gridColumns,o=this.gridRows;for(let i=0;i<o;i++)for(let r=0;r<t;r++){const s=i*t+r,n=this.path[s];if(e.push(n.toString()),r<t-1){const t=this.path[s+1];e.push("L "+off(t.x)+" "+off(t.y)),e.push(n.toString())}if(i<o-1){const o=this.path[s+t];e.push("L "+off(o.x)+" "+off(o.y)),e.push(n.toString())}}return e.join(" ")}for(const t of this.path)e.push(t.toString());return e.join("")}toStringNoOffset(){let e="";for(const t of this.path)e+=t.toStringNoOffset();return e}getPathTransformed(e,t,o,i){let r="";for(const s of this.path)r+=s.getPathTransformed(e,t,o,i);return r}getNormalLinePointList(){const e=[];this.path.length&&e.push({x:this.path[0].x/100,y:this.path[0].y/100});for(let t=1;t<this.path.length;t++){const o=this.path[t-1],i=this.path[t];if(i instanceof CubicPoint){const t=new Point(o.x/100,o.y/100),r=new Point(i.x1/100,i.y1/100),s=new Point(i.x2/100,i.y2/100),n=new Point(i.x/100,i.y/100),a=new BezierCurve(t,r,s,n).flattenStepwise(50);for(const t of a)e.push({x:t.x,y:t.y})}else i instanceof LinePoint&&e.push({x:i.x/100,y:i.y/100})}return e}getNormalLinePointListInSpreadDimensions(e,t,o,i){return this.getNormalLinePointList().map((r=>({x:e+r.x*o,y:t+r.y*i})))}getPathPoints(e){const t=[];let o=null,i=null;for(let r=0;r<this.path.length;r++){const s=this.path[r];if(i=r<this.path.length+1?this.path[r+1]:null,t.push({x:s.x,y:s.y,anchorX:s.x,anchorY:s.y,kind:"anchor",index:r,selected:e.has(r)}),s instanceof CubicPoint&&(t.push({x:s.x1,y:s.y1,anchorX:o?o.x:s.x,anchorY:o?o.y:s.y,kind:"control1",index:r,selected:s.selected}),t.push({x:s.x2,y:s.y2,anchorX:s.x,anchorY:s.y,kind:"control2",index:r,selected:s.selected})),s instanceof CubicNextPoint&&t.push({x:s.x1,y:s.y1,anchorX:s.x,anchorY:s.y,kind:"control1",index:r,selected:s.selected}),s instanceof CubicPoint&&i instanceof CubicNextPoint){const e=s.x+(s.x-s.x2),o=s.y+(s.y-s.y2);t.push({x:e,y:o,anchorX:s.x,anchorY:s.y,kind:"mirror",index:r,selected:s.selected})}o=s}return t}static getBoundingBox(e){const t=`<svg xmlns="http://www.w3.org/2000/svg" id="testsvgpath" style="position: absolute; left: 1000px; top: 1000px;" viewBox="0 0 ${100*config.pathScaleFactor} ${100*config.pathScaleFactor}" preserveAspectRatio="none">\n        <path d="${e.toString()}"    ></path>\n            </svg>`,o=(new DOMParser).parseFromString(t,"image/svg+xml").querySelector("svg");if(o){document.body.appendChild(o);const e=o.getBBox();console_log(e);const t={left:e.x-config.pathLeftOffset,top:e.y-config.pathLeftOffset,width:e.width,height:e.height};return document.body.removeChild(o),t}return{left:0,top:0,width:0,height:0}}static adjustBoxToPath(e,t){if(!e.pathGeometry)throw"Can't adjust path box has no pathGeometry";const o=PathGeometry.getBoundingBox(e.pathGeometry),i=e.boxGeometry.toPixel(t.width(),t.height()),r=-o.top/100*i.height,s=i.top-r,n=Math.max(20,o.height/100*i.height),a=i.height/n,l=-o.top,c=-o.left/100*i.width,d=i.left-c,h=Math.max(20,o.width/100*i.width),p=i.width/h,u=-o.left,m=BoxGeometry.getRotationPositionX(e.boxGeometry),f=BoxGeometry.getRotationPositionY(e.boxGeometry),g=rotatePointInBox(d+m*h,s+f*n,i,e.boxGeometry.rotation,m,f),y={left:g.x,top:g.y,width:h,height:n},b=e.boxGeometry.fromPixel(t.width(),t.height(),y.left,y.top,y.width,y.height,e.boxGeometry.rotation,!1),v=(new Nobs).replaceObject(e.boxGeometry,b),x=e.pathGeometry.scalePath(p,a,u,l),w=PathGeometry.removeUnusedBeziers(x);return v.replaceCollection(e.pathGeometry.path,w),new Box(v,e)}toSvg(e=!1,t,o="butt",i="round"){let r=this.fillColor.toCssColor(),s=this.strokeColor.toCssColor();e&&(r="var(--printess-headlineColor)",s="var(--printess-headlineColor)"),this.closed||(r="transparent");let n="4px";void 0!==t?n=t+"px":(2===this.path.length&&0===this.path[1].x&&(n="8px"),2===this.path.length&&0===this.path[1].y&&(n="8px")),this.closed&&(s="transparent",n="0px");let a=o;return"projecting"===a&&(a="square"),html`
          <svg style="pointer-events: none; position: absolute; left: -${config.pathLeftOffset}%; top: -${config.pathLeftOffset}%;  width: ${100*config.pathScaleFactor}%; height:${100*config.pathScaleFactor}%;" viewBox="0 0 ${100*config.pathScaleFactor} ${100*config.pathScaleFactor}" 
              preserveAspectRatio="none">
                  <path style="vector-effect: non-scaling-stroke; stroke-linejoin: ${i}; stroke-linecap: ${a};" 
                  stroke-width="${n}" stroke="${s}"  fill="${r}" d="${this.toString()}" ></path>
          </svg>`}toBullet(e,t,o){const i=document.createElementNS("http://www.w3.org/2000/svg","path"),r=this.getPathTransformed(t,t,0,e);return i.setAttributeNS(null,"style","fill: "+o+";"),i.setAttributeNS(null,"d",r),i}static getShapeGeneratorFunction(e){for(const t of PathGeometry.getShapeGenerators())if(t.name===e)return t.func;for(const t of PathGeometry.getBulletShapeGenerators())if(t.name===e)return t.func;return null}static getBulletShapeGenerators(){return[{func:this.createRoundedRectPath,name:"Rectangle"},{func:this.createCirclePath,name:"Circle"},{func:this.createStarPath,name:"Star"},{func:this.createBadgePath,name:"Badge"},{func:this.createStaticStarPath,name:"Star5"},{func:this.createFlowerPath,name:"Flower"},{func:this.createHeartPath,name:"Heart"},{func:this.createArrowPath,name:"Arrow"},{func:this.createCustomPath,name:"Custom"}]}static getShapeGenerators(){return[{func:this.createRoundedRectPath,name:"Rectangle"},{func:this.createCirclePath,name:"Circle"},{func:this.createStarPath,name:"Star"},{func:this.createBadgePath,name:"Badge"},{func:this.createHeartPath,name:"Heart"},{func:this.createArrowPath,name:"Arrow"},{func:this.createFlatHandPath,name:"Flat Hand"},{func:this.createPointingHandPath,name:"Pointing Hand"},{func:this.createCheckPath,name:"Checker"},{func:this.createCloudPath,name:"Cloud"},{func:this.createSquareSpeechBubblePath,name:"Square Speech Bubble"},{func:this.createCircleSpeechBubblePath,name:"Round Speech Bubble"},{func:this.createTwoBezierPath,name:"Wave"},{func:this.createHorizontalLinePath,name:"Horizontal"},{func:this.createVerticalLinePath,name:"Vertical"},{func:this.createDiagonalLinePath,name:"Diagonal"}]}static createVerticalLinePath(){return new PathGeometry({closed:!1,fic:ColorRef.None_Color().serialize(),stc:ColorRef.Gray_Color().serialize(),sta:"center",stw:new Length(1,"%").serialize(),p:[{t:"M",x:0,y:0},{t:"L",x:0,y:100}]})}static createHorizontalLinePath(){return new PathGeometry({closed:!1,fic:ColorRef.None_Color().serialize(),stc:ColorRef.Gray_Color().serialize(),sta:"center",stw:new Length(1,"%").serialize(),p:[{t:"M",x:0,y:0},{t:"L",x:100,y:0}]})}static createDiagonalLinePath(){return new PathGeometry({closed:!1,fic:ColorRef.None_Color().serialize(),stc:ColorRef.Gray_Color().serialize(),sta:"center",stw:new Length(1,"%").serialize(),p:[{t:"M",x:0,y:0},{t:"L",x:100,y:100}]})}static createTwoBezierPath(){return new PathGeometry({closed:!1,fic:ColorRef.None_Color().serialize(),stc:ColorRef.Gray_Color().serialize(),sta:"center",stw:new Length(1,"%").serialize(),p:[{t:"M",x:0,y:50},{t:"C",x:49,y:50,x1:12,y1:13.745381875061135,x2:36.59052459007261,y2:-41.78590593449235},{t:"C",x:100,y:50,x1:61,y1:142.397238314782,x2:87,y2:84.65785367990134}]})}static createCustomPath(){let e=[];const t=scope().eddiGetSelectedBox();return t&&t.box.pathGeometry&&(e=t.box.pathGeometry.serialize().p),new PathGeometry({closed:!0,fic:ColorRef.Gray_Color().serialize(),stc:ColorRef.Black_Color().serialize(),sta:"center",stw:new Length(0,"px").serialize(),p:e})}static createCirclePath(){const e=.552284749831,t=1-e;return new PathGeometry({closed:!0,fic:ColorRef.Gray_Color().serialize(),stc:ColorRef.Black_Color().serialize(),sta:"center",stw:new Length(0,"%").serialize(),p:[{t:"M",x:50,y:100},{t:"C",x:0,y:50,x1:50*t,y1:100,x2:0,y2:50+50*e},{t:"C",x:50,y:0,x1:0,y1:50*t,x2:50*t,y2:0},{t:"C",x:100,y:50,x1:50+50*e,y1:0,x2:100,y2:50*t},{t:"C",x:50,y:100,x1:100,y1:50+50*e,x2:50+50*e,y2:100}]})}static createPointingHandPath(){return new PathGeometry({closed:!0,fic:ColorRef.Gray_Color().serialize(),stc:ColorRef.Black_Color().serialize(),sta:"center",stw:new Length(0,"%").serialize(),p:[{t:"M",x:99.4862326244754,y:68.89686377892367},{t:"C",x:88.03466150664785,y:99.92497778752406,x1:98.61526381592564,y1:73.00467809132306,x2:95.40846665220803,y2:85.15560091151254},{t:"C",x:37.481526119503975,y:99.94084131431164,x1:75.6527857119265,y1:99.97468671077107,x2:50.52329146358564,y2:100.05709024302482},{t:"C",x:13.165716330802631,y:74.9448710634741,x1:22.84298462641439,y1:93.11516234201275,x2:17.88514219310807,y2:80.45651836432421},{t:"C",x:2.7517790207922133,y:48.80050455292766,x1:6.948060036019285,y1:67.31335941614311,x2:-5.53449734357361,y2:54.97928202686886},{t:"C",x:24.396653778269712,y:62.027830978917606,x1:11.03805538515804,y1:42.62172707898646,x2:19.302670307844807,y2:56.16287295365398},{t:"C",x:33.240768321717766,y:-2689516168860304e-20,x1:23.94718464852636,y1:9.384533041310455,x2:24.02958732231265,y2:-.013532228087824377},{t:"C",x:42.15647519925027,y:42.39788713050517,x1:42.45194932112288,y1:.013478437764448127,x2:41.4822715046352,y2:9.257341180521639},{t:"L",x:42.463774445968916,y:42.435680055301496},{t:"C",x:52.40990702104571,y:30.55267694446176,x1:42.59495118859207,y1:38.19137847169715,x2:43.773040014887144,y2:30.65829090883331},{t:"C",x:62.65213587344331,y:42.558806160856214,x1:61.04677402720428,y1:30.447062980090205,x2:62.69586145431768,y2:38.064702668261454},{t:"L",x:63.09178628959382,y:42.59355438182281},{t:"C",x:72.92260051552276,y:32.31321254511842,x1:63.12957445412368,y1:38.13474919597849,x2:65.3461013672739,y2:32.36048246655738},{t:"C",x:82.5542951707624,y:42.71529075662754,x1:80.49909966377164,y1:32.26594262367946,x2:82.62920669238632,y2:38.14990950198444},{t:"L",x:82.83102637887605,y:42.696816443342286},{t:"C",x:91.65088754192635,y:35.95506116477275,x1:83.14715436412848,y1:38.150788875444704,x2:86.35071724382018,y2:35.892011076462},{t:"C",x:99.85720082070958,y:45.14761140242191,x1:96.95105784003252,y1:36.018111253083504,x2:99.68919720905551,y2:39.20366143274947},{t:"C",x:99.4862326244754,y:68.89686377892367,x1:99.85720082070958,y1:45.14761140242191,x2:100.35720143302518,y2:64.78904946652425}]})}static createFlatHandPath(){return new PathGeometry({closed:!0,fic:ColorRef.Gray_Color().serialize(),stc:ColorRef.Black_Color().serialize(),sta:"center",stw:new Length(0,"%").serialize(),p:[{t:"M",x:99.53821038615625,y:71.17667292414384},{t:"C",x:88.08066328848561,y:99.93047679331177,x1:98.66678706424844,y1:74.98339114868544,x2:95.45831643974417,y2:86.24367114843925},{t:"C",x:37.50114684716413,y:99.94517754946465,x1:75.69232603625703,y1:99.97654213357691,x2:50.54971801081523,y2:100.05290562134462},{t:"C",x:13.172647900995193,y:76.78137114109185,x1:22.854966260015335,y1:93.61980971083335,x2:17.89453658639572,y2:81.88902368615936},{t:"C",x:2.7532760983015097,y:52.55334404542231,x1:6.951746934515142,y1:69.70923684792137,x2:-5.537324443071832,y2:58.27922721020935},{t:"C",x:24.40944619105884,y:64.81112902265149,x1:11.043876639674853,y1:46.82746088063526,x2:19.312804435388443,y2:59.37606285290013},{t:"C",x:33.25817601826995,y:7.329811942227698,x1:23.959742506735004,y1:16.026498944762753,x2:24.042188182194387,y2:7.317296528173261},{t:"C",x:42.17853553988411,y:46.62002803521863,x1:42.47416385434552,y1:7.342327356282137,x2:41.503980013398305,y2:15.908630039876613},{t:"L",x:43.74471772619875,y:46.65505080028049},{t:"C",x:53.40556623034291,y:.0008906854300865235,x1:43.29501404187493,y1:8.151208537463638,x2:42.730871007689004,y2:-.09862207091519963},{t:"C",x:62.39441739361412,y:46.769151963158556,x1:64.08026145299685,y1:.10040344177537266,x2:62.24451616550617,y2:11.473963222243107},{t:"L",x:63.7057205623766,y:46.801353196214464},{t:"C",x:73.18664066302259,y:7.412954017338789,x1:63.74352844658572,y1:15.5993748932592,x2:64.05699071688404,y2:7.541352868972731},{t:"C",x:82.01648815294512,y:46.829572755016265,x1:82.31629060916104,y1:7.284555165704849,x2:82.0914387669991,y2:15.528830235243372},{t:"L",x:83.35843672169338,y:46.897046317080076},{t:"C",x:91.892426071292,y:24.94321328700498,x1:83.8683793048032,y1:28.980049545443865,x2:85.52441694075178,y2:24.94118049286005},{t:"C",x:99.78027242001957,y:47.10975437120868,x1:98.26043520183221,y1:24.94524608114991,x2:99.51535632246616,y2:28.968821314787743},{t:"C",x:99.53821038615625,y:71.17667292414384,x1:99.78027242001957,y1:47.10975437120868,x2:100.40963370806409,y2:67.36995469960225}]})}static createCheckPath(){return new PathGeometry({closed:!1,fic:{id:"[None]",tint:100,color:{na:"[None]",mo:"none",ac:"readonly",an:!1,ty:"process",or:0,gr:"",r:255,g:255,b:255,c:0,m:0,y:0,k:0,L:100,A:0,B:0},mo:{m:"inactive",h:0,l:0,s:0},op:100},stc:ColorRef.Gray_Color().serialize(),sta:"center",stw:{u:"%",v:20,e:""},stt:"solid",stj:"round",stp:"round",sdf:1,sgf:1.5,ddi:"align",ftx:!0,shp:"",prms:{},p:[{t:"M",x:7831962680224033e-21,y:50.00002899105291},{t:"L",x:33.237977118396394,y:100.00002977284505},{t:"L",x:100.00002055151172,y:28209260694487377e-21}]})}static createCloudPath(){return new PathGeometry({closed:!0,fic:ColorRef.Gray_Color().serialize(),stc:ColorRef.Black_Color().serialize(),sta:"center",stw:new Length(0,"%").serialize(),p:[{t:"M",x:81.68630570259627,y:50.64539375850959},{t:"C",x:81.0307736732037,y:99.77392617417865,x1:106.19885722587905,y1:50.6453937585096,x2:106.22678550876655,y2:99.45873013781117},{t:"L",x:23.047899870427763,y:100.00002624703508},{t:"C",x:12.639986927150408,y:50.434764475319504,x1:-9.832220368832566,y1:99.86258492410708,x2:-2.027847653938513,y2:50.53933122849683},{t:"C",x:29.33078870783483,y:21.93243102261208,x1:9.85210130895512,y1:31.75881937228399,x2:18.027876319656485,y2:17.47202954448933},{t:"C",x:61.99640601307883,y:21.895244491481,x1:36.11936706318894,y1:-11.927664027948756,x2:60.22615255062154,y2:-2.289936544247395},{t:"C",x:81.68630570259627,y:50.64539375850959,x1:77.28835662711325,y1:9.572683536443499,x2:85.77173095647676,y2:33.79505110330298}]})}static createSquareSpeechBubblePath(){return new PathGeometry({closed:!0,fic:ColorRef.Gray_Color().serialize(),stc:ColorRef.Black_Color().serialize(),sta:"center",stw:new Length(0,"%").serialize(),p:[{t:"M",x:0,y:11.432714331954777},{t:"C",x:15,y:0,x1:0,y1:5.14472144937965,x2:6.75,y2:0},{t:"L",x:85,y:0},{t:"C",x:100,y:11.432714331954777,x1:93.25,y1:0,x2:100,y2:5.14472144937965},{t:"L",x:100,y:64.7853812144104},{t:"C",x:85,y:76.21809554636518,x1:100,y1:71.07337409698553,x2:93.25,y2:76.21809554636518},{t:"L",x:54.33226472082721,y:76.13372942015988},{t:"L",x:55.076378560247036,y:100.00000479991343},{t:"L",x:39.44998793243103,y:76.13372942015988},{t:"L",x:15,y:76.21809554636518},{t:"C",x:0,y:64.7853812144104,x1:6.75,y1:76.21809554636518,x2:0,y2:71.07337409698553},{t:"L",x:0,y:11.432714331954777}]})}static createCircleSpeechBubblePath(){return new PathGeometry({closed:!0,fic:ColorRef.Gray_Color().serialize(),stc:ColorRef.Black_Color().serialize(),sta:"center",stw:new Length(0,"%").serialize(),p:[{t:"M",x:46.45542856533671,y:78.38604817372239},{t:"C",x:0,y:39.54665894255042,x1:18.92261765574302,y1:77.949183168691,x2:0,y2:61.38767558328874},{t:"C",x:50,y:0,x1:0,y1:17.705642301812087,x2:22.385762508450004,y2:0},{t:"C",x:100,y:39.54665894255042,x1:77.61423749155,y1:0,x2:100,y2:17.705642301812087},{t:"C",x:59.56675694827164,y:77.30535151505478,x1:100,y1:61.38767558328874,x2:77.43613953148161,y2:74.36611094339533},{t:"L",x:63.31285077196733,y:99.99998134707391},{t:"L",x:46.45542856533671,y:78.38604817372239}]})}static createGridPath(e=5,t=5){const o=[];t=Math.max(3,t),e=Math.max(3,e);for(let i=0;i<t;i++)for(let r=0;r<e;r++)o.push({t:"M",x:100/(e-1)*r,y:100/(t-1)*i});return new PathGeometry({closed:!1,typ:"grid",col:e,row:t,fic:ColorRef.Gray_Color().serialize(),stc:ColorRef.Gray_Color().serialize(),stw:new Length(1,"px").serialize(),sta:"center",p:o},e,t)}static createMappedGridPath(e=5,t=5,o){const i=[];t=Math.max(3,t),e=Math.max(3,e);for(let r=0;r<t;r++)for(let s=0;s<e;s++){const n=o(1/(e-1)*s,1/(t-1)*r);i.push({t:"M",x:100*n.x,y:100*n.y})}return new PathGeometry({closed:!1,typ:"grid",col:e,row:t,fic:ColorRef.Gray_Color().serialize(),stc:ColorRef.Gray_Color().serialize(),stw:new Length(1,"px").serialize(),sta:"center",p:i},e,t)}static createHeartPath(){return new PathGeometry({closed:!0,fic:ColorRef.Gray_Color().serialize(),stc:ColorRef.Black_Color().serialize(),stw:new Length(0,"%").serialize(),sta:"center",p:[{t:"M",x:.0011710772844359132,y:27.790249808206955},{t:"C",x:49.99952697245252,y:26.587618272237478,x1:-.000965128574857814,y1:-7.44865973566881,x2:44.9994777623498,y2:-10.611591223369311},{t:"C",x:99.98360348831453,y:28.095423040064166,x1:55.99958602457581,y1:-10.738537320867852,x2:100.98342781242486,y2:-6.650067882473894},{t:"C",x:49.40790662183952,y:99.99999990871542,x1:99.98360348831453,y1:52.54595368925764,x2:79.13195504293462,y2:68.78400010650759},{t:"C",x:.0011710772844359132,y:27.790249808206955,x1:20.467686387687397,y1:68.82182522590071,x2:-.17910492147861792,y2:52.752442168002176}]})}static createBoxRectPath(){return new PathGeometry({closed:!0,fic:ColorRef.Gray_Color().serialize(),stc:ColorRef.Black_Color().serialize(),stw:new Length(0,"%").serialize(),sta:"center",p:[{t:"M",x:0,y:0},{t:"L",x:100,y:0},{t:"L",x:100,y:100},{t:"L",x:0,y:100},{t:"L",x:0,y:0}]})}static createRoundedRectPath(e,t=100,o=100){var i;const r=null!==(i=null==e?void 0:e.radius)&&void 0!==i?i:0;if(0===r)return PathGeometry.createBoxRectPath();let s=r,n=r;t>o?n=r*(o/t):o>t&&(s=r*(t/o));const a=.45*n,l=.45*s;return new PathGeometry({closed:!0,fic:ColorRef.Gray_Color().serialize(),stc:ColorRef.Black_Color().serialize(),stw:new Length(0,"%").serialize(),sta:"center",prms:{radius:r},p:[{t:"M",x:0,y:s},{t:"C",x:n,y:0,x1:0,y1:l,x2:a,y2:0},{t:"L",x:100-n,y:0},{t:"C",x:100,y:s,x1:100-a,y1:0,x2:100,y2:l},{t:"L",x:100,y:100-s},{t:"C",x:100-n,y:100,x1:100,y1:100-l,x2:100-a,y2:100},{t:"L",x:n,y:100},{t:"C",x:0,y:100-s,x1:a,y1:100,x2:0,y2:100-l},{t:"L",x:0,y:s}]})}static createBulletStarPath(){return PathGeometry.createStarPath({corners:5,innerRadius:42})}static createStarPath(e){var t,o;const i=null!==(t=null==e?void 0:e.corners)&&void 0!==t?t:12,r=null!==(o=null==e?void 0:e.innerRadius)&&void 0!==o?o:80,s=[],n=Math.PI/i,a=2*i;for(let e=0;e<=a;e++){const t=1&e?1:r/100,o=e*n;s.push({t:0===e?"M":"L",x:t*Math.cos(o)*50+50,y:t*Math.sin(o)*50+50})}return new PathGeometry({closed:!0,fic:ColorRef.Gray_Color().serialize(),stc:ColorRef.Black_Color().serialize(),sta:"center",stw:new Length(0,"%").serialize(),p:s,prms:{corners:i,innerRadius:r}})}static createBulletBadgePath(){return PathGeometry.createBadgePath({corners:5,innerRadius:41})}static createBadgePath(e){var t,o;const i=null!==(t=null==e?void 0:e.corners)&&void 0!==t?t:12,r=null!==(o=null==e?void 0:e.innerRadius)&&void 0!==o?o:80,s=[],n=Math.PI/i,a=2*i;let l=r/100,c=0,d=l*Math.cos(c)*50+50,h=l*Math.sin(c)*50+50;s.push({t:"M",x:d,y:h});for(let e=1;e<=a;e++){l=1&e?1:r/100,c=e*n;const t=l*Math.cos(c)*50+50,o=l*Math.sin(c)*50+50;1===l?s.push({t:"C",x:t,y:o,x2:1*Math.cos(c-1*n)*50+50,y2:1*Math.sin(c-1*n)*50+50,x1:d,y1:h}):(s.push({t:"C",x:t,y:o,x1:1*Math.cos(c-n+1*n)*50+50,y1:1*Math.sin(c-n+1*n)*50+50,x2:t,y2:o}),d=t,h=o)}return new PathGeometry({closed:!0,fic:ColorRef.Gray_Color().serialize(),stc:ColorRef.Black_Color().serialize(),sta:"center",stw:new Length(0,"%").serialize(),p:s,prms:{corners:i,innerRadius:r}})}static createSunPath(e){var t,o;const i=null!==(t=null==e?void 0:e.corners)&&void 0!==t?t:12,r=null!==(o=null==e?void 0:e.innerRadius)&&void 0!==o?o:80,s=[],n=Math.PI/i,a=2*i;let l=r/100,c=0,d=l*Math.cos(c)*50+50,h=l*Math.sin(c)*50+50;s.push({t:"M",x:d,y:h});for(let e=1;e<=a;e++){l=1&e?1:r/100,c=e*n;const t=l*Math.cos(c)*50+50,o=l*Math.sin(c)*50+50;1===l?s.push({t:"C",x:t,y:o,x2:l*Math.cos(c-n/2)*50+50,y2:l*Math.sin(c-n/2)*50+50,x1:d,y1:h}):(s.push({t:"C",x:t,y:o,x1:d,y1:h,x2:l*Math.cos(c+n/2)*50+50,y2:l*Math.sin(c+n/2)*50+50}),d=t,h=o)}return new PathGeometry({closed:!0,fic:ColorRef.Gray_Color().serialize(),stc:ColorRef.Black_Color().serialize(),sta:"center",stw:new Length(0,"%").serialize(),p:s,prms:{corners:i,innerRadius:r}})}static createFlowerPath(){return new PathGeometry({closed:!0,fic:ColorRef.Gray_Color().serialize(),stc:ColorRef.Black_Color().serialize(),stw:new Length(0,"%").serialize(),sta:"center",p:[{t:"M",x:2.4134569484035193,y:27.526536216733536},{t:"C",x:41.50343361544332,y:37.09554717073408,x1:15.443449170750124,y1:3.744607571212571,x2:41.50343361544332,y2:37.09554717073408},{t:"C",x:46.389680698823305,y:.04757465604304664,x1:41.50343361544332,y1:37.09554717073408,x2:20.329696254130095,y2:1.6672530043078313},{t:"C",x:59.41967292116988,y:38.7040770572904,x1:72.44966514351651,y1:-1.572103692221738,x2:59.41967292116988,y2:38.7040770572904},{t:"C",x:95.25215153262307,y:21.548864088284187,x1:59.41967292116988,y1:38.7040770572904,x2:80.59341028248316,y2:1.0330958563103427},{t:"C",x:69.19216708792985,y:49.96371859033435,x1:109.91089278276303,y1:42.06463232025803,x2:69.19216708792985,y2:49.96371859033435},{t:"C",x:98.50964958820974,y:70.21443424152726,x1:69.19216708792985,y1:49.96371859033435,x2:107.9833939756556,y2:46.76017781390162},{t:"C",x:59.41967292116988,y:62.83190711763988,x1:89.03590520076386,y1:93.6686906691529,x2:59.41967292116988,y2:62.83190711763988},{t:"C",x:56.16217486558325,y:99.80958422421578,x1:59.41967292116988,y1:62.83190711763988,x2:83.85090833806979,y2:94.98488174585333},{t:"C",x:43.13218264323665,y:64.42849986329465,x1:28.473441393096728,y1:103.02605254312402,x2:43.13218264323665,y2:64.42849986329465},{t:"C",x:5.670955003990168,y:80.5107743107661,x1:43.13218264323665,y1:64.42849986329465,x2:21.65969550260935,y2:99.86196404280517},{t:"C",x:33.3596884764767,y:51.60913805586399,x1:-10.31778549462901,y1:61.15958457872702,x2:33.3596884764767,y2:51.60913805586399},{t:"C",x:2.4134569484035193,y:27.526536216733536,x1:33.3596884764767,y1:51.60913805586399,x2:-10.616535273943082,y2:51.308464862254496}]})}static createStaticStarPath(){return new PathGeometry({closed:!0,fic:ColorRef.Gray_Color().serialize(),stc:ColorRef.Black_Color().serialize(),sta:"center",stw:new Length(0,"%").serialize(),p:[{t:"M",x:0,y:40},{t:"L",x:35.7,y:40},{t:"L",x:50,y:-0},{t:"L",x:64.28,y:40},{t:"L",x:100,y:40},{t:"L",x:71.43,y:62.85},{t:"L",x:82.85,y:100},{t:"L",x:50,y:76.4},{t:"L",x:15.7,y:100},{t:"L",x:30,y:62.85},{t:"L",x:0,y:40}]})}static createArrowPath(e){var t,o,i;const r=null!==(t=null==e?void 0:e.thickness)&&void 0!==t?t:35,s=null!==(o=null==e?void 0:e.start)&&void 0!==o?o:65,n=null!==(i=null==e?void 0:e.curve)&&void 0!==i?i:50,a=50-.5*r,l=100-s,c=l/2/100*n,d=s+.6*l-c,h=s+.6*l-c;return new PathGeometry({closed:!0,fic:ColorRef.Gray_Color().serialize(),stc:ColorRef.Black_Color().serialize(),stw:new Length(0,"%").serialize(),sta:"center",prms:{thickness:r,start:s,curve:n},p:[{t:"M",x:0,y:a},{t:"L",x:s,y:a},{t:"L",x:s,y:0},{t:"C",x:100,y:50,x1:s,y1:0,x2:h,y2:30},{t:"C",x:s,y:100,x1:d,y1:70,x2:s,y2:100},{t:"L",x:s,y:a+r},{t:"L",x:0,y:a+r},{t:"L",x:0,y:a}]})}serialize(e=1){const t=[];for(const o of this.path)t.push(o.serialize(e));return{closed:this.closed,fic:this.fillColor.serialize(),typ:this.type,row:this.gridRows,col:this.gridColumns,stc:this.strokeColor.serialize(),stw:this.strokeWidth.serialize(),sta:this.strokeAlign,stt:this.strokeType,stj:this.strokeJoin,stp:this.strokeCap,sdf:this.strokeDashFactor,sgf:this.strokeGapFactor,ddi:this.dashDistribution,ftx:this.wrapTextInShape,shp:this.shape,prms:this.shapeParams,p:t,pdbs:this.pathDefinesBoxSize}}scalePath(e,t,o,i){const r=[];for(const s of this.path)if(s instanceof CubicPoint){const n=PathGeometry.scalePoint(s.x,s.y,e,t,o,i),a=PathGeometry.scalePoint(s.x1,s.y1,e,t,o,i),l=PathGeometry.scalePoint(s.x2,s.y2,e,t,o,i);r.push(new CubicPoint(n.x,n.y,a.x,a.y,l.x,l.y))}else if(s instanceof CubicNextPoint){const n=PathGeometry.scalePoint(s.x,s.y,e,t,o,i),a=PathGeometry.scalePoint(s.x1,s.y1,e,t,o,i);r.push(new CubicNextPoint(n.x,n.y,a.x,a.y))}else if(s instanceof LinePoint){const n=PathGeometry.scalePoint(s.x,s.y,e,t,o,i);r.push(new LinePoint(n.x,n.y))}else if(s instanceof StartPoint){const n=PathGeometry.scalePoint(s.x,s.y,e,t,o,i);r.push(new StartPoint(n.x,n.y))}return r}static scalePoint(e,t,o,i,r,s){const n=new Point(e,t);return n.x+=r,n.y+=s,n.scale(o,i),n}static removeUnusedBeziers(e){const t=[],o=config.pointCollapseThreshold;let i=null;for(let r=0;r<e.length;r++){const s=e[r];r>0&&(i=e[r-1]),s instanceof CubicPoint&&i&&Math.abs(s.x2-s.x)<=o&&Math.abs(s.y2-s.y)<=o&&Math.abs(s.x1-i.x)<=o&&Math.abs(s.y1-i.y)<=o?t.push(new LinePoint(s.x,s.y)):t.push(s)}return t}}const propertyNames={feature:["basics","simpleText","storyRef","pathText","imageRef","pathGeometry","transform","effect","boxGeometry","docRef","lock"],color:["strokeColor","fontStrokeColor","pathTextStrokeColor","fontColor","fillColor","pathTextFontColor","dropColor","inShadowColor","inGlowColor","outGlowColor","strokeEffectColor","bevelLightColor","bulletColor","tabLineColor"],font:["pathTextFont","font"],image:["image","maskImage"],boxGeoLength:["top","left","bottom","right","width","height"],length:["top","left","bottom","right","width","height","minWidth","minHeight","maxHeight","maxWidth","distance","paddingLeft","paddingTop","paddingRight","paddingBottom","fontSize","pathTextFontSize","strokeWidth","fontStrokeWidth","pathTextStrokeWidth","wrapShapeOffset","wrapObjectOffset","lineHeight","baselineShift","dropBlurRadius","dropSpreadRadius","dropXoffset","dropYoffset","inGlowBlurRadius","inGlowSpreadRadius","inGlowXoffset","inGlowYoffset","inShadowBlurRadius","inShadowSpreadRadius","inShadowXoffset","inShadowYoffset","outGlowBlurRadius","outGlowSpreadRadius","outGlowXoffset","outGlowYoffset","strokeBlurRadius","strokeSpreadRadius","strokeXoffset","strokeYoffset","spaceAfterParagraph","spaceBeforeParagraph","leftIndent","rightIndent","firstLineIndent","bevelBlur","tabSize","tabLineHeight"],anchor:["anchorTop","anchorLeft","anchorBottom","anchorRight","anchorWidth","anchorHeight"],boolean:["if","hasFontSize","hasFormField","hideNonPrintableLayers","warpArchActive","warpCupActive","warpFishActive","warpFlagActive","warpArcActive","warpPitActive","warpCustomActive","maskActive","maskInverse","perspectiveActive","meshActive","blurActive","dropActive","inShadowActive","inGlowActive","outGlowActive","strokeActive","turbulenceActive","distortActive","bevelActive","pathDefinesBoxSize","lockForAdmin","lockForBuyer","closed","wrapTextInShape","lockBox","visible","lockAspectRatio","hasClickAction","hasZoomAction","isUiElement","useBaselineGrid","symbolKeepRatio","mirrorX","mirrorY"],number:["rotation","startX","tracking","wrapAscenderDiminisher","transformTopLeftX","transformTopLeftY","transformTopRightX","transformTopRightY","transformBottomRightX","transformBottomRightY","transformBottomLeftX","transformBottomLeftY","verticalFocalPoint","horizontalFocalPoint","verticalFocalPointDocument","horizontalFocalPointDocument","strokeGapFactor","fontStrokeGapFactor","maxLetterWidth","minLetterWidth","maxLetterSpacing","minLetterSpacing","maxCharacters","strokeDashFactor","fontStrokeDashFactor","imageXPosition","imageYPosition","imageWidthScale","imageHeightScale","docXPosition","docYPosition","docWidthScale","docHeightScale","warpArchPhi","warpCupY","warpCupPhi","warpFishHeightFraction","warpFishWaves","warpFlagHeightFraction","warpFlagWaves","warpFlagPhase","warpArcHeightFraction","warpPitHeightFraction","meshColumns","meshRows","warpCustomTopWaves","warpCustomTopPhase","warpCustomTopHeightFraction","warpCustomBottomWaves","warpCustomBottomPhase","warpCustomBottomHeightFraction","blurIntensity","opacity","brightness","contrast","grayscale","sepia","hueRotate","saturate","invert","turbulenceOctaves","turbulenceFrequency","turbulenceScale","distortOctaves","distortFrequency","distortScale","bevelPointLightX","bevelPointLightY","bevelPointLightZ","bevelSurfaceScale","bevelSpecularConstant","bevelspecularExponent","bulletSize","bulletShift"],string:["class","text","textBefore","textAfter","textOnPath","documentName","spreadName","bulletShape","perspectiveOmits","meshOmits","warpArchOmits","warpCupOmits","warpFishOmits","warpFlagOmits","warpArcOmits","warpPitOmits","warpCustomOmits","maskOmits","blurOmits","lvlOmits","turbuenceOmits","bevelOmits","dropOmits","turbulenceOmits","distortOmits","inShadowOmits","inGlowOmits","outGlowOmits","strokeOmits","clickActionFormFieldName","clickActionFormFieldValue","textFieldCaption","barcodeOptions"],allow:["allowAdd","allowFrame","allowText","allowFontGroups","allowTransform","allowShape","allowImage","allowImageFilters","allowImageGroups","allowColorGroups","allowPathText","allowSubDocument","allowEffect"],tabs:["tabs"],storyContent:["storyContent"],textWrapMode:["textWrapMode"],horizontalTextAlign:["horizontalTextAlign"],horizontalSimpleTextAlign:["horizontalSimpleTextAlign"],horizontalPathTextAlign:["horizontalPathTextAlign"],verticalSimpleTextAlign:["verticalSimpleTextAlign"],verticalStoryTextAlign:["verticalStoryTextAlign"],strokeAlign:["fontStrokeAlign","pathTextStrokeAlign","strokeAlign"],strokeType:["strokeType","fontStrokeType","tabLineType"],dashDistribution:["dashDistribution","fontDashDistribution"],strokeJoin:["strokeJoin","fontStrokeJoin","pathTextStrokeJoin"],strokeCap:["strokeCap"],autoTextMode:["autoTextMode"],simpleTextMode:["simpleTextMode"],barcodeType:["barcodeType"],anchorRotation:["anchorRotation"],imageMasking:["imageMasking"],orientation:["orientation"],imagePlacement:["imagePlacement"],gridSize:["gridSize"],documentPlacement:["documentPlacement"],imageType:["imageType"],textTransform:["textTransform"],blendMode:["blendMode","dropBlend","inShadowBlend","inGlowBlend","outGlowBlend","strokeBlend"],imageChannel:["maskChannel"],bulletMode:["bulletMode"],effectArea:["inGlowArea","inShadowArea"],buyerOrderNo:["buyerOrderNo","zoomActionOrderNo","boundToBoxSelection"],fontHeights:["fontHeights"],firstBaseline:["firstBaseline"],hyphenationLanguage:["hyphenationLanguage"],transform:["warpCustomTopTransform","warpCustomBottomTransform"],warpArcPosition:["warpArcPosition"],warpPitPosition:["warpPitPosition"],warpArchPosition:["warpArchPosition"],warpArchMirror:["warpArchMirror"],frameRepeat:["frameRepeat"]},enums={horizontalTextAlign:["bullet","left","center","right","justifyLeft","justifyCenter","justifyRight","justifyJustify"],horizontalPathTextAlign:["left","center","right"],horizontalSimpleTextAlign:["left","center","right"],verticalSimpleTextAlign:["top","centerBaseline","center","bottom","bottomBaseline"],verticalStoryTextAlign:["top","center","bottom"],frameRepeat:["none","page"],textWrap:["do not wrap","wrap around both sides"],autoText:["off","height","width"],simpleTextMode:["text","symbol","barcode"],barcodeType:["QRCode","Code128","Code39"],strokeAlign:["center","inside","outside"],strokeType:["solid","dotted","dashed 1","dashed 2","dashed 3","dashed 4","dashed 5","dashed 6","dashed n"],strokeJoin:["miter","round","bevel"],strokeCap:["butt","round","projecting"],dashDistribution:["preserve","align"],transform:["none","sine","cosine","parabel","inverseparabel"],warp:["none","arch","pit","arc","cup","flag","fish","custom"],warpArcPosition:["upper","lower","bulge"],warpPitPosition:["upper","lower","squeeze"],warpArchPosition:["inner","outer"],warpArchMirror:["on","off"],lengthUnit:["px","cm","mm","inch","pt","%","%%","equation"],imageMask:["none","pathGeometry","simpleText"],imagePlacement:["fill","fit","crop"],documentPlacement:["adjust","fit","fill","crop"],imageType:["uploaded","external","fallback","dataurl"],textTransform:["mixed","upper","lower"],gridSize:["1mm","5mm","1cm","5px","10px",'0.25" / 18pt','0.125" / 9pt',"4.5pt"],colorMode:["rgb","cmyk","LAB","none"],colorType:["spot","process"],colorAccess:["write","readonly","readonlyName"],anchorRotation:["0","90","180","270"],fontHeights:["measure","font"],firstBaseline:["ascender","lineHeigt"],hyphenationLanguage:["off","en-us","de","fr","es"],blendMode:["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","difference","exclusion","hue","saturation","color","luminosity"],imageChannel:["image","alpha"],ffType:["string","table","number"],bulletMode:["none","bullet","number","latin lower","latin upper"],orientation:["portrait","landscape"],effectArea:["stroke","fill","combined","separate"],buyerOrderNo:["none","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20"],allAllowEnums:["allowAdd","allowFrame","allowImage","allowImageFilters","allowImageGroups","allowText","allowPathText","allowFontGroups","allowShape","allowColorGroups","allowSubDocument","allowTransform","allowEffect"],allowAdd:["image","text","warpText","pathText","shape","artwork","colors","images","fonts"],allowFrame:["anchors","rotation","positionByMouse","positionByInput","unitConverter","mirror","name","class","textWrap","delete","warpArchPhi"],allowImage:["content","mandatory","info","placement","focal","mask"],allowImageFilters:["sepia","brightness","contrast","vivid","hueRotate"],allowText:["content","mandatory","color","stroke","font","size","lineHeight","tracking","baselineShift","horizontalAlignment","verticalAlignment","padding","styles","bullet","indent","paragraphSpacing","baselineGrid"],allowPathText:["content","color","font","size","tracking","startX","alignment","distance","stroke"],allowSubDocument:["formFields","pageName","placement"],allowShape:["color","stroke","path","shape"],allowTransform:["perspective","mesh","distort","arch","arc","cup","fish","flag","pit"],allowEffect:["opacity","blur","mask","blend","turbulence","dropShadow","inShadow","outGlow","inGlow","bevel"]},enumIcons={fontHeights:["ruler","font"],warp:["empty","warp-arc","warp-squeeze","warp-bulge","warp-mug","warp-flag","warp-fish","settings"],warpArcPosition:["warp-arc-upper","warp-arc-lower","warp-bulge"],warpPitPosition:["warp-pit-upper","warp-pit-lower","warp-squeeze"],anchorRotation:["arrow-up","arrow-right","arrow-down","arrow-left"],horizontalPathTextAlign:["text-align-left","text-align-center","text-align-right"],horizontalSimpleTextAlign:["text-align-left","text-align-center","text-align-right"],verticalSimpleTextAlign:["vertical-align-top","vertical-align-center-baseline","vertical-align-center","vertical-align-bottom","vertical-align-bottom-baseline"],verticalStoryTextAlign:["vertical-align-top","vertical-align-center","vertical-align-bottom"],horizontalTextAlign:["list-ul","text-align-left","text-align-center","text-align-right","text-align-justify-left","text-align-justify-center","text-align-justify-right","text-align-justify-justify"],imageMask:["image","shapes","text"],strokeAlign:["stroke-align-center","stroke-align-inside","stroke-align-outside"],strokeJoin:["stroke-join-miter","stroke-join-round","stroke-join-bevel"],strokeCap:["stroke-cap-butt","stroke-cap-round","stroke-cap-projecting"],autoText:["slash","line-height","line-width"],textWrap:["no-wrap","wrap-both-sides"],orientation:["portrait","image"]},enumLabels={imageMask:["none","Path","Simple Text"],allowImageFilters:["Sepia","Brightness","Contrast","Saturate","Color"]},anyEnumPropertyNames=["horizontalTextAlign","horizontalPathTextAlign","horizontalSimpleTextAlign","verticalSimpleTextAlign","verticalStoryTextAlign","frameRepeat","textWrapMode","autoTextMode","simpleTextMode","barcodeType","warpCustomTopTransform","warpCustomBottomTransform","warpArcPosition","warpPitPosition","warpArchPosition","warpArchMirror","imageMasking","imagePlacement","documentPlacement","imageType","textTransform","colorMode","gridSize","colorType","colorAccess","blendMode","maskChannel","dropBlend","inShadowBlend","inGlowBlend","bulletMode","inGlowArea","inShadowArea","buyerOrderNo","zoomActionOrderNo","boundToBoxSelection","outGlowBlend","strokeBlend","fontHeights","firstBaseline","hyphenationLanguage","anchorRotation","strokeCap","fontStrokeAlign","pathTextStrokeAlign","strokeAlign","strokeType","fontStrokeType","tabLineType","strokeJoin","fontStrokeJoin","dashDistribution","fontDashDistribution","pathTextStrokeJoin","orientation"];function isEnumProperty(e){return-1!==anyEnumPropertyNames.indexOf(e)}const all=[];for(const e of Object.keys(propertyNames))if("feature"!=e&&"boxGeoLength"!=e){let t=getEnumByProperty(e);for(const o of propertyNames[e]){let e="";if("number"===t)try{const t=WcNumberBox.getNumberMeta(o);"horizontalFocalPoint"!==o&&"verticalFocalPoint"!==o&&"horizontalFocalPointDocument"!==o&&"verticalFocalPointDocument"!==o||(t.max=1,t.min=0,t.step=.01),e=t.min+" to "+t.max}catch(t){e=""}"bulletShape"===o&&(t="shapeName",e=PathGeometry.getBulletShapeGenerators().map((e=>"`"+e.name+"`")).join(", ")),"spreadName"===o&&(t="spreadName",e="Any valid name of a page (spread) in a Sub-Document"),"documentName"===o&&(t="documentName",e="Any valid name of a Sub-Document in the current Template"),all.push({name:o,type:t,range:e,feature:""})}}function getEnumByProperty(e){switch(e){case"imageMasking":return"imageMask";case"textWrapMode":return"textWrap";case"autoTextMode":return"autoText";default:return e}}const allPropertyNamesForStyles=all.filter((e=>!e.name.startsWith("allow")&&(!e.name.startsWith("anchor")&&(!(e.name.indexOf("Omits")>=0)&&!(["class","imageType","storyContent","autoTextMode","simpleTextMode","barcodeType","frameRepeat","boundToBoxSelection","isUiElement","buyerOrderNo","clickActionFormFieldName","clickActionFormFieldValue","closed","firstBaseline","useBaselineGrid","fontHeights","gridSize","hasClickAction","hasFormField","hasZoomAction","imageWidthScale","imageHeightScale","imageXPosition","imageYPosition","lockAspectRatio","lockBox","lockForAdmin","lockForBuyer","meshRows","meshActive","meshColumns","orientation","pathDefinesBoxSize","zoomActionOrderNo","textFieldCaption","transformTopLeftX","transformTopLeftY","transformTopRightX","transformTopRightY","transformBottomRightX","transformBottomRightY","transformBottomLeftX","transformBottomLeftY","bevel","bevelActive","bevelBlur","bevelLightX","bevelLightY","bevelOmits","bevelSpecularConstant","bevelspecularExponent","bevelSurfaceScale","bevelLightColor","bevelPointLightX","bevelPointLightY","bevelPointLightZ"].indexOf(e.name)>=0))))).sort(((e,t)=>e.name.localeCompare(t.name)));function compareValues(e,t,o){return isLengthProperty(e)?t.toString()===o.toString():isColorProperty(e)?t.equals(o):isFontProperty(e)?t.font.name===o.font.name:isImageProperty(e)?t.url===o.url:t===o}function checkValue(e,t){const o=e;if(isColorProperty(o))return t instanceof ColorRef;if(isLengthProperty(o))return t instanceof Length;if(isStoryContentProperty(o))return"object"==typeof t&&Object.prototype.hasOwnProperty.call(t,"scopeTextStyle")&&Object.prototype.hasOwnProperty.call(t,"pts");if(isTabsProperty(o))return"string"==typeof t;if(isNumberProperty(o))return null!=t&&""!==t&&!isNaN(Number(t.toString()));if(isFontProperty(o))return t instanceof FontRef;if(isImageProperty(o))return t instanceof Image$1;if(isStringProperty(o))return"string"==typeof t;if(isAnchorProperty(o))return!0===t||!1===t;if(isBooleanProperty(o))return!0===t||!1===t;if(isEnumProperty(o))return"string"==typeof t&&checkEnumValue(o,t);if(isAllowProperty(o))return Array.isArray(t);throw assertNever$1(o),new Error("["+o+":"+t+";] - Invalid Property Name ("+o+").")}function checkEnumValue(e,t){const o=e;if(isHorizontalPathTextAlignProperty(o))return-1!==enums.horizontalPathTextAlign.indexOf(t);if(isHorizontalTextAlignProperty(o))return-1!==enums.horizontalTextAlign.indexOf(t);if(isHorizontalSimpleTextAlignProperty(o))return-1!==enums.horizontalSimpleTextAlign.indexOf(t);if(isVerticalSimpleTextAlignProperty(o))return-1!==enums.verticalSimpleTextAlign.indexOf(t);if(isVerticalStoryTextAlignProperty(o))return-1!==enums.verticalStoryTextAlign.indexOf(t);if(isTextWrapModeProperty(o))return-1!==enums.textWrap.indexOf(t);if(isImageMaskingProperty(o))return-1!==enums.imageMask.indexOf(t);if(isImagePlacementProperty(o))return-1!==enums.imagePlacement.indexOf(t);if(isGridSizeProperty(o))return-1!==enums.gridSize.indexOf(t);if(isImageTypeProperty(o))return-1!==enums.imageType.indexOf(t);if(istextTransformProperty(o))return-1!==enums.textTransform.indexOf(t);if(isFrameRepeatProperty(o))return-1!==enums.frameRepeat.indexOf(t);if(isAutoTextModeProperty(o))return-1!==enums.autoText.indexOf(t);if(isSimpleTextModeProperty(o))return-1!==enums.simpleTextMode.indexOf(t);if(isBarcodeTypeProperty(o))return-1!==enums.barcodeType.indexOf(t);if(isWarpArcPositionProperty(o))return-1!==enums.warpArcPosition.indexOf(t);if(isWarpPitPositionProperty(o))return-1!==enums.warpPitPosition.indexOf(t);if(isWarpArchPositionProperty(o))return-1!==enums.warpArchPosition.indexOf(t);if(isWarpArchMirrorProperty(o))return-1!==enums.warpArchMirror.indexOf(t);if(isDocumentPlacementProperty(o))return-1!==enums.documentPlacement.indexOf(t);if(isAnchorRotationProperty(o))return-1!==enums.anchorRotation.indexOf(t);if(isBlendModeProperty(o))return-1!==enums.blendMode.indexOf(t);if(isImageChannelProperty(o))return-1!==enums.imageChannel.indexOf(t);if(isBulletModeProperty(o))return-1!==enums.bulletMode.indexOf(t);if(isEffectAreaProperty(o))return-1!==enums.effectArea.indexOf(t);if(isBuyerOrderNoProperty(o))return-1!==enums.buyerOrderNo.indexOf(t);if(isFontHeightsProperty(o))return-1!==enums.fontHeights.indexOf(t);if(isFirstBaselineProperty(o))return-1!==enums.firstBaseline.indexOf(t);if(isHyphenationLanguageProperty(o))return-1!==enums.hyphenationLanguage.indexOf(t);if(isStrokeAlignProperty(o))return-1!==enums.strokeAlign.indexOf(t);if(isStrokeTypeProperty(o))return-1!==enums.strokeType.indexOf(t);if(isStrokeJoinProperty(o))return-1!==enums.strokeJoin.indexOf(t);if(isStrokeCapProperty(o))return-1!==enums.strokeCap.indexOf(t);if(isDashDistributionProperty(o))return-1!==enums.dashDistribution.indexOf(t);if(isTransformProperty(o))return-1!==enums.transform.indexOf(t);if(isOrientationProperty(o))return-1!==enums.transform.indexOf(t);throw assertNever$1(o),new Error("["+o+":"+t+";] - Invalid Enum Property Name ("+o+").")}function isColorProperty(e){return-1!==propertyNames.color.indexOf(e)}function isStoryContentProperty(e){return-1!==propertyNames.storyContent.indexOf(e)}function isTabsProperty(e){return-1!==propertyNames.tabs.indexOf(e)}function isFontProperty(e){return-1!==propertyNames.font.indexOf(e)}function isVerticalSimpleTextAlignProperty(e){return-1!==propertyNames.verticalSimpleTextAlign.indexOf(e)}function isVerticalStoryTextAlignProperty(e){return-1!==propertyNames.verticalStoryTextAlign.indexOf(e)}function isHorizontalTextAlignProperty(e){return-1!==propertyNames.horizontalTextAlign.indexOf(e)}function isHorizontalPathTextAlignProperty(e){return-1!==propertyNames.horizontalPathTextAlign.indexOf(e)}function isHorizontalSimpleTextAlignProperty(e){return-1!==propertyNames.horizontalSimpleTextAlign.indexOf(e)}function isAutoTextModeProperty(e){return-1!==propertyNames.autoTextMode.indexOf(e)}function isSimpleTextModeProperty(e){return-1!==propertyNames.simpleTextMode.indexOf(e)}function isBarcodeTypeProperty(e){return-1!==propertyNames.barcodeType.indexOf(e)}function isStrokeAlignProperty(e){return-1!==propertyNames.strokeAlign.indexOf(e)}function isStrokeTypeProperty(e){return-1!==propertyNames.strokeType.indexOf(e)}function isStrokeJoinProperty(e){return-1!==propertyNames.strokeJoin.indexOf(e)}function isDashDistributionProperty(e){return-1!==propertyNames.dashDistribution.indexOf(e)}function isStrokeCapProperty(e){return-1!==propertyNames.strokeCap.indexOf(e)}function isFrameRepeatProperty(e){return-1!==propertyNames.frameRepeat.indexOf(e)}function isImageProperty(e){return-1!==propertyNames.image.indexOf(e)}function isAllowProperty(e){return-1!==propertyNames.allow.indexOf(e)}function isImageMaskingProperty(e){return-1!==propertyNames.imageMasking.indexOf(e)}function isImagePlacementProperty(e){return-1!==propertyNames.imagePlacement.indexOf(e)}function isGridSizeProperty(e){return-1!==propertyNames.gridSize.indexOf(e)}function isDocumentPlacementProperty(e){return-1!==propertyNames.documentPlacement.indexOf(e)}function isImageTypeProperty(e){return-1!==propertyNames.imageType.indexOf(e)}function istextTransformProperty(e){return-1!==propertyNames.textTransform.indexOf(e)}function isTransformProperty(e){return-1!==propertyNames.transform.indexOf(e)}function isWarpArcPositionProperty(e){return-1!==propertyNames.warpArcPosition.indexOf(e)}function isWarpPitPositionProperty(e){return-1!==propertyNames.warpPitPosition.indexOf(e)}function isWarpArchPositionProperty(e){return-1!==propertyNames.warpArchPosition.indexOf(e)}function isWarpArchMirrorProperty(e){return-1!==propertyNames.warpArchMirror.indexOf(e)}function isTextWrapModeProperty(e){return-1!==propertyNames.textWrapMode.indexOf(e)}function isAnchorRotationProperty(e){return-1!==propertyNames.anchorRotation.indexOf(e)}function isBlendModeProperty(e){return-1!==propertyNames.blendMode.indexOf(e)}function isImageChannelProperty(e){return-1!==propertyNames.imageChannel.indexOf(e)}function isOrientationProperty(e){return-1!==propertyNames.orientation.indexOf(e)}function isBulletModeProperty(e){return-1!==propertyNames.bulletMode.indexOf(e)}function isEffectAreaProperty(e){return-1!==propertyNames.effectArea.indexOf(e)}function isBuyerOrderNoProperty(e){return-1!==propertyNames.buyerOrderNo.indexOf(e)}function isFontHeightsProperty(e){return-1!==propertyNames.fontHeights.indexOf(e)}function isFirstBaselineProperty(e){return-1!==propertyNames.firstBaseline.indexOf(e)}function isHyphenationLanguageProperty(e){return-1!==propertyNames.hyphenationLanguage.indexOf(e)}function isBoxGeoLengthProperty(e){return-1!==propertyNames.boxGeoLength.indexOf(e)}function isLengthProperty(e){return-1!==propertyNames.length.indexOf(e)}function isAnchorProperty(e){return-1!==propertyNames.anchor.indexOf(e)}function isBooleanProperty(e){return-1!==propertyNames.boolean.indexOf(e)}function isNumberProperty(e){return-1!==propertyNames.number.indexOf(e)}function isStringProperty(e){return-1!==propertyNames.string.indexOf(e)}const propertyToFeatureIndex={baselineShift:{features:["Character / Paragraph Style"],hint:""},bevelActive:{features:["Effect"],hint:""},bevelBlur:{features:["Effect"],hint:""},bevelLightColor:{features:["Effect"],hint:""},bevelPointLightX:{features:["Effect"],hint:""},bevelPointLightY:{features:["Effect"],hint:""},bevelPointLightZ:{features:["Effect"],hint:""},bevelSpecularConstant:{features:["Effect"],hint:""},bevelspecularExponent:{features:["Effect"],hint:""},bevelSurfaceScale:{features:["Effect"],hint:""},blendMode:{features:["Effect"],hint:""},blurActive:{features:["Effect"],hint:""},blurIntensity:{features:["Effect"],hint:""},bottom:{features:["Geometry"],hint:""},brightness:{features:["Effect"],hint:""},bulletColor:{features:["Paragraph-Style"],hint:""},bulletMode:{features:["Paragraph-Style"],hint:""},bulletShape:{features:["Paragraph-Style"],hint:""},bulletShift:{features:["Paragraph-Style"],hint:""},bulletSize:{features:["Paragraph-Style"],hint:""},contrast:{features:["Effect"],hint:""},dashDistribution:{features:["Shape"],hint:""},distance:{features:["Text on Path"],hint:""},distortActive:{features:["Warp"],hint:""},distortFrequency:{features:["Warp"],hint:""},distortOctaves:{features:["Warp"],hint:""},distortScale:{features:["Warp"],hint:""},documentName:{features:["Sub Document"],hint:""},documentPlacement:{features:["Sub Document"],hint:""},dropActive:{features:["Effect"],hint:""},dropBlend:{features:["Effect"],hint:""},dropBlurRadius:{features:["Effect"],hint:""},dropColor:{features:["Effect"],hint:""},dropSpreadRadius:{features:["Effect"],hint:""},dropXoffset:{features:["Effect"],hint:""},dropYoffset:{features:["Effect"],hint:""},fillColor:{features:["Shape"],hint:""},firstLineIndent:{features:["Paragraph-Style"],hint:""},font:{features:["Single Line Text","Character / Paragraph Style"],hint:""},fontColor:{features:["Single Line Text","Character / Paragraph Style"],hint:""},fontDashDistribution:{features:["Single Line Text"],hint:""},fontSize:{features:["Single Line Text","Character / Paragraph Style"],hint:""},fontStrokeAlign:{features:["Single Line Text"],hint:""},fontStrokeColor:{features:["Single Line Text"],hint:""},fontStrokeDashFactor:{features:["Single Line Text"],hint:""},fontStrokeGapFactor:{features:["Single Line Text"],hint:""},fontStrokeJoin:{features:["Single Line Text"],hint:""},fontStrokeType:{features:["Single Line Text"],hint:""},fontStrokeWidth:{features:["Single Line Text"],hint:""},grayscale:{features:["Effect"],hint:""},hasFontSize:{features:["Single Line Text"],hint:""},height:{features:["Geometry"],hint:""},hideNonPrintableLayers:{features:["Sub Document"],hint:""},horizontalFocalPoint:{features:["Image"],hint:""},horizontalFocalPointDocument:{features:["Sub Document"],hint:""},horizontalPathTextAlign:{features:["Text on Path"],hint:""},horizontalSimpleTextAlign:{features:["Single Line Text"],hint:""},horizontalTextAlign:{features:["Paragraph-Style"],hint:""},hueRotate:{features:["Effect"],hint:""},hyphenationLanguage:{features:["Multi Line Text - Frame"],hint:""},if:{features:["Style Class"],hint:""},image:{features:["Image"],hint:""},imageMasking:{features:["Image"],hint:""},imagePlacement:{features:["Image"],hint:""},inGlowActive:{features:["Effect"],hint:""},inGlowArea:{features:["Effect"],hint:""},inGlowBlend:{features:["Effect"],hint:""},inGlowBlurRadius:{features:["Effect"],hint:""},inGlowColor:{features:["Effect"],hint:""},inGlowSpreadRadius:{features:["Effect"],hint:""},inGlowXoffset:{features:["Effect"],hint:""},inGlowYoffset:{features:["Effect"],hint:""},inShadowActive:{features:["Effect"],hint:""},inShadowArea:{features:["Effect"],hint:""},inShadowBlend:{features:["Effect"],hint:""},inShadowBlurRadius:{features:["Effect"],hint:""},inShadowColor:{features:["Effect"],hint:""},inShadowSpreadRadius:{features:["Effect"],hint:""},inShadowXoffset:{features:["Effect"],hint:""},inShadowYoffset:{features:["Effect"],hint:""},invert:{features:["Effect"],hint:""},left:{features:["Geometry"],hint:""},leftIndent:{features:["Paragraph-Style"],hint:""},lineHeight:{features:["Character / Paragraph Style"],hint:""},maskActive:{features:["Effect"],hint:""},maskChannel:{features:["Effect"],hint:""},maskImage:{features:["Effect"],hint:""},maskInverse:{features:["Effect"],hint:""},maxCharacters:{features:["Single Line Text"],hint:""},maxHeight:{features:["Multi Line Text - Frame"],hint:""},maxLetterSpacing:{features:["Single Line Text"],hint:""},maxLetterWidth:{features:["Single Line Text"],hint:""},maxWidth:{features:["Multi Line Text - Frame"],hint:""},meshActive:{features:["Warp"],hint:""},minHeight:{features:["Multi Line Text - Frame"],hint:""},minLetterSpacing:{features:["Single Line Text"],hint:""},minLetterWidth:{features:["Single Line Text"],hint:""},minWidth:{features:["Multi Line Text - Frame"],hint:""},opacity:{features:["Effect"],hint:""},outGlowActive:{features:["Effect"],hint:""},outGlowBlend:{features:["Effect"],hint:""},outGlowBlurRadius:{features:["Effect"],hint:""},outGlowColor:{features:["Effect"],hint:""},outGlowSpreadRadius:{features:["Effect"],hint:""},outGlowXoffset:{features:["Effect"],hint:""},outGlowYoffset:{features:["Effect"],hint:""},paddingBottom:{features:["Frame"],hint:""},paddingLeft:{features:["Frame"],hint:""},paddingRight:{features:["Frame"],hint:""},paddingTop:{features:["Frame"],hint:""},pathTextFont:{features:["Text on Path"],hint:""},pathTextFontColor:{features:["Text on Path"],hint:""},pathTextFontSize:{features:["Text on Path"],hint:""},pathTextStrokeAlign:{features:["Text on Path"],hint:""},pathTextStrokeColor:{features:["Text on Path"],hint:""},pathTextStrokeJoin:{features:["Text on Path"],hint:""},pathTextStrokeWidth:{features:["Text on Path"],hint:""},perspectiveActive:{features:["Warp"],hint:""},right:{features:["Geometry"],hint:""},rightIndent:{features:["Paragraph-Style"],hint:""},rotation:{features:["Geometry"],hint:""},saturate:{features:["Effect"],hint:""},sepia:{features:["Effect"],hint:""},spaceAfterParagraph:{features:["Paragraph-Style"],hint:""},spaceBeforeParagraph:{features:["Paragraph-Style"],hint:""},spreadName:{features:["Sub Document"],hint:""},startX:{features:["Text on Path"],hint:""},strokeActive:{features:["Effect"],hint:""},strokeAlign:{features:["Shape"],hint:""},strokeBlend:{features:["Effect"],hint:""},strokeBlurRadius:{features:["Effect"],hint:""},strokeCap:{features:["Shape"],hint:""},strokeColor:{features:["Shape"],hint:""},strokeDashFactor:{features:["Shape"],hint:""},strokeEffectColor:{features:["Effect"],hint:""},strokeGapFactor:{features:["Shape"],hint:""},strokeJoin:{features:["Shape"],hint:""},strokeSpreadRadius:{features:["Effect"],hint:""},strokeType:{features:["Shape"],hint:""},strokeWidth:{features:["Shape"],hint:""},strokeXoffset:{features:["Effect"],hint:""},strokeYoffset:{features:["Effect"],hint:""},symbolKeepRatio:{features:["Single Line Text"],hint:""},tabLineColor:{features:["Paragraph-Style"],hint:""},tabLineHeight:{features:["Paragraph-Style"],hint:""},tabLineType:{features:["Paragraph-Style"],hint:""},tabs:{features:["Paragraph-Style"],hint:""},tabSize:{features:["Paragraph-Style"],hint:""},text:{features:["Single Line Text"],hint:""},textAfter:{features:["Single Line Text"],hint:""},textBefore:{features:["Single Line Text"],hint:""},textOnPath:{features:["Text on Path"],hint:""},textTransform:{features:["Single Line Text"],hint:""},textWrapMode:{features:["Frame"],hint:""},top:{features:["Geometry"],hint:""},tracking:{features:["Character / Paragraph Style"],hint:""},turbulenceActive:{features:["Effect"],hint:""},turbulenceFrequency:{features:["Effect"],hint:""},turbulenceOctaves:{features:["Effect"],hint:""},turbulenceScale:{features:["Effect"],hint:""},verticalFocalPoint:{features:["Image"],hint:""},verticalFocalPointDocument:{features:["Sub Document"],hint:""},verticalSimpleTextAlign:{features:["Single Line Text"],hint:""},verticalStoryTextAlign:{features:["Multi Line Text - Frame"],hint:""},visible:{features:["Frame"],hint:""},warpArcActive:{features:["Warp"],hint:""},warpArchActive:{features:["Warp"],hint:""},warpArcHeightFraction:{features:["Warp"],hint:""},warpArchMirror:{features:["Warp"],hint:""},warpArchPhi:{features:["Warp"],hint:""},warpArchPosition:{features:["Warp"],hint:""},warpArcPosition:{features:["Warp"],hint:""},warpCupActive:{features:["Warp"],hint:""},warpCupPhi:{features:["Warp"],hint:""},warpCupY:{features:["Warp"],hint:""},warpCustomActive:{features:["Warp"],hint:""},warpCustomBottomHeightFraction:{features:["Warp"],hint:""},warpCustomBottomPhase:{features:["Warp"],hint:""},warpCustomBottomTransform:{features:["Warp"],hint:""},warpCustomBottomWaves:{features:["Warp"],hint:""},warpCustomTopHeightFraction:{features:["Warp"],hint:""},warpCustomTopPhase:{features:["Warp"],hint:""},warpCustomTopTransform:{features:["Warp"],hint:""},warpCustomTopWaves:{features:["Warp"],hint:""},warpFishActive:{features:["Warp"],hint:""},warpFishHeightFraction:{features:["Warp"],hint:""},warpFishWaves:{features:["Warp"],hint:""},warpFlagActive:{features:["Warp"],hint:""},warpFlagHeightFraction:{features:["Warp"],hint:""},warpFlagPhase:{features:["Warp"],hint:""},warpFlagWaves:{features:["Warp"],hint:""},warpPitActive:{features:["Warp"],hint:""},warpPitHeightFraction:{features:["Warp"],hint:""},warpPitPosition:{features:["Warp"],hint:""},width:{features:["Geometry"],hint:""},wrapObjectOffset:{features:["Frame"],hint:""},wrapShapeOffset:{features:["Multi Line Text - Frame"],hint:""},wrapAscenderDiminisher:{features:["Multi Line Text - Frame"],hint:""},wrapTextInShape:{features:["Shape"],hint:""}},darkColors=["MEDIUMVIOLETRED","MEDIUMBLUE","DARKGREEN","MEDIUMORCHID","BROWN","INDIGO","LIMEGREEN","TEAL","CORAL","STEELBLUE","ORANGERED","DARKKHAKI"].map((e=>e.toLowerCase()));class Style{constructor(e,t,o,i,r){var s;if(this.lastFrameCreationTimestamp=0,this.lastVariableDataTimestamp=0,this.creationTimeStamp=0,this.id=e||generateDBID(),this.errors=[],this.docStyleId=null!==(s=null==o?void 0:o.id)&&void 0!==s?s:null,i){const e=scope().getBox(i);if(e&&e.box.docRef){const t=scope().getDocByName(e.box.docRef.documentName);null==t||t.id,null==o||o.id}}void 0===t?this.text="":"object"==typeof t&&"string"==typeof t.txt?this.text=t.txt||"":(console.error("Cant deserialize style sheet, o is not of iStyleStore",t),this.text=""),this.evaluate(o,i,r),this.creationTimeStamp=Date.now();const n=new Map,a=new Map;let l=0;for(const e of this.classes){this.errors.push(...e.errors);for(const t of e.classNames){let o=n.get(t);o||(o=[],n.set(t,o),a.set(t,l++)),o.push(e)}}this.classNameLookUp=n,this.classIndexLookUp=a;let c=0;const d=new Map;for(const e of this.classNameLookUp.keys())c===darkColors.length-1&&(c=0),d.set(e,darkColors[c]),c++;this.classNameColorLookUp=d}static getNewGlobalStyle(){return new Style("global",{txt:["/* To create a style","   press (+) in the","   toolbar above. */","",".headline {\n\tfont:Noto Sans;\n\tfontSize: 24pt;\n\tfontColor: [Black];\n}\n",".subline {\n\tfont:Noto Sans;\n\tfontSize: 16pt;\n\tfontColor: [Black];\n}\n"].join("\n")})}evaluate(e,t,o){var i;const r=parseClasses(this.text.replace(/\/\*[\s\S]*?\*\//g,"")),s=[],n=new Map,a=new Map;let l;for(const[c,d]of r){const r=null==o?void 0:o.classNameLookUp.get(c.replace(".",""));if(1===d.length&&o&&r&&1===r.length){const i=r[0];if(i.rawContent===d[0]){let r=!1,l=!1;if(i.usedFields&&0!==i.usedFields.size&&o.lastVariableDataTimestamp!==scope().variableDataTimestamp){r=!0;for(const[o,s]of i.usedFields){if(scope().getFormFieldValue(o.split("#")[0],t||null,e)!==s){r=!1;break}}}else r=!0;if(i.usedFrames&&0!==i.usedFrames.size&&o.lastFrameCreationTimestamp!==Box.lastFrameCreationTimestamp||(l=!0),r&&l){if(s.push(i),i.usedFrames)for(const[e,t]of i.usedFrames)n.set(e,t);if(i.usedFields)for(const[e,t]of i.usedFields)a.set(e,t);continue}}}l=[];const h=[],p=new Map,u=new Map;for(const e of d){let o=[];const r=evaluateText(t||null,e,this.docStyleId?scope().docs.get(this.docStyleId):void 0);if(r.errors.length&&l.push(...r.errors),r.fields)for(const[e,t]of r.fields)a.set(e,t),u.set(e,t);if(r.frames)for(const[e,t]of r.frames)n.set(e,t),p.set(e,t);if(r.text){const e=parseCssProperties(r.text,c);(null===(i=e.errors)||void 0===i?void 0:i.length)&&l.push(...e.errors),o=e.props}const s=o.filter((e=>"if"===e.name));let d=!1;s.length>0&&!1===s[s.length-1].value&&(d=!0),d||!o.length&&!l.length||h.push(...o.filter((e=>"if"!==e.name)))}s.push(new StyleClass(c,1===d.length?d[0]:"",h,l,u,p,!1))}this.classes=s,this.lastFrameValues=n,this.lastFormFieldValues=a,this.lastVariableDataTimestamp=scope().variableDataTimestamp,this.lastFrameCreationTimestamp=Box.lastFrameCreationTimestamp}hasStyleJsFrameNameReference(e,t){var o,i;const r=t?e+"#"+t:e;return null!==(i=null===(o=this.lastFrameValues)||void 0===o?void 0:o.has(r))&&void 0!==i&&i}getClassesByFrame(e,t){var o;const i=new Set,r=t?e+"#"+t:e;for(const e of this.classes)if(null===(o=e.usedFrames)||void 0===o?void 0:o.has(r))for(const t of e.classNames)i.add(t);return Array.from(i)}getClassesByField(e,t){var o;const i=new Set,r=t?e+"#"+t:e;for(const e of this.classes)if(null===(o=e.usedFields)||void 0===o?void 0:o.has(r))for(const t of e.classNames)i.add(t);return Array.from(i)}getClassesByFormField(e,t){var o;const i=[],r=t?e+"#"+t:e;for(const e of this.classes)(null===(o=e.usedFields)||void 0===o?void 0:o.has(r))&&i.push(e.classNames.join(" "));return i}isEvaluationUpToDate(e,t){if(this.lastVariableDataTimestamp===scope().variableDataTimestamp&&this.lastFrameCreationTimestamp===Box.lastFrameCreationTimestamp)return!0;if(e)return this.isEvaluationUpToDateByClass(e,t);if(this.lastVariableDataTimestamp!==scope().variableDataTimestamp&&this.lastFormFieldValues&&this.lastFormFieldValues.size>0)for(const[e,t]of this.lastFormFieldValues){const o=e.split("#");if(t!==scope().getFormFieldValue(o[0],o[1]||void 0))return!1}if(this.lastFrameCreationTimestamp!==Box.lastFrameCreationTimestamp&&t&&this.lastFrameValues&&this.lastFrameValues.size>0)for(const[e,o]of this.lastFrameValues){const i=e.split("#");let r;try{r=scope().getFrameValue(i[0],i[1]||void 0,t)}catch(e){r=null}if(r){const e=r,t=o;if(e.left.toFixed(2)!==t.left.toFixed(2)||e.top.toFixed(2)!==t.top.toFixed(2)||e.width.toFixed(2)!==t.width.toFixed(2)||e.height.toFixed(2)!==t.height.toFixed(2))return console_log(">>>>>> FRAME Dimensions have changed, re-evaluate style (Propable Auto-Size-Text)"),!1}}return!0}isEvaluationUpToDateByClass(e,t){for(const o of e.split(" "))if(o){const e=this.classNameLookUp.get(o);if(e&&e.length)for(const i of e)if(!this.isStyleUpToDate(i,o,t))return!1}return!0}getStyleTimeStampByClass(e){const t=this.isEvaluationUpToDate(Array.from(e).join(" "),void 0);let o=!1,i=0;for(const r of e.keys()){const e=this.classNameLookUp.get(r);if(e){if(o=!0,!t)return"outdated";1===e.length?e[0].timeStamp>i&&(i=e[0].timeStamp):this.creationTimeStamp>i&&(i=this.creationTimeStamp)}}return o?i:"no-class"}isStyleUpToDate(e,t,o=scope().currentDoc){if(this.lastVariableDataTimestamp!==scope().variableDataTimestamp&&e.usedFields&&e.usedFields.size>0)for(const[o,i]of e.usedFields){const e=o.split("#");if(i!==scope().getFormFieldValue(e[0],e[1]||void 0))return console_log(">>>>>> [FORM."+o+"] Value has changed for class ["+t+"], re-evaluate style"),!1}if(this.lastFrameCreationTimestamp!==Box.lastFrameCreationTimestamp&&o&&e.usedFrames&&e.usedFrames.size>0)for(const[t,i]of e.usedFrames){const e=t.split("#");let r;try{r=scope().getFrameValue(e[0],e[1]||void 0,o)}catch(e){r=null}if(r){const e=r,t=i;if(e.left.toFixed(2)!==t.left.toFixed(2)||e.top.toFixed(2)!==t.top.toFixed(2)||e.width.toFixed(2)!==t.width.toFixed(2)||e.height.toFixed(2)!==t.height.toFixed(2))return console_log(">>>>>> FRAME Dimensions have changed, re-evaluate style (Propable Auto-Size-Text)"),!1}}return!0}get classNames(){const e=[];for(const t of this.classes)for(const o of t.classNames)e.push(o);return e}assignCachedDimensionsToImageProperties(e){for(const t of this.classes)if(t.properties.has("image")){const o=t.properties.get("image");if(o&&o.value){const i=o.value;i&&0===i.width&&0===i.height&&i.url===e&&t.properties.set("image",new StyleProperty(o.name,i.url,o.selector))}}}getProperty(e,t,o,i){let r,s=e.replace(/\s+/g," ").split(" ");s=s.sort(((e,t)=>(this.classIndexLookUp.get(e)||-1)-(this.classIndexLookUp.get(t)||-1)));for(const e of s){const s=this.classNameLookUp.get(e);if(s)for(const e of s){const s=e.getProperty(t,o,i);s&&(r=s)}}return r}getTextStyles(){const e=[];for(const t of this.classes)t.isTextStyle&&e.push({className:t.classNames[0],previewCss:t.previewTextStyleCss,caption:t.classNames[0]});return e}serializeSimple(){return{txt:this.text}}serialize(e=!1){return{type:"style",id:e?generateDBID():this.id,data:this.serializeSimple(),scopeId:scope().id,parentId:scope().id}}}class StyleClass{constructor(e,t,o,i,r,s,n){this.properties=new Map;for(const e of o)this.properties.set(e.name,e);this.rawContent=t,this.selector=e,this.errors=i,this.timeStamp=Date.now(),this.classNames=e.trim().replace(/(\s*,\s*|\s+)/g,",").split(",").map((e=>e.replace(/^\./,""))),this.usedFields=r,this.usedFrames=s,this.usesDoc=n}get isTextStyle(){return this.properties.has("font")&&this.properties.has("fontColor")&&this.properties.has("fontSize")}get previewTextStyleCss(){let e="";const t=this.getProperty("fontColor",100,100);t&&(e+="color:"+t.value.toCssColor()+";");const o=this.getProperty("fontSize",100,100);o&&(e+="font-size:"+Math.min(o.value.toPixel(500,500),20)+"px;");const i=this.getProperty("font",100,100);return i&&(e+="font-family:"+i.value.font.cssName+";"),e}getProperty(e,t,o){const i=this.properties.get(e);if(i)return i}}class StyleProperty{constructor(e,t,o){const i=e;if(this.name=e,this.selector=o,isColorProperty(i)){const e=scope().colors.getSwatchByName(t);if(e)this._value=new ColorRef(e);else{const e=Color.parseRgbColor(t);if(!e)throw"["+i+":"+t+";] - Invalid Color Value. Must be named color, hex, rgb(), rgba() or 'transparent'.";this._value=new ColorRef(e)}}else if(isLengthProperty(i)){if("string"!=typeof t||!t.match(/\d+\.*\d*(px|mm|cm|%|pt|inch)/))throw"["+t+"] is not valid for "+i+". Must be px,cm,pt,inch,%,equation or plain number";this._value=new Length(t)}else if(isNumberProperty(i)){if(null==t||""===t||isNaN(Number(t.toString())))throw"["+t+"] is not valid for "+i+". Must be number";this._value=parseFloat(t)}else if(isFontProperty(i)){"string"==typeof t&&(t=t.replace(/(^"|^')/g,"").replace(/("$|'$)/g,""));const e=scope().fonts_getByName(t);if(e)this._value=new FontRef(e);else if("Noto Sans"===t)this._value=new FontRef(getNotoSans());else{if("PrintessSummer"!==t)throw"["+i+":"+t+";] - Invalid Font Name.";this._value=new FontRef(getSymbolFont())}}else if(isImageProperty(i)){const e=scope().images_getOrCreate(t);if(!e)throw new Error("["+i+":"+t+";] - Invalid Image Name / ID / URL.");this._value=e}else if(isAllowProperty(i)){const e=t.split(" ");if(!e||""===e.join(""))throw new Error("["+i+":"+t+";] - Invalid Allow Value");this._value=e}else if(isStringProperty(i)){if("string"!=typeof t)throw"["+t+"] is not valid for "+i+". Must be string";t=t.replace(/(^"|^')/g,"").replace(/("$|'$)/g,""),this._value=t}else if(isAnchorProperty(i)||isBooleanProperty(i)){if("true"!==t&&"false"!==t)throw"["+t+"] is not valid for "+i+" must be 'true' or 'false'";this._value="true"===t}else if(isEnumProperty(i)){if(!checkEnumValue(i,t))throw"enum ["+t+"] is not valid for "+i;this._value=t}else{if(isStoryContentProperty(i))throw"StoryContentProperty not allowed in styles";if(isTabsProperty(i)){if(""===t)throw"tabs must have a value like L1cm C_3cm R5cm .7cm";this._value=t}else assertNever$1(i,"["+i+":"+t+";] - Invalid Property Name ("+i+").")}}get value(){return this._value}}function parseClasses(e){let t=0,o=-1,i="";const r=new Map;for(let s=0;s<e.length;s++){const n=e.substr(s,1);if(0===t&&("\n"===n?i="":"{"!==n&&(i+=n)),"{"===n&&(0===t&&i&&(o=s+1),t++),"}"===n&&(t--,0===t)){if(o<s-1){const t=i.trim(),n=r.get(t),a=e.substring(o,s-1);n?n.push(a):r.set(t,[a])}i=""}}return r}function parseCssProperties(e,t){const o=[],i=/\s*(.+?)\s*:\s*(.+?)\s*(!important|)\s*(;|$)/g;let r;const s=[];for(;null!==(r=i.exec(e));)if(r.index===i.lastIndex&&i.lastIndex++,r.length>=4){const e=r[1],i=r[2];try{o.push(new StyleProperty(e,i,t))}catch(e){s.push(e)}}return{props:o,errors:s}}class Store{constructor(e="keyval-store",t="keyval"){this.storeName=t,this._dbp=new Promise(((o,i)=>{const r=indexedDB.open(e,1);r.onerror=()=>i(r.error),r.onsuccess=()=>o(r.result),r.onupgradeneeded=()=>{r.result.createObjectStore(t)}}))}_withIDBStore(e,t){return this._dbp.then((o=>new Promise(((i,r)=>{const s=o.transaction(this.storeName,e);s.oncomplete=()=>i(),s.onabort=s.onerror=()=>r(s.error),t(s.objectStore(this.storeName))}))))}}let store;function getDefaultStore(){return store||(store=new Store),store}function get$1(e,t=getDefaultStore()){let o;return t._withIDBStore("readonly",(t=>{o=t.get(e)})).then((()=>o.result))}function del(e,t=getDefaultStore()){return t._withIDBStore("readwrite",(t=>{t.delete(e)}))}class Snippet{constructor(e){e=e||{},this.id=e.id||generateDBID(),this.userId=e.uid||"",this.docId=e.did||"",this.title=e.title||"",this.tags=e.tags?new Set(e.tags):new Set,this.thumbUrl=e.iurl||"",this.bgColor=e.bg||"#fff",this.isLayoutSnippet=e.ils||!1,this.isGroupSnippet=e.igs||!1,this.snippetUrl=e.surl||""}hasTag(e,t){if(!this.tags.has(t))return!1;if(!e.size)return!0;for(const t of e)if(this.tags.has(t))return!0;return!1}hasAllTags(e){for(const t of e)if(!this.tags.has(t))return!1;return!0}thumbNailCssUrl(){const e=this.thumbUrl;return e?"url('"+e+"')":"none"}thumbNailCss(){return this.thumbUrl?`background-image: ${this.thumbNailCssUrl()}; background-size: cover; background-position: 50% 50%; background-repeat: no-repeat;`:""}}var __awaiter$H=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};const buyerSideSnippetCache=new Map;function loadSnippets(e,t,o){return __awaiter$H(this,void 0,void 0,(function*(){const o=[];if("layout"!==t||config.isBuyer||config.isMobile||o.push(new Snippet({bg:"#ffffff",id:"REMOVE",did:"",igs:!1,ils:!0,iurl:"",surl:"",tags:[],title:"Blank Layout",uid:""})),scope().templateProperties.includeTemplateSnippets){o.push(...Array.from(scope().docs.values()).filter((e=>"layout"===t&&e.isLayoutSnippet||"group"===t&&e.isGroupSnippet&&e!==scope().currentDoc)).map((e=>new Snippet({bg:e.docBackgroundColor.toCssColor(),id:"LOCAL-DOC",did:e.id,igs:e.isGroupSnippet,ils:e.isLayoutSnippet,iurl:"",surl:"",tags:[],title:"Local Document "+e.name,uid:""}))));for(const e of o)e.thumbUrl=yield getThumbnailUrlByDocId(e.docId)}if(0===e.length)return o;const i=new Set(e.map((e=>e.toLowerCase()))),r=Array.from(i),s=t+"$"+r.join("|"),n=buyerSideSnippetCache.get(s);if(n)return[...o,...n];{const e=(yield hb.Printess.loadSnippets(t,r,scope().templateProperties.includeGlobalSnippets)).map((e=>new Snippet(e)));return buyerSideSnippetCache.set(s,e),[...o,...e]}}))}function getThumbnailUrlByDocId(e){return __awaiter$H(this,void 0,void 0,(function*(){const t=scope().docs.get(e);if(t){const e=yield t.getThumbnailUrl();if(e)return e}return""}))}function resetSnippetCache(){buyerSideSnippetCache.clear()}let allTagsArrayCache=null,allTagsMapCache=new Map;const templateTagsSet=new Set;function loadTags(e){return __awaiter$H(this,void 0,void 0,(function*(){if(!allTagsArrayCache){const e=yield hb.Printess.loadSnippetTags(scope().templateProperties.includeGlobalSnippets),t=new Set(e.map((e=>e.tag)));for(const o of templateTagsSet)t.has(o)||e.push({tag:o,group:0,layout:0});allTagsArrayCache=e.sort(((e,t)=>e.tag.localeCompare(t.tag))).map((e=>({tag:e.tag,groupCounter:e.group,layoutCounter:e.layout}))),allTagsMapCache=new Map(allTagsArrayCache.map((e=>[e.tag,e])))}return"both"===e?allTagsArrayCache:allTagsArrayCache.filter((t=>"group"===e?t.groupCounter>0:t.layoutCounter>0))}))}function tagExists(e,t){return __awaiter$H(this,void 0,void 0,(function*(){const o=allTagsMapCache.get(t);return!!o&&("group"===e?o.groupCounter>0:o.layoutCounter>0)}))}function clearTagsCache(){allTagsArrayCache=null}function addNewTagToCache(e){allTagsArrayCache&&(allTagsArrayCache=[e,...allTagsArrayCache].sort(((e,t)=>e.tag.localeCompare(t.tag))),allTagsMapCache.set(e.tag,e))}function addMissingTagsFromDocuments(e){for(const t of e)templateTagsSet.has(t)||(templateTagsSet.add(t),allTagsArrayCache&&!allTagsMapCache.has(t)&&(null==allTagsArrayCache||allTagsArrayCache.push({tag:t,groupCounter:0,layoutCounter:0}),null==allTagsMapCache||allTagsMapCache.set(t,{tag:t,groupCounter:0,layoutCounter:0})))}var __awaiter$I=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};let Doc=(()=>{class e extends NobsBase{constructor(t,o,i,r,s,n){if(super(t,o),this.parentBoxId="",this.styleCache=new Map,this.spreadsByBoxCache=new WeakMap,this.boxIdByJsNameCache=new Map,this.boundUiBoxesIds=[],this.thumbCache=new Map,this.thumbLoading=new Map,this._thumbsLoadedFromApi=!1,!(t instanceof Nobs||o instanceof e)){const e=(null==o?void 0:o.data)||{};this.id=t||generateDBID();const a="Document #"+(scope()?scope().docs.size+1:1);this.name=e.na||i||a,this.isLayoutSnippet="boolean"==typeof e.ils&&e.ils,this.isGroupSnippet="boolean"==typeof e.igs&&e.igs,this.isPrimary="boolean"==typeof e.pri?e.pri:"Document"===this.name,this.isThumbnail="boolean"==typeof e.thu&&e.thu,this.isPreview="boolean"==typeof e.pre&&e.pre,this.isProduction="boolean"==typeof e.pro&&e.pro,this.showBuyerEddi="boolean"!=typeof e.sbe||e.sbe,this.buyerTextStyleMode=e.btm?e.btm:"default",this.splitMultilineToParagraphs="boolean"!=typeof e.smp||e.smp,this.showBuyerAllImageFilters="boolean"!=typeof e.sbf||e.sbf,this.keepFramesInsidePage="boolean"==typeof e.kfi&&e.kfi,this.scaledImageMinimumDpi="number"==typeof e.dpi?e.dpi:180,this.snippetExportTags=e.snt||[],this.snippetTitle=e.snl||"",r&&s&&n?(this.unit=n,this.pageWidth=new Length(r,n).toPixel(100,100),this.pageHeight=new Length(s,n).toPixel(100,100)):(this.unit=e.un||n||"cm",this.pageWidth=e.pw||r||BoxGeometry.from_cm(21),this.pageHeight=e.ph||s||BoxGeometry.from_cm(29.7)),this.docBackgroundColorSerialized=e.bg||null,this.baselineTop=e.blt?Length.deserialize(e.blt):new Length(2,"cm"),this.baselineHeight=e.blh?Length.deserialize(e.blh):new Length(18,"pt"),this.showBleed=(!1===e.sbl||!0===e.sbl)&&e.sbl,this.showSaveZone=(!1===e.ssz||!0===e.ssz)&&e.ssz,this.bleedInside=void 0!==e.bin?e.bin:0,this.bleedOutside=void 0!==e.bou?e.bou:0,this.bleedTop=void 0!==e.bto?e.bto:0,this.bleedBottom=void 0!==e.bbo?e.bbo:0,this.showMargins=(!1===e.sma||!0===e.sma)&&e.sma,this.marginInside=void 0!==e.min?e.min:0,this.marginOutside=void 0!==e.mou?e.mou:0,this.marginTop=void 0!==e.mto?e.mto:0,this.marginBottom=void 0!==e.mbo?e.mbo:0,this.pasteBoardLeft=void 0!==e.pbl?e.pbl:500,this.pasteBoardRight=void 0!==e.pbr?e.pbr:500,this.pasteBoardTop=void 0!==e.pbt?e.pbt:50,this.pasteBoardBottom=void 0!==e.pbb?e.pbb:50,this.zoomToPasteBoard=!0===e.pbz,this.pasteBoardOpacity=void 0!==e.pbo&&e.pbo>=0?e.pbo:.8,this.pasteBoardColor=e.pbc?e.pbc:"rgb(78, 78, 80)","black"===this.pasteBoardColor&&(this.pasteBoardColor=" rgb(78, 78, 80)"),this.buyerOverlayColor=e.boc?e.boc:"red",this.hasPageBorder="boolean"!=typeof e.hpb||e.hpb,this.verticalSpaceBetweenPasteboards=void 0!==e.pby?e.pby:40,this.spreads=new Map;const l=new Map,c=new Map;if(Array.isArray(e.sps))for(const t of e.sps){const e=new Spread(this,t.id,t);l.set(e.id,e),e.name&&c.set(e.name,e)}if(this.spreads=l,this.spreadsByName=c,this.layers=new Map,Array.isArray(e.lyr))for(const t of e.lyr){const e=new Layer(t.id,t);this.layers.set(e.id,e)}e.lock?this.lock=new Lock(e.lock):this.lock=new Lock,this.facingPages=(!1===e.fp||!0===e.fp)&&e.fp;const d=new Map,h=new Map;if(Array.isArray(e.ffs))for(const t of e.ffs){t.o="doc";const e=new FormField(t.id,t);d.set(e.id,e),h.set(e.name,e)}this.formFields=new Map(d),this.formFieldsByName=new Map(h),this.styleText=e.styleText||["/* To create a style","   press (+) in the","   toolbar above. */",""].join("\n")}if(addMissingTagsFromDocuments(this.snippetExportTags),!this.layers.has("BASELAYER")){const e=new Layer("BASELAYER",{na:"Base Layer"});this.layers.set(e.id,e)}}get docBackgroundColor(){const e=this.docBackgroundColorSerialized;let t;return t=e?new ColorRef(e.id,e):ColorRef.Paper_Color(),t}getImageFilters(){return this.showBuyerAllImageFilters?Array.from(enums.allowImageFilters):this.imageFilters}transferStyleCache(e){this.styleCache=e.styleCache,this.thumbCache=e.thumbCache,this._thumbsLoadedFromApi=e._thumbsLoadedFromApi}getAllVariables(e,t){for(const o of this.spreads.values())for(const i of o.boxes.values())i.getAllVariables(e,t);return e}getThumbnailUrl(e=this.firstSpread().id){return __awaiter$I(this,void 0,void 0,(function*(){const t=yield this.getThumbnailUrls(e);return(null==t?void 0:t.length)?t[0]:Image$1.anyImage().url}))}forceThumbnailRefresh(){this._thumbsLoadedFromApi=!1,this._thumbsLoadingPromise=void 0}refreshServerThumbnails(){return __awaiter$I(this,void 0,void 0,(function*(){const e=scope().template,t=scope().savedAfterOpen?void 0:scope().openedFromTemplate;if(e||t){const o=createPrintessApiFromExternalConfig();try{const i=t?t.userId:null==e?void 0:e.userId,r=t?t.id:null==e?void 0:e.id;if(!i||!r)return;const s=yield o.loadTemplateDetails(i,r);for(const e of s.images)if(e.documentId===this.id){let t=-1;for(const o of this.spreads.values())if(t++,t===e.spreadIndex){let t=this.thumbCache.get(o.id);t||(t=[]),t[e.pageIndex]=e.thumbnailUrl,this.thumbCache.set(o.id,t)}}}catch(t){config.isMobile||config.isBuyer||!e||alert("Can't load template details: "+e.id+"\n\n["+t+"]")}}}))}getThumbnailUrls(e){return __awaiter$I(this,void 0,void 0,(function*(){const t=scope().template;if(!this._thumbsLoadedFromApi&&t&&(this._thumbsLoadingPromise||(this._thumbsLoadingPromise=this.refreshServerThumbnails()),this._thumbsLoadingPromise&&(yield this._thumbsLoadingPromise),this._thumbsLoadedFromApi=!0),!this.thumbCache.has(e))try{const t=yield get$1(scope().id+"|"+this.id+"#"+e);t&&(Array.isArray(t),1)&&this.thumbCache.set(e,t)}catch(e){console.warn("Browser does not support Indexed-DB:"+e)}return this.thumbCache.get(e)||null}))}invalidateThumbNailCache(e){return __awaiter$I(this,void 0,void 0,(function*(){try{const t=scope().id+"|"+this.id+"#"+e;this.thumbCache.delete(e),yield del(t)}catch(e){console.warn("Browser does not support Indexed-DB:"+e)}}))}getAllSubDocuments(e){const t=new Set;for(const o of this.spreads.values())if(!e||o.id===e)for(const e of o.boxes.values())if(e.docRef){const o=e.getValue("docRef","documentName"),i=scope().getDocByName(o);if(i){t.add(i);for(const e of i.getAllSubDocuments())t.add(e)}}return t}get jsName(){return getValidJsName(this.name)}get shortName(){return this.name.length>11?this.name.substr(0,9)+"...":this.name}setTemporaryParentBoxId(e){this.parentBoxId=e}getNamedBox(e){const t=this.boxIdByJsNameCache.get(e);if(t){const e=this.getBoxRef(t);if(e)return e}for(const t of this.spreads.values())for(const o of t.boxes.values())if(o.jsName===e)return{doc:this,spread:t,box:o};return null}getStyleAndRedrawItemsWithClasses(e){const t=this.isStyleCacheUpToDate(e),o=this.getStyle(e,!1===t||void 0);return t||scope().redrawAllItemsWithClassesDebounced(),o}getStyleTimeStampByClass(e,t){let o;if(o=void 0!==t?this.styleCache.get(t||"self"):this.currentStyleCache,o)return o.style.getStyleTimeStampByClass(e);{const o=new Style(null,{txt:this.styleText},this,t);for(const t of e.keys())return o.classNameLookUp.has(t)?"outdated":"no-class"}return"no-class"}getStyle(e,t=!1){let o=null;const i=this.currentStyleCache;if(i&&(o=i.style),!t&&o&&this.isStyleCacheUpToDate(e))return o;const r={parentBoxId:this.parentBoxId,style:new Style(null,{txt:this.styleText},this,this.parentBoxId,o||void 0),styleText:this.styleText};return this.styleCache.set(this.parentBoxId||"self",r),r.style}get currentStyleCache(){return this.styleCache.get(this.parentBoxId||"self")}get rootStyleCache(){return this.styleCache.get("self")}hasStyleJsFrameNameReference(e){for(const t of this.styleCache.values())if(t.style.hasStyleJsFrameNameReference(e))return!0;return!1}getClassNames(){const e=this.rootStyleCache;return e?e.style.classNames:[]}getClassesByFrame(e){const t=this.currentStyleCache;return t?t.style.getClassesByFrame(e):[]}getClassesByField(e){const t=this.currentStyleCache;return t?t.style.getClassesByField(e):[]}hasClassName(e){return!!this.rootStyleCache&&this.rootStyleCache.style.classNameLookUp.has(e)}isStyleCacheUpToDate(e,t){let o;return o=void 0!==t?this.styleCache.get(t||"self"):this.currentStyleCache,!(!o||this.styleText&&!o.style.isEvaluationUpToDate(e,this))}updateStyleCaches(){let e=this.styleCache.get("self");(null==e?void 0:e.parentBoxId)&&(alert("styleChache 'selft' has parent box id"),e=void 0),this.styleCache=new Map;const t={parentBoxId:"",style:new Style(null,{txt:this.styleText},this,"",e?e.style:void 0),styleText:this.styleText};this.styleCache.set("self",t)}serialize(e,t=!1,o=!1,i=!1,r="",s=""){let n,a,l,c=null;if(r&&(c=scope().getBox(r)),c){const e=DocRef.getSelectedSpread(c.box);if(n=Array.from(this.spreads.values()).filter((t=>t.id===e.id)).map((e=>e.serialize(this.id,t,o,!1,i,r))),a=Array.from(this.layers.values()).map((e=>e.serialize(null==c?void 0:c.box))),l=[],c.box.docRef){const e=c.box.docRef.formFieldValues;for(const t of this.formFields.values()){const o=t.serializeSimple(),i=e.get(t.id);null!=i&&(o.v=i),l.push(o)}}}else n=s?Array.from(this.spreads.values()).filter((e=>e.id===s)).map((e=>e.serialize(this.id,t,o,!1,i,r))):Array.from(this.spreads.values()).map((e=>e.serialize(this.id,t,o,!1,i))),a=Array.from(this.layers.values()).map((e=>e.serialize())),l=Array.from(this.formFields.values()).map((e=>e.serializeSimple()));const d={na:this.name,ils:this.isLayoutSnippet,igs:this.isGroupSnippet,pri:this.isPrimary,thu:this.isThumbnail,pre:this.isPreview,pro:this.isProduction,pw:this.pageWidth,ph:this.pageHeight,sbl:this.showBleed,ssz:this.showSaveZone,bin:this.bleedInside,bou:this.bleedOutside,bto:this.bleedTop,bbo:this.bleedBottom,sma:this.showMargins,min:this.marginInside,mou:this.marginOutside,mto:this.marginTop,mbo:this.marginBottom,pbl:this.pasteBoardLeft,pbr:this.pasteBoardRight,pbt:this.pasteBoardTop,pbb:this.pasteBoardBottom,pbo:this.pasteBoardOpacity,hpb:this.hasPageBorder,pbc:this.pasteBoardColor,boc:this.buyerOverlayColor,pby:this.verticalSpaceBetweenPasteboards,fp:this.facingPages,lock:this.lock.serialize(),styleText:this.styleText,lyr:a,sps:n,ffs:l,un:this.unit,blh:this.baselineHeight.serialize(),blt:this.baselineTop.serialize(),pbz:this.zoomToPasteBoard,snt:this.snippetExportTags,snl:this.snippetTitle,sbe:this.showBuyerEddi,smp:this.splitMultilineToParagraphs,sbf:this.showBuyerAllImageFilters,kfi:this.keepFramesInsidePage,btm:this.buyerTextStyleMode,dpi:this.scaledImageMinimumDpi};this.docBackgroundColorSerialized&&(d.bg=this.docBackgroundColor.serialize());return{id:o?generateDBID():this.id,scopeId:e,parentId:e,type:"doc",data:d}}isValidFormFieldName(e){return!(e.indexOf("_")>=0||this.formFieldsByName.has(e))&&getValidJsName(e)===e}getFormField(e,t){if(e.startsWith("SUB_DOC_")||e.startsWith("LAYER_")){const o=new Map;e.startsWith("SUB_DOC_")&&this.mergeIn_GeneratedBoxFormFields(o,t,!1),e.startsWith("LAYER_")&&this.mergeIn_LayerFormFields(o,t,!1);const i=o.get(e);if(i)return i;for(const t of o.values())if(t.name===e)return t}else{const t=this.formFields.get(e);if(t&&"USER_CREATED"===t.systemType)return t;for(const t of this.formFields.values())if(t.name===e&&"USER_CREATED"===t.systemType)return t}}getAllDocFormFieldsHash(){const e=[];for(const t of this.formFields.values())e.push(t.__private_render_value_access_only_via_scope_getFormFieldValue);return e.join("|")}getAllDocFormFields(e,t=!1,o){const i=new Map;for(const t of this.formFields.values())if(e){const o=new FormField(t.id,t.serializeSimple(),void 0,e);o.inUse="USER_CREATED"===t.systemType,i.set(o.id,o)}else t.inUse="USER_CREATED"===t.systemType,i.set(t.id,t);return this.mergeIn_GeneratedBoxFormFields(i,e,t,o),this.mergeIn_LayerFormFields(i,e,t,o),Array.from(i.values()).filter((e=>e.inUse&&(e.visibility.startsWith("buyer")||!t)))}getAllDocFormFieldsAsMap(e,t=!1){const o=new Map;for(const i of this.getAllDocFormFields(e,t))o.set(i.id,i);return o}mergeIn_LayerFormFields(e,t,o=!1,i){var r,s,n,a,l,c,d,h,p,u,m,f,g,y,b,v,x,w,_,S;for(const P of this.layers.values())if(P.visibilityFormField){let C=!0;if(i&&t){C=!1;const e=this.spreadsByName.get(i);if(e)for(const t of e.boxes.values())if(t.layerId===P.id){C=!0;break}}if(C){const i="LAYER_"+P.id,C=this.formFields.get(i),T=null!==(r=null==C?void 0:C.captionLookUp)&&void 0!==r?r:new Map;if(!o||!C||C.visibility.startsWith("buyer")){const o=new FormField(i,{na:i,ca:null!==(s=null==C?void 0:C.caption)&&void 0!==s?s:"LAYER_"+P.jsName,lst:[{k:"ON",l:null!==(a=null===(n=T.get("ON"))||void 0===n?void 0:n.label)&&void 0!==a?a:void 0,im:null!==(c=null===(l=T.get("ON"))||void 0===l?void 0:l.imageId)&&void 0!==c?c:void 0,ds:null!==(h=null===(d=T.get("ON"))||void 0===d?void 0:d.description)&&void 0!==h?h:void 0},{k:"OFF",l:null!==(u=null===(p=T.get("OFF"))||void 0===p?void 0:p.label)&&void 0!==u?u:void 0,im:null!==(f=null===(m=T.get("OFF"))||void 0===m?void 0:m.imageId)&&void 0!==f?f:void 0,ds:null!==(y=null===(g=T.get("OFF"))||void 0===g?void 0:g.description)&&void 0!==y?y:void 0}],t:"string",or:Math.random(),g:null!==(b=null==C?void 0:C.group)&&void 0!==b?b:"Auto Generated",o:"doc",tw:null!==(v=null==C?void 0:C.thumbWidth)&&void 0!==v?v:80,th:null!==(x=null==C?void 0:C.thumbHeight)&&void 0!==x?x:80,ics:null!==(w=null==C?void 0:C.imageCss)&&void 0!==w?w:"",vs:null!==(_=null==C?void 0:C.visibility)&&void 0!==_?_:"buyer",ui:null!==(S=null==C?void 0:C.uiControl)&&void 0!==S?S:"select-list"},P.visible?"OK":"OFF",t||void 0);o.inUse=!0,e.set(i,o)}}}}mergeIn_GeneratedBoxFormFields(e,t,o=!1,i){for(const r of this.spreads.values())if(!i||r.name===i)for(const i of r.boxes.values()){if(i.docRef&&i.docRef.hasFormField&&(!o||this.isBoxVisible(i))){const r=this.getDocRefFormField(i,t);if(r){r.inUse=!0,e.set(r.id,r);const s=scope().getDocByName(i.docRef.documentName);if(s){const e=scope().getFormFieldValue(r.id,t),n=s.getAllDocFormFields(i.id,o,e);console_log("Getting Subdoc ("+s.name+") Box:"+i.id+"   SPREAD="+e+"  Count:"+n.length,n);for(const e of n)o&&!r.visibility.startsWith("buyer")||r.subFields.push(e)}}}if(i.simpleText&&i.simpleText.hasFormField&&(!o||this.isBoxVisible(i))){const o=this.getSimpleTextFormField(i,t);o&&(o.inUse=!0,e.set(o.id,o))}if(i.pathText&&i.pathText.hasFormField&&(!o||this.isBoxVisible(i))){const o=this.getPathTextFormField(i,t);o&&(o.inUse=!0,e.set(o.id,o))}}}isBoxVisible(e){const t=this.layers.get(e.layerId);return!!(t&&t.visible&&e.basics.visible)}getDocRefFormField(e,t){var o,i,r,s,n,a,l,c,d,h,p,u,m;if(!e.docRef)return null;const f=scope().getDocByName(e.docRef.documentName);if(!f||f.spreads.size<=1)return null;const g=[],y=Array.from(f.spreads.values()),b="SUB_DOC_"+e.id,v="SUB_DOC_"+f.name,x=this.formFields.get(b),w=null!==(o=null==x?void 0:x.captionLookUp)&&void 0!==o?o:new Map;if(2!==y.length||"normal"!==y[0].name||"selected"!==y[1].name)for(const e of y)e.name&&g.push({k:e.name,l:null!==(r=null===(i=w.get(e.name))||void 0===i?void 0:i.label)&&void 0!==r?r:void 0,im:null!==(n=null===(s=w.get(e.name))||void 0===s?void 0:s.imageId)&&void 0!==n?n:void 0,ds:null!==(l=null===(a=w.get(e.name))||void 0===a?void 0:a.description)&&void 0!==l?l:void 0});return g.length>1?new FormField(b,{na:b,ca:null!==(c=null==x?void 0:x.caption)&&void 0!==c?c:v,lst:g,t:"string",o:"doc",or:Math.random(),g:x?x.group:"Auto Generated",tw:null!==(d=null==x?void 0:x.thumbWidth)&&void 0!==d?d:80,th:null!==(h=null==x?void 0:x.thumbHeight)&&void 0!==h?h:80,ics:null!==(p=null==x?void 0:x.imageCss)&&void 0!==p?p:"",vs:null!==(u=null==x?void 0:x.visibility)&&void 0!==u?u:"buyer",ui:null!==(m=null==x?void 0:x.uiControl)&&void 0!==m?m:"select-list"},e.docRef.spreadName||g[0].k,t||void 0,f.jsName):null}getSimpleTextFormField(e,t){var o,i,r,s,n,a;if(!e.simpleText)return null;const l="BOX_STEXT_"+e.id,c=this.formFields.get(l);let d;return c&&c.list&&(d=c.serialize().data.lst),new FormField(l,{na:l,ca:null!==(o=null==c?void 0:c.caption)&&void 0!==o?o:"Single Line Text",lst:d,t:"string",o:"doc",or:Math.random(),g:c?c.group:"Auto Generated",tw:null!==(i=null==c?void 0:c.thumbWidth)&&void 0!==i?i:80,th:null!==(r=null==c?void 0:c.thumbHeight)&&void 0!==r?r:80,ics:null!==(s=null==c?void 0:c.imageCss)&&void 0!==s?s:"",vs:null!==(n=null==c?void 0:c.visibility)&&void 0!==n?n:"buyer",ui:null!==(a=null==c?void 0:c.uiControl)&&void 0!==a?a:"textbox"},e.simpleText.text,t||void 0)}getPathTextFormField(e,t){var o,i,r,s,n,a;if(!e.pathText)return null;const l="BOX_PTEXT_"+e.id,c=this.formFields.get(l);let d;return c&&c.list&&(d=c.serialize().data.lst),new FormField(l,{na:l,ca:null!==(o=null==c?void 0:c.caption)&&void 0!==o?o:"Text on Path",lst:d,t:"string",o:"doc",or:Math.random(),g:c?c.group:"Auto Generated",tw:null!==(i=null==c?void 0:c.thumbWidth)&&void 0!==i?i:80,th:null!==(r=null==c?void 0:c.thumbHeight)&&void 0!==r?r:80,ics:null!==(s=null==c?void 0:c.imageCss)&&void 0!==s?s:"",vs:null!==(n=null==c?void 0:c.visibility)&&void 0!==n?n:"buyer",ui:null!==(a=null==c?void 0:c.uiControl)&&void 0!==a?a:"textbox"},e.pathText.textOnPath,t||void 0)}getBoxBySubDocumentName(e){for(const t of this.spreads.values())for(const o of t.boxes.values())if(o.docRef&&o.docRef&&getValidJsName(o.docRef.documentName)===e)return o;return null}getBox(e){for(const t of this.spreads.values()){const o=t.getBox(e);if(o)return o}}getBoxRef(e){for(const t of this.spreads.values()){const o=t.boxes.get(e);if(o)return{doc:this,spread:t,box:o}}return null}pxWidth(){let e=this.pasteBoardLeft+this.pasteBoardRight;for(const t of this.spreads.values())e=Math.max(t.width()+this.pasteBoardLeft+this.pasteBoardRight,e);return this.facingPages&&(e=Math.max(2*this.pageWidth+this.pasteBoardLeft+this.pasteBoardRight,e)),e}firstSpread(){return Array.from(this.spreads.values())[0]}lastSpread(){return Array.from(this.spreads.values())[this.spreads.size-1]}getSpreadIndex(e){let t=-1;const o=Array.from(this.spreads.values());for(let i=0;i<o.length;i++)if(o[i].id===e){t=i;break}return t}pxHeight(){let e=this.pasteBoardTop+this.pasteBoardBottom;for(const t of this.spreads.values())e+=t.height()+this.pasteBoardTop+this.pasteBoardBottom+this.verticalSpaceBetweenPasteboards;return e}getSpreadPasteboard(e,t){const o=new Point(e,t);for(const e of this.spreads.values()){const t=e.pasteboardPosition();if(new Rect(t.left,t.top,t.width,t.height).isPointInside(o))return e}return null}}return e.runningThumbRenders=new Set,e})();class WcDocSelector extends LitElement{constructor(e,t){super(),this.tabsWidth="100%",this.docs=new Map,this.docClick=e,this.removeClick=t}static get properties(){return{docs:{type:Object},selectedDoc:{type:Object},tabsWidth:{type:String}}}getContextMenu(e,t,o){if(this.shadowRoot){let e=this.shadowRoot.elementFromPoint(t,o),i=null;if(e&&(i=e.getAttribute("data-doc"),i||(e=e.closest("vaadin-tab"),e&&(i=e.getAttribute("data-doc")))),"new"===i)return[{caption:"Add Document with 1 Page",callback:()=>{this.createNewDocument(1)},bold:!1},{caption:"Add Document with 3 Pages",callback:()=>{this.createNewDocument(3)},bold:!1},{caption:"Add Document with 10 Pages",callback:()=>{this.createNewDocument(10)},bold:!1}];if(i){const e=scope().getDoc(i);if(e)return[{caption:"Primary",color:"red",icon:e.isPrimary?"primary-doc-invers":"primary-doc",callback:()=>this.changeFlag(e,"isPrimary",!e.isPrimary)},{caption:"Preview",icon:e.isPreview?"preview-doc-invers":"preview-doc",callback:()=>this.changeFlag(e,"isPreview",!e.isPreview)},{caption:"Production",icon:e.isProduction?"production-doc-invers":"production-doc",callback:()=>this.changeFlag(e,"isProduction",!e.isProduction)},{caption:"Template Thumbnail",icon:e.isThumbnail?"check":void 0,callback:()=>this.changeFlag(e,"isThumbnail",!e.isThumbnail)},{caption:"-"},{caption:"Group-Snippet",icon:e.isGroupSnippet?"group-snippet-invers":"group-snippet",callback:()=>this.changeFlag(e,"isGroupSnippet",!e.isGroupSnippet)},{caption:"Layout-Snippet",icon:e.isLayoutSnippet?"layout-snippet-invers":"layout-snippet",callback:()=>this.changeFlag(e,"isLayoutSnippet",!e.isLayoutSnippet)},{caption:"-"},{caption:"Rename Document",callback:()=>{let t;for(;;){if(t=prompt("Rename Document",e.name),!t)return;if(t.length>=4&&t.length<=50)break;alert("Name needs to be at least 4 and max 50 characters")}const o=(new Nobs).setProperty(e,"name",t),i=new Doc(o,e);update([e.serialize(scope().id)],[i.serialize(scope().id)]).then((()=>{this.requestUpdate()}))},bold:!1},{caption:"Delete Document",callback:()=>{if(1===this.docs.size)alert("You can't delete the last document");else if(i){const e=this.docs.get(i);if(e){const t=[];for(const o of e.spreads.values())for(const i of o.boxes.values())t.push(i.serialize(o.id,e.id));t.push(e.serialize(scope().id)),remove(t).then((()=>{this.requestUpdate()}))}}},bold:!1}]}}return null}changeFlag(e,t,o){const i=(new Nobs).setProperty(e,t,o),r=new Doc(i,e);update([e.serialize(scope().id)],[r.serialize(scope().id)]).then((()=>{this.requestUpdate()}))}createNewDocument(e=1){const t=addSpread(new Doc(void 0,void 0,prompt("Name")||"Document"),e),o=scope()?scope().id:generateDBID();create([t.serialize(o)])}static get styles(){return css`
      :host, :host * {
          box-sizing: border-box;
          background-color: white;
          
      }

      .doc-bar {
        display: grid;
        grid-template-columns: 1fr 10px auto 10px;
      /*  border: 2px solid red;*/
        background-color: var(--printess-panelBackground);
      }
      .doc-bar > * {
        background-color: var(--printess-panelBackground);
      }

      .icon {
        width: 16px;
      height: 16px;
      background: transparent;
      padding: 2px;
      }

      #printess-logo {
        height: 26px;
        background: transparent;
      }

      @media (min-width:  ${config.mobileDeviceWidth+1}px) AND (prefers-color-scheme: dark) {
        #printess-logo .text1 {
          fill: white !important;
        }
      }
        `}render(){const e=Array.from(this.docs.values()).sort(((e,t)=>e.name.localeCompare(t.name)));let t=0,o=0;const i=scope().currentDoc;for(const r of e){if(r.id===i.id){o=t;break}t++}return html`
      
        <div class="doc-bar">
          <vaadin-tabs style="background-color: transparent; width: ${this.tabsWidth}" theme="small" selected="${o}">
            <my-custom-item   style="display: flex;  background-color: var(--printess-panelBackground);  align-items: center;  justify-content: flex-start;  margin: 0; margin-right: 15px; margin-left: 0px;"> 
                <div data-doc="new"  @click=${()=>this.createNewDocument(1)} style="cursor: pointer; font-size: 12px; padding-left: 4px; padding-right: 4px;border: 1px solid lightseagreen; border-radius: 50%; background-color: lightseagreen; color:white; " 
                >+</div>              
            </my-custom-item>
            ${e.map((e=>html`
               <vaadin-tab style="background-color: var(--printess-panelBackground); ${e.isPrimary?"border-top: 1px solid var(--printess-textColor);":""}" 
                           data-doc="${e.id}"  @click=${()=>{var t;return null===(t=this.docClick)||void 0===t?void 0:t.call(this,e.id)}}>
                  ${e.isPrimary?html`<wc-icon primaryColor="${e.id===i.id?"headline":"text"}" class="icon" icon="primary-doc" ></wc-icon>`:""}
                  ${e.isProduction?html`<wc-icon primaryColor="${e.id===i.id?"headline":"text"}" class="icon" icon="production-doc" ></wc-icon>`:""}
                  ${e.isPreview?html`<wc-icon primaryColor="${e.id===i.id?"headline":"text"}" class="icon" icon="preview-doc" ></wc-icon>`:""}
                  ${e.isLayoutSnippet?html`<wc-icon primaryColor="${e.id===i.id?"headline":"text"}" class="icon" icon="layout-snippet" ></wc-icon>`:""}
                  ${e.isGroupSnippet?html`<wc-icon primaryColor="${e.id===i.id?"headline":"text"}" class="icon" icon="group-snippet" ></wc-icon>`:""}
                
                  <span style="padding-left: 2px;  background-color: var(--printess-panelBackground); ${e.isPrimary?"font-weight: bold;":""}">${e.name}</span>
              </vaadin-tab>
              
     
            `))}
             
          </vaadin-tabs>
        <div></div>
          ${this.getLogo()}
          <div></div>
        </div>
        `}getLogo(){return svg`
     <svg id="printess-logo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 166.6 63.5">
        <style type="text/css">
            .st2 {
                fill: #FF0D98;
            }

            .text1 {
                fill: #444;
            }
        </style>
        <g>
            <path class="text1" d="M0,26.68c3.89-1.1,7.58-1.63,10.99-1.63c8.69,0,14.93,3.84,14.93,12.63s-6.05,13.06-14.16,13.44c-1.49,0-3.07,0-4.75-0.24
                L7.2,62.78c-2.45,0.1-4.27,0.29-6.67,0.38L0,26.68z M8.78,45.5c4.9,0,10.03-1.34,10.66-7.49c0.53-4.42-2.88-6.91-7.82-7.06
                c-1.92,0-2.98,0.05-4.94,0.43l0.24,14.07C7.54,45.5,8.16,45.5,8.78,45.5z" />
            <path class="text1" d="M27.55,34.7l5.23-0.38l0.53,3.74c2.02-2.93,4.75-4.37,7.68-4.37c0.53,0,1.06,0.05,1.58,0.14c0.1,2.26,0.19,4.46,0.29,6.72
                c-0.58-0.14-1.2-0.24-1.73-0.24c-3.89,0-6.62,3.55-7.01,7.73l0.53,14.4h-6.72L27.55,34.7z" />

            <path class="text1"
                d="M52.99,45.36l0.14,17.19c-2.4,0.05-4.75,0.1-7.15,0.14l0.04-17.99L52.99,45.36z" />

            <path class="st2" d="M52.88,36.52l0.11,8.84l-6.97-0.65v-9L52.88,36.52z" />

            <path class="text1"
                d="M58.62,34.17c2.26,0.1,3.94,0.19,6.19,0.29l0.14,3.94c1.49-2.64,4.03-4.8,7.3-4.8c0.29,0,0.58,0,0.86,0.05
                c5.18,0.62,7.68,4.18,7.68,11.86c0.05,4.37-0.48,10.08-1.58,17.52c-2.11-0.24-4.23-0.43-6.34-0.67c0.82-6.58,1.58-12.24,1.54-16.27
                c-0.05-4.03-0.91-6.48-3.31-6.62c-4.51,0-5.95,5.71-6.19,9.31c-0.58,4.85-0.29,9.12-0.43,13.68h-6.34L58.62,34.17z" />
            <path class="text1" d="M93.57,52.79c0,2.64,0.91,3.98,3.7,4.66c-0.62,2.02-1.2,4.03-1.82,6.05c-6.43-0.86-8.74-5.38-8.74-10.27V41.03l-3.6,0.38
                l-0.58-6.29l4.7-0.58l0.91-5.57c1.73-0.14,3.46-0.24,5.18-0.38c0,1.73,0.05,3.5,0.05,5.23l4.8-0.62l0.62,6.38l-5.38,0.62
                L93.57,52.79z" />
            <path class="text1"
                d="M116.81,54.52l4.13,3.89c-2.26,2.93-5.52,4.94-10.18,4.94c-7.87,0-11.62-7.49-11.42-15.02
                c0.19-7.49,4.42-15.03,12.58-15.03c9.41,0,12,9.65,9.79,17.67c-5.38-0.05-10.8-0.05-16.18-0.1c0.14,3.7,2.06,6.62,5.18,6.62
                C112.73,57.5,114.17,57.02,116.81,54.52z M116.18,45.5c0-2.98-1.39-6.1-4.61-6.1c-2.69,0-4.99,2.16-5.47,5.62L116.18,45.5z" />
            <path class="text1" d="M162.76,41.13c-1.97-1.2-3.94-1.78-5.52-1.78s-2.74,0.62-3.12,1.78c-1.54,4.8,12.77,3.7,12.48,13.54
                c-0.24,5.86-5.18,8.54-10.56,8.54c-0.38,0-0.72,0-1.1-0.05c-3.84-0.24-7.83-1.82-10.32-4.61l3.26-5.04c1.97,2.11,4.85,3.5,7.78,3.5
                c2.35,0,4.22-0.91,4.37-2.3c0.34-2.74-4.37-3.79-8.06-6.05c-7.68-4.61-4.85-15.03,5.14-15.03c2.83,0,5.95,0.72,8.45,2.16
                L162.76,41.13z" />
            <path class="text1" d="M139.55,42.76c-2.08-1.37-2.92-1.88-4.71-2.41c-1.56-0.46-2.81-0.09-3.19,1.06c-1.54,4.8,12.84,3.41,12.55,13.25
                c-0.24,5.86-5.18,8.54-10.56,8.54c-0.38,0-0.72,0-1.1-0.05c-3.84-0.24-6.64-2.22-9.32-4.61l3.26-5.04c2.27,1.96,3.88,3.17,6.78,3.5
                c2.34,0.27,4.22-0.91,4.37-2.3c0.34-2.74-4.37-3.79-8.06-6.05c-7.68-4.61-4.84-14.94,5.14-14.03c2.82,0.26,4.66,1.28,7.45,3.16
                L139.55,42.76z" />
        </g>
        <g id="Ebene_2">
            <polygon class="st2"
                points="47.56,9.93 52.26,16.39 59.71,19.29 53.25,23.99 50.35,31.44 45.65,24.98 38.2,22.08 44.66,17.38 	" />
            <path class="st2" d="M46.33,5.17l-1.27-3.01c-0.11-0.29-0.08-0.53,0.18-0.67l1.02-0.37c0.38-0.15,0.52-0.04,0.55,0.46l0.24,3.26
                C47.08,5.37,46.58,5.7,46.33,5.17z" />
            <path class="st2" d="M57.67,9.39l1.21-1.95c0.24-0.36,0.47-0.66,0.87-0.51l0.7,0.22c0.42,0.17,0.51,0.69,0.18,0.98l-1.92,1.73
                C58.3,10.24,57.62,9.94,57.67,9.39z" />
            <path class="st2" d="M36.56,11.73l-1.78-0.96c-0.45-0.28-0.6-0.53-0.42-0.91l0.27-0.53c0.19-0.41,0.63-0.46,0.96-0.11l1.51,1.49
                C37.97,11.49,37.53,12.24,36.56,11.73z" />
            <path class="st2" d="M33.18,22.43L30.9,23.1c-0.31,0.07-0.41-0.1-0.46-0.34l-0.12-1.21c0.01-0.25,0.24-0.38,0.53-0.31l2.4,0.54
                C33.55,21.91,33.5,22.33,33.18,22.43z" />
            <path class="st2" d="M64.81,18.59l2.79,0.21c0.29,0.02,0.47-0.17,0.41-0.43l-0.23-1.22c-0.09-0.25-0.33-0.3-0.72-0.15l-2.53,0.96
                C64.23,18.15,64.41,18.56,64.81,18.59z" />
        </g>
    </svg>
    `}}customElements.define("wc-doc-selector",WcDocSelector);class WcSpread extends LitElement{constructor(e){if(super(),this.zoom=1,this.resizedPageIndex=0,this.lastClickWhen=(new Date).getTime(),this.lastClickWhat="",!e)throw new Error("WcSpread constructor expects a valid spread");this.selected=!1,this.spread=e,this.pages=e.pages,this.showGrid=scope().templateProperties.showGrid,this.zoom=1}static get properties(){return{spread:{type:Object},pages:{type:Array},showGrid:{type:Boolean},selected:{type:Boolean},zoom:{type:Number}}}static get styles(){return css`
            :host, :host * {
                box-sizing: border-box;
            }

            :host {
                position: absolute;
                background: rgba(100,100,100,1); /*black; *//*rgba(255, 255, 255, .04);*/
                border: 1px solid rgba(255, 255, 255, 0.3);
                --printess-gripper-radius: 10%;
                --printess-gripper-width: 6px;
            }

            :host .crop {
                position: absolute;
                left: 0;
                top: 0;
                right: 0;
                bottom: 0;
                overflow: hidden;
                
            }

            :host .no-crop {
                position: absolute;
                left: 0;
                top: 0;
                right: 0;
                bottom: 0;
            }

            :host .spread-size {
                /* border: 3px solid pink;*/
                position: absolute;
            }
            :host .bleed-size {
                border: 1px dotted #ffae33;
                position: absolute;
                pointer-events: none;
                z-index: var(--printess-z-index-bleed);
            }
            :host .save-zone-size {
                border: 1px dotted #ffae33;
                position: absolute;
                pointer-events: none;
                z-index: var(--printess-z-index-bleed);
            }
            :host .margin-size {
                border: 1px dotted var(--printess-headlineColor);
                position: absolute;
                pointer-events: none;
                z-index: var(--printess-z-index-bleed);
            }


            :host .page {
               
                background: rgba(255, 255, 255, 255);
                position: absolute;
                /*box-shadow: black 1px 1px;*/
                pointer-events: none;
            }

            :host .page:after {
              content: '';
              border: 1px black solid;
              position: absolute;
              top: 0;
              left: 0;
              right: 0;
              bottom: 0;
              z-index: var(--printess-z-index-page-border);
            }

            :host .page .gripper {
                position: absolute;
                background: black;
                pointer-events: auto;
                cursor: pointer;
                display: none;
                z-index: var(--printess-z-index-page-border);;
            }

            .pasteboard-overlay  {
              position: absolute;
              pointer-events: none;
              z-index: var(--printess-z-index-pasteboard);
            }
            .pasteboard-overlay .hide {
              background:  #666;
            }

            @media (min-width:  ${config.mobileDeviceWidth+1}px) {
                :host .page .gripper {
                    display: block;
                }
            }

            :host .page .r-gripper {
                left: 100%;
                top: calc(50% - 16px);
                width: var(--printess-gripper-width);
                height: 32px;
                border-top-right-radius: var( --gripper-radius);
                border-bottom-right-radius:var( --gripper-radius);
                transform-origin: 0 50%;
            }

            :host .page .l-gripper {
                left: - var(--printess-gripper-width);
                top: calc(50% - 16px);
                width:  var(--printess-gripper-width);
                height: 32px;
                border-top-left-radius: var(--printess-gripper-radius);
                border-bottom-left-radius: var( --gripper-radius);
                transform-origin: 0 50%;
            }

            :host .page .b-gripper {

                left: calc(50% - 16px);
                top: 100%;
                width: 32px;
                height: var(--printess-gripper-width);
                border-bottom-right-radius: var(--printess-gripper-radius);
                border-bottom-left-radius: var(--printess-gripper-radius);
                transform-origin: 100% 0;

            }

            .mouse-catcher {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                pointer-events: auto;
            }


            svg.grid {
                position: absolute;

                width: 100%;
                height: 100%;
            }

            svg.grid line {
                pointer-events: none;
                stroke-width: 1%;

            }

        `}pageBgColor(){return"background-color: "+scope().currentDoc.docBackgroundColor.toCssColor()+";"}render(){this.setAttribute("style",this.spread.pasteboardPositionCss()),(config.isBuyer||config.isMobile)&&(this.style.border="none");const e=scope().templateProperties.gridStepInPx,t=scope().currentDoc;return html`
          ${scope().currentDoc.hasPageBorder||!config.isBuyer&&!config.isMobile?"":html`<style> :host .page:after {border: none !important;}</style>`}
            <div class="spread" id="${this.spread.id}"  >  
                <div class="no-crop">
                    <div class="mouse-catcher"></div>
                   
                </div>
                <div class="crop">
                 
                    <div class="spread-size" style="${this.spread.spreadPositionCss()}"> 
                        ${this.pages.map(((e,o)=>html`
                           <div class="page" style="${this.selected?"border-color: red;":""} ${this.pageBgColor()}  ${e.css(this.spread.width(),this.spread.height(),!1,!1,"","off")}">
                              ${t.showMargins?html`
                                <div class="margin-size" style="${this.spread.marginPositionCss(o)}"></div>
                              `:""}
                              ${this.showGripper()?html`
                                <div class="${this.getHorizontalGripperClassByIndex(o)}"  style="${this.getGripperStyleByIndex(o)}" data-index="${o}"></div>
                                <div class="gripper b-gripper"  style="transform: scale(${1/this.zoom}" data-index="${o}"></div>
                             `:""}
                            </div>   
                           <div class="pasteboard-overlay ${this.hidePasteBoardOverlay}" style="${this.pasteBoardStyle("l",e,o)}"></div>
                           <div class="pasteboard-overlay  ${this.hidePasteBoardOverlay}" style="${this.pasteBoardStyle("t",e,o)}"></div>
                           <div class="pasteboard-overlay  ${this.hidePasteBoardOverlay}" style="${this.pasteBoardStyle("r",e,o)}"></div>
                           <div class="pasteboard-overlay  ${this.hidePasteBoardOverlay}" style="${this.pasteBoardStyle("b",e,o)}"></div>
                       `))}
                        ${boxRepeater(this.spread.boxes,scope().currentDoc,null,null,this.spread)}
                    </div>   

                    ${this.showGrid?html`
                   <svg  class="grid spread-size" style="${this.spread.spreadPositionCss()}" xmlns="http://www.w3.org/2000/svg" 
                    viewBox="${"0 0 "+this.spread.width()+" "+this.spread.height()}">
                       <defs>
                          <pattern id="smallGrid" width="10%" height="10%"}" patternUnits="objectBoundingBox">
                            <path d="M ${e} 0 L 0 0 0 ${e}" fill="none" stroke="gray" stroke-width="0.5"/>
                          </pattern>
                          <pattern id="grid"  patternUnits="objectBoundingBox"
                                width="${1e3*e/this.spread.width()+"%"}" 
                                height="${1e3*e/this.spread.height()+"%"}">
                            <rect width="${10*e}" height="${10*e}" fill="url(#smallGrid)"/>
                            <path d="M ${10*e} 0 L 0 0 0 ${10*e}" fill="none" stroke="gray" stroke-width="1"/>
                          </pattern>
                        </defs>
                        <rect width="100%" height="100%" fill="url(#grid)" />
                      </svg> `:""}
                </div>
                
                  
                <div class="no-crop">
                     
                    ${t.showBleed?html`
                      <div class="bleed-size" style="${this.spread.bleedPositionCss()}"></div>
                      ${t.showSaveZone?html`
                        <div class="save-zone-size" style="${this.spread.saveZonePositionCss()}"></div>
                      `:""}
                    `:""}
                    <div class="spread-size" style="${this.spread.spreadPositionCss()}"> 
                        <!-- here goes the selection box -->  
                    </div>         
                </div>
        
            </div>     
           
        `}get hidePasteBoardOverlay(){return scope().currentDoc.pasteBoardOpacity>0?"":"hide"}pasteBoardStyle(e,t,o){const i=t.toPixel(this.spread.width(),this.spread.height()),r=`background: ${scope().currentDoc.pasteBoardColor.replace("rgb","rgba").replace(")",","+scope().currentDoc.pasteBoardOpacity+")")};`;if(1===this.pages.length)switch(e){case"l":return`${r} left: ${i.left-2e3}px; top: ${i.top}px; height: ${i.height}px; width: 2000px`;case"r":return`${r} left: ${i.left+i.width}px; top: ${i.top}px; height: ${i.height}px; width: ${i.left+i.width+2e3}px`;case"t":return`${r} left: ${i.left-2e3}px; top: ${i.top-1e3}px; height: 1000px;  width: ${i.left+i.width+4e3}px`;case"b":return`${r} left: ${i.left-2e3}px; top: ${i.top+i.height}px; height: ${i.height+i.top+1e3}px; width: ${i.left+i.width+4e3}px`}else switch(e){case"l":if(0===o)return`${r} left: ${i.left-1e3}px; top: ${i.top}px; height: ${i.height}px; width: 1000px`;break;case"r":if(1===o)return`${r} left: ${i.left+i.width}px; top: ${i.top}px; height: ${i.height}px; width: ${i.left+i.width+1e3}px`;break;case"t":if(0===o)return`${r} left: ${i.left-1e3}px; top: ${i.top-1e3}px; height: 1000px;  width: ${i.left+i.width+3e3}px`;break;case"b":if(0===o)return`${r} left: ${i.left-1e3}px; top: ${i.top+i.height}px; height: ${i.height+i.top+1e3}px; width: ${i.left+i.width+3e3}px`}return""}getHorizontalGripperClassByIndex(e){return 1===this.pages.length||e===this.pages.length-1?"gripper r-gripper":0===e?"gripper l-gripper":""}showGripper(){return!(config.isMobile||config.isBuyer)}getGripperStyleByIndex(e){let t=`transform: scale(${1/this.zoom}); `;return 0===e&&this.pages.length>1&&(t+=`left: calc(-12px * ${1/this.zoom})`),t}getContextMenu(e,t,o){if(this.shadowRoot){const i=this.shadowRoot.elementFromPoint(t,o);if(scope().pathEditorActive()){if(i&&"WC-PATH-EDITOR"===i.tagName){const r=i;return scope().copyPasteConsumer=r,r.getContextMenu(e,t,o)}return null}if(scope().copyPasteConsumer=scope(),i&&"WC-BOX-SELECTION"===i.tagName)return scope().getContextMenu(e,t,o);if(i&&"DIV"===i.tagName){const e=[];return e.push({caption:"Paste",callback:()=>{clipboardPaste(!1)}}),e.push({caption:"Paste in Place",callback:()=>{clipboardPaste(!0)}}),e}}return null}getElementUnderMouse(e,t){if(this.shadowRoot){const o=this.shadowRoot.elementFromPoint(e,t);if(o&&"WC-BOX"===o.tagName)return o}return null}getActiveElement(){if(this.shadowRoot){const e=this.shadowRoot.activeElement;return e&&"WC-BOX"===e.tagName?e.getActiveElement():e}return null}mouseDown(e){var t,o,i;if(scope().docUi.currentSpread=this.spread,this.shadowRoot){const r=this.shadowRoot.elementFromPoint(e.client.x,e.client.y);let s=null!==(t=null==r?void 0:r.tagName)&&void 0!==t?t:"",n=null!==(o=null==r?void 0:r.classList.toString())&&void 0!==o?o:"",a=null!==(i=null==r?void 0:r.getAttribute("data-index"))&&void 0!==i?i:"0";const l=scope().activePathEditor;let c;if(r instanceof WcBox&&(c=r),e.metaKey&&scope().eddiActive()&&(scope().closeEddi(),scope().selectionPropertiesUi.selectedTool="geometry"),scope().isRecording?(scope().e2e.cache("WcSpread.tagName",s),scope().e2e.cache("WcSpread.classList",n),scope().e2e.cache("WcSpread.dataIndex",a)):scope().isReplaying&&(s=scope().e2e.getCachedValue("WcSpread.tagName"),n=scope().e2e.getCachedValue("WcSpread.classList"),a=scope().e2e.getCachedValue("WcSpread.dataIndex"),c=E2e.getWcBox(e)||void 0),"textFlow"===scope().selectionPropertiesUi.selectedTool){const e=scope().getBox(scope().textFlowToolActiveBoxId);if(e&&e.box.storyRef&&c){const t=e.box.storyRef.story,o=scope().getBox(c.box.id);if(o&&o&&o.box!==e.box&&t){const i=o.box.storyRef?o.box.storyRef.story:null,r=[],s=[],n=t.getNewOrder(e.box.id),a=(new Nobs).setProperty(o.box,"storyRef",new StoryRef(t.id,n,"off"));o.box.simpleText&&(a.setProperty(o.box,"simpleText",null),o.box.imageRef&&"simpleText"===o.box.imageRef.imageMasking&&a.setProperty(o.box.imageRef,"imageMasking","none")),r.push(c.box.serialize(o.spread.id,o.doc.id)),s.push(new Box(a,o.box).serialize(o.spread.id,o.doc.id)),update(r,s),i&&i.getBoxes().size,scope().hideTextFlowTool(c)}else scope().hideTextFlowTool()}else scope().hideTextFlowTool();return null}if(scope().eddiActiveStory&&c){const t=scope().eddiActiveStory;if(c.box.storyRef&&t&&c.box.storyRef.storyId!==t.id)return config.isBuyer&&c.box.lock.hasOnlyTextContentAllow()?(scope().clearSelectionAndAllEditors(void 0,!1),scope().rubberBand.mouseDown(e,this.spread),{down:null,move:e=>scope().rubberBand.mouseMove(e),up_once:(e,t)=>scope().rubberBand.up_once(e,!0,t),userInteractionStarted:!0,preventDefault:!0}):(scope().closeEddi("none").then((()=>{scope().showEddi(c,e)})),null);if(!c.box.storyRef){let t=!1;const o=this.shadowRoot.elementsFromPoint(e.client.x,e.client.y);for(const e of o)"WC-BOX"===e.tagName&&e.box.storyRef&&(config.isBuyer&&!e.box.lock.allows("allowText","content")||(t=!0));!1===t&&scope().closeEddi()}}if(scope().eddiActive()&&c){if(scope().eddiActiveStory)return scope().eddiMouseRouting()}else if(l){if("WC-PATH-EDITOR"===s){const e=l;return scope().copyPasteConsumer=e,{down:t=>e.mouseDown(t),move:t=>e.mouseMove(t),up_once:(t,o)=>e.up_once(t,o),userInteractionStarted:!0,preventDefault:!0}}scope().closeAllPathEditors()}if(scope().copyPasteConsumer=scope(),"WC-BOX-SELECTION"===s){const t=scope().selection.getSingleSelection();if(t&&t.box.id===this.lastClickWhat){if((new Date).getTime()-this.lastClickWhen<200&&t.box.docRef){const e=t.box.getValue("docRef","documentName");let o=null;if(e&&(o=scope().getDocByName(e)),o)return scope().selectDocAsync(o,!0),null}this.lastClickWhat=t.box.id,this.lastClickWhen=(new Date).getTime()}let o;if(scope().selection.boxes.size>0&&this.shadowRoot)for(const t of this.shadowRoot.elementsFromPoint(e.client.x,e.client.y).filter((e=>"WC-BOX"===e.tagName)))if(t&&t.shadowRoot){if(t.shadowRoot.elementsFromPoint(e.client.x,e.client.y).filter((e=>e.classList.contains("image-pan-icon")))[0]){o=t;break}}return{down:e=>scope().selection.mouseDown(e,o),move:e=>scope().selection.mouseMove(e,o),up_once:(e,t)=>scope().selection.up_once(e,!1,t,o),userInteractionStarted:!0,preventDefault:!0}}return n.indexOf("r-gripper")>=0?(this.resizedPageIndex=parseInt(a),{down:null,move:e=>this.rGripperMove(e),up_once:(e,t)=>this.gripperUp(e,t),userInteractionStarted:!0,preventDefault:!0}):n.indexOf("l-gripper")>=0?(this.resizedPageIndex=parseInt(a),{down:null,move:e=>this.lGripperMove(e),up_once:(e,t)=>this.gripperUp(e,t),userInteractionStarted:!0,preventDefault:!0}):n.indexOf("b-gripper")>=0?(this.resizedPageIndex=parseInt(a),{down:null,move:e=>this.vGripperMove(e),up_once:(e,t)=>this.gripperUp(e,t),userInteractionStarted:!0,preventDefault:!0}):(scope().rubberBand.mouseDown(e,this.spread),{down:null,move:e=>scope().rubberBand.mouseMove(e),up_once:(e,t)=>scope().rubberBand.up_once(e,!0,t),userInteractionStarted:!0,preventDefault:!0})}return null}gripperMoveChangeAll(e,t){let o;this.newPageWidth=Math.max(50,scope().currentDoc.pageWidth+e),this.newPageHeight=Math.max(50,scope().currentDoc.pageHeight+t),this.newSpreads=new Map;for(const e of scope().currentDoc.spreads.values()){o=[];for(let t=0;t<e.pages.length;t++)o.push(new BoxGeometry(t*this.newPageWidth,0,this.newPageWidth,this.newPageHeight));e===this.spread&&(this.pages=o);const t=(new Nobs).replaceCollection(e.pages,o),i=new Spread(t,e);this.newSpreads.set(i.id,i),console_log("New Page Width="+this.newSpreads.values().next().value.pages[0].width.toDisplayString())}}rGripperMove(e){this.gripperMoveChangeAll(e.modelDelta.x,0)}lGripperMove(e){this.gripperMoveChangeAll(-e.modelDelta.x,0)}vGripperMove(e){this.gripperMoveChangeAll(0,e.modelDelta.y)}gripperUp(e,t){const o=scope().getSpread(this.spread.id);if(o&&this.newSpreads){const e=new Nobs;e.replaceCollection(o.doc.spreads,this.newSpreads),e.setProperty(o.doc,"pageWidth",this.newPageWidth),e.setProperty(o.doc,"pageHeight",this.newPageHeight),console_log("New Page Width UP ="+this.newSpreads.values().next().value.pages[0].width.toDisplayString());const t=new Doc(e,o.doc);console_log("New Page Width New Doc ="+o.doc.spreads.values().next().value.pages[0].width.toDisplayString()),update([o.doc.serialize(scope().id)],[t.serialize(scope().id)])}}getWcBox(e){if(this.shadowRoot)for(const t of this.shadowRoot.querySelectorAll("WC-BOX"))if(t.box.id===e)return t;return null}getWcBoxesByGroupId(e){const t=[];if(this.shadowRoot)for(const o of this.shadowRoot.querySelectorAll("WC-BOX"))o.box.boxGroupId===e&&t.push(o);return t}setZoom(e){if(this.shadowRoot){for(const t of this.shadowRoot.querySelectorAll("WC-BOX"))t.isZoomDepended()&&(t.zoom=e);this.zoom=e}}getWcBoxesWithStory(e){const t=[];if(this.shadowRoot)for(const o of this.shadowRoot.querySelectorAll("WC-BOX")){const i=o.box;!i.storyRef||e&&i.storyRef.storyId!==e||t.push(o)}return t}resetWcBoxSelectionFlag(){if(this.shadowRoot)for(const e of this.shadowRoot.querySelectorAll("WC-BOX"))e.isInMultiSelection&&(e.isInMultiSelection=!1)}updateAllClickableBoxes(){if(this.shadowRoot)for(const e of this.shadowRoot.querySelectorAll("WC-BOX"))e.box.lock.hasClickAction&&e.box.lock.isUiElement&&e.requestUpdate()}getDivForSelection(){return this.shadowRoot?this.shadowRoot.querySelector(".no-crop .spread-size"):null}}customElements.define("wc-spread",WcSpread);const stateMap$1=new WeakMap,createAndAppendPart$1=e=>{const t=new NodePart(e.options);return t.appendIntoPart(e),t},spreadRepeater=directive(((e,t)=>o=>{if(!(o instanceof NodePart))throw new Error("Directive can only be used in content bindings");let i=stateMap$1.get(o);e.resetCache&&(i=null,o.clear(),e.resetCache=!1),i||(i={domCache:new Map},stateMap$1.set(o,i));const r=new Set;if(t)for(const e of t.values()){let t=i.domCache.get(e.id);t?t.value instanceof WcSpread?(r.add(e.id),t.value.spread!==e&&(t.value.spread=e,t.value.pages=e.pages,i.domCache.set(e.id,t))):console.error("Spread repeater: node is not of type WcSpread."):(t=createAndAppendPart$1(o),t.setValue(new WcSpread(e)),t.commit(),r.add(e.id),i.domCache.set(e.id,t))}for(const[e,t]of i.domCache)r.has(e)||(i.domCache.delete(e),t.clear())}));var __awaiter$J=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};class WcDoc extends LitElement{constructor(){super(),this.resetCache=!1,this._curLayerId="BASELAYER",this.externalSpreadChangedCallbacksHaveBeenCalled=!1,this._lastPart="entire"}static get properties(){return{doc:{type:Object}}}static get styles(){return css`
        :host, :host * {
            box-sizing: border-box;
        }

        :host {
            position: absolute;
            pointer-events: none;
        }
        `}render(){return html`
            ${this.doc?html`<div class="doc" style="width: ${this.doc.pxWidth()}px; height:${this.doc.pxHeight()}px;">
                       ${spreadRepeater(this,this.doc.spreads)}
                    </div>`:""} 
        `}setZoom(e){if(this.shadowRoot)for(const t of this.shadowRoot.querySelectorAll("WC-SPREAD"))t.setZoom(e)}getWcBox(e){const t=getWcBox(e,null);if(t)return t;if(this.shadowRoot)for(const t of this.shadowRoot.querySelectorAll("WC-SPREAD")){const o=t.getWcBox(e);if(o)return o}return null}getWcBoxesWithStory(e,t=null){let o=[];if(this.shadowRoot)if(t){let i=null;for(const e of this.shadowRoot.querySelectorAll("WC-SPREAD"))if(i=e.getWcBox(t),i)break;i&&(o=i.getWcBoxesWithStoryFromEmbeddedDocRepeater(e))}else for(const t of this.shadowRoot.querySelectorAll("WC-SPREAD"))o=[...o,...t.getWcBoxesWithStory(e)];return o}resetWcBoxSelectionFlag(){if(this.shadowRoot)for(const e of this.shadowRoot.querySelectorAll("WC-SPREAD"))e.resetWcBoxSelectionFlag()}getWcSpread(e){if(this.shadowRoot)for(const t of this.shadowRoot.querySelectorAll("WC-SPREAD")){const o=t;if(o&&o.spread.id===e)return o}return null}showGrid(e){if(this.shadowRoot)for(const t of this.shadowRoot.querySelectorAll("WC-SPREAD")){const o=t;o&&(o.showGrid=e)}const t=(new Nobs).setProperty(scope().templateProperties,"showGrid",e),o=new TemplateProperties(t,scope().templateProperties);update([scope().templateProperties.serialize()],[o.serialize()],void 0,!1)}updateAllClickableBoxes(){if(this.shadowRoot)for(const e of this.shadowRoot.querySelectorAll("WC-SPREAD"))e.updateAllClickableBoxes()}get currentLayer(){const e=this.doc.layers.get(this._curLayerId);if(e)return e;{const e=this.doc.layers.get("BASELAYER");return e||(alert("No Base Layer in current document."),this.doc.layers.values().next().value)}}set currentLayer(e){this._curLayerId=e.id,scope().layersUi.currentLayerId=e.id}set currentLayerId(e){this._curLayerId=e,scope().layersUi.currentLayerId=e}get currentLayerId(){return this.currentLayer.id}get currentSpread(){if(this._curSpread&&this.doc.spreads.has(this._curSpread.id))return this._curSpread;const e=scope().selection.spread;return e||this.getSpreadInView()}set currentSpread(e){this._setCurrentSpread(e)}_setCurrentSpread(e,t=!1){if(this._curSpread!==e||t){if(this._curSpread=e,this.shadowRoot)for(const t of this.shadowRoot.querySelectorAll("WC-SPREAD"))t.selected=t.spread===e;scope().pagesUi&&scope().pagesUi.selectSpread(this.currentSpread.id),scope().layersUi&&scope().layersUi.requestUpdate(),scope().resourcesSnippetsUi&&scope().resourcesSnippetsUi.select(),scope().layoutSnippetsBarUi&&scope().layoutSnippetsBarUi.requestUpdate(),this.callExternalSpreadChangedCallbacks(),config.isMobile&&scope().toolbarUi.requestUpdate()}}callExternalSpreadChangedCallbacks(){return __awaiter$J(this,void 0,void 0,(function*(){if(scope().externalSpreadChangedCallbacks.length){this.externalSpreadChangedCallbacksHaveBeenCalled=!0;const e=this._curSpread,t=yield this.getSnippetCluster("groupSnippets"),o=yield this.getSnippetCluster("layoutSnippets"),i={id:e.id,name:e.name,index:this.doc.getSpreadIndex(e.id)};for(const e of scope().externalSpreadChangedCallbacks)e(t,o,i,this.doc.spreads.size)}}))}getSnippetClusterTags(e){const t=[],o=this._curSpread;for(const i of o[e])t.push(i.tags.join(" "));return t.join("|")}getSnippetCluster(e){return __awaiter$J(this,void 0,void 0,(function*(){const t=[],o=e.replace("Snippets",""),i=this._curSpread;for(const r of i[e]){const e=yield loadSnippets(r.tags,o),i={name:r.name,snippets:e.map((e=>({snippetUrl:e.snippetUrl+"?DOC="+e.docId,title:e.title,thumbUrl:e.thumbUrl,bgColor:e.bgColor})))};t.push(i)}return t}))}setCurrentSpreadById(e,t=!1){const o=this.doc.spreads.get(e);o&&this._setCurrentSpread(o,t)}centerSpreadInView(e=this._lastPart){this._lastPart=e;const t=this.currentSpread;let o=t.top(),i=t.left(),r=t.height(),s=t.width();2===t.pages.length&&("left-page"===e?s/=t.pages.length:"right-page"===e&&(s/=t.pages.length,i+=this.doc.pageWidth)),this.doc.zoomToPasteBoard&&"entire"===e&&(s+=this.doc.pasteBoardLeft+this.doc.pasteBoardRight,r+=this.doc.pasteBoardTop+this.doc.pasteBoardBottom,o-=this.doc.pasteBoardTop,i-=this.doc.pasteBoardLeft),o+=r/2,i+=s/2;let n=Math.min(appHeight()/r,appWidth()/s);!1===config.allowZoomAndPan&&(n*=1.01),scrollTo(n,i,o,config.zoomDuration)}centerBoxInView(e,t){const o=e.boxGeometry.toPixel(t.width(),t.height()),i=t.top()+o.top+o.height/2,r=t.left()+ +o.left+o.width/2;scrollTo(Math.min(appHeight()/(o.height+20),appWidth()/(o.width+20)),r,i,config.zoomDuration)}centerBoxInViewWithKeyboard(e,t){const o=e.boxGeometry.toPixel(t.width(),t.height()),i=t.top()+o.top+o.height/2-400;scrollTo(zoomFactor(),-1,i,config.zoomDuration)}getSpreadInView(){const e=getScreenCenterModelPos(),t=Array.from(this.doc.spreads.values());for(const o of t){const t=o.pasteboardPosition();if(e.y>t.top+this.doc.pasteBoardTop&&e.y<t.top+t.height-this.doc.pasteBoardTop-this.doc.pasteBoardBottom)return o}for(const o of t){const t=o.pasteboardPosition();if(e.y>t.top&&e.y<t.top+t.height)return o}const o=t[t.length-1],i=o.pasteboardPosition();return e.y>i.top?o:t[0]}isCurrentSpreadInView(){return"none"!==this.currentSpread.isInView()}getDivForSelection(e=this.currentSpread.id){if(this.shadowRoot)for(const t of this.shadowRoot.querySelectorAll("WC-SPREAD"))if(t.spread.id===e)return t.getDivForSelection();return null}getContextMenu(e,t,o){if(this.shadowRoot){const i=this.shadowRoot.elementFromPoint(t,o);if(i&&"WC-SPREAD"===i.tagName)return i.getContextMenu(e,t,o);if(i&&"WC-RESOURCES"===i.tagName)return i.getContextMenu(e,t,o);console_log("Doc Mouse Down ",i)}return null}getElementUnderMouse(e,t){if(this.shadowRoot){const o=this.shadowRoot.elementFromPoint(e,t);if(o&&"WC-SPREAD"===o.tagName)return o.getElementUnderMouse(e,t)}return null}getSpreadUnderMouse(e,t){if(this.shadowRoot){const o=this.shadowRoot.elementFromPoint(e,t);if(o&&"WC-SPREAD"===o.tagName)return o}return null}getActiveElement(){if(this.shadowRoot){const e=this.shadowRoot.activeElement;return e&&"WC-SPREAD"===e.tagName?e.getActiveElement():e}return null}mouseDown(e){var t;if(this.shadowRoot){const o=this.shadowRoot.elementFromPoint(e.client.x,e.client.y);let i,r=null!==(t=null==o?void 0:o.tagName)&&void 0!==t?t:"";if("WC-SPREAD"===r&&(i=o),scope().isRecording?scope().e2e.cache("WcDoc.tagName",r):scope().isReplaying&&(r=scope().e2e.getCachedValue("WcDoc.tagName"),"WC-SPREAD"===r&&(i=E2e.getWcSpread(e)||void 0)),i)return i.mouseDown(e);console_log("Doc Mouse Down ",o)}return null}}customElements.define("wc-doc",WcDoc);var __decorate$L=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n};const annotationHeight=10,annotationWidth=80,annotationDistance=22;let WcBoxSelection=(()=>{let e=class extends LitElement{constructor(){super(...arguments),this.geo=new BoxGeometry,this.zoom=1,this.crop=!1,this.mouseDown=!1,this.showTextIcon=!1,this.showExitIcon=!1}get minMoverGridSize(){return 6*config.moverSize()+2}static get moverSize(){return parseInt(getCssVariable("--moverSize"))}getHeightAnnotationLeft(){const e=scope().selection.spread;let t=0;return e&&this.geo.hasHeight()&&(t=this.geo.toPixel(e.width(),e.height()).width+(config.moverSize()+2/this.zoom)),this.minMoverGridSize/this.zoom>t&&(t=this.minMoverGridSize/this.zoom),t}getWidthAnnotationTop(){const e=scope().selection.spread;let t=0;return e&&this.geo.hasWidth()&&(t=this.geo.toPixel(e.width(),e.height()).height+(config.moverSize()+2/this.zoom)),this.minMoverGridSize/this.zoom>t&&(t=this.minMoverGridSize/this.zoom),t}getWidth(){const e=scope().selection.spread;let t=100;return e&&(t=this.geo.toPixel(e.width(),e.height()).width),t*this.zoom}getHeight(){const e=scope().selection.spread;let t=100;return e&&(t=this.geo.toPixel(e.width(),e.height()).height),t*this.zoom}getTextOverflowCtrl(e){if(this.shadowRoot){const t=this.shadowRoot.elementFromPoint(e.client.x,e.client.y);if(t){if(t.classList.contains("text-out"))return"out";if(t.classList.contains("text-over"))return"overflow"}}return""}getMover(e){const t={horizontal:"none",vertical:"none",rotator:!1,image:!1};if(this.shadowRoot){const o=this.shadowRoot.elementFromPoint(e.client.x,e.client.y);if(o){if(o.classList.contains("rotator")&&(t.rotator=!0),o.classList.contains("v-t")&&(t.vertical="top"),o.classList.contains("v-m")&&(t.vertical="middle"),o.classList.contains("v-b")&&(t.vertical="bottom"),o.classList.contains("h-l")&&(t.horizontal="left"),o.classList.contains("h-c")&&(t.horizontal="center"),o.classList.contains("h-r")&&(t.horizontal="right"),o.classList.contains("from-style"))return;if((config.isBuyer||config.isMobile)&&o.classList.contains("not-active-but-visible"))return;o.classList.contains("image")&&(t.image=!0)}}else console.error("Cant access shadow root in BoxSelection component.");return!0===t.rotator||"none"!==t.vertical&&"none"!==t.horizontal?t:null}getMyBoxRef(){return scope().selection.getSingleSelection()}getStory(){const e=scope().selection.getSingleSelection();return e&&e.box.storyRef?e.box.storyRef.story:null}hasTextInIcon(){if(!isMobile()){const e=this.getMyBoxRef(),t=this.getStory();if(t&&e)return t.boxHasTextInIcon(e.box.id)}return!1}hasTextOutIcon(){if(!isMobile()){const e=this.getMyBoxRef(),t=this.getStory();if(t&&e)return t.boxHasTextOutIcon(e.box.id)}return!1}hasTextOverflowIcon(){if(!isMobile()){const e=this.getMyBoxRef(),t=this.getStory();if(t&&e)return t.boxHasOverflowIcon(e.box.id)}return!1}hasTextConnectIcon(){var e;if(!isMobile()){const t=this.getMyBoxRef(),o=this.getStory();if(o&&t&&"off"===(null===(e=t.box.storyRef)||void 0===e?void 0:e.autoTextMode))return!(o.boxHasTextOutIcon(t.box.id)||o.boxHasOverflowIcon(t.box.id))}return!1}static get styles(){const e=config.moverSize(),t=config.cropperSmallSide(),o=config.cropperLargeSide();return css`
            :host, :host * {
                box-sizing: border-box;
            }

            :host {
                z-index: var(--printess-z-index-box-selection);
                pointer-events: auto;
            }
            
            .frame {
               
                left: 0;
                top: 0;
                
                cursor: pointer;
                border: 1px solid var(--printess-frameColor);
                
                transform-origin: 0% 0%;
               
           }
           
            .selectorGrid {
               
                display: grid;
                position: absolute;
                                 
                grid-template-rows:${e}px ${e+1}px 1fr ${e}px ${e}px 1fr ${e}px ${e}px 1fr ${e+1}px ${e}px 1fr ${e+1}px ${e}px;
                grid-template-columns: ${e}px ${e+1}px 1fr ${e}px ${e}px 1fr ${e}px ${e}px 1fr ${e+1}px ${e}px 1fr ${e+1}px ${e}px;
                
                /*
                grid-template-rows:var(--printess-frame-mover-size) calc(var(--printess-frame-mover-size) + 1) 1fr var(--printess-frame-mover-size) var(--printess-frame-mover-size) 1fr var(--printess-frame-mover-size) var(--printess-frame-mover-size) 1fr calc(var(--printess-frame-mover-size) + 1) var(--printess-frame-mover-size) 1fr calc(var(--printess-frame-mover-size) + 1) var(--printess-frame-mover-size);
                grid-template-columns: var(--printess-frame-mover-size) calc(var(--printess-frame-mover-size) + 1) 1fr var(--printess-frame-mover-size) var(--printess-frame-mover-size) 1fr var(--printess-frame-mover-size) var(--printess-frame-mover-size) 1fr calc(var(--printess-frame-mover-size) + 1) var(--printess-frame-mover-size) 1fr calc(var(--printess-frame-mover-size) + 1) var(--printess-frame-mover-size);
                */
                transform-origin: 0% 0%;
                 
                cursor:move; /* use grab for images */
           }
             
           
         
            .center-mover {
              
                width: calc(var(--printess-frame-mover-size) * 6);
                height: calc(var(--printess-frame-mover-size) * 6);
                transform: translate(calc(var(--printess-frame-mover-size) * -2), calc(var(--printess-frame-mover-size) * -2));
             
                grid-column: 7/9;
                grid-row: 7/9;
                cursor: move;
                border: 1px solid var(--printess-frameColor);
                background: white;
                padding: 1px;
                
           }
           .center-mover > svg {
                pointer-events: none;
            }

            .imageGrid .center-mover {
                grid-column: 4/6;
                grid-row: 4/6;
            }
      
          .selectorGrid  .text-edit { 
            width: calc(var(--printess-frame-mover-size) * 8);
            height: calc(var(--printess-frame-mover-size) * 8);
            transform: translate(calc(var(--printess-frame-mover-size) * -3), calc(var(--printess-frame-mover-size) * -3));
        
            grid-column: 7/9;
            grid-row: 7/9;
            cursor: pointer;
            border: 1px solid var(--printess-frameColor);
            background: white;
            padding: 3px;
            box-shadow: 0px 0px 5px 0px rgba(0,0,0,0.5);   
          }
          .selectorGrid  .text-edit:hover {
            box-shadow: 0px 0px 2px 0px rgba(0,0,0,0.5);
            border: 1px solid var(--printess-frameColorHover);;
          }
          .selectorGrid  .text-edit > svg {
            pointer-events: none;
          }
      
          /*  not in use: .selectorGrid  .exit-text-edit {
              
                width: calc(var(--printess-frame-mover-size) * 6);
                height: calc(var(--printess-frame-mover-size) * 6);
                transform: translate(calc(var(--printess-frame-mover-size) * -2), calc(var(--printess-frame-mover-size) * -9));
             
                grid-column: 7/9;
                grid-row: 0;
                cursor: pointer;
                border: 1px solid var(--printess-frameColor);
                background: white;
                padding: 3px;
                
           }
           .selectorGrid  .exit-text-edit:hover {
            box-shadow: 0px 0px 2px 0px rgba(0,0,0,0.5);
            border: 1px solid var(--printess-frameColorHover);;
          }
            .selectorGrid  .exit-text-edit > svg {
                pointer-events: none;
            }*/
      
           
           .selectorGrid .mover {
              background-color: white;
              border: 1px solid var(--printess-frameColor);
              position: relative;
              border-radius: 50%;
           }
           
           /* more space to select */
           .selectorGrid .mover:after {
              position: absolute;
              background-color: transparent; /*rgba(255,0,0,0.5);*/
              left: var(--printess-extra-mover-catch-offset);
              top: var(--printess-extra-mover-catch-offset);
              bottom:var(--printess-extra-mover-catch-offset);
              right: var(--printess-extra-mover-catch-offset);
              content: "";
           }
          
           .selectorGrid .v-t {
                grid-row: 1 / 3;
           }
           .selectorGrid .v-t2 {
                grid-row: 4 / 6;
           }
           .selectorGrid .v-m {
                 grid-row: 7 / 9
           }
           .selectorGrid .v-b {
                grid-row: 13 / 15;
           }
            .selectorGrid .v-m2 {
                grid-row: 10 / 12;
           }
            .selectorGrid .h-l {
                grid-column: 1 / 3;
           }
           .selectorGrid .h-c {
                 grid-column: 7 / 9
           }
           .selectorGrid .h-r {
                grid-column: 13 / 15;
           }
           
           .selectorGrid .text-icons {
               width: calc(var(--printess-frame-mover-size) * 3);
               height: calc(var(--printess-frame-mover-size) * 3);
           }
             .selectorGrid .text-over {
               cursor: context-menu;
               position:absolute;
               top: calc(var(--printess-frame-mover-size) * -1.5);
               left: calc(var(--printess-frame-mover-size) / -2);
           }
           
             .selectorGrid .text-out {
                
                cursor: context-menu;
                position:absolute;
               top: calc(var(--printess-frame-mover-size) * -1.5);
               left: calc(var(--printess-frame-mover-size) / -2);
           }
           
            .selectorGrid .text-in {
               
                cursor: not-allowed;
              
                position:absolute;
               top: calc(var(--printess-frame-mover-size) * -1.5);
               left: calc(var(--printess-frame-mover-size) / -2);
           }
          
           
         .annotation {
              display:none;
              width: ${80}px;
              height: ${10}px;
              display: grid;
              position: absolute;
              grid-template-columns: 1px 1fr auto 1fr 1px;
              grid-template-rows: 1fr 1px 1fr;    
            }
            .annotation .bar {
              background-color: var(--printess-annotationColor);
            }
            .annotation .bar.left {
              grid-column: 1 / 1; 
              grid-row: 1 / 4;
            }
            .annotation .bar.right {
              grid-column: 5 / 5; 
              grid-row: 1 / 4;
            }
            .annotation .bar.centerLeft {
              grid-column: 2 / 2; 
              grid-row: 2 / 2
            }
            .annotation .bar.centerRight {
              grid-column: 4 / 4; 
              grid-row: 2 / 2
            }
            
            .annotation .caption {
              display: flex;
              justify-content: center;
              flex-direction: column;
              text-align: center;
              grid-column:3 / 3; 
              grid-row: 2 / 2; 
              padding-left: 5px;
              padding-right: 5px;
              font-size: var(--printess-annotationSize);
              color: var(--printess-annotationColor);
            }
                
            .from-style {
                border-color: red !important;
                cursor: not-allowed !important; 
            }
            
            .from-auto-size, .from-buyer-lock {
                background: transparent !important;
                border-color: transparent !important;   
                cursor: not-allowed !important; 
            }
            .proportional-only {
              border-radius: 0 !important;
              
            }
            .not-active-but-visible {
              cursor: normal;
              pointer-events: none !important;
              
            }
            .from-auto-size:after, .from-buyer-lock:after {
                left: 0;
                top: 0;
                bottom: initial;
                right: initial;
                width:0;
                height:0;
           }
           
           
           
           /*********** CROP GRID *********/
           .cropGrid {
               
                display: grid;
                position: absolute;
                /*                                1                             2                 3            4                   5              6                           7            */
                grid-template-columns: ${t}px ${o}px 1fr ${o}px 1fr ${o}px ${t}px;
                grid-template-rows:    ${t}px ${o}px 1fr ${o}px 1fr ${o}px ${t}px;
                                 
                left:0;
                top: 0;
                 
                transform-origin: 0% 0%;
                
                pointer-events: none;
           }
         
          .cropper {
              background-color: white;
              position: relative;
           }
           
           /* more space to select */
          .cropper:after {
              position: absolute;
              background-color: transparent; /*rgba(255,0,0,0.5);*/
              left: var(--printess-extra-mover-catch-offset);
              top: var(--printess-extra-mover-catch-offset);
              bottom:var(--printess-extra-mover-catch-offset);
              right: var(--printess-extra-mover-catch-offset);
              content: "";
           }
         
          .cropper-top-left.one {
              grid-row: 1 ;
              grid-column: 1 / 3;
              pointer-events: auto;
              /* border-top: 1px solid black;*/
          }
          .cropper-top-left.two {
              grid-row: 1 / 3;
              grid-column: 1;
              pointer-events: auto;
               /* border-left: 1px solid black;*/
          }
          
          .cropper-top-center.one {
              grid-row: 1;
              grid-column: 4;
              pointer-events: auto;
             /* border-top: 1px solid black;*/
          }
          
          .cropper-top-right.one {
              grid-row: 1;
              grid-column: 6 / 8;
              pointer-events: auto;
             /* border-top: 1px solid black;*/
          }
          .cropper-top-right.two {
              grid-row: 1 / 3;
              grid-column:  7;
              pointer-events: auto;
             /* border-right: 1px solid black;*/
          }
         
         
         .cropper-left-center.one {
              grid-row: 4;
              grid-column: 1 ;
              pointer-events: auto;
             /* border-left: 1px solid black;*/
          }
         
         .cropper-right-center.one {
              grid-row: 4;
              grid-column: 7;
              pointer-events: auto;
             /*  border-right: 1px solid black;*/
          }
         
         
          .cropper-bottom-left.one {
              grid-row: 7 ;
              grid-column: 1 / 3;
              pointer-events: auto;
              /* border-bottom: 1px solid black;*/
          }
          .cropper-bottom-left.two {
              grid-row: 6 / 8;
              grid-column: 1;
              pointer-events: auto;
             /* border-left: 1px solid black;*/
          }
          
          .cropper-bottom-center.one {
              grid-row: 7;
              grid-column: 4;
              pointer-events: auto;
             /* border-bottom: 1px solid black;*/
          }
         
          .cropper-bottom-right.one {
              grid-row: 7;
              grid-column: 6 / 8;
              pointer-events: auto;
            /*  border-bottom: 1px solid black;*/
          }
          .cropper-bottom-right.two {
              grid-row: 6 / 8;
              grid-column:  7;
              pointer-events: auto;
             /* border-right: 1px solid black;*/
          }
         
         
        .center-cropper {
            width: var(--printess-cropper-large-side);
            height: var(--printess-cropper-large-side);
            transform: translate(-${o/2}px, -${o/2}px);
                
            grid-column: 4;
            grid-row: 4;   
            cursor: move;
            
            background: white;
            padding: 1px;
        }
           
       .center-cropper > svg {
            pointer-events: none;
        }
       
        .crop-overlay {
            position: absolute;
            left: -10000px;
            top: -10000px;
            width: 20000px;
            height: 20000px;
            background-color: rgba(0,0,0,0.15);
          } 
             
             
              
       /*********** IMAGE GRID *********/
       
       .imageGrid {
       
            display: grid;
            position: absolute;
            /*                          1                2             3       4              5         6          7                8 */
            grid-template-columns: ${e}px ${e+1}px 1fr ${e}px ${e}px 1fr ${e+1}px ${e}px;
            grid-template-rows:    ${e}px ${e+1}px 1fr ${e}px ${e}px 1fr ${e+1}px ${e}px;
          
        /*  Das wird einfach verdoppelt grrrrr
           grid-template-columns: var(--printess-frame-mover-size) calc(var(--printess-frame-mover-size) + 1) 1fr var(--printess-frame-mover-size) var(--printess-frame-mover-size) 1fr calc(var(--printess-frame-mover-size) + 1) var(--printess-frame-mover-size);
            grid-template-rows:    var(--printess-frame-mover-size) calc(var(--printess-frame-mover-size) + 1) 1fr var(--printess-frame-mover-size) var(--printess-frame-mover-size) 1fr calc(var(--printess-frame-mover-size) + 1) var(--printess-frame-mover-size);
          */
            transform-origin: 0% 0%;
             
            cursor:move; /* use grab for images */
       }
     
      .imageGrid .mover {
          background-color: white;
          border: 1px solid var(--printess-frameColor);
          position: relative;
          border-radius: 50%;
       }
       
         /* more space to select */
       .imageGrid .mover:after {
          position: absolute;
          background-color: transparent; /*rgba(255,0,0,0.5);*/
          left: var(--printess-extra-mover-catch-offset);
          top: var(--printess-extra-mover-catch-offset);
          bottom:var(--printess-extra-mover-catch-offset);
          right: var(--printess-extra-mover-catch-offset);
          content: "";
       }
          
       .imageGrid .v-t {
            grid-row: 1 / 3;
       }
       .imageGrid .v-m {
             grid-row: 4 / 6
       }
       .imageGrid .v-b {
            grid-row: 7 / 9;
       }
        
        .imageGrid .h-l {
            grid-column: 1 / 3;
       }
       .imageGrid .h-c {
             grid-column: 4 / 6
       }
       .imageGrid .h-r {
            grid-column: 7 / 9;
       }
       
       .rotator {
        position: absolute;
        cursor: pointer;
        fill: var(--printess-frameColor);
        transform: translateY(-50%);
      }
      .rotator > * {
        pointer-events: none;
      }
     
            
        `}rotatorDistance(){return 6*config.moverSize()/this.zoom}geoCss(){const e=scope().selection.spread;return e?this.geo.css(e.width(),e.height(),!1,!1,"","off"):""}imageGridStyle(){const e=scope().selection.getSelectedWcBoxes(),t=config.moverSize();if(1===e.length&&e[0].imageRef){const o=e[0].imageRef;return`\n     left: calc(${100*o.imageXPosition}% - ${t/this.zoom}px); top: calc(${100*o.imageYPosition}% - ${t/this.zoom}px); \n     width: calc(${o.imageWidthScale*this.zoom*100}% + ${2*t}px); height: calc(${o.imageHeightScale*this.zoom*100}% + ${2*t}px);\n     transform: scale(${1/this.zoom}); `}if(1===e.length&&e[0].docRef){const o=e[0].docRef;return`\n     left: calc(${100*o.docXPosition}% - ${t/this.zoom}px); top: calc(${100*o.docYPosition}% - ${t/this.zoom}px); \n     width: calc(${o.docWidthScale*this.zoom*100}% + ${2*t}px); height: calc(${o.docHeightScale*this.zoom*100}% + ${2*t}px);\n     transform: scale(${1/this.zoom}); `}return""}rotatorStyle(){const e=[],t=config.moverSize();return this.showRotationMover()?(this.geo.anchorRight||e.push(` left: calc(100% + ${this.rotatorDistance()}px);   top: calc(50% - ${.5*t/this.zoom}px);`),this.geo.anchorLeft||e.push(` left: -${this.rotatorDistance()}px; top: calc(50% - ${1.5*t/this.zoom}px);`),this.geo.anchorTop||e.push(` left: calc(50% - ${1.5*t/this.zoom}px); top: -${this.rotatorDistance()}px;`),this.geo.anchorBottom||e.push(` left: calc(50% - ${1.5*t/this.zoom}px);  top: calc(100% + ${this.rotatorDistance()}px);`),e.push(`width: ${3*t/this.zoom}px; height: ${3*t/this.zoom}px;`),e.join(" ")):" display: none; "}showRotationMover(){return!this.geo.styleControlledProperties.get("rotation")&&((!config.isMobile&&!config.isBuyer||!1!==scope().selection.allows("allowFrame","rotation"))&&!(!this.geo.hasWidth()||!this.geo.hasHeight()))}annotiationStyle(e){const t=[];return!0===this.mouseDown?"Width"===e&&this.geo.hasWidth()?(t.push("display: grid;"),t.push(` left: 0; width: ${100*this.zoom}%!important; min-width: ${this.minMoverGridSize}px; top: ${this.getWidthAnnotationTop()}px; transform-origin: 0% 0%; transform: scale(${1/this.zoom}); `)):"Height"===e&&this.geo.hasHeight()?(t.push("display: grid;"),t.push(`left:${this.getHeightAnnotationLeft()}px; width: ${this.getHeight()}px !important; min-width: ${this.minMoverGridSize}px; top:  -10px; transform-origin: 0% 100%; transform: scale(${1/this.zoom}) rotate(90deg); `)):"Left"===e&&this.geo.anchorLeft?(t.push("display: grid;"),t.push(`left: ${-80-22/this.zoom}px; top: 50%; transform-origin: 100% 50%; transform:  translateY(-50%) scale(${1/this.zoom});`)):"Right"===e&&this.geo.anchorRight?(t.push("display: grid;"),t.push(`left: calc(100% + ${22/this.zoom}px ); top: 50%; transform-origin: 0% 50%; transform: translateY(-50%) scale(${1/this.zoom});`)):"Top"===e&&this.geo.anchorTop?(t.push("display: grid;"),t.push(`right: calc(50% + ${5/this.zoom}px); top: ${-10-22/this.zoom}px; transform-origin: 100% 100%; transform:    scale(${1/this.zoom})   rotate(90deg);`)):"Bottom"===e&&this.geo.anchorBottom?(t.push("display: grid;"),t.push(`right: calc(50% + ${5/this.zoom}px); top: calc(100% + ${22/this.zoom}px); transform-origin: 100% 0%; transform:   scale(${1/this.zoom})   rotate(-90deg);`)):t.push("display: none;"):t.push("display: none;"),t.join(" ")}render(){this.setAttribute("style",this.geoCss());const e=this.getMyBoxRef();if(e){const t=scope().currentDoc.layers.get(e.box.layerId);t&&this.style.setProperty("--printess-frameColor",t.color)}else if(scope().selection.boxes.size>0){const e=scope().currentDoc.layers.get(scope().selection.boxes.values().next().value.box.layerId);e&&this.style.setProperty("--printess-frameColor",e.color)}else this.style.setProperty("--printess-frameColor","red");return html`  

${e&&e.box.hasOffsets?html`
  <div style="border: 1px var(--printess-frameColor) dashed; position: absolute; ${e.box.getOffsetCssProps()}"></div>
`:""}

            
       ${config.isMobile||this.crop?"":html`
           <div class="annotation left" style="${this.annotiationStyle("Left")}" >
              <div class="bar centerLeft" ></div>
              <div class="bar centerRight"></div>
              <div class="bar left"></div>
              <div class="bar right"></div>
              <div  class="caption" >${this.geo.left.toDisplayString()}</div>
            </div>
            <div class="annotation right" style="${this.annotiationStyle("Right")}">
              <div class="bar centerLeft" ></div>
              <div class="bar centerRight"></div>
              <div class="bar left"></div>
              <div class="bar right"></div>
              <div  class="caption" >${this.geo.right.toDisplayString()}</div>
            </div>
             <div class="annotation top" style="${this.annotiationStyle("Top")}">
              <div class="bar centerLeft" ></div>
              <div class="bar centerRight"></div>
              <div class="bar left"></div>
              <div class="bar right"></div>
              <div  class="caption" >${this.geo.top.toDisplayString()}</div>
            </div>
            <div class="annotation bottom" style="${this.annotiationStyle("Bottom")}">
              <div class="bar centerLeft" ></div>
              <div class="bar centerRight"></div>
              <div class="bar left"></div>
              <div class="bar right"></div>
              <div  class="caption" >${this.geo.bottom.toDisplayString()}</div>
            </div>
            <div class="annotation width" style="${this.annotiationStyle("Width")}">
              <div class="bar centerLeft" ></div>
              <div class="bar centerRight"></div>
              <div class="bar left"></div>
              <div class="bar right"></div>
              <div  class="caption" >${this.geo.width.toDisplayString()}</div>
            </div>
            <div class="annotation height" style="${this.annotiationStyle("Height")}">
              <div class="bar centerLeft" ></div>
              <div class="bar centerRight"></div>
              <div class="bar left"></div>
              <div class="bar right"></div>
              <div  class="caption" >${this.geo.height.toDisplayString()}</div>
            </div>
            
            <svg  class="rotator" style="${this.rotatorStyle()}" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M212.333 224.333H12c-6.627 0-12-5.373-12-12V12C0 5.373 5.373 0 12 0h48c6.627 0 12 5.373 12 12v78.112C117.773 39.279 184.26 7.47 258.175 8.007c136.906.994 246.448 111.623 246.157 248.532C504.041 393.258 393.12 504 256.333 504c-64.089 0-122.496-24.313-166.51-64.215-5.099-4.622-5.334-12.554-.467-17.42l33.967-33.967c4.474-4.474 11.662-4.717 16.401-.525C170.76 415.336 211.58 432 256.333 432c97.268 0 176-78.716 176-176 0-97.267-78.716-176-176-176-58.496 0-110.28 28.476-142.274 72.333h98.274c6.627 0 12 5.373 12 12v48c0 6.627-5.373 12-12 12z"></path></svg>
        
           
           
        `}
           
      
            
        ${this.crop?html`
           <div class="crop-overlay"></div>
           <div class="imageGrid" style="${this.imageGridStyle()}">  
              <div class="mover image v-t h-l strict-no-zoom ${this.getStylePropertyClass("left","top")}"  style="cursor: nw-resize;" ></div>
              <div class="mover image v-t h-c strict-no-zoom ${this.getStylePropertyClass("center","top")}"  style="cursor: n-resize;"></div>
              <div class="mover image v-t h-r strict-no-zoom ${this.getStylePropertyClass("right","top")}" style="cursor: ne-resize;"></div>   
              
              <div class="mover image v-m h-l strict-no-zoom ${this.getStylePropertyClass("left","middle")}" style="cursor: w-resize;" ></div>
              <div class="mover image v-m h-r strict-no-zoom ${this.getStylePropertyClass("right","middle")}" style="cursor: e-resize;"></div>
              
              <div class="mover image v-b h-l strict-no-zoom ${this.getStylePropertyClass("left","bottom")}" style="cursor: sw-resize;"></div> 
              <div class="mover image v-b h-c strict-no-zoom ${this.getStylePropertyClass("center","bottom")}" style="cursor: s-resize;"></div>
              <div class="mover image v-b h-r strict-no-zoom ${this.getStylePropertyClass("right","bottom")}" style="cursor: se-resize;"></div>

              ${config.isMobile&&scope().selection.allows("allowImage","content")?html`
              <wc-icon class="center-mover strict-no-zoom"  icon="arrows" primaryColor="frame"></wc-icon>`:""}
          </div>    
          <div class="cropGrid" style="width:  ${100*this.zoom}%  !important; height: ${100*this.zoom}%  !important; transform: scale(${1/this.zoom});">
            <div class="cropper v-t h-l cropper-top-left one strict-no-zoom ${this.getStylePropertyClass("left","top",!0)}"  style="cursor: nw-resize;" ></div>
            <div class="cropper v-t h-l cropper-top-left two strict-no-zoom ${this.getStylePropertyClass("left","top",!0)}"  style="cursor: nw-resize;" ></div>
            <div class="cropper v-t h-c cropper-top-center one strict-no-zoom ${this.getStylePropertyClass("center","top",!0)}"  style="cursor: n-resize;"></div>
            <div class="cropper v-t h-r cropper-top-right one strict-no-zoom ${this.getStylePropertyClass("right","top",!0)}" style="cursor: ne-resize;"></div>   
            <div class="cropper v-t h-r cropper-top-right two strict-no-zoom ${this.getStylePropertyClass("right","top",!0)}" style="cursor: ne-resize;"></div>   
            
            <div class="cropper v-m h-l  cropper-left-center one strict-no-zoom ${this.getStylePropertyClass("left","middle",!0)}"  style="cursor: w-resize;"></div>
            <div class="cropper v-m h-r cropper-right-center one strict-no-zoom ${this.getStylePropertyClass("right","middle",!0)}"  style="cursor: e-resize;"></div>
            
            <div class="cropper v-b h-l cropper-bottom-left one strict-no-zoom ${this.getStylePropertyClass("left","bottom",!0)}"  style="cursor: sw-resize;" ></div>
            <div class="cropper v-b h-l cropper-bottom-left two strict-no-zoom ${this.getStylePropertyClass("left","bottom",!0)}"  style="cursor: sw-resize;" ></div>
            <div class="cropper v-b h-c cropper-bottom-center one strict-no-zoom ${this.getStylePropertyClass("center","bottom",!0)}"  style="cursor: s-resize;"></div>
            <div class="cropper v-b h-r cropper-bottom-right one strict-no-zoom ${this.getStylePropertyClass("right","bottom",!0)}" style="cursor: se-resize;"></div>   
            <div class="cropper v-b h-r cropper-bottom-right two strict-no-zoom ${this.getStylePropertyClass("right","bottom",!0)}" style="cursor: se-resize;"></div>   
          </div>
            
         
        `:html`
             <div class="frame" style=" grid-column: 2 / 8;  grid-row: 2 / 8; width:   ${100*this.zoom}% !important; height:  ${100*this.zoom}%  !important; transform: scale(${1/this.zoom});"></div>
             
            <div class="selectorGrid" style=" width: calc(${100*this.zoom}% + ${2*config.moverSize()}px) !important; height: calc(${100*this.zoom}% + ${2*config.moverSize()}px) !important; left: ${-config.moverSize()/this.zoom}px; top: ${-config.moverSize()/this.zoom}px; transform: scale(${1/this.zoom});">
               
            
              <div class="mover v-t h-l strict-no-zoom ${this.getStylePropertyClass("left","top")}"  style="cursor: nw-resize;" ></div>
              <div class="mover v-t h-c strict-no-zoom ${this.getStylePropertyClass("center","top")}"  style="cursor: n-resize; background-color: ${!config.isMobile&&this.geo.anchorTop?"var(--printess-frameColor)":"white"};"></div>
              <div class="mover v-t h-r strict-no-zoom ${this.getStylePropertyClass("right","top")}" style="cursor: ne-resize;"></div>   
              
              <div class="mover v-m h-l strict-no-zoom ${this.getStylePropertyClass("left","middle")}" style="cursor: w-resize; background-color: ${!config.isMobile&&this.geo.anchorLeft?"var(--printess-frameColor)":"white"};" ></div>
              <div class="mover v-m h-r strict-no-zoom ${this.getStylePropertyClass("right","middle")}" style="cursor: e-resize; background-color: ${!config.isMobile&&this.geo.anchorRight?"var(--printess-frameColor)":"white"};"></div>
              
              <div class="mover v-b h-l strict-no-zoom ${this.getStylePropertyClass("left","bottom")}" style="cursor: sw-resize;"></div> 
              <div class="mover v-b h-c strict-no-zoom ${this.getStylePropertyClass("center","bottom")}" style="cursor: s-resize; background-color: ${!config.isMobile&&this.geo.anchorBottom?"var(--printess-frameColor)":"white"};"></div>
              <div class="mover v-b h-r strict-no-zoom ${this.getStylePropertyClass("right","bottom")}" style="cursor: se-resize;"></div>
              
              
             ${config.isMobile&&scope().selection.allows("allowFrame","positionByMouse")?html`
                  <wc-icon class="center-mover strict-no-zoom"  icon="arrows" primaryColor="frame"></wc-icon>`:""}

             ${config.isMobile||config.forceMultilineFormEditing||config.isBuyer&&!scope().currentDoc.showBuyerEddi||!this.showTextIcon?"":html`
                  <wc-icon @mousedown=${e=>{e.stopImmediatePropagation(),scope().showEddi()}} class="text-edit strict-no-zoom"  icon="pen" primaryColor="frame"></wc-icon>`}
             
                
             ${config.isMobile||config.isBuyer?"":html`
                  ${this.hasTextOverflowIcon()?html`<wc-icon class="text-icons text-over v-m2 h-r"  primaryColor="red"  icon="plus-square" ></wc-icon>`:""}
                  ${this.hasTextInIcon()?html`<wc-icon class="text-icons text-in v-t2 h-l"    primaryColor="frame" icon="text-flow"    ></wc-icon>`:""}
                  ${this.hasTextOutIcon()?html`<wc-icon class="text-icons text-out v-m2 h-r"   primaryColor="frame" icon="text-flow"    ></wc-icon>`:""}
                  ${this.hasTextConnectIcon()?html`<wc-icon class="text-icons text-out v-m2 h-r"   primaryColor="frame" icon="plus-square"    ></wc-icon>`:""}
             `}     
              
        </div>`}
            
                
         
        `}getStylePropertyClass(e,t,o=!1){if(config.isBuyer||config.isMobile)if(this.crop){if(o)return"not-active-but-visible"}else if(!1===scope().selection.allows("allowFrame","positionByMouse"))return"from-buyer-lock";let i=this.geo.isXAxisControlledByStyle(e,!1),r=this.geo.isYAxisControlledByStyle(t,!1);return i||r?"from-style":(i=this.geo.isXAxisControlledByStyle(e,!0),r=this.geo.isYAxisControlledByStyle(t,!0),i||r?"right"===e&&"bottom"===t?"proportional-only":"from-auto-size":"")}getAutoSizePropertyClass(e,t){const o=this.geo.isXAxisControlledByStyle(e,!0),i=this.geo.isYAxisControlledByStyle(t,!0);return o||i?"from-style":""}};return __decorate$L([property({attribute:!1})],e.prototype,"geo",void 0),__decorate$L([property({type:Number})],e.prototype,"zoom",void 0),__decorate$L([property({type:Boolean})],e.prototype,"crop",void 0),__decorate$L([property({type:Boolean})],e.prototype,"mouseDown",void 0),__decorate$L([property({type:Boolean})],e.prototype,"showTextIcon",void 0),__decorate$L([property({type:Boolean})],e.prototype,"showExitIcon",void 0),e=__decorate$L([customElement("wc-box-selection")],e),e})();const $_documentContainer$u=html$1`<dom-module id="lumo-context-menu-overlay" theme-for="vaadin-context-menu-overlay">
  <template>
    <style include="lumo-menu-overlay">
      :host([phone]) {
        top: 0 !important;
        right: 0 !important;
        bottom: var(--vaadin-overlay-viewport-bottom) !important;
        left: 0 !important;
        align-items: stretch;
        justify-content: flex-end;
      }

    /* TODO These style overrides should not be needed.
       We should instead offer a way to have non-selectable items inside the context menu. */

      :host {
        --_lumo-list-box-item-selected-icon-display: none;
        --_lumo-list-box-item-padding-left: calc(var(--lumo-space-m) + var(--lumo-border-radius) / 4);
      }

      [part="overlay"] {
        outline: none;
      }
    </style>
  </template>
</dom-module><dom-module id="lumo-context-menu-list-box" theme-for="vaadin-context-menu-list-box">
  <template>
    <style>
      :host(.vaadin-menu-list-box) {
        --_lumo-list-box-item-selected-icon-display: block;
      }

      /* Normal item */

      [part="items"] ::slotted(.vaadin-menu-item) {
        -webkit-tap-highlight-color: var(--lumo-primary-color-10pct);
        cursor: default;
      }

      [part="items"] ::slotted(.vaadin-menu-item) {
        outline: none;
        border-radius: var(--lumo-border-radius);
        padding-left: var(--_lumo-list-box-item-padding-left, calc(var(--lumo-border-radius) / 4));
        padding-right: calc(var(--lumo-space-l) + var(--lumo-border-radius) / 4);
      }

      :host(.vaadin-menu-list-box) [part="items"] ::slotted(.vaadin-menu-item) {
        padding-left: calc(var(--lumo-border-radius) / 4);
        padding-right: calc(var(--lumo-space-l) + var(--lumo-border-radius) / 4);
      }

      /* Workaround to display checkmark in IE11 when list-box is not used in dropdown-menu */
      [part="items"] ::slotted(.vaadin-menu-item)::before {
        display: var(--_lumo-item-selected-icon-display);
      }

      /* Hovered item */
      /* TODO a workaround until we have "focus-follows-mouse". After that, use the hover style for focus-ring as well */

      [part="items"] ::slotted(.vaadin-menu-item:hover:not([disabled])),
      [part="items"] ::slotted(.vaadin-menu-item[expanded]:not([disabled])) {
        background-color: var(--lumo-primary-color-10pct);
      }

      /* Focused item */

      @media (pointer: coarse) {
        [part="items"] ::slotted(.vaadin-menu-item:hover:not([expanded]):not([disabled])) {
          background-color: transparent;
        }
      }
    </style>
  </template>
</dom-module><dom-module id="lumo-context-menu-item" theme-for="vaadin-context-menu-item">
  <template>
    <style>
      :host {
        user-select: none;
        -ms-user-select: none;
        -webkit-user-select: none;
      }

      :host(.vaadin-menu-item[menu-item-checked])::before {
        opacity: 1;
      }

      :host(.vaadin-menu-item.vaadin-context-menu-parent-item)::after {
        font-family: lumo-icons;
        font-size: var(--lumo-icon-size-xs);
        content: var(--lumo-icons-angle-right);
        color: var(--lumo-tertiary-text-color);
        margin-right: calc(var(--lumo-space-m) * -1);
        padding-left: var(--lumo-space-m);
      }

      :host([expanded]) {
        background-color: var(--lumo-primary-color-10pct);
      }
    </style>
  </template>
</dom-module>`;document.head.appendChild($_documentContainer$u.content),
/**
@license
Copyright (c) 2017 Vaadin Ltd.
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
*/
register$1({name:"vaadin-contextmenu",deps:["touchstart","touchmove","touchend","contextmenu"],flow:{start:["touchstart","contextmenu"],end:["contextmenu"]},emits:["vaadin-contextmenu"],info:{sourceEvent:null,_ios:/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1},reset:function(){this.info.sourceEvent=null,this._cancelTimer(),this.info.touchJob=null,this.info.touchStartCoords=null},_cancelTimer:function(){this._timerId&&(clearTimeout(this._timerId),delete this._fired)},touchstart:function(e){this.info.sourceEvent=e,this.info.touchStartCoords={x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY};const t=e.composedPath()[0]||e.target;this._timerId=setTimeout((()=>{const o=e.changedTouches[0];e.shiftKey||(this.info._ios&&(this._fired=!0,this.fire(t,o.clientX,o.clientY)),prevent("tap"))}),500)},touchmove:function(e){const t=this.info.touchStartCoords;(Math.abs(t.x-e.changedTouches[0].clientX)>15||Math.abs(t.y-e.changedTouches[0].clientY)>15)&&this._cancelTimer()},touchend:function(e){this._fired&&e.preventDefault(),this._cancelTimer()},contextmenu:function(e){e.shiftKey||(this.info.sourceEvent=e,this.fire(e.target,e.clientX,e.clientY),prevent("tap"))},fire:function(e,t,o){const i=this.info.sourceEvent,r=new Event("vaadin-contextmenu",{bubbles:!0,cancelable:!0,composed:!0});r.detail={x:t,y:o,sourceEvent:i},e.dispatchEvent(r),r.defaultPrevented&&i&&i.preventDefault&&i.preventDefault()}});
/**
@license
Copyright (c) 2017 Vaadin Ltd.
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
*/
class DeviceDetectorElement extends class extends PolymerElement{}{static get template(){return html$1`
    <iron-media-query query="min-device-width: 750px" query-matches="{{wide}}"></iron-media-query>
`}static get is(){return"vaadin-device-detector"}static get properties(){return{phone:{type:Boolean,computed:"_phone(wide, touch)",notify:!0},touch:{type:Boolean,notify:!0,value:()=>this._touch()},wide:{type:Boolean,notify:!0}}}static _touch(){try{return document.createEvent("TouchEvent"),!0}catch(e){return!1}}_phone(e,t){return!e&&t}}customElements.define(DeviceDetectorElement.is,DeviceDetectorElement);class ContextMenuItemElement extends ItemElement{static get is(){return"vaadin-context-menu-item"}}class ContextMenuListBoxElement extends ListBoxElement{static get is(){return"vaadin-context-menu-list-box"}}customElements.define(ContextMenuItemElement.is,ContextMenuItemElement),customElements.define(ContextMenuListBoxElement.is,ContextMenuListBoxElement);const ItemsMixin=e=>class extends e{static get properties(){return{items:Array}}ready(){super.ready(),this.__itemsOutsideClickListener=e=>{e.composedPath().filter((e=>"vaadin-context-menu-overlay"===e.localName))[0]||this.dispatchEvent(new CustomEvent("items-outside-click"))},this.addEventListener("items-outside-click",(e=>this.items&&this.close()))}connectedCallback(){super.connectedCallback(),document.documentElement.addEventListener("click",this.__itemsOutsideClickListener)}disconnectedCallback(){super.disconnectedCallback(),document.documentElement.removeEventListener("click",this.__itemsOutsideClickListener)}__forwardFocus(){const e=this.$.overlay,t=e.getFirstChild();if(e.parentOverlay){const o=e.parentOverlay.querySelector("[expanded]");o&&o.hasAttribute("focused")&&t?t.focus():e.$.overlay.focus()}else t&&t.focus()}__openSubMenu(e,t){e.items=t._item.children,e.listenOn=t;const o=t.getBoundingClientRect(),i=e.$.overlay.$.content,r=getComputedStyle(i),s=this.$.overlay,n=s.hasAttribute("bottom-aligned")?o.bottom+parseFloat(r.paddingBottom):o.top-parseFloat(r.paddingTop);let a;e.$.overlay._setParentOverlay(s),s.theme?e.setAttribute("theme",s.theme):e.removeAttribute("theme"),i.style.minWidth="",document.documentElement.clientWidth-o.right>o.width?a=o.right:(a=o.left-o.width,i.style.minWidth=s.$.content.clientWidth+"px"),a=Math.max(a,0),t.dispatchEvent(new CustomEvent("opensubmenu",{detail:{x:a,y:n,children:t._item.children}}))}__itemsRenderer(e,t,o){this.__initMenu(e,t);e.querySelector(this.constructor.is).closeOn=t.closeOn;const i=e.querySelector("vaadin-context-menu-list-box");i.innerHTML="";Array.from(o.detail.children||t.items).forEach((e=>{let t;t=e.component instanceof HTMLElement?e.component:document.createElement(e.component||"vaadin-context-menu-item"),t instanceof ItemElement?(t.setAttribute("role","menuitem"),t.classList.add("vaadin-menu-item")):"hr"===t.localName&&t.setAttribute("role","separator"),this.theme&&t.setAttribute("theme",this.theme),t._item=e,e.text&&(t.textContent=e.text),this.__toggleMenuComponentAttribute(t,"menu-item-checked",e.checked),this.__toggleMenuComponentAttribute(t,"disabled",e.disabled),t.setAttribute("aria-haspopup","false"),t.classList.remove("vaadin-context-menu-parent-item"),e.children&&e.children.length&&(t.classList.add("vaadin-context-menu-parent-item"),t.setAttribute("aria-haspopup","true"),t.setAttribute("aria-expanded","false"),t.removeAttribute("expanded")),i.appendChild(t)}))}__toggleMenuComponentAttribute(e,t,o){o?(e.setAttribute(t,""),e["__has-"+t]=!0):e["__has-"+t]&&(e.removeAttribute(t),e["__has-"+t]=!1)}__initMenu(e,t){if(e.firstElementChild){const t=e.querySelector("vaadin-context-menu-list-box");this.theme?t.setAttribute("theme",this.theme):t.removeAttribute("theme")}else{const o=this.constructor.is;e.innerHTML=`\n        <vaadin-context-menu-list-box></vaadin-context-menu-list-box>\n        <${o} hidden></${o}>\n      `,flush();const i=e.querySelector("vaadin-context-menu-list-box");this.theme&&i.setAttribute("theme",this.theme),i.classList.add("vaadin-menu-list-box"),requestAnimationFrame((()=>i.setAttribute("role","menu")));const r=e.querySelector(o);r.$.overlay.modeless=!0,r.openOn="opensubmenu",t.addEventListener("opened-changed",(e=>!e.detail.value&&r.close())),r.addEventListener("opened-changed",(e=>{if(!e.detail.value){const e=i.querySelector("[expanded]");e&&(e.setAttribute("aria-expanded","false"),e.removeAttribute("expanded"))}})),i.addEventListener("selected-changed",(e=>{if("number"==typeof e.detail.value){const o=e.target.items[e.detail.value]._item;if(!o.children){const e={value:o};t.dispatchEvent(new CustomEvent("item-selected",{detail:e}))}i.selected=null}})),r.addEventListener("item-selected",(e=>{t.dispatchEvent(new CustomEvent("item-selected",{detail:e.detail}))})),r.addEventListener("close-all-menus",(()=>{t.dispatchEvent(new CustomEvent("close-all-menus"))})),t.addEventListener("close-all-menus",t.close),t.addEventListener("item-selected",t.close),t.$.overlay.$.backdrop.addEventListener("click",(()=>t.close())),t.$.overlay.addEventListener("keydown",(e=>{37===e.keyCode?(t.close(),t.listenOn.focus()):27===e.keyCode&&t.dispatchEvent(new CustomEvent("close-all-menus"))})),requestAnimationFrame((()=>this.__openListenerActive=!0));const s=(e,o=e.composedPath().filter((e=>"vaadin-context-menu-item"===e.localName))[0])=>{if(this.__openListenerActive)if(t.$.overlay.hasAttribute("opening"))requestAnimationFrame((()=>s(e,o)));else if(o){if(r.items!==o._item.children&&r.close(),!t.opened)return;o._item.children&&o._item.children.length?(o.setAttribute("aria-expanded","true"),o.setAttribute("expanded",""),this.__openSubMenu(r,o)):r.listenOn.focus()}};t.$.overlay.addEventListener("mouseover",s),t.$.overlay.addEventListener("keydown",(e=>(39===e.keyCode||13===e.keyCode||32===e.keyCode)&&s(e)))}}}
/**
@license
Copyright (c) 2017 Vaadin Ltd.
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
*/,$_documentContainer$v=document.createElement("template");$_documentContainer$v.innerHTML='<dom-module id="vaadin-context-menu-overlay-styles" theme-for="vaadin-context-menu-overlay">\n  <template>\n    <style>\n      :host {\n        align-items: flex-start;\n        justify-content: flex-start;\n      }\n\n      :host([right-aligned]) {\n        align-items: flex-end;\n      }\n\n      :host([bottom-aligned]) {\n        justify-content: flex-end;\n      }\n\n      [part="overlay"] {\n        background-color: #fff;\n      }\n    </style>\n  </template>\n</dom-module>',document.head.appendChild($_documentContainer$v.content);class ContextMenuOverlayElement extends OverlayElement{static get is(){return"vaadin-context-menu-overlay"}static get properties(){return{instanceProps:{type:Object,value:()=>({detail:!0,target:!0})},parentOverlay:{type:Object,readOnly:!0}}}static get observers(){return["_themeChanged(theme)"]}ready(){super.ready(),this.addEventListener("keydown",(e=>{if(!e.defaultPrevented&&e.composedPath()[0]===this.$.overlay&&[38,40].indexOf(e.keyCode)>-1){const t=this.getFirstChild();t&&Array.isArray(t.items)&&t.items.length&&(e.preventDefault(),38===e.keyCode?t.items[t.items.length-1].focus():t.focus())}}))}getFirstChild(){return this.content.querySelector(":not(style):not(slot)")}_themeChanged(e){this.close()}getBoundaries(){const e=this.getBoundingClientRect(),t=this.$.overlay.getBoundingClientRect();let o=e.bottom-t.height;const i=this.parentOverlay;if(i&&i.hasAttribute("bottom-aligned")){const e=getComputedStyle(i);o=o-parseFloat(e.bottom)-parseFloat(e.height)}return{xMax:e.right-t.width,yMax:o,left:e.left,top:e.top,width:t.width}}}customElements.define(ContextMenuOverlayElement.is,ContextMenuOverlayElement);
/**
@license
Copyright (c) 2017 Vaadin Ltd.
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
*/
class ContextMenuElement extends(ElementMixin$1(ThemePropertyMixin(ItemsMixin(GestureEventListeners(PolymerElement))))){static get template(){return html$1`
    <style>
      :host {
        display: block;
      }

      :host([hidden]) {
        display: none !important;
      }
    </style>

    <slot id="slot"></slot>

    <vaadin-device-detector phone="{{_phone}}" touch="{{_touch}}"></vaadin-device-detector>

    <vaadin-context-menu-overlay id="overlay" on-opened-changed="_onOverlayOpened" on-vaadin-overlay-open="_onVaadinOverlayOpen" with-backdrop="[[_phone]]" phone\$="[[_phone]]" model="[[_context]]" theme\$="[[theme]]">
    </vaadin-context-menu-overlay>
`}static get is(){return"vaadin-context-menu"}static get version(){return"4.3.15"}static get properties(){return{selector:{type:String},opened:{type:Boolean,value:!1,notify:!0,readOnly:!0},openOn:{type:String,value:"vaadin-contextmenu"},listenOn:{type:Object,value:function(){return this}},closeOn:{type:String,value:"click",observer:"_closeOnChanged"},renderer:{type:Function},_context:Object,_boundClose:Object,_boundOpen:Object,_contentTemplate:Object,_oldTemplate:Object,_oldRenderer:Object,_touch:Boolean}}static get observers(){return["_openedChanged(opened)","_contextChanged(_context, _instance)","_targetOrOpenOnChanged(listenOn, openOn)","_templateOrRendererChanged(_contentTemplate, renderer, _context, items)"]}constructor(){super(),this._boundOpen=this.open.bind(this),this._boundClose=this.close.bind(this),this._boundOnGlobalContextMenu=this._onGlobalContextMenu.bind(this)}connectedCallback(){super.connectedCallback(),this.__boundOnScroll=this.__onScroll.bind(this),window.addEventListener("scroll",this.__boundOnScroll,!0)}disconnectedCallback(){super.disconnectedCallback(),window.removeEventListener("scroll",this.__boundOnScroll,!0),this.close()}ready(){super.ready(),this._observer=new FlattenedNodesObserver(this,(e=>{this._setTemplateFromNodes(e.addedNodes)}))}_setTemplateFromNodes(e){this._contentTemplate=e.filter((e=>e.localName&&"template"===e.localName))[0]||this._contentTemplate}_onOverlayOpened(e){this._setOpened(e.detail.value),this.__alignOverlayPosition()}_onVaadinOverlayOpen(e){this.__alignOverlayPosition(),this.$.overlay.style.opacity="",this.__forwardFocus()}_targetOrOpenOnChanged(e,t){this._oldListenOn&&this._oldOpenOn&&(this._unlisten(this._oldListenOn,this._oldOpenOn,this._boundOpen),this._oldListenOn.style.webkitTouchCallout="",this._oldListenOn.style.webkitUserSelect="",this._oldListenOn.style.msUserSelect="",this._oldListenOn.style.userSelect="",this._oldListenOn=null,this._oldOpenOn=null),e&&t&&(this._listen(e,t,this._boundOpen),this._oldListenOn=e,this._oldOpenOn=t)}_setListenOnUserSelect(e){this.listenOn.style.webkitTouchCallout=e,this.listenOn.style.webkitUserSelect=e,this.listenOn.style.msUserSelect=e,this.listenOn.style.userSelect=e,document.getSelection().removeAllRanges()}_closeOnChanged(e,t){const o="vaadin-overlay-outside-click";t&&(this._unlisten(this.$.overlay,t,this._boundClose),this._unlisten(this.$.overlay.root,t,this._boundClose)),e?(this._listen(this.$.overlay,e,this._boundClose),this._listen(this.$.overlay.root,e,this._boundClose),this._unlisten(this.$.overlay,o,this._preventDefault)):this._listen(this.$.overlay,o,this._preventDefault)}_preventDefault(e){e.preventDefault()}_openedChanged(e){e?(this._instance||(this.$.overlay.template=this.querySelector("template"),this._instance=this.$.overlay._instance),document.documentElement.addEventListener("contextmenu",this._boundOnGlobalContextMenu,!0),this._setListenOnUserSelect("none")):(document.documentElement.removeEventListener("contextmenu",this._boundOnGlobalContextMenu,!0),this._setListenOnUserSelect("")),this.$.overlay.opened=e}render(){this.$.overlay.render()}_removeNewRendererOrTemplate(e,t,o,i){e!==t?this._contentTemplate=void 0:o!==i&&(this.renderer=void 0)}_templateOrRendererChanged(e,t,o,i){if(e&&t)throw this._removeNewRendererOrTemplate(e,this._oldTemplate,t,this._oldRenderer),new Error("You should only use either a renderer or a template for context-menu content");if(this._oldTemplate=e,this._oldRenderer=t,i){if(e||t)throw new Error("The items API cannot be used together with a template/renderer");"click"===this.closeOn&&(this.closeOn=""),t=this.__itemsRenderer}t&&o&&this.$.overlay.setProperties({owner:this,renderer:t})}_contextChanged(e,t){void 0!==e&&void 0!==t&&(t.detail=e.detail,t.target=e.target)}close(){this._setOpened(!1)}_contextTarget(e){if(this.selector){const t=this.listenOn.querySelectorAll(this.selector);return Array.prototype.filter.call(t,(t=>e.composedPath().indexOf(t)>-1))[0]}return e.target}open(e){e&&!this.opened&&(this._context={detail:e.detail,target:this._contextTarget(e)},this._context.target&&(this._preventDefault(e),e.stopPropagation(),this.__x=this._getEventCoordinate(e,"x"),this.__pageXOffset=window.pageXOffset,this.__y=this._getEventCoordinate(e,"y"),this.__pageYOffset=window.pageYOffset,this.$.overlay.style.opacity="0",this._setOpened(!0)))}__onScroll(){if(!this.opened)return;const e=window.pageYOffset-this.__pageYOffset,t=window.pageXOffset-this.__pageXOffset;this.__adjustPosition("left",-t),this.__adjustPosition("right",t),this.__adjustPosition("top",-e),this.__adjustPosition("bottom",e),this.__pageYOffset+=e,this.__pageXOffset+=t}__adjustPosition(e,t){const o=this.$.overlay.style;o[e]=(parseInt(o[e])||0)+t+"px"}__alignOverlayPosition(){const e=this.$.overlay,t=e.style;["top","right","bottom","left"].forEach((e=>t.removeProperty(e))),["right-aligned","bottom-aligned"].forEach((t=>e.removeAttribute(t)));const{xMax:o,yMax:i,left:r,top:s,width:n}=e.getBoundaries();let a=this.__x||r;const l=this.__y||s,c=document.documentElement.clientWidth,d=document.documentElement.clientHeight,h=e.parentOverlay;let p,u=!1;if(h)if(p=h.$.overlay.getBoundingClientRect(),h.hasAttribute("right-aligned")){const o=getComputedStyle(h),i=(e,t)=>parseFloat(getComputedStyle(e.$.content)["padding"+t]),r=parseFloat(o.right)+p.width;c-(r-(i(h,"Left")+i(e,"Right")))>n&&(e.setAttribute("right-aligned",""),t.right=r+"px",u=!0)}else a<p.x&&(a-=n-p.width);u||((a<c/2||a<o)&&!h?t.left=a+"px":h&&c-p.width-p.left>=p.width?t.left=p.left+p.width+"px":h?(t.right="auto",t.left=Math.max(e.getBoundingClientRect().left,p.left-e.getBoundingClientRect().width)+"px",e.setAttribute("right-aligned","")):(t.right=Math.max(0,c-a)+"px",e.setAttribute("right-aligned",""))),l<d/2||l<i?t.top=l+"px":(t.bottom=Math.max(0,d-l)+"px",e.setAttribute("bottom-aligned",""))}_getEventCoordinate(e,t){if(!(e.detail instanceof Object)){const o="client"+t.toUpperCase(),i=e.changedTouches?e.changedTouches[0][o]:e[o];if(0===i){const o=e.target.getBoundingClientRect();return"x"===t?o.left:o.top+o.height}return i}return e.detail[t]?e.detail[t]:e.detail.sourceEvent?this._getEventCoordinate(e.detail.sourceEvent,t):void 0}_listen(e,t,o){gestures[t]?addListener(e,t,o):e.addEventListener(t,o)}_unlisten(e,t,o){gestures[t]?removeListener(e,t,o):e.removeEventListener(t,o)}_onGlobalContextMenu(e){e.shiftKey||(e.preventDefault(),this.close())}}customElements.define(ContextMenuElement.is,ContextMenuElement);const moverSize=20;class WcPathEditor extends LitElement{constructor(e="path"){super(),this.rubberActive=!1,this.snapToGrid=!0,this.pp=null,this.aspectHeight=1,this.selectedPointIndizies=new Set,this.mode=e,this.geo=new BoxGeometry,this.path=null,this.setZoom(zoomFactor())}get boxRef(){return this._boxRef}set boxRef(e){this._boxRef=e}get originalPath(){if(!this.boxRef)throw"Get originalPath: No boxRef defined";return"path"===this.mode&&this.boxRef.box.pathGeometry?this.boxRef.box.pathGeometry:"perspective"===this.mode&&this.boxRef.box.transform?this.boxRef.box.transform.perspectiveGeometry:"mesh"===this.mode&&this.boxRef.box.transform?this.boxRef.box.transform.meshGeometry:null}static get properties(){return{spread:{type:Object},geo:{type:Object},path:{type:Object},zoom:{type:Number}}}setZoom(e){this.zoom=e}isSelected(e){return this.selectedPointIndizies.has(e)}addToSelection(e){this.selectedPointIndizies.add(e)}removeFromSelection(e){this.selectedPointIndizies.delete(e)}clearSelection(){this.selectedPointIndizies.clear()}getContextName(){return"PathEditor"}selectAll(){if(this.boxRef&&this.path){for(let e=0;e<this.path.path.length;e++)this.addToSelection(e);return this.path=new PathGeometry(new Nobs,this.path),!0}return!1}selectRow(){let e=!1;if(this.boxRef&&this.path&&"mesh"===this.mode){for(let t=0;t<this.path.gridRows;t++){let o=!1;for(let e=0;e<this.path.gridColumns;e++)if(this.isSelected(this.path.gridColumns*t+e)){o=!0;break}if(o)for(let o=0;o<this.path.gridColumns;o++){const i=this.path.gridColumns*t+o;this.addToSelection(i),e=!0}}if(e)return this.path=new PathGeometry(new Nobs,this.path),!0;alert("Please select at least one point and try again.")}return!1}selectColumn(){let e=!1;if(this.boxRef&&this.path&&"mesh"===this.mode){for(let t=0;t<this.path.gridColumns;t++){let o=!1;for(let e=0;e<this.path.gridRows;e++)if(this.isSelected(this.path.gridColumns*e+t)){o=!0;break}if(o)for(let o=0;o<this.path.gridRows;o++){const i=this.path.gridColumns*o+t;this.addToSelection(i),e=!0}}if(e)return this.path=new PathGeometry(new Nobs,this.path),!0;alert("Please select at least one point and try again.")}return!1}setClipboardData(e,t){return!1}getClipboardData(){return null}canCreateItem(){return!0}createItem(){return new Promise((e=>{scope().pathEditorActive()&&(scope().pathEditor.addNewPoint(),e(!0)),e(!1)}))}removeItem(){return new Promise((e=>{scope().pathEditorActive()&&(scope().pathEditor.removeSelectedPoint(),e(!0)),e(!1)}))}getMovers(){if(!this.boxRef||!this.path)return[svg``];const e=this.path.getPathPoints(this.selectedPointIndizies),t=[],o=this.geo.toPixel(this.boxRef.spread.width(),this.boxRef.spread.height());let i=1;config.isMobile&&(i=2);const r=2e3*i/o.width/this.zoom,s=2e3*i/o.height/this.zoom,n=1e3/o.width/this.zoom,a=1e3/o.height/this.zoom;for(const o of e)"mirror"===o.kind?t.push(svg`<line x1="${o.x+config.pathLeftOffset}" y1="${o.y+config.pathLeftOffset}" x2="${o.anchorX+config.pathLeftOffset}" y2="${o.anchorY+config.pathLeftOffset}"  vector-effect="non-scaling-stroke" stroke="${config.pathEditorDisabledPathColor()}" />`):"anchor"!==o.kind&&t.push(svg`<line x1="${o.x+config.pathLeftOffset}" y1="${o.y+config.pathLeftOffset}" x2="${o.anchorX+config.pathLeftOffset}" y2="${o.anchorY+config.pathLeftOffset}"  vector-effect="non-scaling-stroke" stroke="${config.pathEditorPathColor()}" />`);const l=config.pointCollapseThreshold;let c=-1;for(const o of e){const e=o.x+config.pathLeftOffset-r/2,i=o.y+config.pathLeftOffset-s/2,d=o.x+config.pathLeftOffset-n/2,h=o.y+config.pathLeftOffset-a/2;let p=config.pathEditorPathColor();"path"===this.mode&&"anchor"===o.kind&&(c++,this.path.closed||(0===c||c===this.path.path.length-1)&&(p="darkorange")),o.selected&&(p="red"),"anchor"===o.kind?(t.push(svg`<rect  style="pointer-events: none" fill="${p}" x="${d}" y="${h}"  width="${n}"
                height="${a}"></rect>`),t.push(svg`<rect  data-index="${o.index}" data-kind="${o.kind}" fill="transparent" x="${e}" y="${i}"  width="${r}"
                height="${s}"></rect>`)):"mirror"===o.kind?t.push(svg`<ellipse data-index="${o.index}"  data-kind="${o.kind}"  cx="${o.x+config.pathLeftOffset}" cy="${o.y+config.pathLeftOffset}" 
                                rx="${r/2}" ry="${s/2}"></ellipse>`):(Math.abs(o.x-o.anchorX)>l||Math.abs(o.y-o.anchorY)>l)&&(t.push(svg`<ellipse style="pointer-events: none" fill="${config.pathEditorPathColor()}" cx="${o.x+config.pathLeftOffset}" cy="${o.y+config.pathLeftOffset}" 
                    rx="${n/2}" ry="${a/2}"></ellipse>`),t.push(svg`<ellipse data-index="${o.index}"  data-kind="${o.kind}" fill="transparent" cx="${o.x+config.pathLeftOffset}" cy="${o.y+config.pathLeftOffset}" 
                    rx="${r/2}" ry="${s/2}"></ellipse>`))}if("mesh"===this.mode){const e=0,o=[];let i=0,l=this.path.path[i];o[0]={x:l.x-e,y:l.y-e,index:i,cxo:-e,cyo:-e},i=this.path.gridColumns-1,l=this.path.path[i],o[1]={x:l.x+e,y:l.y-e,index:i,cxo:e,cyo:-e},i=this.path.path.length-1,l=this.path.path[i],o[2]={x:l.x+e,y:l.y+e,index:i,cxo:e,cyo:e},i=this.path.path.length-this.path.gridColumns,l=this.path.path[i],o[3]={x:l.x-e,y:l.y+e,index:i,cxo:-e,cyo:e};for(const e of o)t.push(svg`<ellipse data-index="${e.index}"  data-kind="corner" fill="${this.isSelected(e.index)?"red":config.pathEditorPathColor()}"  cx="${e.x+config.pathLeftOffset}" cy="${e.y+config.pathLeftOffset}" 
        data-corner-x-offet="${e.cxo}"  data-corner-y-offet="${e.cyo}"  rx="${n/1.5}" ry="${a/1.5}"></ellipse>`),t.push(svg`<ellipse data-index="${e.index}"  data-kind="corner" fill="transparent" cx="${e.x+config.pathLeftOffset}" cy="${e.y+config.pathLeftOffset}" 
        data-corner-x-offet="${e.cxo}"  data-corner-y-offet="${e.cyo}"  rx="${r/2}" ry="${s/2}"></ellipse>`)}return t}getContextMenu(e,t,o){if(this.shadowRoot){const e=this.shadowRoot.elementFromPoint(t,o);if(e&&this.path){const t=e.hasAttribute("data-index")?parseInt(e.getAttribute("data-index")||"0"):-1;if(t>=0)return[{caption:this.path.path[t].name()+" ("+t+")",callback:()=>{},bold:!0},{caption:"Remove",callback:()=>{this.insertPoint(t,"X")}},{caption:"Insert",callback:()=>{this.insertPoint(t,"L")}},{caption:this.path.closed?"Open Path":"Close Path",callback:()=>{this.openOrClosePath()}}]}}return null}removeSelectedPoint(){this.insertPoint(-1,"X")}addNewPoint(){this.insertPoint(-1,"L")}lerp(e,t,o){return[(t[0]-e[0])*o+e[0],(t[1]-e[1])*o+e[1]]}splitBezier(e,t){const o=[];for(let i=1;i<4;i++){const r=this.lerp(e[i-1],e[i],t);o.push(r)}o.push(this.lerp(o[0],o[1],t)),o.push(this.lerp(o[1],o[2],t)),o.push(this.lerp(o[3],o[4],t));return{b1:[e[0],o[0],o[3],o[5]],b2:[o[5],o[4],o[2],e[3]]}}insertPoint(e,t){if(this.boxRef&&this.originalPath){if("X"===t){if(this.originalPath.closed&&this.originalPath.path.length-this.selectedPointIndizies.size<3)return void alert("Closed pathes need a minimum of 3 anchor-points.");if(this.originalPath.path.length-this.selectedPointIndizies.size<2)return void alert("Pathes need a minimum of 2 anchor-points.")}if(-1===e&&"L"===t&&0===this.selectedPointIndizies.size)return void beep();scope().isRecording&&scope().e2e.record({module:"WcPathEditor",func:"insertPoint",args:Array.from(arguments)});const o=this.originalPath.path,i=[];let r=null,s=!1;e>=o.length-1&&this.originalPath.closed&&(e=0);for(let n=0;n<o.length;n++){const a=o[n];if("X"===t)n>0&&-1===e&&this.selectedPointIndizies.has(n)||(0===n||n!==e?i.push(a):n<o.length-1&&o[n+1]);else{const l=r&&(r instanceof CubicNextPoint||r instanceof CubicPoint);if(s||i.push(a),s=!1,n===e||-1===e&&this.selectedPointIndizies.has(n)){const e=o[n].x,r=o[n].y;if("L"===t)if(o.length>n+1){const t=o[n],a=o[n+1];if(a instanceof CubicPoint){const e=this.splitBezier([[t.x,t.y],[a.x1,a.y1],[a.x2,a.y2],[a.x,a.y]],.5);i.push(new CubicPoint(e.b1[3][0],e.b1[3][1],e.b1[1][0],e.b1[1][1],e.b1[2][0],e.b1[2][1])),i.push(new CubicPoint(e.b2[3][0],e.b2[3][1],e.b2[1][0],e.b2[1][1],e.b2[2][0],e.b2[2][1])),s=!0}else{const t=o[n+1].x-o[n].x,s=o[n+1].y-o[n].y;i.push(new LinePoint(e+t/2,r+s/2))}}else if(n>0){const t=o[n].x-o[n-1].x,s=o[n].y-o[n-1].y;i.push(new LinePoint(e+t/2,r+s/2))}else i.push(new LinePoint(e+5,r+5));else"Q"===t||"S"===t&&!l?i.push(new CubicPoint(e+30,r+5,e,r-10,e+30,r-10)):"S"===t&&i.push(new CubicNextPoint(e+30,r+5,e+30,r-10))}}r=a}this.originalPath.closed&&i.length>1&&(i[i.length-1].x=i[0].x,i[i.length-1].y=i[0].y);const n=(new Nobs).replaceCollection(o,i),a=this.boxRef.box.serialize(this.boxRef.spread.id,this.boxRef.doc.id);let l=new Box(n,this.boxRef.box);"path"===this.mode&&l.pathGeometry&&!0===l.pathGeometry.pathDefinesBoxSize&&(l=PathGeometry.adjustBoxToPath(l,this.boxRef.spread));update([a],[l.serialize(this.boxRef.spread.id,this.boxRef.doc.id)])}}openOrClosePath(){if(this.boxRef&&this.originalPath){scope().isRecording&&scope().e2e.record({module:"WcPathEditor",func:"openOrClosePath",args:Array.from(arguments)});const e=(new Nobs).setProperty(this.originalPath,"closed",!this.originalPath.closed),t=this.originalPath.path;!this.originalPath.closed&&t.length>1&&(t[t.length-1].x===t[0].x&&t[t.length-1].y===t[0].y||e.addToCollection(t,new LinePoint(t[0].x,t[0].y)));const o=this.boxRef.box.serialize(this.boxRef.spread.id,this.boxRef.doc.id);let i=new Box(e,this.boxRef.box);"path"===this.mode&&i.pathGeometry&&!0===i.pathGeometry.pathDefinesBoxSize&&(i=PathGeometry.adjustBoxToPath(i,this.boxRef.spread));update([o],[i.serialize(this.boxRef.spread.id,this.boxRef.doc.id)])}}mouseDown(e){if(this.aspectHeight=this.aspectRatioHeight(),this.shadowRoot){this.rubberActive=!1;const t=this.shadowRoot.elementFromPoint(e.client.x,e.client.y);if(t&&this.path){const o=t.getAttribute("data-index"),i=t.getAttribute("data-kind");if(!o||"corner"!==i&&"anchor"!==i&&"control1"!==i&&"control2"!==i&&"mirror"!==i)this.boxRef&&(scope().rubberBand.mouseDown(e,this.boxRef.spread),this.rubberActive=!0);else{const r=parseInt(o),s=this.path.path[r];this.isSelected(r)||"mesh"===this.mode&&e.shiftKey||this.clearSelection(),this.addToSelection(r),this.pp={kind:i,index:r,x:s.x,y:s.y,anchorX:s.x,anchorY:s.y,selected:!0},"control1"===i&&(this.pp.x=s.x1,this.pp.y=s.y1),"control2"===i&&(this.pp.x=s.x2,this.pp.y=s.y2),"mirror"===i&&(this.pp.x=s.x2,this.pp.y=s.y2),"corner"===i&&(this.pp.cornerXOffset=parseInt(t.getAttribute("data-corner-x-offset")||"0"),this.pp.cornerYOffset=parseInt(t.getAttribute("data-corner-y-offset")||"0"))}}}}mouseMove(e){if(this.rubberActive)return void scope().rubberBand.mouseMove(e);if(!this.boxRef||!this.pp||!this.path)return;const t=this.getNobs(this.path.path,e);this.path=new PathGeometry(t,this.path)}getNobs(e,t){var o;if(!this.boxRef||!this.pp||!this.originalPath)throw new Error("Get nobs path editor no boxRef or pp or path");const i=this.originalPath.closed,r=new Nobs,s=config.pointCollapseThreshold;let n,a=this.pp.kind;"corner"===a&&this.selectedPointIndizies.size>1&&(a="anchor");const l=e[0],c=e[e.length-1];let d=null;if(e.length>1&&(d=e[1]),!e.length)return r;let h=e[0],p=e[0],u=e[0];function m(t){h=e[t],u=t>0?e[t-1]:null,p=e.length>t+1?e[t+1]:null}for(n=0;n<e.length;){m(n);let f=this.originalPath.path[n];if(this.isSelected(n)){const g=this.geo.toPixel(this.boxRef.spread.width(),this.boxRef.spread.height());let y=100*t.modelDelta.x/g.width,b=100*t.modelDelta.y/g.height;if(0!==this.geo.rotation){const e=this.geo.toPixel(this.boxRef.spread.width(),this.boxRef.spread.height()),o=rotatePointInBox(t.pageStart.x,t.pageStart.y,e,-this.geo.rotation),i=rotatePointInBox(t.page.x,t.page.y,e,-this.geo.rotation);y=(i.x-o.x)/zoomFactor(),b=(i.y-o.y)/zoomFactor(),y=100*y/g.width,b=100*b/g.height}if("perspective"===this.mode&&t.shiftKey||t.altKey)Math.abs(y)<Math.abs(b)?y=0:b=0;else if(1===this.selectedPointIndizies.size&&"anchor"===a&&t.shiftKey){if(h instanceof LinePoint){const e=new CubicPoint(h.x,h.y,u.x,u.y,h.x,h.y);r.replaceObject(h,e),this.originalPath.path[n]=h=f=e}if(p instanceof LinePoint){const e=new CubicPoint(p.x,p.y,h.x,h.y,p.x,p.y);r.replaceObject(p,e),this.originalPath.path[n+1]=p=e}else if(h===c&&d instanceof LinePoint){const e=new CubicPoint(d.x,d.y,h.x,h.y,d.x,d.y);r.replaceObject(d,e),this.originalPath.path[1]=d=e}h instanceof CubicPoint&&(a="control2"),h instanceof StartPoint&&p instanceof CubicPoint&&(a="control1",n++,f=this.originalPath.path[n],m(n))}if("corner"===a){if(y-=100*(this.pp.cornerXOffset||0)/g.width,b-=100*(this.pp.cornerYOffset||0)/g.height,r.setProperty(h,"x",f.x+y),this.originalPath){let t=0,o=0,i=0,s=0;const n=this.originalPath.gridColumns||0,a=this.originalPath.gridRows||0;let l="lt";this.pp.index===n-1?l="rt":this.pp.index===n*a-1?l="rb":this.pp.index===n*(a-1)&&(l="lb");for(let c=0;c<a;c++){o="lt"===l||"rt"===l?b/a*(a-c-1):b/a*c;for(let d=0;d<n;d++){const h=c*n+d;t="lt"===l||"lb"===l?y/n*(n-d-1):y/n*d,s="lt"===l||"rt"===l?t/a*(a-c-1):t/a*c,i="lt"===l||"lb"===l?o/n*(n-d-1):o/n*d,r.setProperty(e[h],"y",this.originalPath.path[h].y+i),r.setProperty(e[h],"x",this.originalPath.path[h].x+s)}}}}else if("anchor"===a){const e=this.alignPointToGrid(f.x+y,f.y+b);let t=e.x,s=e.y;if(!1===(null===(o=this.boxRef.box.pathGeometry)||void 0===o?void 0:o.pathDefinesBoxSize)&&(t<0&&(t=0),s<0&&(s=0),t>100&&(t=100),s>100&&(s=100)),r.setProperty(h,"x",t),r.setProperty(h,"y",s),!i||h!==l&&h!==c||(h===l?(r.setProperty(c,"x",t),r.setProperty(c,"y",s)):(r.setProperty(l,"x",t),r.setProperty(l,"y",s))),h instanceof CubicPoint){const e=this.originalPath.path[n];if(r.setProperty(h,"x2",e.x2+y),r.setProperty(h,"y2",e.y2+b),p instanceof CubicPoint){const e=this.originalPath.path[n+1];r.setProperty(p,"x1",e.x1+y),r.setProperty(p,"y1",e.y1+b)}if(i&&h===c&&d instanceof CubicPoint){const e=this.originalPath.path[1];r.setProperty(d,"x1",e.x1+y),r.setProperty(d,"y1",e.y1+b)}}if(h instanceof CubicNextPoint){const e=this.originalPath.path[n];r.setProperty(h,"x1",e.x1+y),r.setProperty(h,"y1",e.y1+b)}if((h instanceof StartPoint||h instanceof LinePoint)&&p instanceof CubicPoint){const e=this.originalPath.path[n+1];r.setProperty(p,"x1",e.x1+y),r.setProperty(p,"y1",e.y1+b)}if((h instanceof StartPoint||h instanceof LinePoint)&&p instanceof CubicPoint){const e=this.originalPath.path[n+1];r.setProperty(p,"x1",e.x1+y),r.setProperty(p,"y1",e.y1+b)}}else if("control1"===a){const e=f,o=e.x1+y,n=e.y1+b;let a=!1;if(console_log(Math.abs(o-e.x),Math.abs(n-e.y)),u&&Math.abs(o-u.x)<=s&&Math.abs(n-u.y)<=s?(a=!0,r.setProperty(h,"x1",u.x),r.setProperty(h,"y1",u.y)):(r.setProperty(h,"x1",e.x1+y),r.setProperty(h,"y1",e.y1+b)),t.shiftKey)if(f instanceof CubicPoint&&u instanceof CubicPoint)if(a)r.setProperty(u,"x2",u.x),r.setProperty(u,"y2",u.y);else{const e=u.x+(u.x-o),t=u.y+(u.y-n);r.setProperty(u,"x2",e),r.setProperty(u,"y2",t)}else if(i&&f instanceof CubicPoint&&h===d&&c instanceof CubicPoint)if(a&&u)r.setProperty(c,"x2",u.x),r.setProperty(c,"y2",u.y);else{const e=c.x+(c.x-o),t=c.y+(c.y-n);r.setProperty(c,"x2",e),r.setProperty(c,"y2",t)}}else if("control2"===a){const e=f,o=e.x2+y,n=e.y2+b;let a=!1;if(Math.abs(o-e.x)<=s&&Math.abs(n-e.y)<=s?(a=!0,r.setProperty(h,"x2",e.x),r.setProperty(h,"y2",e.y)):(r.setProperty(h,"x2",o),r.setProperty(h,"y2",n)),t.shiftKey)if(f instanceof CubicPoint&&p instanceof CubicPoint)if(a)r.setProperty(p,"x1",e.x),r.setProperty(p,"y1",e.y);else{const e=f.x+(f.x-o),t=f.y+(f.y-n);r.setProperty(p,"x1",e),r.setProperty(p,"y1",t)}else if(i&&f instanceof CubicPoint&&h===c&&d instanceof CubicPoint)if(a&&u)r.setProperty(d,"x1",e.x),r.setProperty(d,"y1",e.y);else{const e=f.x+(f.x-o),t=f.y+(f.y-n);r.setProperty(d,"x1",e),r.setProperty(d,"y1",t)}}}n++}return r}alignPointToGrid(e,t){const o={x:e,y:t};if(this.snapToGrid&&this.boxRef){const i=this.boxRef.box.boxGeometry,r=i.rotation,s=this.boxRef.box.boxGeometry.toPixel(this.boxRef.spread.width(),this.boxRef.spread.height());if(e=e/100*s.width+s.left,t=t/100*s.height+s.top,r){const o=BoxGeometry.getRotationPositionX(i),n=BoxGeometry.getRotationPositionY(i),a=rotatePointInBox(e,t,s,r,o,n);a.x=SnapLine.snapToLayoutGrid(a.x),a.y=SnapLine.snapToLayoutGrid(a.y);const l=rotatePointInBox(a.x,a.y,s,-r,o,n);e=l.x,t=l.y}else e=SnapLine.snapToLayoutGrid(e),t=SnapLine.snapToLayoutGrid(t);o.x=100*(e-s.left)/s.width,o.y=100*(t-s.top)/s.height}return o}up_once(e,t){if(t)return scope().closeAllPathEditors(),void scope().rubberBand.up_once(e,!0,t);if(this.rubberActive){const o=scope().rubberBand.up_once(e,!1,t);if(this.rubberActive=!1,this.path&&this.boxRef){const t=this.boxRef.box.boxGeometry,i=t.rotation,r=BoxGeometry.getRotationPositionX(t),s=BoxGeometry.getRotationPositionY(t),n=this.boxRef.spread,a=this.boxRef.box.boxGeometry.toPixel(n.width(),n.top()),l=new Nobs;let c=-1;for(const t of this.path.path){c++;let n=t.modelX(a.width)+a.left,l=t.modelY(a.height)+a.top;if(i){const e=rotatePointInBox(n,l,a,i,r,s);n=e.x,l=e.y}n>=o.left&&n<=o.left+o.width&&l>=o.top&&l<=o.top+o.height?this.addToSelection(c):e.shiftKey||this.removeFromSelection(c)}this.path=new PathGeometry(l,this.path)}return}if(!this.boxRef||!this.pp||!this.originalPath)return;const o=this.getNobs(this.originalPath.path,e);o.setProperty(this.originalPath,"shape","");let i=new Box(o,this.boxRef.box);"path"===this.mode?(i.pathGeometry&&!0===i.pathGeometry.pathDefinesBoxSize&&(i=PathGeometry.adjustBoxToPath(i,this.boxRef.spread)),this.path=i.pathGeometry):i.transform&&("mesh"===this.mode?this.path=i.transform.meshGeometry:this.path=i.transform.perspectiveGeometry);const r=i.serialize(this.boxRef.spread.id,this.boxRef.doc.id);update([this.boxRef.box.serialize(this.boxRef.spread.id,this.boxRef.doc.id)],[r]),this.pp=null}static get styles(){return css`
            :host, :host * {
                box-sizing: border-box;
            }
            :host  {
                z-index: var(--printess-z-index-box-selection);
                pointer-events: auto;
                cursor: crosshair; /*url("printess-editor/pen-cursor-48.png"),*/
           }
           
           :host .frame {
                /* width, height & scale are set as inline styles */
                left: 0;
                top: 0;
                transform-origin: 0% 0%;
           }
            
            .cover {    
                
                position: absolute;
                background: var(--printess-path-editor-cover-bg) ; 
            }
            .cover.top {
              left: 0;
              top: -${config.pathLeftOffset}%; 
              width: 100%;
              height:${config.pathLeftOffset}%;
              border-top: var(--printess-path-editor-cover-border);                 
            }
            .cover.bottom {
              left: 0;
              top: 100%; 
              width: 100%;
              height:${config.pathLeftOffset}%;
              border-bottom: var(--printess-path-editor-cover-border);                 
            }
            .cover.left {
              left: -${config.pathLeftOffset}%;
              top: -${config.pathLeftOffset}%; 
              width: ${config.pathLeftOffset}%;
              height:${100*config.pathScaleFactor}%;
              border-left: var(--printess-path-editor-cover-border);  
              border-top: var(--printess-path-editor-cover-border);  
              border-bottom: var(--printess-path-editor-cover-border);                 
            }
              .cover.right {
              left: 100%;
              top: -${config.pathLeftOffset}%; 
              width: ${config.pathLeftOffset}%;
              height:${100*config.pathScaleFactor}%;
              border-right: var(--printess-path-editor-cover-border);  
                border-top: var(--printess-path-editor-cover-border);  
              border-bottom: var(--printess-path-editor-cover-border);                        
            }
                
            svg.path {
                position: absolute;
                left: -${config.pathLeftOffset}%;
                top: -${config.pathLeftOffset}%; 
                width:${100*config.pathScaleFactor}%;
                height:${100*config.pathScaleFactor}%;
            }
            svg.path path {
                stroke-width: ${2/config.pathScaleFactor}% ;
                vector-effect: non-scaling-stroke; 
                stroke: var(--printess-path-editor-path-color);
                fill: transparent;
                stroke-linejoin: round;
                stroke-linecap: round;
                pointer-events: none;    
            }
            
            svg line {
              pointer-events: none;
              stroke-width: ${2/config.pathScaleFactor}%;
            }
            
            [ data-kind="anchor"]  {
              cursor: pointer;
            }

            [data-kind="anchor"].shift-pressed  {
                cursor: ew-resize;
            }

            [data-kind="control1"], [data-kind="control2"] {
                cursor: pointer;
            }
            
            [data-kind="mirror"] {
              cursor: default;
              fill: var(--printess-path-editor-disabled-path-color);
            }

            [data-kind="corner"] {
              cursor: pointer;
            }
        `}geoCss(){return this.boxRef?this.geo.css(this.boxRef.spread.width(),this.boxRef.spread.height(),!1,!1,"","off",void 0,void 0,void 0,"mesh"===this.mode):""}render(){return this.setAttribute("style",this.geoCss()),html`           
            <div class="frame" style="width:   ${100*this.zoom}% ; height:  ${100*this.zoom}%; transform: scale(${1/this.zoom})">
             
             
                ${this.path?svg`
                <svg class="path" viewBox="0 0 ${100*config.pathScaleFactor} ${100*config.pathScaleFactor}" preserveAspectRatio="none">
                
                    <path d="${this.path.toString()}" ></path>
                    
                     ${this.boxRef?this.getMovers():""};
                             
                </svg>`:svg`
                <svg class="path" viewBox="0 0 ${100*config.pathScaleFactor} ${100*config.pathScaleFactor}" preserveAspectRatio="none">
                
                             
                </svg>`}
                
              
                
              
            </div>
           
           
           
        `}aspectRatioHeight(){if(this.boxRef){const e=this.geo.toPixel(this.boxRef.spread.height(),this.boxRef.spread.width());return e.height/e.width}return 1}close(){this.boxRef=null,this.pp=null,this.parentNode&&this.parentNode.removeChild(this)}shiftPressedOrReleased(e){this.shadowRoot&&this.shadowRoot.querySelectorAll('[data-kind="anchor"]').forEach((t=>{e?t.classList.add("shift-pressed"):t.classList.remove("shift-pressed")}))}}customElements.define("wc-path-editor",WcPathEditor);class WcRubberBand extends LitElement{constructor(){super(),this.zoom=1,this.spread=null,this.left=0,this.top=0,this.width=0,this.height=0,this.startLeft=0,this.startTop=0}setZoom(e){this.zoom=e}static get properties(){return{left:{type:Number},top:{type:Number},width:{type:Number},height:{type:Number},zoom:{type:Number}}}mouseDown(e,t){if(!t)throw"Rubber band mouse down called without a spread";this.spread=t,this.startLeft=this.left=e.model.x-t.left(),this.startTop=this.top=e.model.y-t.top(),this.width=0,this.height=0}mouseMove(e){if(this.spread&&!(e.touches>0&&"path"!==scope().selectedTool)&&(e.modelDelta.x<0?(this.width=Math.abs(e.modelDelta.x),this.left=this.startLeft-this.width):(this.width=e.modelDelta.x,this.left=this.startLeft),e.modelDelta.y<0?(this.height=Math.abs(e.modelDelta.y),this.top=this.startTop-this.height):(this.height=e.modelDelta.y,this.top=this.startTop),this.width>2&&this.height>2&&!this.parentElement)){const e=scope().docUi.getDivForSelection(this.spread.id);e?e.appendChild(this):console.error("Can not attach rubber box.")}}up_once(e,t,o){this.parentNode&&this.parentNode.removeChild(this);const i={left:this.left,top:this.top,width:this.width,height:this.height},r=this.width<10&&this.height<10||config.singleSelectionOnly;if(e.wasRightClick)return i;if(t&&this.spread)if(scope().selectToolCanCreateFrame()&&scope().selectionPropertiesUi.lastContentToolSelectionWasUserInduced&&this.width>10&&this.height>10){const e="Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Donec quam felis, ultricies nec, pellentesque eu, pretium quis, sem. Nulla consequat massa quis enim.";scope().createNewBox({left:this.left,top:this.top,width:this.width,height:this.height},void 0,this.spread.id,"",e,void 0,void 0,"off")}else{const t=!(e.ctrlKey||this.width<20&&this.height<20),i=hitTest(new Rect(this.left,this.top,this.width,this.height),this.spread.toHitTestFrames(),t),s=hitTest(new Rect(this.left,this.top,this.width,this.height),this.spread.toHitTestFrames(!0),e.ctrlKey);s.length&&s[0].id&&scope().uiFrameClick(s[0].id);const n=[],a=new Set;for(const t of i)if(!t.id&&t.groupId&&t.groupMemberBoxIds){for(const i of t.groupMemberBoxIds)if(!a.has(i)){const t=scope().docUi.getWcBox(i);if(t){if(n.push(t),a.add(t.box.id),1===scope().selection.boxes.size&&scope().selection.boxes.values().next().value===t)return scope().selection.up_once(e,!0,o),{left:0,top:0,width:0,height:0}}else alert("Grouped frame not found")}if(r)break}else if(t.id){const i=scope().docUi.getWcBox(t.id);if(i){if(n.push(i),a.add(i.box.id),i.box.boxGroupId)for(const e of this.spread.boxes.values())if(!a.has(e.id)&&e.boxGroupId===i.box.boxGroupId){const t=scope().docUi.getWcBox(e.id);t?(n.push(t),a.add(t.box.id)):alert("Grouped frame not found")}if(r){if(1===scope().selection.boxes.size&&scope().selection.boxes.values().next().value===i)return scope().selection.up_once(e,!0,o),{left:0,top:0,width:0,height:0};if(!config.isMobile&&config.isBuyer){if(1===n.length&&i.box.lock.hasOnlyTextAllows()&&i.box.storyRef&&!config.forceMultilineFormEditing&&scope().currentDoc.showBuyerEddi)return scope().clearSelection(),scope().showEddi(i,e),{left:0,top:0,width:0,height:0};if(1===n.length)for(const e of n)if(config.enterImageCropingOnSelect&&e.box.lock.hasImagePlacement())return scope().showCropEditor(e),{left:0,top:0,width:0,height:0}}break}}}0===n.length?(scope().clearSelectionAndAllEditorsSync(),"lock"!==scope().selectedTool&&scope().selectionPropertiesUi.selectTool("geometry")):(e.shiftKey&&!config.isBuyer?scope().selection=new Selection$1([...scope().selection.boxes.values(),...n],this.spread):(scope().clearSelection(),scope().selection=new Selection$1(n,this.spread)),n.length>1?scope().selectionPropertiesUi.selectedTool="geometry":1===n.length&&("story"===scope().selectionPropertiesUi.selectedTool&&n[0].box.storyRef&&!config.forceMultilineFormEditing&&scope().currentDoc.showBuyerEddi?scope().eddiActive()&&scope().showEddi(n[0],e):config.isBuyer&&!config.isMobile&&n[0].box.storyRef&&!config.forceMultilineFormEditing&&scope().currentDoc.showBuyerEddi&&n[0].box.lock.allows("allowText","content")&&!n[0].box.lock.allows("allowFrame","positionByMouse")&&scope().showEddi(n[0],e)))}return this.spread=null,i}border(){return scope()&&scope().selectToolCanCreateFrame()?3/zoomFactor()+"px solid var(--printess-frameColor)":1/zoomFactor()+"px dotted var(--printess-rubberBandColor)"}static get styles(){return css`
            :host, :host * {
                box-sizing: border-box;
            }
            :host  {
                position: absolute;
            }
    `}render(){return this.style.left=this.left+"px",this.style.top=this.top+"px",this.style.width=this.width+"px",this.style.height=this.height+"px",this.style.border=this.border(),html``}}customElements.define("wc-rubber-band",WcRubberBand);class GlobalResources{constructor(e=[]){this.styles=new Map,this.images=new Map;for(const t of e)t.getStyles&&t.getStyles().then((e=>{for(const t of e)if(t.text&&t.name){const e=new Style("global-"+(t.name||"unnamed"),{txt:t.text});this.styles.set(e.id,e),e.errors.length&&alert("Global Style ["+e.id+"] has errors: \n"+e.errors.join("\n"))}else alert("Ressource Style does not have text: "+t.name)}))}}var eResource;!function(e){e.collapse="collapse",e.pages="pages",e.layers="layers",e.colors="colors",e.images="images",e.textStyles="textStyles",e.macros="macros",e.formFields="formFields",e.fonts="fonts",e.styles="styles",e.scripts="scripts",e.data="data",e.snippets="snippets"}(eResource||(eResource={}));class WcResources extends LitElement{constructor(){super(),this.selectedResource=eResource.pages,this.resourceCollapseIcon="collapseLeft",this.doc=scope().currentDoc}static get properties(){return{resourceCollapseIcon:{type:String},selectedResource:{type:String},doc:{attribute:!1,type:Object}}}resources(){return[{resource:eResource.pages,title:"Pages",icon:"docRef",canCreate:!0,canCreateFolder:!1},{resource:eResource.layers,title:"Layers",icon:"docRef",canCreate:!1,canCreateFolder:!0},{resource:eResource.snippets,title:"Snippets",icon:"docRef",canCreate:!0,canCreateFolder:!1},{resource:eResource.images,title:"Images",icon:"image",canCreate:!0,canCreateFolder:!0},{resource:eResource.fonts,title:"Fonts",icon:"text",canCreate:!0,canCreateFolder:!0},{resource:eResource.colors,title:"Colors",icon:"text",canCreate:!0,canCreateFolder:!0},{resource:eResource.styles,title:"Styles",icon:"pathText",canCreate:!0,canCreateFolder:!1},{resource:eResource.macros,title:"Macros",icon:"robot",canCreate:!0,canCreateFolder:!1},{resource:eResource.formFields,title:"Form",icon:"robot",canCreate:!0,canCreateFolder:!0}]}getResourceDef(){for(const e of this.resources())if(e.resource===this.selectedResource)return e;return this.resources()[0]}selectResource(e){this.isMinimized()&&this.normalize(),this.selectedResource=e,this.selectedResource===eResource.formFields&&(scope().resourcesFormFieldsUi.doc=scope().currentDoc,scope().resourcesFormFieldsUi.refreshGlobalList()),this.selectedResource===eResource.snippets&&(scope().resourcesSnippetsUi.doc=scope().currentDoc)}selectStyles(e){this.selectResource(eResource.styles),e&&scope().resourcesStylesUi.toggleStyle(e)}selectFormFields(e){this.selectResource(eResource.formFields),e&&scope().resourcesFormFieldsUi.select(e)}isFormFieldsSelected(){return"formFields"===this.selectedResource}getContextMenu(e,t,o){if(this.shadowRoot){let i=this.shadowRoot.elementFromPoint(t,o);if(i&&"function"==typeof i.getWcList&&(i=i.getWcList()),i&&"function"==typeof i.getContextMenu)return i.getContextMenu(e,t,o)}return null}static get styles(){return css`

            :host, :host * {
              box-sizing: border-box;

            }

            :host {

              width: 100%;
              height: 100%;
              display: grid;
              justify-content: stretch;
              grid-row-gap: 20px;
              position: relative;

            }

            .property {
              margin-left: 20px;
              margin-right: 20px;
            }


            .header {

              position: absolute;
              left: 0;
              top: 0;

              color: var(--printess-headlineColor);
              font-size: var(--printess-headlineSize);
              padding: 10px;

              box-shadow: rgba(0,0,0,0.4) 0px 4px 4px -4px;
              background: var(--printess-panelBackground);
              height: calc(20px + var(--printess-headlineSize));
              z-index: 2;
            }

            .header wc-icon {
                position: absolute;
            }

            .header wc-icon:hover {
                fill: red;
            }

            .plus-button {
                top: 13px;
                right: 10px;
                width: 20px;
                height: 20px;
            }

            .facing-pages-button {
                top: 13px;
                right: 58px;
                width: 20px;
                height: 20px;
            }

            .pages-settings-button {
                top: 12px;
                right: 34px !important;
                width: 18px;
                height: 18px;
            }


            .properties {

                position: absolute;
                left: 0;
                top: calc(20px + var(--printess-headlineSize));

                height: calc(100% - 50px);
                padding-top: 5px; /*  was padding: 9px; leave 150px for content */
                overflow: auto;
            }


            .resourcebar {
                
                background-color: var(--printess-toolbarBackground);
                position: absolute;
                right: 0;
                top: 0;
                height: 100%;
                display: flex;
                flex-direction: column;
            }

            .extra {
                flex-grow: 10;
            }

            .tb-button {
                cursor: pointer;
                display: inline-block;
            }

            .tb-text {
                display: block;
                padding-left: 20px;
                padding-right: 10px;

                color: var(--printess-toolbarColor);
                font-size: var(--printess-inputSize);
                text-align: center;

                /*font-family: "SFMono-Regular", Consolas, "Liberatio n Mono", Menlo, Courier, monospace;*/
                transform: rotate(90deg);
                white-space: nowrap;
                 
            }
            

            .tb-button.selected {
                background: var(--printess-toolbarBackgroundSelected);
            }
            
            
            .tb-button:hover {
                background: var(--printess-toolbarBackgroundHover);
            }
            .tb-button:hover > .tb-text {
                color: var(--printess-toolbarColorHover);
            }

            .tb-button.selected {
                border-bottom: 3px solid var(--printess-headlineColor);
            }

         
        `}getResourceTabs(){return this.resources().filter((e=>config.enableMacros||"macros"!==e.resource))}render(){return config.isMobile?html``:html`
            ${config.isBuyer?"":html`
                <div class="resourcebar" style="width: ${config.isBuyer?"0px":"var(--printess-resource-toolbar-width)"};">
                <div class="tb-button" style="padding: 2px; padding-left: 3px; padding-right: 0px"  
                    @click="${()=>{this.isMinimized()?this.normalize():this.minimize()}}">
                    <wc-icon icon="${this.resourceCollapseIcon}" primaryColor="toolbar" style="width: 24px; height: 24px" ></wc-icon>
                    </div>
                    ${this.getResourceTabs().map((e=>html`
                        <div class="tb-button ${this.selectedResource===e.resource?"selected":""}" title="${e.title}"
                            style="height: ${10*e.title.length+5}px;" data-help=${"resources-toolbar-"+e.resource}
                            @click="${()=>this.selectResource(e.resource)}">
                            <div class="tb-text">
                                ${e.title}
                            </div> 
                        </div>`))}
                </div>
            `}
    
              ${this.resourceTitle()?html`<div class="header" 
                style="width: calc(100% - var(--printess-resource-toolbar-width));">
                <span>${this.resourceTitle()}</span>
                
                ${this.getResourceDef().canCreate?html`
                  <wc-icon class="plus-button"  icon="plus-circle" primaryColor="headline"   
                  @click=${()=>this.plusClicked()}></wc-icon>  `:""}
                
                ${this.getResourceDef().canCreateFolder?html`
                  <wc-icon class="pages-settings-button"  icon="folder-plus" primaryColor="headline"   
                  @click=${()=>this.plusFolderClicked()}></wc-icon>  `:""}
            
          
                ${this.selectedResource===eResource.pages?html`
                  <wc-icon class="facing-pages-button" icon=${this.doc.facingPages?"facing-pages":"page"} primaryColor="headline"
                    @click=${()=>this.toggleFacingPages()}></wc-icon> 
                   
                `:""}
                    
               </div>`:""}
            
               <div class="properties" @mousedown=${this.mousedown} style="width: calc(100% - var(--printess-resource-toolbar-width)); ${this.getPropertiesPadding()}">          
                  ${this.resourceComponent()||html`<p>not implemented</p>`} 
               </div>
    
          
         
        `}getPropertiesPadding(){return this.selectedResource===eResource.colors||this.selectedResource===eResource.fonts||this.selectedResource===eResource.images?"padding-left: 0;":this.selectedResource===eResource.styles?"padding: 0;":this.selectedResource===eResource.layers?"padding-left: 5px; padding-top: 5px;":""}mousedown(e){const t=e.target;t&&"WC-RESOURCES-FORM-FIELDS"===t.tagName||t&&"WC-RESOURCES-SNIPPETS"===t.tagName||e.preventDefault()}pageSettingsClick(){this.getResourceDef().resource===eResource.pages&&alert("Jau!")}toggleFacingPages(){this.getResourceDef().resource===eResource.pages&&scope().pagesUi.toggleFacingPages()}plusClicked(){const e=this.resourceComponent();e?e.getCopyPasteConsumer().createItem().then((e=>{e||beep()})):(console.error("Can not get ressource component."+this.getResourceDef()),beep())}plusFolderClicked(){var e;const t=this.resourceComponent();if(t&&"function"==typeof t.getWcList){const o=prompt("New Group's Name:");o&&(null===(e=t.getWcList())||void 0===e||e.createGroup(o.toUpperCase()))}else if(this.layersVisible){const e=prompt("New Layer Name:");e&&scope().layersUi.createLayer(e.toUpperCase())}else console.error("Can not get ressource component or is not wcList."+this.getResourceDef()),beep()}resourceTitle(){return this.getResourceDef().resource===eResource.formFields?"Form Fields":this.getResourceDef().title}resourceComponent(){return this.selectedResource===eResource.colors?scope().resourcesColorsUi:this.selectedResource!==eResource.pages||config.isBuyer?this.selectedResource===eResource.styles?scope().resourcesStylesUi:this.selectedResource===eResource.images?scope().resourcesImagesUi:this.selectedResource===eResource.fonts?scope().resourcesFontsUi:this.selectedResource===eResource.textStyles?scope().resourcesTextStylesUi:this.selectedResource===eResource.macros?scope().resourcesMacrosUi:this.selectedResource===eResource.formFields?scope().resourcesFormFieldsUi:this.selectedResource===eResource.layers?(scope().layersUi.requestUpdate(),scope().layersUi):this.selectedResource===eResource.snippets?(scope().resourcesSnippetsUi.requestUpdate(),scope().resourcesSnippetsUi):null:(scope().pagesUi.doc=scope().currentDoc,scope().pagesUi)}get layersVisible(){return this.selectedResource===eResource.layers}get colorsVisible(){return this.selectedResource===eResource.colors}minimize(){const e=document.querySelector(".resources");if(e){const t=e;if(t.style.minWidth=config.resourceToolBarWidth()+"px",t.style.width=config.resourceToolBarWidth()+"px",t.style.flex="1 1 "+config.resourceToolBarWidth()+"px",t.style.flex="1 1 "+config.resourceToolBarWidth()+"px",this.shadowRoot){const e=this.shadowRoot.querySelector(".properties");e&&(e.style.display="none");const t=this.shadowRoot.querySelector(".header");t&&(t.style.display="none")}}this.resourceCollapseIcon="expandLeft",setPanelColumns()}isMinimized(){return"expandLeft"===this.resourceCollapseIcon}normalize(){const e=document.querySelector(".resources");if(e){const t=e;if(t.style.minWidth=config.resourcePanelInitialWidth()+"px",t.style.width="initial",this.shadowRoot){const e=this.shadowRoot.querySelector(".properties");e&&(e.style.display="block");const t=this.shadowRoot.querySelector(".header");t&&(t.style.display="block")}}this.resourceCollapseIcon="collapseLeft",setPanelColumns()}}customElements.define("wc-resources",WcResources);var __awaiter$K=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};class WcList extends LitElement{constructor(e,t){if(super(),this.drag=!1,this.moveHandler=this.mousemove.bind(this),this.upHandler=this.mouseup.bind(this),this.dropWcSpread=null,this.dropWcSpreadX=0,this.dropWcSpreadY=0,!e)throw new Error("WcList constructor expects a valid context");this.context=e,t&&(this.list=t);const o=scope().getWcListGroup(e.getName());if("Colors"===e.getName())for(const e of scope().colors.groups.values())o.has(e.name)||o.set(e.name,e);else if("DocFormFields"===e.getName()){let e=0;for(const t of this.list.values())t.group&&!o.has(t.group)&&(e+=.01,o.set(t.group,{name:t.group,order:e}))}else if("GroupSnippets"===e.getName()||"LayoutSnippets"===e.getName());else{const e=Array.from(this.list.values()).sort(((e,t)=>e.order-t.order));for(const t of e)t.group&&!o.has(t.group)&&o.set(t.group,{name:t.group,order:t.order})}this.groups=o}static get properties(){return{list:{type:Object},groups:{type:Object}}}getItemsByGroup(e){return"DocFormFields"===this.context.getName()||"GroupSnippets"===this.context.getName()||"LayoutSnippets"===this.context.getName()?Array.from(this.list.values()).filter((t=>!e&&!t.group||t.group===e)):Array.from(this.list.values()).filter((t=>!e&&!t.group||t.group===e)).sort(((e,t)=>e.order-t.order))}createGroup(e){const t={name:e,order:.01},o=new Map(this.groups);o.set(e,t),this.groups.has(e)||scope().getWcListGroup(this.context.getName()).set(e,t),this.groups=o}getContextName(){return this.context.getName()}static get styles(){return css`
 
:host, :host * {
    box-sizing: border-box;
}
:host  {   
    width: 100%;
   /* height: 100%;   /* is a scrollbar problem if other elents add up on top of this, */     
    position: relative;   
    display: block; 

}
.list { 
    width: 100%;
    position: relative;
    pointer-events: none;
        
    display: grid;
    justify-content: stretch;
    grid-row-gap: 0;   
    
}

.item{
        
    position: relative;
    cursor: pointer;
    display: flex;
    pointer-events: auto;
    
    border-left: 13px solid transparent;
    padding: 1px;
    padding-left: 3px;

    position: relative;
    
} 
.item:hover{
    background-color: var(--printess-panelBackgroundHover);
} 
.item.selected  {
    background-color: var(--printess-panelBackgroundSelected);  /*rgba(181,232,255,0.61) !important;*/
    border-left: 13px solid var(--printess-headlineColor);
}

.item.selected:after {
  position: absolute;
  pointer-events: none;
  content: ""; 
  left: -11px; 
  top: 6px;
  width: 0px;
  height: 0px;
  border-left: 4px solid transparent;
  border-right: 4px solid transparent;
  border-top: 5px solid white;

}
.context-button {
  position: absolute; 
  left:-13px; /* will be over-written */
  top: 0; 
  width: 13px;
  bottom: 0;
  cursor: pointer;
  
  pointer-events: auto;
}
 
@keyframes bounceOut {
    0% {
        transform: scale(1.0);
        opacity: 1;
    }

    100% {
        transform: scale(0.1);
        opacity: 0;
    }
}
.item.fade-out .page {
        animation: bounceOut 500ms; 
}



@keyframes bounceIn {
    0% {
        transform: scale(0.1);
        opacity: 0;
    }

    100% {
        transform: scale(1);
        opacity: 1;
    }
}
.item.fade-in .page {
        animation: bounceIn 500ms;  
}

.spacer {
    width: 100%;
    height: 5px;
    pointer-events: auto;
}
.spacer.over {
    background-color: lightblue;
}
.group {
    width: 100%;
    font-size: var(--printess-labelSize);
    height: auto;
    pointer-events: auto;
   /* border-top: 1px dotted gray;*/
    margin-top: 5px; 
    margin-bottom: 3px; 
    padding: 2px;
    text-transform: uppercase;
    
    background-color: var(--printess-toolbarColor);
    color: var(--printess-toolbarBackground);
    border: 1px solid transparent;
}
.group > span {
  pointer-events: none;
}
.group.over {
    background-color: var(--printess-toolbarColorHover);
    border: 1px solid var(--printess-headlineColor);
}
`}render(){let e=e=>!1,t=e=>!1,o=e=>"",i=!1;return"Colors"===this.context.getName()&&(e=e=>scope().colorScheme===e.name,t=e=>{const t=e;return scope().colors.getSwatchByName(t.name)!==t},o=e=>scope().colorScheme=e.name,i=!0),html`
            ${this.list?html`<div class="list" >
          <div class="spacer" data-after="start"></div>
            ${Array.from(this.groups.values()).sort(((e,t)=>e.order-t.order)).map((r=>html` 
              
              ${r.name?html`
                <div class="group" data-group="${r.name}" style="${i?"cursor: pointer;":""} ${e(r)?"background-color: var(--printess-headlineColor);":""}" @click=${()=>o(r)}>
                  <span>${r.name}</span>
                </div>
              `:""}
              
              ${this.getItemsByGroup(r.name).map((e=>html`    
                  <div class="item" style="margin-left: ${e.group?8:0}px; ${t(e)?"opacity: 0.5":""}"
                       data-item-id="${e.id}" @mousedown=${t=>this.mousedown(t,e)}> 
                        ${this.context.itemTemplate(e)}
                        <div @click=${t=>showCtxMenu(t,this.getContextMenuByItem(e.id))}   class="context-button"></div>
                  </div>    
                  <div class="spacer" data-after="${e.id}" data-group="${e.group||""}"></div>             
              `))}

            `))}
           
          </div>`:""} 
        `}mousedown(e,t){const o=e.target;o&&o.classList&&o.classList.contains("clickable")||(e.preventDefault(),document.activeElement!==document.body&&document.activeElement instanceof HTMLElement&&document.activeElement.blur(),t&&(scope().copyPasteConsumer=this,this.targetDiv=e.target,this.startX=e.clientX,this.startY=e.clientY,"WC-ICON"===this.targetDiv.tagName?document.addEventListener("mouseup",this.upHandler):e.shiftKey?this.selectItem(t.id,this.isItemSelected(t)?"remove":"add"):(this.isItemSelected(t)||this.selectItem(t.id,"select"),document.addEventListener("mouseup",this.upHandler),document.addEventListener("mousemove",this.moveHandler))))}isDragging(){return!(!this.sprite||!this.sprite.parentNode)}mousemove(e){if(e.preventDefault(),e.cancelBubble=!0,this.dropWcSpread=null,!this.drag&&(Math.abs(this.startY-e.clientY)>10||Math.abs(this.startX-e.clientX)>10))this.sprite=this.createSprite(),document.body.appendChild(this.sprite),this.drag=!0;else if(this.drag&&(this.sprite.style.left=e.clientX+"px",this.sprite.style.top=e.clientY+"px",this.shadowRoot)){const t=this.shadowRoot.elementFromPoint(e.clientX,e.clientY);if(t&&t.classList&&t.classList.contains("spacer")?t!==this.spacer&&(this.spacer&&this.spacer.classList.remove("over"),t.classList.add("over"),this.spacer=t):this.spacer&&(this.spacer.classList.remove("over"),this.spacer=void 0),t&&t.classList&&t.classList.contains("group")?t!==this.group&&(this.group&&this.group.classList.remove("over"),t.classList.add("over"),this.group=t):this.group&&(this.group.classList.remove("over"),this.group=void 0),!this.spacer&&"Images"===this.context.getName()){const t=scope().docUi.getSpreadUnderMouse(e.clientX,e.clientY);if(t){this.dropWcSpread=t;const o=getModelPosFromMouseEvent(e);this.dropWcSpreadX=o.modelX,this.dropWcSpreadY=o.modelY}}}}mouseup(e){if(e.preventDefault(),e.cancelBubble=!0,document.removeEventListener("mousemove",this.moveHandler),document.removeEventListener("mouseup",this.upHandler),this.drag){if(this.sprite&&this.sprite.parentNode&&this.sprite.parentNode.removeChild(this.sprite),this.drag=!1,this.spacer&&(this.spacer.classList.remove("over"),this.reOrderItem(this.spacer.dataset.after,this.spacer.dataset.group||"")),this.group&&(this.group.classList.remove("over"),this.setGroupName(this.group.dataset.group)),this.dropWcSpread&&"Images"===this.context.getName()){const e=this.getSelectedItems()[0];if(e){const t=scope().images.get(e.id);if(t){const e=this.dropWcSpread.spread.width()/2,o={height:e*(t.height/t.width),width:e,left:this.dropWcSpreadX-this.dropWcSpread.spread.left(),top:this.dropWcSpreadY-this.dropWcSpread.spread.top()};scope().createNewBox(o,boxTypeE.image,void 0,void 0,void 0,void 0,t)}}}}else{const e=this.targetDiv.dataset.itemId;e&&this.selectItem(e)}}getItemDiv(e){return this.shadowRoot?this.shadowRoot.querySelector('[data-item-id="'+e+'"]'):null}selectItem(e,t="select"){if(this.shadowRoot)for(const o of this.shadowRoot.querySelectorAll(".item")){const i=o;i.dataset.itemId===e?"remove"===t?i.classList.remove("selected"):i.classList.add("selected"):"select"===t&&i.classList.remove("selected")}}selectItems(e){if(this.shadowRoot)for(const t of this.shadowRoot.querySelectorAll(".item")){const o=t,i=o.dataset.itemId;i&&e.has(i)?o.classList.add("selected"):o.classList.remove("selected")}}isItemSelected(e){return this.getSelectedItems().indexOf(e)>=0}getItemBeforeInsert(){const e=this.getSelectedItems();return e.length?e[e.length-1]:this.list.size>0?Array.from(this.list.values()).sort(((e,t)=>e.order-t.order))[this.list.size-1]:null}getSelectedItems(){const e=[];return this.shadowRoot&&this.shadowRoot.querySelectorAll(".item.selected").forEach((t=>{const o=t.dataset.itemId;if(o){const t=this.list.get(o);t&&e.push(t)}})),e}createSprite(){const e=document.createElement("div");return e.style.position="absolute",e.style.pointerEvents="none",e.style.display="grid",e.style.gridRowGap="5px",e.style.justifyContent="center",e.style.minWidth="150px",this.shadowRoot&&this.shadowRoot.querySelectorAll(".item.selected").forEach((t=>{const o=t.cloneNode(!0);o.style.position="relative",o.style.display="flex",o.style.background="rgba(255,255,255,0.6)",o.style.border="1px solid rgba(255,255,255,0.3)";const i=o.querySelector(".context-button");i&&o.removeChild(i),e.appendChild(o)})),e}selectAll(){if(this.shadowRoot){for(const e of this.shadowRoot.querySelectorAll(".item")){e.classList.add("selected")}return!0}return!1}clearSelection(){if(this.shadowRoot)for(const e of this.shadowRoot.querySelectorAll(".item")){e.classList.remove("selected")}}getClipboardData(){const e=this.getSelectedItems();if(e.length>0){const t=[];for(const o of e)t.push(o.serialize(!0));return{context:this.context.getName(),objects:t,scopeId:scope().id}}return null}setClipboardData(e,t){var o,i;if(0===e.objects.length)return!1;const r=this.getItemBeforeInsert();let s=null!==(o=null==r?void 0:r.id)&&void 0!==o?o:"start";const n=null!==(i=null==r?void 0:r.group)&&void 0!==i?i:"";let a=this.getNewOrder(s);const l=[];for(const t of e.objects){const e=generateDBID();t.data.or=a,t.data.gr=n,t.data.na&&(t.data.na=t.data.na.replace(/(\[|\])/gm,"")),"readonly"!==t.data.ac&&"readonlyName"!==t.data.ac||(t.data.ac="write");const o=this.context.deserializeItem(generateDBID(),t);s=e,a=this.getNewOrder(s),l.push(o.serialize(!1))}return"DocFormFields"===e.context||"GlobalFormFields"===e.context?scope().resourcesFormFieldsUi.pasteFormFieldItem(l):create(l).then((()=>{window.setTimeout((()=>{this.clearSelection();for(const e of l)this.selectItem(e.id,"add");this.fadeInItem()}),500)})),!0}reEnumerateEntries(){let e=.001;const t=[],o=[];for(const i of Array.from(this.groups.values()).sort(((e,t)=>e.order-t.order)))for(const r of this.getItemsByGroup(i.name))r.canMove()&&(t.push(r.serialize(!1)),o.push(r.serialize(!1,e)),e+=1e-4);update(t,o)}reEnumerateEntriesAlphabetically(){let e=.001;const t=[],o=[];for(const i of Array.from(this.groups.values()).sort(((e,t)=>e.order-t.order))){const r=Array.from(this.list.values()).filter((e=>!i&&!e.group||e.group===i.name)).sort(((e,t)=>e.name.localeCompare(t.name)));for(const i of r)i.canMove()&&(t.push(i.serialize(!1)),o.push(i.serialize(!1,e)),e+=1e-4)}update(t,o)}getNewOrder(e){let t=0,o=1;const i=Array.from(this.list.values()).sort(((e,t)=>e.order-t.order));let r=!1;if(e&&"start"!==e)for(let s=0;s<i.length;s++){const n=i[s];if(n.id===e&&(r=!0),r&&(n.order>0||s<i.length-1&&i[s+1].order>0)){s<i.length-1&&(o=i[s+1].order),t=n.order;break}}else{o=.001;for(const e of i)if(e.order>0){o=e.order;break}}let s=getOrder(t,o,!0);return-1===s&&(s=t,window.setTimeout((()=>{this.reEnumerateEntries()}),500)),s}reOrderDocFF(e,t,o,i="after"){const r=scope().currentDoc,s=scope().currentDoc.getAllDocFormFieldsAsMap(null);let n=s.get(e);if(r&&n){if(n.group!==o){const e=new Nobs;e.setProperty(n,"group",o),n=new FormField(e,n)}const e=new Map;if("keep"===i)for(const[t,o]of s)o.id===n.id?e.set(n.id,n):e.set(t,o);else{"start"===t&&e.set(n.id,n);for(const[o,r]of s)r.id!==n.id&&(r.id===t?("before"===i&&e.set(n.id,n),e.set(o,r),"after"===i&&e.set(n.id,n)):e.set(o,r))}const a=(new Nobs).replaceCollection(r.formFields,e),l=new Doc(a,r);update([r.serialize(scope().id)],[l.serialize(scope().id)]),scope().clearSelection()}}reOrderSnippetCluster(e,t,o,i="after"){const r=scope().currentDoc,s=scope().resourcesSnippetsUi.getCurrentSnippetClustersAsMap(),n=s.get(e);if(r&&n){const e=new Map;if("keep"===i)for(const[t,o]of s)o.id===n.id?e.set(n.id,n):e.set(t,o);else{"start"===t&&e.set(n.id,n);for(const[o,r]of s)r.id!==n.id&&(r.id===t?("before"===i&&e.set(n.id,n),e.set(o,r),"after"===i&&e.set(n.id,n)):e.set(o,r))}const o=scope().docUi.currentSpread["GroupSnippets"===this.context.getName()?"groupSnippets":"layoutSnippets"],a=(new Nobs).replaceCollection(o,Array.from(e.values())),l=new Doc(a,r);update([r.serialize(scope().id)],[l.serialize(scope().id)]),scope().clearSelection()}}reOrderItem(e,t){const o=this.getSelectedItems();if("DocFormFields"===this.context.getName())return void(1===o.length?this.reOrderDocFF(o[0].id,e,t,"after"):alert("Document Form Fields can only be moved one at a time."));if("LayoutSnippets"===this.context.getName()||"GroupSnippets"===this.context.getName())return void(1===o.length?this.reOrderSnippetCluster(o[0].id,e,t,"after"):alert("Snippet Lists can only be moved one at a time."));const i=[],r=[];let s=!1;if(o.length){const n=new Nobs;for(const a of o)if(a.canMove()){let o=0;if(0===a.order?window.setTimeout((()=>{this.reEnumerateEntries()}),500):o=this.getNewOrder(e),a instanceof FormField&&"doc"===a.origin)n.setProperty(a,"group",t),s=!0;else{n.setProperty(a,"order",o),n.setProperty(a,"group",t);const e=this.context.mutateItem(n,a);i.push(e.serialize(!1)),r.push(a.serialize(!1))}}if(s){const e=new Doc(n,scope().currentDoc);update([scope().currentDoc.serialize(scope().id)],[e.serialize(scope().id)])}else i.length>0?update(r,i):beep()}}setGroupName(e){const t=this.getSelectedItems();if("DocFormFields"===this.context.getName())return void(1===t.length?this.reOrderDocFF(t[0].id,"",e,"keep"):alert("Document Form Fields can only be moved one at a time."));const o=[],i=[];if(t.length){const r=new Nobs;for(const s of t)if(s.canMove()){r.setProperty(s,"group",e);const t=this.context.mutateItem(r,s);o.push(t.serialize(!1)),i.push(s.serialize(!1))}o.length>0?update(i,o):beep()}}canCreateItem(){return this.context.canCreateItem()}createItem(){let e=0;const t=this.getSelectedItems();t.length>0&&(e=t[t.length-1].order);const o=getOrder(e,1);return new Promise((e=>{const t=this.context.createItem(o);"completed"!==t&&t.then((t=>{"completed"!==t?create([t.serialize(!1)]).then((()=>{this.selectItem(t.id),this.fadeInItem(),e(!0)})):e(!0)}))}))}createItems(e){return __awaiter$K(this,void 0,void 0,(function*(){let t=0,o=1;const i=this.getSelectedItems();if(i.length>0)t=i[i.length-1].order;else{const e=Array.from(this.list.values()).sort(((e,t)=>e.order-t.order));e.length&&(t=e[e.length-1].order)}const r=e.map((e=>{const i=getOrder(t,o);return o=i,e.serialize(!1,i)}));return yield create(r),r.forEach((e=>{this.selectItem(e.id),this.fadeInItem()})),r.map((e=>e.id))}))}removeItem(){return new Promise((e=>{const t=[];for(const e of this.getSelectedItems())if(e.canRemove()){t.push(e);const o=this.getItemDiv(e.id);o&&o.classList.add("fade-out")}t.length?this.context.removeItems?this.context.removeItems(t).then((t=>{e(t)})):remove(t.map((e=>e.serialize(!1)))).then((()=>{this.removeFadeOut(300),e(!0)})):(this.removeFadeOut(300),e(!1))}))}canRemove(){for(const e of this.getSelectedItems())if(e.canRemove())return!0;return!1}removeFadeOut(e=0){e>0&&setTimeout((()=>{this.removeFadeOut(0)}),e),this.shadowRoot&&this.shadowRoot.querySelectorAll(".item.fade-out").forEach((e=>{e&&(e.classList.remove("fade-out"),e.classList.remove("selected"))}))}fadeInItem(){if(this.shadowRoot){const e=this.shadowRoot.querySelector(".item.selected");e&&(e.classList.add("fade-in"),setTimeout((()=>e.classList.remove("fade-in")),600))}}getItemIdFromElement(e){if(e){if(e.classList.contains("item"))return e.dataset.itemId||"";if(e.parentElement)return this.getItemIdFromElement(e.parentElement)}return""}getContextMenu(e,t,o){if(this.shadowRoot){const e=this.shadowRoot.elementFromPoint(t,o);return scope().copyPasteConsumer=this,this.getContextMenuByItem(this.getItemIdFromElement(e))}return null}getContextMenuByItem(e){if(e){let t=this.getSelectedItems();0===t.filter((t=>t.id===e)).length&&(this.selectItems(new Set([e])),t=this.getSelectedItems());const o=t.reduce(((e,t)=>e&&t.canRemove()),!0),i="Colors"===this.context.getName(),r=!0;return[...this.context.getContextMenuItems?this.context.getContextMenuItems():[],{caption:"Copy",disabled:!r,callback:()=>{clipboardCopy(!1)}},{caption:"Paste",callback:()=>{clipboardPaste(!1)}},{caption:"-"},{caption:"Add",callback:()=>{this.createItem()}},{caption:"Delete",disabled:!o,callback:()=>{this.removeItem()}},{caption:"Duplicate",disabled:!i,callback:()=>{const e=this.getClipboardData();e&&this.setClipboardData(e,!1)}},{caption:"-"},{caption:"Sort Alphabetically",callback:()=>{this.reEnumerateEntriesAlphabetically()}}]}return null}}customElements.define("wc-list",WcList);class WcResourcesColors extends LitElement{constructor(){super(),this.context={createItem:function(e){return new Promise((e=>{const t=new Color,o=(new Nobs).setProperty(t,"name",t.toAutoName(""));new WcDialogColor(new Color(o,t),!0,(t=>{e(t)})).showDialog()}))},canCreateItem:()=>!0,removeItems:function(e){return new Promise((t=>{const o=[];let i=0;for(const r of e){const s=scope().colors.colorsByNameCache.get(r.name);if(s&&s.length>1)o.push(r.serialize());else{if(scope().colors.getOrReplaceAllBoxesWithSwatch(r.name).size>0)if(e.length>1)i++;else{new WcDeleteSwatchDialog(r.name).showDialog((e=>{t(e)}))}else o.push(r.serialize())}}o.length>0&&(remove(o),i&&(alert(i+" Colors haven't removed because they are used in the template.\nTo remove and replace used colors, select a single color and click 'Delete'"),t(!1)))}))},mutateItem:(e,t)=>new Color(e,t),getName:function(){return"Colors"},getContextMenuItems(){const e=[];return e.push({caption:"Properties",callback:()=>{var e;const t=null===(e=scope().resourcesColorsUi.getWcList())||void 0===e?void 0:e.getSelectedItems()[0];t&&scope().resourcesColorsUi.openNamedColorDialog(t)},icon:"cog"}),e.push({caption:"-"}),e.push({caption:"Restore Buyer Colors",callback:()=>{create(Colors.getDefaultColors().filter((e=>!scope().colors.colorsByNameCache.has(e.name))).map((e=>e.serialize())))},icon:"palette"}),e.push({caption:"-"}),e},deserializeItem:function(e,t){return new Color(e||generateDBID(),t.data)},itemTemplate:e=>html`

                 <div  style="  width: 16px; height: 16px; border: 1px solid var(--printess-textColorDisabled); cursor: pointer; margin-right: 5px; background-color: ${e.toCssColor(100,100)}; cursor: ${"readonly"===e.access?"not-allowed":"pointer"}"
                    @click=${()=>this.openNamedColorDialog(e)}></div>
                   
                 <div style="font-size: 12px; color: var(--printess-textColor); width: calc(100% - 21px)"  @click=${()=>this.assignColorToSelection(e)} >${config.debug?e.name+" ("+e.order+")":e.name}</div>
            `},this.colors=new Colors,this.selectedColor=this.colors.getFallbackColor()}static get properties(){return{colors:{type:Object},selectedColor:{type:Object}}}getCopyPasteConsumer(){const e=this.getWcList();if(e)return e;throw"WcRessourcesColor can not provide CopyPasteConsumer, wcList is null."}getWcList(){if(this.shadowRoot){const e=this.shadowRoot.querySelector("wc-list");if(e)return e}return null}static get styles(){return css`
              :host, :host * {
                 box-sizing: border-box;
              }
              :host  {
                width: 100%;
                height: 100%;
                display: block; 
                position: relative;
              }
              .grid {
                list-style: none;   
                padding: 0;
                margin: 0;
                display: grid;
                grid-template-columns: 20px  1fr;
                height: 100%;
                overflow: auto;
                grid-auto-rows: 24px;
                justify-content: flex-start;    
             }
              
             .colorBox {
                width: 16px;
                height: 16px;
                border: 1px var(--printess-textColorDisabled);
             } 
             .colorName {
                font-size: 12px;
                color: var(--printess-textColor);
             }    
        `}render(){return html`
          
           ${new WcList(this.context,this.colors.getCollection())}
        `}openNamedColorDialog(e){if("readonly"===e.access)beep();else{new WcDialogColor(e,!0,(e=>{console_log("New Color Received.")})).showDialog()}}assignColorToSelection(e){scope().selection.setPrimaryColorValue(e)}showSelectionColors(e){const t=this.getWcList(),o=new Set;if(t)if(e&&e.length>0){for(const t of e)for(const e of t.box.getAllColorIDs())o.add(e);t.selectItems(o)}else t.clearSelection()}}customElements.define("wc-resources-colors",WcResourcesColors);var __decorate$M=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n},__awaiter$L=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};let WcPages=(()=>{let e=class extends LitElement{constructor(){super(...arguments),this.isInPageCaptionEdit=null,this.drag=!1,this.moveHandler=this.mousemove.bind(this),this.upHandler=this.mouseup.bind(this)}getCopyPasteConsumer(){return this}firstUpdated(){this.selectSpread(scope().docUi.currentSpread.id)}static get styles(){return css`
            :host, :host * {
                box-sizing: border-box;
            }
            :host  {
                width: 100%;
                height: 100%;
                position: relative;
            }

            .doc  {
                display: flex;
                flex-direction: row;
                justify-content: center;
                
                /* pretty new cool feature */ 
                width: -webkit-fill-available;
                width: -webkit-fit-content;
                width: fit-content;
           }
            
         
            .spread-size{ 
                position: relative;
                cursor: pointer;
                display: flex;
                pointer-events: auto;
            } 
            .spread-size.selected .page {
              border: 1px solid var(--printess-headlineColor);
               /*  background-color: rgba(181,232,255,0.5) !important;*/
            }
            @keyframes bounceOut {
              0% {
                transform: scale(1.0);
                opacity: 1;
              }
            
              100% {
                transform: scale(0.1);
                opacity: 0;
              }
            }
            .spread-size.fade-out .page {
                  animation: bounceOut 500ms; 
            }
            @keyframes bounceIn {
              0% {
                transform: scale(0.1);
                opacity: 0;
              }
            
              100% {
                transform: scale(1);
                opacity: 1;
              }
            }
            .spread-size.fade-in .page {
                 animation: bounceIn 500ms;  
            }
            .spread-spacer {
                width: 15px;
                height: 100%; 
                flex-shrink: 0;
               
                pointer-events: auto;
                
            }
            .spread-spacer.over {
                background-color: lightblue;
            }
            
            .page {
                border: 1px black solid;
                
                /*background: rgba(255,255,255,255); */
            
              /*  box-shadow: rgba(0,0,0,0.4) 2px 2px;*/
                pointer-events: none;
                display: flex;
                align-items: flex-end;
                justify-content: center;
               /* padding-bottom: 5px; */
                color: var(--printess-textColor);
                font-size: var(--printess-textSize);
                position: relative;
               
                background-size: cover;
                background-repeat: no-repeat;
                                
            }
            .page > .spread-name.editable {
              pointer-events: auto;
              cursor: text;
              /*background-color: rgba(255, 255, 255, 0.6);*/
              padding: 0px;
              position: absolute;
              bottom: -22px;
              color: black;
              white-space: nowrap;
              pointer-events: none;
            }
            .page > .spread-name.double {
              position: absolute;
              left: 100%;
              transform: translateX(-50%);
              z-index: 1;
            }
            
            .context-button {
              position: absolute;
              right: -18px;
              width: 16px; 
              height: 16px;
              top: 0px;
              display: none;
            }

            .page.left {
                    border-right-color: #ddd;
            }
            .page.right {
              border-left-color: #ddd;
            }
            
             
            .spread-size > .page > .ico-minus {
                left: 3px;
            }
             .spread-size > .page > .ico-copy {
                right: 3px;
            }
            .spread-size.selected > .page >  .context-button {
                display: block;
                pointer-events: auto;
            }
            
            .spread {
                position: absolute;
                background: rgba(255,255,255,.08);
                border: 1px solid rgba(255,255,255,0.3);
            }
            
 
            @media screen and (min-width:  ${config.mobileDeviceWidth+1}px){
                /*desktop*/
               .doc.admin {
                    width: 100%;
                    position: relative;
                    pointer-events: none; 
                    display: grid; 
                    grid-row-gap: 0;
               }
               .doc.buyer {
                    padding-top: 20px;
                    width: 100%;
                    overflow: auto;
                }
               .doc.buyer .context-button {
                    display: none !important;
                }
               .doc.admin > .spread-spacer {
                    width: 100%;
                    height: 30px;
               }
               .doc.buyer .spread-name {
                 padding: 3px;
               }
               
            }
        `}render(){return config.isMobile&&1===this.doc.spreads.size&&scope().selection.allows("allowAdd","artwork")?html`
        <div style="display: flex; flex-direction: row;">
            Insert Layout-Snippet Ui (here?)
        </div>
        `:html`
          
            ${this.doc?html`<div class="doc ${config.isBuyer?"buyer":"admin"}" >
                    <div class="spread-spacer"  data-after="start"></div>
                    ${Array.from(this.doc.spreads.values()).map(((e,t)=>html`
                        
                             <div class="spread-size" data-spread-id="${e.id}" style="${e.spreadThumbnailPositionCss(this.getScaleFactor())}"
                             @mousedown=${t=>this.mousedown(t,e)}> 
                                ${e.pages.map(((o,i)=>html`
                                   <div class="page ${this.getPageClass(e,i)} " 
                                    style="background-color: ${this.doc.docBackgroundColor.toCssColor()}; ${this.getPageSizeCss(e,o,this.getScaleFactor())}">
                                       <div class="spread-name ${this.canEditPageName(e)?"editable":""} ${this.isDoublePageWithNameClass(e)}"  @mousedown=${()=>this.spreadNameClick(e)}>
                                          ${this.getPageCaption(e,t,i)}
                                          
                                        </div>
                                        <wc-icon class="context-button" icon="carret-down-solid"   primaryColor="medium" 
                                        ></wc-icon>
                                       
                                    </div>   
                               `))}     
                            </div>    
                            <div class="spread-spacer"  data-after="${e.id}"></div>
                        
            `))}
                    
                    </div>`:""} 
         
        `}updated(){if(!config.isAutomationMode&&scope().fontsLoaded)for(const e of this.doc.spreads.values())this.doc.getThumbnailUrls(e.id).then((t=>{var o;if(t&&this.shadowRoot)for(let i=0;i<t.length;i++){const r=null===(o=this.shadowRoot.querySelector("[data-spread-id="+e.id+"]"))||void 0===o?void 0:o.children[i];r&&(r.style.backgroundImage="url("+t[i]+")")}})).catch((e=>{console.error("Spread-Thumbnail generation failed: See console line above. ["+e+"]")}))}canEditPageName(e){return!config.isBuyer&&!config.isMobile}isDoublePageWithNameClass(e){return e.pages.length>1&&e.name?" double":""}spreadNameClick(e){if(this.canEditPageName(e)){const t=window.prompt("Page name",e.name);if(null!==t){const o=(new Nobs).setProperty(e,"name",t||""),i=scope().currentDoc,r=new Doc(o,i);update([i.serialize(scope().id)],[r.serialize(scope().id)]).then((()=>{console_log("done")}))}}}getPageCaption(e,t,o){const i=Math.max(t*(this.doc.facingPages?2:1)+o+(this.doc.facingPages?0:1),1).toString();return 1===e.pages.length?e.name||i:e.name?0===o?e.name:"":i}getPageClass(e,t){return 1===e.pages.length?"single":0===t?"left":"right"}getScaleFactor(){const e=scope().currentDoc.pageHeight;let t=scope().currentDoc.pageWidth;scope().currentDoc.facingPages&&(t*=2);let o=150/t;return o*e>80&&(o=80/e),o}getPageSizeCss(e,t,o=1){return"width:"+t.width.value*o+"px;height:"+t.height.value*o+"px"}mousedown(e,t){t&&(scope().copyPasteConsumer=this,this.startX=e.clientX,this.startY=e.clientY,this.targetDiv=e.target,"WC-ICON"===this.targetDiv.tagName?(document.addEventListener("mouseup",this.upHandler),scope().clearSelection()):(e.shiftKey?this.selectSpread(t.id,this.isSpreadSelected(t)?"remove":"add"):(this.isSpreadSelected(t)||this.selectSpread(t.id,"select"),document.addEventListener("mouseup",this.upHandler),document.addEventListener("mousemove",this.moveHandler)),scope().clearSelectionAndAllEditors(t)))}isDragging(){return!(this.sprite&&this.sprite.parentNode)}mousemove(e){if(e.preventDefault(),e.cancelBubble=!0,!this.drag&&(Math.abs(this.startY-e.clientY)>10||Math.abs(this.startX-e.clientX)>10))this.sprite=this.targetDiv.cloneNode(!1),this.sprite.style.position="absolute",this.sprite.style.outline="1px solid black",this.sprite.style.backgroundColor="rgba(255,255,255,0.6)",this.sprite.style.pointerEvents="none",document.body.appendChild(this.sprite),this.drag=!0;else if(this.drag&&(this.sprite.style.left=e.clientX+"px",this.sprite.style.top=e.clientY+"px",this.shadowRoot)){const t=this.shadowRoot.elementFromPoint(e.clientX,e.clientY);t&&t.classList&&t.classList.contains("spread-spacer")?t!==this.spacer&&(this.spacer&&this.spacer.classList.remove("over"),t.classList.add("over"),this.spacer=t):this.spacer&&(this.spacer.classList.remove("over"),this.spacer=void 0)}}mouseup(e){var t;if(e.preventDefault(),e.cancelBubble=!0,document.removeEventListener("mousemove",this.moveHandler),document.removeEventListener("mouseup",this.upHandler),this.drag)this.sprite&&this.sprite.parentNode&&this.sprite.parentNode.removeChild(this.sprite),this.drag=!1,this.spacer&&(this.spacer.classList.remove("over"),this.reOrderSpread(this.spacer.dataset.after));else if("WC-ICON"===this.targetDiv.tagName){const o=null===(t=this.getSelectedSpreads()[0])||void 0===t?void 0:t.id;o&&showCtxMenu(e,this.getContextMenuBySpreadId(o))}else{const e=this.targetDiv.dataset.spreadId;e&&(scope().docUi.setCurrentSpreadById(e,!0),scope().docUi.centerSpreadInView())}}selectSpread(e,t="select"){if(this.shadowRoot)for(const o of this.shadowRoot.querySelectorAll(".spread-size")){const i=o;if(i.dataset.spreadId===e)if("remove"===t){for(const e of i.children)e.style.backgroundColor=this.doc.docBackgroundColor.toCssColor();i.classList.remove("selected")}else{i.classList.add("selected");for(const e of i.children)e.style.backgroundColor=this.doc.docBackgroundColor.toSelectedCssColor()}else if("select"===t){for(const e of i.children)e.style.backgroundColor=this.doc.docBackgroundColor.toCssColor();i.classList.remove("selected")}}}isSpreadSelected(e){return this.getSelectedSpreads().indexOf(e)>=0}getSelectedSpreads(){const e=[],t=scope().currentDoc;return this.shadowRoot&&this.shadowRoot.querySelectorAll(".spread-size.selected").forEach((o=>{const i=o.dataset.spreadId;if(i){const o=t.spreads.get(i);o&&e.push(o)}})),e}selectAll(){if(this.shadowRoot)for(const e of this.shadowRoot.querySelectorAll(".spread-size")){const t=e;t.classList.add("selected");for(const e of t.children)e.style.backgroundColor=this.doc.docBackgroundColor.toSelectedCssColor()}return!0}clearSelection(){if(this.shadowRoot)for(const e of this.shadowRoot.querySelectorAll(".spread-size")){const t=e;t.classList.remove("selected");for(const e of t.children)e.style.backgroundColor=this.doc.docBackgroundColor.toCssColor()}}removeItem(){return new Promise((e=>{scope().pagesUi.removeSpread(),e(!0)}))}canCreateItem(){return!0}createItem(){return new Promise((e=>{this.addSpread(),e(!0)}))}getContextName(){return"PageBar"}getClipboardData(){const e=this.getSelectedSpreads(),t=scope().currentDoc.id;if(e.length>0){const o=[];for(const i of e)o.push(i.serialize(t,!0,!0,!0));return{context:"PageBar",objects:o,scopeId:scope().id}}return null}setClipboardData(e){const t=scope().currentDoc,o=this.getSelectedSpreads(),i=[],r=new Map,s=new Nobs;if(0===e.objects.length)return!1;for(const n of e.objects){const e=generateDBID();if(n.boxes){for(const o of n.boxes){const s=o.data;if(s.story&&s.story.story)if("none"!==s.story.rep&&scope().getStory(s.story.sId))alert("auto flow");else{const e=new Story(generateDBID(),s.story.story);r.set(s.story.sId,e.serialize()),s.story.sId=e.id}const n=new Box(boxTypeE.rect,scope().docUi.currentLayerId,void 0,o);i.push({serializedBox:n.serialize(e,t.id),spreadId:e})}delete n.boxes;const a=new Spread(t,e,n);s.addToCollection(t.spreads,a,void 0,o.length>0?o[o.length-1]:void 0)}}const n=new Doc(s,t);return update([t.serialize(scope().id)],[n.serialize(scope().id)]).then((()=>{const e=[];for(const t of i)e.push(t.serializedBox);create([...Array.from(r.values()),...e],void 0,!0).then((()=>{let e=null;this.clearSelection();for(const o of i)this.selectSpread(o.spreadId,"add"),e||(e=t.spreads.get(o.spreadId)||null);i.length>0&&(scope().docUi.setCurrentSpreadById(i[i.length-1].spreadId),scope().docUi.centerSpreadInView(),this.fadeInSpread()),scope().currentDoc.facingPages?this.toFacingPages(!0):this.toSinglePages(!0),e||(e=t.spreads.values().next().value||null),scope().clearSelectionAndAllEditors(e)}))})),!0}reOrderSpread(e){const t=scope().currentDoc;let o=t;const i=t.spreads.get(e),r=Array.from(t.spreads.values()),s=this.getSelectedSpreads();if(s.length){const e=new Nobs;for(const t of s)i?e.reOrderInsideCollection(o.spreads,t,void 0,i):e.reOrderInsideCollection(o.spreads,t,r[0],void 0);o=new Doc(e,o),update([t.serialize(scope().id)],[o.serialize(scope().id)]).then((()=>{t.facingPages&&this.toFacingPages(!0),scope().docUi.setCurrentSpreadById(s[0].id),scope().docUi.centerSpreadInView(),this.fadeInSpread()}))}}addSpread(){scope().isRecording&&scope().e2e.record({module:"WcPages",func:"addSpread",args:[]});const e=scope().currentDoc;let t=scope().docUi.currentSpread;const o=Array.from(e.spreads.values()),i=o[o.length-1],r=new Nobs;let s;e.facingPages?t===i?(o.length>1&&r.addToCollection(i.pages,new BoxGeometry(e.pageWidth,0,e.pageWidth,e.pageHeight)),s=new Spread(e,void 0,void 0,1),t=void 0):s=new Spread(e,void 0,void 0,2):s=new Spread(e,void 0,void 0,1),r.addToCollection(e.spreads,s,void 0,t);const n=new Doc(r,e);update([e.serialize(scope().id)],[n.serialize(scope().id)]).then((()=>{scope().docUi.setCurrentSpreadById(s.id),scope().docUi.centerSpreadInView(),this.fadeInSpread()}))}removeSpread(){this.getSelectedSpreads().length>=scope().currentDoc.spreads.size?alert("Can't remove last spread"):(this.shadowRoot&&this.shadowRoot.querySelectorAll(".spread-size.selected").forEach((e=>{e&&e.classList.add("fade-out")})),setTimeout((()=>{this.removeSpreadInternal()}),300))}removeSpreadInternal(){return __awaiter$L(this,void 0,void 0,(function*(){const e=this.getSelectedSpreads().map((e=>e.id));scope().clearSelection();let t=[];for(const e of this.getSelectedSpreads())t=[...t,...e.boxesAsIStoreObjects()];yield remove(t);const o=scope().currentDoc;let i;const r=Array.from(o.spreads.values()),s=r[r.length-1],n=new Nobs;let a=0;if(e.length>0&&e.length<o.spreads.size){for(const t of e){const e=scope().currentDoc.spreads.get(t);e&&(n.removeObject(e),e===r[0]&&o.facingPages&&r[1].pages.length>1?n.removeObject(r[1].pages[1]):e===s&&o.facingPages&&r[r.length-2].pages.length>1&&n.removeObject(r[r.length-2].pages[1]),a=o.getSpreadIndex(t))}i=new Doc(n,o),update([o.serialize(scope().id)],[i.serialize(scope().id)],void 0,!0).then((()=>{if(this.shadowRoot){this.shadowRoot.querySelectorAll(".spread-size.fade-out").forEach((e=>{if(e){e.classList.remove("fade-out");for(const t of e.children)t.style.backgroundColor=this.doc.docBackgroundColor.toCssColor();e.classList.remove("selected")}}));const e=Array.from(scope().currentDoc.spreads.values());a>=e.length&&(a=e.length-1),scope().docUi.currentSpread=e[a]}}))}}))}fadeInSpread(){if(this.shadowRoot){const e=this.shadowRoot.querySelector(".spread-size.selected");e&&(e.classList.add("fade-in"),window.setTimeout((()=>e.classList.remove("fade-in")),600))}}toggleFacingPages(){scope().isRecording&&scope().e2e.record({module:"WcPages",func:"toggleFacingPages",args:[]});const e=scope().currentDoc,t=new Nobs;t.setProperty(e,"facingPages",!e.facingPages);const o=new Doc(t,e);update([e.serialize(scope().id)],[o.serialize(scope().id)]).then((()=>{scope().currentDoc.facingPages?this.toFacingPages(!0):this.toSinglePages(!0)}))}toFacingPages(e){return __awaiter$L(this,arguments,void 0,(function*(){scope().isRecording&&scope().e2e.record({module:"WcPages",func:"toFacingPages",args:Array.from(arguments)});const t=scope().currentDoc;let o=t;const i=Array.from(t.spreads.values());let r=!1;const s=new Nobs;for(let e=0;e<i.length;e++){const o=i[e];0===e||e===i.length-1?o.pages.length>1&&(s.removeObject(o.pages[1]),r=!0):o.pages.length<2&&(s.addToCollection(o.pages,new BoxGeometry(t.pageWidth,0,t.pageWidth,t.pageHeight)),r=!0);for(const e of o.pages)e.width.value!==t.pageWidth&&(s.setProperty(e,"width",new Length(t.pageWidth,"px")),r=!0),e.height.value!==t.pageHeight&&(s.setProperty(e,"height",new Length(t.pageHeight,"px")),r=!0)}r&&(o=new Doc(s,t),yield update([t.serialize(scope().id)],[o.serialize(scope().id)],void 0,e))}))}toSinglePages(e){return __awaiter$L(this,arguments,void 0,(function*(){scope().isRecording&&scope().e2e.record({module:"WcPages",func:"toSinglePages",args:Array.from(arguments)});const t=scope().currentDoc;let o=t;const i=Array.from(t.spreads.values());let r=!1;const s=new Nobs;for(let e=0;e<i.length;e++){const o=i[e];o.pages.length>1&&(s.removeObject(o.pages[1]),r=!0);for(const e of o.pages)e.width.value!==t.pageWidth&&(s.setProperty(e,"width",new Length(t.pageWidth,"px")),r=!0),e.height.value!==t.pageHeight&&(s.setProperty(e,"height",new Length(t.pageHeight,"px")),r=!0)}r&&(o=new Doc(s,t),yield update([t.serialize(scope().id)],[o.serialize(scope().id)],void 0,e))}))}getContextMenu(e,t,o){if(this.shadowRoot){const e=this.shadowRoot.elementFromPoint(t,o);if(scope().copyPasteConsumer=this,e&&e.classList.contains("spread-size")){const t=e.dataset.spreadId;if(t)return this.getContextMenuBySpreadId(t)}}return null}getContextMenuBySpreadId(e){return e?[{caption:"Add",icon:"plus-square",callback:()=>{this.addSpread()}},{caption:"Duplicate",icon:"copy",callback:()=>{const e=this.getClipboardData();e&&this.setClipboardData(e)}},{caption:"Delete",icon:"trash",callback:()=>{this.removeSpread()}},{caption:"-"},{caption:"Copy",callback:()=>{clipboardCopy(!1)}},{caption:"Paste",callback:()=>{clipboardPaste(!1)}},{caption:"-"},{caption:"Change Name",callback:()=>{this.getSelectedSpreads().length>0&&this.spreadNameClick(this.getSelectedSpreads()[0])}}]:null}};return __decorate$M([property({attribute:!1,type:Object})],e.prototype,"doc",void 0),__decorate$M([property({attribute:!1,type:Object})],e.prototype,"isInPageCaptionEdit",void 0),e=__decorate$M([customElement("wc-pages")],e),e})();var __awaiter$M=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};const styles=[{title:"Empty",className:"my-style",code:[".STYLENAME {","","}"]},{title:"Shape Fill Color - Controlled by Form-Field",className:"color",fieldName:"color",code:[".STYLENAME {","\tfillColor: ${form.FIELDNAME};","}"],field:{t:"string",v:"#FF0000",vs:"buyer",ui:"select-list",lst:[{k:"#FF0000",l:"Red"},{k:"#00FF00",l:"Green"},{k:"#0000FF",l:"Blue"}]}},{title:"Single Line Text - Controlled by Form-Field",className:"single-text",fieldName:"singleText",code:[".STYLENAME {","\ttext: ${form.FIELDNAME};","}"],field:{t:"string",v:"#FF0000",vs:"buyer",ui:"textbox"}},{title:"Sub-Document Page Name - Controlled by Form-Field",className:"page",fieldName:"page",code:[".STYLENAME {","\tspreadName: ${form.FIELDNAME};","}"],field:{t:"string",v:"#FF0000",vs:"buyer",ui:"select-list",lst:[{k:"Page Name 1",l:"Please enter the name of your first Sub-Document Page"},{k:"Page Name 2",l:"Please enter the name of your second Sub-Document Page"},{k:"Page Name 3",l:"Please enter the name of your third Sub-Document Page"}]}},{title:"Drop Shadow Effect - Controlled by Form-Field",className:"drop-shadow",fieldName:"dropShadow",code:[".STYLENAME {",'\tdropActive: ${form.FIELDNAME === "ON"};',"\tdropBlend:multiply;","\tdropBlurRadius: 5%;","\tdropSpreadRadius: 0%;","\tdropColor:[Black];","\tdropXoffset: 4%;","\tdropYoffset: 4%;","}"],field:{t:"string",v:"ON",vs:"buyer",ui:"select-list",lst:[{k:"ON"},{k:"OFF"}]}},{title:"Frame Position - Controlled by Form-Field",className:"position",fieldName:"position",code:[".STYLENAME {",'\tif: ${form.FIELDNAME === "top-left"};',"\tleft: 1cm;","\ttop: 1cm;","\twidth: 5cm;","\theight: 5cm;","}",".STYLENAME {",'\tif: ${form.FIELDNAME === "top-right"};',"\tright: 6cm;","\ttop: 1cm;","\twidth: 5cm;","\theight: 5cm;","}",".STYLENAME {",'\tif: ${form.FIELDNAME === "bottom-right"};',"\tright: 6cm;","\tbottom: 6cm;","\twidth: 5cm;","\theight: 5cm;","}",".STYLENAME {",'\tif: ${form.FIELDNAME === "bottom-left"};',"\tleft: 1cm;","\tbottom: 6cm;","\twidth: 5cm;","\theight: 5cm;","}"],field:{t:"string",v:"top-left",vs:"buyer",ui:"select-list",lst:[{k:"top-left",l:"Top Left"},{k:"top-right",l:"Top Right"},{k:"bottom-left",l:"Bottom Left"},{k:"bottom-right",l:"Bottom Right"}]}},{title:"On/Off Switchable Style - Controlled by Form-Field",className:"switch",fieldName:"switch",code:[".STYLENAME {",'\tif: ${form.FIELDNAME === "ON"};',"\t/* Every property is controlled by form.FIELDNAME */","\t/* Add more properties here ...                   */","}"],field:{t:"string",v:"ON",vs:"buyer",ui:"select-list",lst:[{k:"ON"},{k:"OFF"}]}},{title:"Show/Hide Frame - Controlled by Form-Field",className:"hide",fieldName:"hide",code:[".STYLENAME {",'\tvisible: ${form.FIELDNAME === "Show"};',"}"],field:{t:"string",v:"Show",vs:"buyer",ui:"select-list",lst:[{k:"Show"},{k:"Hide"}]}}];function addStyle(e,t,o,i){return __awaiter$M(this,void 0,void 0,(function*(){e=getValidClassName(e);const r=o.join("\n").replace(/STYLENAME/g,e).replace(/FIELDNAME/g,t);if("local"===scope().resourcesStylesUi.which){const e=scope().currentDoc.styleText+"\n"+r,t=new Nobs;t.setProperty(scope().currentDoc,"styleText",e);const o=new Doc(t,scope().currentDoc);return yield update([scope().currentDoc.serialize(scope().id)],[o.serialize(scope().id)],void 0,i),scope().resourcesUi.selectStyles("local"),!0}{const e=scope().resourcesStylesUi.getGlobalStyle().text+"\n"+r;return yield scope().resourcesStylesUi.onGlobalTextChange(e),scope().resourcesUi.selectStyles("global"),!0}}))}function addFormField(e,t){var o,i;return __awaiter$M(this,void 0,void 0,(function*(){const r=scope().currentDoc;if(t=JSON.parse(JSON.stringify(t).replace(/DUNIT/g,r.unit)),"local"===scope().resourcesStylesUi.which){if(!e||!scope().currentDoc.isValidFormFieldName(e))return alert("Invalid name! Either it contains illegal charracters or a Form Field with this name already exists.\n\nPlease use only chars and numbers."),!1;const s=new Map(r.formFields),n=null!==(i=null===(o=Array.from(s.values()).sort(((e,t)=>t.order-e.order))[0])||void 0===o?void 0:o.order)&&void 0!==i?i:.002;t.na=e,t.ca=e,t.id=generateDBID(),t.o="doc",t.or=getOrder(0,n);const a=new FormField("",t);s.set(e,a);const l=(new Nobs).replaceCollection(r.formFields,s),c=new Doc(l,r);yield update([r.serialize(scope().id)],[c.serialize(scope().id)])}else{if(!e||!scope().isValidFormFieldName(e))return alert("Invalid name! Either it contains illegal charracters or a Form Field with this name already exists.\n\nPlease use only chars and numbers."),!1;t.na=e,t.id=generateDBID(),t.o="scope",t.or=getOrder(0,scope().getLowestGlobaleFormFieldOrder());const o=new FormField("",t);yield create([o.serialize()]).then((()=>{scope().productMatrixUi.requestUpdate()}))}return!0}))}class WcDialogAddStyle extends LitElement{constructor(){super(),this.name="new-class",this.field="newField",this.backdrop=new WcBackdrop,this.selectedStyle=styles[0],this.nameError=this.validateClassName(),this.fieldError=this.validateFieldName()}static get properties(){return{name:{type:String},field:{type:String},selectedStyle:{type:Object},nameError:{type:String},fieldError:{type:String}}}showDialog(e){this.callback=e,this.selectedStyle=styles[0],document.body.appendChild(this.backdrop),document.body.appendChild(this)}closeDialog(e=!1){document.body.removeChild(this.backdrop),document.body.removeChild(this),this.callback&&this.callback(e)}ok(){return __awaiter$M(this,void 0,void 0,(function*(){let e=!1;this.selectedStyle.field&&(e=yield addFormField(this.field,this.selectedStyle.field),!e)||(this.selectedStyle.code&&(e=yield addStyle(this.name,this.field,this.selectedStyle.code,e)),this.closeDialog(e))}))}validateClassName(){const e=getValidClassName(this.name);if(!e)return"Style-Class Name can't be empty";if(e!==this.name)return"Style-Class Name is not valid.<br>should be ["+e+"]";if("local"===scope().resourcesStylesUi.which){if(scope().currentDoc.styleText.indexOf("."+e)>=0)return"Style-Class Name already exists in Document-Style."}else if(scope().resourcesStylesUi.getGlobalStyle().text.indexOf("."+e)>=0)return"Style-Class Name already exists in Template-Style.";return"OK"}validateFieldName(){const e="Invalid name. Please use only letters and numbers and start with a letter.";if("local"===scope().resourcesStylesUi.which){const t=scope().currentDoc;if(t.formFieldsByName.has(this.field))return"Form-Field ["+this.field+"] already exists in Document ["+t.name+"]";if(!this.field||!scope().currentDoc.isValidFormFieldName(this.field))return e}else{if(scope().hasGlobalFormField(this.field))return"Form-Field ["+this.field+"] already exists in Template";if(!this.field||!scope().isValidFormFieldName(this.field))return e}return"OK"}static get styles(){return[dialogStyles,css`
              

          .mode-combo {
            grid-area: mode;
          } 
          
          
          .content {
            width: 600px;
          } 

          .list  {
            width: 100%;
            height: 200px;
            overflow-y: scroll;
            background-color: transparent;
          }  
          .option {
            padding: 5px;
            width: 100%;
            margin-bottom: 5px;
            border: 1px solid gray;
            background-color: white;
            cursor: pointer;

          }
          .option.selected {
            background-color: var(--printess-headlineColor);
            color: white;
          }

          vaadin-text-field {
            width: 200px;
          }
          .error {
            color: red;
          }
          p {
            margin-top: 0;
            margin-bottom: 5px;
          }
           
        `]}render(){return html`
           
      <div class="content">
        
            
        <h1>Create new Style Class</h1>
        <p>
          Make every aspect of your Printess documents interactive with Styles and Form-Fields. Various templates will automatically create a Style-Class and a corresponding Form-Field.<br>
          To use the created Style-Class got to frame properties (ruler icon) and select the class at the "Frame-Style" option. A single frame can have multiple Style-Classes assigned.
        </p>
        <p>
          <strong>Important: </strong>You should create <strong>Text Styles</strong> directly from the multi-line text properties. 
        </p>
        <h3>
          1. Select a Style-Class Template:
        </h3>

        <div class="list">
          ${styles.map((e=>html`
            <div  @click=${()=>this.selectStyle(e)} class="option ${this.selectedStyle===e?"selected":""}" >${e.title}</div>
          `))}
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; min-height: 140px;">
          <div>
            ${this.selectedStyle.code?html`
              <h3 >
                2. Name the Style-Class. 
              </h3>

              <div >  
                  <vaadin-text-field label="Style-Class Name" value="${this.name}" 
                    @input=${e=>this.setName(e.target.value)}></vaadin-text-field>
              </div>
              ${"OK"!==this.nameError?html`<div class="error">${unsafeHTML(this.nameError)}</div>`:""}
            `:""}
          </div>
          
          <div>
            ${this.selectedStyle.field?html`
                <h3  >
                  3. Name the Form-Field.
                </h3>

                <div  >  
                    <vaadin-text-field label="Form-Field Name" value="${this.field}" 
                      @input=${e=>this.setField(e.target.value)}></vaadin-text-field>
                </div> 

                ${"OK"!==this.fieldError?html`<div class="error">${unsafeHTML(this.fieldError)}</div>`:""}
              </div>
            `:""}  

            

          </div>
        </div>
      </div>
        
    <div class="footer" >
      ${this.selectedStyle.code&&"OK"!==this.nameError||this.selectedStyle.field&&"OK"!==this.fieldError?"":html`
         <vaadin-button style="grid-column: 2" @click=${this.ok} theme="primary">OK</vaadin-button>
      `}
      <vaadin-button style="grid-column: 3" @click=${this.closeDialog} theme="secondary">CANCEL</vaadin-button>
    </div>
        
          
         
        `}setName(e){this.name=e,this.nameError=this.validateClassName()}setField(e){this.field=e,this.fieldError=this.validateFieldName()}selectStyle(e){this.selectedStyle=e,e.className&&this.setName(e.className),e.fieldName&&this.setField(e.fieldName)}}customElements.define("wc-dialog-add-style",WcDialogAddStyle);const styleSheetLanguage=getLanguage();let codeModeTexStyle=null;const codeModeFontSize=12,codeModeLineHeight=18;let _codeModeFont=null;class EddiConfig{constructor(e){this._textStyleProperties={},this._paragraphStyleProperties={},this._tabStop=30,this.wordBreakThreshold=.8,this.regexStyles=void 0,this.language="none",this.styleContext="none",this.name="eddi",this.onSelectionChangedCallback=null,this.onContentChangedCallback=null,this.getStyleProperty=null,this.getDocDimensions=null,this.changeFrameSize=void 0,this.zoom=()=>1,this.modelXToScreenX=e=>e,this.modelYToScreenY=e=>e,this.onOverflowChangeCallback=null,this.getFont=e}get codeModeFontSize(){return 12}get codeModeLineHeight(){return 18}get codeModeAscender(){return this.codeModeFont.font.ascender/100*12}get codeModeDescender(){return this.codeModeFont.font.descender/100*12}get codeModeFont(){return _codeModeFont||(_codeModeFont=new FontRef("[MONOSPACED]")),_codeModeFont}get textStyleProperties(){return this.codeMode?(codeModeTexStyle||(codeModeTexStyle={font:this.codeModeFont,fontSize:new Length(this.codeModeFontSize+"px"),lineHeight:new Length(this.codeModeLineHeight+"px")}),codeModeTexStyle):this._textStyleProperties}set textStyleProperties(e){this._textStyleProperties=e}get paragraphStyleProperties(){return this.codeMode?{horizontalTextAlign:"left"}:this._paragraphStyleProperties}set paragraphStyleProperties(e){this._paragraphStyleProperties=e}get tabStop(){return this.codeMode?17:this._tabStop}set tabStop(e){this._tabStop=e}getLanguageModel(){return this.language,styleSheetLanguage}get codeMode(){return"none"!==this.language}}var __awaiter$N=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};class WcResourcesStyles extends LitElement{constructor(){super(),this.which="global",this.globalEddi=void 0,this.localEddi=void 0,this.docStyleId="",this.globalStyle=Style.getNewGlobalStyle()}static get properties(){return{globalStyles:{type:Object},which:{type:String},doc:{type:Object}}}getCurrentEddi(){return"global"===this.which?this.globalEddi:this.localEddi}hasFocus(){const e=document.activeElement;return!(!e||"INPUT"!==e.tagName||e.name!==this.which+"StyleEditor")}globalStyleEditorActive(){return"global"===this.which&&this.hasFocus()}localStyleEditorActive(){return"local"===this.which&&this.hasFocus()}blur(){const e=this.localEddi;e&&e.blur();const t=this.globalEddi;t&&t.blur()}getCopyPasteConsumer(){return{getContextName:function(){return"Styles"},getClipboardData:function(){return null},setClipboardData:function(e,t){return!1},createItem:function(){return new Promise((e=>{(new WcDialogAddStyle).showDialog((t=>{e(t)}))}))},canCreateItem:()=>!0,removeItem:function(){return new Promise((e=>e(!1)))},selectAll:function(){return!1}}}getGlobalStyleText(){return this.getGlobalStyle().text}getGlobalStyle(){return this.globalStyle}globalStyleHasClass(e){for(const t of e.keys())if(this.getGlobalStyle().classNameLookUp.has(t))return!0;return!1}firstUpdated(){if(this.shadowRoot){const e=this.shadowRoot.getElementById("globalEditor");if(!e)throw"Can't load style editor, global editor div not found.";const t=this.getEddiConfig("global");t.onContentChangedCallback=e=>this.onGlobalTextChange(e);const o=this.getGlobalStyleText();this.globalEddi=new Eddi(t,o,[e],[null],[null],"edit"),this.globalEddi.render(),e.addEventListener("keydown",(e=>this.globalEddi?this.globalEddi.keyDown(e):"")),e.addEventListener("dblclick",(e=>this.globalEddi?this.globalEddi.doubleClick(e):""));for(const e of this.globalEddi.frames)e.svg.addEventListener("mousedown",(e=>this.globalEddi?this.globalEddi.mouseDown(e):""));this.addEventListener("focus",(()=>{this.globalEddi&&(scope().copyPasteConsumer=this.globalEddi)}));const i=this.shadowRoot.getElementById("localEditor");if(!i)throw"Can't load style editor, local editor div not found.";const r=this.getEddiConfig("local");r.onContentChangedCallback=e=>this.onLocalTextChange(e),this.localEddi=new Eddi(r,scope().currentDoc.styleText,[e],[null],[null],"edit",void 0,void 0,void 0,void 0,void 0,i),this.localEddi.render(),i.addEventListener("keydown",(e=>this.localEddi?this.localEddi.keyDown(e):"")),i.addEventListener("dblclick",(e=>this.localEddi?this.localEddi.doubleClick(e):""));for(const e of this.localEddi.frames)e.svg.addEventListener("mousedown",(e=>this.localEddi?this.localEddi.mouseDown(e):""));this.addEventListener("focus",(()=>{this.localEddi&&(scope().copyPasteConsumer=this.localEddi)}))}}getEddiConfig(e){const t=new EddiConfig((e=>({spaceWidth:26,ascender:106.900024,descender:29.299927,name:"Noto Sans",lineHeight:136.19995})));return t.textStyleProperties.fontSize=new Length(16,"px"),t.language="styleSheetLanguage",t.styleContext=e,t.name=e+"StyleEditor",t.styleFontExists=e=>!!scope().fonts_getByName(e),t.styleColorExists=e=>!!scope().colors.getSwatchByName(e),t.styleImageExists=e=>!!scope().images_getOrCreate(e),t}setLocalText(e){var t;null===(t=this.localEddi)||void 0===t||t.setText(e)}setGlobalText(e){var t;null===(t=this.globalEddi)||void 0===t||t.setText(e)}refreshGlobalStyleEddi(){var e;null===(e=this.globalEddi)||void 0===e||e.setText(this.getGlobalStyleText())}onGlobalTextChange(e){return __awaiter$N(this,void 0,void 0,(function*(){const t=this.getGlobalStyle();if(e!==t.text){const o={type:"style",data:{txt:t.text},scopeId:scope().id,parentId:scope().id,id:t.id},i={type:"style",data:{txt:e},scopeId:scope().id,parentId:scope().id,id:t.id};scope().updatesBeforeBlurActiveElementOnNewSelection=1,yield update([o],[i])}}))}onLocalTextChange(e){return __awaiter$N(this,void 0,void 0,(function*(){if(!this.curDoc)return;const t=this.doc.styleText;if(e!==t){const t=scope().docs.get(this.curDoc.id);if(!t)throw new Error("Can't save style document not found. id="+this.curDoc.id);{const o=new Nobs;o.setProperty(t,"styleText",e);const i=new Doc(o,t);yield update([t.serialize(scope().id)],[i.serialize(scope().id)])}}}))}static get styles(){return[eddiStyles,css`

            :host, :host * {
                box-sizing: border-box;
              
            }

            :host {

              width: 100%;
              display: grid;
               grid-template-rows: auto 1fr minmax(auto, 30%);
               height: 100%;
                

            }

            #globalEditor, #localEditor {
                position: relative;
                width: 100%;
                grid-row: 2;
                background-color: white;
            }

            .error {
                color: red;
                font-size: 12px;    
                 
                padding: 2px;
               /* border: 1px red solid;*/
                border-left: 15px solid red;
                padding-left: 5px;
                grid-row: 3;
                overflow: scroll;
            }
            .error > p {
                margin-top: 0;
            }
            .selector {
              display: grid;
              grid-template-columns: 1fr 1fr;
              width: 100%;
            }
            .selector > * {
               background-color: gray;
               color: white;
               padding: 5px;
               text-align: center;
               cursor: pointer;
               white-space: nowrap;
               grid-row: 1;
            }

            .selector > *:hover {
              background-color: var(--printess-headlineColorHover);
            }

            .selector > .selected {
              background-color: var(--printess-headlineColor);
            }

            .hide {
              display: none;
            }

        `]}render(){var e,t;"local"===this.which&&(null===(e=this.doc)||void 0===e?void 0:e.id)!==(null===(t=this.curDoc)||void 0===t?void 0:t.id)&&this.localEddi&&(this.curDoc=this.doc,this.localEddi.setText(this.doc.styleText,!0));let o=[];if("local"===this.which){o=this.doc.getStyleAndRedrawItemsWithClasses().errors}else o=this.getGlobalStyle().errors;return o.length>0?this.style.gridTemplateRows="auto 1fr minmax(100px, 20%)":this.style.gridTemplateRows="auto 1fr 0px",html`   
      <div class="selector"> 
      <div class="${"global"===this.which?"selected":""}" @click=${()=>this.toggleStyleByMouse("global")} >Template</div>
      <div class="${"local"===this.which?"selected":""}" @click=${()=>this.toggleStyleByMouse("local")}  >[${this.doc.shortName}]</div>

      </div>

      <div id="localEditor" class="${"local"!==this.which?"hide":""}"></div>  
      <div id="globalEditor" class="${"global"!==this.which?"hide":""}"></div>  
      ${o.length?html`<div class="error">${o.map((e=>html`<p>${e}</p>`))}</div>`:""}
    `}toggleStyle(e){this.which=e}toggleStyleByMouse(e){this.toggleStyle(e),e!==scope().resourcesFormFieldsUi.selected&&scopeIsInitialised()&&scope().resourcesFormFieldsUi.select(e)}}customElements.define("wc-resources-styles",WcResourcesStyles);var __decorate$N=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n};let WcResourcesImages=(()=>{let e=class extends LitElement{constructor(){super(),this.context={createItem:function(e){return(new WcUploadImagesDialog).showDialog((e=>{const t=scope().resourcesImagesUi.getWcList();t&&t.createItems(e)})),"completed"},canCreateItem:()=>!0,removeItems:function(e){return new Promise((t=>{remove(e.map((e=>e.serialize()))).then((()=>t(!0)))}))},mutateItem:(e,t)=>new Image$1(e,t),getName:function(){return"Images"},deserializeItem:function(e,t){return new Image$1(e||generateDBID(),t.data)},itemTemplate:e=>html`
        <div  style="display: grid;  grid-template-columns: 52px 1fr;" @click=${()=>this.assignImage(e)}  >
            <div style="width: 48px; height: 48px; background-size: cover; border: 1px solid var(--printess-textColorDisabled); background-color: #bbb; background-image: ${e.thumbNailCssUrl()};" ></div>
            <div style="font-size: 12px;" >${config.debug?e.name+" ("+e.order+")":e.name}</div>
        </div>
            `},this.images=new Map,this.wcList=new WcList(this.context,this.images)}get images(){return this._images}set images(e){if(this._images=e,this.wcList=new WcList(this.context,this.images),this.requestUpdate(),scope().selectionPropertiesUi){const e=scope().selection.spread;e&&(scope().selection=new Selection$1(scope().selection.getSelectedWcBoxes(),e))}}getCopyPasteConsumer(){const e=this.getWcList();if(e)return e;throw"WcRessourcesImage can not provide CopyPasteConsumer, wcList is null."}assignImage(e){scope().selection.assignImage(e)}getWcList(){return this.wcList}static get styles(){return css`
:host, :host * {
    box-sizing: border-box;
}
:host  {        
    width: 100%;
    height: 100%;
    display: block; 
    position: relative;
}
        `}render(){return html`${this.wcList}`}};return e=__decorate$N([customElement("wc-resources-images")],e),e})();class WcResourcesFonts extends LitElement{constructor(){super(),this.context={createItem:function(e){return new WcUploadFontsDialog("font").showDialog((e=>{const t=scope().resourcesFontsUi.getWcList();t&&t.createItems(e)})),"completed"},canCreateItem:()=>!0,removeItems:function(e){return new Promise((t=>{remove(e.filter((e=>-1===e.id.indexOf("DEFAULT"))).map((e=>e.serialize()))).then((()=>{t(!0)}))}))},mutateItem:(e,t)=>new Font(e,t),getName:function(){return"Fonts"},deserializeItem:function(e,t){return new Font(e||generateDBID(),t.data)},itemTemplate:e=>html`
            ${e.error?html`<wc-icon icon="warning" style="width: 20px; height: 20px" title="${e.error}" primaryColor="warning"></wc-icon>`:""}
            ${e.thumbSvgUrl?html`
              <image title="${e.name+"\n"+e.url}" style=" height: 22px;" src="${e.thumbSvgUrl}" @click=${()=>this.assignFont(e)}  />
            `:html`
              <div class="fontName"   
                style="font-size: 14px; font-family: ${e.cssName}; white-space: nowrap; width: calc(100% - 21px)"
                @click=${()=>this.assignFont(e)}  >${config.debug?e.name+" ("+e.order+")":e.name}</div>
            `}  
            
            `},this.fonts=new Map(getDefaultFonts().map((e=>[e.id,e]))),this.wcList=new WcList(this.context,this.fonts)}get fonts(){return this._fonts}set fonts(e){this._fonts=e,this.wcList=new WcList(this.context,this.fonts),this.requestUpdate(),scope().selectionPropertiesUi&&scope().selectionPropertiesUi.reloadFontLists()}static get properties(){return{fonts:{type:Object}}}getCopyPasteConsumer(){const e=this.getWcList();if(e)return e;throw"WcRessourcesFonts can not provide CopyPasteConsumer, wcList is null."}assignFont(e){if(scope().eddiActive())scope().eddiStyleSelectedContent({font:new FontRef(e)});else if(scope().selection){scope().isRecording&&scope().e2e.record({module:"WcRessourcesFonts",func:"assignFont",args:Array.from(arguments)});const t=[],o=[];for(const i of scope().selection.boxes.values()){const r=scope().getBox(i.box.id);if(!r)throw"Can't serialize box, boxRef is null";if(r.box.simpleText||r.box.pathText){const i=new Nobs;r.box.simpleText&&i.setProperty(r.box.simpleText,"font",new FontRef(e.url)),r.box.pathText&&i.setProperty(r.box.pathText,"font",new FontRef(e.url));const s=new Box(i,r.box).serialize(r.spread.id,r.doc.id),n=r.box.serialize(r.spread.id,r.doc.id);t.push(s),o.push(n)}}t.length>0&&update(o,t)}}getWcList(){return this.wcList}static get styles(){return css`
:host, :host * {
    box-sizing: border-box;  
}
:host  {              
    width: 100%;
    height: 100%;        
    display: block;   
    position: relative;          
}`}render(){return html`${this.wcList}`}}customElements.define("wc-resources-fonts",WcResourcesFonts);var __decorate$O=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n},__awaiter$O=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};let WcResourcesTextStyles=(()=>{let e=class extends LitElement{getCopyPasteConsumer(){return{getContextName:function(){return"TextStyles"},getClipboardData:function(){return null},setClipboardData:function(e,t){return!1},createItem:function(){return new Promise((e=>e(!1)))},canCreateItem:()=>!1,removeItem:function(){return new Promise((e=>e(!1)))},selectAll:function(){return!1}}}static get styles(){return css`

            :host, :host * {
                box-sizing: border-box;

            }

            :host {
                width: 100%;
                height: 100%;
                position: relative;

            }
            ul {
                list-style: none;
                width: 100%;
                padding: 0;
                margin: 0;
            }
            li {
                width: 100%;
                padding: 4px;
                background-color: rgba(255,255,255,0.2);
                border: 1px solid  rgba(0,0,0,0.2);
                margin: 3px;
                cursor: pointer;
            }
            li:hover {
                background-color: rgba(255,255,255,1);
                border: 1px solid  rgba(0,0,0,0.7);
            }
        `}render(){return html`      
<ul>
    ${this.getTextStyles().map((e=>html`<li style="${e.previewCss}" @click=${()=>this.addText(e)}>${e.caption}</li>`))}
</ul>          
        `}getTextStyles(){const e=[];if(scope())for(const t of scope().styles_all)for(const o of t.getTextStyles())e.push(o);return e}addText(e){return __awaiter$O(this,void 0,void 0,(function*(){yield scope().createNewBox("auto",boxTypeE.story,void 0,e.className),scope().selectionPropertiesUi.selectedTool="story"}))}};return e=__decorate$O([customElement("wc-resources-text-styles")],e),e})();var __awaiter$P=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};class WcDialogSaveSnippets extends LitElement{constructor(){super(),this.uploadProgress=-1,this.running=!1,this.savePromise=null,this.backdrop=new WcBackdrop}showDialog(){document.body.appendChild(this.backdrop),document.body.appendChild(this)}closeDialog(){this.backdrop.parentElement&&(document.body.removeChild(this.backdrop),document.body.removeChild(this))}static get properties(){return{uploadProgress:{type:Number},running:{type:Boolean}}}static get styles(){return[dialogStyles,css`

          .content {
             height: 450px;
          }
          .image-upload .progress {
              width: 250px; 
              border: 1px solid black; 
              height: 22px;
          }
          .image-upload-progress > div {
              background: var(--printess-headlineColor); 
              height: 100%; 
              color: var(--printess-headlineColorInverse);
              text-align: center;
              padding: 2px;
              margin-top: 10px;
          }

          wc-icon {
            width: 24px;
            height: 24px;
          }

          .tags {
            display: flex;
            flex-wrap: wrap;
            margin-top: 4px;
            margin-bottom: 4px;
          }
          .tag {
              background-color: rgb(94, 124, 170);
              border-radius: 3px;
              color: white;
              display: inline-block;
              margin-bottom: 7px;
              margin-right: 7px;
              padding: 2px 25px 2px 5px;
              pointer-events: none;
              position: relative;
            }
            
            .snippet-list {
              height: 300px;
              overflow: auto;
              border: 1px solid var(--printess-textColor);
            }
            .list-item {
              display: grid;
              grid-template-columns: 30px 30px 1fr;
              grid-template-rows: 17px auto;
              align-items: center;
            }


          .save-info {
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            align-items: center;
            margin-left: 20px;
          }
          .publish-info {
            display: flex;
            flex-direction: row;
            align-items: center;
            margin-bottom: 10px;
          }
          .publish-info > p {
            font-size: 16px;
          }
          .user-bubble {
              background-color: var(--printess-headlineColor);
              width: 28px;
              height: 28px;
              line-height: 28px;
              text-align: center;
              color: white;   
              border-radius: 50%;
              font-size: 16px;
              
            }
            
        `]}get snippetDocs(){return Array.from(scope().docs.values()).filter((e=>e.isGroupSnippet||e.isLayoutSnippet)).sort(((e,t)=>t.name.localeCompare(e.name)))}saveInfoIcons(){const e=scope().template,t=scope().templateOwner;return e&&e&&e.userId!=scope().myUserId&&t?html`
          <div class="save-info">
               <div class="user-bubble" style="margin-right: 10px;" title="${t.name}">${t.initials}</div>
               <wc-icon icon="arrow-right" primaryColor="headline" style="width: 20px; height: 20px"></wc-icon>
               <div class="user-bubble" style="margin-left: 10px;" title="${config.user.initials}">${config.user.initials}</div>
          </div>
         
        `:html``}render(){return html`
          <div class="content">
          
            <div style="display: flex; flex-direction: row;" >
             
              <h1 style="padding-bottom: 10px; border-bottom: 1px solid white; margin-right: 15px;">Publish Snippets</h1>
              ${this.saveInfoIcons()}
            </div>
            <div class="snippet-list">
            ${this.snippetDocs.map((e=>html`
              <div class="list-item"> 

                ${e.isLayoutSnippet?html`<wc-icon style="grid-row: 1/3" primaryColor="headline" icon="layout-snippet"></wc-icon>`:html`<div style="grid-row: 1/3" ></div>`}
                ${e.isGroupSnippet?html`<wc-icon style="grid-row: 1/3" primaryColor="headline" icon="group-snippet"></wc-icon>`:html`<div style="grid-row: 1/3" ></div>`}
                 
                <h4 style="grid-column: 3; margin: 0;">${e.name}</h4>

                <div class="tags" style="grid-column: 3;">
                  ${e.snippetExportTags.map((e=>html`<span class="tag">${e} </span>`))}
                </div>
                
              </div>    
            `))}
            </div>

            ${this.uploadProgress>=0&&this.uploadProgress<=1?html`
              <div class="image-upload-progress" >
                <div style="width: ${100*this.uploadProgress}%">${Math.round(1e4*this.uploadProgress)/100+"%"}</div>
              </div>
            `:""} 
              
          </div>
        </div>
        
         <div class="footer" >
            <vaadin-button ?disabled="${this.running}" style="grid-column: 2" @click=${this.publishSnippets} theme="primary">Publish All Snippets</vaadin-button>
            <vaadin-button ?disabled="${this.running}" style="grid-column: 3" @click=${this.closeDialog} theme="secondary">Cancel</vaadin-button>
         </div>
        
          
         
        `}publishSnippets(){return __awaiter$P(this,void 0,void 0,(function*(){this.running=!0,clearTagsCache(),yield hb.Printess.renderAllSnippets(scope().serializeAll(!0),this.changeProgress.bind(this)),scope().resourcesSnippetsUi.reload(),this.running=!1}))}changeProgress(e){this.uploadProgress=e,1===e&&(this.running=!1,this.closeDialog())}}customElements.define("wc-dialog-save-snippets",WcDialogSaveSnippets);var __decorate$P=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n},__awaiter$Q=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};let WcToolbar=(()=>{let e=class extends LitElement{constructor(){super(...arguments),this.iconColor="rgba(255,255,255,1.0)",this.iconHover="yellow",this.property=null,this.zoom=zoomFactor(),this.canDelete=!1,this.canUndo=!1,this.canRedo=!1,this.copyPasteContextName="Selection",this.pageIndex=0}static get styles(){return css`
          

            wc-icon {
                height: 18px;
                width: 18px;
                margin: 8px;
                cursor: pointer;
            }
            .spacer {
              width: 10px;
            }
            .text {
                color: var(--printess-headToolbarColor);  
                line-height: 100%;
                font-size: 12px;
                padding-top: 10px;
            }
            .zoom {
                text-align: center;
            }
            .buyer-mode {
              text-align: center;
              line-height: 36px;
              cursor: pointer;
            }
            
            .template-name, .inner-template-name {
              display: flex;
              flex-direction: row;
              flex-wrap: nowrap;
              justify-content: center;
              align-items: center;
            }
            .inner-template-name {
              cursor: pointer;
            }

            .inner-template-name > .text {
              text-align: center;
              color: #eee;
              padding-top: 1px;
              font-size: 13px;
            }
            .inner-template-name:hover {
              background-color:  rgba(255,255,255,0.2);
            } 
            :host {
                box-sizing: border-box;
                height: 100%;
                overflow: hidden;
                display: grid;
                grid-template-columns: auto  1fr auto 1fr auto;
                grid-template-rows: 52px;
                border-bottom: 1px solid var(--printess-headToolbarBorderColor);          
                background-color: var(--printess-headToolbarBackgroundColor);
            }
            .toggle-preview {
              cursor: pointer;
              padding: 4px;
              border: 1px solid white;
              width: fit-content;
              height: fit-content;
              align-self: center;
              justify-self: center;
              color: white;
            }
            @media (min-width:  ${config.mobileDeviceWidth+1}px) {
              :host {
                grid-template-rows: 36px;
                grid-template-columns: auto   1fr    36px  10px      36px    minmax(31px,auto)  36px   10px   36px   10px   36px;
                /*grid-template-areas:  "starticons  context center buyer  empt3   zoomOut zoom  zoomIn empty4  gear  empty5 user";*/
              }
            }
            @media (max-width:  ${config.mobileDeviceWidth}px) {
              wc-icon {
                width: 24px;
                height: 24px;
              }
              .icons {
                padding-top: 5px;
              }
              
            }

            .icons {
              display: flex;
              flex-wrap: nowrap;
              flex-direction: row;
            }
            .mobile-pages {
                padding-top: 5px;
                display: flex;
                flex-wrap: nowrap;
                flex-direction: row;
                line-height: 18px;
                justify-content: center;
                align-items: center;
              }
            .page-navigation {
              line-height: 19px;
              text-align: center;
              cursor: pointer;
            }
            /*.page-navigation:hover {
              background-color: rgba(0,0,0);
            }*/
            .user-bubble {
              background-color: var(--printess-headlineColor);
              width: 28px;
              height: 28px;
              line-height: 28px;
              text-align: center;
              color: white;   
              border-radius: 50%;
              font-size: 16px;
              
            }
        `}pageNumber(){const e=scope().currentDoc,t=scope().docUi.currentSpread;let o=0;for(const i of e.spreads.values()){if(i.id===t.id){i.pages.length>0?o=o+1+this.pageIndex:o+=i.pages.length;break}o+=i.pages.length}return o}maxPages(){const e=scope().currentDoc;let t=0;for(const o of e.spreads.values())t+=o.pages.length;return t}spreadIndex(){const e=scope().currentDoc,t=scope().docUi.currentSpread;return e.getSpreadIndex(t.id)}spreadCount(){return scope().currentDoc.spreads.size}isFirstPage(){return 0===this.spreadIndex()}isLastPage(){return this.spreadIndex()===this.spreadCount()-1}nextPage(){const e=this.spreadIndex(),t=scope().currentDoc,o=scope().docUi.currentSpread;if(e<this.spreadCount()-1)if(t.facingPages&&0===this.pageIndex&&o.pages.length>1)this.pageIndex=1,this.selectSpread(o.id,this.pageIndex);else{const o=Array.from(t.spreads.values())[e+1];this.pageIndex=0,o&&this.selectSpread(o.id,this.pageIndex)}}previousPage(){const e=this.spreadIndex(),t=scope().currentDoc,o=scope().docUi.currentSpread;if(this.spreadIndex()>0)if(1===this.pageIndex)this.pageIndex=0,this.selectSpread(o.id,this.pageIndex);else{const o=Array.from(t.spreads.values())[e-1];this.pageIndex=o.pages.length>1?1:0,o&&this.selectSpread(o.id,this.pageIndex)}}selectSpread(e,t){e&&(setZoomAnimationFlag(!0),scope().docUi.setCurrentSpreadById(e,!0),scope().docUi.centerSpreadInView(t?"right-page":"left-page"),this.requestUpdate())}canGoToBasket(){return!0}render(){var e,t;const o=null!==(t=null===(e=this.property)||void 0===e?void 0:e.textStyle)&&void 0!==t?t:null;return config.isMobile?html`
        <div class="icons">
          <div class="spacer">  </div>
          <wc-icon primaryColor="head-toolbar" style="${this.canUndo?"":"opacity: 0.5;"}" title="Undo"  icon="undo-solid" @click=${()=>undo()}> </wc-icon>
          <wc-icon primaryColor="head-toolbar" style="${this.canRedo?"":"opacity: 0.5;"}" title="Redo"  icon="redo-solid" @click=${()=>redo()}> </wc-icon>
        
          ${this.canDelete?html`<div class="spacer"></div><wc-icon primaryColor="head-toolbar" title="Duplicate" icon="copy-solid" @click=${()=>this.duplicate()}> </wc-icon>`:""}
          ${this.canDelete?html`<wc-icon primaryColor="head-toolbar" title="Delete"  icon="trash-solid" @click=${()=>this.remove()}> </wc-icon>`:""}       
        </div>
        <div></div>
        <div class="mobile-pages">
          <wc-icon primaryColor="head-toolbar" style="${this.isFirstPage()?"opacity: 0.5;":""}" title="Undo"  icon="arrow-left" @click=${()=>this.previousPage()}> </wc-icon>
          <div class="page-navigation"
                @click=${()=>this.selectSpread(scope().docUi.currentSpread.id,this.pageIndex)}>
            Page<br>
            ${this.pageNumber()} of ${this.maxPages()}
          </div>
          <wc-icon primaryColor="head-toolbar" style="${this.isLastPage()?"opacity: 0.5;":""}" title="Redo"  icon="arrow-right" @click=${()=>this.nextPage()}> </wc-icon>
        </div>
        <div></div>
        <div  class="icons" style="padding-top: 2px;">
          ${this.hasPreview()&&scope().currentDoc.isPreview?html`
              <wc-icon primaryColor="head-toolbar" style="width: 28px; height: 28px;}" title="Show Layout"  icon="pen" @click=${()=>this.togglePreview()}> </wc-icon>
          `:""}
          ${this.hasPreview()&&!scope().currentDoc.isPreview?html`
              <wc-icon primaryColor="head-toolbar" style="width: 32px; height: 32px;}" title="Show Preview"  icon="warp-mug" @click=${()=>this.togglePreview()}> </wc-icon>
          `:""}
          <wc-icon primaryColor="head-toolbar" style="width: 32px; height: 32px; ${this.canGoToBasket()?"":"opacity: 0.5;"}" title="Put to Basket"  icon="shopping-cart-add" @click=${()=>this.open("new")}> </wc-icon>
          <div class="spacer">  </div>
        </div>
      `:html`    
      <div class="icons">
        ${config.isBuyer?"":html`<div class="spacer"></div><wc-icon primaryColor="head-toolbar" icon="folder-open-solid" @click=${e=>this.save(e)}> </wc-icon>`}
          
        <div class="spacer">  </div>
        <wc-icon primaryColor="head-toolbar" style="${this.canUndo?"":"opacity: 0.5;"}" title="Undo"  icon="undo-solid" @click=${()=>undo()}> </wc-icon>
        <wc-icon primaryColor="head-toolbar" style="${this.canRedo?"":"opacity: 0.5;"}" title="Redo"  icon="redo-solid" @click=${()=>redo()}> </wc-icon>
      
        ${this.canDelete?html`<div class="spacer"></div><wc-icon primaryColor="head-toolbar" title="Duplicate" icon="copy-solid" @click=${()=>this.duplicate()}> </wc-icon>`:""}
        ${this.canDelete?html`<wc-icon primaryColor="head-toolbar" title="Delete"  icon="trash-solid" @click=${()=>this.remove()}> </wc-icon>`:""}       
      
        ${config.isBuyer?"":html`<div style="font-size: 9px; margin-left: 10px;">${this.copyPasteContextName}</div>`}
     </div>

      ${config.isBuyer?scope().eddiActive()&&o?html`
          <wc-external-text-toolbar type="eddi-toolbar"  propertyId="ED_selection" .textAllows=${o.allows} font="${o.font}" size="${o.size}" vAlign="${o.vAlign}" hAlign="${o.hAlign}" color="${o.color}"></wc-external-text-toolbar>
        `:html`
          ${this.hasPreview()?html`<div class="toggle-preview" @click=${()=>this.togglePreview()}>${scope().currentDoc.isPreview?"Change Design":"Show Preview"}</div>`:html`<div></div>`}
        `:html`
        <div class="template-name">
          ${this.getTemplateName()}
         <!-- <wc-icon primaryColor="head-toolbar" icon="folder-open-solid" @click=${()=>this.open()}> </wc-icon>  -->
        </div> 
      `}
      
      ${config.buyerOnly?html`<div></div>`:html`
        <wc-icon title="Toggle Buyer Side (B)" primaryColor="${config.isBuyer,"head-toolbar"}"  icon="${config.isBuyer?"shopping-cart-solid":"shopping-cart"}" @click=${()=>this.toggleBuyerSide()}> </wc-icon>
      `}
      <div></div>
     
     
      <wc-icon primaryColor="head-toolbar"   icon="search-minus" @click=${()=>this.zoomOut()}> </wc-icon>
      <div class="text zoom" @mousedown=${e=>this.zoomClick(e)}>${Math.round(100*this.zoom)}%</div>
      <wc-icon primaryColor="head-toolbar"  icon="search-plus" @click=${()=>this.zoomIn()}> </wc-icon> 
  
     <div></div>
      ${config.isBuyer||config.isMobile?html`<div></div>`:html`<wc-icon primaryColor="head-toolbar" @mousedown=${e=>this.cogClick(e)} icon="cog"> </wc-icon>`}
      <div></div>
      ${config.isBuyer||config.isMobile?html`<div></div>`:html`<wc-icon primaryColor="head-toolbar" @mousedown=${e=>this.userClick(e)} icon="user-solid"> </wc-icon>`}
`}hasPreview(){for(const e of scope().docs.values())if(e.isPreview)return!0;return!1}togglePreview(){if(scope().currentDoc.isPreview){for(const e of scope().docs.values())if(e.isPrimary)return void scope().selectDocAsync(e,!0,0)}else for(const e of scope().docs.values())if(e.isPreview)return void scope().selectDocAsync(e,!0,0)}getTemplateName(){let e="new"===scope().id?"[Unsaved Template]":scope().id,t=!1;scope().id.endsWith("~published")&&(e=e.replace("~published",""),t=!0);let o=scope().templateOwner;return o&&o.userId===scope().myUserId&&(o=null),html`
      <div class="inner-template-name"  @click=${e=>this.save(e)}>
        ${o?html`
          <div class="user-bubble" style="margin-right: 10px;" title="${o.name}">${o.initials}</div>
        `:""}
        ${t?html`
         <wc-icon title= "Published Version!"  icon="shopping-cart-solid" primaryColor="headline"  ></wc-icon>
        `:""}
        <div class="text" style="padding-right: 10px;">${e}</div>
        <wc-icon primaryColor="head-toolbar" icon="cloud-upload-alt"> </wc-icon>  
      </div>
    `}logout(){window.firebase.auth().signOut().then((()=>{localStorage.removeItem("printess:jwt"),window.location.reload()}))}zoomIn(){setCenterZoom(1.1*zoomFactor())}zoomOut(){setCenterZoom(zoomFactor()/1.1)}save(e){var t,o,i,r,s,n;const a=Array.from(scope().docs.values()).map((e=>e.isGroupSnippet||e.isLayoutSnippet?1:0)).reduce(((e,t)=>e+t),0);showCtxMenu(e,[{caption:"New Template",callback:()=>{this.open("new")}},{caption:"-"},{icon:"folder-open-solid",caption:"Open Template",callback:()=>{this.open()}},{caption:"-"},{icon:"cloud-upload-alt",disabled:!(null===(t=scope().template)||void 0===t?void 0:t.isWritable)||scope().isPublished,caption:"Save",callback:()=>{const e=new WcDialogSave;"new"===scope().id?e.showSaveAsDialog():e.showAndSaveAndClose()}},{caption:"Save As",callback:()=>{(new WcDialogSave).showSaveAsDialog()}},{caption:"-"},{disabled:!((null===(o=scope().template)||void 0===o?void 0:o.isPublishable)&&scope().myUserId===(null===(i=scope().template)||void 0===i?void 0:i.userId)),icon:"shopping-cart-solid",caption:scope().isPublished?"Re-Publish":"Publish",callback:()=>{(new WcDialogSave).showPublishDialog()}},{disabled:!(scope().isPublished&&"new"!==scope().id&&(null===(r=scope().template)||void 0===r?void 0:r.isWritable)&&scope().myUserId===(null===(s=scope().template)||void 0===s?void 0:s.userId)),icon:"cloud-upload-alt",caption:"Overwrite Draft",callback:()=>{var e;if("ok"===(null===(e=prompt("Do you really want to overwrite the original (draft) version with this published version? Write 'ok' to overwrite.","No"))||void 0===e?void 0:e.toLowerCase())){(new WcDialogSave).showAndSaveAndClose()}}},{caption:"-"},{disabled:0===a||scope().myUserId!==(null===(n=scope().template)||void 0===n?void 0:n.userId),icon:"group-snippet",caption:"Publish "+a+" Snippets",callback:()=>{(new WcDialogSaveSnippets).showDialog()}}])}open(e){(new WcDialogOpen).showDialog(e)}toggleExpertMode(){return __awaiter$Q(this,void 0,void 0,(function*(){scope().clearSelection(),"rookie"===scope().buyerSideMode?scope().buyerSideMode="expert":scope().buyerSideMode="rookie",this.requestUpdate()}))}toggleBuyerSide(e=!1,t=!0){return __awaiter$Q(this,void 0,void 0,(function*(){if(config.buyerOnly)return void beep();const o=Array.from(scope().selection.boxes.values()).filter((e=>e.box.lock.hasFrameAllows(e.box))).map((e=>e.box.id));if(0===o.length){const e=scope().selection.getSingleSelection();e&&e.box.lock.hasFrameAllows(e.box)&&o.push(e.box.id)}config.isBuyer=!config.isBuyer||e,scope().LayoutSnippetBarFirstTimeShown=!1,scope().clearSelection(),buyerSideOriginalValueCache.clear();const i=document.getElementById("mainGrid");if(i&&!config.hideControls&&(i.classList.remove(config.isBuyer?"admin":"buyer"),i.classList.add(config.isBuyer?"buyer":"admin")),setMainMobileGridRows(),setPanelColumns(),yield this.requestUpdate(),yield scope().docSelectorUI.requestUpdate(),yield scope().layoutSnippetsBarUi.redraw(),yield scope().resourcesUi.requestUpdate(),config.isBuyer){const e=document.getElementById("buyerPages");e&&(scope().pagesUi.doc=scope().currentDoc,e.appendChild(scope().pagesUi),yield scope().pagesUi.requestUpdate())}else yield scope().resourcesUi.requestUpdate(),yield scope().pagesUi.requestUpdate();config.isBuyer||scope().selectionPropertiesUi.selectTool("lock"),scope().currentDoc.spreads.forEach((e=>e.boxOrderHasChanged=!0)),scope().docUi.resetCache=!0,yield scope().docUi.requestUpdate(),yield scope().selectionPropertiesUi.requestUpdate();const r=scope().selectionPropertiesUi.getWcExternalSidebar();r&&(yield r.requestUpdate()),scope().selectionDocUi.requestUpdate(),scope().selectionDocUi.requestUpdate(),scope().selectionDocUi.requestUpdate(),optainBuyerOverlays(),scope().currentDoc.isGroupSnippet&&window.setTimeout((()=>{scope().selectAll()}),200),t&&window.setTimeout((()=>{scope().docUi.centerSpreadInView()}),100)}))}zoomClick(e){showCtxMenu(e,[{caption:"30%",callback:()=>setCenterZoom(.3)},{caption:"50%",callback:()=>setCenterZoom(.5)},{caption:"100%",callback:()=>setCenterZoom(1),bold:!0},{caption:"125%",callback:()=>setCenterZoom(1.25)},{caption:"150%",callback:()=>setCenterZoom(1.5)},{caption:"200%",callback:()=>setCenterZoom(2)}])}userClick(e){showCtxMenu(e,[{caption:config.user.displayName,disabled:!0},{caption:"-"},{caption:"Log out",callback:()=>{this.logout()}}])}cogClick(e){showCtxMenu(e,[{icon:scope().templateProperties.showSmartGuides?"check":void 0,caption:"Show Smart Guides",callback:()=>{scope().templateProperties.toggleSmartGuides()}},{icon:scope().templateProperties.showGrid?"check":void 0,caption:"Show Grid Lines [G]",callback:()=>{scope().docUi.showGrid(!scope().templateProperties.showGrid)}},{caption:"Grid Gap-Size ("+scope().templateProperties.gridSize+")",disabled:!scope().templateProperties.showGrid,sub:enums.gridSize.map((e=>({caption:e,icon:scope().templateProperties.gridSize===e?"check":void 0,callback:()=>{scope().templateProperties.setGridSize(e)}})))},{caption:"-"},{icon:scope().templateProperties.dataPanelHeight>0?"check":void 0,caption:"Show Layer Matrix [D]",callback:()=>{scope().templateProperties.toggleDataPanel()}},{caption:"-"},{icon:scope().templateProperties.showStyleBadges?"check":void 0,caption:"Show Styles [S]",callback:()=>{scope().templateProperties.toggleStyleBadges()}},{caption:"-"},{icon:scope().templateProperties.includeGlobalSnippets?"check":void 0,caption:"Search in Global Snippets",callback:()=>{scope().templateProperties.toggleIncludeGlobalSnippets()}},{icon:scope().templateProperties.includeTemplateSnippets?"check":void 0,disabled:!scope().hasTemplateSnippets(),caption:"List Template Snippets",callback:()=>{scope().templateProperties.toggleIncludeTemplateSnippets()}},{caption:"-"},{icon:scope().templateProperties.showDocumentSizeFormField?"check":void 0,caption:"Show Document Size Form Field",callback:()=>{scope().templateProperties.toggleShowDocumentSize()}}],0,0,250)}remove(){scope().removeItem()||beep()}duplicate(){if(scope().selection){const e=scope().getClipboardData();e&&scope().setClipboardData(e,!1)}}};return __decorate$P([property({attribute:!1,type:Object})],e.prototype,"property",void 0),__decorate$P([property({type:Number})],e.prototype,"zoom",void 0),__decorate$P([property({type:Boolean})],e.prototype,"canDelete",void 0),__decorate$P([property({type:Boolean})],e.prototype,"canUndo",void 0),__decorate$P([property({type:Boolean})],e.prototype,"canRedo",void 0),__decorate$P([property({type:String})],e.prototype,"copyPasteContextName",void 0),e=__decorate$P([customElement("wc-toolbar")],e),e})();var __decorate$Q=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n};let WcResourcesMacros=(()=>{let e=class extends LitElement{constructor(){super(...arguments),this.macros=new Map,this.allTestsRunning=!1,this.runAllTestsCount=0}getCopyPasteConsumer(){return{getContextName:function(){return"TextStyles"},getClipboardData:function(){return null},setClipboardData:function(e,t){return!1},createItem:function(){return new Promise((e=>{let t=prompt("Macro name:","");if(t)return t.startsWith("e2e")&&(t=t+"["+scope().id+"]"),scope().resourcesMacrosUi.macros.set(t,new Macro(t)),scope().e2e.startRecording(t),saveMacroList(),scope().resourcesMacrosUi.requestUpdate(),void e(!0);e(!1)}))},canCreateItem:()=>!1,removeItem:function(){return new Promise((e=>{saveMacroList(),e(!1)}))},selectAll:function(){return!1}}}static get styles(){return css`

            :host, :host * {
                box-sizing: border-box;

            }

            :host {
                width: 100%;
                height: 100%;
                display: block; 
                position: relative;

            }
            ul {
                list-style: none;
                width: 100%;
                padding: 0;
                margin: 0;
            }
            li {
                width: 100%;
                padding: 4px;
                margin: 3px;
                cursor: pointer;
                display: grid;
                grid-template-columns: 18px 2px  1fr 3px 18px 3px 18px;
                border-left: 2px solid transparent;
                align-items: center;
            }
            li:hover {
                background-color: var(--printess-panelBackgroundHover);
               
            }

            li > .hide {
                display: none;
            }
            li:hover > .hide {
                display: block;
            }

            .recording-hint {
                color: red;
                font-size: 12px;
                padding: 10px;
                border: 2px dotted red;
            }

            li > .name {
                font-size: var(--printess-inputSize);
                overflow-wrap: break-word;
                color: var(--printess-textColor);
                min-width: 0;
            }

            wc-icon {
                width: 18px;
                height: 18px;
            }
        `}render(){return html` 
${scope().isRecording?html`
    <div  @click="${()=>this.stopRecording()}"  class="recording-hint">
        <h5 style="color: red">Stop Recording</h5>
        <p>CTRL+SHIFT+"R"</p>
    </div>
`:""}     
<ul>
    ${this.sortedMacros.map((e=>html`   
           
    <li @click="${t=>this.itemClick(t,e)}" 
         style="${"running"===e.state?"border-left: 2px solid var(--printess-headlineColor);":""}${e.active?"":"opacity: 0.5;"}">
        
         ${e.isTest?html`
            <wc-icon  data-action="active" primaryColor="${e.iconColor}" icon="${e.icon}"></wc-icon>
            <div></div>
            <div class="name">${e.caption+" ["+e.scopeId+"]"}</div>
         `:html`
            <div style="grid-column-start: 1; grid-column-end: 4;" class="name">${e.name}</div>
         `}
       
        <div></div>
        <wc-icon class="hide"  icon="record" primaryColor="red"></wc-icon>
        <div></div>
        <wc-icon class="hide"   icon="trash" primaryColor="green"></wc-icon>
    </li>`))}
</ul>          
        `}get sortedMacros(){return Array.from(this.macros.values()).sort(((e,t)=>{let o,i;return o=(null==e?void 0:e.isTest)?" "+e:e,i=t.isTest?" "+t:t,o<i?-1:o>i?1:0}))}itemClick(e,t){var o,i,r;if(scope().isRecording||scope().isReplaying)return scope().isRecording&&alert("Please stop recording first"),void(scope().isReplaying&&alert("Please wait until curretn macro replay finishes"));"record"===(null===(o=e.target)||void 0===o?void 0:o.icon)?scope().e2e.startRecording(t.name):"trash"===(null===(i=e.target)||void 0===i?void 0:i.icon)?(scope().resourcesMacrosUi.macros.delete(t.name),saveMacroList(),this.requestUpdate()):"active"===(null===(r=e.target)||void 0===r?void 0:r.dataset.action)?(t.active=!t.active,saveMacroList(),this.requestUpdate()):t.isTest?(t.state="running",this.requestUpdate(),loadScope(t.scopeId,t.name)):scope().e2e.playMacro(t.name)}stopRecording(){scope().e2e.isRecording&&scope().e2e.stopRecording()}runAllTests(e){if(!this.allTestsRunning){this.allTestsRunning=!0,e&&e>0&&(this.runAllTestsCount=e),this.runAllTestsCount--;for(const e of this.macros.values())e.state="";this.runNextTest()}}runNextTest(){if(this.allTestsRunning){for(const e of this.macros.values())if(""===e.state&&e.isTest&&e.active)return e.state="running",this.requestUpdate(),void loadScope(e.scopeId,e.name);this.allTestsRunning=!1,this.runAllTestsCount>0&&(console_log("Remaining Test Runs: "+this.runAllTestsCount),this.runAllTests())}}};return __decorate$Q([property({attribute:!1})],e.prototype,"macros",void 0),e=__decorate$Q([customElement("wc-resources-macros")],e),e})();var __decorate$R=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n},__awaiter$R=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};let WcLayers=(()=>{let e=class extends LitElement{constructor(){super(...arguments),this.currentLayerId="BASELAYER",this.drag=!1,this.dragStarting=!1,this.moveHandler=this.mousemove.bind(this),this.upHandler=this.mouseup.bind(this),this.mouseDownLayerId="",this.mouseDownItemId=""}get layers(){return Array.from(scope().currentDoc.layers.values())}get lastlayer(){const e=Array.from(scope().currentDoc.layers.values());return e[e.length-1]}getCopyPasteConsumer(){return scope()}createLayer(e){scope().isRecording&&scope().e2e.record({module:"WcLayers",func:"createLayer",args:[e]});const t=scope().currentDoc,o=new Nobs;e||(e="Layer "+t.layers.size);const i=t.layers.size%Layer.colors.length,r=new Layer(generateDBID(),{na:e,co:Layer.colors[i]}),s=new Map(scope().currentDoc.layers);s.set(r.id,r),o.setProperty(t,"layers",s);const n=new Doc(o,t);update([t.serialize(scope().id)],[n.serialize(scope().id)]).then((()=>{console_log("Layer created")}))}static get styles(){return css`
 
:host, :host * {
    box-sizing: border-box;
}
:host  {   
    width: 100%;
    height: 100%;       
    position: relative;   
    display: block; 

}
.list { 
    width: 100%;
    position: relative;
    pointer-events: none;
        
    display: grid;
    justify-content: stretch;
    grid-row-gap: 0;   
    
}

.indicator {
  border-left: 3px solid black;
}

.indicator.group-start {

  margin-bottom: -5px;
  border-top: 2px solid black;
}
.indicator.group-end {
  
  margin-top: -5px;
  border-bottom: 2px solid black;
}
.indicator.group-middle {
  
  margin-top: -5px;
  margin-bottom: -5px;
}
.item{
        
    position: relative;
    cursor: pointer;
    pointer-events: auto;

    font-size: var(--printess-labelSize);
    
    width: 100%;
    display: grid;
    grid-template-columns: 18px 18px 10px 1fr;
    grid-template-rows: 20px;
    align-items: center;
    
} 
.item > .caption {
  
  padding-left: 2px;
  pointer-events: none;
  white-space: nowrap;
  display: flex;
  width: 100%;
  height: 100%;
  align-items: center;
  justify-content: flex-start;
}
.item b {
  color: var(--printess-maxContrastColor);
}

 
.item.over + .spacer-design {
  background-color: lightblue;
}
 
.item.selected > .caption {
    background-color: var(--printess-panelBackgroundSelected);  /*rgba(181,232,255,0.61) !important;*/     
}
/*.item:hover > .caption{
  background-color: var(--printess-panelBackgroundHover);
}
.item.selected:hover > .caption{
  background-color: var(--printess-panelBackgroundSelectedHover);
}*/
.item.locked:hover > .caption{
  background-color: transparent;
}
.item.locked > .caption{
  background-color: transparent;
}
.item.locked {
  cursor: normal;
}

@keyframes bounceOut {
    0% {
        transform: scale(1.0);
        opacity: 1;
    }

    100% {
        transform: scale(0.1);
        opacity: 0;
    }
}
.item.fade-out .page {
        animation: bounceOut 500ms; 
}



@keyframes bounceIn {
    0% {
        transform: scale(0.1);
        opacity: 0;
    }

    100% {
        transform: scale(1);
        opacity: 1;
    }
}
.item.fade-in .page {
        animation: bounceIn 500ms;  
}

.spacer-design {
    width: 100%;
    height: 5px;
    pointer-events: auto;
}
.spacer-design.over {
    background-color: lightblue;
}
.end-spacer-design.over {
    border-top: 5px solid lightblue;
}
.layer {
    width: 100%;
    cursor: pointer;
    font-size: var(--printess-labelSize);
    height: auto;
    pointer-events: auto;
   /* border-top: 1px dotted gray;*/
    
    padding-top: 3px;
    padding-bottom: 2px;
  
    text-transform: uppercase;
    color: var(--printess-maxContrastColor);
   /* background-color: var(--printess-toolbarColor);
      padding: 5px;
    color: var(--printess-toolbarBackground);*/
    border-top: 2px dotted transparent;
    display: grid;
    grid-template-columns: 18px 18px 1fr 18px 18px 18px;
}
.layer > span {
  pointer-events: none;
  white-space: nowrap;
}
.layer > span.merged-artwork {
   color: red;
}
 
 
/*.layer:hover{
  background-color: var(--printess-panelBackgroundHover);
} */
.layer.selected  {
      background-color: var(--printess-panelBackgroundSelected);  /*rgba(181,232,255,0.61) !important;*/
}

 
.layer.over + .spacer-design {
  background-color: lightblue;
}
/*.layer.selected:hover{
  background-color: var(--printess-panelBackgroundSelectedHover);
}*/

wc-icon {
  width: 12px;
  height: 12px;
}
`}getBoxes(e){const t=scope().docUi.currentSpread.boxesByLayer(e,"top-down"),o=[];let i="";for(let e=0;e<t.length;e++){const r=t[e];let s="none";i!==r.boxGroupId&&r.boxGroupId?e<t.length-1&&t[e+1].boxGroupId===r.boxGroupId?(i=r.boxGroupId,s="group-start"):(i="",s="none"):s=r.boxGroupId?e<t.length-1&&t[e+1].boxGroupId===i?"group-middle":"group-end":"none",o.push({box:r,groupPos:s}),i=r.boxGroupId}return o}render(){return this.currentLayerId!==scope().docUi.currentLayerId&&(this.currentLayerId=scope().docUi.currentLayerId),html`
             
       <div class="list">
         
            ${Array.from(this.layers.values()).map((e=>html` 
              
              ${e.name?html`
                <div class="layer-spacer spacer-design"  data-before-layer="${e.id}"></div>  
                <div class="layer spacer layer-spacer  ${this.currentLayerId===e.id?"selected":""}"  data-after="start"  data-after-layer="${e.id}"  data-layer="${e.id}"   data-type="layer" data-item-id="${e.id}"
                  style="border-top-color: ${e.color};"
                  @mousedown=${t=>this.mousedown(t,e)} >

                
                  ${e.visible?html`
                    <wc-icon icon="eye-solid"  primaryColor="medium" 
                      @click=${()=>this.setLayerValue(e.id,"visible",!1)} ></wc-icon>
                  `:html`
                    <wc-icon icon="eye-solid"  primaryColor="light" 
                      @click=${()=>this.setLayerValue(e.id,"visible",!0)} ></wc-icon>
                  `}
                  ${e.lock?html`
                    <wc-icon icon="lock-closed-solid" style="width: 11px; height: 11px;"  primaryColor="medium" 
                      @click=${()=>this.setLayerValue(e.id,"lock",!1)} ></wc-icon>
                  `:html`
                    <wc-icon icon="lock-closed-solid" style="width: 11px; height: 11px;"  primaryColor="light" 
                      @click=${()=>this.setLayerValue(e.id,"lock",!0)} ></wc-icon>
                  `}

                 
                   
                    <span class="${e.mergedFromArtwork?"merged-artwork":""}">${e.name}</span>
                    ${e.buyer?html`
                      <wc-icon icon="shopping-cart-solid" style="width: 11px; height: 11px;"  primaryColor="medium" 
                        @click=${()=>this.setLayerValue(e.id,"buyer",!1)} ></wc-icon>
                    `:html`
                      <wc-icon icon="shopping-cart-solid" style="width: 11px; height: 11px;"  primaryColor="light" 
                        @click=${()=>this.setLayerValue(e.id,"buyer",!0)} ></wc-icon>
                    `}
                    ${e.print?html`
                      <wc-icon icon="print-solid" style="width: 11px; height: 11px;" primaryColor="medium" 
                        @click=${()=>this.setLayerValue(e.id,"print",!1)} ></wc-icon>
                    `:html`
                      <wc-icon icon="print-solid" style="width: 11px; height: 11px;" primaryColor="light" 
                        @click=${()=>this.setLayerValue(e.id,"print",!0)} ></wc-icon>
                    `}

                    <wc-icon icon="carret-down-solid" style="width: 11px; height: 11px;"  primaryColor="medium" 
                      @click=${t=>this.showLayerContextMenu(t,e.id)} ></wc-icon>
               
 
                  </div>
                <div class="spacer layer-spacer spacer-design" data-after="start" data-after-layer="${e.id}" data-layer="${e.id}"></div>  
              `:""}
              
              ${this.getBoxes(e.id).map((t=>html`    
                 
                  <div class="item spacer ${this.isItemSelected(t.box)?"selected":""} ${t.box.basics.lockBox||!t.box.basics.visible?"locked":""} " 
                        data-type="box" data-after="${t.box.id}" data-layer="${t.box.layerId}"
                        data-item-id="${t.box.id}" @mousedown=${e=>this.mousedown(e,t.box)}> 
                       
                        ${t.box.basics.visible?html`
                          <wc-icon icon="eye-solid"  primaryColor="medium" 
                            @click=${e=>this.setBoxValue(e,[t.box.id],"visible",!1)} ></wc-icon>
                        `:html`
                          <wc-icon icon="eye-solid"  primaryColor="light" 
                            @click=${e=>this.setBoxValue(e,[t.box.id],"visible",!0)} ></wc-icon>
                        `}
                        ${t.box.basics.lockBox?html`
                          <wc-icon icon="lock-closed-solid" style="width: 11px; height: 11px;"  primaryColor="medium" 
                            @click=${e=>this.setBoxValue(e,[t.box.id],"lockBox",!1)} ></wc-icon>
                        `:html`
                          <wc-icon icon="lock-closed-solid" style="width: 11px; height: 11px;"  primaryColor="light" 
                            @click=${e=>this.setBoxValue(e,[t.box.id],"lockBox",!0)} ></wc-icon>
                        `}
                       
                        <div class="indicator ${t.groupPos}"  style="align-self: stretch; border-color: ${e.color};"></div>
                        <div class="caption" style="${"layout"===t.box.snippetOrigin?"color: red":""}">${t.box.jsName?html`<b>${t.box.jsName}&nbsp</b>`:""}${t.box.getDescription()}</div>
                  </div>    
                  <div class="spacer spacer-design" data-after="${t.box.id}" data-layer="${t.box.layerId}"></div>             
              `))}

            `))}

           
          </div>
          <div class="layer-spacer end-spacer-design" data-after-layer="${this.lastlayer.id}"  style="height: 50px;"></div>
           
        `}setBoxValue(e,t,o,i){scope().isRecording&&scope().e2e.record({module:"WcLayers",func:"setBoxValue",args:Array.from(arguments)});const r=[],s=[];for(const e of t){const t=scope().getBox(e);if(!t)throw"Set Box Values   - BoxRef not found";const n=new Nobs;"order"===o?n.setProperty(t.box,"order",i):n.setProperty(t.box.basics,o,i);const a=new Box(n,t.box);r.push(t.box.serialize(t.spread.id,t.doc.id)),s.push(a.serialize(t.spread.id,t.doc.id))}s.length&&(scope().clearSelectionAndAllEditors(),update(r,s))}setLayerValue(e,t,o){return __awaiter$R(this,arguments,void 0,(function*(){scope().isRecording&&scope().e2e.record({module:"WcLayers",func:"setLayerValue",args:Array.from(arguments)});const i=scope().currentDoc,r=i.layers.get(e);if(i&&r){const e=new Nobs;e.setProperty(r,t,o);const s=new Doc(e,i);yield update([i.serialize(scope().id)],[s.serialize(scope().id)]),scope().clearSelectionAndAllEditors()}}))}setLayersVisibilities(e){return __awaiter$R(this,arguments,void 0,(function*(){scope().isRecording&&scope().e2e.record({module:"WcLayers",func:"setLayersVisibilities",args:Array.from(arguments)});for(const t of scope().docs.values()){let o=!1;const i=new Nobs;for(const r of t.layers.values()){const t=e.filter((e=>e.name===r.name))[0];t&&t.value!==r.visible&&(i.setProperty(r,"visible",t.value),o=!0)}if(o){const e=new Doc(i,t);yield update([t.serialize(scope().id)],[e.serialize(scope().id)]),t.id==scope().currentDoc.id?scope().clearSelectionAndAllEditors():scope().reRenderAllSubDocuments(e.name)}}}))}reOrderLayer(e,t,o){const i=scope().currentDoc,r=i.layers.get(e),s=i.layers.get(t);if(i&&r&&s){const e=new Map;for(const[t,n]of i.layers)n!==r&&(n===s?("before"===o&&e.set(r.id,r),e.set(t,n),"after"===o&&e.set(r.id,r)):e.set(t,n));const t=(new Nobs).replaceCollection(i.layers,e),n=new Doc(t,i);update([i.serialize(scope().id)],[n.serialize(scope().id)]),scope().clearSelection()}}mousedown(e,t){var o;e.preventDefault(),"WC-ICON"!==(null===(o=e.target)||void 0===o?void 0:o.tagName)&&(this.mouseDownLayerId="",this.mouseDownItemId="",t&&(t instanceof Box?this.mouseDownItemId=t.id:t instanceof Layer&&(this.mouseDownLayerId=t.id),scope().copyPasteConsumer=scope(),this.startX=e.clientX,this.startY=e.clientY,this.targetDiv=e.target,this.dragStarting=!1,document.addEventListener("mouseup",this.upHandler),document.addEventListener("mousemove",this.moveHandler)))}mousemove(e){if(e.preventDefault(),e.cancelBubble=!0,this.dragStarting||this.drag||!(Math.abs(this.startY-e.clientY)>10||Math.abs(this.startX-e.clientX)>10)){if(this.drag&&(this.sprite.style.left=e.clientX+"px",this.sprite.style.top=e.clientY+"px",this.shadowRoot)){const t=this.shadowRoot.elementFromPoint(e.clientX,e.clientY);this.mouseDownLayerId?t&&t.classList&&t.classList.contains("layer-spacer")?t!==this.spacer&&(this.spacer&&this.spacer.classList.remove("over"),t.dataset.beforeLayer!==this.mouseDownLayerId&&t.dataset.afterLayer!==this.mouseDownLayerId&&(t.classList.add("over"),this.spacer=t)):this.spacer&&(this.spacer.classList.remove("over"),this.spacer=void 0):t&&t.classList&&t.classList.contains("spacer")?t!==this.spacer&&(this.spacer&&this.spacer.classList.remove("over"),t.classList.add("over"),this.spacer=t):this.spacer&&(this.spacer.classList.remove("over"),this.spacer=void 0)}}else this.selectItemUnderMouse(e.shiftKey||scope().selection.isSelected(this.mouseDownItemId),!1),(this.mouseDownLayerId||scope().selection.boxes.size>0)&&(this.dragStarting=!0,window.setTimeout((()=>{this.sprite=this.createSprite(),document.body.appendChild(this.sprite),this.drag=!0}),50))}mouseup(e){if(e.preventDefault(),e.cancelBubble=!0,document.removeEventListener("mousemove",this.moveHandler),document.removeEventListener("mouseup",this.upHandler),this.drag)if(this.sprite&&this.sprite.parentNode&&this.sprite.parentNode.removeChild(this.sprite),this.drag=!1,this.mouseDownLayerId){if(this.spacer){this.spacer.classList.remove("over");let e="before",t="";this.spacer.dataset.beforeLayer?(t=this.spacer.dataset.beforeLayer,e="before"):this.spacer.dataset.afterLayer&&(t=this.spacer.dataset.afterLayer,e="after"),t&&this.reOrderLayer(this.mouseDownLayerId,t,e)}}else this.mouseDownItemId&&this.spacer&&(this.spacer.classList.remove("over"),scope().docUi.currentSpread.reOrderBox(this.spacer.dataset.layer,this.spacer.dataset.after));else this.selectItemUnderMouse(e.shiftKey,!0)}selectItemUnderMouse(e,t){return __awaiter$R(this,void 0,void 0,(function*(){if(this.mouseDownItemId){const o=scope().docUi.getWcBox(this.mouseDownItemId);o&&(e||(yield scope().clearSelectionAndAllEditors()),scope().addToSelection(o,t))}else this.mouseDownLayerId&&this.selectLayer(this.mouseDownLayerId)}))}getItemDiv(e){return this.shadowRoot?this.shadowRoot.querySelector('[data-item-id="'+e+'"]'):null}getLayerDiv(e){return this.shadowRoot?this.shadowRoot.querySelector('[data-layer-id="'+e+'"]'):null}selectLayer(e){scope().docUi.currentLayerId=e}isItemSelected(e){return e instanceof Box?scope().selection.isSelected(e.id):scope().docUi.currentLayerId===e.id}createSprite(){const e=document.createElement("div");if(e.style.position="absolute",e.style.pointerEvents="none",e.style.display="grid",e.style.gridRowGap="5px",e.style.justifyContent="center",e.style.minWidth="150px",this.shadowRoot)if(this.mouseDownLayerId){const t=this.shadowRoot.querySelector("[data-item-id='"+this.mouseDownLayerId+"'] > span");if(t){const o=t.cloneNode(!0);o.style.position="relative",o.style.display="flex",o.style.background="rgba(255,255,255,0.6)",o.style.border="1px solid rgba(255,255,255,0.3)",e.appendChild(o)}}else this.shadowRoot.querySelectorAll(".item.selected > .caption").forEach((t=>{const o=t.cloneNode(!0);o.style.position="relative",o.style.display="flex",o.style.background="rgba(255,255,255,0.6)",o.style.border="1px solid rgba(255,255,255,0.3)",e.appendChild(o)}));return e}selectAll(){scope().selectAll()}renameLayer(e){if("BASELAYER"===e)alert("You can't rename the base layer.");else{const t=scope().currentDoc.layers.get(e);if(t){const o=prompt("New Layer Name:",t.name);o&&this.setLayerValue(e,"name",o.toUpperCase())}}}_removeLayer(e,t=!1){return new Promise((o=>{const i=scope().currentDoc,r=i.layers.get(e);if(i&&r){const e=new Nobs;e.removeObject(r);const s=new Doc(e,i);scope().clearSelection(),update([i.serialize(scope().id)],[s.serialize(scope().id)],void 0,t).then((()=>{o(!0)}))}else o(!1)}))}removeLayer(e){return __awaiter$R(this,void 0,void 0,(function*(){return scope().isRecording&&scope().e2e.record({module:"WcLayers",func:"removeLayer",args:[e]}),new Promise((t=>{const o=scope().currentDoc.layers.get(e);o?"BASELAYER"===o.id?(alert("You can't delete the base layer"),t(!1)):(scope().selectAll(e),scope().selection.boxes.size?scope().removeItem().then((o=>{o?this._removeLayer(e,!0).then((e=>t(e))):(alert("Can't delete one or more frames on this layer."),t(!1))})):this._removeLayer(e).then((e=>t(e)))):(beep(),t(!1))}))}))}canRemoveLayer(){return scope().selection.canRemove()}removeFadeOut(e=0){e>0&&setTimeout((()=>{this.removeFadeOut(0)}),e),this.shadowRoot&&this.shadowRoot.querySelectorAll(".item.fade-out").forEach((e=>{e&&(e.classList.remove("fade-out"),e.classList.remove("selected"))}))}fadeInItem(){if(this.shadowRoot){const e=this.shadowRoot.querySelector(".item.selected");e&&(e.classList.add("fade-in"),setTimeout((()=>e.classList.remove("fade-in")),600))}}getContextMenu(e,t,o){if(this.shadowRoot){const e=this.shadowRoot.elementFromPoint(t,o);if(scope().copyPasteConsumer=scope(),e&&e.classList.contains("item")){const t=e.dataset.itemId;if(t){const e=scope().currentDoc.getBoxRef(t);return[{caption:"Delete",icon:"trash",callback:()=>{scope().removeItem()}},{caption:"Duplicate",icon:"copy",callback:()=>{const e=scope().getClipboardData();e&&scope().setClipboardData(e,!1)}},{caption:"-"},{caption:"From Layout Snippet",icon:e&&"layout"===e.box.snippetOrigin?"check-square":void 0,callback:()=>{if(1===scope().selection.boxes.size){const e=scope().currentDoc.getBoxRef(scope().selection.boxes.values().next().value.box.id);if(e){const t="layout"===e.box.snippetOrigin?"":"layout",o=(new Nobs).setProperty(e.box,"snippetOrigin",t),i=new Box(o,e.box);update([e.box.serialize(e.spread.id,e.doc.id)],[i.serialize(e.spread.id,e.doc.id)])}else alert("Frame not found.")}else alert("Please select a single frame.")}}]}}if(e&&e.classList.contains("layer"))return this.getLayerContextMenu(e.dataset.itemId||"")}return null}showLayerContextMenu(e,t){showCtxMenu(e,this.getLayerContextMenu(t))}getLayerContextMenu(e){const t=scope().currentDoc.layers.get(e);return t&&e?[{caption:"Select All Frames",callback:()=>{scope().selectAll(e)}},{caption:"Color",color:(null==t?void 0:t.color)||"",sub:Layer.colors.map((t=>({caption:"#21b7ff"===t?"light blue":t,callback:()=>{this.setLayerValue(e,"color",t)},color:t}))),callback:()=>{console_log("color list click")}},{caption:"Rename Layer",disabled:"BASELAYER"===e,callback:()=>{this.renameLayer(e)}},{caption:"Show as Form Field",disabled:"BASELAYER"===e,icon:t.visibilityFormField?"check-square":"square",callback:()=>{this.setLayerValue(e,"visibilityFormField",!t.visibilityFormField)}},{caption:"Delete",icon:"trash",disabled:"BASELAYER"===e,callback:()=>{this.removeLayer(e)}}]:null}};return __decorate$R([property({type:String})],e.prototype,"currentLayerId",void 0),e=__decorate$R([customElement("wc-layers")],e),e})();var __decorate$S=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n};let WcTable=(()=>{let e=class extends LitElement{constructor(){super(...arguments),this.columns=[],this.rows=[],this.callback=null,this.selectedRowIndex=0,this.size="small",this.lockRows=!1,this.sprite=this.createSprite(),this.drag=!1,this.dragTargetRowIndex=0,this.dragTargetPositon="above",this.moveHandler=this.mousemove.bind(this),this.upHandler=this.mouseup.bind(this),this.rowTops=[]}static get styles(){return css`
    :host {
      box-sizing: border-box;
      display: block;
      position: relative;
      background-color: white;
      
    }
    :host * {
      box-sizing: border-box;
    }

    .container {
      width: 100%;
      height: 100%;
      overflow: auto;
    }

    table {
      border-collapse: collapse;
      font-family: Arial, Helvetica, sans-serif;
      font-size: 13px;
      color: #333;
      padding: 0;
      margin: 0;
      width: 100%;
    }

    td {
      white-space: nowrap;
    }

    table,
    thead th,
    thead td {
      border: 1px solid lightgray;
      padding: 2px;
    }

    .row-grabber {
      background-color: white;
      width: 20px;
      cursor: grab;
    }

    wc-icon {
      width: 20px;
      height: 20px;
      padding: 4px;

    }

    tbody td {
      border: 1px solid lightgray;
      padding:0;
    }

    input,
    select{
      border: 0px solid white;
      padding:5px;
      
      width: calc(100% - 4px);
    }
    select {
      min-width: 100px;
    }

    input[type="checkbox"]   {
      min-height: 20px;
      min-width: 20px;
    } 
 
  .readonly {
    color: #888; 
    padding: 5px;
  }
    thead {
      border-bottom: 2px solid #aaa;
    }
 
    .right-border {
      border-right: 1px solid #444 !important;
    }
    .center {
      text-align: center;
    }
    .bold, .bold > input  {
      font-weight: bold;
    }

    td > input  {
      background-color: transparent;
    }
    
    .above  {
     border-top: 2px solid var(--printess-headlineColor);
    }
    .below {
     border-bottom: 2px solid var(--printess-headlineColor);
    }

    `}render(){var e,t;return html`
    <div class="container">
      <table id="listTable">
        <thead>
        ${this.lockRows?"":html`
          <th style="cursor: pointer" @click=${()=>this.addRow()}>  +</th>
        `}
          ${null===(e=this.columns)||void 0===e?void 0:e.map((e=>html`<th>${e.label||e.name}</th>`))}
          ${this.lockRows?"":html`
          <th></th>
        `}
        </thead>
        <tbody>
        ${null===(t=this.rows)||void 0===t?void 0:t.map(((e,t)=>html`<tr data-row="${t}">
            ${this.lockRows?"":html`
              <td class="row-grabber" @mousedown=${t=>this.mousedown(t,e)}>
              <svg style="width: 20px; height: 22px; align-self: center; fill: #999;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M384 128h85.333333v85.333333H384V128m170.666667 0h85.333333v85.333333h-85.333333V128M384 298.666667h85.333333v85.333333H384V298.666667m170.666667 0h85.333333v85.333333h-85.333333V298.666667m-170.666667 170.666666h85.333333v85.333334H384v-85.333334m170.666667 0h85.333333v85.333334h-85.333333v-85.333334m-170.666667 170.666667h85.333333v85.333333H384v-85.333333m170.666667 0h85.333333v85.333333h-85.333333v-85.333333m-170.666667 170.666667h85.333333v85.333333H384v-85.333333m170.666667 0h85.333333v85.333333h-85.333333v-85.333333z" fill="" /></svg>
              </td>
            `}
            ${e.values.map(((t,o)=>html`<td>${this.getCellContent(o,e)}</td>`))}
            ${this.lockRows?"":html`
              <td>
              <wc-icon primaryColor="medium" icon="trash-solid" @click=${()=>this.removeRow(e)}></wc-icon>
              </td>
              `}
            </tr>`))}
        </tbody>
      </table>
      
    </div>
`}getCellContent(e,t){const o=this.columns[e],i=t.values[e];if(o.readonly)return html`<span class="readonly" >${i}</span>`;if("image"===o.data){let o=scope().images.get(i||"");return o?html`<div style="width: 80px; height: 80px; cursor: pointer; display: inline-block; ${o.thumbNailCss()}" @click=${()=>this.pickImage(t,e)}></div>
        <wc-icon style="display: inline-block; cursor: pointer;" primaryColor="medium" icon="trash-solid" @click=${()=>this.cellValueChange(t,e,"")}></wc-icon>`:(o=Image$1.anyImage(),html`<div style="width: 24px; height: 24px; ${o.css()}" @click=${()=>this.pickImage(t,e)}></div>`)}return html`<input @change=${o=>o.target?this.cellValueChange(t,e,o.target.value):""} type="text" .value=${i} />`}pickImage(e,t){new WcSelectImageDialog("callback").showDialog((o=>{this.cellValueChange(e,t,o.id)}))}addRow(){const e=JSON.parse(JSON.stringify(this.rows));e.push({values:this.getNewValues()}),this.rows=e,this.callback&&this.callback(this.rows)}removeRow(e){const t=JSON.parse(JSON.stringify(this.rows.filter((t=>t!==e))));this.rows=t,this.callback&&this.callback(this.rows)}getNewValues(){const e=[];if(this.columns)for(let t=0;t<this.columns.length;t++)e.push("");return e}cellValueChange(e,t,o){if(e){e.values[t]=o;const i=JSON.parse(JSON.stringify(this.rows||[]));this.rows=i,this.callback&&this.rows&&this.callback(this.rows)}}createSprite(){const e=document.createElement("div");return e.style.position="absolute",e.style.pointerEvents="none",e.style.zIndex="9999",e.style.display="grid",e.style.gridRowGap="5px",e.style.justifyContent="center",e.style.minWidth="150px",e.style.height="15px",e.style.border="1px dotted #666",e}mousedown(e,t){if(document.activeElement!==document.body&&document.activeElement instanceof HTMLElement&&document.activeElement.blur(),e.preventDefault(),this.dragRow=t,this.sprite.innerText=t.values[0],this.startX=e.clientX,this.startY=e.clientY,document.addEventListener("mouseup",this.upHandler),document.addEventListener("mousemove",this.moveHandler),this.rowTops=[],this.shadowRoot){const e=this.shadowRoot.querySelectorAll("#listTable > tbody > tr");for(const t of e){const e=t.getBoundingClientRect();this.rowTops.push({top:Math.floor(e.top),tr:t})}}}mousemove(e){if(e.preventDefault(),e.cancelBubble=!0,!this.drag&&(Math.abs(this.startY-e.clientY)>10||Math.abs(this.startX-e.clientX)>10))document.body.appendChild(this.sprite),this.drag=!0;else if(this.drag){this.spacer&&(this.spacer.classList.remove("above"),this.spacer.classList.remove("below")),this.spacer=this.rowTops[0].tr,this.dragTargetRowIndex=0,this.dragTargetPositon="above";for(const t of this.rowTops)e.clientY>t.top&&(this.spacer=t.tr,this.dragTargetRowIndex=parseInt(t.tr.dataset.row||"0"));const t=this.rowTops[this.rowTops.length-1];e.clientY>=t.top+t.tr.offsetHeight?(this.spacer.classList.add("below"),this.dragTargetPositon="below"):(this.spacer.classList.add("above"),this.dragTargetPositon="above"),this.sprite.style.left=e.clientX+"px",this.sprite.style.top=e.clientY+"px"}}mouseup(e){if(e.preventDefault(),e.cancelBubble=!0,document.removeEventListener("mousemove",this.moveHandler),document.removeEventListener("mouseup",this.upHandler),this.drag&&(this.sprite&&this.sprite.parentNode&&this.sprite.parentNode.removeChild(this.sprite),this.drag=!1,this.spacer)){this.spacer.classList.remove("above"),this.spacer.classList.remove("below");const e=[];if(this.rows){const t=this.rows[this.dragTargetRowIndex];if(t!==this.dragRow){for(let o=0;o<this.rows.length;o++){const i=this.rows[o];this.dragRow!==i&&(t===i&&"above"===this.dragTargetPositon&&e.push(this.dragRow),e.push(i),t===i&&"below"===this.dragTargetPositon&&e.push(this.dragRow))}this.rows=JSON.parse(JSON.stringify(e)),this.callback&&this.rows&&this.callback(this.rows)}}}}};return __decorate$S([property({attribute:!1})],e.prototype,"columns",void 0),__decorate$S([property({attribute:!1})],e.prototype,"rows",void 0),__decorate$S([property({attribute:!1})],e.prototype,"callback",void 0),__decorate$S([property({type:Number})],e.prototype,"selectedRowIndex",void 0),__decorate$S([property({type:String})],e.prototype,"size",void 0),__decorate$S([property({type:Boolean})],e.prototype,"lockRows",void 0),e=__decorate$S([customElement("wc-table")],e),e})();var __awaiter$S=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};class WcDialogFormField extends LitElement{constructor(e,t){if(super(),!e)throw new Error("WcDialogFormField constructor expects a Form Field & callback.");this.orgFF=e,this.backdrop=new WcBackdrop,this.name=e.name,this.caption=e.caption,this.dataType=e.dataType,this.list=e.list,this.visibility=e.visibility,this.priceRelevant=e.priceRelevant,this.thumbWidth=e.thumbWidth,this.thumbHeight=e.thumbHeight,this.imageCss=e.imageCss,this.uiControl=e.uiControl,this.textAfter=e.textAfter,this.textBefore=e.textBefore,this.callback=t}static get properties(){return{name:{type:String},caption:{type:String},dataType:{type:String},list:{type:Object},uiControl:{type:String},imageCss:{type:String},visibility:{type:String}}}showDialog(){document.body.appendChild(this.backdrop),document.body.appendChild(this)}closeDialog(){document.body.removeChild(this.backdrop),document.body.removeChild(this)}getFormField(){const e=new Nobs;return e.setProperty(this.orgFF,"name",this.name),e.setProperty(this.orgFF,"caption",this.caption),e.setProperty(this.orgFF,"uiControl",this.uiControl),e.setProperty(this.orgFF,"list",this.list),e.setProperty(this.orgFF,"dataType",this.dataType),e.setProperty(this.orgFF,"thumbWidth",this.thumbWidth),e.setProperty(this.orgFF,"thumbHeight",this.thumbHeight),e.setProperty(this.orgFF,"imageCss",this.imageCss),e.setProperty(this.orgFF,"visibility",this.visibility),e.setProperty(this.orgFF,"priceRelevant",this.priceRelevant),"textbox"===this.uiControl?(e.setProperty(this.orgFF,"textBefore",this.textBefore),e.setProperty(this.orgFF,"textAfter",this.textAfter)):(e.setProperty(this.orgFF,"textBefore",""),e.setProperty(this.orgFF,"textAfter","")),new FormField(e,this.orgFF)}ok(){return __awaiter$S(this,void 0,void 0,(function*(){if(this.closeDialog(),"scope"===this.orgFF.origin)update([this.orgFF.serialize()],[this.getFormField().serialize()]);else{const e=scope().currentDoc,t=scope().currentDoc.getAllDocFormFieldsAsMap(null),o=this.getFormField(),i=new Map;for(const[e,r]of t)r.id===o.id?i.set(o.id,o):i.set(e,r);const r=(new Nobs).replaceCollection(e.formFields,i),s=new Doc(r,e);update([e.serialize(scope().id)],[s.serialize(scope().id)]),scope().clearSelection()}}))}static get styles(){return[dialogStyles,css`
        
         
        .content {
          position: relative;
          display: grid;
          
          min-width: calc(var(--printess-dialog-padding) + 620px);
          width: 100%;

          column-gap: var(--printess-dialog-padding);
          
          grid-template-columns: 1fr 1fr;
          grid-template-rows: auto 25px auto auto 300px auto; //max-content;
           
          grid-template-areas:  "  name         caption   "
                                "  name-err     name-err  "
                                "  settings     settings  "
                                "  table-headline        table-headline   "
                                "  table        table    "
                                "  table-props  table-props    "
                               
      }
         
       vaadin-text-field {
           width: 100%;
       }
       .settings {
        grid-template-columns: 1fr 1fr 1fr 1fr; 
        column-gap: var(--printess-dialog-padding);
        grid-area: settings; 
        display: grid;
        align-items: flex-end;
        padding-bottom: 10px;
       }
       .table-props {
        min-height: 104px;
        grid-template-columns:  max-content 1fr; 
        column-gap: var(--printess-dialog-padding);
        grid-area: table-props; 
        display: grid;
        align-items: flex-start;
        padding-top: 5px;
       }
       .before-after {
        display: grid; 
        grid-template-columns: 1fr 20Px 1fr; 
        padding-top: 25px;
         margin-bottom: 30px;
         border-top: 2px solid white;
       }
       .table-headline{
          padding-bottom: 2px;
       }
       .type {
         display: flex;
         flex-direction: column;
         grid-column-start: 1;
         grid-column-end: 2;

       }
       wc-table {
         width: 100%;
         height: 300px;
       }
        `]}render(){return html`
            
        <div class="content" >

           <vaadin-text-field  minlength="1"  maxlength="30" label="Form Field Name" ?disabled=${"USER_CREATED"!==this.orgFF.systemType} 
                            @change=${e=>this.nameChanged(e)}
                            style="grid-area: name" value="${this.name}"></vaadin-text-field>

           <vaadin-text-field  minlength="1"  maxlength="30" label="Label"  
                            @change=${e=>this.stringChanged(e,"caption")}
                            style="grid-area: caption" value="${this.caption}"></vaadin-text-field>

          <div style="color: red; grid-area: name-err" id="nameErrorField"></div>

          
          <div class="settings">
            <wc-select  .value=${this.visibility} label="Visibility" .list=${["admin","buyer"]} .callback=${e=>this.visibility=e}></wc-select>
            <wc-select  .value=${this.uiControl} label="User Interface" .list=${["textbox","select-list","image-list"]} .callback=${e=>this.uiControl=e}></wc-select>
            <div></div>
            <wc-checker theme="small" label="Impact Price" .value=${this.priceRelevant} .callback=${e=>this.priceRelevant=e}></wc-checker>
            <!--
            <div class="type">
              <vaadin-radio-button  ?checked=${"string"===this.dataType}   
                    @checked-changed=${e=>this.dataTypeChanged(e,"string")} >Text</vaadin-radio-button>
              <vaadin-radio-button ?checked=${"number"===this.dataType}   
                    @checked-changed=${e=>this.dataTypeChanged(e,"number")} >Number</vaadin-radio-button>
            </div>-->

           
            
             
          </div>

          
            <div style="grid-area: table"   >
              ${"textbox"===this.uiControl?html`
                  <div class="before-after">
                    <vaadin-text-field label="Text Before"  @change=${e=>this.stringChanged(e,"textBefore")}
                            value="${this.textBefore}"></vaadin-text-field>
                    <div></div>
                    <vaadin-text-field label="Text After"   @change=${e=>this.stringChanged(e,"textAfter")}
                            value="${this.textAfter}"></vaadin-text-field>
                  </div>
              `:html`
                  <wc-table ?lockRows=${"USER_CREATED"!==this.orgFF.systemType&&"DOCUMENT_SIZE"!==this.orgFF.systemType} .columns=${this.listColumns} .rows=${this.listRows} .callback=${e=>this.listRowsChange(e)}></wc-table>
              `}
            </div>
             
           <!-- <div class="table-headline">List of recommended values:</div> -->
            <div class="table-props">
               ${"image-list"===this.uiControl||"select-list"===this.uiControl?html`
                <vaadin-number-field style="grid-column: 1" theme="small"   @change=${e=>this.numberChanged(e,"thumbWidth")} label="List Image Width"   value="${this.thumbWidth}" has-controls min="20" max="200"></vaadin-number-field>
                ${"image-list"===this.uiControl?html`
                  <div style="grid-column: 2; grid-row: 1 / 3;">
                      <div style="font-size: var(--printess-labelSize); margin-bottom: 2px" >
                        <span>List Image CSS</span> <a @click=${()=>this.resetImageStyle()} style="float: right; color: var(--printess-headlineColor); cursor: pointer;">RESET</a>
                      </div>
                    <textarea style="height: 85px; width: 100%;" @change=${e=>this.stringChanged(e,"imageCss")} spellcheck="false" >${this.imageCss}</textarea>
                  </div>
                `:""}
                <vaadin-number-field  style="grid-column: 1"  theme="small"   @change=${e=>this.numberChanged(e,"thumbHeight")} label="List Image Height"   value="${this.thumbHeight}" has-controls min="20" max="200"></vaadin-number-field>
              `:html`<div></div>`}
            </div>   
         

         </div>
         <div class="footer" >
            
            <vaadin-button style="grid-column: 2" @click=${this.ok} theme="primary">OK</vaadin-button>
            <vaadin-button style="grid-column: 3" @click=${this.closeDialog} theme="secondary">CANCEL</vaadin-button>
         </div>
        
          
         
        `}get listColumns(){return[{name:"value",readonly:"USER_CREATED"!==this.orgFF.systemType&&"DOCUMENT_SIZE"!==this.orgFF.systemType},{name:"label",data:"string"},{name:"description",label:"info",data:"string"},{name:"image",data:"image"}]}get listRows(){var e;const t=[];for(const o of(null===(e=this.list)||void 0===e?void 0:e.values())||[])t.push({values:[o.key,o.label||"",o.description||"",o.imageId||""]});return t}listRowsChange(e){const t=new Map;for(const o of e){const e=o.values[0],i=o.values[1],r=o.values[2],s=o.values[3];t.set(e,{key:e,imageId:s||void 0,label:i||void 0,description:r||void 0})}this.list=t}dataTypeChanged(e,t){e&&e.target&&e.target.checked&&(this.dataType=t)}nameChanged(e){if(e&&e.target){let t="";const o=e.target.value;if(o===getValidJsName(o)?this.name=o:t="name is not valid! Should only contain chars and numbers.",this.shadowRoot){const e=this.shadowRoot.getElementById("nameErrorField");e&&(e.innerText=t)}}}stringChanged(e,t){if(e&&e.target){let o=e.target.value;o||"imageCss"!==t||(o=FormField.defaultImageListCss),this[t]=o}}resetImageStyle(){if(this.imageCss=FormField.defaultImageListCss,this.shadowRoot){const e=this.shadowRoot.querySelector("textarea");e&&(e.value=this.imageCss)}}numberChanged(e,t){if(e&&e.target){const o=parseInt(e.target.value);o>0&&(this[t]=o)}}}customElements.define("wc-dialog-form-field",WcDialogFormField);var __decorate$T=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n},__awaiter$T=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};let WcResourcesFormFields=(()=>{let e=class extends LitElement{constructor(){super(),this.selected="global",this.select("global")}get doc(){return this._doc}set doc(e){this._doc=e,"local"===this.selected&&this.select()}get formFields(){return"local"===this.selected?this.doc.getAllDocFormFieldsAsMap(null):scope().getAllGlobalFormFields(!1)}getCopyPasteConsumer(){if(this.wcList)return this.wcList;throw"WcRessourcesImage can not provide CopyPasteConsumer, wcList is null."}refreshList(){this.select()}refreshGlobalList(){"global"===this.selected&&this.select()}select(e){e&&(this.selected=e),this.wcList=new WcList(this.getContext(this.selected,this),this.formFields),this.requestUpdate(),e&&scope().resourcesStylesUi.which!==e&&scope().resourcesStylesUi.toggleStyle(e)}selectByMouse(e){this.select(e),scope().copyPasteConsumer=this.wcList}pasteFormFieldItem(e){return __awaiter$T(this,void 0,void 0,(function*(){if("local"===scope().resourcesFormFieldsUi.selected){const t=scope().currentDoc,o=new Map(t.formFields);for(const t of e){const e=getValidJsName(t.data.na).replace(/_/g,"");t.data.na=getNewName(e,"ff",(e=>scope().currentDoc.formFieldsByName.has(e)),"_"),t.data.id=generateDBID(),t.data.o="doc",o.set(t.data.id,new FormField(t.data.id,t.data))}const i=(new Nobs).replaceCollection(t.formFields,o),r=new Doc(i,t);yield update([t.serialize(scope().id)],[r.serialize(scope().id)])}else{const t=[];for(const o of e){const e=getValidJsName(o.data.na).replace(/_/g,"");o.data.na=getNewName(e,"ff",(e=>scope().hasGlobalFormField(e)),"_"),o.data.id=generateDBID(),o.data.o="scope",t.push(o)}yield create(t)}scope().redrawAllItemsWithClassesDebounced(50),scope().productMatrixUi.requestUpdate()}))}getContext(e,t){return{createItem:function(e){const t=scope().currentDoc;let o="doc",i="Local Form Field Name";"global"===scope().resourcesFormFieldsUi.selected&&(i="Global Form Field Name",o="scope");const r=prompt(i);if(r)if("local"===scope().resourcesFormFieldsUi.selected){if(!scope().currentDoc.isValidFormFieldName(r))return alert("Invalid name! Either it contains illegal charracters or a Form Field with this name already exists.\n\nPlease use only chars and numbers."),"completed";const i=new Map(t.formFields);i.set(r,new FormField("",{na:r,t:"string",or:e,o:o}));const s=(new Nobs).replaceCollection(t.formFields,i),n=new Doc(s,t);update([t.serialize(scope().id)],[n.serialize(scope().id)]).then((()=>{scope().redrawAllItemsWithClassesDebounced(50)}))}else{if(!scope().isValidFormFieldName(r))return alert("Invalid name! Either it contains illegal charracters or a Form Field with this name already exists.\n\nPlease use only chars and numbers."),"completed";create([new FormField("",{na:r,t:"string",or:e,o:"scope"}).serialize()]).then((()=>{scope().productMatrixUi.requestUpdate(),scope().redrawAllItemsWithClassesDebounced(50)}))}return"completed"},canCreateItem:()=>!0,removeItems:function(e){return __awaiter$T(this,void 0,void 0,(function*(){let t=!1;const o=scope().currentDoc,i=[],r=new Map;for(const i of o.formFields.values())e.indexOf(i)>=0?t=t||"doc"===i.origin:r.set(i.id,i);for(const t of e)"scope"===t.origin&&i.push(t.serialize());if(t){const e=(new Nobs).replaceCollection(o.formFields,r),t=new Doc(e,o);return yield update([o.serialize(scope().id)],[t.serialize(scope().id)]),scope().redrawAllItemsWithClassesDebounced(50),!0}return!!i.length&&(yield remove(i),scope().redrawAllItemsWithClassesDebounced(50),!0)}))},mutateItem:(e,t)=>new FormField(e,t),getName:function(){return"global"===e?"GlobalFormFields":"DocFormFields"},getContextMenuItems(){const e=[];return e.push({caption:"Properties",callback:()=>{const e=t.wcList.getSelectedItems();if(e.length>0){new WcDialogFormField(e[0]).showDialog()}},icon:"cog"}),e.push({caption:"-"}),e},deserializeItem:function(e,t){return new FormField(e||generateDBID(),t.data)},itemTemplate:e=>html`
        <div style="width: 100%; display: grid;  grid-template-columns: 20px 1fr 5px; position: relative;" >
          ${"admin"===e.visibility?html`<wc-icon style="width: 12px; height: 12px; position: absolute; top:0; left: 4px" primaryColor="medium" icon="eye-solid-slash" ></wc-icon>`:""}
          <svg style="width: 20px; height: 50px; align-self: flex-start; fill: var(--printess-pannelBackground); padding-top: 10px;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M384 128h85.333333v85.333333H384V128m170.666667 0h85.333333v85.333333h-85.333333V128M384 298.666667h85.333333v85.333333H384V298.666667m170.666667 0h85.333333v85.333333h-85.333333V298.666667m-170.666667 170.666666h85.333333v85.333334H384v-85.333334m170.666667 0h85.333333v85.333334h-85.333333v-85.333334m-170.666667 170.666667h85.333333v85.333333H384v-85.333333m170.666667 0h85.333333v85.333333h-85.333333v-85.333333m-170.666667 170.666667h85.333333v85.333333H384v-85.333333m170.666667 0h85.333333v85.333333h-85.333333v-85.333333z" fill="" /></svg>
          <div>
            <wc-form-field-value class="clickable" .formField=${e} showName ></wc-form-field-value> 
            ${e.subFields.length?html`
              <div style="padding: 5px; padding-left: 15px; background-color: var(--printess-maxContrastColorInverse);">
                ${e.subFields.map((e=>html`
                  <wc-form-field-value  class="clickable" .formField=${e} showName ></wc-form-field-value> 
                `))}
              </div>
            `:""}
          </div>
        </div>
            `}}editFormField(e){alert("not implemented")}getWcList(){return this.wcList}static get styles(){return css`
      :host, :host * {
          box-sizing: border-box;
      }
      :host  {        
          width: 100%;
          height: 100%;
          display: block; 
          position: relative;
      }
      .selector {
        display: grid;
        grid-template-columns: 1fr 1fr;
        width: 100%;
      }
      .selector > * {
          background-color: gray;
          color: white;
          padding: 5px;
          text-align: center;
          cursor: pointer;
          white-space: nowrap;
      }

      .selector > *:hover {
        background-color: var(--printess-headlineColorHover);
      }

      .selector > .selected {
        background-color: var(--printess-headlineColor);
      }
    `}render(){return this.wcList?html`
        <div class="selector"> 
            <div class="${"global"===this.selected?"selected":""}" @click=${()=>this.selectByMouse("global")} >Template</div>
            <div class="${"local"===this.selected?"selected":""}" @click=${()=>this.selectByMouse("local")}  >[${this.doc.shortName}]</div>
           
          </div>
          ${this.wcList}`:html`<p>No Data</p>`}};return __decorate$T([property({type:String})],e.prototype,"selected",void 0),e=__decorate$T([customElement("wc-resources-form-fields")],e),e})();var __decorate$U=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n},__awaiter$U=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};let WcTagList=(()=>{let e=class extends LitElement{constructor(){super(...arguments),this.tags=[],this.caption="Filter:",this.type="group",this.addtags="not-allowed"}static get styles(){return css`
      :host {
     
      display: block;
      padding-top: 8px;
     
    }
 
    .tags {
      min-height: 30px;
    }

    .tag {
      background-color: rgb(94, 124, 170);
      border-radius: 3px;
      color: white;
      display: inline-block;
      margin-bottom: 7px;
      margin-right: 7px;
      padding: 2px 25px 2px 5px;
      pointer-events: none;
      position: relative;
    }
    .tag:hover {
      background-color: rgb(115 142 183);
      color: white;
    }
    .tag:after {
      color: #d4e5ff;
      content: '';
      cursor: pointer;
      font-size: 18px;
      pointer-events: auto;
      position: absolute;
      right: 5px;
      top: -1px;
    }
    .tag:hover:after {
      color: red;
    }
    label {
      color: var(--lumo-secondary-text-color);
      font-size: 12px;
      margin-left: 1px;
      padding-bottom: 5px;
      display: block
    }
     
   input {
      outline: none;
      border-radius: 3px;
      background-color: var(--lumo-contrast-10pct);
      width: 100px;
      display: inline-block;
      margin-bottom: 7px;
      margin-right: 7px;
      position: relative;
      padding: 4px;
      border: none;
    }`}render(){return html`
   
    ${this.caption?html`<label>${this.caption}</label>`:""}
   
    <div class="tags" >
      ${this.tags.map((e=>html`<div @click=${()=>this.removeTag(e)} class="tag">${e}</div>`))}
      <input id="tag-input" placeholder="${"allowed"===this.addtags?"add ...":"search ..."}" @keydown=${e=>this.key(e)} @change=${e=>this.key(e,"Enter")} list="tags">
      ${until(this.getTagList(),html`Loading Tag List ...`)}
    </div>
    `}styleClassList(){const e=new Set;scope().style.classNames.forEach((t=>e.add(t))),scope().currentDoc.getClassNames().forEach((t=>e.add(t)));for(const t of scope().globalResources.styles.values())t.classNames.forEach((t=>e.add(t)));return e}getTagList(){return __awaiter$U(this,void 0,void 0,(function*(){if("class"===this.type){const e=Array.from(this.styleClassList()).sort();return html`<datalist id="tags">
          ${e.map((e=>html`<option value="${e}"></option>`))}
        </datalist>`}{const e=yield loadTags("allowed"===this.addtags?"both":this.type);return html`<datalist id="tags">
          ${e.map((e=>html`<option value="${e.tag+" ("+e.groupCounter+")"}"></option>`))}
        </datalist>`}}))}key(e,t){return __awaiter$U(this,void 0,void 0,(function*(){let o=e.target.value.replace(/\s*\(.*/,"");if("class"!==this.type&&(o=o.toLowerCase()),o)switch(t||e.key){case"Enter":{const e="class"===this.type?this.styleClassList().has(o):yield tagExists(this.type,o);if("allowed"===this.addtags||e){if(new Set(this.tags).has(o)||(this.tags=[...this.tags,o],this.dispatchEvent(new CustomEvent("tagsChanged",{detail:this.tags})),e||"class"===this.type||addNewTagToCache({tag:o,groupCounter:0,layoutCounter:0})),this.shadowRoot){const e=this.shadowRoot.getElementById("tag-input");e&&(e.value="")}}break}}}))}removeTag(e){this.tags=this.tags.filter((t=>t!==e)),this.dispatchEvent(new CustomEvent("tagsChanged",{detail:this.tags}))}};return __decorate$U([property({attribute:!1})],e.prototype,"tags",void 0),__decorate$U([property({attribute:!0})],e.prototype,"caption",void 0),__decorate$U([property({attribute:!0})],e.prototype,"type",void 0),__decorate$U([property({attribute:!0})],e.prototype,"addtags",void 0),e=__decorate$U([customElement("wc-tag-list")],e),e})();var __decorate$V=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n},__awaiter$V=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};let WcResourcesSnippets=(()=>{let e=class extends LitElement{constructor(){super(),this.selected="groupSnippets",this.mode="search",this.searchGroupTags=[],this.searchLayoutTags=[],this.inputStyle="\n    width: 100%;\n    outline: none;\n    border-radius: 3px;\n    background-color: var(--lumo-contrast-10pct);\n    position: relative;\n    padding: 4px;\n    border: none;",this.select("groupSnippets")}get doc(){return this._doc}set doc(e){this._doc=e,this.select()}getCopyPasteConsumer(){return this.wcList||(this.wcList=new WcList(this.getContext(this.selected,this),this.getCurrentSnippetClustersAsMap())),this.wcList}getCurrentSnippetClusters(){return scope().docUi.currentSpread[this.selected]}getCurrentSnippetClustersAsMap(){const e=scope().docUi.currentSpread,t=new Map;for(const o of e[this.selected])t.set(o.id,o);return t}select(e){"search"!==this.mode||e&&e!==this.selected?(e&&(this.selected=e),this.wcList=new WcList(this.getContext(this.selected,this),this.getCurrentSnippetClustersAsMap()),this.requestUpdate()):this.requestUpdate()}selectMode(e){e&&(this.mode=e),this.requestUpdate()}selectByMouse(e){this.select(e),this.wcList&&(scope().copyPasteConsumer=this.wcList)}selectModeByMouse(e){this.selectMode(e),scope().copyPasteConsumer=this.getCopyPasteConsumer()}getWcList(){return this.wcList}setSearchTags(e){"groupSnippets"===this.selected?this.searchGroupTags=e:this.searchLayoutTags=e}get tags(){if("search"===this.mode)return"groupSnippets"===this.selected?this.searchGroupTags:this.searchLayoutTags;{const e=scope().docUi.currentSpread;return"groupSnippets"===this.selected?e.groupTags:e.layoutTags}}static get styles(){return css`
  :host, :host * {
      box-sizing: border-box;
  }
  :host  {        
      width: 100%;
      height: 100%;
      position: relative;
      display: grid; 
      grid-template-rows: auto 1fr;
  }
  .scroll-container {
    height: 100%;
    overflow: auto;
    border-top: 1px solid var(--printess-maxContrastColor);
  }
  .scroll-container > div {
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
  }
 
  .snippets {
    display: flex;
    flex-direction: column;
    flex-wrap: wrap;
    padding: 5px;
  }

  .snippet {
    width: 120px;
    height: auto;
    margin: 5px;
 
   /* background-size: contain;
    background-position: 0% 0%;
    background-repeat: no-repeat;*/
     
    cursor: pointer;
  }
  .snippet > img {
    width: 120px;
    height: auto;
    
    background-color: rgb(215, 232, 235);
   
    border: 1px solid black;
    
  }
  .snippet > div {
    font-size: 11px;
  }
  .snippet-button {
    
    height: auto;
    margin: 5px;
    width: calc(100% - 10px);
    padding: 5px; 
    background-color: white;
    
    border: 1px solid black;
    border-radius: 10px;
    cursor: pointer;
  }
  .snippet-button:hover {
    color: var(--printess-headlineColor);
    border-color: var(--printess-headlineColor);
  }
  .two-selectors {
    display: grid;
    grid-template-columns: 1fr 1fr;
  }

  .selector {
    display: grid;
    grid-template-columns: 1fr 1fr;
    width: 100%;
  }
 
  .selector > * {
      background-color: gray;
      color: white;
      padding: 5px;
      text-align: center;
      cursor: pointer;
      white-space: nowrap;
  }
  .selector > .main {
    display: flex; 
    flex-wrap: no-wrap;
  }

  .selector > *:hover {
    background-color: var(--printess-headlineColorHover);
  }

  .selector > .selected {
    background-color: var(--printess-headlineColor);
  }


  .selector.mode > * {
    background-color: #ccc;
    border-bottom: 2px solid #aaa;
  }

  .selector.mode > *:hover {
    background-color: #ccc;
  }

  .selector.mode > .selected {
    background-color: #aaa;
    border-bottom: 2px solid var(--printess-headlineColor);
  }

.mode-option:hover {
  background-color: #bbb !important;
}
 

.mode-option.selected:hover {
  background-color:#aaa !important;
}
 
.mode-option {
  position: relative;
}
.mode-option > .badge {
  position: absolute;
    right: 2px;
    padding: 1px 4px;
    border-radius: 50%;
    background-color: var(--printess-headlineColor);
    color: white;
    font-size: 11px;
    bottom: 0px;
}
wc-tag-list {
  margin: 7px;
}

.mode-icon {
  width: 22px;
  height: 22px;
  margin: auto;
}

.basket {
  width: 12px;
  height: 14px;
  margin-left: 4px;
  padding-top: 3px;
}
  
`}firstUpdated(){}render(){const e=scope().docUi.currentSpread.groupSnippets.length,t=scope().docUi.currentSpread.layoutSnippets.length;return html`

    <div class="selector-toolbar">
        <div class="selector"> 
            <div class="main ${"groupSnippets"===this.selected?"selected":""}" @click=${()=>this.selectByMouse("groupSnippets")} >
              <span>Group</span> 
              ${e?html`<wc-icon class="basket"  primaryColor="head-toolbar"  icon="shopping-cart-solid">`:""}
            </div>
            <div class="main ${"layoutSnippets"===this.selected?"selected":""}" @click=${()=>this.selectByMouse("layoutSnippets")}  >
              <span>Layout</span> 
              ${t?html`<wc-icon class="basket"   primaryColor="head-toolbar"  icon="shopping-cart-solid">`:""}
            </div>
           
          </div>
        <div class="two-selectors">
          <div class="selector mode" > 
            ${"groupSnippets"===this.selected?html`
              <div class="mode-option ${"search"===this.mode?"selected":""}" @click=${()=>this.selectModeByMouse("search")} ><wc-icon class="mode-icon" primaryColor="${this.mode,"head-toolbar"}" icon="search-light"></wc-icon></div>
              <div class="mode-option ${"buyer-side"===this.mode?"selected":""}" @click=${()=>this.selectModeByMouse("buyer-side")}  ><wc-icon class="mode-icon" primaryColor="${this.mode,"head-toolbar"}"  icon="shopping-cart"></wc-icon>${e?html`<div class="badge">${e}</div>`:""}</div>
            `:html`
              <div></div>
              <div></div>
            `}
          </div>
          <div class="selector mode"  > 
            ${"layoutSnippets"===this.selected?html`
              <div class="mode-option ${"search"===this.mode?"selected":""}" @click=${()=>this.selectModeByMouse("search")} ><wc-icon class="mode-icon" primaryColor="${this.mode,"head-toolbar"}" icon="search-light"></wc-icon></div>
              <div class="mode-option ${"buyer-side"===this.mode?"selected":""}" @click=${()=>this.selectModeByMouse("buyer-side")}  ><wc-icon class="mode-icon" primaryColor="${this.mode,"head-toolbar"}"  icon="shopping-cart"></wc-icon>${t?html`<div class="badge">${t}</div>`:""}</div>
            `:html`
              <div></div>
              <div></div>
            `}
          </div>
       </div>
     ${"search"===this.mode?html`
          <wc-tag-list caption="" type="${"groupSnippets"===this.selected?"group":"layout"}" .tags=${this.tags} @tagsChanged=${e=>this.setSearchTags(e.detail)}></wc-tag-list>
        `:html`
          <p style="margin-left: 15px; margin-right: 10px; line-height: 1.3;">Available <strong>${"layoutSnippets"===this.selected?"Layout Snippets":"Group Snippets"}</strong><br>for Page <strong>No. ${scope().docUi.currentSpread.caption()}</strong> in Buyer Side.</p>
        `}

    </div>
    <div class="scroll-container">
      ${"search"===this.mode?html`
          ${"layoutSnippets"===this.selected?html`
            <div class="layoutSnippets">
              ${until(loadSnippets(this.tags,"layout").then((e=>e.map((e=>this.getLayoutSnippetImage(e))))),html`loading ...`)}
            </div>`:html`
            <div class="snippets">
              ${until(loadSnippets(this.tags,"group").then((e=>e.map((e=>this.getLayoutSnippetImage(e))))),html`loading ...`)}
            </div>`}
      `:html`
        ${this.wcList?this.wcList:"no wcList found"}
      `}

    </div>
      `}getLayoutSnippetImage(e){return"REMOVE"===e.id?config.isBuyer||config.isMobile?html``:html`<button class="snippet-button" @click=${()=>removeArtworkFromCurrentSpread()}>Remove<br>Layout-Snippet</button>`:html`<div class="snippet" ><img src="${e.thumbUrl}" title="${e.title}" @click="${()=>this.insertSnippet(e)}" style="background-color: ${e.bgColor}"></img>
                 ${e.userId==scope().myUserId?html`<div style="display: flex; flex-direction: row;"><wc-icon icon="trash-solid" style="width: 14px; height: 14px;" primaryColor="headline" @click="${()=>this.deleteSnippet(e)}"></wc-icon><div>${e.title}</div></div>`:html`<div>${e.title}</div>`}</div>`}deleteSnippet(e){return __awaiter$V(this,void 0,void 0,(function*(){const t=createPrintessApiFromExternalConfig();yield t.deleteSnippet(e.id),this.reload()}))}reload(){var e;if(resetSnippetCache(),clearTagsCache(),this.shadowRoot)for(const t of null===(e=this.shadowRoot)||void 0===e?void 0:e.querySelectorAll("wc-tag-list"))t.requestUpdate();this.requestUpdate()}insertSnippet(e){"layoutSnippets"===this.selected?"REMOVE"===e.id?removeArtworkFromCurrentSpread():addSnippet(e.snippetUrl,e.docId,"layout"):addSnippet(e.snippetUrl,e.docId,"group")}getContext(e,t){return{createItem:function(o){const i="groupSnippets"===e?"Add Graphic":"Change Layout";if(i){const o=scope().currentDoc,r=scope().docUi.currentSpread,s=[...r[e],new SnippetCluster(generateDBID(),{na:i})],n=(new Nobs).setProperty(r,e,s),a=new Doc(n,o);update([o.serialize(scope().id)],[a.serialize(scope().id)]).then((()=>{t.mode="buyer-side",t.select()}))}return"completed"},canCreateItem:()=>!0,removeItems:function(t){return __awaiter$V(this,void 0,void 0,(function*(){const o=scope().currentDoc,i=scope().docUi.currentSpread,r=i[e];let s=!1;const n=[];for(const e of r)t.indexOf(e)>=0?s=!0:n.push(e);if(s){const t=(new Nobs).setProperty(i,e,n),r=new Doc(t,o);return yield update([o.serialize(scope().id)],[r.serialize(scope().id)]),!0}return!1}))},mutateItem:(e,t)=>new SnippetCluster(e,t),getName:function(){return"layoutSnippets"===e?"LayoutSnippets":"GroupSnippets"},deserializeItem:function(e,t){return new SnippetCluster(e||generateDBID(),t.data)},itemTemplate:e=>html`
        <div style="width: 100%; display: grid;  grid-template-columns: 20px 1fr 5px; position: relative;" >
          <svg style="width: 20px; height: 50px; align-self: flex-start; fill: var(--printess-pannelBackground); padding-top: 10px;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M384 128h85.333333v85.333333H384V128m170.666667 0h85.333333v85.333333h-85.333333V128M384 298.666667h85.333333v85.333333H384V298.666667m170.666667 0h85.333333v85.333333h-85.333333V298.666667m-170.666667 170.666666h85.333333v85.333334H384v-85.333334m170.666667 0h85.333333v85.333334h-85.333333v-85.333334m-170.666667 170.666667h85.333333v85.333333H384v-85.333333m170.666667 0h85.333333v85.333333h-85.333333v-85.333333m-170.666667 170.666667h85.333333v85.333333H384v-85.333333m170.666667 0h85.333333v85.333333h-85.333333v-85.333333z" fill="" /></svg>
          <div style="padding: 10px 5px;">
            <input class="clickable" value="${e.name}" style="${t.inputStyle}" 
               @change=${o=>{var i;return t.saveSnippetClusterProperty(e,"name",(null===(i=o.target)||void 0===i?void 0:i.value)||"")}} ></input>
            <wc-tag-list class="clickable" type="${"groupSnippets"===this.selected?"group":"layout"}" caption="" .tags=${e.tags} @tagsChanged=${o=>t.saveSnippetClusterProperty(e,"tags",o.detail)}></wc-tag-list>
            <div>
              <a class="clickable" @click=${()=>t.showInSearch(e.tags)} href="#"  >show in search</a>
            </div>
          </div>
        </div>
            `}}showInSearch(e){this.mode="search",this.setSearchTags(e)}saveSnippetClusterProperty(e,t,o){const i=scope().docUi.currentSpread,r=scope().currentDoc,s=new SnippetCluster((new Nobs).setProperty(e,t,o),e),n=i[this.selected].map((t=>t.id===e.id?s:t)),a=(new Nobs).setProperty(i,this.selected,n),l=new Doc(a,r);update([r.serialize(scope().id)],[l.serialize(scope().id)])}};return __decorate$V([property({type:String})],e.prototype,"selected",void 0),__decorate$V([property({type:String})],e.prototype,"mode",void 0),__decorate$V([property({type:Array,attribute:!1})],e.prototype,"searchGroupTags",void 0),__decorate$V([property({type:Array,attribute:!1})],e.prototype,"searchLayoutTags",void 0),e=__decorate$V([customElement("wc-resources-snippets")],e),e})();var __decorate$W=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n},__awaiter$W=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};let WcProductMatrix=(()=>{let e=class extends LitElement{constructor(){super(...arguments),this.productMatrix=new ProductMatrix({}),this.selectedRow=scope().templateProperties.productMatrixRow}getSelectedProduct(){const e=this.productMatrix.rows[this.selectedRow];return e?e.name:""}setSelectedProduct(e){return __awaiter$W(this,void 0,void 0,(function*(){let t=null;if("string"==typeof e){for(let o=0;o<this.productMatrix.rows.length;o++)if(this.productMatrix.rows[o].name===e){t=this.productMatrix.rows[o];break}}else t=e;t&&(this.selectedRow=t.index,yield this.productMatrix.apply(t))}))}static get styles(){return css`
    :host {
      width: 100%;
      display: block;
      box-sizing: border-box;
      height: 100%;
    }
    :host * {
      box-sizing: border-box;
    }

    .container {
      width: 100%;
      height: 200px; /* should be data-panel height */ 
      overflow: scroll;
    }
    table {
      border-collapse: collapse;
      font-family: Arial, Helvetica, sans-serif;
      font-size: 13px;
      color: #333;
      padding: 0;
      margin: 0;
    }

    td {
      white-space: nowrap;
    }

    table,
    thead th,
    thead td {
      border: 1px solid lightgray;
      padding: 2px;
  
    }

    tbody td {
      border: 1px solid lightgray;
      padding:0;
    }

    input,
    select{
      border: 0px solid white;
      padding:5px;
      
      width: calc(100% - 4px);
    }
    select {
      min-width: 100px;
    }

    input[type="checkbox"]   {
      min-height: 20px;
      min-width: 20px;
    } 
 
    thead {
      border-bottom: 2px solid #aaa;
    }

   
 
    .menu {
      background-color: #eee;
    }
    .product, .supplier {
      background-color: #ffffff;
    }

    .ff-read, .ff-read > select, .ff-read > input {
      background-color: #effbff;
    }

    .docs {
      background-color: white;  
    }

    .writes, .writes > select, .writes > input {
      background-color: #fae7f4;
    }

    .layers, .layers > select, .layers > input {
      background-color: #f1f1f1;
    }

    .pages {
      background-color: #caf1de;
    }

    .right-border {
      border-right: 1px solid #444 !important;
    }
    .center {
      text-align: center;
    }
    .bold, .bold > input  {
      font-weight: bold;
    }

     
    button {
      color: var(--headlineColor);
      border: 1px solid  var(--headlineColor);
      background-color: white;
    }

    .caption-delete-grid {
      display: grid; 
      grid-template-columns:  1fr 20px;
      border: none;
      align-items: center;
    }
    .caption-delete-grid > wc-icon {
      width: 12px;
      height: 12px;
      cursor: pointer;
      margin-left: 5px;
    }
    `}render(){const e=this.productMatrix;return html`
    <div class="container">
    <table >
    <colgroup>
      <col span="1" class="menu">
     
      <col span="1" class="product">
    
      <col span="${Math.max(1,this.productMatrix.layersCols.length)}" class="layers">
      <col span="5" class="docs">
      <col span="${Math.max(1,this.productMatrix.rulesCols.length)}" class="ff-read">
      <col span="${Math.max(1,this.productMatrix.writesCols.length)}" class="writes" >
    
      <col span="3" class="supplier">
     <!-- <col span="1" class="pages" >-->
    </colgroup>
    <thead>
      <tr>
        <td class="right-border" >
         <wc-icon primaryColor="headline" style="margin-left: 12px; width: 22px; height: 22px; margin-top: 5px; cursor: pointer;" icon="plus-square" @click=${()=>this.productMatrix.addProductRow()}></wc-icon>
        </td>
        
        
       
        <td colspan="1" class="right-border center bold" >
          Matrix Product
        </td>
       

        <td colspan="${Math.max(1,this.productMatrix.layersCols.length)}" class="right-border center bold layers">
        <select style="width: auto;" @change=${e=>{const t=e.target;t&&(this.productMatrix.addLayer(t.value),t.value="")}}>
            <option value="" disabled selected>
              Visible Layers
            </option>
            ${Array.from(scope().currentDoc.layers.values()).map((e=>html`<option value="${e.name}">${e.name}</option>`))}
          </select>
        </td>
 
        
      </tr>
      <tr>
        
        <td class="right-border" ></td>

        <td class="bold right-border" style="min-width: 150px">
          Name
        </td>
        
       
        ${e.layersCols.map((t=>html`
          <td class="${e.layersCols[e.layersCols.length-1]===t?"right-border":""}">
          <div class="caption-delete-grid">
              <span>${t}</span>
              <wc-icon primaryColor="headline" icon="trash-solid" @click=${()=>e.removeLayer(t)}></wc-icon> 
          </div>
           
          </td>
        `))}
        ${0===e.layersCols.length?html`<td class="right-border"></td>`:""}
       
        


      </tr>
    </thead>
    <tbody>
    ${this.productMatrix.rows.map((t=>html`
     
      <tr>

      <td class="right-border" >
        <div class="caption-delete-grid">
          ${this.selectedRow===t.index?html`<wc-icon primaryColor="headline" style="padding-left: 10px; width: 28px; height: 28px" icon="check-square" @click=${()=>this.setSelectedProduct(t)}></wc-icon>`:html`<wc-icon primaryColor="toolbar" style="padding-left: 10px; width: 28px; height: 28px" icon="square" @click=${()=>this.setSelectedProduct(t)}></wc-icon>`}
          <wc-icon primaryColor="headline" icon="trash-solid" @click=${()=>e.removeProductRow(t.index)}></wc-icon>
        </div>
      </td>

         
       
        <!-- product info -->
        <td  class="bold">
          ${this.getStringInput(t,"name")}
        </td>
       
     
        <!-- ff-layers -->
        ${e.layersCols.map((o=>html`
          <td class="${e.layersCols[e.layersCols.length-1]===o?"right-border":""}">
            ${t.getLayerValue(o)?html`<wc-icon primaryColor="headline" style="padding-left: 10px; width: 28px; height: 28px" icon="eye-solid" @click=${()=>this.setLayerValue(t,o,!1)}></wc-icon>`:html`<wc-icon primaryColor="medium" style="padding-left: 10px; width: 28px; height: 28px" icon="eye-solid" @click=${()=>this.setLayerValue(t,o,!0)}></wc-icon>`}
           
          </td>
        `))}
        ${0===e.layersCols.length?html`<td class="right-border"></td>`:""}


     
      </tr>
    `))}

   
    </tbody>
  </table>
  </div>
    `}renderAllFeatures(){const e=this.productMatrix;return html`
    <div class="container">
    <table >
    <colgroup>
      <col span="1" class="menu">
     
      <col span="1" class="product">
    
      <col span="${Math.max(1,this.productMatrix.layersCols.length)}" class="layers">
      <col span="5" class="docs">
      <col span="${Math.max(1,this.productMatrix.rulesCols.length)}" class="ff-read">
      <col span="${Math.max(1,this.productMatrix.writesCols.length)}" class="writes" >
    
      <col span="3" class="supplier">
     <!-- <col span="1" class="pages" >-->
    </colgroup>
    <thead>
      <tr>
        <td class="right-border" ></td>
        
       

        <td colspan="1" class="right-border center bold" >
          Product
        </td>
       

        <td colspan="${Math.max(1,this.productMatrix.layersCols.length)}" class="right-border center bold layers">
        <select @change=${e=>{const t=e.target;t&&(this.productMatrix.addLayer(t.value),t.value="")}}>
            <option value="" disabled selected>
              Layers
            </option>
            ${Array.from(scope().currentDoc.layers.values()).map((e=>html`<option value="${e.name}">${e.name}</option>`))}
          </select>
        </td>


        <td colspan="5" class="right-border center bold">
          Documents
        </td>


        <td  colspan="${this.productMatrix.rulesCols.length}" class="right-border center bold ff-read">
          <select  @change=${e=>{const t=e.target;t&&(this.productMatrix.addRule(t.value),t.value="")}}>
            <option value="" disabled selected>
              Conditions
            </option>
            ${Array.from(scope().getAllGlobalFormFields().values()).map((e=>html`<option value="${e.name}">if ${e.name}</option>`))}
          </select>
        </td>


        <td colspan="${this.productMatrix.writesCols.length}" class="right-border center bold writes">
        <select @change=${e=>{const t=e.target;t&&(this.productMatrix.addWrites(t.value),t.value="")}}>
            <option value="" disabled selected>
              Actions
            </option>
            ${Array.from(scope().getAllGlobalFormFields().values()).map((e=>html`<option value="${e.name}">${e.name}</option>`))}
          </select>
        </td>

        <td colspan="3" class="right-border center bold" >
          Supplier
        </td>
      <!--  <td colspan="1" class="right-border center bold">
          Pages
        </td>-->
        
      </tr>
      <tr>
        
        <td class="right-border" ></td>

        <td class="bold right-border" style="min-width: 150px">
          Name
        </td>
        
       
        ${e.layersCols.map((t=>html`
          <td class="${e.layersCols[e.layersCols.length-1]===t?"right-border":""}">
          <div class="caption-delete-grid">
              <span>${t}</span>
              <wc-icon primaryColor="headline" icon="trash-solid" @click=${()=>e.removeLayer(t)}></wc-icon> 
          </div>
           
          </td>
        `))}
        ${0===e.layersCols.length?html`<td class="right-border"></td>`:""}
       
        <td >
          Edit
        </td>
        <td >
          Print
        </td>
        <td >
          Preview 1
        </td>
        <td >
          Preview 2
        </td>
        <td class="right-border" >
          Preview 3
        </td>
      

        ${e.rulesCols.map((t=>html`
          <td class="${e.rulesCols[e.rulesCols.length-1]===t?"right-border":""}">
            <div class="caption-delete-grid">
              <span>if ${t+" ["+scope().getFormFieldValue(t)+"]"}</span>
              <wc-icon primaryColor="headline" icon="trash-solid" @click=${()=>e.removeRule(t)}></wc-icon>
            </div>
          </td>
        `))}
        ${0===e.rulesCols.length?html`<td class="right-border" ></td>`:""}
       
 
       
        
 
        ${e.writesCols.map((t=>html`
          <td class="${e.writesCols[e.writesCols.length-1]===t?"right-border":""}">
           
            <div class="caption-delete-grid">
              <span> ${t+" ["+scope().getFormFieldValue(t)+"]"}}</span>
              <wc-icon primaryColor="headline" icon="trash-solid" @click=${()=>e.removeWrite(t)}></wc-icon> 
            </div>
          </td>
        `))}
        ${0===e.writesCols.length?html`<td class="right-border"></td>`:""}
         

        <td >
          ID / Name
        </td>
        <td style="min-width: 100px">
          SKU
        </td>
        <td class="right-border" >
          Description
        </td>
<!--
        <td class="right-border">
          <select>
            <option>
              ExtraPage
            </option>
            <option>
              green pageb 
            </option>
            <option>
              lawnmover
            </option>
          </select>
        </td>
  -->

      </tr>
    </thead>
    <tbody>
    ${this.productMatrix.rows.map((t=>html`
     
      <tr>

      <td class="right-border" >
        <div class="caption-delete-grid">
          ${this.selectedRow===t.index?html`<wc-icon primaryColor="headline" style="padding-left: 10px; width: 28px; height: 28px" icon="check-square" @click=${()=>this.setSelectedProduct(t)}></wc-icon>`:html`<wc-icon primaryColor="toolbar" style="padding-left: 10px; width: 28px; height: 28px" icon="square" @click=${()=>this.setSelectedProduct(t)}></wc-icon>`}
          <wc-icon primaryColor="headline" icon="trash-solid" @click=${()=>e.removeProductRow(t.index)}></wc-icon>
        </div>
      </td>

         
       
        <!-- product info -->
        <td  class="bold">
          ${this.getStringInput(t,"name")}
        </td>
       
     
        <!-- ff-layers -->
        ${e.layersCols.map((o=>html`
          <td class="${e.layersCols[e.layersCols.length-1]===o?"right-border":""}">
            ${t.getLayerValue(o)?html`<wc-icon primaryColor="headline" style="padding-left: 10px; width: 28px; height: 28px" icon="eye-solid" @click=${()=>this.setLayerValue(t,o,!1)}></wc-icon>`:html`<wc-icon primaryColor="medium" style="padding-left: 10px; width: 28px; height: 28px" icon="eye-solid" @click=${()=>this.setLayerValue(t,o,!0)}></wc-icon>`}
           
          </td>
        `))}
        ${0===e.layersCols.length?html`<td class="right-border"></td>`:""}


     

        <td>
          ${this.getDocOption(t,"editDoc")}
        </td>
        <td>
          ${this.getDocOption(t,"printDoc")}
        </td>
        <td>
          ${this.getDocOption(t,"previewDoc1")}
        </td>
        <td>
          ${this.getDocOption(t,"previewDoc2")}
        </td>
        <td class="right-border">
          ${this.getDocOption(t,"previewDoc3")}
        </td>
       
        <!-- Layers -->
       
        <!-- pages -->
       <!-- <td class="right-border">
          hidden
        </td>-->

         <!-- ff-rules -->
         ${e.rulesCols.map((o=>html`
          <td class="ff-read ${e.rulesCols[e.rulesCols.length-1]===o?"right-border":""}" >
          <div class="ff-read" style="display: grid; grid-template-columns: 40px auto; border: none;">
          <select >
              <option selected>=</option>
              <option>&lt;</option>
              <option>&gt;</option>
          </select>
          <input type="text" value="${t.getRulesValue(o)}" @change=${e=>{var i,r;this.productMatrix.setRuleValue(t.index,o,null!==(r=null===(i=e.target)||void 0===i?void 0:i.value)&&void 0!==r?r:t.name)}}/>
            </div>
          </td>
        `))}
        ${0===e.rulesCols.length?html`<td class="right-border"></td>`:""}


         <!-- writes / Actions -->
         ${e.writesCols.map((o=>html`
          <td class="writes ${e.writesCols[e.writesCols.length-1]===o?"right-border":""}">
          <input type="text" value="${t.getRulesValue(o)}" @change=${e=>{var i,r;this.productMatrix.setWriteValue(t.index,o,null!==(r=null===(i=e.target)||void 0===i?void 0:i.value)&&void 0!==r?r:t.name)}}/>
          </td>
        `))}
        ${0===e.writesCols.length?html`<td class="right-border"></td>`:""}


         <!-- supplier info -->
         <td>
        ${this.getStringInput(t,"supplierId")}
        </td>
        <td  >
        ${this.getStringInput(t,"supplierSKU")}
        </td>
        <td class="right-border">
        ${this.getStringInput(t,"description")} 
        </td>

         
      </tr>
    `))}

    <tr>
      <td style="border: none;">
        <wc-icon primaryColor="headline" style="margin-left: 12px; width: 22px; height: 22px; margin-top: 5px;" icon="plus-square" @click=${()=>this.productMatrix.addProductRow()}></wc-icon>
      
      </td>
    </tr>
    </tbody>
  </table>
  </div>
    `}setLayerValue(e,t,o){return __awaiter$W(this,void 0,void 0,(function*(){yield this.productMatrix.setLayerValue(e.index,t,o),e.index===this.selectedRow&&this.productMatrix.apply(e)}))}getDocOption(e,t){return html`
     <select @change=${o=>{var i,r;this.productMatrix.setDocProperty(e.index,t,null!==(r=null===(i=o.target)||void 0===i?void 0:i.value)&&void 0!==r?r:"")}}>
        <option value="">
          [none]
        </option>
        ${Array.from(scope().docs.values()).map((o=>html`<option ?selected=${o.id===e[t]} value="${o.id}">${o.name}</option>`))}
      </select>
   `}getStringInput(e,t){return html`
      <input type="text" value="${e[t]}" @change=${o=>{var i,r;this.productMatrix.setStringProperty(e.index,t,null!==(r=null===(i=o.target)||void 0===i?void 0:i.value)&&void 0!==r?r:e[t])}}/>
   `}};return __decorate$W([property({attribute:!1,type:Object})],e.prototype,"productMatrix",void 0),__decorate$W([property({attribute:!1,type:Number})],e.prototype,"selectedRow",void 0),e=__decorate$W([customElement("wc-product-matrix")],e),e})();var __decorate$X=function(e,t,o,i){var r,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(s<3?r(n):s>3?r(t,o,n):r(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n},__awaiter$X=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};let WcLayoutSnippetsBar=(()=>{let e=class extends LitElement{constructor(){super(),this.collapsed="yes",this.snippets=html`loading ...`,this.snippetsTags="",this.which="snippets"}static get styles(){return css`

        :host, :host * {
          box-sizing: border-box;

        }

        :host {
          position: absolute;
          width: 200px;
          height: calc(100% - 100px);
          top: 50px;
          left: -200px;
          transition: left 0.5s;
        }
        .list {
          position: absolute;
          width: 150px;
          height: 100%;
          top: 0;
          left: -0;
          height: 100%;
          display: flex;
          overflow: auto;
          background: white;
          border: 1px solid black;
          background:#ddd;
        }
        .tab {
          position: absolute;
          top: 200px;
          left: 149px;
          width: 80px;
          height: 50px;
          transform-origin: 0 0;
          border-bottom: 1px solid black;
          border-right: 1px solid black;
          border-left: 1px solid black;
          border-radius: 0px 0px 7px 7px;
          padding: 10px;
          font-family: Lato, sans-serif; 
          font-size: 12px;
          display: flex;
          transform: rotate(270deg);
          justify-content: center;
          align-items: center;
          align-content: center;

          background: white;
          cursor: pointer;
        }

        .snippet-thumb {
          width: 120px; 
          height: auto; 
          margin: 8px;
          cursor: pointer;
          border: 1px solid #666;
        }
        .snippet-thumb:hover {
          border-color: var(--printess-headlineColor);
        }

        .snippet-list {
          display: flex;
          flex-wrap: wrap; 
          flex-direction: row; 
          align-items: flex-start;
          width: 100%;
        }

        .header-bar {
          display: grid;
          grid-template-columns: auto 1fr auto;
          align-items: center;

          margin-top: 20px;
          margin-bottom: 5px;
          background: var(--printess-headlineColor);
          padding: 4px;
        }
        .header-bar-title {
          font-family: Lato, sans-serif; 
          font-size: var(--printess-textSize); /* 16px; */
          text-transform: none;
          letter-spacing: 0px;
          color: var(--printess-headlineColorInverse);
        }
      
    `}redraw(){this.snippets=html`loading ...`,this.snippetsTags="",this.requestUpdate()}render(){return"yes"===this.collapsed?this.style.left="-150px":this.style.left="0px",!config.isBuyer||config.hideControls?(this.style.display="none",html``):(this.style.display="block",html`
      <div class="list">${this.renderSnippets()}</div>  
      <div class="tab" @click=${()=>"yes"===this.collapsed?this.collapsed="no":this.collapsed="yes"}</div>CHANGE LAYOUT</div>  
    `)}renderSnippets(){const e=scope().docUi.getSnippetClusterTags("layoutSnippets");return e?e!==this.snippetsTags&&this._renderSnippets().then((t=>{this.snippets=t,this.snippetsTags=e})):(this.style.display="none",this.snippets=html``,this.snippetsTags=""),html`${this.snippets}`}_renderSnippets(){return __awaiter$X(this,void 0,void 0,(function*(){const e=yield scope().docUi.getSnippetCluster("layoutSnippets");if(config.isBuyer){Math.max(...e.map((e=>e.snippets.length)))>0&&!1===scope().LayoutSnippetBarFirstTimeShown&&(scope().LayoutSnippetBarFirstTimeShown=!0,this.collapsed="no")}return html`
      <div  class="snippet-list">
        ${e.map((e=>this.renderCluster(e)))}
      </div>`}))}renderCluster(e){return html`
      <div class="header-bar" style="width: 100%;"><div class="header-bar-title">${e.name}</div></div>
      ${e.snippets.map((e=>html`
        <img src="${e.thumbUrl}" class="snippet-thumb"  style="background-color: ${e.bgColor};" @click=${()=>{api.insertLayoutSnippet(e.snippetUrl),this.collapsed="yes"}}/>
      `))}
    `}};return __decorate$X([property({attribute:!1,type:Object})],e.prototype,"selection",void 0),__decorate$X([property({attribute:!0,type:String})],e.prototype,"collapsed",void 0),__decorate$X([property({type:Object,attribute:!1})],e.prototype,"snippets",void 0),e=__decorate$X([customElement("wc-layout-snippets-bar")],e),e})();var __awaiter$Y=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};let _scope,_scopeIsInitialised=!1;function scopeIsInitialised(){return _scopeIsInitialised}function scopeReady(e){let t;try{t=_scope}catch(e){console.info("Scope was not ready ...")}t&&_scopeIsInitialised?e():window.setTimeout((()=>scopeReady(e)),10)}function scopeReadyAsync(){return __awaiter$Y(this,void 0,void 0,(function*(){let e,t=!0;do{try{e=_scope}catch(e){console.info("Scope was not ready ...")}e&&_scopeIsInitialised?t=!1:yield sleep(10)}while(t)}))}function scope(){return _scope}class Scope{constructor(e,t,o){var i,r,s,n;this.savedAfterOpen=!1,this._wcListGroupCache=new Map,this._e2e=new E2e,this.selectionPropertiesUiScrollTop=0,this._eddiActiveStory=null,this.externalSelectionChangedCallbacks=[],this.externalSpreadChangedCallbacks=[],this.externalFormFieldChangedCallbacks=[],this.externalGetOverlayCallbacks=[],this.LayoutSnippetBarFirstTimeShown=!1,this.croppingWcBox=null,this.lastCreatedBoxIds=[],this.buyerSideMode="rookie",this.skipAutoShowEddiForOneTime=!1,this.updatesBeforeBlurActiveElementOnNewSelection=0,this.baselineGridChanged=!1,this.localStorageTimeStamp="",this._in_redrawAllItemsWithClasses=!1,this.triggeredByChangeFrameSizeCount=0,this.eddiLastPersistetContent=null,this._globalFormFields=new Map,this._globalFormFieldsByName=new Map,this._variableDataTimestamp=Date.now(),_scope=this,this.fontsLoaded=!1,this.stage=e,this.id=o||generateDBID();const a=localStorage.getItem(this.id+"*template:"+this.id);if(a)try{const e=JSON.parse(a);e.data&&(this.templateProperties=new TemplateProperties(e.data))}catch(e){console.error("Template Properties not found in local storage.")}this.templateProperties||(this.templateProperties=new TemplateProperties({})),this.buyerPropertiesGroup=new BuyerPropertiesGroup([]),this.boxSelection=new WcBoxSelection,this.boxSelection.classList.add("no-zoom"),this.pathEditor=new WcPathEditor("path"),this.pathEditor.classList.add("no-zoom"),this.perspectiveEditor=new WcPathEditor("perspective"),this.perspectiveEditor.classList.add("no-zoom"),this.meshEditor=new WcPathEditor("mesh"),this.meshEditor.classList.add("no-zoom"),this.rubberBand=new WcRubberBand,this.rubberBand.classList.add("no-zoom"),this.eddi=null,this.textFlowToolActiveBoxId="",this.docUi=new WcDoc,this.stage.appendChild(this.docUi),this.docSelectorUI=new WcDocSelector((e=>{const t=this.docs.get(e);t&&this.selectDocAsync(t,!0)}),(e=>{alert("lsche:"+e)}));const l=document.getElementById("docSelector");if(!l)throw new Error("#docSelector div not found");l.append(this.docSelectorUI),this.readDocuments(t),this.globalResources=new GlobalResources,this.selectionPropertiesUi=new WcSelectionProperties;const c=document.getElementById("properties");if(!c)throw new Error("#properties div not found");c.append(this.selectionPropertiesUi),this.resourcesColorsUi=new WcResourcesColors,this.resourcesImagesUi=new WcResourcesImages,this.resourcesFontsUi=new WcResourcesFonts,this.resourcesStylesUi=new WcResourcesStyles,this.selectionDocUi=new WcSelectionDoc,this.resourcesTextStylesUi=new WcResourcesTextStyles,this.resourcesMacrosUi=new WcResourcesMacros,this.productMatrixUi=new WcProductMatrix,null===(i=document.querySelector("#dataPanel"))||void 0===i||i.append(this.productMatrixUi),this.resourcesFormFieldsUi=new WcResourcesFormFields,this.pagesUi=new WcPages,config.isBuyer&&(null===(r=document.querySelector("#buyerPages"))||void 0===r||r.append(this.pagesUi)),this.layersUi=new WcLayers,this.resourcesSnippetsUi=new WcResourcesSnippets,this.toolbarUi=new WcToolbar,null===(s=document.querySelector("#toolbar"))||void 0===s||s.append(this.toolbarUi),this.resourcesUi=new WcResources;const d=document.querySelector(".resources");if(!d)throw"div with class .resources not found.";if(d.append(this.resourcesUi),this.layoutSnippetsBarUi=new WcLayoutSnippetsBar,null===(n=config.providedContainerDiv)||void 0===n||n.appendChild(this.layoutSnippetsBarUi),this.copyPasteConsumer=this,this.eddiConfig=new EddiConfig((e=>scope().fonts_getByName(e))),this.eddiConfig.zoom=zoomFactor,this.eddiConfig.modelXToScreenX=modelXToScreenX,this.eddiConfig.modelYToScreenY=modelYToScreenY,this.eddiConfig.onOverflowChangeCallback=()=>{const e=scope().eddiActiveStory;if(e){for(const t of e.getWcBoxes())t.requestUpdate();e.hasOverflow=this.eddiHasOverflow(),this.boxSelection.getTextOverflowCtrl,this.boxSelection.requestUpdate()}},this.eddiConfig.onSelectionChangedCallback=(e,t,o)=>{var i,r,s,n,a,l;if(config.hideControls||config.isBuyer){if(scope().externalSelectionChangedCallbacks.length>0||!config.hideControls){const t=scope().eddiGetSelectedBox();let o="top",c=[];t&&t.box.storyRef&&(o=t.box.storyRef.verticalStoryTextAlign,c=t.box.lock.allowText);const d=[{id:"ED_selection",kind:"selection-text-style",label:"",value:"",textStyle:{color:"string"==typeof e.fontColor.value?e.fontColor.value:null!==(r=null===(i=e.fontColor.value)||void 0===i?void 0:i.toRgbHexColor())&&void 0!==r?r:baseTextStyleProps().fontColor.toRgbHexColor(),font:null!==(n=null===(s=e.font.value)||void 0===s?void 0:s.font.name)&&void 0!==n?n:Font.getFallbackFont().name,hAlign:e.horizontalTextAlign.value||"left",size:null!==(l=null===(a=e.fontSize.value)||void 0===a?void 0:a.toString())&&void 0!==l?l:baseTextStyleProps().fontSize.toString(),vAlign:o,allows:c}}];setOldBuyerPropertyKeys(["ED_selection"]);for(const e of scope().externalSelectionChangedCallbacks)e(d);config.hideControls||(scope().toolbarUi.property=d[0])}}else{const i=this.selectionPropertiesUi.getWcSelectionStoryRef();i&&i.onEddiChange(e,t,o)}},window.setInterval(this.eddiPersistCurrentContent,3e4),this.eddiConfig.regexStyles=[{regex:/\${(.*|[^}])}/g,style:{fontColor:"blue"}},{regex:/tab/g,style:{fontColor:"red"}}],this.eddiConfig.getStyleProperty=(e,t,o,i,r)=>{var s;let n;if(r){const e=scope().getBox(r);e&&(null===(s=e.box.docRef)||void 0===s?void 0:s.documentName)&&(n=scope().getDocByName(e.box.docRef.documentName)||void 0)}return this.getStyleProperty(e,t,o,i,n)},this.eddiConfig.changeFrameSize=(e,t,o,i)=>{let r=null;if(r=scope().getBox(t),r){let e=new Nobs;const s=r.box.boxGeometry.toPixel(r.spread.width(),r.spread.height()),n=i-s.height,a=r.box.boxGeometry.height.fromPixel_1Axis(i,r.doc.pageHeight);e.setProperty(r.box.boxGeometry,"width",r.box.boxGeometry.width.fromPixel_1Axis(o,r.doc.pageWidth)),e.setProperty(r.box.boxGeometry,"height",a);const l=new Box(e,r.box);if(l&&l.boxGeometry.width.toString()!==r.box.boxGeometry.width.toString()||l.boxGeometry.height.toString()!==r.box.boxGeometry.height.toString()){if(e=new Nobs,e.replaceObject(r.box,l),r.box.boxGroupId){const t=r.spread.getBoxesByGroupId(r.box.boxGroupId,r.box.id,s.top);for(const o of t){const t=o.boxGeometry.toPixel(r.spread.width(),r.spread.height()),i=t.top+n,s=o.boxGeometry.fromPixel(r.spread.width(),r.spread.height(),t.left,i,t.width,t.height,o.boxGeometry.rotation),a=new Nobs;a.setProperty(o,"boxGeometry",s),e.replaceObject(o,new Box(a,o))}}const o=this.selection.getSingleSelection()?[t]:[];scope().updatesBeforeBlurActiveElementOnNewSelection++,scope().updateDocReference(new Doc(e,r.doc),o,void 0,void 0,void 0),r.box.jsName&&this.redrawAllItemsWithClassesDebounced()}}else console.error("changeFrameSize: Update Position, BoxRef not found. Possibly just deleted.")},isIos()&&!isInStandaloneMode()){const e=document.getElementById("webAppNotification");e&&(e.style.display="block")}const h=document.getElementById("propertiesSplitterBar");h&&(h.style.opacity="1"),_scopeIsInitialised=!0,window.setInterval((()=>{const e=new Date,t=new Date;t.setSeconds(t.getSeconds()+10);const o=e.toISOString(),i=localStorage.getItem("open:"+this.id);if(i){const e=JSON.parse(i).ts,t=JSON.parse(i).sessionId;if(t&&e&&t!==config.sessionId&&this.localStorageTimeStamp&&this.localStorageTimeStamp<e)for(;;)alert("Another browser-tab has opened the same Scope.\nPlease close this Tab.")}localStorage.setItem("open:"+this.id,JSON.stringify({ts:o,sessionId:config.sessionId})),this.localStorageTimeStamp=o}),1e3)}setId(e){this.id=e,this.toolbarUi.requestUpdate()}get isPublished(){return scope().id.endsWith("~published")}get myUserId(){return createPrintessApiFromExternalConfig().userId}get filterPropertiesBySelectedFeature(){return!config.isBuyer}resetWcListGroupCache(){this._wcListGroupCache=new Map}getWcListGroup(e){let t=this._wcListGroupCache.get(e);return t||(t=(new Map).set("",{name:"",order:0}),this._wcListGroupCache.set(e,t)),"Images"!==e||t.has("Buyer Upload")||t.set("Buyer Upload",{name:"Buyer Upload",order:.2}),"Colors"!==e||t.has("Buyer Colors")||t.set("Buyer Colors",{name:"Buyer Colors",order:.2}),"Fonts"!==e||t.has("Buyer Fonts")||t.set("Buyer Fonts",{name:"Buyer Fonts",order:.2}),t}get colorScheme(){return this.colors.groups.has(this.templateProperties.colorScheme)?this.templateProperties.colorScheme:this.colors.groups.size>2?Array.from(this.colors.groups.values()).filter((e=>"Buyer Colors"!==e.name))[0].name:""}set colorScheme(e){if("Buyer Colors"===e)return;const t=(new Nobs).setProperty(scope().templateProperties,"colorScheme",e),o=new TemplateProperties(t,scope().templateProperties);update([scope().templateProperties.serialize()],[o.serialize()],void 0,!1).then((()=>{this.stories.forEach((e=>e.resetStoryCache())),this.currentDoc.spreads.forEach((e=>e.boxOrderHasChanged=!0)),this.docUi.resetCache=!0,this.docUi.requestUpdate(),this.resourcesColorsUi.requestUpdate()}))}get matrixProduct(){return this.productMatrixUi.getSelectedProduct()}set matrixProduct(e){this.productMatrixUi.setSelectedProduct(e)}get e2e(){return this._e2e}get isRecording(){return this._e2e.isRecording}get isReplaying(){return this._e2e.isReplaying}get colors(){return this.resourcesColorsUi.colors}set colors(e){this.resourcesColorsUi.colors=e}get style(){return this.resourcesStylesUi.globalStyle}set style(e){this.resourcesStylesUi.globalStyle=e}get images(){return this.resourcesImagesUi.images}set images(e){this.resourcesImagesUi.images=e}get allRecords(){return[{FirstName:"Christoph",LastName:"Clermont",Phone:"0170-3366604",Address:"Nassauische Strasse 25",City:"Berlin",Zahl:42,wines:[{group:"Weine"},{name:"Primitivo",description:"Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa.",color:"red",glass:"2.60",bottle:"21.00"},{name:"Burgundy",description:"Lorem ipsum dolor sit amet, consectetuer adipiscing elit.cAenean <w:red>commodo ligula<w:> eget dolor. Aenean massa.",color:"red",glass:"3.70",bottle:"29.00"},{name:"Bordeaux",description:"Lorem ipsum dolor sit amet, consectetuer adipiscing elit.cAenean commodo ligula eget dolor. Aenean massa.",color:"red",glass:"4.70",bottle:"34.00"},{name:"Riesling",description:"Lorem ipsum dolor sit amet, consectetuer adipiscing elit.cAenean commodo <w:white>ligula eget dolor. Aenean massa.",color:"white",glass:2.7,bottle:"23.00"},{name:"Chardonnay",description:"Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa.",color:"white",glass:"4.50",bottle:"33.00"}]}]}get currentRecord(){return this.allRecords[0]}get styles_all(){return[this.style,...Array.from(this.globalResources.styles.values())]}getClassesByField(e){const t=new Set;for(const o of this.styles_all)for(const i of o.getClassesByField(e))t.add(i);return Array.from(t)}getClassesByFrame(e){const t=new Set;for(const o of this.styles_all)for(const i of o.getClassesByFrame(e))t.add(i);return Array.from(t)}getAllClasses(){const e=new Set;for(const t of this.styles_all)for(const o of t.classNames)e.add(o);return Array.from(e)}style_classNameColorLookUp(e){let t;for(const o of this.styles_all){const i=o.classNameColorLookUp.get(e);i&&(t=i)}return t}images_getByUrl(e){const t=e.toLowerCase();for(const e of this.images.values())if(e.url.toLowerCase()===t)return e;return null}images_getByName(e){const t=e.toLowerCase();for(const e of this.images.values())if(e.name.toLowerCase()===t)return e;return null}images_getOrCreate(e){let t=scope().images.get(e);if(t)return t;if("string"==typeof e&&e){if(e=e.trim(),t=scope().images_getByUrl(e),t)return t;if(t=scope().images_getByName(e),t)return t;{let t=e;if(t.toLowerCase().startsWith("url(")&&(t=t.substring(4,t.length-1),t.startsWith("'")&&(t=t.substring(1,t.length-1))),t.startsWith("//")||t.startsWith("http"))return new Image$1("",t,"",0,0,"external");if(t.startsWith("data:"))return new Image$1("",t,"Data Url",0,0,"dataurl")}}return null}get fonts(){return this.resourcesFontsUi.fonts}set fonts(e){this.resourcesFontsUi.fonts=e}fonts_get(e){for(const t of this.fonts.values())if(e(t))return t;return null}fonts_getByUrl(e){for(const t of this.fonts.values())if(t.url===e)return t;return null}fonts_getByName(e){e&&"string"==typeof e&&(e=e.replace(/(^"|^')/g,"").replace(/("$|'$)/g,""));for(const t of this.fonts.values())if(t.name===e)return t;return null}fonts_getByNameOrUrl(e){for(const t of this.fonts.values()){if(t.name===e)return t;if(t.url===e)return t}return null}getStyleProperty(e,t,o=this.currentDoc.pageWidth,i=this.currentDoc.pageHeight,r){let s;if(e){const n=(r||this.currentDoc).getStyleAndRedrawItemsWithClasses(e).getProperty(e,t,o,i);if(n)s=n;else{const r=this.getUpToDateGlobalStyle(e).getProperty(e,t,o,i);r&&(s=r)}}return s}getUpToDateGlobalStyle(e){const t=this.resourcesStylesUi.getGlobalStyle();if(t.isEvaluationUpToDate(e))return t;const o=new Style("global",{txt:t.text},void 0,void 0,t);return this.resourcesStylesUi.globalStyle=o,o}getBoxPropertyValueIncludeStyles(e,t,o){const i=this.getStyleProperty(e.basics.class,o);return i?i.value:e.getValue(t,o)}get currentDoc(){return this.docUi.doc}set currentDoc(e){if(this.docUi.doc&&e.id==this.docUi.doc.id&&e.transferStyleCache(this.docUi.doc),e.setTemporaryParentBoxId(""),this.docUi.doc=e,this.pagesUi&&(this.pagesUi.doc=e),this.resourcesUi&&(this.resourcesUi.doc=e),this.resourcesStylesUi&&(this.resourcesStylesUi.doc=e),this.selectionDocUi&&(this.selectionDocUi.doc=e),this.selectionPropertiesUi){const t=this.selectionPropertiesUi.getWcSelectionDocBuyerSettings();t&&(t.doc=e)}this.resourcesSnippetsUi&&(this.resourcesSnippetsUi.doc=e),this.resourcesFormFieldsUi&&("local"==this.resourcesFormFieldsUi.selected&&this.resourcesUi.isFormFieldsSelected()&&document.activeElement&&"WC-RESOURCES"===document.activeElement.tagName||(this.resourcesFormFieldsUi.doc=e)),this.setStageColor(e)}setStageColor(e){const t=document.getElementById("stage");t&&(e.pasteBoardOpacity,t.style.backgroundColor=e.pasteBoardColor)}get selection(){return this.selectionPropertiesUi.selection}set selection(e){this.selectionPropertiesUi.selection=e}get hasSelection(){return this.selection.boxes.size>0||(!!this.eddiActive()||(!!this.perspectiveEditorActive()||!!this.pathEditorActive()))}get copyPasteConsumer(){return this._copyPasteConsumer}set copyPasteConsumer(e){e&&e!==this._copyPasteConsumer&&(this.toolbarUi&&(this.toolbarUi.copyPasteContextName=e.getContextName()),this._copyPasteConsumer=e)}get selectedTool(){return this.selectionPropertiesUi.selectedTool}selectToolCanCreateFrame(){return!config.isBuyer&&!config.isMobile&&this.selectionPropertiesUi.selectToolCanCreateFrame()}selectToolBoxType(){return this.selectionPropertiesUi.selectToolBoxType()}selectToolMouseCursor(e){return this.selectionPropertiesUi.selectToolMouseCursor(e)}get layersVisible(){return!!this.resourcesUi&&this.resourcesUi.layersVisible}get colorsVisible(){return!!this.resourcesUi&&this.resourcesUi.colorsVisible}get eddiActiveStory(){return this._eddiActiveStory}getActiveElement(e){if(e){const t=e.activeElement;return(null==t?void 0:t.shadowRoot)?this.getActiveElement(t.shadowRoot):t}{const e=document.activeElement;return(null==e?void 0:e.shadowRoot)?this.getActiveElement(e.shadowRoot):e}}readDocuments(e){this.docs=new Map,this.stories=new Map;for(const t of e)this.addDoc(t);e.length||(console.error("Scope initialized without document"),this.addDoc((new Doc).serialize(this.id)));const t=Array.from(this.docs.values()),o=t.filter((e=>e.isPrimary));this.selectInitialDoc(o.length?o[0]:t[0],!0)}serializeAll(e=!0,t,o){let i=[];if(t){const r=this.getDoc(t);if(!r)throw"serializeAll: Can't find specific Doc id=["+t+"]";i.push(r.serialize(this.id,!0,!1,e,void 0,o));const s=r.getAllSubDocuments(o);for(const o of s)o.id!==t&&i.push(o.serialize(this.id,!0,!1,e))}else i=Array.from(this.docs.values()).map((t=>t.serialize(this.id,!0,!1,e)));return{template:this.templateProperties.serialize(),colors:this.colors.getSwatches().map((e=>e.serialize())),fonts:Array.from(this.fonts.values()).map((e=>e.serialize())),images:Array.from(this.images.values()).map((e=>e.serialize())),style:this.style.serialize(),stories:Array.from(this.stories.values()).map((e=>e.serialize())),documents:i,productMatrix:this.productMatrixUi.productMatrix.serialize(),formFields:Array.from(this._globalFormFields.values()).map((e=>e.serialize())),dateISO:(new Date).toISOString()}}isModalDialogOpen(){return!!document.querySelector("wc-backdrop")}selectInitialDoc(e,t){e!==this.currentDoc&&(this.currentDoc=e,this.stage.style.width=this.currentDoc.pxWidth()+"px",this.stage.style.height=this.currentDoc.pxHeight()+"px",scanContentDimensions(e.id,!1,.5,(()=>{t||window.setTimeout((()=>scope().docUi.centerSpreadInView()),500)})),this.docSelectorUI.requestUpdate())}selectDocAsync(e,t,o=.5){return __awaiter$Y(this,void 0,void 0,(function*(){if(e!==this.currentDoc){showSingleTouchOverlay(""),yield asyncTimeout(100),this.currentDoc=e,this.stage.style.width=this.currentDoc.pxWidth()+"px",this.stage.style.height=this.currentDoc.pxHeight()+"px",scanContentDimensions(e.id,!1,o,(()=>{t&&window.setTimeout((()=>scope().docUi.centerSpreadInView()),1e3*o)})),this.docSelectorUI.requestUpdate(),yield this.docUi.updateComplete;const i=this.docUi.getSpreadInView();this.docUi.currentSpread=i,this.clearSelectionAndAllEditors(i),window.setTimeout((()=>{this.pagesUi.selectSpread(this.docUi.currentSpread.id)}),300),hideSingleTouchOverlay()}}))}addDoc(e){const t=new Doc(e.id,e);return this.docs=new Map(this.docs).set(t.id,t),this.docSelectorUI.docs=this.docs,t}getDoc(e){return e&&this.docs.get(e)||null}getDocByName(e){if(e)for(const t of this.docs.values())if(t.name===e)return t;return null}getStory(e){return e&&this.stories.get(e)||null}getSpread(e){let t=this.currentDoc.spreads.get(e);if(t)return{doc:this.currentDoc,spread:t};for(const[e,o]of this.docs)if(this.currentDoc!==o&&(t=o.spreads.get(e),t))return{doc:o,spread:t};return null}getBoxParent(e){if(!e)return null;const t=this.currentDoc.spreadsByBoxCache.get(e);if(t)return{doc:this.currentDoc,spread:t,box:e};for(const t of this.docs.values())if(t!==this.currentDoc){const o=t.spreadsByBoxCache.get(e);if(o)return{doc:t,spread:o,box:e}}return this.getBox(e.id)}getBox(e){for(const t of this.currentDoc.spreads.values()){const o=t.boxes.get(e);if(o)return{doc:this.currentDoc,spread:t,box:o}}for(const t of this.docs.values())if(t!==this.currentDoc)for(const o of t.spreads.values()){const i=o.boxes.get(e);if(i)return{doc:t,spread:o,box:i}}return null}getBoxByBuyerOrderNo(e){for(const t of this.currentDoc.spreads.values())for(const o of t.boxes.values())if(o.lock.buyerOrderNo===e)return{doc:this.currentDoc,spread:t,box:o};return null}createNewBox(e,t=scope().selectToolBoxType(),o="",i="",r="",s="",n,a="off",l="text",c){scope().isRecording&&!o&&scope().e2e.record({module:"scope",func:"createNewBox",args:Array.from(arguments)});const d=this.docUi.currentLayer;if(d.lock)throw alert("Can't create frame. The current layer is locked."),new Error("Can't create frame. The current layer is locked.");if(!d.visible)throw alert("Can't create frame. The current layer is not visible."),new Error("Can't create frame. The current layer is not visible.");let h=scope().docUi.currentSpread;if(o){const e=this.getSpread(o);e&&(h=e.spread)}if(!h)throw alert("Can't create frame.Please select a page first."),new Error("Can't create frame, no spread found.");const p=getOrder(h.highestOrder(),1),u=new Box(t,this.docUi.currentLayerId,void 0,void 0,p,r,s,n,a,l,c),m=new Nobs;m.setProperty(u,"order",p),i&&m.setProperty(u.basics,"class",i);const f=new BoxGeometry(0,0,100,100,0,void 0,void 0,this.currentDoc.unit),g=h.width(),y=h.height();if("auto"!==e)m.replaceObject(u.boxGeometry,f.fromPixel(g,y,e.left,e.top,e.width,e.height,0));else{let e=g/2,t=y/3;if(g>h.height()&&(e=g/8,t=y/4),u.simpleText&&(t="symbol"===l||"barcode"===l?e:e/3),u.imageRef&&(t=e*(u.imageRef.image.height/u.imageRef.image.width)),u.pathGeometry&&(e=t),u.docRef&&c){const o=scope().getDocByName(c);o&&(t=e*(o.pageHeight/o.pageWidth))}const o=this.getVisibleTopLeftPositionForNewItems(h),i=o.l,r=o.t;boxTypeE.story;let s=f.fromPixel(g,y,i,r,e,t,0);(config.isMobile||config.isBuyer)&&(s=new BoxGeometry((new Nobs).setProperty(s,"moverAnchor","cm"),s)),m.replaceObject(u.boxGeometry,s)}return scope().lastCreatedBoxIds=[u.id],create([new Box(m,u).serialize(h.id,scope().currentDoc.id)])}getVisibleTopLeftPositionForNewItems(e){const t=e.width(),o=e.height(),i=getCurrentScrollPosition(),r=e.pasteboardPosition(),s=e.spreadPosition(),n=Math.max(t/20,i.modelX-r.left-s.left+t/20);return{t:Math.max(o/20,i.modelY-r.top-s.top+o/20),l:n,w:appWidth()/zoomFactor(),h:appHeight()/zoomFactor()}}redrawAllItemsWithClassesDebounced(e=100){this.redrawAllItemsWithClassesTimeout&&clearTimeout(this.redrawAllItemsWithClassesTimeout),0===e?this._redrawAllItemsWithClasses():this.redrawAllItemsWithClassesTimeout=window.setTimeout((()=>{this._redrawAllItemsWithClasses()}),e)}redrawAllItemsWithEmbeddedExpressions(){}_redrawAllItemsWithClasses(){if(this._in_redrawAllItemsWithClasses)return;this._in_redrawAllItemsWithClasses=!0,this.eddiActive()&&this.eddiRedraw();let e=!1,t=!1;for(const o of this.currentDoc.spreads.values())for(const i of o.boxes.values()){if(t=!i.getAllVariables().isUpToDate(),!1===t&&i.existingClassNames)for(const e of i.existingClassNames)scope().style.classNameLookUp.has(e)&&scope().currentDoc.hasClassName(e)||(t=!0);if(t){const t=scope().docUi.getWcBox(i.id);if(t&&(t.boxGeometry=t.box.boxGeometry.includeStyle(t.box.basics.class,t.box.autoSizeMode),console_log(">>>>> REQUEST UPDATE FOR ["+t.box.basics.class+"]"),t.requestUpdate(),this.selection.has(t.box.id)&&(e=!0)),"do not wrap"!==i.basics.textWrapMode){const e=scope().docUi.getWcSpread(o.id);if(e)for(const t of e.getWcBoxesWithStory())console_log(">>>>>>>> Update all stories, current redraw ist mode wrap and can affect stories ["+t.box.id+"]"),t.requestUpdate()}}}e&&(this.selection=new Selection$1(Array.from(this.selection.boxes.values()),this.selection.spread,!1)),this._in_redrawAllItemsWithClasses=!1}fillStoryBoxLists(e){const t=new Map;for(const o of e.spreads.values())for(const i of o.boxes.values())if(i.storyRef&&i.storyRef.storyId){const r=this.getStory(i.storyRef.storyId);if(r){let s=t.get(r);s||(s=[],t.set(r,s)),s.push({doc:e,spread:o,box:i})}}for(const e of this.stories.values()){const o=t.get(e);o&&(e.myBoxes=new Map(o.sort(((e,t)=>e.box.storyRef&&t.box.storyRef?e.box.storyRef.order-t.box.storyRef.order:0)).map((e=>[e.box.id,e]))))}}update_DocAndSpreads_KeepBoxes(e){let t=!1;const o=this.docs.get(e.id),i=new Doc(e.id,e);if(o){for(const[e,r]of i.spreads){const i=o.spreads.get(e);if(i){const e=JSON.stringify(i.serialize(""))!==JSON.stringify(r.serialize(""));for(const[o,s]of i.boxes)e&&(s.basics.class||s.boxGeometry.anchorBottom||s.boxGeometry.anchorRight||s.boxGeometry.hasPercentages()||s.boxGeometry.hasEquations())?(r.boxes.set(o,new Box(new Nobs,s)),scope().selection.has(o)&&(t=!0)):r.boxes.set(o,s)}}Array.from(o.layers.values()).map((e=>e.id)).join("|")!==Array.from(i.layers.values()).map((e=>e.id)).join("|")&&i.spreads.forEach((e=>e.boxOrderHasChanged=!0))}this.updateDocReference(i,[],null,!1,t),i===this.currentDoc&&(this.stage.style.width=this.currentDoc.pxWidth()+"px",this.stage.style.height=this.currentDoc.pxHeight()+"px",scanContentDimensions(i.id,!1),o&&o.styleText!==i.styleText&&(i.updateStyleCaches(),scope().redrawAllItemsWithClassesDebounced()))}removeDoc(e){this.docs=new Map(this.docs),this.docs.delete(e),this.docSelectorUI.docs=this.docs,this.currentDoc.id===e&&this.selectDocAsync(Array.from(this.docs.values())[0],!0)}reRenderAllStories(){for(const e of scope().stories.values()){e.resetStoryCache();for(const t of e.getWcBoxes())t.requestUpdate()}}reRenderAllSubDocuments(e){for(const t of scope().currentDoc.spreads.values())for(const o of t.boxes.values())if(o.docRef&&o.docRef.documentName===e){const e=scope().docUi.getWcBox(o.id);e&&e.requestUpdate()}}updateDocReference(e,t,o=null,i=!1,r=!1,s=!1){var n,a;return __awaiter$Y(this,void 0,void 0,(function*(){const l=this.docs.get(e.id);this.docs.set(e.id,e),this.templateProperties.dataPanelHeight>0&&scope().productMatrixUi.requestUpdate();for(const t of e.spreads.values()){t.fillHitTestChache(e);for(const o of t.boxes.values())e.spreadsByBoxCache.set(o,t),o.jsName&&e.boxIdByJsNameCache.set(o.jsName,o.id),o.lock.isUiElement&&"none"!==o.lock.boundToBoxSelection&&e.boundUiBoxesIds.push(o.id)}this.fillStoryBoxLists(e);const c=1===t.length?t[0]:"";if(!this.currentDoc||e.id===this.currentDoc.id){if(this.currentDoc=e,s)scope().docUi.currentSpread=e.spreads.values().next().value,scope().docUi.centerSpreadInView("entire");else if(this.docUi.currentSpread){const t=e.spreads.get(this.docUi.currentSpread.id);t?scope().docUi.currentSpread=t:(scope().docUi.currentSpread=e.spreads.values().next().value,scope().docUi.centerSpreadInView("entire"))}if("lock"===scope().selectedTool&&0===this.selection.boxes.size){const e=scope().selectionPropertiesUi.getWcSelectionLock();e&&e.requestUpdate()}scope().resourcesStylesUi.localStyleEditorActive()||l&&l.styleText===e.styleText||scope().resourcesStylesUi.setLocalText(e.styleText);let d=scope().pathEditor.boxRef;if(d&&d.box.id===c){const t=e.getBoxRef(c);scope().pathEditor.boxRef=t,t&&(scope().pathEditor.path=t.box.pathGeometry,scope().pathEditor.geo=t.box.boxGeometry,this.selection=new Selection$1(null,null))}if(d=scope().perspectiveEditor.boxRef,d&&d.box.id===c){const t=e.getBoxRef(c);scope().perspectiveEditor.boxRef=t,t&&t.box.transform&&(scope().perspectiveEditor.path=t.box.transform.perspectiveGeometry,scope().perspectiveEditor.geo=t.box.boxGeometry,this.selection=new Selection$1(null,null))}if(d=scope().meshEditor.boxRef,d&&d.box.id===c){const t=e.getBoxRef(c);scope().meshEditor.boxRef=t,t&&t.box.transform&&(scope().meshEditor.path=t.box.transform.meshGeometry,scope().meshEditor.geo=t.box.boxGeometry,this.selection=new Selection$1(null,null))}if(this.eddi&&this.eddiActiveStory&&(d=this.getBox(c),d&&d.box.storyRef&&(d.box.storyRef.storyId,this.eddiActiveStory.id)),r)this.selection=new Selection$1(null,null);else{if(scope().perspectiveEditorActive()){const e=scope().perspectiveEditor.boxRef;e&&e.box.id===c&&null===e.box.transform&&scope().closePerspectiveEditor()}if(scope().meshEditorActive()){const e=scope().meshEditor.boxRef;e&&e.box.id===c&&null===e.box.transform&&scope().closeMeshEditor()}if(scope().pathEditorActive()){const e=scope().pathEditor.boxRef;e&&e.box.id===c&&null===e.box.pathGeometry&&scope().closePathEditor()}if(yield this.docUi.updateComplete,optainBuyerOverlays(),d=this.getBox(c),d&&("do not wrap"!==d.box.basics.textWrapMode||d.box.basics.tempFlag_TextWrapModeChanged))for(const e of d.spread.boxes.values())if(e.storyRef){const e=this.docUi.getWcSpread(d.spread.id);if(e)for(const t of e.getWcBoxesWithStory())console_log("++++++++++++++++++++ Story on Spread - RequestUpdate:"+t.box.id),t.requestUpdate()}if(d&&d.box.jsName){const e=this.currentDoc.getClassesByFrame(d.box.jsName);e.length&&this.currentDoc.getStyleAndRedrawItemsWithClasses(e.join(" "))}if(this.baselineGridChanged){for(const e of this.currentDoc.spreads.values())for(const t of e.boxes.values())if(!0===(null===(n=t.storyRef)||void 0===n?void 0:n.useBaselineGrid)){const e=this.docUi.getWcBoxesWithStory(t.storyRef.storyId);for(const t of e)t.requestUpdate()}this.baselineGridChanged=!1}if(i||this.selection.hasAny(t)){const e=[];if(i)for(const o of t){const t=this.docUi.getWcBox(o);t&&(t.box.storyRef&&"story"===scope().selectionPropertiesUi.selectedTool?(window.setTimeout((()=>{this.skipAutoShowEddiForOneTime}),200),e.push(t)):e.push(t))}else for(const t of this.selection.boxes.keys()){const o=this.docUi.getWcBox(t);o&&e.push(o)}const o=scope().getBox(c);if(o)this.selection=new Selection$1(e,o.spread,void 0,this.selection.crop);else if(i&&e.length){const t=scope().getBox(e[0].id);this.selection=new Selection$1(e,null!==(a=null==t?void 0:t.spread)&&void 0!==a?a:null,void 0,this.selection.crop)}}o&&this.selection.hasAny(o)&&(this.selection=new Selection$1(null,null))}}}))}showPathEditor(e){if(e||(e=this.selection.boxes.values().next().value),e){const t=scope().getBox(e.box.id);if(t){const e=scope().docUi.getDivForSelection(t.spread.id);if(e&&e.appendChild(this.pathEditor),!scope().templateProperties.showGrid){const e=scope().docUi.getWcSpread(t.spread.id);e&&(e.showGrid=!0)}this.pathEditor.boxRef=t,this.pathEditor.geo=t.box.boxGeometry,this.pathEditor.path=t.box.pathGeometry,this.pathEditor.clearSelection(),scope().copyPasteConsumer=this.pathEditor,this.clearSelection(!0)}}}pathEditorActive(){return!!this.pathEditor.boxRef}closePathEditor(){if(this.pathEditor.boxRef){const e=this.docUi.getWcBox(this.pathEditor.boxRef.box.id);e&&(this.selection=new Selection$1([e],this.pathEditor.boxRef.spread))}if(this.pathEditor.boxRef&&!scope().templateProperties.showGrid){const e=scope().docUi.getWcSpread(this.pathEditor.boxRef.spread.id);e&&(e.showGrid=!1)}this.pathEditor.close(),this.copyPasteConsumer=this}closeAllPathEditors(){this.pathEditorActive()&&this.closePathEditor(),this.perspectiveEditorActive()&&this.closePerspectiveEditor(),this.meshEditorActive()&&this.closeMeshEditor()}anyEditorActive(){return this.eddiActive()||this.perspectiveEditorActive()||this.pathEditorActive()||this.meshEditorActive()}get activePathEditor(){return this.perspectiveEditorActive()?this.perspectiveEditor:this.pathEditorActive()?this.pathEditor:this.meshEditorActive()?this.meshEditor:null}showPerspectiveEditor(e){if(this.closeAllPathEditors(),e||(e=this.selection.boxes.values().next().value),e&&e.box.transform){const t=scope().getBox(e.box.id);if(t){const e=scope().docUi.getDivForSelection(t.spread.id);if(e&&e.appendChild(this.perspectiveEditor),this.perspectiveEditor.boxRef=t,this.perspectiveEditor.geo=t.box.boxGeometry,!t.box.transform)throw"Perspective Editor could not be shown, transform feature is null";this.perspectiveEditor.path=t.box.transform.perspectiveGeometry,this.perspectiveEditor.clearSelection(),this.copyPasteConsumer=this.perspectiveEditor,this.clearSelection()}}}perspectiveEditorActive(){return!!this.perspectiveEditor.boxRef}closePerspectiveEditor(){if(this.perspectiveEditor.boxRef){const e=this.docUi.getWcBox(this.perspectiveEditor.boxRef.box.id);e&&(this.selection=new Selection$1([e],this.perspectiveEditor.boxRef.spread))}this.perspectiveEditor.close(),this.copyPasteConsumer=this}showMeshEditor(e){if(this.closeAllPathEditors(),e||(e=this.selection.boxes.values().next().value),e&&e.box.transform){const t=scope().getBox(e.box.id);if(t){const e=scope().docUi.getDivForSelection(t.spread.id);if(e&&e.appendChild(this.meshEditor),this.meshEditor.boxRef=t,this.meshEditor.geo=t.box.boxGeometry,!t.box.transform)throw"Mesh Editor could not be shown, transform feature is null";this.meshEditor.path=t.box.transform.meshGeometry,this.meshEditor.clearSelection(),this.copyPasteConsumer=this.meshEditor,this.clearSelection()}}}meshEditorActive(){return!!this.meshEditor.boxRef}closeMeshEditor(){if(this.meshEditor.boxRef){const e=this.docUi.getWcBox(this.meshEditor.boxRef.box.id);e&&(this.selection=new Selection$1([e],this.meshEditor.boxRef.spread))}this.meshEditor.close(),this.copyPasteConsumer=this}showCropEditor(e){this.closeCropEditor(),this.closeAllPathEditors(),this.closeEddi(),e||1!==this.selection.boxes.size||(e=this.selection.boxes.values().next().value);const t=e?e.box.imageRef?"image":e.box.docRef?"doc":"none":"none";if(e&&"none"!==t){const o=scope().getBox(e.box.id);o&&("image"===t?e.cropImg=!0:e.cropDoc=!0,this.croppingWcBox=e,this.selection=new Selection$1([this.croppingWcBox],o.spread,void 0,t),e.requestUpdate())}}cropEditorActive(){return!(!this.croppingWcBox||!this.boxSelection.crop)}closeCropEditor(){if(this.croppingWcBox&&(!0===this.croppingWcBox.cropImg||!0===this.croppingWcBox.cropDoc)){this.boxSelection.crop=!1,this.croppingWcBox.cropImg=!1,this.croppingWcBox.cropDoc=!1;const e=scope().getBox(this.croppingWcBox.box.id),t=this.croppingWcBox;this.croppingWcBox=null,e&&(this.selection=new Selection$1([t],e.spread,void 0,"none"))}}eddiRefreshActiveFrameInfos(){const e=scope().eddiActiveStory;if(e){const t=e.getEddiFrameInfos();if(0===t.boxDimensions.length)return void alert("Text Frames not found.");const o=this.eddiGetSelectedBox(),i=this.eddi;i&&o&&i.setFrames(t.boxDimensions,t.paths,t.wrapPaths,t.autoTextFrameSettings,e.serializedText,o.box.id,e.hyphenationLanguage)}}showEddi(e,t){if(e||(e=this.selection.boxes.values().next().value),e&&e.box.storyRef&&e.box.storyRef.story){const o=e.box.storyRef.story;if(o){this.closeCropEditor(),this.closeAllPathEditors();const i=o.getEddiFrameInfos();if(0===i.boxDimensions.length)return void alert("Text Frames not found.");let r=this.eddi;r||(r=this.eddi=new Eddi(this.eddiConfig,"",null,[null],[null],"edit")),this._eddiActiveStory=o,r.setFrames(i.boxDimensions,i.paths,i.wrapPaths,i.autoTextFrameSettings,this._eddiActiveStory.serializedText,e.box.id,o.hyphenationLanguage),this.copyPasteConsumer=r,config.isBuyer||config.isMobile||"story"!==scope().selectionPropertiesUi.selectedTool&&(scope().selectionPropertiesUi.selectedTool="story"),e.requestUpdate(),this.clearSelection(void 0,void 0,!1),config.isBuyer&&scope().selectionPropertiesUi.requestUpdate(),window.setTimeout((()=>{r&&(scope().stage.style.cursor="text",t?r.mouseTouchDown(t):r.firstParagraph.firstLine?r.selection.setStartByLineWord(r.firstParagraph.firstLine.firstWord,0,0):r.selection.reset())}),100)}}}eddiActive(){return!!this.eddiActiveStory}eddiInputElement(){const e=scope().eddi;if(e)return e.selection.input}eddiMouseRouting(){return{down:e=>{var t;return null===(t=this.eddi)||void 0===t?void 0:t.mouseTouchDown(e)},move:e=>{var t;return null===(t=this.eddi)||void 0===t?void 0:t.mouseTouchMove(e)},up_once:(e,t)=>{var o;return null===(o=this.eddi)||void 0===o?void 0:o.mouseTouchUp(e,t)},userInteractionStarted:!0,preventDefault:!0}}eddiSetFocus(){const e=scope().eddi;e&&e.selection.setFocus()}eddiGetSelection(){const e=scope().eddi;return e?e.selection.getSelection():null}eddiHasRangeSelection(){const e=scope().eddi;return!!e&&e.selection.hasRange}eddiSetSelection(e){const t=scope().eddi;e&&t&&t.selection.setStartBySelection(e)}eddiStyleSelectedContent(e,t=!1,o=!0,i="default"){this.isRecording&&this.e2e.record({module:"scope",func:"eddiStyleSelectedContent",args:Array.from(arguments)});const r=scope().eddi;r&&r.styleSelectedContent(e,t,o,i)}eddiStyleSelectedParagraph(e=null,t=null,o=!0){this.isRecording&&this.e2e.record({module:"scope",func:"eddiStyleSelectedParagraph",args:Array.from(arguments)});const i=scope().eddi;i&&i.styleSelectedParagraph(e,t,o)}eddiKeyDown(e){return!!this.eddi&&this.eddi.keyDown(e)}eddiGetFrameByBoxId(e){const t=scope().eddi;return t?t.getFrameByBoxId(e):null}eddiHasOverflow(){const e=scope().eddi;return!!e&&e.hasOverflow}eddiGetSelectedBox(){const e=scope().eddi;if(e&&this.eddiActive()){const t=e.selection.getSelectedFrame();if(t&&t.boxId)return this.getBox(t.boxId)}return null}eddiUndo(){const e=scope().eddi;return!(!e||!this.eddiActive())&&e.undo()}eddiGetSelectedFrameWidth(){const e=scope().eddi;if(e&&this.eddiActive()){const t=e.selection.getSelectedFrame();if(t&&t.width)return t.width}return null}eddiGetSelectedTextInfo(){const e=scope().eddi;return e&&this.eddiActive()?e.selection.getTextInfo():null}eddiFirstPararaphText(){const e=scope().eddi;return e&&this.eddiActive()?e.firstParagraph.toString():""}eddiFitFrameToText(){const e=scope().eddi;return e?e.fitFrameToText():null}eddiRedraw(){const e=scope().eddi;e&&e.redraw()}eddiPersistCurrentContent(){const e=this.eddi;if(this.eddiActiveStory&&e){const t=(new Nobs).setProperty(this.eddiActiveStory,"serializedText",e.serialize());t.setProperty(this.eddiActiveStory,"shortText",e.toShortString());const o=new Story(t,this.eddiActiveStory);this.eddiLastPersistetContent=o.serialize();const i=this.eddiActiveStory.serialize();JSON.stringify(i)!==JSON.stringify(this.eddiLastPersistetContent)&&(scope().updatesBeforeBlurActiveElementOnNewSelection=1,update([i],[this.eddiLastPersistetContent]))}}closeEddi(e,t=!0){return __awaiter$Y(this,void 0,void 0,(function*(){let o=null;const i=this.eddi;if(this.eddiLastPersistetContent=null,this.toolbarUi.property=null,this.eddiActiveStory&&i){if(t){const e=(new Nobs).setProperty(this.eddiActiveStory,"serializedText",i.serialize());e.setProperty(this.eddiActiveStory,"shortText",i.toShortString());const t=new Story(e,this.eddiActiveStory);o={old:[this.eddiActiveStory.serialize()],new:[t.serialize()]}}i.clear();const r=this.eddiActiveStory.getWcBoxes();for(const e of r)e.requestUpdate();if(e&&"none"!==e){const t=scope().getBox(e.box.id);t&&(this.selection=new Selection$1([e],t.spread))}else if("none"!==e)for(const e of r){const t=scope().getBox(e.box.id);if(t){this.selection=new Selection$1([e],t.spread);break}}}this._eddiActiveStory=null,this.copyPasteConsumer=this,o&&(yield update(o.old,o.new))}))}showTextFlowTool(e){this.selectionPropertiesUi.selectTool("textFlow"),this.textFlowToolActiveBoxId=e.box.id,this.clearSelection()}hideTextFlowTool(e){if(this.selectionPropertiesUi.selectTool("geometry"),this.textFlowToolActiveBoxId="",e){const t=scope().getBox(e.box.id);t&&(this.selection=new Selection$1([e],t.spread))}}addToSelection(e,t=!0){const o=[],i=scope().getBox(e.box.id);if(!i)throw"Can't add box to selection: corresponding spread not found";if(scope().selection.has(e.box.id)){if(!t)return;for(const t of this.selection.boxes.values())t.box.id!==e.box.id&&o.push(t),this.selection=new Selection$1(o,i.spread)}else{if(this.selection.boxes.size>0&&this.selection.spread!==i.spread);else for(const e of this.selection.boxes.values())o.push(e);o.push(e),this.selection=new Selection$1(o,i.spread)}}selectAll(e=""){const t=scope().docUi.currentSpread;if(t){const o=[];for(const i of t.boxes.values())if(!e||i.layerId===e){const e=this.docUi.getWcBox(i.id);e&&o.push(e)}return this.selection=new Selection$1(o,t),!0}return console.error("Can't select all boxes: no spread found"),!1}removeItem(){return __awaiter$Y(this,void 0,void 0,(function*(){return scope().selection.canRemove()?(yield remove(scope().selection.toIStoreObjects()),scope().clearSelection(),!0):(beep(),!1)}))}canCreateItem(){return!1}createItem(){return new Promise((e=>{e(!1)}))}getContextName(){return"Selection"}setClipboardData(e,t){return this.selection.setClipboardData(e,t)}getClipboardData(){return this.selection.getClipboardData()}clearSelection(e=!1,t=null,o=!0){if(scope().closeCropEditor(),t&&t!==this.docUi.currentSpread&&(this.docUi.currentSpread=t),this.selection.boxes.size>0){for(const e of this.selection.boxes.values())e.isInMultiSelection=!1,e.isInSelection=!1;this.selection=new Selection$1(null,t)}else if(t)this.selection=new Selection$1(null,t);else if(o)for(const e of scope().externalSelectionChangedCallbacks)e([]);config.isMobile&&"geometry"!==this.selectedTool&&!1===e&&scope().selectionPropertiesUi.selectTool("geometry")}clearSelectionAndAllEditors(e=null,t=!0){return __awaiter$Y(this,void 0,void 0,(function*(){this.eddiActive()&&(yield this.closeEddi("none"),this.selectionPropertiesUi.requestUpdate()),this.closeAllPathEditors(),this.clearSelection(void 0,e,t)}))}clearSelectionAndAllEditorsSync(e=!0){this.eddiActive()?this.closeEddi("none").then((()=>{this.clearSelection(void 0,void 0,e),this.selectionPropertiesUi.requestUpdate()})):(this.closeAllPathEditors(),this.clearSelection(void 0,void 0,e))}blurUiTextEditors(){this.resourcesStylesUi.hasFocus()&&(this.resourcesStylesUi.blur(),this.copyPasteConsumer=scope())}getContextMenu(e,t,o){return this.selection.getContextMenu(e,t,o)}hasTemplateSnippets(){return Array.from(this.docs.values()).filter((e=>e.isLayoutSnippet||e.isGroupSnippet)).length>0}setGlobalFormFields(e,t){this._globalFormFields=e;const o=new Map;for(const e of this._globalFormFields.values())o.set(e.name,e);if(this._globalFormFieldsByName=o,"global"==this.resourcesFormFieldsUi.selected){if(document.activeElement&&"WC-RESOURCES"===document.activeElement.tagName&&t)return;this.resourcesFormFieldsUi.refreshList(),config.isBuyer&&scope().selectionPropertiesUi.requestUpdate()}}getLowestGlobaleFormFieldOrder(){var e,t;return null!==(t=null===(e=Array.from(this._globalFormFields.values()).sort(((e,t)=>t.order-e.order))[0])||void 0===e?void 0:e.order)&&void 0!==t?t:.002}_SubscriberCallbackCommand_addOrUpdateGlobalFormField(e){const t=new Map(this._globalFormFields);let o;for(const i of e)i.data.o="scope",o=new FormField(i.id,i.data),t.set(i.id,o);this.setGlobalFormFields(t,o)}_SubscriberCallbackCommand_removeGlobalFormField(e){const t=scope()._globalFormFields;if(t.get(e)){const o=new Map(t);o.delete(e),this.setGlobalFormFields(o)}}hasGlobalFormField(e){return this._globalFormFieldsByName.has(e)}isValidFormFieldName(e){return!(e.indexOf("_")>=0||this._globalFormFieldsByName.has(e))&&getValidJsName(e)===e}getGlobalFormField(e){const t=this.getAllGlobalFormFields(),o=t.get(e);if(o)return o;for(const o of t.values())if(o.name===e&&"USER_CREATED"===o.systemType)return o}getAllGlobalFormFieldsHash(){const e=[];for(const t of this._globalFormFields.values())"USER_CREATED"===t.systemType&&e.push(t.__private_render_value_access_only_via_scope_getFormFieldValue);return scope().colors.groups.size>1&&e.push(scope().colorScheme),scope().productMatrixUi.productMatrix.rows.length>0&&e.push(scope().matrixProduct),e.join("|")}getAllGlobalFormFields(e=!1){const t=new Map;for(const o of this._globalFormFields.values())"USER_CREATED"!==o.systemType||e&&!o.visibility.startsWith("buyer")||t.set(o.id,o);const o=scope().colors.groups;if(o.size>1&&!o.has("Buyer Colors")||o.size>2){const o=scope().colorSchemeFormField;e&&!o.visibility.startsWith("buyer")||t.set(o.id,o)}if(scope().productMatrixUi.productMatrix.rows.length>0){const o=scope().productMatrixFormField;e&&!o.visibility.startsWith("buyer")||t.set(o.id,o)}if(scope().templateProperties.showDocumentSizeFormField){const o=scope().documentSizeFormField;e&&!o.visibility.startsWith("buyer")||t.set(o.id,o)}return t}get colorSchemeFormField(){var e,t,o,i,r,s,n,a,l,c;const d=this._globalFormFields.get("COLOR_SCHEME"),h=null!==(e=null==d?void 0:d.captionLookUp)&&void 0!==e?e:new Map;return new FormField("COLOR_SCHEME",{na:"COLOR_SCHEME",ca:null!==(t=null==d?void 0:d.caption)&&void 0!==t?t:"Color Scheme",lst:Array.from(scope().colors.groups.values()).filter((e=>"Buyer Colors"!==e.name)).map((e=>{var t,o,i,r,s,n;return{k:e.name,l:null!==(o=null===(t=h.get(e.name))||void 0===t?void 0:t.label)&&void 0!==o?o:void 0,im:null!==(r=null===(i=h.get(e.name))||void 0===i?void 0:i.imageId)&&void 0!==r?r:void 0,ds:null!==(n=null===(s=h.get(e.name))||void 0===s?void 0:s.description)&&void 0!==n?n:void 0}})),t:"string",v:scope().colorScheme,or:null!==(o=null==d?void 0:d.order)&&void 0!==o?o:.02,g:null!==(i=null==d?void 0:d.group)&&void 0!==i?i:"Auto Generated",tw:null!==(r=null==d?void 0:d.thumbWidth)&&void 0!==r?r:80,th:null!==(s=null==d?void 0:d.thumbHeight)&&void 0!==s?s:80,ics:null!==(n=null==d?void 0:d.imageCss)&&void 0!==n?n:"",vs:null!==(a=null==d?void 0:d.visibility)&&void 0!==a?a:"buyer",pr:null!==(l=null==d?void 0:d.priceRelevant)&&void 0!==l&&l,ui:null!==(c=null==d?void 0:d.uiControl)&&void 0!==c?c:"select-list"})}get productMatrixFormField(){var e,t,o,i,r,s,n,a,l,c;const d=this._globalFormFields.get("MATRIX_PRODUCT"),h=null!==(e=null==d?void 0:d.captionLookUp)&&void 0!==e?e:new Map;return new FormField("MATRIX_PRODUCT",{na:"MATRIX_PRODUCT",ca:null!==(t=null==d?void 0:d.caption)&&void 0!==t?t:"Matrix Product",lst:scope().productMatrixUi.productMatrix.rows.map((e=>{var t,o,i,r,s,n;return{k:e.name,l:null!==(o=null===(t=h.get(e.name))||void 0===t?void 0:t.label)&&void 0!==o?o:void 0,im:null!==(r=null===(i=h.get(e.name))||void 0===i?void 0:i.imageId)&&void 0!==r?r:void 0,ds:null!==(n=null===(s=h.get(e.name))||void 0===s?void 0:s.description)&&void 0!==n?n:void 0}})),t:"string",v:scope().matrixProduct,or:null!==(o=null==d?void 0:d.order)&&void 0!==o?o:.01,g:null!==(i=null==d?void 0:d.group)&&void 0!==i?i:"Auto Generated",tw:null!==(r=null==d?void 0:d.thumbWidth)&&void 0!==r?r:80,th:null!==(s=null==d?void 0:d.thumbHeight)&&void 0!==s?s:80,ics:null!==(n=null==d?void 0:d.imageCss)&&void 0!==n?n:"",vs:null!==(a=null==d?void 0:d.visibility)&&void 0!==a?a:"buyer",pr:null!==(l=null==d?void 0:d.priceRelevant)&&void 0!==l&&l,ui:null!==(c=null==d?void 0:d.uiControl)&&void 0!==c?c:"select-list"})}get documentSizeFormField(){var e,t,o,i,r,s,n,a,l,c,d;const h=this._globalFormFields.get("DOCUMENT_SIZE"),p=Array.from(null!==(t=null===(e=null==h?void 0:h.list)||void 0===e?void 0:e.values())&&void 0!==t?t:(new Map).values());return 0===p.length&&p.push({key:WcSelectionDoc.getDocSize(!1),label:WcSelectionDoc.getDocSize(!0)}),new FormField("DOCUMENT_SIZE",{na:"DOCUMENT_SIZE",ca:null!==(o=null==h?void 0:h.caption)&&void 0!==o?o:"Document Size",lst:Array.from(p.values()).map((e=>({k:e.key,l:e.label,im:e.imageId,ds:e.description}))),t:"string",v:WcSelectionDoc.getDocSize(!1),or:null!==(i=null==h?void 0:h.order)&&void 0!==i?i:.025,g:null!==(r=null==h?void 0:h.group)&&void 0!==r?r:"Auto Generated",tw:null!==(s=null==h?void 0:h.thumbWidth)&&void 0!==s?s:80,th:null!==(n=null==h?void 0:h.thumbHeight)&&void 0!==n?n:80,ics:null!==(a=null==h?void 0:h.imageCss)&&void 0!==a?a:"",vs:null!==(l=null==h?void 0:h.visibility)&&void 0!==l?l:"buyer",pr:null!==(c=null==h?void 0:h.priceRelevant)&&void 0!==c&&c,ui:null!==(d=null==h?void 0:h.uiControl)&&void 0!==d?d:"select-list"})}getFrameValue(e,t=null,o=scope().currentDoc){if(t){const e=scope().getBox(t);if(e&&e.box.docRef){const t=scope().getDocByName(e.box.docRef.documentName);t&&(o=t)}}const i=o.getNamedBox(e);if(!i)throw getNotFoundError("frame."+e);const r=i.box.boxGeometry.toPixel(i.spread.width(),i.spread.height());return{left:r.left,top:r.top,width:r.width,height:r.height,bottom:r.top+r.height,right:r.left+r.width}}getTargetDocument(e=null){if(e){const t=scope().getBox(e);if(t&&t.box.docRef){const e=scope().getDocByName(t.box.docRef.documentName);if(e)return e}}return this.currentDoc}getFormFieldValue(e,t=null,o=scope().currentDoc){var i,r;const s=t&&null!==(i=scope().getBox(t))&&void 0!==i?i:null,n=null!==(r=null==s?void 0:s.box)&&void 0!==r?r:null;if(s&&s.box.docRef){const e=scope().getDocByName(s.box.docRef.documentName);e&&(e.id===o.id||(o=e))}if("COLOR_SCHEME"===e)return scope().colorScheme;if("DOCUMENT_SIZE"===e)return WcSelectionDoc.getDocSize(!1);if("MATRIX_PRODUCT"===e)return scope().matrixProduct;if(e.startsWith("BOX_STEXT_")){if(null==n?void 0:n.docRef){const t=n.docRef.formFieldValues.get(e);if(void 0!==t)return t}const t=scope().getBox(e.replace("BOX_STEXT_",""));return t&&t.box.simpleText?t.box.simpleText.text:getNotFoundError(e)}if(e.startsWith("BOX_PTEXT_")){if(null==n?void 0:n.docRef){const t=n.docRef.formFieldValues.get(e);if(void 0!==t)return t}const t=scope().getBox(e.replace("BOX_PTEXT_",""));return t&&t.box.pathText?t.box.pathText.textOnPath:getNotFoundError(e)}if((null==n?void 0:n.docRef)&&o){let t=o.formFields.get(e);if(t||(t=o.formFieldsByName.get(e)),t&&"USER_CREATED"===t.systemType){const e=n.docRef.formFieldValues.get(t.id);return void 0!==e?e:t.__private_render_value_access_only_via_scope_getFormFieldValue}}if(e.startsWith("SUB_DOC_")){if(null==n?void 0:n.docRef){const t=n.docRef.formFieldValues.get(e);if(void 0!==t)return t}const t=e.replace("SUB_DOC_",""),i=scope().getBox(t);if(i&&i.box.docRef)return i.box.docRef.spreadName;const r=o.getBoxBySubDocumentName(t);return r&&r.docRef?r.docRef.spreadName:getNotFoundError(e)}if(e.startsWith("LAYER_")){if(null==n?void 0:n.docRef){const t=n.docRef.formFieldValues.get(e);if(void 0!==t)return t}for(const t of o.layers.values())if(e==="LAYER_"+t.id||e==="LAYER_"+t.jsName)return t.visible?"ON":"OFF";return getNotFoundError(e)}const a=o.formFields.get(e);if(a)return a.__private_render_value_access_only_via_scope_getFormFieldValue;const l=o.formFieldsByName.get(e);if(l)return l.__private_render_value_access_only_via_scope_getFormFieldValue;const c=this._globalFormFields.get(e);if(c)return c.__private_render_value_access_only_via_scope_getFormFieldValue;const d=this._globalFormFieldsByName.get(e);return d?d.__private_render_value_access_only_via_scope_getFormFieldValue:getNotFoundError("${form."+e+"}")}get variableDataTimestamp(){return this._variableDataTimestamp}ffChanged(e,t){if(this.externalFormFieldChangedCallbacks.length){let o=this._globalFormFields.get(e);if(o||(o=this.currentDoc.formFields.get(e)),o||(o=this.currentDoc.formFieldsByName.get(e)),o&&o.priceRelevant){let e=o.name;if("SUB_DOC"===o.systemType){const t=this.getBox(o.name.replace("SUB_DOC_",""));t&&t.box.docRef&&(e="SUB_DOC_"+t.box.docRef.documentName)}for(const o of this.externalFormFieldChangedCallbacks)o(e,t)}}}setFormFieldValue(e,t,o,i=!1){var r,s,n,a;return __awaiter$Y(this,void 0,void 0,(function*(){let l;if(console_log("scope().setFormFieldValue  of ["+e+"] to ["+o+"]"),this._variableDataTimestamp=Date.now(),"COLOR_SCHEME"===e)return scope().colorScheme=o,void this.ffChanged("COLOR_SCHEME",o);if("DOCUMENT_SIZE"===e){const e=o.split("x");if(2===e.length){const t=parseFloat(e[0].trim().replace(",",".")),i=parseFloat(e[1].trim().replace(",","."));if(t&&i)return yield WcSelectionDoc.setDocSize(t,i),void this.ffChanged("DOCUMENT_SIZE",o)}return}if("MATRIX_PRODUCT"===e)return yield this.productMatrixUi.setSelectedProduct(o),void this.ffChanged("MATRIX_PRODUCT",o);const c=t&&null!==(r=scope().getBox(t))&&void 0!==r?r:null,d=null!==(s=null==c?void 0:c.box)&&void 0!==s?s:null;if(e.startsWith("LAYER_")){if(null==d?void 0:d.docRef)return yield d.docRef.setFormFieldValue(d.id,e,o),void this.ffChanged(e,o);for(const t of scope().currentDoc.layers.values())if(e==="LAYER_"+t.id||e==="LAYER_"+t.jsName)return yield scope().layersUi.setLayerValue(t.id,"visible","ON"===o),void this.ffChanged(e,o)}if(e.startsWith("BOX_STEXT_")){if(null==d?void 0:d.docRef)return yield d.docRef.setFormFieldValue(d.id,e,o),void this.ffChanged(e,o);const t=scope().getBox(e.replace("BOX_STEXT_",""));if(t&&t.box.simpleText){const i=(new Nobs).setProperty(t.box.simpleText,"text",o);return yield update([t.box.serialize(t.spread.id,t.doc.id)],[new Box(i,t.box).serialize(t.spread.id,t.doc.id)]),void this.ffChanged(e,o)}}if(e.startsWith("BOX_PTEXT_")){if(null==d?void 0:d.docRef)return yield d.docRef.setFormFieldValue(d.id,e,o),void this.ffChanged(e,o);const t=scope().getBox(e.replace("BOX_PTEXT_",""));if(t&&t.box.pathText){const i=(new Nobs).setProperty(t.box.pathText,"textOnPath",o);return yield update([t.box.serialize(t.spread.id,t.doc.id)],[new Box(i,t.box).serialize(t.spread.id,t.doc.id)]),void this.ffChanged(e,o)}}if(e.startsWith("SUB_DOC_")){if(null==d?void 0:d.docRef)return yield d.docRef.setFormFieldValue(d.id,e,o),void this.ffChanged(e,o);let t=this.getBox(e.replace("SUB_DOC_",""));if(!t){const o=scope().currentDoc.getBoxBySubDocumentName(e.replace("SUB_DOC_",""));o&&(t=scope().getBox(o.id))}if(t&&t.box.docRef){if(o!==t.box.docRef.spreadName){const r=new Nobs;return r.setProperty(t.box.docRef,"spreadName",o),yield update([t.box.serialize(t.spread.id,t.doc.id)],[new Box(r,t.box).serialize(t.spread.id,t.doc.id)]),this.ffChanged(e,o),null===(n=scope().docUi.getWcBox(t.box.id))||void 0===n||n.requestUpdate(),config.isBuyer&&(null===(a=scope().selectionPropertiesUi.getWcSelectionFormFields())||void 0===a||a.requestUpdate()),this.templateProperties.dataPanelHeight>0&&scope().productMatrixUi.requestUpdate(),scope().redrawAllItemsWithClassesDebounced(i?0:50),void scope().redrawAllItemsWithEmbeddedExpressions()}return void console_log("Spread name not changed, new value equals old value.")}throw console.error("SetFormFieldValue for SUB_DOC: box not found or box has no Doc-Ref: "+e),"SetFormFieldValue for SUB_DOC: box not found or box has no Doc-Ref: "+e}if("USER_CREATED"!==FormField.getSystemType(e))throw alert("Setting non User Form-Field Value not handled for "+e),"Setting non User Form-Field Value not handled for "+e;if(null==d?void 0:d.docRef){let t;if(c){const o=scope().getDocByName(d.docRef.documentName);o&&(t=o.formFields.get(e)||o.formFieldsByName.get(e))}if(t)return void(yield d.docRef.setFormFieldValue(d.id,t.id,o));throw console.error("SetFormFieldValue for SUB_DOC: box not found or box has no Doc-Ref: "+e),"SetFormFieldValue for SUB_DOC: box not found or box has no Doc-Ref: "+e}if(l=scope().getUserFormFieldGlobalOrDocForValueWriting(e),l){console_log("set form value: "+o),l.uiUpdateValue=o,yield this._persistFormValue(l.id,o);return console_log(this.getUpToDateGlobalStyle()),scope().redrawAllItemsWithClassesDebounced(i?0:50),scope().redrawAllItemsWithEmbeddedExpressions(),void this.ffChanged(e,o)}throw alert("Form Field not found: "+e),"Form Field not found: "+e}))}getUserFormFieldGlobalOrDocForValueWriting(e){let t=this._globalFormFields.get(e);if(!t&&(t=this.currentDoc.formFields.get(e),!t))for(const o of this.docs.values())if(t=o.formFields.get(e),t)break;if(!t&&(t=this.currentDoc.formFieldsByName.get(e),!t))for(const o of this.docs.values())if(t=o.formFieldsByName.get(e),t)break;return t&&"USER_CREATED"===t.systemType?t:void(t&&alert("Forbidden write access to a system form-field value: "+this.id))}persistFormValueDebounced(e,t){this.setFormValueTimeout&&clearTimeout(this.setFormValueTimeout),this.setFormValueTimeout=window.setTimeout((()=>{console_log("set form value debounced: "+t),this._persistFormValue(e,t)}),1e3)}_persistFormValue(e,t,o=!1){return __awaiter$Y(this,void 0,void 0,(function*(){const i=scope().currentDoc,r=this.getUserFormFieldGlobalOrDocForValueWriting(e);if(r&&"doc"===r.origin){const e=(new Nobs).setProperty(r,"value",t),s=new Doc(e,i);this.updatesBeforeBlurActiveElementOnNewSelection=1,yield update([i.serialize(scope().id)],[s.serialize(scope().id)],void 0,o)}else if(r&&"scope"===r.origin){const e=(new Nobs).setProperty(r,"value",t),i=new FormField(e,r);this.updatesBeforeBlurActiveElementOnNewSelection=1,yield update([r.serialize()],[i.serialize()],void 0,o)}else console.error("_setFormValueDebounced: Form Field not found. ["+e+"]="+t),yield new Promise((e=>e("Form Field not found.")))}))}uiFrameClick(e){const t=this.getBox(e);if(t&&t.box.lock){if("none"!==t.box.lock.boundToBoxSelection){const e=this.getBoxByBuyerOrderNo(t.box.lock.boundToBoxSelection);if(!e||!this.selection.isSelected(e.box.id))return}if(t.box.lock.hasClickAction&&this.setFormFieldValue(t.box.lock.clickActionFormFieldName,"",t.box.lock.clickActionFormFieldValue,!0).then((()=>{this.selection=new Selection$1(null,null),this.docUi.updateAllClickableBoxes()})),t.box.lock.hasZoomAction&&"none"!==t.box.lock.zoomActionOrderNo){const e=this.getBoxByBuyerOrderNo(t.box.lock.zoomActionOrderNo);e&&(this.docUi.centerBoxInView(e.box,e.spread),window.setTimeout((()=>{const t=this.docUi.getWcBox(e.box.id);t&&(this.selection=new Selection$1([t],e.spread))}),10))}}}highlight(e){const t=this.findHelpUiElement(e);t&&(t.style.border="4px dotted red")}findHelpUiElement(e,t=null){let o=(t||document.body).querySelector(`[data-help='${e}']`);return o||(o=this.findHelpUiElement(e,this.resourcesUi.shadowRoot),o||(this.selectionPropertiesUi.shadowRoot&&(o=this.findHelpUiElement(e,this.selectionPropertiesUi.shadowRoot),o)?o:null))}}function generateDBID(){const e=(new Date).getTime();let t,o="P";const i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=i.length;for(t=0;t<20;t++)o+=i.charAt(Math.floor((e+Math.random()*r)%r));return o}let _doNextUndoStepForAll=!1;function setNextUndoStepForAll(e){_doNextUndoStepForAll=e}function create(e,t=eActionSource.user,o=!1){const i=e.map((e=>e.id));return saveUndoRedo({func:remove,args:[e],ids:i,doPrevious:o||_doNextUndoStepForAll},t),db.create(e)}function update(e,t,o=eActionSource.user,i=!1){if(saveUndoRedo({func:update,args:[t,e],ids:e.map((e=>e.id)),doPrevious:i},o),scope().isRecording&&scope().e2e.isTestRecording)for(let o=0;o<e.length;o++){const i=diff(e[o],t[o]);scope().e2e.addDiff(i)}else if(scope().isReplaying&&scope().e2e.isTestReplay){const o=scope().e2e.currentDiffs;if(o.length===e.length)for(let i=0;i<e.length;i++){const r=diff(e[i],t[i]),s=diff(r,o[i]);if(Object.keys(s).length>0){const e=scope().e2e.replayActivity;let t="";e?(console.error("Test-Error. module: "+e.module+" function: "+e.func+"  values:",e.args.join(", "),e.args),t=e.module+"."+e.func):console.error("Test-Error ... no current activity");const n=scope().resourcesMacrosUi.macros.get(scope().e2e.replayMacroName);n&&(n.state="failed",scope().resourcesMacrosUi.requestUpdate()),console.info("Saved mutation:",o[i]),console.info("Current mutation:",r),console.info("Difference:",s),alert("Test Error. See Console for details. "+t),scope().e2e.cancelReplay()}}}return db.update(t)}function remove(e,t=eActionSource.user,o=!1){const i=e.map((e=>e.id));return saveUndoRedo({func:create,args:[e],ids:i,doPrevious:o},t),db.remove(e)}function subscribe$1(e,t,o,i){return db.subscribe(e,t,o,i)}function unsubscribe(e){db.unsubscribe(e)}const undos=[];let redos=[];function clearRedos(){redos=[],scope().toolbarUi.canRedo=!1}function clearUndoAndRedos(){for(redos=[];undos.length;)undos.pop();scope().toolbarUi.canRedo=!1,scope().toolbarUi.canUndo=!1}function undo(){if(console_log("UNDO"+(new Date).getMilliseconds()),scope().eddiActive())return void(scope().eddiUndo()||beep());const e=undos.pop();e?(e.func(...e.args,eActionSource.undo,e.doPrevious),e.doPrevious&&undo(),setOldBuyerPropertyKeys([]),0===undos.length&&(scope().toolbarUi.canUndo=!1),scope().toolbarUi.canRedo=!0):beep()}function redo(){if(scope().eddiActive())return void beep();const e=redos.pop();e?(e.func(...e.args,eActionSource.redo,e.doPrevious),redos.length>0&&redos[redos.length-1].doPrevious&&redo(),setOldBuyerPropertyKeys([]),0===redos.length&&(scope().toolbarUi.canRedo=!1)):beep()}var eActionSource;function saveUndoRedo(e,t){t===eActionSource.undo?redos.push(e):undos.push(e),scope().toolbarUi.canUndo=!0,t===eActionSource.user&&clearRedos()}!function(e){e[e.user=0]="user",e[e.undo=1]="undo",e[e.redo=2]="redo"}(eActionSource||(eActionSource={}));class Font extends NobsBase{constructor(e,t,o="",i="",r=.2,s=75,n=25,a=0,l=0,c=25,d=""){if(super(e,t),this.canEdit=()=>!1,this.canRemove=()=>!0,this.canMove=()=>!0,"string"==typeof e&&"string"==typeof t){const e=t;if(this.url=e,o)this.family=o;else if(e){const t=e.split("/");t.length>0&&(this.family=t[t.length-1])}this.face=i,this.family=this.family.replace(/\..*/,""),this.ascender=s,this.descender=n,this.leading=a,this.lineHeight=l,this.spaceWidth=c,this.order=r,this.thumbSvgUrl=d}else if(!(e instanceof Nobs)){const o=t;this.id=e,this.url=o.u,this.family=o.fa,this.order=o.or,this.group=o.g,this.format=o.fo,this.face=o.fc,this.ascender=o.asc,this.descender=o.des,this.leading=o.lea,this.lineHeight=o.lhe,this.spaceWidth=o.spw,this.thumbSvgUrl=o.tsu||""}if(this.loaded=!1,this.error="",this.format||(this.format="truetype"),this.group||(this.group=""),this.id||(this.id=generateDBID()),!this.family||!this.url){if("[MONOSPACED]"!==this.id)throw"Font Constructor called with no family or url.";this.loaded=!0}null==this.ascender&&(this.ascender=75),null==this.descender&&(this.ascender=25),void 0===this.leading&&(this.leading=0),this.lineHeight||(this.lineHeight=100),void 0===this.spaceWidth&&(this.spaceWidth=25),void 0===this.thumbSvgUrl&&(this.thumbSvgUrl=""),"./fonts/NotoSans-Regular.ttf"===this.url&&(this.url="./printess-editor/fonts/NotoSans-Regular.ttf")}get name(){return this.face?this.family+" "+this.face:this.family}get cssName(){return"'"+this.name.trim()+"'"}cssUrl(){return this.toString()?"url('"+this.toString()+"')":"none"}css(){return this.toString()?`\n               @font-face {\n                  font-family: ${this.name};\n                  src: url(${this.url});\n               }\n            `:"none"}toString(){return this.url}serialize(e=!1,t=0){const o={u:this.url,or:t||this.order,g:this.group,fa:this.family,fc:this.face,fo:this.format,asc:this.ascender,des:this.descender,lea:this.leading,lhe:this.lineHeight,spw:this.spaceWidth,tsu:this.thumbSvgUrl};return{type:"font",id:e?generateDBID():this.id,scopeId:scope().id,parentId:scope().id,data:o}}static getFallbackFont(){return getNotoSans()}}class FontRef extends NobsBase{constructor(e,t=null){if(super(e,t),e instanceof Font)this.fontId=e.id,this.fontUrl=e.url,this.fontName=e.name,this.fontEquation="";else if("string"==typeof e&&null===t){let t=scope().fonts_getByNameOrUrl(e);if(!t&&"[MONOSPACED]"===e)return this.fontId="[MONOSPACED]",this.fontUrl="",this.fontName=getMonoSpacedFont().name,void(this.fontEquation="");t||(t=Font.getFallbackFont()),this.fontId=t.id,this.fontUrl=t.url,this.fontName=t.name,this.fontEquation=""}else if("string"==typeof e&&"object"==typeof t){this.fontEquation="",this.fontId="";const o=t;if(o&&scope().fonts.has(e)){const t=scope().fonts.get(e);t&&(this.fontId=e,this.fontUrl=t.url,this.fontName=t.name)}else if(o.fo.u){const t=scope().fonts_getByUrl(o.fo.u);if(t)this.fontId=t.id,this.fontUrl=t.url,this.fontName=t.name;else{const t=new Font(e,o.fo);this.fontUrl=t.url,this.fontId=t.id,this.fontName=t.name,create([t.serialize()])}}}this.fontEquation||(this.fontEquation=""),this.fontId||(this.fontId=""),this.fontUrl||(this.fontUrl=""),this.fontName||(this.fontName="")}get font(){if("[MONOSPACED]"===this.fontId)return getMonoSpacedFont();if(this.fontId){const e=scope().fonts.get(this.fontId);if(e)return e}if(this.fontUrl){const e=scope().fonts_getByUrl(this.fontUrl);if(e)return e}if(this.fontName){const e=scope().fonts_getByName(this.fontName);if(e)return e}return Font.getFallbackFont()}toCss(){return this.font.css()}serialize(){return{id:this.fontId,fo:this.font.serialize().data}}equals(e){return this.font.name===e.font.name}}function getNotoSans(){return new Font("DEFAULT1",{asc:106.900024,des:29.299927,fa:"Noto Sans",fc:"",fo:"truetype",lea:0,lhe:136.19995,or:1e-4,g:"",spw:26,u:"./printess-editor/fonts/NotoSans-Regular.ttf",tsu:""})}function getSymbolFont(){return new Font("DEFAULT2",{asc:106.900024,des:29.299927,fa:"PrintessSummer",fc:"",fo:"truetype",lea:0,lhe:136.19995,or:1e-4,g:"",spw:26,u:"./printess-editor/fonts/PrintessSummer.ttf",tsu:""})}function getDefaultFonts(){const e=[];return e.push(getNotoSans()),e.push(getSymbolFont()),e}function getMonoSpacedFont(){return new Font("[MONOSPACED]",{asc:102.5,des:27.5,fa:"IBM Plex Mono Medium",fc:"",fo:"none",lea:0,lhe:130,or:1e-4,g:"",spw:60,u:"./printess-editor/fonts/IBMPlexMono-Medium.ttf",tsu:""})}const beepSoundEasy=new Audio("data:audio/wav;base64,//uQRAAAAWMSLwUIYAAsYkXgoQwAEaYLWfkWgAI0wWs/ItAAAGDgYtAgAyN+QWaAAihwMWm4G8QQRDiMcCBcH3Cc+CDv/7xA4Tvh9Rz/y8QADBwMWgQAZG/ILNAARQ4GLTcDeIIIhxGOBAuD7hOfBB3/94gcJ3w+o5/5eIAIAAAVwWgQAVQ2ORaIQwEMAJiDg95G4nQL7mQVWI6GwRcfsZAcsKkJvxgxEjzFUgfHoSQ9Qq7KNwqHwuB13MA4a1q/DmBrHgPcmjiGoh//EwC5nGPEmS4RcfkVKOhJf+WOgoxJclFz3kgn//dBA+ya1GhurNn8zb//9NNutNuhz31f////9vt///z+IdAEAAAK4LQIAKobHItEIYCGAExBwe8jcToF9zIKrEdDYIuP2MgOWFSE34wYiR5iqQPj0JIeoVdlG4VD4XA67mAcNa1fhzA1jwHuTRxDUQ//iYBczjHiTJcIuPyKlHQkv/LHQUYkuSi57yQT//uggfZNajQ3Vmz+Zt//+mm3Wm3Q576v////+32///5/EOgAAADVghQAAAAA//uQZAUAB1WI0PZugAAAAAoQwAAAEk3nRd2qAAAAACiDgAAAAAAABCqEEQRLCgwpBGMlJkIz8jKhGvj4k6jzRnqasNKIeoh5gI7BJaC1A1AoNBjJgbyApVS4IDlZgDU5WUAxEKDNmmALHzZp0Fkz1FMTmGFl1FMEyodIavcCAUHDWrKAIA4aa2oCgILEBupZgHvAhEBcZ6joQBxS76AgccrFlczBvKLC0QI2cBoCFvfTDAo7eoOQInqDPBtvrDEZBNYN5xwNwxQRfw8ZQ5wQVLvO8OYU+mHvFLlDh05Mdg7BT6YrRPpCBznMB2r//xKJjyyOh+cImr2/4doscwD6neZjuZR4AgAABYAAAABy1xcdQtxYBYYZdifkUDgzzXaXn98Z0oi9ILU5mBjFANmRwlVJ3/6jYDAmxaiDG3/6xjQQCCKkRb/6kg/wW+kSJ5//rLobkLSiKmqP/0ikJuDaSaSf/6JiLYLEYnW/+kXg1WRVJL/9EmQ1YZIsv/6Qzwy5qk7/+tEU0nkls3/zIUMPKNX/6yZLf+kFgAfgGyLFAUwY//uQZAUABcd5UiNPVXAAAApAAAAAE0VZQKw9ISAAACgAAAAAVQIygIElVrFkBS+Jhi+EAuu+lKAkYUEIsmEAEoMeDmCETMvfSHTGkF5RWH7kz/ESHWPAq/kcCRhqBtMdokPdM7vil7RG98A2sc7zO6ZvTdM7pmOUAZTnJW+NXxqmd41dqJ6mLTXxrPpnV8avaIf5SvL7pndPvPpndJR9Kuu8fePvuiuhorgWjp7Mf/PRjxcFCPDkW31srioCExivv9lcwKEaHsf/7ow2Fl1T/9RkXgEhYElAoCLFtMArxwivDJJ+bR1HTKJdlEoTELCIqgEwVGSQ+hIm0NbK8WXcTEI0UPoa2NbG4y2K00JEWbZavJXkYaqo9CRHS55FcZTjKEk3NKoCYUnSQ0rWxrZbFKbKIhOKPZe1cJKzZSaQrIyULHDZmV5K4xySsDRKWOruanGtjLJXFEmwaIbDLX0hIPBUQPVFVkQkDoUNfSoDgQGKPekoxeGzA4DUvnn4bxzcZrtJyipKfPNy5w+9lnXwgqsiyHNeSVpemw4bWb9psYeq//uQZBoABQt4yMVxYAIAAAkQoAAAHvYpL5m6AAgAACXDAAAAD59jblTirQe9upFsmZbpMudy7Lz1X1DYsxOOSWpfPqNX2WqktK0DMvuGwlbNj44TleLPQ+Gsfb+GOWOKJoIrWb3cIMeeON6lz2umTqMXV8Mj30yWPpjoSa9ujK8SyeJP5y5mOW1D6hvLepeveEAEDo0mgCRClOEgANv3B9a6fikgUSu/DmAMATrGx7nng5p5iimPNZsfQLYB2sDLIkzRKZOHGAaUyDcpFBSLG9MCQALgAIgQs2YunOszLSAyQYPVC2YdGGeHD2dTdJk1pAHGAWDjnkcLKFymS3RQZTInzySoBwMG0QueC3gMsCEYxUqlrcxK6k1LQQcsmyYeQPdC2YfuGPASCBkcVMQQqpVJshui1tkXQJQV0OXGAZMXSOEEBRirXbVRQW7ugq7IM7rPWSZyDlM3IuNEkxzCOJ0ny2ThNkyRai1b6ev//3dzNGzNb//4uAvHT5sURcZCFcuKLhOFs8mLAAEAt4UWAAIABAAAAAB4qbHo0tIjVkUU//uQZAwABfSFz3ZqQAAAAAngwAAAE1HjMp2qAAAAACZDgAAAD5UkTE1UgZEUExqYynN1qZvqIOREEFmBcJQkwdxiFtw0qEOkGYfRDifBui9MQg4QAHAqWtAWHoCxu1Yf4VfWLPIM2mHDFsbQEVGwyqQoQcwnfHeIkNt9YnkiaS1oizycqJrx4KOQjahZxWbcZgztj2c49nKmkId44S71j0c8eV9yDK6uPRzx5X18eDvjvQ6yKo9ZSS6l//8elePK/Lf//IInrOF/FvDoADYAGBMGb7FtErm5MXMlmPAJQVgWta7Zx2go+8xJ0UiCb8LHHdftWyLJE0QIAIsI+UbXu67dZMjmgDGCGl1H+vpF4NSDckSIkk7Vd+sxEhBQMRU8j/12UIRhzSaUdQ+rQU5kGeFxm+hb1oh6pWWmv3uvmReDl0UnvtapVaIzo1jZbf/pD6ElLqSX+rUmOQNpJFa/r+sa4e/pBlAABoAAAAA3CUgShLdGIxsY7AUABPRrgCABdDuQ5GC7DqPQCgbbJUAoRSUj+NIEig0YfyWUho1VBBBA//uQZB4ABZx5zfMakeAAAAmwAAAAF5F3P0w9GtAAACfAAAAAwLhMDmAYWMgVEG1U0FIGCBgXBXAtfMH10000EEEEEECUBYln03TTTdNBDZopopYvrTTdNa325mImNg3TTPV9q3pmY0xoO6bv3r00y+IDGid/9aaaZTGMuj9mpu9Mpio1dXrr5HERTZSmqU36A3CumzN/9Robv/Xx4v9ijkSRSNLQhAWumap82WRSBUqXStV/YcS+XVLnSS+WLDroqArFkMEsAS+eWmrUzrO0oEmE40RlMZ5+ODIkAyKAGUwZ3mVKmcamcJnMW26MRPgUw6j+LkhyHGVGYjSUUKNpuJUQoOIAyDvEyG8S5yfK6dhZc0Tx1KI/gviKL6qvvFs1+bWtaz58uUNnryq6kt5RzOCkPWlVqVX2a/EEBUdU1KrXLf40GoiiFXK///qpoiDXrOgqDR38JB0bw7SoL+ZB9o1RCkQjQ2CBYZKd/+VJxZRRZlqSkKiws0WFxUyCwsKiMy7hUVFhIaCrNQsKkTIsLivwKKigsj8XYlwt/WKi2N4d//uQRCSAAjURNIHpMZBGYiaQPSYyAAABLAAAAAAAACWAAAAApUF/Mg+0aohSIRobBAsMlO//Kk4soosy1JSFRYWaLC4qZBYWFRGZdwqKiwkNBVmoWFSJkWFxX4FFRQWR+LsS4W/rFRb/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////VEFHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAU291bmRib3kuZGUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMjAwNGh0dHA6Ly93d3cuc291bmRib3kuZGUAAAAAAAAAACU="),beepSound=new Audio("data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjY1LjEwMQAAAAAAAAAAAAAA//tQwAAAAAAAAAAAAAAAAAAAAAAASW5mbwAAAA8AAADBAACeXQADBgkLDhETFhkbHiAjJicqLC8yNDc6PD9BREdJS01QU1VYW11gYmVoam1ucXR2eXx+gYOGiYuOkZOVl5qdn6Kkp6qsr7K0t7i7vsDDxcjLzdDT1djb3N/h5Obp7O7x9Pb5/P4AAAAATGF2YzU4LjExAAAAAAAAAAAAAAAAJATsAAAAAAAAnl1LLZhhAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/7UMQAAAn9VPd0EQAJhA6ldzmwAQAGAEYEAxkAAAJZjGN/QhCW/0Od//+hCEIQhG85z//875yE5zn//+pyEJ/6nOf/QhznOc5z/QhGkZTgYGLPmHh4/APDw8PeAGdDwB0cf//hAKhMHBIXhFAAAAAAAAIgQGBwwGNAg4gMUmYBuCgGkgn0kKHGc8bIXTgdASWeNDgYykKK9PE4OOchjYES3T07nOPSGoERmIimt3PP2+fupCkFDFwlUbkZ///n//5joK5/sAAAAQAJDa/8AAD/+1LEBQALhHNruawQUYCkKs+1MAIAAAAAaSOgqQnhAkRTzPCnHEkSOiLYXUGxEig5pqwqugqgNghB8GQtRjguEOmb2igwClCx2+vW/0vZOpctFXrcW9pNPHOTUpQH87r3m3/+6s/PBTgD8MBTMMwvBIADN0M4cDgxjoxYGEgpAc4xk64KIjhIwIERHQIdHLIaHuhYEPsUyeNyaMiYm6Dyiq5RZI8dNjIupqf5myJoplvV/////////26qlzmpd6lTdq35x4il6gFAAAB4EGQyQf/7UsQEg0tUcT5ubQ7RdI8njd4ZMqg2xjcoEWVMEkoVCJjkuGrNEdaIwXZxiICKBHVrcPIIEogFkMwUtRveB1PEDKSYwSWBRUk6RACgKNMFqCy1tnL3Hn9hkk4MWJKdyCHT/8kcd0AGAcAMwCLc0jIEysFcz3E4yCDUKhSFiuMklKOLAGMlj8iZpgoBnox2YmBJiMFHKQAYCDZv9KAoTrpMMB0aPY0NKcaCqt8vW2grJXSa9zsTg+6JijjSKm15///jetoAwAAAIDAw8GsyQkEx//tSxAaDS+RzOG7sTVlwj2dN3ZmjDBQ0YKMOYcGh6Y5JYY9FcD5xMBVpQ4mBYMm2x9mN4aGCv5/ZMSRh1b0ZgAuAYKWGYR5f9JxYUva37sqZQTBi9b1RbMSqduVpzKrYQWcn4bGtfoLoBwCFU4jJaDDHsMjL8sjGgWEAplMhRggH5O2AGOwSOtvTPNBDGgDBFHmQjxYhjEhEDLLXSwCmNKhEJPQqN9og8Cx31jLJ89yF5TkCx4EmBoqOkO37fi0HV0nDqgFQAAAwDDB0fjUcIjP/+1LEBoNLhHM2bvDJmXoOZs3drZuISzOpERAR5gAOxkcqBjyjJPsJmvMAgMAAAmmpKYpHIEN5ooJAhGGgjGiq1EtgRHZQmeSi6ow2TN/21bpdqUM46mIwemjIw9P5/+omVXcHAqgFBYYWmuZpVOYOg8ZtpQY/jcYBjMZdnkaopmfUA6Zbh4GK4YQgIYuoUFhMLsHeCYMaDgiEmKnpQrNGESgDZTBDdlwxJkU2sA5bIOSMUqmppA/KnUmvM//0mS3XhNUA0AAAxADTAhlOQeoIzf/7UsQHA0sAXTZud2ZZdowlzd9swJuKXmzgKARyc1gBrep58YKZgWpphkBpUFzGOE1Q1FEQ04JGSwDfgYZPGX4MLQrDpqcSlq1eA7sVZtvGdinO1sv1vCwMf/6jukLdCOA0HhjsMB2vBxsEKppDMxqiVphu2JrDPBkWgzGp0G+bQCnCg7YjMvQ60YMFejEQcDBZviQDgJS9cYNXRYNZUs1TprvHElzuJ8RmC2ArclF+AZTSzHKS3a0HNZyQWgTAAABACxd4witswHGwx2Z0wLKo//tSxAoDSfxZNG7pKtE5DCaNzKVawLVcx0gg2JTg6UFUwtNQVACCTZwzlBhlAPgxGbUASAfdaJMoXFDE+sbsaSLDKoyKRLLFjuE0gWBrlDU2E4BosmKT0eQ4Ru04mJdIb8KJjSHnULIcNUh8IXmSRoNIBqQSYaLahwnsQqmeaoTK74NMpL0iDwuNilAXFVrnYI4nWl4ChUhREgZdutFEVQ3AAAC7JgofHj+odSHhLvTo51MAEs8IwDZ5IOsDEw2XTDgFIQDdQAsAqOEZDBZumzf/+1LEGINJZGEybmUq0TgMJc3u5FB1kIoe/NPaIpDKCVnumQsIaQEB0S0laPOXigt4DAQDAJDtMHxCUxCQZjOuQDM85jA4qDPIcjNEFTRAHTItBZ7SDUXPwUGMpslUUwwlObs8zR+o3v6exbqSS/3PdXfMsKehtVs7vmOEzCoT0AAAxUBswHDE5IpQyJSM2+mk3+GkwaPIyjEYzvDI0+AswNIgHB08huzG6CSvoQEB5uiTEy+JCLWp8BtYiHKgPS1JhrFj7cWTMmgVNuqGgBAQZP/7UsQpg0nIXyxu5SrBFwvlSdylIoE0d93wa6Podi0kZTlaYXjUaskIZ1hmZ2BidrQ14v8wtzEKFExqhbImUrTZghJl18LyolXMrTQbaWf3BeGsq2jrMwAAAMB4DgwCwljB2ZJMUExcyzBGTCxCAM1UToXA7tTOaJxRlCDV5iEmKoSqUWPWAAIPb2lftBFyivFogYK1m7eplvsQg0SYBP///////XtVoBg8AVmGGJQaWDcxhcm8GOyCkYWwFBlkqc8BHGupsAeZAViw3IASNlkk//tSxD2DSghfKG9sxYE6C6SN7Yyw7g4dTsTbheLLUOsg50hiAjcfoAcYBAgI2DQFTtH//////+2uEjAAAMCoCkwCCATd5IbMdonU6cPzF5dJQAbSL5lc4hhBERQHg08QEABb0YAD4p/IUKfutaYJB+dorLTypzSq+Uw2SjZ1zfkf/////+ytSDCCACMOwkE7CHkTCZFKO+oYySYjBBoAidMbolEM3+A4CkKF2LDJRE2wIxgoGp1orDXqPkx9Tu7+v/LH/qiZDf3xX//////mq33/+1LETANJuFkib3DDwSeKI4nuZFD8AABQchgzkCHBnKQYW4jx1WiHkIFIjWQQw+TQ3MOByIRiI4C0cNIPNyQGSbCAGewLYxFe0nFqp6eOBarhS1zP//////2V6WAMFwDow50UTV0tvMaAnU+YMEKujgD4w12BMFAxClJMycmBYVmUDrCgMERS819YWLzvTl5PPz/R8LvFP////2f/92+R/yX/0X9qAGk3EiCb8hnbI5hEp5GJSH4etMds4QGAFRNqzEm4KDqh6j1Y2lhmnTLM6P/7UsReA0jgVxxPbMPBJoljCe2YeJuEu3lvv2igOET0r3+7rt6Pov6+3R/+yp//0+2e/45fkAMXgUMmLAPAQLM4AFOZLH2ghTHJCm/UhlsUOv+9BYt56DpTIhNtuTukcaUPg0jRXaq7xXoR/Z//b/3eR///6tCX/voAAak9XG0jIQMM2hU6ZuzEBRO+gCOfE/gY5RMIDKAyPC43IEmke0Rte7nSYj225py799v5h9Hb+j+5Dlb571Np/osv/kH6qEmYJi54mnOwapPR0UmOgQGs//tSxHOCCUA9HO37QAESBmMJ3TxYxLZk0QQh9k+VldINfU0/s1ARen3a/R/i//v+TKaVKN7jbfd/9Fl34u3Z6muAQ8Sg02kBr40kUzlQCQUdTiRZGTPQ8+V90IPyc6hf7n7rmHr0d/a0UbUinZo0/9/+339tL1x1tFy1dOqzO8nr6mEAAFJg1GhDXHxMGlcLEB32RmpIcxYJRWQ0CbIjDRejOUm9yIqire/9lv7+/T7PSrR5diulE9m7zp9uLtShPOam2oW1ktTVM2AswMXTVkz/+1LEigIImDshTmFigPkF40nMvFAMzlAQ7LIMFPRTMAoAxGRxMBoPjhUbd+obnH//7Pndbb/1a+9Ku4h99Jr8U7fqjcBZxyicklDbwDjTSRRAWpuQnlUDQFWxlL4MBYI1ACX6DOpz99BXnr/d3v++tnq1+oqr//m30Exqb/T7ZrRyHv9KAAAAAtsrbiQ1BS0ES0NQ/HY6HcfEA8VeNPfcZ111X9rWW7LtXF+6HOILvv300O32R9R73exPuwptNSDTF1wxDGNlFiIMKACUjQMjCv/7UsSmgwhALxZNcyABGIXiScwkWLTHbHYlU1LdgFqM3pX0tXqs0vVLbm2uV/V1W3dLnxPtTiWfn2al8WGmaubka28JD7K59pUiLQRkgTMMTxmQ4CfBMMjoWUGCgjkYM/YktaylIXRTjwJSLNsORhJIZEwcNsJEX7i74w43sJu49q1bm+tDwFxexc85LD2lqqvXkjol5dJDqlFsm3olWzIpT9u0qzQ/cvK3zLtpMryMZlVMibV1CG5sPPzcxHkDUE4JnwUMsiUuYiC7kHBi9MxB//tSxMACB+gvEg5hIsDhhKNpnRgYOwWpA4sLHS850nTJB6ktVdDGXZFXbm4wroz4tqL/UwKmjK2nQ9kJXbXzbtunD6qwjzN6Ztm02ZEIFwgfyTZC/KsRFGKQmP5tAgolpFSO0x5Q4eKtdGDqxOsbmg7jsSAAADbVZrymOEZKDXQCJpkmmE+ZqCPm85N7CIydyXdApvTnWGXI/JnunDOZOTCcr9EkPCkU1UMdiwme5dDq8yS+Z9RzzS2upQjMoqCxWYzYd2gYFxWGUGcYIgEWuAL/+1LE4gIHIBUfrGmAAbM1oQGyjfmUMjnRsUY8GzX1/avpr4obLDwklPNlE62KysnfXBI5aME6siFrprIUy5nnS17015XRiNkhumh/C2OPqGj02gglJwhmZJ50Q0RrvMam4hRfTY1yEmB0NjQUH3XCCBAGmd3Qzf+9EtSRwz8ifRslKRfpuVBZEcz5dnhJ2HEfD14caG6s26MGHfm0UpbOxtMlSMTSUj8qp1htnRjEDJMxamQiCEWhngBNyOBpRNjqdF1fFqYOsBsaXhdBOOU4N//7UsTtAswdjwgNBG/JfDXhFSCOOfM1acrdarZ3aG7mIpPRnmKRCk+0a7U4Vz7VV1yUlTLKFSW9gOHYC2HylVDd1RDnMS18IrEriJmKN2KtEbnAOCtNEckJBGSgh2FsfuIuiRQQs1cBdg7gsERAkGRyIYpKBtZ6WtNmJQqublA20hShmjTM7RHQcYTNh30ql/5D96PNq6HI1X8zzPDzMzLdc7MraZySsXCaeZUZHYcRsedrg1UXW0nsiKa7iWTQMpqGYDBI7A2s4GU3oaCkIOBu//tSxOsDzJmnBqOEaclYtiEAcI45FYwiDCQSAD60u1qtRdMiz6fZmGTnM4vu0SuUyJLZm3cBqF0rzbOS3hw4r3SZ35GkvUX5vlTXfXO5E1vnaZQ/1q4cIxKP4Q3EmXrbVMWRkhERqSamgK8ZHDjorp4ygAA12MSucnRtdyzgVmyPtQnMabhvYG2JopFFGx6bM47ZBKW01Sgodj+9azgomiLk4N0F7cQMlOUIpIfJoVcyaAhsIWRm8RmJCy/z6zNqeQRjMPiTzIQKIV4PgVhAwtr/+1LE64PLta8GA4RryX+14MBwjblwT9tGctycCPmughvCFOXsL+I0yIzYEXx9txts1yK/mzP8T5Po+Glu5RF8jYjEQiGiMFI2TSXmTZmK5jRulYCZIRiqSMY0rUAJQTgyYzQAg7iSNQZYcEQNMMS7SOkYIMQ+GAAAAAazO1kfSe99nuvJ5nfSkIpylt6PBI2SI+0UtX6P75lVMjrerHDlNF+m1aQ8ghZKiMWxFHV8ot/PFqdxGo00PbKGOOG4ZkwKJj8T08Gnj/JtaTilEPsoqf/7UsTqgMwhrwYDhG3JXzRhIHCN+cgFAA3Zmz7USrdnngJBmZGepGUzMBBLIiGXs9HTbapjqLmCwm1KlrDtbM8uSQFeSnM7mdbKYtnN/YyLPoMxcN8oLyJQqPLZbK4emEZQEzOEZmVeUgqPuaMeEUFg5T0hQAAlNtRtd7ek8ymy3Ps70az5GYa0GVUNTkjFw/nDj5tK/SUuHO/bHVVEWQFGYvyZqmdFkHI+3VC5RyzQInXha6MbIuazwpEeDN6gVDMm0cdHiI+xkyIGaQZUAQh2//tSxOwAzBGvBqOEccmBNeDAcI056t/N2+JZwyKq56mI1nN4iZuY+frke2f6Nyt9NE42MxHUJUDepzdz1QGZchag8zvWaLvpmp7lwOiEWS7lUSEgo/U1IQrp1a5DXKK7sWbzIQsvdZylJbXmUlJFOQYxDhcEy0kAyt9kBBfQZQbzfOOn7+/upQnrHnINipeatykdR7RGiI5U+clPVnN+sWVLkcqUnZmef5fdJnTrR4RwzYzLkgI6LVeL1zROxSVaxYHb2PkKXIMsCkyLKTR8xJ7/+1LE6YDLaa8JA4RvyXW0YSBwjjlhwgNYGzzNmroiWyMjj3VAGYwEw3IraOFnNWczbzuYiYclzprwyQrQUdMiUanQTvjqldZujl5fdYvgztZtHg4tmLIIQowkcUjIG1yYtrF4RMsM9wvMoDeoCECVY2EjqedrAjBJFQbszVWh8JzGfRZDuQeVMiVU4N1HImrJ98i/0BnSxMy7fPIjin2NRtd+jqRVHbBvsZm66BnyTBJzU5sFjPRaGHimUUHrwxVMMaHA8ULN0JeABqzkPg5zc//7UsTrAEsprQijhG/JuTZgoLGa+JgKqFrJYdDEgE1X3S1VWqVsMn4VY5qebjGvsdQCY/OdszYimSlMDZ8wxJvja2xqRbR0GrSpd8wlEUETmDM+h5DisEmUeHEoIA3oNFHBnYlAt6ZGIBF9QKTMbCQWQrZdRYZFckZSCBDYBrURUWYbVHq7vOIjzJtNI0yRoRZEiu9DmazRIWiLRRyKNWtjJAbGHVb00+5g75MiqSCzRSeGCc2mjLWQyUvcwEFMKJBu3lHMmgwajsCJCQUbDtB4//tSxOUDyrmxCAOEb8mCNWDAcI35GqBVhFTkGMZisrQVRx6gckgKkAGlvelzelGqkjzz0BbP90fyOAiLXuIjIpalH5ZtPMZ/JpxtX+5l6Q6vd9SIpSikXWzRDN8qTvuSClUxvn9YzMyI6RefnxmVsa+EZbQvL+dVAhEAAAbpdqXpahm9KMYdWb9//Pmasct+Uv+U0lPsr7/0rX80hIjFS9KxZpH6fDlkTbLKRSHumlEWKWyqRg9zNqUkOoWdLnG73jM7/O/xmkxL6W4c5/E2W3L/+1LE54PL8bEGA4RrwX414MBwjjly6AWYAAAJWSyvZkIjEoVREe0rqZ0blIGJczONLOs5aqf4c25k5faPdMtUlPI4r5E7Rj6CTLAta6mrlATnIjywiXDq0P6l8iwWCMbQUSBGdHBRSomE5xozDK1RTg5kzuXor2iCXEsqDUwAAA/RqMuqVT7qli+pkawX5uiyIAs0W7IPV0RESLH1RnROiKIla4k1+CPNnIr9hH7taR/khmhiG8IWR5NlncSeR0a9d+EYzMRWbKmEjox6mzPio//7UsTmAMyVsQYDhG/BRrKhYHCOOQO7aP7JO9Vdi3UxSMta+fmeUn3U1Mlrd+pl0o04vDUzuplIpCSXFi4plLuaXpKRqJ/ucwp67xYtgtipEJ207ck7pyv68PpgEy3fa2KkqpSSMikbr3saTaJ1KTND07I4+7KOuliCKxMAEAAEtXVFRrsyVnpY9OTNNyjkRMscZfZkKj4tnMVBkQcG83LmHCoCMZmm5TSWcM0PsRvvqlKOU/eRAbRE9czoMd9EZVlBU16V5emIwzegskQiiidB//tSxOiAy4WdCQOM2YmMNmDgcI14m6DYKcN15i9LTntV7TtNTK/a0618jLL8qbHamSz4SEaHgzv5vkaycDuelM2+jo4JYRH74tm/bG3m+3hJZ84sD7PaCJml1VYkc2Io7rsgUpJ3Y8w402mTNT29eWeTLWSvFFMm71nY7Ci2K8mMVWUG3atU2tvy6uTxeyzfLpkb2yO7mozk/Jamp02OLmmUphD7/DQjOyl2djEPILcjpymh2oR5/FzSzGYTqbH2LHNLLTfiHDNxXCBghUY5+pv/+1LE5oDKqasLA4RzwZa1IIChmrkTIxhg60vASRfq/Fj2bgXwK5+OUf9ztr0kP8vGt84d859kcy2tWO/DF5Gnb6rP3yd3Zw7eruxKaEbk2ehm6gyQgpiw6t4RULemRRHGJWURkJmzottAHDkg1GDqaMGYExB6AOGIGapAAAB+2zXsy72p+90sIi6/CE6jzS+YTSLOaAQ2JuHBN6Avmmap/ktqVEWE8UmZnLEBrkYsiJTdJSLBvmhJ1oIauS9yMlRiM2rKZKcby0qJsaGxjRJDMv/7UsTnAMtJnQkDhHPJpTWggKGa6Qri4AD6a0RKoqbK3yLBkGAvOyP6u8EBpmY52gJRpv7d+BHF6bGZUywxnkKtlyRCg1IGqk1ews/VEvAxGF+oqmREUzdxlDZBD4ESmY9LV33YHOBYmgJCGQgGZAyU9QbVpi+megMkZuigLtSls/IfdDsaRNEGE4fJDyB9udM6rr33JiHOZldWrwJMq5bngpxkhrC7lHcoOclJEU4GFYklR4UpwnM1EE5KDIgwQxdbLcIu5SKLU0EoOEM4dUaU//tSxOMDypGlCAOEb8l6teDAcI04uQDVXdUNrAVmPmiJSmZlU/2c2ONnLJMo2bakzGZkVTThFnvKhhe0iuXaXIZkszSpkLKbFwjrrRGxK0wxg9lY6HmdNKJgYZ6ZVqQM6lWGGoO01bGTUWQSGlVf1DOIZC1EAooqBAAANWxtda3KAE24posYjG+Rfy+C5WzzSXj2SzzhAjR0ummaxuocpa4onUy0N8smw1io1oOIvrZyIsxJrZH1CobUqr1Dp1WgIFMPthUMSxWxmptAWFhogQT/+1LE5wLLCa8Io4RxyWi1YSBwjjlHMxIYGJSgJDa/R2vv+yIuUIMhBSy7KQ/I22AiROGzxGjMNTSQaCikUbHKrZlolQYt0ppwS4JrDITAZ8r2WINB7OoiHRBbQMjiJwmWPCBxwRkDXchFhsKZ3CzZlpc4IxcQMkJaeg+iM3d1qZp9ke+ZmXwSFeTJPpNtoyJGGc8iUubcYyyNGOxjake4IS7RaAamOaNHsVHEpzbSQhjzpIzvZ5uI6iFCggHuVvDmIwyODJACtCKMJLgJcYxAaf/7UsTrgcv1qwYDhG3JhjYg1HCNOeZRLVvSte7vvMZdnqjv6JSL8oRfPJ4ZEl84xZ1KiMx9Q0tulfsS+XSNjqDkmb4mFsjqivHMkz1o+pEYtwrHLUZsbZgeYrcZ82TGWx8sR8PGIIAXW6iisFs7fIdV07qjpvPVBAAANukx2V2WuihPGaXLsil3h0SqUGisEJsypGjUhaFDSm7FU0JuMdg6qYszyvI+23CQEEZR0rEgdARKwn3Cgs9rDNt1u/2JouCMw6UTSUW52wSXQYwhYYuU//tSxOiBzBmrBqOEa9lzNODAoI45Wbi0Y4ZOUhhTBqvRKpv0o9X+cb2RsKJB4Q6bmM4+OZv+zOva1iyJK6XK23u5k/0oDqWnuRt+Fy+XWCOc1JB2BON6rIKGifrKRAr+JSyoGgWQjfVCIB3VhpGhJqxj0qyqBqUmaymcB4HP1Xzql2xZ8DWlpEY2+Gp/O0qpGduZ23kIGO4Js5TM4ZetBj9Y4qy55y7HS2bxgkdDaKN1POwWk1Cp720njLk+g99BgIkCyDMyI4l1QVgIYSyRaPD/+1LE54HKmbEIA4R1wY214NRxmzFKdFARIBq3o01tM9jg/7UUBNFDMMzcXMlUJyfmmirOXJ4yIOz6OFh9dTwcLa1+7A7NiHJDhvQUGqKtb62jzKmj9k9jSA6Rh1Upsxq2oe1C4GAj3J9CFwOsMARkdRK6WOFVUAAAJXz2R0bdYMjWZS8KypS980qkMPOnOVtlrff9ob+XbK09gRsRbVLld/85nIpE7TUl3NJhmMy6TTZlCDOO0OpA+R3j8DZGxQyQPKDSBhZW5MEgRCveFugCCf/7UsTpAcxhswajhG/RWLUhAHCN+SDdzFuk1Vds1er5v9Hfq/NSfOopH187WjzpzJ3efrhrOpHDZ8K5MrOiTzckIiM93JPlTNnBTGGyZYbElV2Kh9hkoOs+iqje7bu4q0IQc1pXFb7O+yuzwWkpncvMqYKuOqPTOiwGn3NsliiJHssjKvvwZarvlexM2j8+LCexukGPImJUR5wzIiJwR36WZasEIqlN7zxWrGXlQcVTUsNgKHYzp5JGaqYTMMtIAwggzwbGebCWWorDQIMKSors//tSxOoDzBmxBgOEZcFus+DAcI25L9sDbY1YIgUmIaHsqO3a0+/r+8T/85HNUzQfktzAVd3y6lVFzry39c5Z8IjT+Fc2plCrMhUn+Zd+VTzb2s+IVqZPxhGh7kRr5QrC3XJaVbESmbMYu8uGLQ7dnSiuhpzumYfdnI0e9q+eoctplyEpEdLb+xaOS5oZhV55eF1eqkWbyR8lItxDFangrk/py8KJ95r7imTnKZLVYmKyJU9wuJ75uzp+65PUJk+5ZdSsxz31EsyEPGOUT0y5lRb/+1LE6YHLPa0Io4Rt0ZQ2YOBxmvDFR2bfrBTnmXEA1q1dHuy9tGrPTIvsXATOszsyTCXI3Oebp3E/S+l+obQ0InmUawqZ83nlT2OdLkWBMyM4mXl0xBuzE89HNE+l3lpH9XsOhQS6VE223gab2r+ILYSqBtxeqIsl6cy0lpy1lkQ5POtkXrGuufJUsf9lmcyIouZZqbRZSO0//Mu7nWQmxhdpwKCKmfHZIi8/YUamwIcxGSk4/k7deGdwpsGudEINgzXCjOHQ4TghzQzZDPEwnP/7UsToAcwdrQYDhGnJPDQhYHCN+cDFg3UMoTOuI4K5XmSdlLKqmfD/mPmn0vhfa+xv5b+8KZmZ8Ow7J5bJCeY+RCvMg9XH6UbGIuETN1KgpTDUgUQWI4Rrkw5ccCpkFAVFNIUJgrMLBhjlBsGPc4UolIXEeCnuHeoQCAQAD5tXpezKea61T5hNPuirozyRQD2vRsi2XJ4AiO5r2pSwcJWM95el6XZLT9kNyzpFUyf2IqVEqZcJWaVTODylOulHYGp0sGUyZRiYhRFbQDelQUND//tSxO4BzZWvBAUM1YFSNWEUcI37YlBEIGYHgxAQayuzXmHbMkx0vIZl6ov+DC2zINHngOR0Aq3DNlAhYUB1su7s1srw+5s0kL/meOZZK96pZXZVczMFJlQYfWM3uaohj+Zmrxoj3joQVzRAc8g4QzOgYqBwXQkJJAAN3dGte6zUReRn0S3VrZokAp5CZ074G03Ro487RSavZ6v7qLU5DPZoI9n00sOetqS3M5k2xFr5OELU1KF6kRi4ZafhdzQDB6lU1jLUpfqrjcDZRGPrjIT/+1LE6wPMBbMGA4RhwYS2YMBwjHg5UGWpU6r4nSImviK5WZ4mG3SgOeXDv9Oun8PIZll6TAnP4VR6ZHSJtZGq+ux80aHCHPkMcoUhKdPLI1BsCmxQxWTSl0lMOqTHp17F9NGoSNDsqDTujBdkdxFauQVZLkE5Bep1lqNmHVvB3AqZFVgAA3ZtF1mZ+bqre+NSFLn/qR0phB9n7tfL+e1DHyPo3rL+95ql2fXfvc1m8sLlvml4blDqUi/WaZcRspJ9bU6gKzScJTEb+Y2xDqunTf/7UsToAMvlpwkDhG/JZjRhFHCOOb27HIfJHM3SHyrCYv4nICsaHTfWOZLXIWm+mu9FJQ1tpi1a+ZTpVK0kfDteqrp58n6nlxsFunl2ZFo3SrRw4uJdMnORlMxQG8okc+I+oSVzCcHdNQVJ+AqHLRKMlE915G2aRSokmam6jYHqEzEAAA3tetn2om+50fg7ygjfvqTlPPfkzTH5ZNFDPkPwb1+Q2KZdMvmX69kmzlJfLRjuWpQyON08jd2dQalcyYyQjS7MrLmRBRalpQn5zlRQ//tSxOmAy5GpCQOEb8mmNKCAgZq5sDAAA3RdVc/WUAXRIjQpNbES3NM0Ihvar/8/vXzNOn/65k5HjI1mecWpoSx1t81Otyohnt3qmdKZq+/x28rxLLiYuKyE1ZT+N71m0nsm7voiZsKxDn9PJpF9PY7SbLfdvTJ4ynxFBLDPtZl1MmuvEGZVQA/a72toyJS713mM1a16LO5edEpKRxTltERhwCPteKnxF2Q69kHUBdk+lT3NQKpKanCykUc7LtKmR5sR7cdcs3yMjy0yCk3D4az/+1LE5IBI2aUPIoR1ydK14ECxmjkAyCCAa9EZWPZU0Rt6Xe9kqtnOT0smRpvrnVrU4xVQhMmepHdtj0pejAi7MrLMgJCOHXCv80rcXpsR2+Mjh6GXi3vlVr6YpLnys5BTVuM2361NB9wq0zYaYi096EJKxreKl7z0k9YgGqokAEAAD5qM1G1VdUz85JSyLIHV8948RrmZmbjxMW4mVVrY0U+kZmvFmg0WFDi679co5XycpPuk4bGRUqlvkVRvP2JS6WflcSaBUkS5Im0FGQOHlf/7UsTkgMoxiQsDhHHJubYgoKCZeR4MAAAmqgckMydDasmUvl397Wszj9PzzebF8PrXk2qc1KIkele9yO2R3jxKaOTI3ZGJNyVAcKqrmav8ggzM3Gh0ggksjHFi5WDyk8STY1CkjgyNHoYzJi4Q03QCH5KE7qZEI0IMGFIgAAAnvZWdVZuGpBKeeH546MPXlkXOTvC8p8uT+VvEmevTLRvh8z1YuSMHNaqTYII9rCI1RLbdCqpYdtM+9p41y4hwsy7+ReFI9StOZPWNHF8wTiVQ//tSxOKASaWfDQOEd8mjtiDgcRp5Jcn6wJIhp7I9Kpoq6tIp6LGjI6I4izxKYN5EROtpZ6GgaqaWMaa2WfVL9Cy9wxqqSlozWU8zODm7GCg5DXtQw8DAhYNAZ0Wb7ZaA159S3AIQcKhLcEHMQJdUDtT6FGKkkLQUX3UIAAAln7MmsxUzqvHABHILrkdym9ORVdkzDoMxjJsLCZzATkDnAUA3/zVP6hOfM++6oSf0+Nr60oXxVP595Dap/d4a3jaKQ2aZ1TjIWdh+x7ZksnGjd3L/+1LE5YDKfZ8LA4RzyZc2IOCAjDF316YjBpsTDzNQ6Up3qluUMJAg/oXS5vbdfP3y7af+vtf3lv297/pp6vre9rv++v9ZSf+xZP/czn9s/Z32Uo0vQ7vHaPInssS3zPkL46iQyT8WV78G7PxwZTyXVYUE6o77LsjroxaHuJCdFnS0RzR7HxlY0LHzFGhmU5K38pcf5XM4Tua0cmQihGh6dgLUQxXqiyIU4WWE6ESkRlQ3mJkHdDtNKNrm5G6OFPhmwhEdDRg9Onh4CEx6EMdkhv/7UsTmgcsNmQijhGnJhDWgwHCN+QgwoG+1b19cWWE6nGiLhdngCbU4iMxFqS2c6ICSk6517oZ2GHIaGKHZDvn2jRq45kVMPmH8QbQq3i3eDMSjU+NBVyEPHZ5TCHOIsC0LsIeghbK7sUO5VBDAIyoMFIKKw/RIcwSYAACDT1dKLSqs9ZtG6Jar5zyl3Rz+jZx4ChiJJlsIMaTMbCWoyETECgu7nZrXKohLLnSMVmDR2SDhyq6q7E+ocy7nLuhn2ikwsCzVyWUGogI0B+Zfjxs7//tSxOeATMWzBqOE0cE1gGGgYIwBXmEUW4N0a6Z/Zcq6LrMed8/hOE5Cc1dIzFQZSmvvCmmJ0Chc5qgiv+sYkcqyMHV9nIsj2aJkoQgY9SJQwmHqFcqvsDFCSiDvkNKpiYl1WjAnCktw7oA04HjGJxNBEZuoCFF4ugStsp+rt5iHmvohH85eSuTolzoy82XTH1E2EZyasQi2CJUZvIzmKxUGrmWbOVhw+1pwuI51feB7khm/2BiebicpnArnSbO3eI6FrSQnyzBCES9VgAO1a/T/+1DE64PMMbEGA4RtyYI14MBwjfg5VXZMmxHRcDQ/FZTL2fsExEKhNNqaz1eH7kd4Zrmd0H3+Zy8RDMgcKmqGqhzLDMKfqMikCikZGbtJRAdiCDLEXbJ2igkQoiojxTHZgyAG42rK8ljRRQMLECXBsDoIqg76Vs58aBA4UaYGpXEt6H/EY6aKRTzMGxGxeKpXmZcimVeUx80gdE2iJ23D3PjWqGAWOifUI1+q+oXQIphkS4skdjd1yIdfHC0xQAZCpAZ0nDgjGVLiqRgyoKRw//tSxOgAy6WzCIOEc8F/NmDAcI34oZaoh4B0N+LBt6Kz3rvy/lni+ZFOM7yP79jhMo6RGVSVishJteEhrR25lXM3mxKUXOQvLn+ZFCXmtBVlN+NSH6b78h2QEZmaoomZmtQThARFkwGOp5JLls8EI9xJZipIQAAlmSKIjCtpryn3tzJDKXBlldz+88mXf7spT0sIjMpQXsx5Z1jd7TLI9nZTqXbyznbULthQiRhzQPzlmHMzmTIylFScjsmThoGoo0I6gSGEO5w9UGzFoMG2ShL/+1LE54PKiZ8IA4RzyYg2YMCgjbi+NTUSThKgBq1nNpeqNpZNVJTmRNFIrO/0Yv7Mhi0BURo1ztsy0jZY6MRWFCAN4lESMiJpYW3T6ikEmwMrplwqtPNhtDIpTb55BbkZCSZITKos9StCCkhmDVCrRxGKngad26KjIiv5qFHn2pSNt7hTChWUm0JE9FQsUbYUZ9U7qYMGS03sN8zXBy15pGNFOEn8EGKYnwjhG4biza2GM91EmtT4axyGJncPTGDHwByZawUnJg+M741CEwTgGv/7UsTqA8yJrwQFBGnBWDVhAHCN+VkkgMxxa3ta+iPiNyxKCeAnU1Hrlvd+dOk1D1a2PDn9OlD31jKcCyymksKlvkVbZ4jZxbCc50yMkfhm+yZHVrFdCIt42OEh40PBQKqkQXPUAzY1HM6z/5qgMIxhcr0IHBK1Bt2qcyc4x3Jdew7OcWtRj5ypQptWGQU6Nwi5zMjuXmTmbl9MpRtEdKUKLYd8+8dkRYho2SpFjssyoqGdSe15TPhY2QnHTDwGJBvQ7AzZQhA4oNVSqEp4w5Kp//tSxOqAzFWpBqOEYYlktWEUcI55Via4NVaUoxm+YkT50gk/eeRwJcRNtO2RelqxqenPSQomqkS/itda609JU+FIXCUjbbi0yWDuRiSMgwce5OFuIzdj8N0GVxwBQboJNEhhgi4sChEMOfSzd6MCRVCFQ4+LyUaKDqNZVcxV1nKZk7n1RnVaKxohvbQftldJf0V11hZPcu4qz15Tv96lVyQGwydplXJPYqHZG0J6BjaKthgxkbJiaRYhqu/bIN8rT5zCz3RabUoObkQQZjjKlzX/+1LE6oPL7aMGA4RvyXw2IMCAjTnQmmszJtsboIGZ8eHQfClkIEMCD6Xvq9db1+eWtcrzAj54ZCn0DU0InzKXIikRqG1K5HIcKTm3OwzjXf+UtjSlSg+p2nmSfnnYaV75LBKnqS7QlSZ0+5IthEZ6GtB+OYMOrgbt/reyT6X0976ETXbyJfj3zSKdLWO9N8d/6f5cmgRf/JXMRGrA2qCUBGiSEeWwIHWIi7CX6kGJdnaF+pMvTHzbOwMyNVralL9CHx7xLWbvvbZLeNMLwps1tv/7UsTpA8uVoQYDhG3JfzYgwHCNuLEX0xlPjHbMAODbOpiMi2Xvj5ClLKQEqcqmX6YqmVZ5yCWazrPG+7v2cyQmJT6/OTOHIy92jV6q1buYM7B3Q+R2dHzBPqxq9toSaF1EYHUkRFxbe3kGMTzzPDq9d5A4V54G+rdspFEn8g7BIFB3EwHhFyqR0nkuhQyiPC5OFzhJk8R1uRcnLqrlmi9JgsMtxcfwu+WMMLK8AqkpdWmwkOC1HoEYfN2Ew/MgE1wpCmxO1OhFedNxAxuGxY5Y//tSxOiAzVWxBAUM1clAtGFUcI45kRDOA1bQBpybWMtLyrUnIgT+gKyN55RTbe35ej6XQiTJbZekQQ6eaw7etDtywpSzyweSJKhDPTtheVlhUlH1EyIEPU3oatHKlQXDHYlclGFjG62HTPBiaGNkhpRQUIKpoa5qqiFkSAAAfWZrazvf4o9fCR1PNTGRk0YeqI1qMz6BOTkZcbLruaG1mDsycHk5JPz6u2IuqmrkS5G7PSKrpoRsTEvUjyEwIbv7IJignKhGVRj7uteGay2rTcD/+1LE6QHMPbEGA4zXiWO2ISBwjfkBp9OcqOm0Ry/WjNKGTAQyMCReV+YpwMcJTQz+NKBbcKIXsDPfpU90pWVeI9ZC6qLjxEnSFu5OgU108nRSCaSq5inMMgtCWsYUrwGYXNRMzU1JyXSzKAIoZb66oADPwfUGr9EWvVHY30ZfNd5iPwuUvVVb7fF/0vg1PneLbmaQ1VMyy+FMquSorNh9FvrLUqLWc6gjUTQVpjx9H4Sw7wErRV2MGlzGJBOz1T6q9zXjCazvbPzTc1k7+oAQkf/7UsTpgcwJrwYDhGvJgzXg1HCNOXAZYDs9E6aI7shiK7s92e7FeM1+Z0+0jQziV+nbxcxi2Ly3j6ov9P5O2Yh2J2TB3KpMhwoQvhmDoIOHdmVHy90cj43xUmlPvIqtAazW4Y0C4FbDXv2TxaVVqcHm4YijDuhU5R1fOFQ5s3JgItkBIAAAD9L3MaYrTGcutftRT9QwnacWTl86at0F7Zv38NPb5/sTMWfw35/V61Xk+ESEUJja3+5gqSbb0uvBXYTCn2u5oiFYcQItGKx4Cwhm//tSxOcByslLCKOEb9l8tWDAcI25G3uSEeDKR4KAkIIEAetKpvZPSlLvn2UG05pcU+hcmAfswBlG5MgqmzP2ijeEE10RQQoopaNFOL2XBmnarsiw1RFGLOsh9ImDg4S9OhoxaKbtBygpgzi48Xgy5EwKMGQKQbAISgbjvStFtSF/ET01vPs8mIuEWVOOt27Js+nwGf0slOORKpv4jKn2w14X0qmNVK5P/lPaZjWX4iU2jldgyEVBGM0c2FqqEQmGikHHXUJCdSQcUEF9BRUEG6r/+1LE6gPL2ZsGA4zXyag14IChmriDjBiLEicBWsgGrJ+izm3pn/lI6PK5ERWyNolMVGbMo3Le33NekjyeLJwQibZE5Z5VoY5odMlr3ORCNGb3Qb4DITuddlpKZLISsTPSjmORt1ldS6t0iHWJZSm+1BZA6+wnDLUQCRAABqn7UuqppmZcIaxfUjtFK9DUIH/VKUivC5mVzVbw7XfU50pNPBFubHSG0hN84+Xf1yEQ8YLkQgz5VPKqdVFSj1Ich2Sk1dE283nDKPcbrPGajmK5hf/7UsTjgMsVnwkDhG3JZzUhIHCOeUBw0BqBrTE2OSrvJuXsRckWrNOUyg+w08yMLSLRLxcu1uOvlDQyOLXmCBMuqaILZD0rsaP3mG0IugymUZZZz90zBjjBkDJkMxlBmJaGTELRbHSifjmFCkOgkgSBQ5sSMrjjNdBdQAAAM28RcdUsVw1u3/U0j8ST+n8++/McZkYazyOjJTjR/KBdGCaQGlaNoYVpMPlHh+W0ciyyqJUIgNwY+SZFFIjpyP6mblBa0k6UOZGjRhJkIHXSpOG8//tSxOgDzCWrBgOEYUllNmEAcI34UpODdKp+qN+clWWneysybu1W7KnbefYx7Dz3uplbSa3NwsQiyoPZN7Mk6FeUom1o5Wuz4NICeHGw0pZffgRzZEhIRQ1cz5hDMGrQuSkEWv5pRCyak4sD4VaSxDBZ2iBQAwAPazUmnpo7JfTS6Z/CTTzmNTVG6fQhRAiZdeiJaJGZTOcYhAbl2MCaKcEQIg22xI5SE0J0ZPb09gYvZCWMIMooM54YFHDhRORGwcJxDh4elfm1wEwIMRwVNkz/+1LE6IDLqa0JA4RrwYM2YMBwjbgIABKmc7MyXdXZeduym2tP2TKpIeVfSZ5afme2WT/JdyaVKZE0SJP1nGZHebISU+mRGr5U5EJY1eBsjJKQM8+l4ifVvXOIFTV3kQjsXBBNs97e7Vf5btO/7NPfEWnD4c+sizuRAQbb/V6a1o2WOXFcEJWDMmFgsSZkMkz3U0YRgcqTP9plENablxZIHOBLkxmdPGHppBHwTj6z89hnZldXqbBqpGcfIGoG6ioxh9Ca5CWDPC7k1Zm0CqY50v/7UsTngcslkwikBHWZb7WgwHGbqXUG5lsWKUG06LWfN5xaVENqNVyZq4bZxLMRJJlcgioEx5w2LvLw0vDTZlM8mCoQ8a7gx5zZptZaoTsrdgRjtAUFkYPw0nGEZKoJ6KUI5lqDEIHjBjNtCcTjEjadoVjKoGcbYdBhthjUAAANX2S6XtLxmvJmiRKVM8is/s/X7Cr29M2NJLrZpkTEDmjlEPLJ15Dyl8EZumbwUbnU9DKL04XmxrksWlHOvKVRy4zSaEgFelHJlJCFEdC6NaHe//tSxOsAS7mnCQOEdcGVNaDUcZrxnYVCHRwSezkBoGdVUlqIn5yQ8ueb7vYefd6U9qc+q6FXfl5r8ViEHyoieuhwjoIkO0kSOHPgMz59K51syzVBZsVIYGlGhdXiyofoNXwJxHyFq70KjwFBapbKAOHFIC5kLgvJuga2+7MtcwOeW7HMdYJRyHSLMcBmUkabVUihF5r0e2G6qbZnSZbUAbHLnkXQ9SlCMyPKnSfdmpqD+IjsNH+xEDTimyxogmqu8DAYyiacaiHgYEF9Bg0JBz3/+1LE54PLqbMGA4RvwX6z4MBwjfmc44luihATlOAzAG7O9LWfklF11LKtzOZK6ohCM7YS1z1/3na+TZ5lxJdDfvoxFk8uQnPM0Mlyq2aGRCHZofxKYXtjehGyvagU5mOIiVxi3KjmPqZOJJp0LlupBUgmsJLAMKoQIAAABtZx7vS6MrPUxuY6Nu7WeZt5b/C4/lgn/sP1j1/JMji/mpcBrISISAtH84W+69wWKrH4cuStxiXIniSRIl1tp3dn3cTrMcSqbyM/Rh3vnyXG6l1Qxv/7UsTnAMtZgwkDhGvJezUgwHCMefrZNkHpkQ3jetjhBEwQB9d62s7zWP67mJ73Z/yz8udQ8sj+k77yepuBCxSIM7Gwtyz4iEGMqbGTJEiNwTtaaCaC2x02yGyEypLUGQIyb+fl+CsyVIPPnphxhdUE0ve1dY4TMy6VCQj+kVk0HKShvz0hRZqTj/5Scc93Mvp9KNUIjlj6VoUKE4Y0N6jVG5XkHRP1BpJCUjOJXpGM0GDjqlzMTRUkC1wNsmJzNvz9BAOmoA4UBQsaWknIDKAI//tSxOgBTA2nBgOEbclns6EgcI25NRyNNpOHCaLz2Kbyz4ZQvmZeUk8rzf0ffxiqukmdvCnHMo2a5wvZ2dIZuYa0yJYkBSGCDOVJPL89iJMNTxUBkWZqCBWqjUzXH2pCjTIUBmZmIrAjVHEYNw7QOWVPS3YHsLoO5inOisyecAGfqztNhgYyfmdXAeTOIjd1bMjN3dMuTrOfSaHKpceG15OifOfCK9pAkp4s9PNEEk3mxPTyQEciexqPQ5mJGRGaVqDNKQ6B+hilFlmQShrNZjr/+1LE6IDMjYcHA4zXiTssoWBwjvm73SASiECAQGs6ns60VmdbZ3fq0y/yUQisjskjzgXGjA5GtgONH9jlGdO5FC4+h1jiutZ/rMfNPzIpZSKIouSFkRrFOi57l5kxmqq9zCDSBUrkKhuaglplpmVbY+UEaAA0AAAE6mKrquB4unRTyQjlU1MDzKms9I1jGuxapSurOdJDtX0LnStIiileH1xyIoqU1UwYgzYuFI4ssjJCBGbpU5hHMoNsquS90Rgb0uqtMgaq7CzGYFlk7JvTQv/7UsTsgMu9owYDhGvJkzUg4HCMGY2LN6FHXYAgG11ta05rdeayrxDyyEUlT/wmWsj5OFnVbDZTMcelcp3cvJfdh/MyXODoRoZpufTFGSCd+VoyvynR96GEaVgbjBQqxnJK7KokMZuDSF8OKZsa1a7iDBpBdQGAAAAEtXvPMslKrMzvizpDdSy30bzYn0XzRqRuMIpN0Ts7avebn1wWxsXelzJSzJGyborImqNLo/QRJ5GRqSqlawGd+rZCD8iFk6OHEnEDJCq3IOOaEooVKHrX//tSxOkAS8WzBgUEbcFrtiEgcI44BD962Zzsxd+rMzOM2FNKeAs72V1IlKQDplsdtgIbfMIkjzkYcpFIbn+fv334UgrbBdIPS5jmdCENnNjLSERs2ZVcz47/mgQU0ygsKzrYF4phsQoIUwgdMlbGenQDAAAltW9j0uqeCY+RvSmWWzQXsi8zknm0o0UizY4RLMLGpEfTB4MzLfJSLd6oyshP3UZiGss8ndnBZNlmd1OXI9eUNXIuYX1YPFMUEJQQVx3sERTBCUEEziUim8iglNj/+1LE6oLMcaMHA4RpyWO1YSBwjjmrQO4Jz5jaojvpgHZSlTrDMK5UFOj291CxFVJlDVpfKk9Y9Sw/eEe6dLv6KRj3MVS6SvQIicQrpBwfFqkxUVj3HIxB6MpnT8cyEqj4yOghyahFrVWV0mrDzc8A0cMKFj6ZDBEqBRIGAATTnba4q55pv6hPJ2dR8ICwpo/lsvQHnMcRINFz8OiTG2PmbPNdD7u3ptG4Zu5U7gIW77ma0rzUXsVNOigeavRfc8qyrkucDETmftuGpilRCDtRG//7UsTqAcuBrQkDhHHJb7WhFHCOORpYajmhAANSek+tdVppaqJG5jf4VzlRHkoJxnAcOpzBBxsr8u/lVJLmm9j+S5103Lci4NNqRUjL3NSNaoIiztJKfXRM9VBcclaDEROi5IYVxBuT6IMOWpi4GoIbFFjBFSQAADYJSNiajlROSU6Tl8ettpPt4R7/7/Kdh/MjHQ6p/I0ORH+ZM+rZETO1NlNt0wWvYQl5jkeHyJOEcbYb6VgQwodkfpfSpktTBuocZZakiIpubkKFYg+Hj3EQ//tSxOwCzF2zBqOEbdGBtmDAcI24oYt8CBhoPpgE1pd3rRkqnWmutFs9zH+jM6t7vl0pIy7SORVbOulvzyO1vbUxe596xmsyJc8t5YIzQjnwgsCycw40HCLCueGqOQzulI5jsv2ndfd/Z/UzE9niSqqUjDTE9gS11TMm6ggBAAAGs81m2ZKrTyrRyysUPLW+YiHINIhZwwrqVwXLabQ5Sh8pJU/VS2fI6cIfUxJlzP55P4M90VTBva8EA7DI3QgEroQWqxYO0U2b93LKm7Hg0Ir/+1LE6ABLhbEJBARxwW004RRwjfmHimQlzgkWi4emmlFS0fnYn33szI/4PJnUuS3Ofw2NCG/OE5bFDcjysPQvvlI53zfow+acuvciG1O2OdmZEhtjHM99jLrIyKCupiMhuJlmVUUDdk0qkHK1HjCME+xbpwCAAAAGVik+9ZrWCkbkkrpTIp7pCPbBMZtsaR2NCnsUN9xs1MjIt2WnZlQVLzzoxpU2IkcjzrvHIjJXOZ5dso7QyD9MmQ61I8ga7I2DGKkKLFCXOOD1FN0Wp40i1//7UsTqAcyBqwajhGGJebYgwHGbaOs1MzMZVCMEyQg3VlStza1f2c5gOS5u9HZhRGZ6NLWDu5DR8JmsmoSBmgI+Narc4VItzbzL0hgqE/MkNjiTORThw4QekXOEb2hz9TrQ87CkSg+CijUooDSao0PJaTkQgQPqOAAANvq+r2Y1HpwXRfyE/SHzK0OIyBgQyOjyMzedVRvM0BWNkc9nnE9uZRMniEdPUFU9MmlCu9LeCTNUnM0cojJPISL86HG40LIoUBPNzHQa516xIgtIFCQY//tSxOaAy6WrCQOEb8lbtGEAcI15xgJOr11Zc+ded2FMiXBpHEUQgknO6MlKGMkrMR/9iseprGyI2crMITAmS8QnJHLNtbHdMsyDPlg0IOQGrMcONmRJW2B2cZiygJBAJSjuagiBDIXQy0j1cMKJxZxGChRIABohHN1kAAB+17uyomi+yrvmGaad2Slqa3M3NH0GTZOj6pFL4xEZaypq1tLx5TaWxc/8qV2z4SVDL0jxjL+uGWk4kwdYsZIQ/fSB93mGtUgy1zI4DJp4dhdQEdD/+1LE6oDMqakHBARt2WQ14RRwjjnEIQCAJzN30rV6IqLVbn/pmVfyf+8/ye698ruRGe2SN1ud80OGbp/4efk1RmRD01/LP6CLhM1IKxi366G901U3nOM6/O7rqhi8KLeTDNWZdfWMc6Cstbhnnz3x8Me8pqjdVNEYSgbWvepwvhcijkU7ZkD0GDdOMjsflNJuxs2xyyE9XIVCiHqtdCJh7mlIyPeEYxt0zh0jQIKPXIIziljbUzEpXgZoxFUVvXTuuplCFU3xJfBYJMSGMbgnQ//7UsTpActlrwijhHHJjjTgwHCNuQaChBvENFWELSAhAIJsm9mZatbLe5VeUB+fn95FEyJHka+44E1z+0JnD8+FTQ+rIR09+pvTWTnH6SWmFtps0YnC7SqkyU3BnGMI9IyOkpaIJa1Iboy51xZDG0SW6owwnDbz1QZ1aL1O9MqW5UV2JJ+xlyXhwj/7YwMzYTzzjcN4pAuXJNPik7XfhQsiJ9GmV3JGJ5ed1MMjCLVfK0gTEccobBHWoIDqwnMVvXVcPUaGDg2ZISqrmySGDI4R//tSxOeAyv2zCKOEccGPNiDgcZq4wILOmx8DMKEH1SirZGqYz2se3Y537t1ea+UpkfMpI0PrWWdmVBFaUnXq6Vvsk68hLeEUO1IpGWzb374+xVfWjw/H79wdFbU7Vnw2LOycunbbY3L+v5juzP6qMbr1+z2qm60Nr8pDbAEG6nu6u1KK2rnYy85/ZAWRsDM4XvbGeA4NPPAMkgxIDRBRivJZ6Tl612aMcI1yXvCSoZupJd1YODnHzh8JShDGKTkhXXB9yNMuhxpXQpubvEjGIKH/+1LE54DMDa0GA4RrwWM04SBwjfkFoRAxxQTHEBuz70btrZzAh70U6rPyDKrsn1vcoVIN+VM/zvnymmq5wqYc5nCakUOsR/T410WcNs0tpokzhG3Pos8ltzyCk6EbwzWO5CziQ4Edi2xzcOPDVBlqqFBjVRRIQAAO3PdKGOYi2tpd+iLa/bz6hoTLSLp/O7GSxodh9cyqG8K5uE4V3I3Im4tQqXZcMyIjk/mLSJTQ0rKgfNliaRLpCKQIVcwbk2E8PxD4/MginOa/p/9aEAgjU//7UsTogswRsQYEBGXJgTNhFHGbIffN+E4Ms6OkdHDyVEUD3emioiU018HKofO/39+Q+Ij+gqkHCcLlLtSn7G1OyXp/zYpkTeSEZn+WC+//zroVRSPLmf5XyugZE0bJCE4N3kgdkKIxWWWVwVgpm/CVCABAAAas5UyQHWRrPnG2yJzPplrVm/tIC3NOZEbZsRkVIi4RS6rLKR72iiZvD1GHO6xyOMwORmYLfBPTBYwImPJiLMXw0ego7AhZEWwUMGImGTLcOJEGFc06M6sQ4SuU//tSxOYAyyGrCAOEccllNaEgcI25W4xAnxJMFm46Ejh3CMD2bVnbeibWoi7fs7X0Wh6vjoEioyL9UlmR8No58ZqTMiTnKQjDKejRysRDtueF1jNZlJDpEdIpmIiz6hVD3Jry+Tr0jdpmxy7i5yhq6gQAADWMfMaqJS9zHWMJ5FpzMLIj8yAQjwaWgydEo/eO67UTnI0dsvrP2lZGbB3M1QqsIEbRF8aEYyHNlqN5A1pBTpkQ7GFocEFJRzTNH9zWEym7QgdJ1LyM+qHhpLAIIoT/+1LE6oDM8asHBQzXyUQz4WBwjfmG29bs60tdLGWd2oxi6mUpcL3nNJmu5xnOzQM1JSY3sUUZQxfpnk5MNJC9xauGB4dXbcu7NlZfIiYtQjposUgWxC7ytqGc5sL2t3DUEqltETVu5PLk27hOjis1I1JGLMNiI10D0ytLZ4TgTQOSAIAP1TPo9e5y0rm+yy6pFYXlRLF7pucc1spH35UQ31ThtZ29Ldfyyfvk5Zc8rfB/bCyPLN72p3IzRcoUKlyZHPri7c7B4dniG8kp4AEggP/7UsTsAc2BswcDhGPBObQhYHCOuTWoq1o6TbK6bVMoVQJPmnBZ0YCelaXp2vP+HV/O8hod08i9R4MC8XTpLmqOUW94hWMQks88MpCLltQpIUJxb1dDQ0FjFBwE0pChZIPYbBwoNEtqrHDqccLvQfjgoAMghQFBigZe/pm4upWyknFsp+eps1KhXNzK28vOv3/ilL5fnHnHc5MiSJrnE6alAYLGcQpFlCNyZhyKBij+ExNaL4IXueY5BkbYstnDsxagmpYgUJdUzLyQg4ktoDU2//tSxOyBzCWvBqOEb8mqNaCAoZq5gpfQMFQUQBtmTt72aiFCG+ifqPz82y2rZjThKNCYLoTm83GIviGkmQPOkqes2IjR9o+yflj2MzEc7IDFPkimZpXC+pVXL8EzGUPDXwRvGdWB0AxA5BbCoMzU8CK2mHbNFJUOo176uiWolPi/lWQ9oVh3bXLK1YUkaUIflT1d3I+RYhZtZLWlFc0L5jtQ+o+zqWrzVTTUZW2/YyIYrO1vO65Tsl1E72ciXV4g3s17/ca23UFwUsqFmu9e2IX/+1LE5IBJ1YkLA4RxyZM14NRwjXlTGS7XhGKLLRwt0m51TCgfStdbtsrPdEr6csfKfVYDNHo56N+tysikJWNZGCzjtSc4IjHGt4YzP5uGxCogkasZU7d5NnbQ9jlXQ5oR9pnXqEDSK/YE6qXlxF49QQAAJfe1XtNS26V05jUEpAmYSFqr+9GcdBiUY7Zx0OrIbVsvf82s2udPcR0H1JZ1lOuIm2UocMaQyZtVCqFdWBcIEa2uRtu5g5ALhz5X93EowdxaCocBmKUWHdRVOkUIwf/7UsTog8v5qwYEBGnJarTgwHCN+QsEFWCgDWolrGuztiMsklG3s23ZIiv0XW5POJT+yVV9yya/qzZoxGiJZCll+EdMkWHWiHNwbzK3Z6RIHSBxid0Na2YaIShHMZ45QqMCjILQ5qoXbJTjk5js3BfNjkoWqCuGSAIIUEAGos06zbJNs+1zXer+tl2e5rZzyio5/LfvPyPyr2mnlSPNfzy0aGnH93L0sKjq/CNz4ZnsC9NAkfJkMyia0qn0u5zuggsqkrmWd4d23WjEStrtZeuB//tSxOkBzQWrBAUM0ckzr2FUcI67PUz8OicKhAAIAA22puhj5r7V1881PaUv7l4HcCvVusjEeIbu7MLNAQZyBxI3hAkhFkSE0zy2yFHSewoReREx1sxx5YdZriSZTcxepODIwSlozbhEvVDFE6CKlRxp8MlVBNXfV93R+12z1vtV9qstq1Rle2ymPdm28o/KRgyLpeU9crb0kc5f6bmyGWnONbYr3InMndmN6DlZlNDMSiggzl6m4TNh5gxBidTfWeuzBiHFshSEkKoDFilKik//+1LE7IFMkbEGpARtyX204RRwjXlB0q6dg1Jzmbs6HpvSq7J56rZV2kuWR/Vkn/9JfLKprwL67VPfJHO5UtCUomHRz2V6T+VJauSMZqzizqVKUIhzRQ47t7x3xqmUHixlNLfevddijpvSFNu56TKPzmXloFhZqKM3EGCA9Q69r0o1XZ8tZYOEhyoKYNYUh2iMRZ20nv8KJqERe6G9cidyBrmIsZbaW0nWzy9nwSkrynsGzOHyoT2Hg1jSrJggl1IjSGgQlZ6qE4jT1MyOo6RyCP/7UsTogEwdqQkDjNmJXTThFHCOeRnGUSwxADhKLMpD0bMpZd6daLsfFOkugoe72l8zZMryIgSyOaGWpmKTMzD002UpCUojeamaWEjHQXnUgU1RFZLW5d+nZgzJM7m0SETEjkxgobkjcRIeM59Jz2cWHgSMYg7ZizthodBmRHV5+iInl/Lx2ycjL+0zmVrGFYt9j5cH8K0vcyKGXAQOmiRDo0fMFnQb8ISLfK7SLjuYMEaUgmTGzooOgZCSCizYZUIO6qLamE3UOaRHhUghdDxK//tSxOoDzAWzBgOM3UGNtWDAcZr5ukCoOOihdRTktFMCQqDWR5lN12/ctB+MUy7Up9iJvOjyl+s+WH3XzcbIsr1Ne5HJVJEb0JyKynTUmqmkKtDOl5ElL0cjNOHCrFqxnYRRih02jknNEY+UWSh3FVBnQR5eIAACAATuJjRKjX50pWaIRnVnbMgSSG8vCAIbwB1LChOapJiRvInzM13i7nO9rGVmbJbWO1UnWINxlhE0rv7FAdjN6LXM1y6VDGtyJ2zMWOlrRyUxROdBPSNw6sP/+1LE5gHLma8GBQRvyVu0YSBwjnk5BMEreXBv2z+1qIm/aPz0XkbI4QoWRDdFSaNoKvfYzPuWLmq03XU71nWzvzTXBzI1YmN1SKdgYhUh56maG9M3emZkQplBOwcKVcIhuLLDgrHFIDV6wuV6OMCxyMmDCs4EpAw3gijRegTtejsd1+KnrBInnYpTzRd/ZJlqcPuqp5SHr5wa5rUM0UE+/Ss/kWFRwKwQnwkS1HU9mHIOFT8jV3IZDQigoWtDifvu1GIWMZkOgM0hsCgl1QwYav/7UsTqA80trwQFBGFJSbNhAHCN+QzfcqY2kDEuoCDrAhCAIAbmolVPrTX2vfoHReUvXVnu3g/7oIzO8CwjxgaH099kb+ZkX6OZxELSjZbGUTzhn8LVY0Imk6rhsjdonlK6lKtNRZEZaHIEMy5pcQ/bdQ7Y5ztzN2ObMQ5t1Z2vmc2u3pDsk/Xpc+Tih60shOaGLe/ZZ3rTRAKNJOPdxDaZ1TiEKaLSQXKag6EqCKGfxYCUWpXcme0PBF3ppb3NJ4k5bYrys1F0opZrsjs+tcpJ//tSxOoDTDGjBwQEb8mINODAcI6Z3PtovpiC+3OIOgE/1/7Ond/FzX6IqBI08rQ32ZCTJcNzPS8UQyYhQmPeO5NOu7p+VmenFhluVNjliz8kuym1WEMhhCMo4TYGSbUihoYWTqLqJ8FT4ejevHwbwpEgAAA22lJiIbluojzYpeE4zmwlFRzs9Y1DG9k/Y496SXf94Xpk7kitoZri/RGh0+kjjZrRTdRGNTjQSaTHITDRxGT7KMusVROxaFkyeIYMDIgGAuDiFkZsMSDZGGldwtj/+1LE5gDL4a0GA4RryUW04VBwjnksgJQ9FtNafdp6ddlnuWrc6+mhO15pkqIpgPpRxIKSTCZBBM3hODqO8rlnHyI3bJSaE553LMrSxLLYYKFmjQw3Ib2BlLMwW5ZOSmlU8SZJUXGWUFShGIRQnxUyaRUAwEgAA1XZ1d5lUSZE5SaafNm6hjdAlLQaRkxMbTNJIZH1NqzIRl5puXb6O3w4MvHOICqE/6MW54gCCloLsaB1Ku8IiE5zzp3+IYlz/3dmoIEbm0qB7EhuqCdWivFiH//7UsTrg80prQQFDNXBRjVhAHCOOUMMNZbBrGKs61O13a6VFx2/ZGp5LARDaiRLdKGGIxTWAiVE0dMhYtfbQ2HT1movamsbbl8a2c7fjz9f3jTSmo/mJt4yJxrIcjtDtbpxXQl//Ua8+tutdf5d0pzv3i/QHdXDeFIiFQS9GS+Vz67EKIWnNgZn3Hk7Z/y50zsJDu//zemdNiW8U2Iq5vmxJqnUBYI567A/RQg6qflSJ1R4jHxfomvFVwjBxwxOMcYzdwTCK4x4EewyoIBtF0c0//tQxOwBzCmxBqOEbcFsM+EgcI45LiAkL8MUGDWOMMiANrRt7pth53KZz+CsUrmXS9nciY5I1vl37lTPanmaeLTMpG7eHeKRJmq7w40B9P8i5p7g6F1ujvT1ynLQRIroRIdZX0HU81NnU/Ynhy5qy78ahl6OYOJVFAAkAAbvPnI1Nq9Ksru8kRfGWXPqSGerHcjaOVER9EjkxAWYzlKTNGyOnuMlBnNa5mkMqiIUnMktPfkcIT0i8tVBqSsoVcXMyfoM99C9CkbxRECYE+Dr0P/7UsTrAMxppwaDhG3JhDXgwHCaOYo4OpBLfqdvztzDDeFpT9kkRzpGEjcQDQCRVat5hAKBpz5tdjLEQy5AzniMvUkJgzu8VkTq0e6uNyPDo6n6EJECWBM55ilQNMYG2MOzZOzqrhY5h0xDhwTuau8WSqFTIcQ5gqVhBr7obOO9gNYbdW8i7HD7SPDw6chRCveeRmUY5KlN4VbKo+0gi8zO6fKmvPkvDmqFllCCZqDbFkxHDRI5iPVP1QGVKKn2CGDewGGc1F3zDqCBkTAwkMIR//tSxOaAy92tBgOEaclltiEgcI14tUDQNRNKG5iKEACSoqO2lXoVDxyiolERUy8FSeRi0Rz2l+3Jvy3kLyMqp1UeQqZ/SImQvIzrTyP7OgvBTy3mJPR/2zZCVtGZqxGmqDoSGwzWtnQ6kQhZEeUlr6IW4liHw10AIAA2zK16VJ6XDOY6CDCRJKQASeins30iXLYtWoLKReo62HRaG6GHhGykZIM0PmZ6Q34TzsU14qnBneUkkYlpODTRTH0dEfWNd3wUFkCDq+bAXqdNCYTqHer/+1LE6ADLcbEJA4RzwYU0YMBwjfngb0nN12GAQQQJDXX2fuaz1862Z1ucMMs5cvZ6POOGwW63zxovlkcznH8qrl2P8/pHedpI2QZG7GCRI5Htx86xIeGMTNXy2uggY6vkERHczKJS04CHB4R6kffHpUUAYAAABqOMycozegiTzOemnISSHzOrl9J84v+bcthq/CsbyrNNrN6YYshMfUbOlbptGIiXLhoqLIduVUXoCTJcGhuzehzujiULCZFWhjWmuNnksrAkITWbMnQItkclhf/7UsTngMvVowYDhGfJaLPhIHCNuUEEjg2Fg12ZHs1WfzZ5CQjR9kh6kYiacpFXzwss4qNe155H55XMofxgXgs/FMSuZlHIfZXasJYyUKabAgnRejTrSynBKdNjcwzYA49bqqPIW1R6yCizXGNcvtJo9EQxTMESVhUAsAIABr3qtJiWYbvLMc9MJkVvEtOjmuhZp5Cqtpnelo/VKVJkZovKYe5aw+nJ0m6ytOyoxcQgg5llCXSCWv9W7ItrHYyuRKaDZgoRcQxqEMkzB0ZPGI0u//tSxOkCzIGpBqOEa8lKNSEAcI35cyiqHbGkhJIAAH2R81ld1d92Oo3B0+JlfyM0objcjmPgLYb74iSDxEAkZysR3LNl5nb6FCaJnuebEtBhk2i+UaPEJC4S5ZVnJiGklBVIdQKpPmpIroZmT1IKNEmHl0xQNAA2jWcx3Mqd0z0BGprLJBz5Z7wmp7IGcfoqIzqemuUX94kK3yeQzqPn3kCLc3NTI7p+dQdxViSykRTMWcKEwMd2ylBw96I+3fJIFKuTrVkopCnoTM4JFRwhA2z/+1LE64HMhbEHA4RhyXi1YMBwjblERudGCZu+dv9yU7z7f7SpOSOWpSl0rUuTTYkdfxMqv8Rjds8Zkl5WZMfQsNRbGPXIixiPcnhuQj4k8GGEWqghSR4GDueHBkrzKKEaCyPMpScaix4aAHaojtHC5Var8cMlBpyLn7uidfWLIGjKfuJWNGaY5J1RIaeVryGJ6qoyTLhGWmkLMYsxPnNjU0ekhGpmz47OLDpYcmxOWLmh5Ez4cZzNZEQ2RlYYxlOzF4eYQmCGLRThNuH2D0zF5P/7UsToAEvJpwkDhG3JYrOhIHCOecEggMoNp7GaBn4PuzCK3nUOz3Q1KmQ8OJ3z/rJw97/S/OsfoeQjZCS7F3RAi6bwk1SNQharx6+RI5zPIYelan6CRbMOgvgHEBlKIRRhbOE0wRBUZSqtFMEjmKFihUjqdipXFGwqBJfMd+tr7DZvwW1JAndyCjJzo50CwCnckuspHS8yxLpxXO6m3Z9NJpYX5aMj2a2vEkcYbfO6w+Fw1KU6LVFVTI8xdvm0BzMtlI67YnnkYkyop1wzGJUC//tSxOqAS2WzCKOEb8GKNeDAcIw4mAi4Jul++aupJ+1F0IiWiQ4Znc5flRMZlaDQntzvoU4h6dNi6iyn5f0iMLSNbYSsW5lhj8cUFqQDU1dY5LC0SmVrA09aJBvZpTCb4I6qAjnB3FLskDgaZ0z8gzCgoajOCAAANpatb1O683qnWdqsKlz28u5KUWsWj2N//wRFKWtmpjH11UbKvgtZTQogMhORGrIGlr1V5uwNkT48zjD9U/bz0iClDMEHDEQWxN7j5TuhWsW+XP+Rqj3ylZj/+1LE6YPL3bMGA4RvwYE14MBwjPkHGk4xi3o6Q8oENHu1Uur0S616aLzmVmRr8/Ec7iMllR9li1HAOBAEnzZm3kV9vxAU4jomZzI7JdpmeM6pmnaCv779c/JhiTqZoWRS8kyJxWx7+jg6nTJ49HtAAAAk6IZa+a7zqgkrknp2jIzMXUTJAItJl2yFW+1fnN7TsiUmQtCtlmVq0dMz4RmzN3inp7JudqUYqau8VFrB9irZCdjzAc6HgxkKEKRQELLu0Eu4JUdhwwQlZ46FGMUFdP/7UsTng8s1pwgDhG3JdLUgwHCNuUDKPGyV1d7fcw7ZwcqavMybzJjOREJA0OLJEbBEiDOGoAUiQJK4Rv73Mxyqjbrr31aTzbW7bPZNCJaZS/vIdBfx6vj8tG2uNu8rfFJziMTDYlru79f1TGOfVNGRnu2uZitzpHMqIIAAJMpzK2tm9D1ZfOcDOUoGxyVUmJ0pCMVhF+CccX5tOqV+nm/ojLspe93M+NWMsjWXy6bL2XJaRfCv01QMRRNKaqSFl0qhMjyjXVljGab2+2/v0Thk//tSxOoBzImvBqOM18lGtmFgcI64FKDUREey2urpehtLTNHex6TWs7pf600mKn6GVLaPyNmybSdU4hcJS10+pmyL1XEQ1sbPe1kD/WRojAjdx0O+ZmjLY6VR2h3atzo3E1sT7nHhOJyKmMZToZ28FzGM399UWWUEjEU1G2d27Pq3PxzMUNta3magsyFQbb3Us+NI7M7poYgpnFeufqZHUnTbKH56n888OkDLxTyHUovTQVjPYQoEW4ORicLoOIMOCHEg9jec1cwihSMSZMQK6RP/+1LE7QHMTa0Go4Rt2Y814MCAmjjw7B6HxZxATrRnWhclnEY/VSdStOW7T+J2dTaQznXidyNSmdyHeysboT5ESan2bKaoSbuYMGzb8qrhD0d1Q9DJWRgWWgssciCGZUEEqvGtr3B6ulVyM1MQ0eCFZoYvS2IpO7BlDTyVBs2hqrO88/vzzbLePJvSus4UTLM6Ha86znDe/Dga7nH7GidV3V5xDRJAdMmqcMkp8G5EYk0xT+EPdVOjhTDAqRnGDTECUfOemgQeVLAZi7RaMvmYSf/7UsTngcsNswijhG/BgrSgwHGbY7aOCYgZoaQyIgwmQVEWIB9KItt213vM3TTT10pvUPrOeRS41iH+yP603IYidTC42KziJwTHkCKnXCcRmLh8M2NWfLilI8XdJrjQ+wHJJWUJqlO8fbQitO2cDBbCNAAAAAbNrWcEIN02XZIy5jXvhVpPlll5TPa+a7T5mnvPBrn1HWkup3Ra+/1zePQT9zKCF5bWaw1BA8jsRJA4dQ5yG7UYEaiGXJyfChQ6V6rK8kDERubWMJIyoLYdqram//tSxOkBy/mnBgOEbcmCtWDUcIz5IM4QigAQNnUc66vzVT1S9F0ssx5+rJ96pRnNu73t7ud5mjV4ZkhcGvdO0vLERCO+8q3Y3KGZVnKKbEYyVQjHhp+TtiImmhkv3wjjtOY2Ms+Pubc4dUyfMIsV7FpBp/35ibTMmPR/RBpBhAA3Mn2U81KI9b1M7q4rjCDC87zEJ/wTP+FBA95zOwuwzj1Ed4y4xIg+xdR/eV2KGikzKscorHXDuTve/RtcEgl4jcN3Y0msu4KgwoqEaRHMjOD/+1LE5oBMEbEGA4R2iUC1YWBwjrldxQZrA94Jm39aU8kaaLOWM+xHU8DiSpjU0qdicJqxleSZBd9Arnp+RzhpktI1r0tQakzhTQKtZ4URGS2tTfHStc4QazFBzMSrxAa+PRuu5UMeOoql1C2JKH/DT3FkAGoSQU1o0tUCBQSADekV687Uvskygoq9kUrMz/g/hGL1bikbqsKdaXp8ZMyeltGPxV5fz+OT6cK8bruV1RJdWiWjnFaZL5CCJFq9OQoVFVDb0I5ipuc2BhxToREXsv/7UsTsAcydrwcDhGfJi7Xg1HGbmYWOIDuDWU3V0RFIVsfvXj5nC+KReOjyiQGKYJ2jM9JpDO3aVGKXM0VJstEv7P+ar1mWQkqSZiyNE1UyqHAHDsZ1Uu58C0w0xy2d/cXEXWtDwwh6HZqY4GKFtbUNiQCxVErSCAAANt6WZtLVPMzmhM0VFlTmnM6JBN6cADIrppc3O7WnvNS56cqzvGwcI/TaeZm+QqN+D6SvmZpHD6uGuYw4mIu0iHdxlfwlBaBRCCVgIKR4QUtalzUWcenh//tSxOYASz2vCKOEc8F9NiDAcI257A+p4QFJBAgZrVphtYT2WZ8SZ/MBHg02XrGuQromTRtDiR8jib162fW5V8iCAv2OHO/JFWegVdxYpIRVCq5wyIYSNVLLnhEPocs6QiIU6YTZA4ctooOqpm/UEopwRHw5FSYWgMYRBM9d7LZXaRTnXDTiyNvBIzAz2oug0z59msq51iUpCbc3zSKZ5v5Ev1CBwXmZcMFzckwRMhm9N6eIzcSrFVY+oPRUEg+BPxdNCQM6iCpwLQ5uoJZS+OL/+1LE5wBLRbMJBARvwXY0oMBwjfllCDkyqqB5mNg2bbX70o95skoClyn5jGZy7/VGhlPW6M6pkpofpD2XNvh2b8MmBWZttUWHpU3M6ZBldWclNOmsKlOMggOTwzMciaRrs34dSxApoShZVg4OoXQaOHQNCg7KJACQAA90ejV0OW89Gbjnc5pFiKR5WimZkmL2s51mK54yaF9z+JgpEdmeMhmuYI/0VazTfMiOGhwzmcTvCc5Z05lckM8xoeDzWwYUHNUuRQPfcx3kCZb57UBUK//7UsTpAcwJrwajhG3JfrXg4ICNucWBvonXSrWnGNRHm1Xeey1X8qnx1kM6mR5Fo5CtqXs2v3ZIemCSGIRUeEV+E3PIVZXJvzE7Fc9UOPnGh6s+2ZA77oYhEKM8RLjtuo6t07bbe6dzOZE/XwVEFS4eneyvFYoGv2T7VNPy7DS3vVR86aS3OFlGJTm3OnfN94WpnVqEUi3RfvWVEI3ZFqWyEXtkWjG+tc3RA2f11pYeuIpkSw2sVkHqkspMQmjcELgvXY2PyCnq7oN7CjTmw2g0//tSxOcDy9WXBgOEbclfNeEAcI34EqoAiAbT+zmW7kuTLyKU2zi2umfC/VdJM1bnIXL1LbchN+00F09Yy520+5wiobOB1qkt47msXYc4RLkgoE6V1S9YQMTgYXgsBptA0Uhtyjkj03MPAgw7GqO4UQiGA/hgxkPBgTEIEgAAD0N1oatGz1qUsCVyv85K4yky9mTOlQA+AoVrPpoUs1edIl6ZZ8WPZxiNyNJLPyOF+atlTI9SM4zJm5oZDT2xkSm5a7eS5oFdrNSQEaECNqeZQgj/+1LE6YDLiaEJA4RvyX01YMBxmzFsCPCGgG760qzK/ZzJueEypiLlEdK3pLO8iGo1xMiuiMrJeqWyKWStUjBxWalRZ5SnRIdanYDZXwoR0ztDeDVWW0kfFE7g3FTMKqlWOCQyEimMgmqqvdCr3AieuCJBaEr0Ms00BqLV7YCwL0TKjJBaowbLmI/O5Yx0/hXLYzkMs7eG7+XWlXRKC8pDfViKggXcnjm2f1bkJKgq5SbrUjegNYKwT+2aIIao0AqWKgIdZCtuZFDDgscxV+dGFv/7UsTpg8vhsQYDgGBBg7YgwHCNOVwQChFbAwwEqeVfeKXvfmqqIv457nvbn3hk3r/KdmXL9WmS+ch25RL0k4/4JTIsymcwnRfusjMluSA2u6VuGT6G5Hc60EfbU7S7HaYm7S+FI7MkLgqzH7nblRNV9x9bHUz/88yZJ83iZlcz1QEgEAAPzrJou3dNde/M3dSn/T0fxGdh9YM2qzIuspF6pA5+YXZJJlG5SjyRMIzwk+EpFk/bQYpZf4pOeRLC2Jqp06CY4yRDKG2RlcSqhAA6//tSxOeBy3GxCQOEb8F9tKDAcI35+KiOZuI96/L6LppL8OJ0+OSzpR9WIbiP6nyf+Ysi2ey3ciI+IzMBSgxdnTGbtq5qYf+Oy7qO8NEIqYJ5RDiqMXXMR5ICKI7CDNTEgCh5s7hkcQgDWYcCOCw4GWIDgIkOKpiRqoGDRsIGpVKcnPcVhu1y8vZuc5F5e8++bGcKxLJ+fruRZS5axPqxW9Hd7n1ikhwoTOuRMXull2e+RmCQGVdsQr5PDakgnruU1KGzpepyqrIQRwpcpkzR4M//+1LE6APL4Z8GA4RpyZC14MCBmrmF8yoNRQycnaNzLRpDLvEMuT7yQy1pZyNkvmSKd75XXvDlJkK3PKo5Yts//JTbwzrLGg7MnqecKKInBU1XbW7MM4r2mmiK1RceNA9hGqtAMjIgdhhkdhTe1Nxbi4mwmPYLOiAAADWqY13e9Z8zImOQQdRGgj2I75vJEbCqQJZqky3ptY+2yEpLppv+10crzI1NqybRD8RYDyc3IofD+I5HjkHFxOk+vwysSraQ4S4siNRIqjg2K4JdBQJBjP/7UsTkAMmtpwsDhHXJqTVglLCMOUiN2oeEBKzBAIgIBtEREY7abno3PdopYFJTD8lZZSKg5uMjUVcpk2+gGQXJ9b6cIjn5C839dbhnNLHJwWa0+RmI1nLPgQPWzBuwjdOor6Iw7Kfzj14EBQgUzHvuYqASEYwTDAAATw8UpK+u9XQuzK88nshIdtVKp3Qkz8291kl5lC5KcI89GO5kG81hVdfJ4HQzS2my6Gw4zVRhjnhSN1bd6hG+u8tai0YghKTxifA1BXITRiBEeq0LSWgl//tSxOYDyt2rCAOEacl6tiDAcIw4AErKFVByDOInRoHztVW1k1BNs7Pp5HM3lTWYK0/2Kzm+1nqZOZa8N+t5cnPVpzrmnSIyVWMtXMw1NqZxzDE8VTnnETS4V12asZUEokmZrtDYrcJj5YRCaOgNEHFGIsVBVpSCC6oGV+NLiY4ppmSL8wPeZHP1ona1OOUBjmyFdl5Y5uo4Px6ZmN9daYkjsJO741+6kt5RMJjjcReqb0SoonJCeUzVabE4TcpSmz2A0CYMH0ylOa4+CxlRrvT/+1LE6QBMNaMGo4Rt2Wkx4SBwjjkBDMUQNgJQ6j/rfkvE7IG0zeznD87HtyQr21GNciMoxtmZPu8SvxMmdMts7DJWjAyscs31ynJZrYSkLINZXyOAmmFJ1rDupoHRQV1DIyRAonWuRjUyckEcqCBgIgbBxnN93lQQYRyeNQIAAA+z2eu1N13Mjrl6EfDnkXKVR6+RXzPPo3D3rtLlnsrNVhrzOmdWzIlsnTMEQfM8ciQ9M2rEvyqym28KMpt0HHda57hWc4oVoYJ3CdyG9CI4cf/7UsTpAMxhpwakhGHJbLWhFHCNucgUSR0xBQ9XZ2Om6Zy157fSttDNH1fy9ymzc8i+rZ9++Tteb9+Fen21EupGWlO5fkRL4PInv5Yisy2EZkp1zZXXXkLSumtMrMhez2/R0w9//8Qam+e51t0bcF4UyGxFagSRnbrToz1brdNCv5mlPXzK59Mi+5ZG/bgjRq/V5wnb7xF4lUskf2zcyCiCz8gdvk7S33u+s+qsD9GR9R7W3i6nLa4a23914k0ktxDU89bB5Knes+ey6rOVPHeP//tSxOeDy7GzBgQEb8GBNODAoIy5KOMrCNmRUgat2ZraXpvsek+Ak9FYczYBdG6aMnIbyROVhQwiLH6OOcyyIx2TVnyEgnQNSLIpdCZSFwPWakOjw2I+Fjg4ecc8qVNnT2eANMIRpHpO5EWZhjU3/JBCj/hIHisG3phjKD7pVvOT7o32bnInUfz7/J/wb9/0ZMzzhGxhuf+Y+cKhlsYlu4M+bHStpvfIR7LWWtj6i9kRzY3qkxqSUzeC30BjMqFcUWEFI4U1ER6QomDi87cSYL7/+1LE5oDLNaEJA4RtyWq1IRRxmzHBEHEGFYG9jLtvXd3OMp2NsibMmhjOzN5tWOc1pn232k3IyOIW1lTc7p6HiZJWpOrqe1JyNFRnzplbkLMg6X8yU1EHDNDOOoWQsYfv+kBGhqh0lbLYXtesRhxJDxHcgQcNiDhFm4kG5mnc3nRcoTU/RdkTCzPbP7b4jfzhm6nsde73VbWkPP93KDUv/UnT/hmUcfBrq/atzssWMbu1iyGuhnVQYhe+Ivoy3JV8r5mFtaA69dWRCWPfHrAsBv/7UsTqAcwxowYDjNPJcbYhIHCOeQEATtd2oyJZdtS0RI2ayGV6xzOpeg6ZEpNFzJ48/bhqhaYpmTa00D9JpJNSZbgjPTnmZkXg4YntPUFGgaqziNiZUhEIRNmeLRiwRGLcGCF1wkb64EILxuYsGEyZyBryrioOst9jFtDryIoXi1yP5GTuD7wEyo/DPjGrWFoa1Cyw8BXfc1+LmFkEIMRcr551tnIZYubcSSghjyd2nDtQZ9MONBLDksWCRQaAYohZkwWjLQa2MZGHZxSKO0Yb//tSxOkDy+mzBgOEY8GDNiDAcZuoI5jIVuEDCgAwBD2tZdC1RdJZnXj/4S5y28/J+8hzprEOn5z5znUOlDXspJYes1d2sWfnJUfa6rVbqakkmxr2PbHmZQnypV2tM8QMagjIrIZXYuYOFoWikAdCYVlEKg29jEQxmLEIMhsFmCqZdZ1KpoqzypamEzTMGnsROaGZ4tyemSWmRMSRkyCVX+2sSGGG0jRiHDSX9asR9Um4ePQ6B2UyEjHVGF5NMcoJrKECnmgMXagJoAGPQN2QxDv/+1LE5wDKmasIA4RtyYW0oOBwjbkA03BoAPQ6Gyg48hDKAIDbJZFrdm35u3f+vsSlpaqWtuvtA9mF9H/smKTnSmCzRwGkgM6ohcxEIB/gztzplyXUqZ+VRyN2h/DQ/ylaqTQ66crrmR6Jph4XDZms73cw50s1WOq+jz2Nkd+GucZzc36uj8y/dvqr13XBk5GINiMlMeA5y3dBos/0hB3I1MkNcQHovxL0zCsSxlzUK/ENyVTp1euFAm1XBuK5OhlbSM62tD3KRLTM0uF3RpZ/Hv/7UsTpgMxBsQYFBGvJWzShIHCNOQtWafh+451wAagQJ8GrZnQpdNKM32k2PsjJmZfmR8/TLg+dTcjx7clDMfPKjLWAgmoCN5IW4nXODExLUzyqKdL+RTI+5g2OUxp6rDmYYSiXWOfC6TRIeRiVAcAAAAZTiO+kW7SeniZYQ369lldXFTAUgkYXZnN52Bt+cjISzjQk4npg7UsrIe/eH5pTNj+7qTRzq0UeQqySxyCi4mYc2NOQkwIO7Eg0SsGFgAQ6DEjkCwwtkFKBuymJd2Ko//tSxOsATSWrBAUEackzteGgUI65Sjj0BEAbqqXaptT0N1rrk/PTKvxM7XY9c4TM5EZsUArVkqPVE+niYUJZpkgifmTK6OZzitTjEb5oh0glpiCEwGvXuaM0V3pkQOo5PSD7A1UHg9FOG5A0lHGOBlsADqm1dn6qaqtRDjzzK/UUvaFztRPOUzaKd9C2uUVWIyIy3LdwaIz+parRsyfipQtQuLl9buV+XlpyYN6R+GRuGOhl37zW3vLJFNmUSjbZpSRorxX06JyvAxFqya0nBWT/+1LE7gBNda8EBQzXwUQsYaxQjrlbNZhvLj7XYs44YkID0uvWnp96NSwLl0VbLHloiPKU0ZXyGYk7lnojnFtMsia3rd5+jNwj+m2ZD+Z90p0atl2ZbdTXKVCJqvXmgkew2iTwqRkm82iUlgPzDisRalAAADVatluuix0Lyp3kdBe30Wd6kOmphIkg9ui/Pvm/crEL4XUukFmhQjIzeCmBGuZTUqbHLkCkRD2kkphvpAYNlNZujKpmQsxaiBqaEIUzVGycGO4g44qjPCJFRzFWBP/7UsTtgEy5swcEBHHBaTRhFHCOeYAgElsrmruuqNW1k6a1um3MzK1syyW9NvfzLRyznLn1uWOKLzi3mdiTfBxnc2Ow5K5mtudopUFb6kYmGBDFKGig9zR29VJy0PtzaveoTvTa1R276XupYjkLf2BsWircZGpiQAAANq6PWj0vaVV5W8yzZkfEaZY0zOhWJS5dQDCETvyN7GXCSERYNDIiJ0MQQNAkjbhzDhnPSKKBDGmIp9mDkwZm5Ep1RNWcUgoukMLMeVWYnnZFZ1DosoLz//tSxOuDzWmvBAUM08k8tOFAcI45qBj4yveCVDpw/Oq3u36M6znmoOiqS31ztXKPPZs9X5Z8T2U1v0rJ3eHV8yeLclcYuRlYgQS+nwXHCZOvHddbAaRAgovKugfRCckyFU4ORhmECxAlAuQPU0Bs4SiwgcpKBq2Mu85X1pJ4jmCQhaTV2CYEmZjVibmaC6MZBY7XJNVsXlseW3pI5O1NE/TTQ/eQeQiMHTOexQ8V1zNmxj88pHO2K9LiU2jg1M4mYMFSJIECAJBQUI3Jpk4mE4L/+1LE7ADMDakGo4Rt2YW1YNRxmzNgSY9BNLzvm0UaaPsrJBmYC3kSijYATcaOVmONcm8H5UnWs5Q5wxq53NT5JpSlJnqGuaDZU0dvRAaGx0MTXBrWDVWPBte5kIVYlhLTXAoWIiwiGvkwQkcMdRSBUU26vxwldAl1Btp7abKOHUZQzv1a0wLOKU5TzvajtuzzLI2L1usjROBdlfLQnyP9i2jrhGDdOv23wVBsSy13CMhhgs1G0fBUgUUKxPHkhghZgg5ow1NBzU2H0FIYaEwRqf/7UsTpAcxRqwajhG/JXDXhAHCOOeoQSzinclYM1DGh6YfvejrVPfe1eqOntPsz78RLVF7LdN+K3EtkHuhiAZoHlARHkEXGo1PWQ2UgBdsbZDY5Bj6GxaGxdyPOiWzlPtJzJs1QkZjOw1W5iEsiRBAANoRmpxEzDeGlven/Y2zeeukad1l5CUzmppH9FMf0tyaEydTCXl7opyNV6ZztplYmc/WHw5TFNdxJkfDE7kuL+ChNygN+AxtlpOjwEGGvnhmhAwsqmjvXymtCpgjclAMA//tSxOoDy+mxBgOEb8GBteDAcI24QAJPRbWrLId5a6O487rmizU+QvOcBeWeWVyQhqSSkWFKGsmT3RD3OXVjis+ZcadEkLKGK6SWpTJjIHSNrXJjF7KtD1yImJJXYGURrSLauxK7xwEWakIQ3cdDFMbMCyEE293ay1U40EpYZo25SeVsZPO23mZ2vqjXzmWSOt6Z6y8R572gq3it02EQ4Zz03wfaejmeKsd8w1EDDTHB1FMjMo0FcHFncTbgnYjNxmeEcy2MXEFB3xan0bQOnLj/+1LE6ADMWbEGA4RpwTe1YVRwjvlJzANRnPXO4znJmc1mzZgV0Ec00bTyJql5KVZtzNCHzpSRjcycjtNm/Olvpd1rAoIuKH0eES3rforkDQz4EtX7HM0Ymzfi7vw19Jg+bVQ0QxwxhKjnDIFaQdzCCgWIsfJtAE0qBCgAetan3rVGPmJtqpF7EXvip5Ln+J0ozBXLWJw5GVWZIJMzAi0kiPBr9Nmb6SUSlY0RbI3Fqg/jPeYp0rF57fRs2ejJWVmNo5WIdYloVkFHaRVYCHBFdP/7UsTtgEwZqQajhGHJhLXg4HCNeVu6Ust3dV8657Is3r/JX6zPKpRifv0ivKbye8nbTOdMyNKhKokjYlsyMQ0GwBbTinG6XKk1tZFkQI4KUopbow9fzObYhyrmEYl//b3hT5bGPzTzXSc27yzEJV40ttSc9BiLytUG2pu+eflC3keXogwJfKbQ7KaGkSZ7vynbyMU/X6Xw3sWwneZRtuv2OZmbN01nwGh/GRoOpb01yybN1nDs+GSiWaQUZ0oJZzUTuH9hcM1d6SIRIYKHetRQ//tSxOqDy+WfBgOEacmFNiDAcI14wN1Z1PRrI1XNqlsrYmYCKMHVrIriGZLoY49mjjMyjAyUwmSINGR0FP78TZOXncu9fdPMqT2ZF8rcuPe+0JhIb2iTj26L/5EGL3CNnsTbEvud31DkIvUc098pemRu/4ZmKOS/MvyzYbaZBv9mtq6Z/Mvt96WZTczkkEdz7z6vhuZg8rtDhZMsyI/5vDLJ6XmX886WSti78I3j5TIinDyOqO/6wJxOqC2fjoBRmIg7tc4OhSAAcytKBFpBCbD/+1LE6ABKta0Io4RzyZY04IChmvHqZEiGz23VHnHvX51je63yiJSev5mRX67EcWhwa3bIzyzgODsMRrFeiXtY6RDGFETzM2oLU4YPn9cf3PSuJkiL6oK1H4yEF5Me6ZFK3fxCLUWkpHaxzmmrbNyqs9d29S+1q9aL5eHvqWrs9Th6dYAAeyWvums9ui7yX4pmvnZdFRBPZLlPfZojSIk8i5P54Uy5SPJdSMmpwyKP+8RyOMdmcLv0uOstzsKwqh9jEULLMlX0a7I5HSkZ0J61QP/7UsToA8sRrwgDhG3JoTWggKCaOURNwGHXBMAAP1VEvq6O60+nUYpfIrhm2U6PiqswzIkYyiNLU7RhwHNa3qlaWvl8o07y2O7GWgzUzlCVOzyBES6y5RJX1nHorNOqrQIhaJBb8UPEEZE8IwRiguFlGTGeELIAfVmZr7KmbSx17nspujXXe6Ik3vZl36pbtj8/KFY/Olzy4RqWqbyq+ufNScEp3snUMl7IZZEDigszF7aIjzRg5gq54dQSoSrHaot2dAxiUTLesL5Z8PWsyE7d//tSxOWDylGvCAOEb8m0teCAoZp54ygPOfqVGwqSAAJXVtWR9b1Fzy4M4b4mEgIJiGfSVh7+SZNMUyZT5vZM6xXPQIorL/LOlY9XPFWzsmTywEKidsPpgKmc1VWqOnVqWDHZMdUPvq1WnW6zTY525ImpjDo6Ds67aXSbdDkNg818CGcz9PV0gcpm0cm8hj955Rj0h2xUnxFM4nFnQiV7g6bs2YpO96RGxJShzdshgcBkJMQgG7YJScUtaJoLILtDgwZgQ7K/rKGRsGFhIiiPyEj/+1LE44DKgbEKo4RxyWc1YSBwjjlIFR8WoMw6itmOzeoroUibA444Famya0hRiKx3QzuXlz5aS5G/A5q2Z5/dUc8ydCXzNFjJ/XVWevcyI8sghEpqqswU8O13CAxLA1hjouDYjlyVFDXc3MeFUVyHFI1UDkDC4yCwYmY1IAgAbtrOTORTMlffIUjz5H/24vg9Ft4UOrxDOcnkX5A6V3ytLJCI0I7MiZekeVJUpkudP4SmxmTU3MdyLpmZ3iVS2L+RNzq7eocYsBWIogTA53JIff/7UMTqgEylsQijjNtJXbVhFHCN+/LraZmCcG1VZ69NKei5kUJ9AFAqZGsMljMpyU2LT0NkjBSl9Xpsb5cLJG0a3CBu9dHldM6ZEsKnMTPbFl6fu9CgnYOZHmwdQge7RjPykMKO4Yx/h0wf5k+GEOYvDggwZaRJJQwAAHVP2a7q1mdEbrrnKqvueU1cr/m94lPIjpma64biZ6nuSYJ+dMIWVqkVNpBMjPSPr5vnfN1KLHM34PUrnlEQ88zIoW4TeiXeiO6Fq9yS22bJrL8ylWX/+1LE6YPMObMGBQRrwYK1IMCgjbndzqTWoWhVafMuYyTEMkBvq9L09dMjlZhZEcoPizngU8evGJ2eeGHmLIgClOlrCaWcOE6SKiRPM75jdpO/5uRmTl0ypBIr730I0Y2IbILmhT0TrVKZEu113qLrFGc1EEcAZSkAAAAGo+6uqt1lI/O8pbmTUHPIHbfZJoshWQs3+/2vukpSoeZJ8qGVXX5FruvTJOLCjlvB0YxU7qhVCLUfTimUWKQjHybRoPkEJSKmFRiIHDoOm6Q9jB0I0P/7UsTmAUtRrwijhGnBdDTgwHCN+UqVCBNEVXdTaX7K7aTylnzeaUjkSmKxkUt7Bjq2duxOb6pNuHnA4NbXvs5KSKe0LOH19qRl5EO5SOmzGZurYSpVFmLxH5u/rkxq5e7m55izGIyYMJMFUFktsyUKwcgojDZhESYBEAAP3RVQxW67CzPnAtkk7UiMubS5qWTZlz/fTtimvcnbpFYD+rTLPbIy9trn7iuIE8djQnTHTM46pMqhvvHrR64rGhPkCMqhmOEiqdycRTxCVhgiLDBu//tSxOgBzNGxBqUM18lMNOEAcI45plAaDu+eQEgQATatl1tY1tV59mDL0dmZ1vVrPwFnOSbI7YlpPKwBDosynlcLCAA5/QaroRxXy9mnLT5mi6o6U/Vkhk6giZYZkPEqyQ6mZjFqxkQMkBBaCMkYULexXSiiDZ0GzKdV0qtd6CpZM+S0HVn7qnBKssFGiQWR557Qp5kshvJSf0/z2Kmlc1OrLI5wN8uhWA8NCNlqFkeCHKrc7joTvQrSMMT4hep3bzYSz8IStvFqpi3Dd0PVTGT/+1LE6QHLgaEJA4RryYM2YNRwjbi+90WZV+zM568I1a9e/IZll9jnq978bzlLnXYoMHp3JXMj/eufimt9iTNJROyBnBhg5gxRWC7nLK/btXhNvd5pZkRKGLxv6OhjHOb2nEzzS7NuGtnImJHh0Wh4LbWPjC1IfF0qBJAAAA9bPSzNXQTPMGPVBye0A0WYDkdZnEd6Bwytly0QdPs75l1d4zJQ+xmdvfdzZEZ7X/I16RmaUltGiCzFGx5VqENiLJ+U8ERlhw9u5mHXD01reiQlVP/7UsTogMvxpwkDhG3JbTVhIHCOObGciE8xPmBqrr1VET8k5RdXNHM8mgSWjJk7oqkpHN4/6FZclfefZIZYJawTYHN6c6bHTsQ8iMSqP6mcNbsDBjhjMkssBrdkSdWgUYFEdjewkWMYKk1F1MQTkC0N0RYEczMbBioQBCAAD2dnzrOfpde6iz2f+4PHEBkWJLBUxn3yyAibJY2R22R+cwjVzNuZWnSbchebNSzHsLMbhUt4tz2JpniDYyVK7h1uiLGRNROBuCIwhLa0cFTOlXzq//tSxOkDyomzCAOEccGjtiCAoZq4kEFkJRyB1m2Te9qIe6URKT0uteaHxeFSSfx/bnxzMhZrycOn/nwuVjpRibY2IcNS2ypwqqHK4M4zmhm1lXcmYTN8ZUZhMnFLUkJOgkPabkfuq+jpZU5hQuH8P1lpUVqG8bVy1SeL4mowJAMAD5m67XZ2f1d9sOHJH9dD12330X/PaupjbMJpE8gaJ2KgUQKbO2ZG+/De6wzOxjLgyPW+l5uVJlYzMWcc8uQ+El+5woJM1SKIVT1+7QG41gP/+1LE6AHL0aEJA4RtyXM1IMBwjblPRHdXa1Vc6yBRneVAqI1cdRxI52VdpSJUzvChkyepmxW/kUBlnm5zTUG0xiNYYLdInHciZI8hq+z75qbEzCisEcFg4YKiA3mStX4DkUIwKUkaGthYUHAQMG5NnT6Th00CAUgAD2SmyIyWZhfRui2rLQIqMgW0rDg1z79Wk5c9yLuWZ6ws0jbXRXmXgz9jjZm+TXqLMo0z9Q7E8tYnzc3N83GzKCGzFapiAaLkJ5YS9Y2t+lx2pKEJjpjqLP/7UsToAMuBqQkDhHHJjTWg1KGa+XfYCSBn9anaU0XmeWD9ETDH77GyRJ2yzNI2p0zyhT1eFD7m7Cc6R3W0jY+Q/hzDER3gVbT4LBFWI+JCM3GipQR0qqFTnH3iKDdb9QIVzlEkUGW2CjY2cGKCBoYsSKx7QSoGsjPGyM/jCSU7ClPZCfr7T5n9NL2F253duvtzcsz0Iia1GMe5El6e91sMFin4lU9isB9NSrIi2Mt2pJq1q9sPRsWjG5ZLSSilHZ91jByI3R1DPlWtVGAAFAot//tSxOYASmWvCwOEc8GCNaDAcI14mE9RyghATqqrZ6MiJm0OZXl0t0nsJSkQKXDFGy7JyAekpCbJRNFWlnWxv235t3aOt6yL166GIds5vzpt+i319yjPhmLjOXiX1lxFz92q+13spnqDe0sv4XDT7Hx3lly7/s3UnhGABAAG2V93PVE86TKZETJHy1plUrJDspIvJGWy1Sfhc0YmNtb/fJaX3E7/wgSEczmW6GatSXMNEMnYxnXyhpd76EaKRZEeJpETmdMhiEcK0o5MFJxEeiH/+1LE6gDL8acJA4RryXO04MCAjfluOJQzg3TPv7f8jkdxyQ8RFAnRYDKclVxMIwfbfdmoYjSHcSO3FHhOL5q5/KZXWgvR0zMgR4gwSUnPy9xZPRBCM4E2BLkaaBiBBAZm9HUJuiVXlAgbmKCAgLOyjmGd4WoN7vc86d6bbkV2oVIFz9CmCDZhc5b1xdvhlNKV1RdIq5WctUj1NJ9Z9XI0q0pU0jOZaGOorFRSRgMymGu0i7qLWH25CMqprB6gpFHCuOFdi0HDhidh2KCFBs1CBv/7UsTpg8wRswYDhGXBeTWgwHCaOeCEBr0m3Y3955ja2WzHX1nojmPSvVV5NeNkWh5Gacjqtyhp1HY+XNy6Z98fpE27KRbCUQocCv1qSJZQ8uJNlEkxGG92SZNCR7yMLCcNOBogVfGMpAPNESOQHEBnUB8YkPTYEgAAAAbQ67K+9O1Goq20syfu13t2q+dbbY6yotXtt0ziFLwz+6+WZMnPROO443rkRFOEbHcsKFJzzTTN1S552FoFkpRLvfq7bV7e+6ouKLmInZNgU+2vxwWc//tSxOgAy4WlCQOEb8lttCDAcI45EIgBAGpMRrujqnP3u+abNyIm5doEgZxJneQQjcqmhMYZXkJTrNHHa/TM9PMtlw+U15/GGumsreViEztbFXRu1cszGsz00/933TbTbLPvNZj4yJQ1m2XvS3nVxhOtq7rGFWzcxkR07RIAADXfdWdlO1ua/V5+6ThN2VTh/adlM3hN2KZ2MRLYdZvn0kG/5zzVlaEXKcYmBDkDrfZw81ZuQ5XIYtNIvkeZYWlCKvQ1FhxyP2M2QqDTC77pbGz/+1LE6gPLwa8GBQRtwYA1oMBxm3HjkQx2lG6sCYeDNau0r/H9aDqeC2c5TJ5z1O2/zwIOXiygmKiu7mpKxGRZGdV5ThSpfzNcQRSNwugkM50IS7wzyUkFDIQk1eW5h+VtTcHYCY4BNqR5BgdCmqF5GsU8wZnBNxtcigEAADbdbtdXXSZVfUtAlFnAFlVo8DZszrzpjZLOOGthlsKBaYYjZBTFDYrihaWl1WuPeKlPNtVJug9Ypxbky1CfQjp0ooBqwdZzHMhJwiozpjPJHsHfRv/7UsTpAMtZmwkDjN7Jl7Xg4HCaOEGAJLWyPWk3Wd81+czoNGI3xJGnPK/Bz5/AWcOAzJAQxcIrGN4fbCVHIrZtRY0Uj4cr2u52xbgcJ2Q/+osQa8MadtR8rFEAxJtCDlAgLrkJghEaIpOOCbJhJQQbB3yc4DFj6ggAACdrVSlvM/fVzzGCZEh64TwTNskmNKL0IMEhxMcAJoU8ATvMeYbCq776/Nhsq8/v9n067X3xKLj9trPeDGj9qyjnVD/9/SeP+W8z8uVx9fFpdBDldb/E//tSxOaBy8WvCKOEY8ltNGDAgI35y3TWxeM6bGUtnm0IYzQohACD7vZr6p169fOp5QW98j8i3CIzB9o6kZJuRDfd8bB+jfENJ/6Z8tM0M+9eFLRKk/kyGT5+d7TB8rHEkPXyJuQrlSz/24YPM8MxPhnVEAAAyiBORfhdPneFamzeZHtd6TeXWS9hEXbpacDP2mZ2yvN1OPzmSOGRRjzUmpbqrch0EhvAjQ9HRERSFKYLODh2qsFHMKbDDxJpAR9WcqBsNCAToJlEGqSg8gLFxQf/+1LE54LLAaUIo4Rz2YU2INRwjXmP2utjgB0WYwEcPBu7f9m/L8r8gyOST/O5IpbdywwHK0RiszVTHlZZBfPyrvNQsNSKeTm0+52Uxl7KRodUyHEJCsH4tcZ55xDgE9yH43sWgwbuo4UusDEAB4KABQmzOgMhAAAGu9Ec99jN5rGLrsq2NkQrJDh5kp01nLl2Lk3osSUy6v0kk86ZUiOEpyQlOBqZw6xGh2pnNvY47mt5cJKGhW/JxnpJvjNrMN6qibrMpdRu22WxfiUtZtiml//7UsTogEzdqQakBNHJOTQhoHCOeYLUaZ63Lwqfep4hAGCAB9XsyrvuzVX6H/TKfJH1Z6ylrF2wTlRskjCbuAADc1aH5CQNCMbAIeF86u3yTYl43wheZ8LpIUBQlM4XZfmW8OH9BN8inNgbmudofPpHYJRIAAAktTzWpqaldbU7vpd7dnTlarcnM7l2E/LujoXDJif8zfNmVdd2McfUyOJiR1LsbJjzrOYgsZEMER9WolpWp5kPsCrlwkjLc25K1tGHZDVWYnPOGdFe+M/szGqm//tSxOuDzTmrBKWEYElPtGEAcI457bp9A8gEAalFYzewaLMwQzoqM3LJLC60B3h2KkI++ad+Fjwzr5Q/KiWnWL0liEdzpPTMzNmRidkFkpGwwch4bMVzpf9Flx3lciBsEGI4eeVWVWMG9d/wwiOHg7y0IqGuyFTOsuYCc9UQAAAnqiVvd32qRktTtFFl7jAqCr/m/ZrKgqiyRb2ZFDQlkPi9Sktg7+UhEL73JiBkSmbwrXpSmSlycnpC1JCY5DFRWK5umj9UIQ0dcaCx4Tlx0zH/+1LE6oDNDbMHA4zVwUq14WBwjniQHKBlowNmvvtNV3NZNFVUzWWUtJz/lfO8zIjz75Ll3nT+8a73yyRLw7xNnS6MdOuLNn6NI2cIjLeLsnJc9fmmPe0hEK/g7KK+Xt5ufvlocqHanb4Ruh+c63iqlFj/pjsTJtzzolGKDdV113SmMZn3zxvbaNCe6Xtnkc0tit8fZp/9M/cuk0P9C6R+R6Zj0Nny8vdW37WeOedth+XmQVgpEKBIKayKCU0EFWGcqtCgdxDyBHLRi8GzMSuIIv/7UsTrAMxdqwajjNmZiTYg1HCNORnUSjq4UFcPEUgAgeqbGHozojqtHrqanDp1FNnU20eShTNRMZjuZGSU7qNyGxicM7t4bJ8JQ8Um6XeN4Zsnd5UNm+aEbeV0Qsc3kMpCt6blwyewWbnftY2JMlQu1XColNpcI0XqAwAAfek/MMuroyo9Veioh1b6/W7oz1a+rO3KI5QtisH6h7RgHoCUu424NkTKZ9mhxz28GRkQxrn1yN/ZsipFEKJYYInIpkRNCQbUnxNVjUSzB3xD5FY6//tSxOYByyWpCKOEb8mFNWDAcZq54RXocPBru7sj9V/iWN8Q3RcgSXAQycvaySO4UnGbsm7cFa5BDUkk0DXaFnFM4T0pBOGLCcZR9iZ45oDFSUMbLhlmlujhqZHZVJgEN2NoUAVc2Xmcyczcw8RiWB6rkqKDBQxpBu1t2quQUApz2GcrosBX4wl1igI01Qd+8O9hi625mvn8QmsS2KDT8rmWvDrwnZKI3OVtd1pVkjJT4FhnKqkRg3dqyB6AB6os64wZzByubQUQ4bMOYlRZGmz/+1LE5oBLoacGBQRpyXE1YSBwjjloQOsoQfIDbq3m2Y+k6bO71RlSp1mau+Q+G/6TfsV7r/Dq5EkVyIjbQnTSGr1SLhU/wRoVQqz8povzVxslzrVBcBUihQPXtB7ui4ALGmSMzfxcthdzSH6XtG0w7X3jdla2UrHNNt2rUpUCFIIAD6aO9Tn0fMPra99rRH/o6lmU58p2UpTkZWRV/LPkVBThKWQEZZscBQAaplxqjc2OzD4/fWxCxhBmSIlc4nsz2dCuytRjUiKq9Fc67qiDiv/7UsTngstxrQijhHyJebZgwHCN+OFHWBr/9HWalpzKRlsuezuH98lkFlB5nX7Tu7OXw0KHDSvPuRqTxB+S3k/RSpNmvaxwdlhGHAbBlDoYqs5IbIKQjVttYVTORRbrXSA5CUHgaqLPM3YBdZBajR5KdQTq+o2ljiKCGKZ0szcrKqczmp8cnskePWLzzkV9ztsGYyhU030Rrs7wiYRGN46oZFUBjrijSQOUsLyRsUr0WW6kLiyAxQdRexkLyENRZKwJqSO6h9Yg8gsVwhXLB33Z//tSxOiDy+WrBgOEbcmJtmDAcZswIEVRTjJVSqAfdnR0RrrrveyNmiLG1HKc1mEmE3mnkZ1zNTyYvaYlKY7jwCEj0E2hQ1Xbza5EjkTs7G0o45e/us8uGZxSM3P87nuhG40+hslU7s1LCBQf5OroGWpR2ATei2iv3K87N3I5MjIub6Wynn2HSI9efNipJZ8V5+7Q1IWR5p+hgjY7dnNXRtzDRzmiux6JTi3JVTTEmo6hjipos4GJVED+1zN4wOqwKmCcT3QMvGwVZyVBYIWgo4b/+1LE5YBKubELA4S1yWc04MBwjbk9MQByJwSb9n0aq2HVXxqVuhXf7sc75Jcv6Ty+urf/dHLWFDyLmyGqV4aUqVtBPuZQ/ErvGOKJBHkrVuhjY1nnWIjuMZx2N51BQdAiuOw/JQilIQc0TOIKEm7uRDjokFBg5oeqBv32ptRkn+iqxLn3XXExER85QTAEwUGjsxdHRnycJ1LU4GSbzNmUP6KzOQklZt4paOOZ8tNTIMUMGgQidE/BtkyVbDiD05DFgBNU3sWsTIQgCMMwzAgY4//7UsTrgczFpwYEBGnJW7XhFHCOeyAlMZGAa1NFZq6JJWplkbhSMJj0kJQPKZVOzkIywbqR+RnMpVrkkVyWqev1T89nLKZMF6SGhfiZ0ts6cd0EdEnMuhWDuCrIxNiSZlAzADM1fBihLhA6Aw1qk0VQxSqTpEVAg0W0BEnVBs001W29URWNSXystetFPNyQyNsdsRAMp+KaoTK6KJyOJDq9JFzh/IOfRiDT0JIhSh1TLQ7WxjKx8o6B4o+5LWUfjVnYsZmpbOGRjhqWbkGMNVsG//tSxOsDzGGlBgQEYIl4tWDAcIy5njZP2xQRoEUEYG1pNV7vyttvvKe5ku8uthzm5807Z06XTIpw9+9M9jmZbvJqWcbUpZyJwvOGEtiERSNsu5bEpkTQrUQjvqRSE1ho7BVOJKg0ak2EhbQ3eR50hXRx+m0BEgam6sv1VN2mm1a5/rv7XprQ7mspZmdtIsympxFR3tGPbwVI3XW0QrFVZiY7HnWOgPhytWyB3VUrWAZTDW9RrFYyU33x1YlMtDNmRdYVT3G1RR8Y9YznVhxv3wb/+1LE6APLkbEGA4RxyYq1oMBwjXjW8jlYrosniwb7WTv3325gOVmnNG8hWU6u7WTVkU+b0jGtDCI0KTGRznpiaqFHI0IrJqaF91Zc6XLOzvkorMZNblK+5lkmShm2huc5xOE6lWNCCxRStD1IaRhVDrdUZ6Xs2erKrnO8s/OkxHYyNlZMkzsSeXX2NOKvrNGpR3cwrkOzlTyLinrbAjJDxdRC2plY6tjKzDIKNYqT7yvT62Z5lA26teyRa8P2CtRhoiba3TFMidMoZGqd3m2Oov/7UsTmAMtZsQgDhHHBZ7ZhIHCNOAemSXplDygYYQkQNa6aIp10zGRyKORoZ6buvOBtuTEatwuM0yPLyvJTzz+rjHwov0ob0oNJR1h7Z4KZyRyvZKaEcDuUxFBSSz0FLSKGRuQkf6kekQr4cc4T8FwkmVHxiKBky9EsIAA1rtmT63rV80lk9+yBK+jNqNGVESPL9I/D9YqGv0nz7pAiP5JDyMOUV3J/MLoTV3dDEFPIVrSnqiNdBLlpm5BiQlNBEX2k4IGNia54Q6WezEq2ELDa//tSxOmDzGGxBgOM2wFMNmEAcI54eQG+z7IzqxiL+DqOgThtzObkbLpYGiMQAETVt5zkutI6zTu4o2VMqpLZ6ED9ZlErhHNM+PkJBEzkPFA5gprHrEqFMhKLJSBA3Rd/R3qGT2CEJ4kgQFATsYKMJGri2B0zqjgAEAAGs+rHLMd1fSiZKUY7zyaMehqRBT+j8zgZBROqsTJmKbU8GV3OomzloRG5buSZIcKIrsSfHmjFQm6stKhDiKNYTQ5VbQyDJYcjvJQvTcEGC4QnI1TUTDz/+1LE7IBNNasEBQzVyW0v4RRwjXmZVUMwIKsBgoEAbdHetZlrJkTgPFRSmTidZk10LjnPmjRF6ZEwaRkT4+fJry0u3868kL1Fz5SUtSLipJHMtjfdCdJGM2PQ0LXhTCwIgGWPTtWPqUotlRG2XWFYjImLUgTBnRUSJBAABqI7OtLXWp1VfkTI5ex0wmZs7mqKZP0j888fOn5KR9jvJ1tL9q83IkPKleZOasvY75pUQGsGRHVT1Q3pof+YnPpPj93oVkeFVjrDQpZVgnlgdKUehv/7UsToAMsppQijhG/Je7VgwHCN+TlyYEAbvZDFd0W5ldzGpmsZ6OvCJ+XJjrkcQuJc/hkfzLY9OGfalYqDs8umnBjmciKr5C28sz2CTXQ4SLI9RRyrqqLJGWYBkTIzJgjKTK7nvjyVuN7zJfXuSqUu7ydo0yaYNC3DSUUwQAAy10kzcdwTlPTZjojxGi3JtnFjNy7OH8Ia0//NLv/+7208+QiKzs4bwzI5soky0p/7gjTgJ+M9OszzMWGzMJNDFNakjk8qUyVBFGNiK4vgV4Sl//tSxOmATCWxCQOEcclxNiEgcI34YlCUE4JMJe8vMggG63W963eu2iJJOYCRkextky0UXjOiMipNxlMWgGRBfZmlGRgM5XliemI5GSmZNmRXzLkig4haW0mu5pRzInQlTQ4DZxGZFnCkDq0MiIOOXkFIZTcqYerLbkUO33qZ7LnVngmWX6Q/kVuAgJRaOat3xVIP8qS6l8uhPEKhAZEqVldxT3zEaDKzILbMkiA33MnYv2J1LbdRFkMPqtOIcDkCqkZm1I2F2FKoXAmDwkBgLwj/+1LE6IDLbaUJA4RtyZC2INRxmvkcKnrEAJEkBOva7GZjKM2yI8p5085JQwJmJrpNmpXFadfy3XmcJz4ztNLDL7Yc2S10Lm3gzFF6hGehjWAych5A6MCbRXZiBXBGpnBUYxFeJq7V+pm73kDVWzppjBs+tTQK+DYDtiYAAHoiUmzHr5hynclrkRmCWjq2Fc87ZBEzETnkmANC9pQBVUgZWz7L9yLfJ2KJvru0X5kQvYYjOi5lUB5Ym0odN51RM8nluafQa6CKhQq1IoKWrEdA9f/7UsTmgMvVlwikBGvJa7RhFHCOed2ggGSQbTZdt07Ks/NzFXbas3a71fa7+8e1P97J3LKEZ3KqlBScVrlkZGr5ZB/3iORfktnJ9FE5tVjuskQ1fEQhJHQWymaBHBdiC78efMMLKx2PqLeHT2TnZW7BTlNjvYwojqoBAAAlpddFv7GdjOGPY+xZWjVSZFP7xsrhN1mSmiQptatHMaSGXSY2hoElyfd4FhpDBfC3oLp716ZRFkXaSZs6D4KwSb0iDsCY3hgnpG/UFGTnYCgwiIYy//tSxOeDy8GrBgUEbcl3tSDAcI25F3iQBniN5p3q4uPiFNRjmaYR45WSBULQ4WnoNY2JCpNzQJpUjTrsFzwuZvywyLz+Q0MipZlq1xB6ugN196UYvre7KURliWswdEe8lRKiBaYIyCsooEAxJmDLd9HiTmQsrmHeBJEAAAaisjrZHocjZji67yQo10NpB2Z/jG2dKx7qizOXKb9dX1nI22UrIYn6nxEOwz0v7FMojkVozPNUA8NGhMVBm9QxLkbjhQkGeJwOSYasCeV4Tp8VFEP/+1LE54DLcbEIo4RxwXs1oMBxm2kF8MW4jQ0IXiQS+2b55+70ur2U9lfezs2zUiLp2Xcj6YO3aWG5FJ5iPSLkYL0WukOlDosr620ttIXzIypxu9VsPg+GuT4a/sMhDMp8s3/lajr3r1/VQWr929Npl/TFfXmWluK8zVGTUoabkMoHcxAAD6X2ed1S/R93a7y8VHq+5lTRFT6n83Vl2ULM8YjIymPK2Arq0M4HyNSQY0oWJc1sWZGSFWLthBfDqq5QpdTpFqSrSVKQKdK8BlFDEf/7UsToAMs1pwijhHPBhLZg1ICN+DXFhUpoYB092RWZ67JZHda6d1ur189tTO9G3Xp55TtN9NJW5Ieu6GQMtVZjHD+D50qZRGfoxLTGmedLtbDyw2ooXmA8DL5KiBEDILUnhUmFFvmoPsIF7wJsb15i9nWlK8vnHw7qKwrZKpEG+z7tv/09E5xP20pnR8pyyd+bKmLEZ/k6A17ORJBRo7Ey6J2qisx2r14bS67x7z/stdsUp890+eMxtbUG9znvHn299nPrHe3y5mstzQNsLb/t//tSxOiAzDmvBwOEbcGLNWDAcZshuuhSACEED9XozbKsd44M8r5Nvw5o7RURmMDQHP20hv3kpkt1P73K7eU8rOOVnpVdzmIVGLIUVzEkLmn6nKRC0enILvDKF0jJYRGZwR5YkbiKLUnQJkda4qxtVPMx2BEhAhUAAAai0vrZ9azlM+zhMj2zh5ORQBwPzXJP1sp56Z5blYd3ITHM5GJ6mkZJp2syklNm+kUKEanlEUwZmfFMQVQ2B8RyUnKg0gAQszRRanokBFlTXBfigoNxqI//+1LE5ABKfZ0LA4R1yZg2INShm2iIaBACQiH3ot0S6o2w5ylzIRq0iM7clhI5LmzmdmuQP5PhqlMjIqZxPyKtL6GWUL8nsZmND2bRs5wqqcDfZyxMMaMRj/LSHp7nTEVaTGxkTRqklfU9fYHXSmWtUAMJyAlZ5ulKlYdKZH6uckzn5EvnWt/yN2Wo/Zbd/QtclyI8nj/sfEZRUr5mjF9CLJeIXWbyq+QknIH/DNddyQ3aQMKPwkab2kGr3gZmJBjHHUIhGvUpacsdhqCdjCIMZP/7UsTlAMqpsQgDhNPBcjYhIHCNuOg4dxYwCAgklcJSLxE5kUU4rmDWXjLNFhLgQ5P7a2/z3iTWwl7UMbVeTOZwjSKpKQUzYXhjIUsoQjppkFEC4AsspmiH5lSJOlVShMpBCOcIJJFWhUTUyVUdnDMZqMJNYkOknQwYCaKUHtUCBFaAD77sctu8y2NEUmNnNrfMpSucWT7jH/rHOE907z5mczf/wuxm3mpy5fwu3fLaF5njMCuUCmZ81PhkjRycydy4ja+WthIZ9atCP2JjL7sH//tSxOoAy9WZCQOEbclxNeEgcI25JXxxQQABMY0+tpzHaOxj6m0dL2faVyu00v/2G0cj1WMhn6Qr/+vcaqvYdKztjMpkHEnIAnCO/Sqx8yaqykfnr5QIDVAZSuKZozy3pK0Y4djaRdWo9KNpjpTZfaHcRbWmGezSjeq56QxMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVQIAQAAHQ9ZrXnmmv/bv+TIRhIUPonwk/sTCT/RPkhP8mYT/+1LE6oDMHa8GBIBgCZU2YOCAjXif8q/+fKtWCqJY///1y4a5/+2pNGVDsNaXtSa653OksP1h/YyrtWNVgoKTQwFAI1IMR2wUakxBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqv/7UsTlAEqtqwsDhG/JkrVglHGa+aqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//tSxM0DytWg9QQEccgAADSAAAAEqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqo=");var __awaiter$Z=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};const jsNameRegex=/^(?!(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$)[$A-Z\_a-z\xaa\xb5\xba\xc0-\xd6\xd8-\xf6\xf8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u08a0\u08a2-\u08ac\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097f\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58\u0c59\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d60\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f0\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191c\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19c1-\u19c7\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua697\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa80-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uabc0-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc][$A-Z\_a-z\xaa\xb5\xba\xc0-\xd6\xd8-\xf6\xf8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u08a0\u08a2-\u08ac\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097f\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58\u0c59\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d60\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f0\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191c\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19c1-\u19c7\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua697\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa80-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uabc0-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc0-9\u0300-\u036f\u0483-\u0487\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u0669\u0670\u06d6-\u06dc\u06df-\u06e4\u06e7\u06e8\u06ea-\u06ed\u06f0-\u06f9\u0711\u0730-\u074a\u07a6-\u07b0\u07c0-\u07c9\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0859-\u085b\u08e4-\u08fe\u0900-\u0903\u093a-\u093c\u093e-\u094f\u0951-\u0957\u0962\u0963\u0966-\u096f\u0981-\u0983\u09bc\u09be-\u09c4\u09c7\u09c8\u09cb-\u09cd\u09d7\u09e2\u09e3\u09e6-\u09ef\u0a01-\u0a03\u0a3c\u0a3e-\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a66-\u0a71\u0a75\u0a81-\u0a83\u0abc\u0abe-\u0ac5\u0ac7-\u0ac9\u0acb-\u0acd\u0ae2\u0ae3\u0ae6-\u0aef\u0b01-\u0b03\u0b3c\u0b3e-\u0b44\u0b47\u0b48\u0b4b-\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b66-\u0b6f\u0b82\u0bbe-\u0bc2\u0bc6-\u0bc8\u0bca-\u0bcd\u0bd7\u0be6-\u0bef\u0c01-\u0c03\u0c3e-\u0c44\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0c66-\u0c6f\u0c82\u0c83\u0cbc\u0cbe-\u0cc4\u0cc6-\u0cc8\u0cca-\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0ce6-\u0cef\u0d02\u0d03\u0d3e-\u0d44\u0d46-\u0d48\u0d4a-\u0d4d\u0d57\u0d62\u0d63\u0d66-\u0d6f\u0d82\u0d83\u0dca\u0dcf-\u0dd4\u0dd6\u0dd8-\u0ddf\u0df2\u0df3\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0e50-\u0e59\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0ed0-\u0ed9\u0f18\u0f19\u0f20-\u0f29\u0f35\u0f37\u0f39\u0f3e\u0f3f\u0f71-\u0f84\u0f86\u0f87\u0f8d-\u0f97\u0f99-\u0fbc\u0fc6\u102b-\u103e\u1040-\u1049\u1056-\u1059\u105e-\u1060\u1062-\u1064\u1067-\u106d\u1071-\u1074\u1082-\u108d\u108f-\u109d\u135d-\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b4-\u17d3\u17dd\u17e0-\u17e9\u180b-\u180d\u1810-\u1819\u18a9\u1920-\u192b\u1930-\u193b\u1946-\u194f\u19b0-\u19c0\u19c8\u19c9\u19d0-\u19d9\u1a17-\u1a1b\u1a55-\u1a5e\u1a60-\u1a7c\u1a7f-\u1a89\u1a90-\u1a99\u1b00-\u1b04\u1b34-\u1b44\u1b50-\u1b59\u1b6b-\u1b73\u1b80-\u1b82\u1ba1-\u1bad\u1bb0-\u1bb9\u1be6-\u1bf3\u1c24-\u1c37\u1c40-\u1c49\u1c50-\u1c59\u1cd0-\u1cd2\u1cd4-\u1ce8\u1ced\u1cf2-\u1cf4\u1dc0-\u1de6\u1dfc-\u1dff\u200c\u200d\u203f\u2040\u2054\u20d0-\u20dc\u20e1\u20e5-\u20f0\u2cef-\u2cf1\u2d7f\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua620-\ua629\ua66f\ua674-\ua67d\ua69f\ua6f0\ua6f1\ua802\ua806\ua80b\ua823-\ua827\ua880\ua881\ua8b4-\ua8c4\ua8d0-\ua8d9\ua8e0-\ua8f1\ua900-\ua909\ua926-\ua92d\ua947-\ua953\ua980-\ua983\ua9b3-\ua9c0\ua9d0-\ua9d9\uaa29-\uaa36\uaa43\uaa4c\uaa4d\uaa50-\uaa59\uaa7b\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uaaeb-\uaaef\uaaf5\uaaf6\uabe3-\uabea\uabec\uabed\uabf0-\uabf9\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\ufe33\ufe34\ufe4d-\ufe4f\uff10-\uff19\uff3f]*$/;function console_log(e,...t){config.debug&&console.log(e,t)}function console_warn(e,...t){config.debug&&console.warn(e,t)}function getInitials(e=config.user.email){const t=e.split("@")[0];if(t.indexOf(" ")>=0){const e=t.split(".");return e[0].substr(0,1).toUpperCase()+e[e.length-1].substr(0,1).toUpperCase()}return t?t.substr(0,2):"??"}function intersectStringArray(e,t){return e&&t?e.filter((e=>t.indexOf(e)>=0)):[]}function getOrder(e=0,t=1,o=!1){let i,r=.5;if(e===t){if(console.error("Order identical to node before"),o)return-1;r=e+Math.random()/1e5}else 1===t?(i=Math.min(1e-4,t-e),r=i/2+e):r=(t-e)/2+e;if(r>=1){if(o)return-1;r=1-Math.random()/1e5,alert("Order resuls in value > 1. "+r)}return r}function shortString(e,t=12){const o=e.split(" ");let i="";const r=t;for(const e of o)if(e.length<r-i.length)i&&(i+=" "),i+=e;else{if(""!==i){if(i.length<=r-6){i+=e.substr(0,r-i.length-2)+"...";break}i+="...";break}i=e.substr(0,r-2)+"..."}return i}var eStyleSheetId;function parseSvg(e){return(new DOMParser).parseFromString(e,"image/svg+xml").querySelector("svg")}function addStyleSheet(e,t){const o=document.getElementsByTagName("head")[0],i=document.createElement("style");i.setAttribute("type","text/css"),"string"==typeof t&&t&&i.setAttribute("id",t),i.appendChild(document.createTextNode(e)),o.appendChild(i)}function removeStyleSheet(e){const t=document.getElementById(e);t&&t.parentNode&&t.parentNode.removeChild(t)}function addFontStyleSheet(e){removeStyleSheet(eStyleSheetId.webfonts);const t=document.getElementById("FontTestDiv");t&&t.parentNode&&t.parentNode.removeChild(t);let o="";for(const t of e)o+=`\n              @font-face {\n                  font-family: ${t.cssName};\n                  src: url("${t.url}") format("truetype");\n              }`;const i=getMonoSpacedFont();o+=`\n  @font-face {\n      font-family: ${i.cssName};\n      src: url("${i.url}") format("truetype");\n  }`,addStyleSheet(o,eStyleSheetId.webfonts);let r="";for(const t of e)r+="<span style='font-size: 10px; font-family: "+t.cssName+"'>test</span>";const s=document.createElement("div");s.style.position="absolute",s.style.top="-100000px",s.style.left="0",s.id="FontTestDiv",s.innerHTML=r,document.body.appendChild(s);const n=[i,...e].map((e=>loadAndCacheFont(e.name,e.url).then((()=>{e.loaded=!0})).catch((t=>{"Noto Sans"!==e.name&&alert("Can't load font ["+e.name+"] ("+e.url+") "+t);const o=scope().fonts.get(e.id);o&&(o.error=t),scope().resourcesFontsUi.requestUpdate()}))));Promise.all(n).then((()=>{scope().fontsLoaded=!0;for(const e of scope().docUi.getWcBoxesWithStory())e.requestUpdate();for(const e of scope().currentDoc.spreads.values())for(const t of e.boxes.values())if(t.docRef){const e=scope().docUi.getWcBox(t.id);e&&e.requestUpdate()}}))}!function(e){e.webfonts="internal_style_webfonts",e.eddiCss="internal_style_eddi",e.masterCss="internal_style_,master"}(eStyleSheetId||(eStyleSheetId={}));const isTouchDevice=function(){const e=" -webkit- -moz- -o- -ms- ".split(" ");if("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)return!0;return function(e){return window.matchMedia(e).matches}(["(",e.join("touch-enabled),("),"heartz",")"].join(""))}();function isMobile(e=896){return!window.matchMedia(`(min-width:  ${e+1}px)`).matches}function createOverlayDiv(){const e=document.createElement("div");return e.style.left="0",e.style.top="0",e.style.bottom="0",e.style.right="0",e.style.position="absolute",e.style.backgroundColor="transparent",e.style.cursor="grab",e}const isIos=()=>{const e=window.navigator.userAgent.toLowerCase();return/iphone|ipad|ipod/.test(e)},isIphone=()=>{const e=window.navigator.userAgent.toLowerCase();return/iphone|ipod/.test(e)},isInStandaloneMode=()=>"standalone"in window.navigator&&window.navigator.standalone;function setMainMobileGridRows(e=130){const t=document.getElementById("mainGrid");if(t){const o=t.clientHeight,i=document.getElementById("dataPanel"),r=document.getElementById("docSelector"),s=document.getElementById("toolbar");let n;if(isMobile()){if(config.hideControls)n="1fr";else{let t=52;isIphone()&&isInStandaloneMode()&&(t+=36,scope().toolbarUi.style.paddingTop="36px"),n=`0px ${t}px ${o-t-e}px ${e}px 0px 0px`}i&&(i.style.display="none"),r&&(r.style.display="none")}else config.isBuyer?(n=config.hideControls?"1fr":1===scope().currentDoc.spreads.size?`0px 36px ${o-36}px 0px 0px 0px`:`0px 36px ${o-36-120}px 120px 0px 0px`,r&&(r.style.display="none"),i&&(i.style.display="none")):(n=`36px 36px ${o-36-36-scope().templateProperties.dataPanelHeight}px 0px ${scope().templateProperties.dataPanelHeight}px 0px`,r&&(r.style.display="inherit"),i&&(i.style.display="inherit"));s&&(config.isBuyer&&config.hideControls?s.style.display="none":s.style.display="inherit"),n!==t.style.gridTemplateRows&&(t.style.gridTemplateRows=n)}}function isInactive(e){return!!("inactive"===e.origin||e.selector&&"unset"!==e.origin&&"Frame"!==e.origin)}function augmentLabel(e,t,o=!1){return t.selector&&"box"!==t.selector&&"none"!==t.selector&&"unset"!==t.selector&&(e+="  ["+t.selector+"]"),(config.debug||o)&&t.origin&&"unset"!==t.origin&&"box"!==t.origin&&"None"!==t.origin&&"inactive"!==t.origin&&(e+="  ("+t.origin+")"),e}function getNotFoundError(e){return"NOT FOUND ["+e+"]"}function getNewName(e,t,o,i=" "){e&&(e=e.replace(/(\[|\])/g,"").trim()),e||(e=t);let r=0;e||(e="New Thing");const s=e.split(i),n=s[s.length-1];function a(){return 0===r?e:e+i+r}for(s.length>1&&parseInt(n).toString()===n&&(r=parseInt(n),s.pop(),e=s.join(i));o(a());)r++;return a()}function beep(){beepSound.volume=.2,beepSound.paused?beepSound.play():beepSound.currentTime=0}function flashScreen(){const e=document.getElementById("copyPasteIndicator");e&&(e.style.display="block"),setTimeout((()=>{const e=document.getElementById("copyPasteIndicator");e&&(e.style.display="none")}),200)}function assertNever$1(e,t=""){throw new Error(t||"Unexpected object: "+e)}function getElementOffset$1(e,t){if("offsetLeft"==t||"offsetTop"==t){let o=e[t],i=e.offsetParent;for(;null!=i;)o+=i[t],i=i.offsetParent;return o}return"offsetHeight"==t||"offsetWidth"==t?e[t]:0}function getImageSizeAsync(e){return __awaiter$Z(this,void 0,void 0,(function*(){return new Promise((t=>{const o=new Image;o.addEventListener("load",(()=>t({width:o.width,height:o.height}))),o.addEventListener("error",(()=>t("Image not found: ["+e+"]"))),o.src=e}))}))}function diff(e,t){if(!t||"[object Object]"!==Object.prototype.toString.call(t))return e;const o={};let i;const r=function(e,t,i){const r=Object.prototype.toString.call(e),s=Object.prototype.toString.call(t);if("[object Undefined]"!==s)if(r===s)if("[object Object]"!==r)"[object Array]"!==r?"[object Function]"===r?e.toString()!==t.toString()&&(o[i]=t):e!==t&&(o[i]=t):function(e,t){if(e.length!==t.length)return!1;for(let o=0;o<e.length;o++){const i=e[o],r=t[o];if("object"==typeof i&&"object"==typeof r){const e=diff(i,r);if(Object.keys(e).length>0)return!1}else if(e[o]!==t[o])return!1}return!0}(e,t)||(o[i]=t);else{const r=diff(e,t);Object.keys(r).length>0&&(o[i]=r)}else o[i]=t;else o[i]=null};for(i in e)Object.prototype.hasOwnProperty.call(e,i)&&r(e[i],t[i],i);for(i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]||e[i]===t[i]||(o[i]=t[i]));return o}function getValidJsName(e){return e.replace(/[^(\d|\w)]/gi,"_").replace(/^\d/,"A$1")}function getValidClassName(e){return e.replace(/[^(\d|\w)]/gi,"-").replace(/^\d/,"A$1")}function camel2title(e){return e.replace(/([A-Z])/g,(function(e){return" "+e})).replace(/^./,(function(e){return e.toUpperCase()}))}function evaluateText(e,t,o){if(!t)return{text:"",errors:[],fields:null,frames:null};const i=[];if(t.indexOf("${")<0)return{text:t,errors:[],fields:null,frames:null};let r="";const s=o||scope().getTargetDocument(e),n=new Map,a=new Map,l={get:function(t,i,r){var n;const l=i.toString();let c=s.getFormField(l,e);if(c||(c=scope().getGlobalFormField(l)),c){const t=scope().getFormFieldValue(l,e,o);a.set(e?l+"#"+e:l,t);const i=null===(n=c.list)||void 0===n?void 0:n.get(t);return i&&i.label?i.label:""}return getNotFoundError("label."+l)}},c={get:function(t,i,r){var n;const l=i.toString();let c=s.getFormField(l,e);if(c||(c=scope().getGlobalFormField(l)),c){const t=scope().getFormFieldValue(l,e,o);a.set(e?l+"#"+e:l,t);const i=null===(n=c.list)||void 0===n?void 0:n.get(t);return i&&i.description?i.description:""}return getNotFoundError("info."+l)}},d={get:function(t,i,r){var n;const l=i.toString();let c=s.getFormField(l,e);if(c||(c=scope().getGlobalFormField(l)),c){const t=scope().getFormFieldValue(l,e,o);a.set(e?l+"#"+e:l,t);const i=null===(n=c.list)||void 0===n?void 0:n.get(t);if(i&&i.imageId){const e=scope().images.get(i.imageId);if(e)return e.url}return""}return getNotFoundError("image."+l)}},h={get:function(t,i,r){const s=i.toString();if(!o)throw"[frame."+s+"] is only available in document styles.";const a=scope().getFrameValue(s,e,o);return n.set(e?s+"#"+e:s,a),a}},p=new Proxy({},{get:function(t,o,i){const r=o.toString();let n=scope().getFormFieldValue(r,e,s);if(n){let t=s.getFormField(r,e);t||(t=scope().getGlobalFormField(r)),t&&(n=t.textBefore+n+t.textAfter)}return a.set(e?r+"#"+e:r,n),n}}),u=new Proxy({},l),m=new Proxy({},c),f=new Proxy({},d),g=new Proxy({},h);try{r=new Function("data","form","frame","label","info","image","return `"+t+"`;").call(null,scope().currentRecord,p,g,u,m,f)}catch(e){i.push(e),r=null}return{text:r,errors:i,fields:a,frames:n}}function hash32(e){let t=2166136261;for(let o=0;o<e.length;o++)t^=e.charCodeAt(o),t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24);return("0000000"+(t>>>0).toString(16)).substr(-8)}function hash64(e){const t=hash32(e);return t+hash32(t+e)}function simpleUnsecureHash(e){return hash64(e)}function asyncTimeout(e){return new Promise((t=>setTimeout(t,e)))}const debounce$1=(e,t,o=!1)=>{let i;return function(...r){return void 0===i&&o&&t.apply(this,r),clearTimeout(i),i=window.setTimeout((()=>{t.apply(this,r)}),e),i}};function promiseDebounce(e,t,o){let i,r=[];return(...s)=>new Promise((n=>{i&&clearTimeout(i),i=window.setTimeout((()=>{i=null,t.apply(e,s).then((e=>{for(const t of r)t(e);r=[]}))}),o),r.push(n)}))}const mouse={initialMovement:0,startScreenX:0,startScreenY:0,deltaScreenX:0,deltaScreenY:0,lastDeltaScreenX:0,lastDeltaScreenY:0,startModelX:0,startModelY:0,startModelXOffset:0,startModelYOffset:0,startScreenCenterX:0,startScreenCenterY:0,startModelCenterX:0,startModelCenterY:0,startZoom:0,shiftStartZoom:1,newZoom:0,startDistance:0,shiftStartDistance:0,startScrollbarTop:0,startScrollbarLeft:0};var edgeScrollDirectionE,scrollBarDragE;let mouseUpCallback,mouseDownCallback,mouseMoveCallback,mouseHoverCallback,mouseOverCallback,mouseLeaveCallback,zoomChangedCallback;!function(e){e.up="up",e.down="down",e.left="left",e.right="right",e.none="none"}(edgeScrollDirectionE||(edgeScrollDirectionE={})),function(e){e.none="none",e.horizontal="horizontal",e.vertical="vertical"}(scrollBarDragE||(scrollBarDragE={}));const surpressSingleTouchPan=!1;let transformRoot,app;const scrollV=generateVerticalScrollerDiv(),scrollH=generateHorizontalScrollerDiv(),scrollAreaV=generateVerticalScrollAreaDiv(),scrollAreaH=generateHorizontalScrollAreaDiv(),singleTouchOverlay=generateSingleTouchOverlayDiv();let contentWidth,contentHeight,curZoom=1,minZoom=.3,maxZoom=4,curTranslateLeft=0,curTranslateTop=0,contextId="",edgeScroll=!0,allowZoomAndPan=!0;const edgeScrollZonePixel=40,edgeScrollAmountPixel=8;let edgeScrollDirection=edgeScrollDirectionE.none;const propagated={curZoom:1,curTranslateLeft:0,curTranslateTop:0};let bleedX=0,bleedY=0,activateWillChange=!0,scrollBarTimeout=null,touchCount=0;const easing={startMs:0,offX:0,offY:0,startX:0,startY:0,duration:800},velocityCaptures=[];let velocityCaptureIndex=0;for(let e=0;e<10;e++)velocityCaptures.push({sX:0,sY:0,ms:0});let panAnimationRunning=!1,lastWheelEvent=(new Date).getMilliseconds(),hasMousePanOnNoZoomItems=!1,i_am_attached=!1,initialZoom=1,activateZoomAnimation=!0;function setZoomAnimationFlag(e){activateZoomAnimation=e}function init(e){if(i_am_attached)return console.error("Zoomstage is already attached to",app),!1;if(initialZoom=e.initialZoom||0,activateWillChange=!!e.activateWillChange,activateZoomAnimation=!!e.activateZoomAnimation,e.bleedX>=0&&(bleedX=e.bleedX),e.bleedY>=0&&(bleedY=e.bleedY),"boolean"==typeof e.edgeScroll&&(edgeScroll=e.edgeScroll),"boolean"==typeof e.allowZoomAndPan&&(allowZoomAndPan=e.allowZoomAndPan),"boolean"==typeof e.mousePanOnNoZoomItems&&(hasMousePanOnNoZoomItems=e.mousePanOnNoZoomItems),zoomChangedCallback=e.zoomChanged_Callback,mouseUpCallback=e.mouseUp_Callback,mouseDownCallback=e.mouseDown_Callback,mouseMoveCallback=e.mouseMove_Callback,mouseHoverCallback=e.mouseHover_Callback,mouseLeaveCallback=e.mouseLeave_Callback,mouseOverCallback=e.mouseOver_Callback,contextId=e.scopeName||"zoomstage",app=document.querySelector(e.stageSelector),transformRoot=document.querySelector(e.contentSelector),!app)throw new Error("zoomstage: No stage ["+e.stageSelector+"] element found");if(!transformRoot)throw new Error("zoomstage: No content-container ["+e.contentSelector+"] element found");transformRoot.style.transformOrigin="0px 0px",transformRoot.style.position="relative",app.style.overflow="hidden";const t=getComputedStyle(app).position;return t&&"static"!==t||(app.style.position="relative"),maxZoom=e.maxZoom||4,minZoom=e.minZoom||.1,scanContentDimensions(contextId,!1),!0}function scanContentDimensions(e,t=!0,o=0,i){if(!transformRoot||appWidth()<=0||appHeight()<=0)return void setTimeout((()=>scanContentDimensions(e,t,o,i)));const r=getContentHeight(),s=getContentWidth();if(r!==contentHeight||s!==contentWidth){if(contentHeight=r,contentWidth=s,!(contentWidth>0))throw new Error("zoomstage: can't determine content width ["+contentWidth+"] ");if(!(contentHeight>0))throw new Error("zoomstage: can't determine content height ["+contentHeight+"] ");minZoom=.1;const n=contentWidth/2;let a=contentHeight/2;a=0;let l=Math.min(appWidth()/contentWidth,appHeight()/contentHeight);initialZoom>=minZoom&&initialZoom<=maxZoom&&(l=initialZoom),recallZoomAndPan(e,o)||(i?i():t&&(curZoom=1,scrollTo(l,n,a,o)))}}function attach(){i_am_attached||detach(),i_am_attached=!0;const e=app,t={passive:!1,capture:!1};e.addEventListener("touchstart",onTouchStartOrMouseDown,t),document.addEventListener("touchmove",onTouchmove,t),document.addEventListener("touchend",onTouchend,t),document.addEventListener("touchcancel",onTouchend,t),e.addEventListener("wheel",onWheel),document.addEventListener("mousemove",onMousemove,t),e.addEventListener("mouseleave",onMouseleave,t),e.addEventListener("mouseover",onMouseover,t),document.addEventListener("mouseup",onMouseup,t),e.addEventListener("mousedown",onTouchStartOrMouseDown,t),document.addEventListener("mousedown",onDocumentTouchStartOrMouseDown,t),allowZoomAndPan&&(e.addEventListener("gesturestart",onGestureStart,!1),e.addEventListener("gesturechange",onGestureChange,!1),e.addEventListener("gestureend",onGestureEnd,!1),e.appendChild(scrollAreaV),e.appendChild(scrollAreaH),scrollAreaV.addEventListener("mousedown",onVerticalScrollAreaDown),scrollAreaH.addEventListener("mousedown",onHorizontalScrollAreaDown),window.addEventListener("keydown",keyDown),window.addEventListener("keyup",keyUp),e.appendChild(scrollV),e.appendChild(scrollH),e.appendChild(singleTouchOverlay)),propagateZoomAndPan()}let spaceKeyPressed=!1;const spaceKeyOverlay=createOverlayDiv();function keyDown(e){" "!==e.key||spaceKeyPressed||(spaceKeyPressed=!0,app.appendChild(spaceKeyOverlay))}function keyUp(e){spaceKeyPressed&&(spaceKeyPressed=!1,app.removeChild(spaceKeyOverlay))}function detach(){if(i_am_attached){i_am_attached=!1;const e=app,t={passive:!1};e.removeEventListener("touchstart",onTouchStartOrMouseDown),document.removeEventListener("touchmove",onTouchmove,t),document.removeEventListener("touchend",onTouchend),document.removeEventListener("touchcancel",onTouchend),e.removeEventListener("wheel",onWheel),e.removeEventListener("mouseleave",onMouseleave),document.removeEventListener("mousemove",onMousemove),document.removeEventListener("mouseup",onMouseup),e.removeEventListener("mousedown",onTouchStartOrMouseDown),document.removeEventListener("mousedown",onDocumentTouchStartOrMouseDown),allowZoomAndPan&&(e.removeEventListener("gesturestart",onGestureStart),e.removeEventListener("gesturechange",onGestureChange),e.removeEventListener("gestureend",onGestureEnd),window.removeEventListener("keydown",keyDown),window.removeEventListener("keyup",keyUp),scrollV.remove(),scrollH.remove(),singleTouchOverlay.remove())}}let removeAndResetWillChangeHint=2e3;function userInteractionStarted(){removeHint()}function userInteractionCompleted(e=500){e>removeAndResetWillChangeHint&&(removeAndResetWillChangeHint=e)}let _noZoomForAllItems=!1;function noZoomForAllItems(e){_noZoomForAllItems=e}function scrollTo(e,t,o,i,r=!1){setZoom(e,i,t,o,void 0,void 0,r),userInteractionCompleted()}function setCenterZoom(e,t=1,o=screenToModelX(appWidth()/2),i=screenToModelY(appHeight()/2)){setZoom(e,t,o,i),userInteractionCompleted()}function zoomFactor(){return curZoom}function forceZoomCallback(){zoomChangedCallback&&zoomChangedCallback(curZoom)}function wasTouchEvent(e){return"touchend"==e.type||"touchstart"==e.type||"touchmove"==e.type||"touchcancel"==e.type}function getMouseOrTouchEventPageXY(e){const t=getMouseOrTouchEventPageXYInternal(e);return t.pageX=t.pageX-appOffsetLeft()+translateLeft()*zoomFactor(),t.pageY=t.pageY-appOffsetTop()+translateTop()*zoomFactor(),t}function getModelPosFromMouseEvent(e){const t=getMouseOrTouchEventPageXYInternal(e);return{modelX:screenToModelX(t.pageX)-appOffsetLeft()/zoomFactor(),modelY:screenToModelY(t.pageY)-appOffsetTop()/zoomFactor()}}const mouseTouchDown={x:0,y:0};let lastMouseTouchWithPosition,mouseTouchDownObject=null,mouseRouting=null;function setMouseRouting(e){mouseRouting=e}function callMouseDownCallback(e){if(scope()&&scope().isReplaying)return;const t=getMouseOrTouchEventPageXY(e);mouseTouchDown.x=t.pageX,mouseTouchDown.y=t.pageY,mouseTouchDownObject=createMouseTouchObject(e),lastMouseTouchWithPosition=mouseTouchDownObject,mouseRouting=null,mouseDownCallback&&mouseDownCallback(mouseTouchDownObject,e)}function callMouseMoveCallback(e){if(!scope()||!scope().isReplaying)if(mouseMoveCallback&&mouseRouting){const t=createMouseTouchObject(e);lastMouseTouchWithPosition=t,mouseMoveCallback(t)}else mouseHoverCallback(createMouseTouchObject(e))}function callMouseUpCallback(e,t){if((!scope()||!scope().isReplaying)&&mouseRouting&&!spaceKeyPressed){const o=createMouseTouchObject(e,lastMouseTouchWithPosition);touchOrMousePanActive?Math.abs(mouse.deltaScreenX)+Math.abs(mouse.deltaScreenY)<20&&mouseUpCallback(o,t):(scope()&&scope().isRecording&&(scope().e2e.lastRecordedActivityTime=Date.now()-2e3,mouseMoveCallback(o)),mouseUpCallback(o,t))}}function createMouseTouchObject(e,t){const o=getMouseOrTouchEventPageXY(e),i=getModelPosFromMouseEvent(e);let r=0,s=!1,n={x:0,y:0};wasTouchEvent(e)?(r=e.touches.length,r>0?(n.x=e.touches[0].clientX,n.y=e.touches[0].clientY):t&&(n=t.client,o.pageX=t.page.x,o.pageY=t.page.y,i.modelX=t.model.x,i.modelY=t.model.y)):(n.x=e.clientX,n.y=e.clientY,s=2===e.button);let a="";return e.target&&"WC-DOC"===e.target.tagName?a="WC-DOC":(e.target===transformRoot||e.target===app)&&(a="STAGE"),{pageStart:{x:mouseTouchDown.x,y:mouseTouchDown.y},modelDelta:{x:(o.pageX-mouseTouchDown.x)/zoomFactor(),y:(o.pageY-mouseTouchDown.y)/zoomFactor()},client:n,page:{x:o.pageX,y:o.pageY},model:{x:i.modelX,y:i.modelY},wasTouchEvent:wasTouchEvent(e),wasRightClick:s,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey,altKey:e.altKey,touches:r,target:a}}function debuglog(e,t=null){}function getMouseOrTouchEventPageXYInternal(e,t=!1){const o={pageX:0,pageY:0};if(e)if(wasTouchEvent(e)){const i=e;i&&i.touches&&i.touches.length>0?i.touches.length>1&&t?(o.pageX=i.touches[1].pageX,o.pageY=i.touches[1].pageY):(o.pageX=i.touches[0].pageX,o.pageY=i.touches[0].pageY):(o.pageX=0,o.pageY=0)}else o.pageX=e.pageX,o.pageY=e.pageY;return o}function generateSingleTouchOverlayDiv(){const e=document.createElement("div"),t=document.createElement("div"),o=document.createTextNode("Use two fingers to zoom and pan.");return e.style.border="1px rgba(255,255,255,0.7) solid",e.style.position="absolute",e.style.display="flex",e.style.alignContent="center",e.style.alignItems="center",e.style.opacity="0",e.style.pointerEvents="none",e.style.backgroundColor="rgba(0,0,0,0.7)",e.style.padding="20% 20% 20% 20%",e.style.transition="opacity 1s",t.style.color="white",t.style.fontFamily="sans-serif",t.style.fontSize="7vw",e.style.left="0",e.style.top="0",e.style.bottom="0",e.style.right="0",t.appendChild(o),e.appendChild(t),e}function generateHorizontalScrollerDiv(){const e=generateScrollerDiv();return e.style.height="6px",e.style.width="100px",e.style.bottom="6px",e.style.left="10%",e}function generateVerticalScrollerDiv(){const e=generateScrollerDiv();return e.style.height="100px",e.style.width="6px",e.style.right="6px",e.style.top="10%",e}function generateScrollerDiv(){const e=document.createElement("div");return e.style.borderRadius="3px",e.style.backgroundColor="rgba(0,0,0,0.6)",e.style.border="1px rgba(255,255,255,0.7) solid",e.style.position="absolute",e.style.display="none",e.style.cursor="pointer",e.style.pointerEvents="none",e}function generateHorizontalScrollAreaDiv(){const e=generateScrollAreaDiv();return e.style.height="15px",e.style.right="0",e.style.bottom="0",e.style.left="0",e}function generateVerticalScrollAreaDiv(){const e=generateScrollAreaDiv();return e.style.width="15px",e.style.right="0",e.style.top="0",e.style.bottom="0",e}function generateScrollAreaDiv(){const e=document.createElement("div");return e.style.position="absolute",e.style.cursor="pointer",e}function propagateZoomAndPan(){i_am_attached&&requestAnimationFrame((function(){panAnimationRunning&&panEasing();const e=propagated.curZoom!==curZoom||propagated.curTranslateLeft!==curTranslateLeft||propagated.curTranslateTop!==curTranslateTop;if(!e)switch(edgeScrollDirection){case edgeScrollDirectionE.down:curTranslateTop=Math.max(-bleedY,Math.min(maxScrollY(),curTranslateTop+8)),showScrollBar();break;case edgeScrollDirectionE.up:curTranslateTop=Math.max(-bleedY,Math.min(maxScrollY(),curTranslateTop-8)),showScrollBar();break;case edgeScrollDirectionE.left:curTranslateLeft=Math.max(-bleedX,Math.min(maxScrollX(),curTranslateLeft-8)),showScrollBar();break;case edgeScrollDirectionE.right:curTranslateLeft=Math.max(-bleedX,Math.min(maxScrollX(),curTranslateLeft+8)),showScrollBar()}if(e){const e="scale("+curZoom+") translate("+-curTranslateLeft+"px,"+-curTranslateTop+"px)";transformRoot.style[transformProp]=e,propagated.curZoom=curZoom,propagated.curTranslateTop=curTranslateTop,propagated.curTranslateLeft=curTranslateLeft}if(removeAndResetWillChangeHint>0){const e=removeAndResetWillChangeHint;removeAndResetWillChangeHint=0,removeHint(),hintBrowserIfIdle(e)}propagateZoomAndPan()}))}let browserWillChangeActive=!1,hintTimeoutHandle=0;function hintBrowserIfIdle(e=500){hintTimeoutHandle&&clearTimeout(hintTimeoutHandle),hintTimeoutHandle=window.setTimeout(hintBrowser,e)}function hintBrowser(){if(hintTimeoutHandle&&(clearTimeout(hintTimeoutHandle),hintTimeoutHandle=0),activateWillChange&&!browserWillChangeActive){transformRoot.style.willChange="transform",browserWillChangeActive=!0;const e=document.getElementById("willChangeIndicator");e&&(e.style.visibility="visible")}}function removeHint(){if(browserWillChangeActive){transformRoot.style.willChange="auto",browserWillChangeActive=!1;const e=document.getElementById("willChangeIndicator");e&&(e.style.visibility="hidden")}}function translateLeft(){return curTranslateLeft}function translateTop(){return curTranslateTop}function appOffsetLeft(){return getElementOffset$2(app,"offsetLeft")}function appOffsetTop(){return getElementOffset$2(app,"offsetTop")}function appWidth(){return getElementOffset$2(app,"offsetWidth")}function appHeight(){return getElementOffset$2(app,"offsetHeight")}function getContentWidth(){let e=transformRoot.offsetWidth;return e>0||transformRoot.style.width&&(e=parseInt(transformRoot.style.width.replace("px",""))),e}function getContentHeight(){let e=transformRoot.offsetHeight;return e>0||transformRoot.style.height&&(e=parseInt(transformRoot.style.height.replace("px",""))),e}function screenToModelX(e){return e/curZoom+curTranslateLeft}function screenToModelY(e){return e/curZoom+curTranslateTop}function modelXToScreenX(e){return(e-curTranslateLeft)*curZoom+appOffsetLeft()}function modelYToScreenY(e){return(e-curTranslateTop)*curZoom+appOffsetTop()}function maxScrollY(){return contentHeight+bleedY-appHeight()/curZoom}function maxScrollX(){return contentWidth+bleedX-appWidth()/curZoom}function setZoom(e,t=0,o,i,r=appWidth()/2,s=appHeight()/2,n=!1){let a,l;e=Math.max(Math.min(e,maxZoom),minZoom);a=-1===o?curTranslateLeft:o-r/e,l=-1===i?curTranslateTop:i-s/e,setZoomAndScroll(e,a,l,t,n)}const transformProp=function(){const e=document.createElement("div");if(null==e.style.transform){const t=["Webkit","Moz","ms"];for(const o of t)if(o+"Transform"in e.style)return o+"Transform"}return"transform"}();function setZoomAndScroll(e,t,o,i=0,r=!1){const s=Math.max(Math.min(e,maxZoom),minZoom);curZoom=s,curTranslateLeft=Math.max(-bleedX,Math.min(maxScrollX(),t)),curTranslateTop=Math.max(-bleedY,Math.min(maxScrollY(),o)),activateZoomAnimation&&(transformRoot.style.transition=i>0?"transform "+i+"s":"none"),r||saveScrollPosition(),zoomChangedCallback&&zoomChangedCallback(curZoom)}function showSingleTouchOverlay(e){"1"!==singleTouchOverlay.style.opacity&&(void 0!==e&&(singleTouchOverlay.style.transition="opacity 100ms",singleTouchOverlay.textContent=e),singleTouchOverlay.style.opacity="1")}function hideSingleTouchOverlay(){"0"!==singleTouchOverlay.style.opacity&&(singleTouchOverlay.style.transition="opacity 1000ms",singleTouchOverlay.style.opacity="0")}function getElementOffset$2(e,t){if("offsetLeft"==t||"offsetTop"==t){let o=e[t],i=e.offsetParent;for(;null!=i;)o+=i[t],i=i.offsetParent;return o}return"offsetHeight"==t||"offsetWidth"==t?e[t]:0}function showScrollBar(){scrollBarTimeout&&clearTimeout(scrollBarTimeout),scrollV.style.display="block",scrollH.style.display="block";const e=contentHeight+2*bleedY,t=contentWidth+2*bleedX,o=appHeight(),i=appWidth();let r=o/(e*curZoom)*o;r<50&&(r=50),r>o&&(r=o);const s=Math.max(0,(curTranslateTop+bleedY)/(maxScrollY()+bleedY)*(o-r));scrollV.style.top=s+2+"px",scrollV.style.height=Math.min(o-19-s,r)+"px";let n=i/(t*curZoom)*i;n<50&&(n=50),n>i&&(n=i);const a=Math.max(0,(curTranslateLeft+bleedX)/(maxScrollX()+bleedX)*(i-n));scrollH.style.left=a+2+"px",scrollH.style.width=Math.min(i-19-a,n)+"px",scrollBarTimeout=setTimeout((function(){scrollV.style.display="none",scrollH.style.display="none",userInteractionCompleted()}),500)}function onVerticalScrollAreaDown(e){e.preventDefault();const t=getMouseOrTouchEventPageXYInternal(e),o=getPixelNumber(scrollV.style.top),i=getPixelNumber(scrollV.style.height);let r=curZoom*contentHeight/(appHeight()/i);r=r/curZoom*.85,t.pageY-appOffsetTop()<o?setZoomAndScroll(curZoom,curTranslateLeft,curTranslateTop-r,.4):t.pageY-appOffsetTop()>o+i?setZoomAndScroll(curZoom,curTranslateLeft,curTranslateTop+r,.4):(app.style.cursor="pointer",scrollBarDragActive=scrollBarDragE.vertical,captureFirstTouchOrMouseDown(e)),showScrollBar()}function onHorizontalScrollAreaDown(e){e.preventDefault();const t=getMouseOrTouchEventPageXYInternal(e),o=getPixelNumber(scrollH.style.left),i=getPixelNumber(scrollH.style.width);let r=curZoom*contentWidth/(appWidth()/i);r=r/curZoom*.85,t.pageX-appOffsetLeft()<o?setZoomAndScroll(curZoom,curTranslateLeft-r,curTranslateTop,.4):t.pageX-appOffsetLeft()>o+i?setZoomAndScroll(curZoom,curTranslateLeft+r,curTranslateTop,.4):(scrollBarDragActive=scrollBarDragE.horizontal,app.style.cursor="pointer",captureFirstTouchOrMouseDown(e)),showScrollBar()}function getPixelNumber(e){return e&&"string"==typeof e&&(e=e.replace("px","")),e?parseInt(e):0}function saveScrollPosition(){window.localStorage.setItem("view"+contextId,JSON.stringify(getCurrentScrollPosition()))}function getCurrentScrollPosition(){return{contextId:contextId,zoom:curZoom,modelX:curTranslateLeft,modelY:curTranslateTop}}function getScreenCenterModelPos(){return{x:curTranslateLeft+appWidth()/2/curZoom,y:curTranslateTop+appHeight()/2/curZoom}}function setCurrentScrollPosition(e,t=.5){e&&e.zoom>0&&(setZoomAndScroll(e.zoom,e.modelX,e.modelY,t,!0),userInteractionCompleted())}function recallZoomAndPan(e=null,t=0){if(e&&(contextId=e),config.hideControls||config.isBuyer||config.isMobile)return!1;let o;const i=window.localStorage.getItem("view"+contextId);return!!(i&&(o=JSON.parse(i),o&&o.zoom>0))&&(setZoomAndScroll(o.zoom,o.modelX,o.modelY,t,!0),userInteractionCompleted(),!0)}function isTargetInputElement(e){if(e&&e.nodeName){const t=e.nodeName.toLowerCase();if("textarea"===t||"input"===t)return!0}return!1}function isTargetStrictNoZoom(e){const t=e.composedPath()[0];return!(!t||!t.closest(".strict-no-zoom"))}function isTargetAllowed(e,t){return!!spaceKeyPressed||(!e||!_noZoomForAllItems&&(t&&null===e.closest(".no-zoom")))}let touchOrMousePanActive=!1,scrollBarDragActive=scrollBarDragE.none,twoFingerTouchActive=!1,Timer50msMouseDownHandle=null,gestureStartZoom=1;function onGestureStart(e){e.preventDefault(),e.stopImmediatePropagation(),isTouchDevice||(gestureStartZoom=curZoom,hintBrowser())}function onGestureChange(e){e.preventDefault(),e.stopImmediatePropagation(),isTouchDevice||(debuglog("GestureChange "+e.scale+" px="+e.pageX+" py="+e.pageY),setZoom(gestureStartZoom*e.scale,0,screenToModelX(e.pageX),screenToModelY(e.pageY),e.pageX,e.pageY,!1))}function onGestureEnd(e){e.preventDefault(),e.stopImmediatePropagation(),isTouchDevice||(removeHint(),hintBrowserIfIdle())}const lastMouseDown={time:0,source:"document"},lastMouseUp={time:0};function onDocumentTouchStartOrMouseDown(e){Date.now()-lastMouseDown.time>20&&(lastMouseDown.time=Date.now(),lastMouseDown.source="document")}function onTouchStartOrMouseDown(e){if(lastMouseDown.time=Date.now(),lastMouseDown.source="stage",panAnimationRunning=!1,mouse.initialMovement=0,!config.hideControls&&scope()&&!scope().eddiActive()&&document.activeElement&&document.activeElement!==document.body)try{document.activeElement.blur()}finally{}if(wasTouchEvent(e)||2!==e.button)if(debuglog("zoomstage onTouchStartOrMouseDown: pageX="+e.pageX+"  pageY="+e.pageY),!wasTouchEvent(e)&&mouseInScrollBarArea(e.pageX,e.pageY));else if(touchCount>0&&wasTouchEvent(e)&&e.touches.length>1){hideSingleTouchOverlay(),hintBrowser(),e.preventDefault(),twoFingerTouchActive=!0,touchCount=e.touches.length;const t=getMouseOrTouchEventPageXYInternal(e),o=getMouseOrTouchEventPageXYInternal(e,!0);mouse.startZoom=curZoom,mouse.newZoom=0,mouse.startDistance=distance(t.pageX,t.pageY,o.pageX,o.pageY),mouse.startScreenCenterX=t.pageX+(o.pageX-t.pageX),mouse.startScreenCenterY=t.pageY+(o.pageY-t.pageY),mouse.startModelCenterX=screenToModelX(mouse.startScreenCenterX),mouse.startModelCenterY=screenToModelY(mouse.startScreenCenterY)}else if(isTargetAllowed(e.target,wasTouchEvent(e)))wasTouchEvent(e)&&e.touches.length,touchOrMousePanActive=!0,e.preventDefault(),transformRoot.style.cursor="grab",wasTouchEvent(e)&&(hintBrowser(),touchCount=e.touches.length),captureFirstTouchOrMouseDown(e),spaceKeyPressed||callMouseDownCallback(e);else{if(isTargetInputElement(e.target))return;if(!allowZoomAndPan)return touchOrMousePanActive=!1,void callMouseDownCallback(e);const t=wasTouchEvent(e)?50:10;if(wasTouchEvent(e)&&e.touches.length,!wasTouchEvent(e)&&!hasMousePanOnNoZoomItems||isTargetStrictNoZoom(e)?(touchOrMousePanActive=!1,spaceKeyPressed||callMouseDownCallback(e)):(e.preventDefault(),t&&(lastMouseTouchWithPosition=createMouseTouchObject(e),Timer50msMouseDownHandle=window.setTimeout((function(){Timer50msMouseDownHandle=null,mouse.initialMovement>3?(touchOrMousePanActive=!0,transformRoot.style.cursor="grab"):(touchOrMousePanActive=!1,spaceKeyPressed||callMouseDownCallback(e))}),t))),e.target.classList.contains("selected")&&!spaceKeyPressed)return void callMouseDownCallback(e);captureFirstTouchOrMouseDown(e),0===touchCount&&wasTouchEvent(e)&&(touchCount=e.touches.length)}else e.preventDefault()}function captureFirstTouchOrMouseDown(e){const t=getMouseOrTouchEventPageXYInternal(e);mouse.initialMovement=0,mouse.startScreenX=t.pageX,mouse.startScreenY=t.pageY,mouse.startModelX=screenToModelX(t.pageX),mouse.startModelY=screenToModelY(t.pageY),mouse.startModelXOffset=curTranslateLeft,mouse.startModelYOffset=curTranslateTop,mouse.startZoom=curZoom,mouse.newZoom=0,mouse.deltaScreenX=0,mouse.deltaScreenY=0}function onMouseleave(e){mouseLeaveCallback&&mouseLeaveCallback()}function onMouseover(e){mouseOverCallback&&mouseOverCallback()}function onMousemove(e){if(mouse.initialMovement=Math.abs(mouse.startScreenX-e.pageX)+Math.abs(mouse.startScreenY-e.pageY),edgeScrollDirection=edgeScrollDirectionE.none,touchOrMousePanActive)1===e.buttons&&"grab"===transformRoot.style.cursor&&(mousePanScroll(getMouseOrTouchEventPageXYInternal(e),0),showScrollBar());else if(1===e.buttons)if(scrollBarDragActive===scrollBarDragE.horizontal){e.preventDefault();const t=(contentWidth+2*bleedX)*curZoom/appWidth();setZoomAndScroll(curZoom,mouse.startModelXOffset+(e.pageX-mouse.startScreenX)/curZoom*t,curTranslateTop,0),showScrollBar()}else if(scrollBarDragActive===scrollBarDragE.vertical){e.preventDefault();const t=(contentHeight+2*bleedY)*curZoom/appHeight();setZoomAndScroll(curZoom,curTranslateLeft,mouse.startModelYOffset+(e.pageY-mouse.startScreenY)/curZoom*t,0),showScrollBar()}else"stage"===lastMouseDown.source&&setEdgeScrollDirection(e.pageX,e.pageY),spaceKeyPressed||callMouseMoveCallback(e);else mouseInScrollBarArea(e.pageX,e.pageY)?showScrollBar():spaceKeyPressed||callMouseMoveCallback(e)}const pinch={pageX:0,pageY:0};let lastDistance=0;function onTouchmove(e){if(1===e.touches.length&&(mouse.initialMovement=Math.abs(mouse.startScreenX-e.touches[0].pageX)+Math.abs(mouse.startScreenY-e.touches[0].pageY)),touchOrMousePanActive||twoFingerTouchActive)if(e.preventDefault(),edgeScrollDirection=edgeScrollDirectionE.none,panAnimationRunning=!1,e.shiftKey||(mouse.shiftStartDistance=0),1===e.touches.length&&e.shiftKey){const t=getMouseOrTouchEventPageXYInternal(e);0===mouse.shiftStartDistance&&(pinch.pageX=t.pageX-300*curZoom,pinch.pageY=t.pageY,mouse.shiftStartZoom=curZoom,mouse.shiftStartDistance=distance(t.pageX,t.pageY,pinch.pageX,pinch.pageY),mouse.startScreenCenterX=t.pageX+(pinch.pageX-t.pageX),mouse.startScreenCenterY=t.pageY+(pinch.pageY-t.pageY),mouse.startModelCenterX=screenToModelX(mouse.startScreenCenterX),mouse.startModelCenterY=screenToModelY(mouse.startScreenCenterY));let o=distance(t.pageX,t.pageY,pinch.pageX,pinch.pageY);lastDistance&&e.ctrlKey?o=lastDistance:lastDistance=o;const i=mouse.shiftStartZoom*(o/mouse.shiftStartDistance),r={pageX:t.pageX+(pinch.pageX-t.pageX),pageY:t.pageY+(pinch.pageY-t.pageY)};mouse.deltaScreenX=mouse.startScreenCenterX-r.pageX,mouse.deltaScreenY=mouse.startScreenCenterY-r.pageY,scope()&&!1===scope().cropEditorActive()&&setZoom(i,0,mouse.startModelCenterX+mouse.deltaScreenX/curZoom,mouse.startModelCenterY+mouse.deltaScreenY/curZoom,mouse.startScreenCenterX,mouse.startScreenCenterY)}else if(e.touches.length>=2&&mouse.startDistance>0&&twoFingerTouchActive){const t=getMouseOrTouchEventPageXYInternal(e),o=getMouseOrTouchEventPageXYInternal(e,!0),i=distance(t.pageX,t.pageY,o.pageX,o.pageY);mouse.newZoom=mouse.startZoom*(i/mouse.startDistance);const r={pageX:t.pageX+(o.pageX-t.pageX),pageY:t.pageY+(o.pageY-t.pageY)};mouse.deltaScreenX=mouse.startScreenCenterX-r.pageX,mouse.deltaScreenY=mouse.startScreenCenterY-r.pageY,scope()&&(!1===scope().cropEditorActive()?setZoom(mouse.newZoom,0,mouse.startModelCenterX+mouse.deltaScreenX/curZoom,mouse.startModelCenterY+mouse.deltaScreenY/curZoom,mouse.startScreenCenterX,mouse.startScreenCenterY):scope().selection.setImageScale(mouse.newZoom/mouse.startZoom,mouse.deltaScreenX,mouse.deltaScreenY))}else e.touches.length>0&&(touchOrMousePanActive?mousePanScroll(getMouseOrTouchEventPageXYInternal(e),e.touches.length):1===e.touches.length&&setEdgeScrollDirection(e.touches[0].pageX,e.touches[0].pageY));else callMouseMoveCallback(e)}function setEdgeScrollDirection(e,t){edgeScrollDirection=edgeScroll?e>=appOffsetLeft()&&e<appOffsetLeft()+40?edgeScrollDirectionE.left:e>appOffsetLeft()+appWidth()-40&&e<=appOffsetLeft()+appWidth()?edgeScrollDirectionE.right:t>=appOffsetTop()&&t<appOffsetTop()+40?edgeScrollDirectionE.up:t>appOffsetTop()+appHeight()-40&&t<=appOffsetTop()+appHeight()?edgeScrollDirectionE.down:edgeScrollDirectionE.none:edgeScrollDirectionE.none,edgeScrollDirection!==edgeScrollDirectionE.none&&showScrollBar()}function mouseInScrollBarArea(e,t){return e>appOffsetLeft()+appWidth()-20&&e<=appOffsetLeft()+appWidth()||t>appOffsetTop()+appHeight()-20&&t<=appOffsetTop()+appHeight()}function onMouseup(e){if(!wasTouchEvent(e)&&2===e.button)return void e.preventDefault();let t=!1;Date.now()-lastMouseUp.time<300&&(t=!0),lastMouseUp.time=Date.now(),Timer50msMouseDownHandle&&clearTimeout(Timer50msMouseDownHandle),isTargetInputElement(e.target)||(scrollBarDragActive!==scrollBarDragE.none?scrollBarDragActive=scrollBarDragE.none:callMouseUpCallback(e,t),touchOrMousePanActive&&(transformRoot.style.cursor="auto",touchOrMousePanActive=!1))}function onTouchend(e){let t=!1;if(Date.now()-lastMouseUp.time<500&&(t=!0),lastMouseUp.time=Date.now(),Timer50msMouseDownHandle&&(clearTimeout(Timer50msMouseDownHandle),lastMouseTouchWithPosition&&mouseDownCallback))return mouseDownCallback(lastMouseTouchWithPosition,e),void window.setTimeout((()=>{lastMouseTouchWithPosition&&mouseDownCallback&&(lastMouseTouchWithPosition.touches=0,mouseUpCallback(lastMouseTouchWithPosition,t),mouseRouting=null)}),50);twoFingerTouchActive&&e.touches.length<2&&(twoFingerTouchActive=!1,scope()&&scope().cropEditorActive()&&scope().selection.persistImageScale(),userInteractionCompleted()),touchOrMousePanActive?(e.touches.length>0?captureFirstTouchOrMouseDown(e):(callMouseUpCallback(e,t),touchOrMousePanActive=!1,mouse.lastDeltaScreenY=0,mouse.lastDeltaScreenX=0,startPanEasing()),touchCount=e.touches.length,mouse.startDistance=0):0===e.touches.length&&0===mouse.newZoom&&callMouseUpCallback(e,t)}function distance(e,t,o,i){const r=o-e,s=i-t;return Math.sqrt(r*r+s*s)}function startPanEasing(){let e,t;const o={x:0,y:0};let i=0,r=0;const s=Date.now();let n=null;for(e=velocityCaptureIndex,t=0;t<10;t++)if(e--,e<0&&(e=9),velocityCaptures[e].ms>0){const t=s-velocityCaptures[e].ms;if(t>20){debuglog("CATCH Velocity Time Diff:"+t+"ms + Dist="+Math.sqrt(Math.pow(velocityCaptures[e].sX,2)+Math.pow(velocityCaptures[e].sY,2))),n=velocityCaptures[e];break}}if(n&&(n.sX||n.sY)){const e=s-n.ms,t={x:n.sX,y:n.sY};(t.x||t.y)&&(r=Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2)),i=r/e,o.x=-t.x/r,o.y=-t.y/r),easing.startMs=Date.now(),i>0&&(easing.startX=curTranslateLeft,easing.startY=curTranslateTop,easing.offX=i*easing.duration*o.x,easing.offY=i*easing.duration*o.y,(Math.abs(easing.offX)>100||Math.abs(easing.offY)>100)&&(panAnimationRunning=!0,requestAnimationFrame(panEasing)))}for(let e=0;e<10;e++)velocityCaptures[e].ms=0;panAnimationRunning||finalizePanEasing()}function panEasing(){const e=Date.now()-easing.startMs;if(panAnimationRunning&&e<=easing.duration){let t=e/easing.duration;t=easingFunction(t);const o=easing.startX+easing.offX/curZoom*t,i=easing.startY+easing.offY/curZoom*t;setZoomAndScroll(curZoom,o,i,0,!0)}else finalizePanEasing()}function finalizePanEasing(){saveScrollPosition(),panAnimationRunning=!1,curZoom>1&&(removeHint(),hintBrowserIfIdle())}function easingFunction(e){return e*(2-e)}function mousePanScroll(e,t,o=curZoom){if(!allowZoomAndPan)return;mouse.deltaScreenX=mouse.startScreenX-e.pageX,mouse.deltaScreenY=mouse.startScreenY-e.pageY;const i=mouse.startModelXOffset+mouse.deltaScreenX/curZoom,r=mouse.startModelYOffset+mouse.deltaScreenY/curZoom;if(1===t)velocityCaptures[velocityCaptureIndex]={sX:-mouse.deltaScreenX-mouse.lastDeltaScreenX,sY:-mouse.deltaScreenY-mouse.lastDeltaScreenY,ms:Date.now()},mouse.lastDeltaScreenX=-mouse.deltaScreenX,mouse.lastDeltaScreenY=-mouse.deltaScreenY,velocityCaptureIndex++,10===velocityCaptureIndex&&(velocityCaptureIndex=0);else{velocityCaptureIndex=0;for(let e=0;e<10;e++)velocityCaptures[e].ms=0}setZoomAndScroll(o,i,r,0)}function onWheel(e){if(e.preventDefault(),!allowZoomAndPan)return;let t=curZoom,o=screenToModelX(e.pageX),i=screenToModelY(e.pageY);if(e.ctrlKey){const o=(new Date).getMilliseconds()-lastWheelEvent;let i=Math.max(Math.min(30,o),10)-10;i/=20,i*=.05,i+=1.01,lastWheelEvent=(new Date).getMilliseconds(),t=e.deltaY>=0?curZoom/i:curZoom*i}else o+=1.2*e.deltaX/curZoom,i+=1.2*e.deltaY/curZoom;setZoom(t,0,o,i,e.pageX,e.pageY,!1),showScrollBar()}const printess=function(){var e="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0;return"undefined"!=typeof __filename&&(e=e||__filename),function(t){var o,i,r=void 0!==(t=t||{})?t:{};r.ready=new Promise((function(e,t){o=e,i=t})),Object.getOwnPropertyDescriptor(r.ready,"_malloc")||(Object.defineProperty(r.ready,"_malloc",{configurable:!0,get:function(){Ne("You are getting _malloc on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(r.ready,"_malloc",{configurable:!0,set:function(){Ne("You are setting _malloc on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(r.ready,"_calloc")||(Object.defineProperty(r.ready,"_calloc",{configurable:!0,get:function(){Ne("You are getting _calloc on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(r.ready,"_calloc",{configurable:!0,set:function(){Ne("You are setting _calloc on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(r.ready,"_hb_blob_create")||(Object.defineProperty(r.ready,"_hb_blob_create",{configurable:!0,get:function(){Ne("You are getting _hb_blob_create on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(r.ready,"_hb_blob_create",{configurable:!0,set:function(){Ne("You are setting _hb_blob_create on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(r.ready,"_hb_face_create")||(Object.defineProperty(r.ready,"_hb_face_create",{configurable:!0,get:function(){Ne("You are getting _hb_face_create on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(r.ready,"_hb_face_create",{configurable:!0,set:function(){Ne("You are setting _hb_face_create on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(r.ready,"_hb_font_create")||(Object.defineProperty(r.ready,"_hb_font_create",{configurable:!0,get:function(){Ne("You are getting _hb_font_create on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(r.ready,"_hb_font_create",{configurable:!0,set:function(){Ne("You are setting _hb_font_create on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(r.ready,"_hb_buffer_create")||(Object.defineProperty(r.ready,"_hb_buffer_create",{configurable:!0,get:function(){Ne("You are getting _hb_buffer_create on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(r.ready,"_hb_buffer_create",{configurable:!0,set:function(){Ne("You are setting _hb_buffer_create on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(r.ready,"_hb_buffer_add_utf8")||(Object.defineProperty(r.ready,"_hb_buffer_add_utf8",{configurable:!0,get:function(){Ne("You are getting _hb_buffer_add_utf8 on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(r.ready,"_hb_buffer_add_utf8",{configurable:!0,set:function(){Ne("You are setting _hb_buffer_add_utf8 on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(r.ready,"_hb_buffer_guess_segment_properties")||(Object.defineProperty(r.ready,"_hb_buffer_guess_segment_properties",{configurable:!0,get:function(){Ne("You are getting _hb_buffer_guess_segment_properties on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(r.ready,"_hb_buffer_guess_segment_properties",{configurable:!0,set:function(){Ne("You are setting _hb_buffer_guess_segment_properties on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(r.ready,"_hb_buffer_set_direction")||(Object.defineProperty(r.ready,"_hb_buffer_set_direction",{configurable:!0,get:function(){Ne("You are getting _hb_buffer_set_direction on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(r.ready,"_hb_buffer_set_direction",{configurable:!0,set:function(){Ne("You are setting _hb_buffer_set_direction on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(r.ready,"_hb_shape")||(Object.defineProperty(r.ready,"_hb_shape",{configurable:!0,get:function(){Ne("You are getting _hb_shape on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(r.ready,"_hb_shape",{configurable:!0,set:function(){Ne("You are setting _hb_shape on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(r.ready,"_hb_buffer_get_glyph_infos")||(Object.defineProperty(r.ready,"_hb_buffer_get_glyph_infos",{configurable:!0,get:function(){Ne("You are getting _hb_buffer_get_glyph_infos on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(r.ready,"_hb_buffer_get_glyph_infos",{configurable:!0,set:function(){Ne("You are setting _hb_buffer_get_glyph_infos on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(r.ready,"_hb_buffer_get_glyph_positions")||(Object.defineProperty(r.ready,"_hb_buffer_get_glyph_positions",{configurable:!0,get:function(){Ne("You are getting _hb_buffer_get_glyph_positions on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(r.ready,"_hb_buffer_get_glyph_positions",{configurable:!0,set:function(){Ne("You are setting _hb_buffer_get_glyph_positions on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(r.ready,"_hb_buffer_get_length")||(Object.defineProperty(r.ready,"_hb_buffer_get_length",{configurable:!0,get:function(){Ne("You are getting _hb_buffer_get_length on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(r.ready,"_hb_buffer_get_length",{configurable:!0,set:function(){Ne("You are setting _hb_buffer_get_length on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(r.ready,"_hb_buffer_destroy")||(Object.defineProperty(r.ready,"_hb_buffer_destroy",{configurable:!0,get:function(){Ne("You are getting _hb_buffer_destroy on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(r.ready,"_hb_buffer_destroy",{configurable:!0,set:function(){Ne("You are setting _hb_buffer_destroy on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(r.ready,"_hb_font_destroy")||(Object.defineProperty(r.ready,"_hb_font_destroy",{configurable:!0,get:function(){Ne("You are getting _hb_font_destroy on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(r.ready,"_hb_font_destroy",{configurable:!0,set:function(){Ne("You are setting _hb_font_destroy on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(r.ready,"_hb_face_destroy")||(Object.defineProperty(r.ready,"_hb_face_destroy",{configurable:!0,get:function(){Ne("You are getting _hb_face_destroy on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(r.ready,"_hb_face_destroy",{configurable:!0,set:function(){Ne("You are setting _hb_face_destroy on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(r.ready,"_hb_blob_destroy")||(Object.defineProperty(r.ready,"_hb_blob_destroy",{configurable:!0,get:function(){Ne("You are getting _hb_blob_destroy on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(r.ready,"_hb_blob_destroy",{configurable:!0,set:function(){Ne("You are setting _hb_blob_destroy on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(r.ready,"_hb_blob_get_length")||(Object.defineProperty(r.ready,"_hb_blob_get_length",{configurable:!0,get:function(){Ne("You are getting _hb_blob_get_length on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(r.ready,"_hb_blob_get_length",{configurable:!0,set:function(){Ne("You are setting _hb_blob_get_length on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(r.ready,"_hb_font_set_scale")||(Object.defineProperty(r.ready,"_hb_font_set_scale",{configurable:!0,get:function(){Ne("You are getting _hb_font_set_scale on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(r.ready,"_hb_font_set_scale",{configurable:!0,set:function(){Ne("You are setting _hb_font_set_scale on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(r.ready,"_hb_face_get_upem")||(Object.defineProperty(r.ready,"_hb_face_get_upem",{configurable:!0,get:function(){Ne("You are getting _hb_face_get_upem on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(r.ready,"_hb_face_get_upem",{configurable:!0,set:function(){Ne("You are setting _hb_face_get_upem on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(r.ready,"_hb_font_get_h_extents")||(Object.defineProperty(r.ready,"_hb_font_get_h_extents",{configurable:!0,get:function(){Ne("You are getting _hb_font_get_h_extents on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(r.ready,"_hb_font_get_h_extents",{configurable:!0,set:function(){Ne("You are setting _hb_font_get_h_extents on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(r.ready,"_hb_font_get_glyph_extents")||(Object.defineProperty(r.ready,"_hb_font_get_glyph_extents",{configurable:!0,get:function(){Ne("You are getting _hb_font_get_glyph_extents on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(r.ready,"_hb_font_get_glyph_extents",{configurable:!0,set:function(){Ne("You are setting _hb_font_get_glyph_extents on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(r.ready,"_free")||(Object.defineProperty(r.ready,"_free",{configurable:!0,get:function(){Ne("You are getting _free on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(r.ready,"_free",{configurable:!0,set:function(){Ne("You are setting _free on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(r.ready,"_sbrk")||(Object.defineProperty(r.ready,"_sbrk",{configurable:!0,get:function(){Ne("You are getting _sbrk on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(r.ready,"_sbrk",{configurable:!0,set:function(){Ne("You are setting _sbrk on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(r.ready,"_stackSave")||(Object.defineProperty(r.ready,"_stackSave",{configurable:!0,get:function(){Ne("You are getting _stackSave on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(r.ready,"_stackSave",{configurable:!0,set:function(){Ne("You are setting _stackSave on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(r.ready,"_stackRestore")||(Object.defineProperty(r.ready,"_stackRestore",{configurable:!0,get:function(){Ne("You are getting _stackRestore on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(r.ready,"_stackRestore",{configurable:!0,set:function(){Ne("You are setting _stackRestore on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(r.ready,"_stackAlloc")||(Object.defineProperty(r.ready,"_stackAlloc",{configurable:!0,get:function(){Ne("You are getting _stackAlloc on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(r.ready,"_stackAlloc",{configurable:!0,set:function(){Ne("You are setting _stackAlloc on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(r.ready,"___data_end")||(Object.defineProperty(r.ready,"___data_end",{configurable:!0,get:function(){Ne("You are getting ___data_end on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(r.ready,"___data_end",{configurable:!0,set:function(){Ne("You are setting ___data_end on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(r.ready,"___wasm_call_ctors")||(Object.defineProperty(r.ready,"___wasm_call_ctors",{configurable:!0,get:function(){Ne("You are getting ___wasm_call_ctors on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(r.ready,"___wasm_call_ctors",{configurable:!0,set:function(){Ne("You are setting ___wasm_call_ctors on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(r.ready,"___errno_location")||(Object.defineProperty(r.ready,"___errno_location",{configurable:!0,get:function(){Ne("You are getting ___errno_location on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(r.ready,"___errno_location",{configurable:!0,set:function(){Ne("You are setting ___errno_location on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(r.ready,"_emscripten_get_sbrk_ptr")||(Object.defineProperty(r.ready,"_emscripten_get_sbrk_ptr",{configurable:!0,get:function(){Ne("You are getting _emscripten_get_sbrk_ptr on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(r.ready,"_emscripten_get_sbrk_ptr",{configurable:!0,set:function(){Ne("You are setting _emscripten_get_sbrk_ptr on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(r.ready,"_setThrew")||(Object.defineProperty(r.ready,"_setThrew",{configurable:!0,get:function(){Ne("You are getting _setThrew on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(r.ready,"_setThrew",{configurable:!0,set:function(){Ne("You are setting _setThrew on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(r.ready,"_memalign")||(Object.defineProperty(r.ready,"_memalign",{configurable:!0,get:function(){Ne("You are getting _memalign on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(r.ready,"_memalign",{configurable:!0,set:function(){Ne("You are setting _memalign on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(r.ready,"_memset")||(Object.defineProperty(r.ready,"_memset",{configurable:!0,get:function(){Ne("You are getting _memset on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(r.ready,"_memset",{configurable:!0,set:function(){Ne("You are setting _memset on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(r.ready,"_emscripten_main_thread_process_queued_calls")||(Object.defineProperty(r.ready,"_emscripten_main_thread_process_queued_calls",{configurable:!0,get:function(){Ne("You are getting _emscripten_main_thread_process_queued_calls on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(r.ready,"_emscripten_main_thread_process_queued_calls",{configurable:!0,set:function(){Ne("You are setting _emscripten_main_thread_process_queued_calls on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(r.ready,"_realloc")||(Object.defineProperty(r.ready,"_realloc",{configurable:!0,get:function(){Ne("You are getting _realloc on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(r.ready,"_realloc",{configurable:!0,set:function(){Ne("You are setting _realloc on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(r.ready,"_testSetjmp")||(Object.defineProperty(r.ready,"_testSetjmp",{configurable:!0,get:function(){Ne("You are getting _testSetjmp on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(r.ready,"_testSetjmp",{configurable:!0,set:function(){Ne("You are setting _testSetjmp on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(r.ready,"_saveSetjmp")||(Object.defineProperty(r.ready,"_saveSetjmp",{configurable:!0,get:function(){Ne("You are getting _saveSetjmp on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(r.ready,"_saveSetjmp",{configurable:!0,set:function(){Ne("You are setting _saveSetjmp on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(r.ready,"__get_tzname")||(Object.defineProperty(r.ready,"__get_tzname",{configurable:!0,get:function(){Ne("You are getting __get_tzname on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(r.ready,"__get_tzname",{configurable:!0,set:function(){Ne("You are setting __get_tzname on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(r.ready,"__get_daylight")||(Object.defineProperty(r.ready,"__get_daylight",{configurable:!0,get:function(){Ne("You are getting __get_daylight on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(r.ready,"__get_daylight",{configurable:!0,set:function(){Ne("You are setting __get_daylight on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(r.ready,"__get_timezone")||(Object.defineProperty(r.ready,"__get_timezone",{configurable:!0,get:function(){Ne("You are getting __get_timezone on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(r.ready,"__get_timezone",{configurable:!0,set:function(){Ne("You are setting __get_timezone on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(r.ready,"onRuntimeInitialized")||(Object.defineProperty(r.ready,"onRuntimeInitialized",{configurable:!0,get:function(){Ne("You are getting onRuntimeInitialized on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(r.ready,"onRuntimeInitialized",{configurable:!0,set:function(){Ne("You are setting onRuntimeInitialized on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),function(e){e.GetWebGLContext=function(e,t){return function(e,t){return e?xi.createContext(e,{alpha:1,depth:0,stencil:8,antialias:1,premultipliedAlpha:1,preserveDrawingBuffer:0,preferLowPowerToHighPerformance:0,failIfMajorPerformanceCaveat:0,majorVersion:1,minorVersion:0,enableExtensionsByDefault:1,explicitSwapControl:0,renderViaOffscreenBackBuffer:0}):0}(e)},e.MakeWebGLCanvasSurface=function(t){var o=e.GetWebGLContext(t);if(!o||o<0)throw"failed to create webgl context: err "+o;var i=this.MakeGrContext(o);if(!i)throw"failed to create grcontext. Open GL driver may not support all needed functions: err "+i;t.grContext=i;var r=this.MakeOnScreenGLSurface(i,t.width,t.height),s=t.GLctxObject.version;if(window&&(window.printessOpenGlVersion=s),!r)throw"Failed to create OpenGL surface. GPU Backend unavailable.";return r},e.deleteContext=function(e){xi.deleteContext(e.GLctxObject.handle)},e.makeContextCurrent=function(e){xi.makeContextCurrent(e.GLctxObject.handle)},e.MakeCanvasSurface=e.MakeWebGLCanvasSurface}(r);var s,n={};for(s in r)r.hasOwnProperty(s)&&(n[s]=r[s]);var a="./this.program",l=function(e,t){throw t},c=!1,d=!1,h=!1,p=!1;if(c="object"==typeof window,d="function"==typeof importScripts,h="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,p=!c&&!h&&!d,r.ENVIRONMENT)throw new Error("Module.ENVIRONMENT has been deprecated. To force the environment, use the ENVIRONMENT compile-time option (for example, -s ENVIRONMENT=web or -s ENVIRONMENT=node)");var u,m,f,g,y="";function b(e){return r.locateFile?r.locateFile(e,y):y+e}if(h)y=d?require("path").dirname(y)+"/":__dirname+"/",u=function(e,t){return f||(f=require("fs")),g||(g=require("path")),e=g.normalize(e),f.readFileSync(e,t?null:"utf8")},m=function(e){var t=u(e,!0);return t.buffer||(t=new Uint8Array(t)),N(t.buffer),t},process.argv.length>1&&(a=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",(function(e){if(!(e instanceof Fa))throw e})),process.on("unhandledRejection",Ne),l=function(e){process.exit(e)},r.inspect=function(){return"[Emscripten Module object]"};else if(p)"undefined"!=typeof read&&(u=function(e){return read(e)}),m=function(e){var t;return"function"==typeof readbuffer?new Uint8Array(readbuffer(e)):(N("object"==typeof(t=read(e,"binary"))),t)},"undefined"!=typeof scriptArgs?scriptArgs:void 0!==arguments&&arguments,"function"==typeof quit&&(l=function(e){quit(e)}),"undefined"!=typeof print&&("undefined"==typeof console&&(console={}),console.log=print,console.warn=console.error="undefined"!=typeof printErr?printErr:print);else{if(!c&&!d)throw new Error("environment detection error");d?y=self.location.href:document.currentScript&&(y=document.currentScript.src),e&&(y=e),y=0!==y.indexOf("blob:")?y.substr(0,y.lastIndexOf("/")+1):"",u=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},d&&(m=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)})}var v=r.print||console.log.bind(console),x=r.printErr||console.warn.bind(console);for(s in n)n.hasOwnProperty(s)&&(r[s]=n[s]);function w(e){w.shown||(w.shown={}),w.shown[e]||(w.shown[e]=1,x(e))}n=null,r.arguments&&r.arguments,Object.getOwnPropertyDescriptor(r,"arguments")||Object.defineProperty(r,"arguments",{configurable:!0,get:function(){Ne("Module.arguments has been replaced with plain arguments_ (the initial value can be provided on Module, but after startup the value is only looked for on a local variable of that name)")}}),r.thisProgram&&(a=r.thisProgram),Object.getOwnPropertyDescriptor(r,"thisProgram")||Object.defineProperty(r,"thisProgram",{configurable:!0,get:function(){Ne("Module.thisProgram has been replaced with plain thisProgram (the initial value can be provided on Module, but after startup the value is only looked for on a local variable of that name)")}}),r.quit&&(l=r.quit),Object.getOwnPropertyDescriptor(r,"quit")||Object.defineProperty(r,"quit",{configurable:!0,get:function(){Ne("Module.quit has been replaced with plain quit_ (the initial value can be provided on Module, but after startup the value is only looked for on a local variable of that name)")}}),N(void 0===r.memoryInitializerPrefixURL,"Module.memoryInitializerPrefixURL option was removed, use Module.locateFile instead"),N(void 0===r.pthreadMainPrefixURL,"Module.pthreadMainPrefixURL option was removed, use Module.locateFile instead"),N(void 0===r.cdInitializerPrefixURL,"Module.cdInitializerPrefixURL option was removed, use Module.locateFile instead"),N(void 0===r.filePackagePrefixURL,"Module.filePackagePrefixURL option was removed, use Module.locateFile instead"),N(void 0===r.read,"Module.read option was removed (modify read_ in JS)"),N(void 0===r.readAsync,"Module.readAsync option was removed (modify readAsync in JS)"),N(void 0===r.readBinary,"Module.readBinary option was removed (modify readBinary in JS)"),N(void 0===r.setWindowTitle,"Module.setWindowTitle option was removed (modify setWindowTitle in JS)"),N(void 0===r.TOTAL_MEMORY,"Module.TOTAL_MEMORY has been renamed Module.INITIAL_MEMORY"),Object.getOwnPropertyDescriptor(r,"read")||Object.defineProperty(r,"read",{configurable:!0,get:function(){Ne("Module.read has been replaced with plain read_ (the initial value can be provided on Module, but after startup the value is only looked for on a local variable of that name)")}}),Object.getOwnPropertyDescriptor(r,"readAsync")||Object.defineProperty(r,"readAsync",{configurable:!0,get:function(){Ne("Module.readAsync has been replaced with plain readAsync (the initial value can be provided on Module, but after startup the value is only looked for on a local variable of that name)")}}),Object.getOwnPropertyDescriptor(r,"readBinary")||Object.defineProperty(r,"readBinary",{configurable:!0,get:function(){Ne("Module.readBinary has been replaced with plain readBinary (the initial value can be provided on Module, but after startup the value is only looked for on a local variable of that name)")}}),Object.getOwnPropertyDescriptor(r,"setWindowTitle")||Object.defineProperty(r,"setWindowTitle",{configurable:!0,get:function(){Ne("Module.setWindowTitle has been replaced with plain setWindowTitle (the initial value can be provided on Module, but after startup the value is only looked for on a local variable of that name)")}});var _,S,P,C,T=0,A=function(e){T=e},E=function(){return T};function k(e,t,o,i){if("*"===(o=o||"i8").charAt(o.length-1)&&(o="i32"),i)switch(o){case"i1":case"i8":ie[e>>0]=t;break;case"i16":se[e>>1]=t;break;case"i32":ae[e>>2]=t;break;case"i64":Xe=[t>>>0,(qe=t,+Math.abs(qe)>=1?qe>0?(0|Math.min(+Math.floor(qe/4294967296),4294967295))>>>0:~~+Math.ceil((qe-+(~~qe>>>0))/4294967296)>>>0:0)],ae[e>>2]=Xe[0],ae[e+4>>2]=Xe[1];break;case"float":ce[e>>2]=t;break;case"double":de[e>>3]=t;break;default:Ne("invalid type for setValue: "+o)}else switch(o){case"i1":case"i8":O(0|e,0|t,1);break;case"i16":O(0|e,0|t,2);break;case"i32":O(0|e,0|t,4);break;case"i64":O(0|e,0|(Xe=[t>>>0,(qe=t,+Math.abs(qe)>=1?qe>0?(0|Math.min(+Math.floor(qe/4294967296),4294967295))>>>0:~~+Math.ceil((qe-+(~~qe>>>0))/4294967296)>>>0:0)])[0],4),O(e+4|0,0|Xe[1],4);break;case"float":M(0|e,Math.fround(t),4);break;case"double":M(0|e,+t,8);break;default:Ne("invalid type for setValue: "+o)}}function I(e,t,o){if("*"===(t=t||"i8").charAt(t.length-1)&&(t="i32"),o)switch(t){case"i1":case"i8":return ie[e>>0];case"i16":return se[e>>1];case"i32":case"i64":return ae[e>>2];case"float":return ce[e>>2];case"double":return de[e>>3];default:Ne("invalid type for getValue: "+t)}else switch(t){case"i1":case"i8":return 0|B(0|e,1,0);case"i16":return 0|B(0|e,2,0);case"i32":return 0|B(0|e,4,0);case"i64":return 0|B(0|e,8,0);case"float":return Math.fround(D(0|e,4,0));case"double":return+D(0|e,8,0);default:Ne("invalid type for getValue: "+t)}return null}function R(e,t){switch(e){case 1:return"i8";case 2:return"i16";case 4:return t?"float":"i32";case 8:return"double";default:N(0)}}function O(e,t,o,i){var r=_a()>>>0;e<=0&&Ne("segmentation fault storing "+o+" bytes to address "+e),e%o!=0&&Ne("alignment error storing to address "+e+", which was expected to be aligned to a multiple of "+o),e+o>r&&Ne("segmentation fault, exceeded the top of the available dynamic heap when storing "+o+" bytes to address "+e+". DYNAMICTOP="+r),N(r>=me),N(r<=ie.length),k(e,t,R(o,i),1)}function M(e,t,o){O(e,t,o,!0)}function B(e,t,o,i){var r=_a()>>>0;e<=0&&Ne("segmentation fault loading "+t+" bytes from address "+e),e%t!=0&&Ne("alignment error loading from address "+e+", which was expected to be aligned to a multiple of "+t),e+t>r&&Ne("segmentation fault, exceeded the top of the available dynamic heap when loading "+t+" bytes from address "+e+". DYNAMICTOP="+r),N(r>=me),N(r<=ie.length);var s=R(t,i),n=I(e,s,1);return o&&(n=nt(n,parseInt(s.substr(1),10))),n}function D(e,t,o){return B(e,t,o,!0)}function F(){Ne("segmentation fault")}function L(){Ne("alignment fault")}r.wasmBinary&&(_=r.wasmBinary),Object.getOwnPropertyDescriptor(r,"wasmBinary")||Object.defineProperty(r,"wasmBinary",{configurable:!0,get:function(){Ne("Module.wasmBinary has been replaced with plain wasmBinary (the initial value can be provided on Module, but after startup the value is only looked for on a local variable of that name)")}}),r.noExitRuntime&&(S=r.noExitRuntime),Object.getOwnPropertyDescriptor(r,"noExitRuntime")||Object.defineProperty(r,"noExitRuntime",{configurable:!0,get:function(){Ne("Module.noExitRuntime has been replaced with plain noExitRuntime (the initial value can be provided on Module, but after startup the value is only looked for on a local variable of that name)")}}),"object"!=typeof WebAssembly&&Ne("no native wasm support detected");var z=!1;function N(e,t){e||Ne("Assertion failed: "+t)}var $="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function U(e,t,o){for(var i=t+o,r=t;e[r]&&!(r>=i);)++r;if(r-t>16&&e.subarray&&$)return $.decode(e.subarray(t,r));for(var s="";t<r;){var n=e[t++];if(128&n){var a=63&e[t++];if(192!=(224&n)){var l=63&e[t++];if(224==(240&n)?n=(15&n)<<12|a<<6|l:(240!=(248&n)&&w("Invalid UTF-8 leading byte 0x"+n.toString(16)+" encountered when deserializing a UTF-8 string on the asm.js/wasm heap to a JS string!"),n=(7&n)<<18|a<<12|l<<6|63&e[t++]),n<65536)s+=String.fromCharCode(n);else{var c=n-65536;s+=String.fromCharCode(55296|c>>10,56320|1023&c)}}else s+=String.fromCharCode((31&n)<<6|a)}else s+=String.fromCharCode(n)}return s}function G(e,t){return e?U(re,e,t):""}function W(e,t,o,i){if(!(i>0))return 0;for(var r=o,s=o+i-1,n=0;n<e.length;++n){var a=e.charCodeAt(n);if(a>=55296&&a<=57343)a=65536+((1023&a)<<10)|1023&e.charCodeAt(++n);if(a<=127){if(o>=s)break;t[o++]=a}else if(a<=2047){if(o+1>=s)break;t[o++]=192|a>>6,t[o++]=128|63&a}else if(a<=65535){if(o+2>=s)break;t[o++]=224|a>>12,t[o++]=128|a>>6&63,t[o++]=128|63&a}else{if(o+3>=s)break;a>=2097152&&w("Invalid Unicode code point 0x"+a.toString(16)+" encountered when serializing a JS string to an UTF-8 string on the asm.js/wasm heap! (Valid unicode code points should be in range 0-0x1FFFFF)."),t[o++]=240|a>>18,t[o++]=128|a>>12&63,t[o++]=128|a>>6&63,t[o++]=128|63&a}}return t[o]=0,o-r}function V(e,t,o){return N("number"==typeof o,"stringToUTF8(str, outPtr, maxBytesToWrite) is missing the third parameter that specifies the length of the output buffer!"),W(e,re,t,o)}function H(e){for(var t=0,o=0;o<e.length;++o){var i=e.charCodeAt(o);i>=55296&&i<=57343&&(i=65536+((1023&i)<<10)|1023&e.charCodeAt(++o)),i<=127?++t:t+=i<=2047?2:i<=65535?3:4}return t}var j="undefined"!=typeof TextDecoder?new TextDecoder("utf-16le"):void 0;function q(e,t){N(e%2==0,"Pointer passed to UTF16ToString must be aligned to two bytes!");for(var o=e,i=o>>1,r=i+t/2;!(i>=r)&&ne[i];)++i;if((o=i<<1)-e>32&&j)return j.decode(re.subarray(e,o));for(var s=0,n="";;){var a=0|B(e+2*s|0,2,0);if(0==a||s==t/2)return n;++s,n+=String.fromCharCode(a)}}function X(e,t,o){if(N(t%2==0,"Pointer passed to stringToUTF16 must be aligned to two bytes!"),N("number"==typeof o,"stringToUTF16(str, outPtr, maxBytesToWrite) is missing the third parameter that specifies the length of the output buffer!"),void 0===o&&(o=2147483647),o<2)return 0;for(var i=t,r=(o-=2)<2*e.length?o/2:e.length,s=0;s<r;++s){O(0|t,0|e.charCodeAt(s),2),t+=2}return O(0|t,0,2),t-i}function Y(e){return 2*e.length}function Z(e,t){N(e%4==0,"Pointer passed to UTF32ToString must be aligned to four bytes!");for(var o=0,i="";!(o>=t/4);){var r=0|B(e+4*o|0,4,0);if(0==r)break;if(++o,r>=65536){var s=r-65536;i+=String.fromCharCode(55296|s>>10,56320|1023&s)}else i+=String.fromCharCode(r)}return i}function Q(e,t,o){if(N(t%4==0,"Pointer passed to stringToUTF32 must be aligned to four bytes!"),N("number"==typeof o,"stringToUTF32(str, outPtr, maxBytesToWrite) is missing the third parameter that specifies the length of the output buffer!"),void 0===o&&(o=2147483647),o<4)return 0;for(var i=t,r=i+o-4,s=0;s<e.length;++s){var n=e.charCodeAt(s);if(n>=55296&&n<=57343)n=65536+((1023&n)<<10)|1023&e.charCodeAt(++s);if(O(0|t,0|n,4),(t+=4)+4>r)break}return O(0|t,0,4),t-i}function J(e){for(var t=0,o=0;o<e.length;++o){var i=e.charCodeAt(o);i>=55296&&i<=57343&&++o,t+=4}return t}function K(e){var t=H(e)+1,o=pa(t);return o&&W(e,ie,o,t),o}function ee(e,t){N(e.length>=0,"writeArrayToMemory array must have a length (should be an array or typed array)"),ie.set(e,t)}function te(e,t,o){for(var i=0;i<e.length;++i)N(e.charCodeAt(i)==e.charCodeAt(i)&255),O(0|t++,0|e.charCodeAt(i),1);o||O(0|t,0,1)}var oe,ie,re,se,ne,ae,le,ce,de,he=65536;function pe(e,t){return e%t>0&&(e+=t-e%t),e}function ue(e){oe=e,r.HEAP8=ie=new Int8Array(e),r.HEAP16=se=new Int16Array(e),r.HEAP32=ae=new Int32Array(e),r.HEAPU8=re=new Uint8Array(e),r.HEAPU16=ne=new Uint16Array(e),r.HEAPU32=le=new Uint32Array(e),r.HEAPF32=ce=new Float32Array(e),r.HEAPF64=de=new Float64Array(e)}var me=5941280,fe=698400;N(me%16==0,"stack must start aligned");var ge=5242880;r.TOTAL_STACK&&N(ge===r.TOTAL_STACK,"the stack size can no longer be determined at runtime");var ye=r.INITIAL_MEMORY||134217728;function be(){N(0==(3&fe)),le[1+(fe>>2)]=34821223,le[2+(fe>>2)]=2310721022,ae[0]=1668509029}function ve(){var e=le[1+(fe>>2)],t=le[2+(fe>>2)];34821223==e&&2310721022==t||Ne("Stack overflow! Stack cookie has been overwritten, expected hex dwords 0x89BACDFE and 0x2135467, but received 0x"+t.toString(16)+" "+e.toString(16)),1668509029!==ae[0]&&Ne("Runtime error: The application has corrupted its heap memory area (address zero)!")}Object.getOwnPropertyDescriptor(r,"INITIAL_MEMORY")||Object.defineProperty(r,"INITIAL_MEMORY",{configurable:!0,get:function(){Ne("Module.INITIAL_MEMORY has been replaced with plain INITIAL_INITIAL_MEMORY (the initial value can be provided on Module, but after startup the value is only looked for on a local variable of that name)")}}),N(ye>=ge,"INITIAL_MEMORY should be larger than TOTAL_STACK, was "+ye+"! (TOTAL_STACK="+ge+")"),N("undefined"!=typeof Int32Array&&"undefined"!=typeof Float64Array&&void 0!==Int32Array.prototype.subarray&&void 0!==Int32Array.prototype.set,"JS engine does not provide full typed array support"),(P=r.wasmMemory?r.wasmMemory:new WebAssembly.Memory({initial:ye/he,maximum:2147483648/he}))&&(oe=P.buffer),N((ye=oe.byteLength)%he==0),N(65536%he==0),ue(oe),function(){var e=new Int16Array(1),t=new Int8Array(e.buffer);if(e[0]=25459,115!==t[0]||99!==t[1])throw"Runtime error: expected the system to be little-endian!"}();var xe=[],we=[],_e=[],Se=[],Pe=!1,Ce=!1;function Te(){if(r.preRun)for("function"==typeof r.preRun&&(r.preRun=[r.preRun]);r.preRun.length;)Re(r.preRun.shift());Ke(xe)}function Ae(){ve(),N(!Pe),Pe=!0,Ke(we)}function Ee(){ve(),Ke(_e)}function ke(){ve(),Ce=!0}function Ie(){if(ve(),r.postRun)for("function"==typeof r.postRun&&(r.postRun=[r.postRun]);r.postRun.length;)Oe(r.postRun.shift());Ke(Se)}function Re(e){xe.unshift(e)}function Oe(e){Se.unshift(e)}N(Math.imul,"This browser does not support Math.imul(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),N(Math.fround,"This browser does not support Math.fround(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),N(Math.clz32,"This browser does not support Math.clz32(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),N(Math.trunc,"This browser does not support Math.trunc(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill");var Me=0,Be=null,De=null,Fe={};function Le(e){Me++,r.monitorRunDependencies&&r.monitorRunDependencies(Me),e?(N(!Fe[e]),Fe[e]=1,null===Be&&"undefined"!=typeof setInterval&&(Be=setInterval((function(){if(z)return clearInterval(Be),void(Be=null);var e=!1;for(var t in Fe)e||(e=!0,x("still waiting on run dependencies:")),x("dependency: "+t);e&&x("(end of list)")}),1e4))):x("warning: run dependency added without ID")}function ze(e){if(Me--,r.monitorRunDependencies&&r.monitorRunDependencies(Me),e?(N(Fe[e]),delete Fe[e]):x("warning: run dependency removed without ID"),0==Me&&(null!==Be&&(clearInterval(Be),Be=null),De)){var t=De;De=null,t()}}function Ne(e){r.onAbort&&r.onAbort(e),x(e+=""),z=!0,e="abort("+e+") at "+st();var t=new WebAssembly.RuntimeError(e);throw i(t),t}r.preloadedImages={},r.preloadedAudios={};var $e={error:function(){Ne("Filesystem support (FS) was not included. The problem is that you are using files from JS, but files were not used from C/C++, so filesystem support was not auto-included. You can force-include filesystem support with  -s FORCE_FILESYSTEM=1")},init:function(){$e.error()},createDataFile:function(){$e.error()},createPreloadedFile:function(){$e.error()},createLazyFile:function(){$e.error()},open:function(){$e.error()},mkdev:function(){$e.error()},registerDevice:function(){$e.error()},analyzePath:function(){$e.error()},loadFilesFromDB:function(){$e.error()},ErrnoError:function(){$e.error()}};function Ue(e,t){return String.prototype.startsWith?e.startsWith(t):0===e.indexOf(t)}r.FS_createDataFile=$e.createDataFile,r.FS_createPreloadedFile=$e.createPreloadedFile;var Ge="data:application/octet-stream;base64,";function We(e){return Ue(e,Ge)}var Ve="file://";function He(e){return Ue(e,Ve)}function je(e,t){return function(){var o=e,i=t;return t||(i=r.asm),N(Pe,"native function `"+o+"` called before runtime initialization"),N(!Ce,"native function `"+o+"` called after runtime exit (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),i[e]||N(i[e],"exported native function `"+o+"` not found"),i[e].apply(null,arguments)}}var qe,Xe,Ye="printess.wasm";function Ze(){try{if(_)return new Uint8Array(_);if(m)return m(Ye);throw"both async and sync fetching of the wasm failed"}catch(e){Ne(e)}}function Qe(){return _||!c&&!d||"function"!=typeof fetch||He(Ye)?Promise.resolve().then(Ze):fetch(Ye,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+Ye+"'";return e.arrayBuffer()})).catch((function(){return Ze()}))}function Je(){var e={env:da,wasi_snapshot_preview1:da};function t(e,t){var o=e.exports;r.asm=o,N(C=r.asm.__indirect_function_table,"table not found in wasm exports"),ze("wasm-instantiate")}Le("wasm-instantiate");var o=r;function i(e){N(r===o,"the Module object should not be replaced during async compilation - perhaps the order of HTML elements is wrong?"),o=null,t(e.instance)}function s(t){return Qe().then((function(t){return WebAssembly.instantiate(t,e)})).then(t,(function(e){x("failed to asynchronously prepare wasm: "+e),Ne(e)}))}if(r.instantiateWasm)try{return r.instantiateWasm(e,t)}catch(e){return x("Module.instantiateWasm callback failed with error: "+e),!1}return function(){if(_||"function"!=typeof WebAssembly.instantiateStreaming||We(Ye)||He(Ye)||"function"!=typeof fetch)return s(i);fetch(Ye,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(i,(function(e){return x("wasm streaming compile failed: "+e),x("falling back to ArrayBuffer instantiation"),s(i)}))}))}(),{}}function Ke(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var o=t.func;"number"==typeof o?void 0===t.arg?C.get(o)():C.get(o)(t.arg):o(void 0===t.arg?null:t.arg)}else t(r)}}function et(e){return w("warning: build with  -s DEMANGLE_SUPPORT=1  to link in libcxxabi demangling"),e}function tt(e){return e.replace(/\b_Z[\w\d_]+/g,(function(e){var t=et(e);return e===t?e:t+" ["+e+"]"}))}function ot(e,t,o){return N("dynCall_"+e in r,"bad function pointer type - no table for sig '"+e+"'"),o&&o.length?N(o.length===e.substring(1).replace(/j/g,"--").length):N(1==e.length),o&&o.length?r["dynCall_"+e].apply(null,[t].concat(o)):r["dynCall_"+e].call(null,t)}function it(e,t,o){return-1!=e.indexOf("j")?ot(e,t,o):C.get(t).apply(null,o)}function rt(){var e=new Error;if(!e.stack){try{throw new Error}catch(t){e=t}if(!e.stack)return"(no stack trace available)"}return e.stack.toString()}function st(){var e=rt();return r.extraStackTrace&&(e+="\n"+r.extraStackTrace()),tt(e)}function nt(e,t){return e>=0?e:t<=32?2*Math.abs(1<<t-1)+e:Math.pow(2,t)+e}function at(e,t,o,i){Ne("Assertion failed: "+G(e)+", at: "+[t?G(t):"unknown filename",o,i?G(i):"unknown function"])}We(Ye)||(Ye=b(Ye));var lt={DESTRUCTOR_OFFSET:0,REFCOUNT_OFFSET:4,TYPE_OFFSET:8,CAUGHT_OFFSET:12,RETHROWN_OFFSET:13,SIZE:16};function ct(e){return pa(e+lt.SIZE)+lt.SIZE}function dt(e,t){}function ht(e,t){}function pt(e){this.excPtr=e,this.ptr=e-lt.SIZE,this.set_type=function(e){O(this.ptr+lt.TYPE_OFFSET|0,0|e,4)},this.get_type=function(){return 0|B(this.ptr+lt.TYPE_OFFSET|0,4,0)},this.set_destructor=function(e){O(this.ptr+lt.DESTRUCTOR_OFFSET|0,0|e,4)},this.get_destructor=function(){return 0|B(this.ptr+lt.DESTRUCTOR_OFFSET|0,4,0)},this.set_refcount=function(e){O(this.ptr+lt.REFCOUNT_OFFSET|0,0|e,4)},this.set_caught=function(e){e=e?1:0,O(this.ptr+lt.CAUGHT_OFFSET|0,0|e,1)},this.get_caught=function(){return 0!=(0|B(this.ptr+lt.CAUGHT_OFFSET|0,1,0))},this.set_rethrown=function(e){e=e?1:0,O(this.ptr+lt.RETHROWN_OFFSET|0,0|e,1)},this.get_rethrown=function(){return 0!=(0|B(this.ptr+lt.RETHROWN_OFFSET|0,1,0))},this.init=function(e,t){this.set_type(e),this.set_destructor(t),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var e=0|B(this.ptr+lt.REFCOUNT_OFFSET|0,4,0);O(this.ptr+lt.REFCOUNT_OFFSET|0,e+1|0,4)},this.release_ref=function(){var e=0|B(this.ptr+lt.REFCOUNT_OFFSET|0,4,0);return O(this.ptr+lt.REFCOUNT_OFFSET|0,e-1|0,4),N(e>0),1===e}}function ut(e,t,o){throw new pt(e).init(t,o),e+" - Exception catching is disabled, this exception cannot be caught. Compile with -s DISABLE_EXCEPTION_CATCHING=0 or DISABLE_EXCEPTION_CATCHING=2 to catch."}var mt={};function ft(e){for(;e.length;){var t=e.pop();e.pop()(t)}}function gt(e){return this.fromWireType(le[e>>2])}var yt={},bt={},vt={},xt=48,wt=57;function _t(e){if(void 0===e)return"_unknown";var t=(e=e.replace(/[^a-zA-Z0-9_]/g,"$")).charCodeAt(0);return t>=xt&&t<=wt?"_"+e:e}function St(e,t){return e=_t(e),new Function("body","return function "+e+'() {\n    "use strict";    return body.apply(this, arguments);\n};\n')(t)}function Pt(e,t){var o=St(t,(function(e){this.name=t,this.message=e;var o=new Error(e).stack;void 0!==o&&(this.stack=this.toString()+"\n"+o.replace(/^Error(:[^\n]*)?\n/,""))}));return o.prototype=Object.create(e.prototype),o.prototype.constructor=o,o.prototype.toString=function(){return void 0===this.message?this.name:this.name+": "+this.message},o}var Ct=void 0;function Tt(e){throw new Ct(e)}function At(e,t,o){function i(t){var i=o(t);i.length!==e.length&&Tt("Mismatched type converter count");for(var r=0;r<e.length;++r)Dt(e[r],i[r])}e.forEach((function(e){vt[e]=t}));var r=new Array(t.length),s=[],n=0;t.forEach((function(e,t){bt.hasOwnProperty(e)?r[t]=bt[e]:(s.push(e),yt.hasOwnProperty(e)||(yt[e]=[]),yt[e].push((function(){r[t]=bt[e],++n===s.length&&i(r)})))})),0===s.length&&i(r)}function Et(e){var t=mt[e];delete mt[e];var o=t.rawConstructor,i=t.rawDestructor,r=t.fields;At([e],r.map((function(e){return e.getterReturnType})).concat(r.map((function(e){return e.setterArgumentType}))),(function(e){var s={};return r.forEach((function(t,o){var i=t.fieldName,n=e[o],a=t.getter,l=t.getterContext,c=e[o+r.length],d=t.setter,h=t.setterContext;s[i]={read:function(e){return n.fromWireType(a(l,e))},write:function(e,t){var o=[];d(h,e,c.toWireType(o,t)),ft(o)}}})),[{name:t.name,fromWireType:function(e){var t={};for(var o in s)t[o]=s[o].read(e);return i(e),t},toWireType:function(e,t){for(var r in s)if(!(r in t))throw new TypeError('Missing field:  "'+r+'"');var n=o();for(r in s)s[r].write(n,t[r]);return null!==e&&e.push(i,n),n},argPackAdvance:8,readValueFromPointer:gt,destructorFunction:i}]}))}function kt(e){switch(e){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+e)}}function It(){for(var e=new Array(256),t=0;t<256;++t)e[t]=String.fromCharCode(t);Rt=e}var Rt=void 0;function Ot(e){for(var t="",o=e;re[o];)t+=Rt[re[o++]];return t}var Mt=void 0;function Bt(e){throw new Mt(e)}function Dt(e,t,o){if(o=o||{},!("argPackAdvance"in t))throw new TypeError("registerType registeredInstance requires argPackAdvance");var i=t.name;if(e||Bt('type "'+i+'" must have a positive integer typeid pointer'),bt.hasOwnProperty(e)){if(o.ignoreDuplicateRegistrations)return;Bt("Cannot register type '"+i+"' twice")}if(bt[e]=t,delete vt[e],yt.hasOwnProperty(e)){var r=yt[e];delete yt[e],r.forEach((function(e){e()}))}}function Ft(e,t,o,i,r){var s=kt(o);Dt(e,{name:t=Ot(t),fromWireType:function(e){return!!e},toWireType:function(e,t){return t?i:r},argPackAdvance:8,readValueFromPointer:function(e){var i;if(1===o)i=ie;else if(2===o)i=se;else{if(4!==o)throw new TypeError("Unknown boolean type size: "+t);i=ae}return this.fromWireType(i[e>>s])},destructorFunction:null})}function Lt(e){if(!(this instanceof Kt))return!1;if(!(e instanceof Kt))return!1;for(var t=this.$$.ptrType.registeredClass,o=this.$$.ptr,i=e.$$.ptrType.registeredClass,r=e.$$.ptr;t.baseClass;)o=t.upcast(o),t=t.baseClass;for(;i.baseClass;)r=i.upcast(r),i=i.baseClass;return t===i&&o===r}function zt(e){return{count:e.count,deleteScheduled:e.deleteScheduled,preservePointerOnDelete:e.preservePointerOnDelete,ptr:e.ptr,ptrType:e.ptrType,smartPtr:e.smartPtr,smartPtrType:e.smartPtrType}}function Nt(e){Bt(e.$$.ptrType.registeredClass.name+" instance already deleted")}var $t=!1;function Ut(e){}function Gt(e){e.smartPtr?e.smartPtrType.rawDestructor(e.smartPtr):e.ptrType.registeredClass.rawDestructor(e.ptr)}function Wt(e){e.count.value-=1,0===e.count.value&&Gt(e)}function Vt(e){return"undefined"==typeof FinalizationGroup?(Vt=function(e){return e},e):($t=new FinalizationGroup((function(e){for(var t=e.next();!t.done;t=e.next()){var o=t.value;o.ptr?Wt(o):console.warn("object already deleted: "+o.ptr)}})),Ut=function(e){$t.unregister(e.$$)},(Vt=function(e){return $t.register(e,e.$$,e.$$),e})(e))}function Ht(){if(this.$$.ptr||Nt(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var e=Vt(Object.create(Object.getPrototypeOf(this),{$$:{value:zt(this.$$)}}));return e.$$.count.value+=1,e.$$.deleteScheduled=!1,e}function jt(){this.$$.ptr||Nt(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&Bt("Object already scheduled for deletion"),Ut(this),Wt(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function qt(){return!this.$$.ptr}var Xt=void 0,Yt=[];function Zt(){for(;Yt.length;){var e=Yt.pop();e.$$.deleteScheduled=!1,e.delete()}}function Qt(){return this.$$.ptr||Nt(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&Bt("Object already scheduled for deletion"),Yt.push(this),1===Yt.length&&Xt&&Xt(Zt),this.$$.deleteScheduled=!0,this}function Jt(){Kt.prototype.isAliasOf=Lt,Kt.prototype.clone=Ht,Kt.prototype.delete=jt,Kt.prototype.isDeleted=qt,Kt.prototype.deleteLater=Qt}function Kt(){}var eo={};function to(e,t,o){if(void 0===e[t].overloadTable){var i=e[t];e[t]=function(){return e[t].overloadTable.hasOwnProperty(arguments.length)||Bt("Function '"+o+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+e[t].overloadTable+")!"),e[t].overloadTable[arguments.length].apply(this,arguments)},e[t].overloadTable=[],e[t].overloadTable[i.argCount]=i}}function oo(e,t,o){r.hasOwnProperty(e)?((void 0===o||void 0!==r[e].overloadTable&&void 0!==r[e].overloadTable[o])&&Bt("Cannot register public name '"+e+"' twice"),to(r,e,e),r.hasOwnProperty(o)&&Bt("Cannot register multiple overloads of a function with the same number of arguments ("+o+")!"),r[e].overloadTable[o]=t):(r[e]=t,void 0!==o&&(r[e].numArguments=o))}function io(e,t,o,i,r,s,n,a){this.name=e,this.constructor=t,this.instancePrototype=o,this.rawDestructor=i,this.baseClass=r,this.getActualType=s,this.upcast=n,this.downcast=a,this.pureVirtualFunctions=[]}function ro(e,t,o){for(;t!==o;)t.upcast||Bt("Expected null or instance of "+o.name+", got an instance of "+t.name),e=t.upcast(e),t=t.baseClass;return e}function so(e,t){if(null===t)return this.isReference&&Bt("null is not a valid "+this.name),0;t.$$||Bt('Cannot pass "'+Yo(t)+'" as a '+this.name),t.$$.ptr||Bt("Cannot pass deleted object as a pointer of type "+this.name);var o=t.$$.ptrType.registeredClass;return ro(t.$$.ptr,o,this.registeredClass)}function no(e,t){var o;if(null===t)return this.isReference&&Bt("null is not a valid "+this.name),this.isSmartPointer?(o=this.rawConstructor(),null!==e&&e.push(this.rawDestructor,o),o):0;t.$$||Bt('Cannot pass "'+Yo(t)+'" as a '+this.name),t.$$.ptr||Bt("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&t.$$.ptrType.isConst&&Bt("Cannot convert argument of type "+(t.$$.smartPtrType?t.$$.smartPtrType.name:t.$$.ptrType.name)+" to parameter type "+this.name);var i=t.$$.ptrType.registeredClass;if(o=ro(t.$$.ptr,i,this.registeredClass),this.isSmartPointer)switch(void 0===t.$$.smartPtr&&Bt("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:t.$$.smartPtrType===this?o=t.$$.smartPtr:Bt("Cannot convert argument of type "+(t.$$.smartPtrType?t.$$.smartPtrType.name:t.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:o=t.$$.smartPtr;break;case 2:if(t.$$.smartPtrType===this)o=t.$$.smartPtr;else{var r=t.clone();o=this.rawShare(o,Wo((function(){r.delete()}))),null!==e&&e.push(this.rawDestructor,o)}break;default:Bt("Unsupporting sharing policy")}return o}function ao(e,t){if(null===t)return this.isReference&&Bt("null is not a valid "+this.name),0;t.$$||Bt('Cannot pass "'+Yo(t)+'" as a '+this.name),t.$$.ptr||Bt("Cannot pass deleted object as a pointer of type "+this.name),t.$$.ptrType.isConst&&Bt("Cannot convert argument of type "+t.$$.ptrType.name+" to parameter type "+this.name);var o=t.$$.ptrType.registeredClass;return ro(t.$$.ptr,o,this.registeredClass)}function lo(e){return this.rawGetPointee&&(e=this.rawGetPointee(e)),e}function co(e){this.rawDestructor&&this.rawDestructor(e)}function ho(e){null!==e&&e.delete()}function po(e,t,o){if(t===o)return e;if(void 0===o.baseClass)return null;var i=po(e,t,o.baseClass);return null===i?null:o.downcast(i)}function uo(){return Object.keys(yo).length}function mo(){var e=[];for(var t in yo)yo.hasOwnProperty(t)&&e.push(yo[t]);return e}function fo(e){Xt=e,Yt.length&&Xt&&Xt(Zt)}function go(){r.getInheritedInstanceCount=uo,r.getLiveInheritedInstances=mo,r.flushPendingDeletes=Zt,r.setDelayFunction=fo}var yo={};function bo(e,t){for(void 0===t&&Bt("ptr should not be undefined");e.baseClass;)t=e.upcast(t),e=e.baseClass;return t}function vo(e,t){return t=bo(e,t),yo[t]}function xo(e,t){return t.ptrType&&t.ptr||Tt("makeClassHandle requires ptr and ptrType"),!!t.smartPtrType!==!!t.smartPtr&&Tt("Both smartPtrType and smartPtr must be specified"),t.count={value:1},Vt(Object.create(e,{$$:{value:t}}))}function wo(e){var t=this.getPointee(e);if(!t)return this.destructor(e),null;var o=vo(this.registeredClass,t);if(void 0!==o){if(0===o.$$.count.value)return o.$$.ptr=t,o.$$.smartPtr=e,o.clone();var i=o.clone();return this.destructor(e),i}function r(){return this.isSmartPointer?xo(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:t,smartPtrType:this,smartPtr:e}):xo(this.registeredClass.instancePrototype,{ptrType:this,ptr:e})}var s,n=this.registeredClass.getActualType(t),a=eo[n];if(!a)return r.call(this);s=this.isConst?a.constPointerType:a.pointerType;var l=po(t,this.registeredClass,s.registeredClass);return null===l?r.call(this):this.isSmartPointer?xo(s.registeredClass.instancePrototype,{ptrType:s,ptr:l,smartPtrType:this,smartPtr:e}):xo(s.registeredClass.instancePrototype,{ptrType:s,ptr:l})}function _o(){So.prototype.getPointee=lo,So.prototype.destructor=co,So.prototype.argPackAdvance=8,So.prototype.readValueFromPointer=gt,So.prototype.deleteObject=ho,So.prototype.fromWireType=wo}function So(e,t,o,i,r,s,n,a,l,c,d){this.name=e,this.registeredClass=t,this.isReference=o,this.isConst=i,this.isSmartPointer=r,this.pointeeType=s,this.sharingPolicy=n,this.rawGetPointee=a,this.rawConstructor=l,this.rawShare=c,this.rawDestructor=d,r||void 0!==t.baseClass?this.toWireType=no:i?(this.toWireType=so,this.destructorFunction=null):(this.toWireType=ao,this.destructorFunction=null)}function Po(e,t,o){r.hasOwnProperty(e)||Tt("Replacing nonexistant public symbol"),void 0!==r[e].overloadTable&&void 0!==o?r[e].overloadTable[o]=t:(r[e]=t,r[e].argCount=o)}function Co(e,t){N(e.indexOf("j")>=0,"getDynCaller should only be called with i64 sigs");var o=[];return function(){o.length=arguments.length;for(var i=0;i<arguments.length;i++)o[i]=arguments[i];return it(e,t,o)}}function To(e,t){var o=-1!=(e=Ot(e)).indexOf("j")?Co(e,t):C.get(t);return"function"!=typeof o&&Bt("unknown function pointer with signature "+e+": "+t),o}var Ao=void 0;function Eo(e){var t=fa(e),o=Ot(t);return ua(t),o}function ko(e,t){var o=[],i={};throw t.forEach((function e(t){i[t]||bt[t]||(vt[t]?vt[t].forEach(e):(o.push(t),i[t]=!0))})),new Ao(e+": "+o.map(Eo).join([", "]))}function Io(e,t,o,i,r,s,n,a,l,c,d,h,p){d=Ot(d),s=To(r,s),a&&(a=To(n,a)),c&&(c=To(l,c)),p=To(h,p);var u=_t(d);oo(u,(function(){ko("Cannot construct "+d+" due to unbound types",[i])})),At([e,t,o],i?[i]:[],(function(t){var o,r;t=t[0],r=i?(o=t.registeredClass).instancePrototype:Kt.prototype;var n=St(u,(function(){if(Object.getPrototypeOf(this)!==l)throw new Mt("Use 'new' to construct "+d);if(void 0===h.constructor_body)throw new Mt(d+" has no accessible constructor");var e=h.constructor_body[arguments.length];if(void 0===e)throw new Mt("Tried to invoke ctor of "+d+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(h.constructor_body).toString()+") parameters instead!");return e.apply(this,arguments)})),l=Object.create(r,{constructor:{value:n}});n.prototype=l;var h=new io(d,n,l,p,o,s,a,c),m=new So(d,h,!0,!1,!1),f=new So(d+"*",h,!1,!1,!1),g=new So(d+" const*",h,!1,!0,!1);return eo[e]={pointerType:f,constPointerType:g},Po(u,n),[m,f,g]}))}function Ro(e,t){for(var o=[],i=0;i<e;i++)o.push(ae[(t>>2)+i]);return o}function Oo(e,t,o,i,r,s){N(t>0);var n=Ro(t,o);r=To(i,r);var a=[s],l=[];At([],[e],(function(e){var o="constructor "+(e=e[0]).name;if(void 0===e.registeredClass.constructor_body&&(e.registeredClass.constructor_body=[]),void 0!==e.registeredClass.constructor_body[t-1])throw new Mt("Cannot register multiple constructors with identical number of parameters ("+(t-1)+") for class '"+e.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return e.registeredClass.constructor_body[t-1]=function(){ko("Cannot construct "+e.name+" due to unbound types",n)},At([],n,(function(i){return e.registeredClass.constructor_body[t-1]=function(){arguments.length!==t-1&&Bt(o+" called with "+arguments.length+" arguments, expected "+(t-1)),l.length=0,a.length=t;for(var e=1;e<t;++e)a[e]=i[e].toWireType(l,arguments[e-1]);var s=r.apply(null,a);return ft(l),i[0].fromWireType(s)},[]})),[]}))}function Mo(e,t){if(!(e instanceof Function))throw new TypeError("new_ called with constructor type "+typeof e+" which is not a function");var o=St(e.name||"unknownFunctionName",(function(){}));o.prototype=e.prototype;var i=new o,r=e.apply(i,t);return r instanceof Object?r:i}function Bo(e,t,o,i,r){var s=t.length;s<2&&Bt("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var n=null!==t[1]&&null!==o,a=!1,l=1;l<t.length;++l)if(null!==t[l]&&void 0===t[l].destructorFunction){a=!0;break}var c="void"!==t[0].name,d="",h="";for(l=0;l<s-2;++l)d+=(0!==l?", ":"")+"arg"+l,h+=(0!==l?", ":"")+"arg"+l+"Wired";var p="return function "+_t(e)+"("+d+") {\nif (arguments.length !== "+(s-2)+") {\nthrowBindingError('function "+e+" called with ' + arguments.length + ' arguments, expected "+(s-2)+" args!');\n}\n";a&&(p+="var destructors = [];\n");var u=a?"destructors":"null",m=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],f=[Bt,i,r,ft,t[0],t[1]];n&&(p+="var thisWired = classParam.toWireType("+u+", this);\n");for(l=0;l<s-2;++l)p+="var arg"+l+"Wired = argType"+l+".toWireType("+u+", arg"+l+"); // "+t[l+2].name+"\n",m.push("argType"+l),f.push(t[l+2]);if(n&&(h="thisWired"+(h.length>0?", ":"")+h),p+=(c?"var rv = ":"")+"invoker(fn"+(h.length>0?", ":"")+h+");\n",a)p+="runDestructors(destructors);\n";else for(l=n?1:2;l<t.length;++l){var g=1===l?"thisWired":"arg"+(l-2)+"Wired";null!==t[l].destructorFunction&&(p+=g+"_dtor("+g+"); // "+t[l].name+"\n",m.push(g+"_dtor"),f.push(t[l].destructorFunction))}return c&&(p+="var ret = retType.fromWireType(rv);\nreturn ret;\n"),p+="}\n",m.push(p),Mo(Function,m).apply(null,f)}function Do(e,t,o,i,r,s,n,a){var l=Ro(o,i);t=Ot(t),s=To(r,s),At([],[e],(function(e){var i=(e=e[0]).name+"."+t;function r(){ko("Cannot call "+i+" due to unbound types",l)}a&&e.registeredClass.pureVirtualFunctions.push(t);var c=e.registeredClass.instancePrototype,d=c[t];return void 0===d||void 0===d.overloadTable&&d.className!==e.name&&d.argCount===o-2?(r.argCount=o-2,r.className=e.name,c[t]=r):(to(c,t,i),c[t].overloadTable[o-2]=r),At([],l,(function(r){var a=Bo(i,r,e,s,n);return void 0===c[t].overloadTable?(a.argCount=o-2,c[t]=a):c[t].overloadTable[o-2]=a,[]})),[]}))}var Fo,Lo=[],zo=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function No(e){e>4&&0==--zo[e].refcount&&(zo[e]=void 0,Lo.push(e))}function $o(){for(var e=0,t=5;t<zo.length;++t)void 0!==zo[t]&&++e;return e}function Uo(){for(var e=5;e<zo.length;++e)if(void 0!==zo[e])return zo[e];return null}function Go(){r.count_emval_handles=$o,r.get_first_emval=Uo}function Wo(e){switch(e){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:var t=Lo.length?Lo.pop():zo.length;return zo[t]={refcount:1,value:e},t}}function Vo(e,t){Dt(e,{name:t=Ot(t),fromWireType:function(e){var t=zo[e].value;return No(e),t},toWireType:function(e,t){return Wo(t)},argPackAdvance:8,readValueFromPointer:gt,destructorFunction:null})}function Ho(e,t,o){switch(t){case 0:return function(e){var t=o?ie:re;return this.fromWireType(t[e])};case 1:return function(e){var t=o?se:ne;return this.fromWireType(t[e>>1])};case 2:return function(e){var t=o?ae:le;return this.fromWireType(t[e>>2])};default:throw new TypeError("Unknown integer type: "+e)}}function jo(e,t,o,i){var r=kt(o);function s(){}t=Ot(t),s.values={},Dt(e,{name:t,constructor:s,fromWireType:function(e){return this.constructor.values[e]},toWireType:function(e,t){return t.value},argPackAdvance:8,readValueFromPointer:Ho(t,r,i),destructorFunction:null}),oo(t,s)}function qo(e,t){var o=bt[e];return void 0===o&&Bt(t+" has unknown type "+Eo(e)),o}function Xo(e,t,o){var i=qo(e,"enum");t=Ot(t);var r=i.constructor,s=Object.create(i.constructor.prototype,{value:{value:o},constructor:{value:St(i.name+"_"+t,(function(){}))}});r.values[o]=s,r[t]=s}function Yo(e){if(null===e)return"null";var t=typeof e;return"object"===t||"array"===t||"function"===t?e.toString():""+e}function Zo(e,t){switch(t){case 2:return function(e){return this.fromWireType(ce[e>>2])};case 3:return function(e){return this.fromWireType(de[e>>3])};default:throw new TypeError("Unknown float type: "+e)}}function Qo(e,t,o){var i=kt(o);Dt(e,{name:t=Ot(t),fromWireType:function(e){return e},toWireType:function(e,t){if("number"!=typeof t&&"boolean"!=typeof t)throw new TypeError('Cannot convert "'+Yo(t)+'" to '+this.name);return t},argPackAdvance:8,readValueFromPointer:Zo(t,i),destructorFunction:null})}function Jo(e,t,o,i,r,s){var n=Ro(t,o);e=Ot(e),r=To(i,r),oo(e,(function(){ko("Cannot call "+e+" due to unbound types",n)}),t-1),At([],n,(function(o){var i=[o[0],null].concat(o.slice(1));return Po(e,Bo(e,i,null,r,s),t-1),[]}))}function Ko(e,t,o){switch(t){case 0:return o?function(e){return ie[e]}:function(e){return re[e]};case 1:return o?function(e){return se[e>>1]}:function(e){return ne[e>>1]};case 2:return o?function(e){return ae[e>>2]}:function(e){return le[e>>2]};default:throw new TypeError("Unknown integer type: "+e)}}function ei(e,t,o,i,r){t=Ot(t),-1===r&&(r=4294967295);var s=kt(o),n=function(e){return e};if(0===i){var a=32-8*o;n=function(e){return e<<a>>>a}}var l=-1!=t.indexOf("unsigned");Dt(e,{name:t,fromWireType:n,toWireType:function(e,o){if("number"!=typeof o&&"boolean"!=typeof o)throw new TypeError('Cannot convert "'+Yo(o)+'" to '+this.name);if(o<i||o>r)throw new TypeError('Passing a number "'+Yo(o)+'" from JS side to C/C++ side to an argument of type "'+t+'", which is outside the valid range ['+i+", "+r+"]!");return l?o>>>0:0|o},argPackAdvance:8,readValueFromPointer:Ko(t,s,0!==i),destructorFunction:null})}function ti(e,t,o){var i=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][t];function r(e){var t=le,o=t[e>>=2],r=t[e+1];return new i(oe,r,o)}Dt(e,{name:o=Ot(o),fromWireType:r,argPackAdvance:8,readValueFromPointer:r},{ignoreDuplicateRegistrations:!0})}function oi(e,t,o,i,r,s,n,a,l,c,d,h){o=Ot(o),s=To(r,s),a=To(n,a),c=To(l,c),h=To(d,h),At([e],[t],(function(e){return e=e[0],[new So(o,e.registeredClass,!1,!1,!0,e,i,s,a,c,h)]}))}function ii(e,t){var o="std::string"===(t=Ot(t));Dt(e,{name:t,fromWireType:function(e){var t,i=le[e>>2];if(o)for(var r=e+4,s=0;s<=i;++s){var n=e+4+s;if(s==i||0==re[n]){var a=G(r,n-r);void 0===t?t=a:(t+=String.fromCharCode(0),t+=a),r=n+1}}else{var l=new Array(i);for(s=0;s<i;++s)l[s]=String.fromCharCode(re[e+4+s]);t=l.join("")}return ua(e),t},toWireType:function(e,t){t instanceof ArrayBuffer&&(t=new Uint8Array(t));var i="string"==typeof t;i||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int8Array||Bt("Cannot pass non-string to std::string");var r=(o&&i?function(){return H(t)}:function(){return t.length})(),s=pa(4+r+1);if(le[s>>2]=r,o&&i)V(t,s+4,r+1);else if(i)for(var n=0;n<r;++n){var a=t.charCodeAt(n);a>255&&(ua(s),Bt("String has UTF-16 code units that do not fit in 8 bits")),re[s+4+n]=a}else for(n=0;n<r;++n)re[s+4+n]=t[n];return null!==e&&e.push(ua,s),s},argPackAdvance:8,readValueFromPointer:gt,destructorFunction:function(e){ua(e)}})}function ri(e,t,o){var i,r,s,n,a;o=Ot(o),2===t?(i=q,r=X,n=Y,s=function(){return ne},a=1):4===t&&(i=Z,r=Q,n=J,s=function(){return le},a=2),Dt(e,{name:o,fromWireType:function(e){for(var o,r=le[e>>2],n=s(),l=e+4,c=0;c<=r;++c){var d=e+4+c*t;if(c==r||0==n[d>>a]){var h=i(l,d-l);void 0===o?o=h:(o+=String.fromCharCode(0),o+=h),l=d+t}}return ua(e),o},toWireType:function(e,i){"string"!=typeof i&&Bt("Cannot pass non-string to C++ string type "+o);var s=n(i),l=pa(4+s+t);return le[l>>2]=s>>a,r(i,l+4,s+t),null!==e&&e.push(ua,l),l},argPackAdvance:8,readValueFromPointer:gt,destructorFunction:function(e){ua(e)}})}function si(e,t,o,i,r,s){mt[e]={name:Ot(t),rawConstructor:To(o,i),rawDestructor:To(r,s),fields:[]}}function ni(e,t,o,i,r,s,n,a,l,c){mt[e].fields.push({fieldName:Ot(t),getterReturnType:o,getter:To(i,r),getterContext:s,setterArgumentType:n,setter:To(a,l),setterContext:c})}function ai(e,t){Dt(e,{isVoid:!0,name:t=Ot(t),argPackAdvance:0,fromWireType:function(){},toWireType:function(e,t){}})}function li(e){e>4&&(zo[e].refcount+=1)}function ci(e,t){return Wo((e=qo(e,"_emval_take_value")).readValueFromPointer(t))}function di(){Ne()}Fo=h?function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!=typeof dateNow?dateNow:function(){return performance.now()};var hi=!0;function pi(e){return O(0|ma(),0|e,4),e}function ui(e,t){var o;if(0===e)o=Date.now();else{if(1!==e&&4!==e||!hi)return pi(28),-1;o=Fo()}return O(0|t,0|o/1e3,4),O(t+4|0,0|o%1e3*1e3*1e3,4),0}function mi(e){var t=e.getExtension("ANGLE_instanced_arrays");if(t)return e.vertexAttribDivisor=function(e,o){t.vertexAttribDivisorANGLE(e,o)},e.drawArraysInstanced=function(e,o,i,r){t.drawArraysInstancedANGLE(e,o,i,r)},e.drawElementsInstanced=function(e,o,i,r,s){t.drawElementsInstancedANGLE(e,o,i,r,s)},1}function fi(e){var t=e.getExtension("OES_vertex_array_object");if(t)return e.createVertexArray=function(){return t.createVertexArrayOES()},e.deleteVertexArray=function(e){t.deleteVertexArrayOES(e)},e.bindVertexArray=function(e){t.bindVertexArrayOES(e)},e.isVertexArray=function(e){return t.isVertexArrayOES(e)},1}function gi(e){var t=e.getExtension("WEBGL_draw_buffers");if(t)return e.drawBuffers=function(e,o){t.drawBuffersWEBGL(e,o)},1}function yi(e){return!!(e.dibvbi=e.getExtension("WEBGL_draw_instanced_base_vertex_base_instance"))}function bi(e){return!!(e.mdibvbi=e.getExtension("WEBGL_multi_draw_instanced_base_vertex_base_instance"))}function vi(e){return!!(e.multiDrawWebgl=e.getExtension("WEBGL_multi_draw"))}var xi={counter:1,buffers:[],programs:[],framebuffers:[],renderbuffers:[],textures:[],uniforms:[],shaders:[],vaos:[],contexts:[],offscreenCanvases:{},timerQueriesEXT:[],queries:[],samplers:[],transformFeedbacks:[],syncs:[],programInfos:{},stringCache:{},stringiCache:{},unpackAlignment:4,recordError:function(e){xi.lastError||(xi.lastError=e)},getNewId:function(e){for(var t=xi.counter++,o=e.length;o<t;o++)e[o]=null;return t},getSource:function(e,t,o,i){for(var r="",s=0;s<t;++s){var n=i?0|B(i+4*s|0,4,0):-1;r+=G(0|B(o+4*s|0,4,0),n<0?void 0:n)}return r},createContext:function(e,t){var o=t.majorVersion>1?e.getContext("webgl2",t):e.getContext("webgl",t);return o?xi.registerContext(o,t):0},registerContext:function(e,t){var o=xi.getNewId(xi.contexts),i={handle:o,attributes:t,version:t.majorVersion,GLctx:e};return e.canvas&&(e.canvas.GLctxObject=i),xi.contexts[o]=i,(void 0===t.enableExtensionsByDefault||t.enableExtensionsByDefault)&&xi.initExtensions(i),o},makeContextCurrent:function(e){return xi.currentContext=xi.contexts[e],r.ctx=Kn=xi.currentContext&&xi.currentContext.GLctx,!(e&&!Kn)},getContext:function(e){return xi.contexts[e]},deleteContext:function(e){xi.currentContext===xi.contexts[e]&&(xi.currentContext=null),"object"==typeof JSEvents&&JSEvents.removeAllHandlersOnTarget(xi.contexts[e].GLctx.canvas),xi.contexts[e]&&xi.contexts[e].GLctx.canvas&&(xi.contexts[e].GLctx.canvas.GLctxObject=void 0),xi.contexts[e]=null},initExtensions:function(e){if(e||(e=xi.currentContext),!e.initExtensionsDone){e.initExtensionsDone=!0;var t=e.GLctx;mi(t),fi(t),gi(t),yi(t),bi(t),t.disjointTimerQueryExt=t.getExtension("EXT_disjoint_timer_query"),vi(t);var o=["OES_texture_float","OES_texture_half_float","OES_standard_derivatives","OES_vertex_array_object","WEBGL_compressed_texture_s3tc","WEBGL_depth_texture","OES_element_index_uint","EXT_texture_filter_anisotropic","EXT_frag_depth","WEBGL_draw_buffers","ANGLE_instanced_arrays","OES_texture_float_linear","OES_texture_half_float_linear","EXT_blend_minmax","EXT_shader_texture_lod","EXT_texture_norm16","WEBGL_compressed_texture_pvrtc","EXT_color_buffer_half_float","WEBGL_color_buffer_float","EXT_sRGB","WEBGL_compressed_texture_etc1","EXT_disjoint_timer_query","WEBGL_compressed_texture_etc","WEBGL_compressed_texture_astc","EXT_color_buffer_float","WEBGL_compressed_texture_s3tc_srgb","EXT_disjoint_timer_query_webgl2","WEBKIT_WEBGL_compressed_texture_pvrtc"];(t.getSupportedExtensions()||[]).forEach((function(e){-1!=o.indexOf(e)&&t.getExtension(e)}))}},populateUniformTable:function(e){for(var t=xi.programs[e],o=xi.programInfos[e]={uniforms:{},maxUniformLength:0,maxAttributeLength:-1,maxUniformBlockNameLength:-1},i=o.uniforms,r=Kn.getProgramParameter(t,35718),s=0;s<r;++s){var n=Kn.getActiveUniform(t,s),a=n.name;o.maxUniformLength=Math.max(o.maxUniformLength,a.length+1),"]"==a.slice(-1)&&(a=a.slice(0,a.lastIndexOf("[")));var l=Kn.getUniformLocation(t,a);if(l){var c=xi.getNewId(xi.uniforms);i[a]=[n.size,c],xi.uniforms[c]=l;for(var d=1;d<n.size;++d){var h=a+"["+d+"]";l=Kn.getUniformLocation(t,h),c=xi.getNewId(xi.uniforms),xi.uniforms[c]=l}}}}};function wi(e){Kn.activeTexture(e)}function _i(e,t){Kn.attachShader(xi.programs[e],xi.shaders[t])}function Si(e,t,o){Kn.bindAttribLocation(xi.programs[e],t,G(o))}function Pi(e,t){35051==e?Kn.currentPixelPackBufferBinding=t:35052==e&&(Kn.currentPixelUnpackBufferBinding=t),Kn.bindBuffer(e,xi.buffers[t])}function Ci(e,t){Kn.bindFramebuffer(e,xi.framebuffers[t])}function Ti(e,t){Kn.bindRenderbuffer(e,xi.renderbuffers[t])}function Ai(e,t){Kn.bindSampler(e,xi.samplers[t])}function Ei(e,t){Kn.bindTexture(e,xi.textures[t])}function ki(e){Kn.bindVertexArray(xi.vaos[e])}function Ii(e){Kn.bindVertexArray(xi.vaos[e])}function Ri(e,t,o,i){Kn.blendColor(e,t,o,i)}function Oi(e){Kn.blendEquation(e)}function Mi(e,t){Kn.blendFunc(e,t)}function Bi(e,t,o,i,r,s,n,a,l,c){Kn.blitFramebuffer(e,t,o,i,r,s,n,a,l,c)}function Di(e,t,o,i){xi.currentContext.version>=2?o?Kn.bufferData(e,re,i,o,t):Kn.bufferData(e,t,i):Kn.bufferData(e,o?re.subarray(o,o+t):t,i)}function Fi(e,t,o,i){xi.currentContext.version>=2?Kn.bufferSubData(e,t,re,i,o):Kn.bufferSubData(e,t,re.subarray(i,i+o))}function Li(e){return Kn.checkFramebufferStatus(e)}function zi(e){Kn.clear(e)}function Ni(e,t,o,i){Kn.clearColor(e,t,o,i)}function $i(e){Kn.clearStencil(e)}function Ui(e,t){return N(t===(0|t)),(e>>>0)+4294967296*t}function Gi(e,t,o,i){return Kn.clientWaitSync(xi.syncs[e],t,Ui(o,i))}function Wi(e,t,o,i){Kn.colorMask(!!e,!!t,!!o,!!i)}function Vi(e){Kn.compileShader(xi.shaders[e])}function Hi(e,t,o,i,r,s,n,a){xi.currentContext.version>=2?Kn.currentPixelUnpackBufferBinding?Kn.compressedTexImage2D(e,t,o,i,r,s,n,a):Kn.compressedTexImage2D(e,t,o,i,r,s,re,a,n):Kn.compressedTexImage2D(e,t,o,i,r,s,a?re.subarray(a,a+n):null)}function ji(e,t,o,i,r,s,n,a,l){xi.currentContext.version>=2?Kn.currentPixelUnpackBufferBinding?Kn.compressedTexSubImage2D(e,t,o,i,r,s,n,a,l):Kn.compressedTexSubImage2D(e,t,o,i,r,s,n,re,l,a):Kn.compressedTexSubImage2D(e,t,o,i,r,s,n,l?re.subarray(l,l+a):null)}function qi(e,t,o,i,r,s,n,a){Kn.copyTexSubImage2D(e,t,o,i,r,s,n,a)}function Xi(){var e=xi.getNewId(xi.programs),t=Kn.createProgram();return t.name=e,xi.programs[e]=t,e}function Yi(e){var t=xi.getNewId(xi.shaders);return xi.shaders[t]=Kn.createShader(e),t}function Zi(e){Kn.cullFace(e)}function Qi(e,t){for(var o=0;o<e;o++){var i=0|B(t+4*o|0,4,0),r=xi.buffers[i];r&&(Kn.deleteBuffer(r),r.name=0,xi.buffers[i]=null,i==Kn.currentPixelPackBufferBinding&&(Kn.currentPixelPackBufferBinding=0),i==Kn.currentPixelUnpackBufferBinding&&(Kn.currentPixelUnpackBufferBinding=0))}}function Ji(e,t){for(var o=0;o<e;++o){var i=0|B(t+4*o|0,4,0),r=xi.framebuffers[i];r&&(Kn.deleteFramebuffer(r),r.name=0,xi.framebuffers[i]=null)}}function Ki(e){if(e){var t=xi.programs[e];t?(Kn.deleteProgram(t),t.name=0,xi.programs[e]=null,xi.programInfos[e]=null):xi.recordError(1281)}}function er(e,t){for(var o=0;o<e;o++){var i=0|B(t+4*o|0,4,0),r=xi.renderbuffers[i];r&&(Kn.deleteRenderbuffer(r),r.name=0,xi.renderbuffers[i]=null)}}function tr(e,t){for(var o=0;o<e;o++){var i=0|B(t+4*o|0,4,0),r=xi.samplers[i];r&&(Kn.deleteSampler(r),r.name=0,xi.samplers[i]=null)}}function or(e){if(e){var t=xi.shaders[e];t?(Kn.deleteShader(t),xi.shaders[e]=null):xi.recordError(1281)}}function ir(e){if(e){var t=xi.syncs[e];t?(Kn.deleteSync(t),t.name=0,xi.syncs[e]=null):xi.recordError(1281)}}function rr(e,t){for(var o=0;o<e;o++){var i=0|B(t+4*o|0,4,0),r=xi.textures[i];r&&(Kn.deleteTexture(r),r.name=0,xi.textures[i]=null)}}function sr(e,t){for(var o=0;o<e;o++){var i=0|B(t+4*o|0,4,0);Kn.deleteVertexArray(xi.vaos[i]),xi.vaos[i]=null}}function nr(e,t){for(var o=0;o<e;o++){var i=0|B(t+4*o|0,4,0);Kn.deleteVertexArray(xi.vaos[i]),xi.vaos[i]=null}}function ar(e){Kn.depthMask(!!e)}function lr(e){Kn.disable(e)}function cr(e){Kn.disableVertexAttribArray(e)}function dr(e,t,o){Kn.drawArrays(e,t,o)}function hr(e,t,o,i){Kn.drawArraysInstanced(e,t,o,i)}function pr(e,t,o,i,r){Kn.dibvbi.drawArraysInstancedBaseInstanceWEBGL(e,t,o,i,r)}var ur=[];function mr(e,t){for(var o=ur[e],i=0;i<e;i++)o[i]=0|B(t+4*i|0,4,0);Kn.drawBuffers(o)}function fr(e,t,o,i){Kn.drawElements(e,t,o,i)}function gr(e,t,o,i,r){Kn.drawElementsInstanced(e,t,o,i,r)}function yr(e,t,o,i,r,s,n){Kn.dibvbi.drawElementsInstancedBaseVertexBaseInstanceWEBGL(e,t,o,i,r,s,n)}function br(e,t,o,i){Kn.drawElements(e,t,o,i)}function vr(e,t,o,i,r,s){br(e,i,r,s)}function xr(e){Kn.enable(e)}function wr(e){Kn.enableVertexAttribArray(e)}function _r(e,t){var o=Kn.fenceSync(e,t);if(o){var i=xi.getNewId(xi.syncs);return o.name=i,xi.syncs[i]=o,i}return 0}function Sr(){Kn.finish()}function Pr(){Kn.flush()}function Cr(e,t,o,i){Kn.framebufferRenderbuffer(e,t,o,xi.renderbuffers[i])}function Tr(e,t,o,i,r){Kn.framebufferTexture2D(e,t,o,xi.textures[i],r)}function Ar(e){Kn.frontFace(e)}function Er(e,t,o,i){for(var r=0;r<e;r++){var s=Kn[o](),n=s&&xi.getNewId(i);s?(s.name=n,i[n]=s):xi.recordError(1282),O(t+4*r|0,0|n,4)}}function kr(e,t){Er(e,t,"createBuffer",xi.buffers)}function Ir(e,t){Er(e,t,"createFramebuffer",xi.framebuffers)}function Rr(e,t){Er(e,t,"createRenderbuffer",xi.renderbuffers)}function Or(e,t){Er(e,t,"createSampler",xi.samplers)}function Mr(e,t){Er(e,t,"createTexture",xi.textures)}function Br(e,t){Er(e,t,"createVertexArray",xi.vaos)}function Dr(e,t){Er(e,t,"createVertexArray",xi.vaos)}function Fr(e){Kn.generateMipmap(e)}function Lr(e,t,o){o?O(0|o,0|Kn.getBufferParameter(e,t),4):xi.recordError(1281)}function zr(){var e=Kn.getError()||xi.lastError;return xi.lastError=0,e}function Nr(e,t,o,i){var r=Kn.getFramebufferAttachmentParameter(e,t,o);(r instanceof WebGLRenderbuffer||r instanceof WebGLTexture)&&(r=0|r.name),O(0|i,0|r,4)}function $r(e){return le[e>>2]+4294967296*ae[e+4>>2]}function Ur(e){return le[e>>2]+4294967296*le[e+4>>2]}function Gr(e,t){le[e>>2]=t,le[e+4>>2]=(t-le[e>>2])/4294967296;var o=t>=0?Ur(e):$r(e);o!=t&&w("writeI53ToI64() out of range: serialized JS Number "+t+" to Wasm heap as bytes lo=0x"+le[e>>2].toString(16)+", hi=0x"+le[e+4>>2].toString(16)+", which deserializes back to "+o+" instead!")}function Wr(e,t,o){if(t){var i=void 0;switch(e){case 36346:i=1;break;case 36344:return void(0!=o&&1!=o&&xi.recordError(1280));case 34814:case 36345:i=0;break;case 34466:var r=Kn.getParameter(34467);i=r?r.length:0;break;case 33309:if(xi.currentContext.version<2)return void xi.recordError(1282);i=2*(Kn.getSupportedExtensions()||[]).length;break;case 33307:case 33308:if(xi.currentContext.version<2)return void xi.recordError(1280);i=33307==e?3:0}if(void 0===i){var s=Kn.getParameter(e);switch(typeof s){case"number":i=s;break;case"boolean":i=s?1:0;break;case"string":return void xi.recordError(1280);case"object":if(null===s)switch(e){case 34964:case 35725:case 34965:case 36006:case 36007:case 32873:case 34229:case 36662:case 36663:case 35053:case 35055:case 36010:case 35097:case 35869:case 32874:case 36389:case 35983:case 35368:case 34068:i=0;break;default:return void xi.recordError(1280)}else{if(s instanceof Float32Array||s instanceof Uint32Array||s instanceof Int32Array||s instanceof Array){for(var n=0;n<s.length;++n)switch(o){case 0:O(t+4*n|0,0|s[n],4);break;case 2:M(t+4*n|0,Math.fround(s[n]),4);break;case 4:O(t+n|0,0|(s[n]?1:0),1)}return}try{i=0|s.name}catch(t){return xi.recordError(1280),void x("GL_INVALID_ENUM in glGet"+o+"v: Unknown object returned from WebGL getParameter("+e+")! (error: "+t+")")}}break;default:return xi.recordError(1280),void x("GL_INVALID_ENUM in glGet"+o+"v: Native code calling glGet"+o+"v("+e+") and it returns "+s+" of type "+typeof s+"!")}}switch(o){case 1:Gr(t,i);break;case 0:O(0|t,0|i,4);break;case 2:M(0|t,Math.fround(i),4);break;case 4:O(0|t,0|(i?1:0),1)}}else xi.recordError(1281)}function Vr(e,t){Wr(e,t,0)}function Hr(e,t,o,i){var r=Kn.getProgramInfoLog(xi.programs[e]);null===r&&(r="(unknown error)");var s=t>0&&i?V(r,i,t):0;o&&O(0|o,0|s,4)}function jr(e,t,o){if(o)if(e>=xi.counter)xi.recordError(1281);else{var i=xi.programInfos[e];if(i)if(35716==t){var r=Kn.getProgramInfoLog(xi.programs[e]);null===r&&(r="(unknown error)"),O(0|o,r.length+1|0,4)}else if(35719==t)O(0|o,0|i.maxUniformLength,4);else if(35722==t){if(-1==i.maxAttributeLength){e=xi.programs[e];var s=Kn.getProgramParameter(e,35721);i.maxAttributeLength=0;for(var n=0;n<s;++n){var a=Kn.getActiveAttrib(e,n);i.maxAttributeLength=Math.max(i.maxAttributeLength,a.name.length+1)}}O(0|o,0|i.maxAttributeLength,4)}else if(35381==t){if(-1==i.maxUniformBlockNameLength){e=xi.programs[e];var l=Kn.getProgramParameter(e,35382);i.maxUniformBlockNameLength=0;for(n=0;n<l;++n){var c=Kn.getActiveUniformBlockName(e,n);i.maxUniformBlockNameLength=Math.max(i.maxUniformBlockNameLength,c.length+1)}}O(0|o,0|i.maxUniformBlockNameLength,4)}else O(0|o,0|Kn.getProgramParameter(xi.programs[e],t),4);else xi.recordError(1282)}else xi.recordError(1281)}function qr(e,t,o){o?O(0|o,0|Kn.getRenderbufferParameter(e,t),4):xi.recordError(1281)}function Xr(e,t,o,i){var r=Kn.getShaderInfoLog(xi.shaders[e]);null===r&&(r="(unknown error)");var s=t>0&&i?V(r,i,t):0;o&&O(0|o,0|s,4)}function Yr(e,t,o,i){var r=Kn.getShaderPrecisionFormat(e,t);O(0|o,0|r.rangeMin,4),O(o+4|0,0|r.rangeMax,4),O(0|i,0|r.precision,4)}function Zr(e,t,o){if(o)if(35716==t){var i=Kn.getShaderInfoLog(xi.shaders[e]);null===i&&(i="(unknown error)"),O(0|o,0|(i?i.length+1:0),4)}else if(35720==t){var r=Kn.getShaderSource(xi.shaders[e]);O(0|o,0|(r?r.length+1:0),4)}else O(0|o,0|Kn.getShaderParameter(xi.shaders[e],t),4);else xi.recordError(1281)}function Qr(e){var t=H(e)+1,o=pa(t);return V(e,o,t),o}function Jr(e){if(xi.stringCache[e])return xi.stringCache[e];var t;switch(e){case 7939:var o=Kn.getSupportedExtensions()||[];t=Qr((o=o.concat(o.map((function(e){return"GL_"+e})))).join(" "));break;case 7936:case 7937:case 37445:case 37446:var i=Kn.getParameter(e);i||xi.recordError(1280),t=Qr(i);break;case 7938:var r=Kn.getParameter(7938);t=Qr(r=xi.currentContext.version>=2?"OpenGL ES 3.0 ("+r+")":"OpenGL ES 2.0 ("+r+")");break;case 35724:var s=Kn.getParameter(35724),n=s.match(/^WebGL GLSL ES ([0-9]\.[0-9][0-9]?)(?:$| .*)/);null!==n&&(3==n[1].length&&(n[1]=n[1]+"0"),s="OpenGL ES GLSL ES "+n[1]+" ("+s+")"),t=Qr(s);break;default:return xi.recordError(1280),0}return xi.stringCache[e]=t,t}function Kr(e,t){if(xi.currentContext.version<2)return xi.recordError(1282),0;var o=xi.stringiCache[e];if(o)return t<0||t>=o.length?(xi.recordError(1281),0):o[t];switch(e){case 7939:var i=Kn.getSupportedExtensions()||[];return i=(i=i.concat(i.map((function(e){return"GL_"+e})))).map((function(e){return Qr(e)})),o=xi.stringiCache[e]=i,t<0||t>=o.length?(xi.recordError(1281),0):o[t];default:return xi.recordError(1280),0}}function es(e){return parseInt(e)}function ts(e,t){var o=0;if("]"==(t=G(t))[t.length-1]){var i=t.lastIndexOf("[");o="]"!=t[i+1]?es(t.slice(i+1)):0,t=t.slice(0,i)}var r=xi.programInfos[e]&&xi.programInfos[e].uniforms[t];return r&&o>=0&&o<r[0]?r[1]+o:-1}function os(e,t,o){for(var i=ur[t],r=0;r<t;r++)i[r]=0|B(o+4*r|0,4,0);Kn.invalidateFramebuffer(e,i)}function is(e,t,o,i,r,s,n){for(var a=ur[t],l=0;l<t;l++)a[l]=0|B(o+4*l|0,4,0);Kn.invalidateSubFramebuffer(e,a,i,r,s,n)}function rs(e){return Kn.isSync(xi.syncs[e])}function ss(e){var t=xi.textures[e];return t?Kn.isTexture(t):0}function ns(e){Kn.lineWidth(e)}function as(e){Kn.linkProgram(xi.programs[e]),xi.populateUniformTable(e)}function ls(e,t,o,i,r,s){Kn.mdibvbi.multiDrawArraysInstancedBaseInstanceWEBGL(e,ae,t>>2,ae,o>>2,ae,i>>2,le,r>>2,s)}function cs(e,t,o,i,r,s,n,a){Kn.mdibvbi.multiDrawElementsInstancedBaseVertexBaseInstanceWEBGL(e,ae,t>>2,o,ae,i>>2,ae,r>>2,ae,s>>2,le,n>>2,a)}function ds(e,t){3317==e&&(xi.unpackAlignment=t),Kn.pixelStorei(e,t)}function hs(e){Kn.readBuffer(e)}function ps(e,t,o,i){var r;return t*(e*o+(r=i)-1&-r)}function us(e){return{5:3,6:4,8:2,29502:3,29504:4,26917:2,26918:2,29846:3,29847:4}[e-6402]||1}function ms(e){return 0==(e-=5120)?ie:1==e?re:2==e?se:4==e?ae:6==e?ce:5==e||28922==e||28520==e||30779==e||30782==e?le:ne}function fs(e){return 31-Math.clz32(e.BYTES_PER_ELEMENT)}function gs(e,t,o,i,r,s){var n=ms(e),a=fs(n),l=1<<a,c=ps(o,i,us(t)*l,xi.unpackAlignment);return n.subarray(r>>a,r+c>>a)}function ys(e,t,o,i,r,s,n){if(xi.currentContext.version>=2)if(Kn.currentPixelPackBufferBinding)Kn.readPixels(e,t,o,i,r,s,n);else{var a=ms(s);Kn.readPixels(e,t,o,i,r,s,a,n>>fs(a))}else{var l=gs(s,r,o,i,n);l?Kn.readPixels(e,t,o,i,r,s,l):xi.recordError(1280)}}function bs(e,t,o,i){Kn.renderbufferStorage(e,t,o,i)}function vs(e,t,o,i,r){Kn.renderbufferStorageMultisample(e,t,o,i,r)}function xs(e,t,o){Kn.samplerParameteri(xi.samplers[e],t,o)}function ws(e,t,o){var i=0|B(0|o,4,0);Kn.samplerParameteri(xi.samplers[e],t,i)}function _s(e,t,o,i){Kn.scissor(e,t,o,i)}function Ss(e,t,o,i){var r=xi.getSource(e,t,o,i);Kn.shaderSource(xi.shaders[e],r)}function Ps(e,t,o){Kn.stencilFunc(e,t,o)}function Cs(e,t,o,i){Kn.stencilFuncSeparate(e,t,o,i)}function Ts(e){Kn.stencilMask(e)}function As(e,t){Kn.stencilMaskSeparate(e,t)}function Es(e,t,o){Kn.stencilOp(e,t,o)}function ks(e,t,o,i){Kn.stencilOpSeparate(e,t,o,i)}function Is(e,t,o,i,r,s,n,a,l){if(xi.currentContext.version>=2)if(Kn.currentPixelUnpackBufferBinding)Kn.texImage2D(e,t,o,i,r,s,n,a,l);else if(l){var c=ms(a);Kn.texImage2D(e,t,o,i,r,s,n,a,c,l>>fs(c))}else Kn.texImage2D(e,t,o,i,r,s,n,a,null);else Kn.texImage2D(e,t,o,i,r,s,n,a,l?gs(a,n,i,r,l):null)}function Rs(e,t,o){Kn.texParameterf(e,t,o)}function Os(e,t,o){var i=Math.fround(D(0|o,4,0));Kn.texParameterf(e,t,i)}function Ms(e,t,o){Kn.texParameteri(e,t,o)}function Bs(e,t,o){var i=0|B(0|o,4,0);Kn.texParameteri(e,t,i)}function Ds(e,t,o,i,r){Kn.texStorage2D(e,t,o,i,r)}function Fs(e,t,o,i,r,s,n,a,l){if(xi.currentContext.version>=2)if(Kn.currentPixelUnpackBufferBinding)Kn.texSubImage2D(e,t,o,i,r,s,n,a,l);else if(l){var c=ms(a);Kn.texSubImage2D(e,t,o,i,r,s,n,a,c,l>>fs(c))}else Kn.texSubImage2D(e,t,o,i,r,s,n,a,null);else{var d=null;l&&(d=gs(a,n,r,s,l)),Kn.texSubImage2D(e,t,o,i,r,s,n,a,d)}}function Ls(e,t){Kn.uniform1f(xi.uniforms[e],t)}var zs=[];function Ns(e,t,o){if(xi.currentContext.version>=2)Kn.uniform1fv(xi.uniforms[e],ce,o>>2,t);else{if(t<=288)for(var i=zs[t-1],r=0;r<t;++r)i[r]=Math.fround(D(o+4*r|0,4,0));else i=ce.subarray(o>>2,o+4*t>>2);Kn.uniform1fv(xi.uniforms[e],i)}}function $s(e,t){Kn.uniform1i(xi.uniforms[e],t)}var Us=[];function Gs(e,t,o){if(xi.currentContext.version>=2)Kn.uniform1iv(xi.uniforms[e],ae,o>>2,t);else{if(t<=288)for(var i=Us[t-1],r=0;r<t;++r)i[r]=0|B(o+4*r|0,4,0);else i=ae.subarray(o>>2,o+4*t>>2);Kn.uniform1iv(xi.uniforms[e],i)}}function Ws(e,t,o){Kn.uniform2f(xi.uniforms[e],t,o)}function Vs(e,t,o){if(xi.currentContext.version>=2)Kn.uniform2fv(xi.uniforms[e],ce,o>>2,2*t);else{if(t<=144)for(var i=zs[2*t-1],r=0;r<2*t;r+=2)i[r]=Math.fround(D(o+4*r|0,4,0)),i[r+1]=Math.fround(D(o+(4*r+4)|0,4,0));else i=ce.subarray(o>>2,o+8*t>>2);Kn.uniform2fv(xi.uniforms[e],i)}}function Hs(e,t,o){Kn.uniform2i(xi.uniforms[e],t,o)}function js(e,t,o){if(xi.currentContext.version>=2)Kn.uniform2iv(xi.uniforms[e],ae,o>>2,2*t);else{if(t<=144)for(var i=Us[2*t-1],r=0;r<2*t;r+=2)i[r]=0|B(o+4*r|0,4,0),i[r+1]=0|B(o+(4*r+4)|0,4,0);else i=ae.subarray(o>>2,o+8*t>>2);Kn.uniform2iv(xi.uniforms[e],i)}}function qs(e,t,o,i){Kn.uniform3f(xi.uniforms[e],t,o,i)}function Xs(e,t,o){if(xi.currentContext.version>=2)Kn.uniform3fv(xi.uniforms[e],ce,o>>2,3*t);else{if(t<=96)for(var i=zs[3*t-1],r=0;r<3*t;r+=3)i[r]=Math.fround(D(o+4*r|0,4,0)),i[r+1]=Math.fround(D(o+(4*r+4)|0,4,0)),i[r+2]=Math.fround(D(o+(4*r+8)|0,4,0));else i=ce.subarray(o>>2,o+12*t>>2);Kn.uniform3fv(xi.uniforms[e],i)}}function Ys(e,t,o,i){Kn.uniform3i(xi.uniforms[e],t,o,i)}function Zs(e,t,o){if(xi.currentContext.version>=2)Kn.uniform3iv(xi.uniforms[e],ae,o>>2,3*t);else{if(t<=96)for(var i=Us[3*t-1],r=0;r<3*t;r+=3)i[r]=0|B(o+4*r|0,4,0),i[r+1]=0|B(o+(4*r+4)|0,4,0),i[r+2]=0|B(o+(4*r+8)|0,4,0);else i=ae.subarray(o>>2,o+12*t>>2);Kn.uniform3iv(xi.uniforms[e],i)}}function Qs(e,t,o,i,r){Kn.uniform4f(xi.uniforms[e],t,o,i,r)}function Js(e,t,o){if(xi.currentContext.version>=2)Kn.uniform4fv(xi.uniforms[e],ce,o>>2,4*t);else{if(t<=72){var i=zs[4*t-1],r=ce;o>>=2;for(var s=0;s<4*t;s+=4){var n=o+s;i[s]=r[n],i[s+1]=r[n+1],i[s+2]=r[n+2],i[s+3]=r[n+3]}}else i=ce.subarray(o>>2,o+16*t>>2);Kn.uniform4fv(xi.uniforms[e],i)}}function Ks(e,t,o,i,r){Kn.uniform4i(xi.uniforms[e],t,o,i,r)}function en(e,t,o){if(xi.currentContext.version>=2)Kn.uniform4iv(xi.uniforms[e],ae,o>>2,4*t);else{if(t<=72)for(var i=Us[4*t-1],r=0;r<4*t;r+=4)i[r]=0|B(o+4*r|0,4,0),i[r+1]=0|B(o+(4*r+4)|0,4,0),i[r+2]=0|B(o+(4*r+8)|0,4,0),i[r+3]=0|B(o+(4*r+12)|0,4,0);else i=ae.subarray(o>>2,o+16*t>>2);Kn.uniform4iv(xi.uniforms[e],i)}}function tn(e,t,o,i){if(xi.currentContext.version>=2)Kn.uniformMatrix2fv(xi.uniforms[e],!!o,ce,i>>2,4*t);else{if(t<=72)for(var r=zs[4*t-1],s=0;s<4*t;s+=4)r[s]=Math.fround(D(i+4*s|0,4,0)),r[s+1]=Math.fround(D(i+(4*s+4)|0,4,0)),r[s+2]=Math.fround(D(i+(4*s+8)|0,4,0)),r[s+3]=Math.fround(D(i+(4*s+12)|0,4,0));else r=ce.subarray(i>>2,i+16*t>>2);Kn.uniformMatrix2fv(xi.uniforms[e],!!o,r)}}function on(e,t,o,i){if(xi.currentContext.version>=2)Kn.uniformMatrix3fv(xi.uniforms[e],!!o,ce,i>>2,9*t);else{if(t<=32)for(var r=zs[9*t-1],s=0;s<9*t;s+=9)r[s]=Math.fround(D(i+4*s|0,4,0)),r[s+1]=Math.fround(D(i+(4*s+4)|0,4,0)),r[s+2]=Math.fround(D(i+(4*s+8)|0,4,0)),r[s+3]=Math.fround(D(i+(4*s+12)|0,4,0)),r[s+4]=Math.fround(D(i+(4*s+16)|0,4,0)),r[s+5]=Math.fround(D(i+(4*s+20)|0,4,0)),r[s+6]=Math.fround(D(i+(4*s+24)|0,4,0)),r[s+7]=Math.fround(D(i+(4*s+28)|0,4,0)),r[s+8]=Math.fround(D(i+(4*s+32)|0,4,0));else r=ce.subarray(i>>2,i+36*t>>2);Kn.uniformMatrix3fv(xi.uniforms[e],!!o,r)}}function rn(e,t,o,i){if(xi.currentContext.version>=2)Kn.uniformMatrix4fv(xi.uniforms[e],!!o,ce,i>>2,16*t);else{if(t<=18){var r=zs[16*t-1],s=ce;i>>=2;for(var n=0;n<16*t;n+=16){var a=i+n;r[n]=s[a],r[n+1]=s[a+1],r[n+2]=s[a+2],r[n+3]=s[a+3],r[n+4]=s[a+4],r[n+5]=s[a+5],r[n+6]=s[a+6],r[n+7]=s[a+7],r[n+8]=s[a+8],r[n+9]=s[a+9],r[n+10]=s[a+10],r[n+11]=s[a+11],r[n+12]=s[a+12],r[n+13]=s[a+13],r[n+14]=s[a+14],r[n+15]=s[a+15]}}else r=ce.subarray(i>>2,i+64*t>>2);Kn.uniformMatrix4fv(xi.uniforms[e],!!o,r)}}function sn(e){Kn.useProgram(xi.programs[e])}function nn(e,t){Kn.vertexAttrib1f(e,t)}function an(e,t){Kn.vertexAttrib2f(e,ce[t>>2],ce[t+4>>2])}function ln(e,t){Kn.vertexAttrib3f(e,ce[t>>2],ce[t+4>>2],ce[t+8>>2])}function cn(e,t){Kn.vertexAttrib4f(e,ce[t>>2],ce[t+4>>2],ce[t+8>>2],ce[t+12>>2])}function dn(e,t){Kn.vertexAttribDivisor(e,t)}function hn(e,t,o,i,r){Kn.vertexAttribIPointer(e,t,o,i,r)}function pn(e,t,o,i,r,s){Kn.vertexAttribPointer(e,t,o,!!i,r,s)}function un(e,t,o,i){Kn.viewport(e,t,o,i)}function mn(e,t,o,i){Kn.waitSync(xi.syncs[e],t,Ui(o,i))}function fn(e,t){throw wa(e,t||1),"longjmp"}function gn(e,t){return fn(e,t)}function yn(e,t){return fn(e,t)}function bn(e,t,o){re.copyWithin(e,t,t+o)}function vn(){return re.length}function xn(e){try{return P.grow(e-oe.byteLength+65535>>>16),ue(P.buffer),1}catch(t){console.error("emscripten_realloc_buffer: Attempted to grow heap from "+oe.byteLength+" bytes to "+e+" bytes, but got error: "+t)}}function wn(e){e>>>=0;var t=vn();N(e>t);var o=2147483648;if(e>o)return x("Cannot enlarge memory, asked to go up to "+e+" bytes, but the limit is "+"2147483648 bytes!"),!1;for(var i=1;i<=4;i*=2){var r=t*(1+.2/i);r=Math.min(r,e+100663296);var s=Math.min(o,pe(Math.max(16777216,e,r),65536));if(xn(s))return!0}return x("Failed to grow the heap from "+t+" bytes to "+s+" bytes, not enough memory!"),!1}function _n(){return xi.currentContext?xi.currentContext.handle:0}function Sn(){return _n()}function Pn(e){return xi.makeContextCurrent(e)?0:-5}var Cn={};function Tn(){return a||"./this.program"}function An(){if(!An.strings){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:Tn()};for(var t in Cn)e[t]=Cn[t];var o=[];for(var t in e)o.push(t+"="+e[t]);An.strings=o}return An.strings}function En(e,t){var o=0;return An().forEach((function(i,r){var s=t+o;O(e+4*r|0,0|s,4),te(i,s),o+=i.length+1})),0}function kn(e,t){var o=An();O(0|e,0|o.length,4);var i=0;return o.forEach((function(e){i+=e.length+1})),O(0|t,0|i,4),0}function In(e){Na(e)}var Rn={mappings:{},buffers:[null,[],[]],printChar:function(e,t){var o=Rn.buffers[e];N(o),0===t||10===t?((1===e?v:x)(U(o,0)),o.length=0):o.push(t)},varargs:void 0,get:function(){return N(null!=Rn.varargs),Rn.varargs+=4,0|B(Rn.varargs-4|0,4,0)},getStr:function(e){return G(e)},get64:function(e,t){return N(e>=0?0===t:-1===t),e}};function On(e){return Ne("it should not be possible to operate on streams when !SYSCALLS_REQUIRE_FILESYSTEM"),0}function Mn(e,t,o,i){var r=Rn.getStreamFromFD(e);return O(0|i,0|Rn.doReadv(r,t,o),4),0}function Bn(e,t,o,i,r){Ne("it should not be possible to operate on streams when !SYSCALLS_REQUIRE_FILESYSTEM")}function Dn(){"undefined"!=typeof _fflush&&_fflush(0);var e=Rn.buffers;e[1].length&&Rn.printChar(1,10),e[2].length&&Rn.printChar(2,10)}function Fn(e,t,o,i){for(var r=0,s=0;s<o;s++){for(var n=0|B(t+8*s|0,4,0),a=0|B(t+(8*s+4)|0,4,0),l=0;l<a;l++)Rn.printChar(e,re[n+l]);r+=a}return O(0|i,0|r,4),0}function Ln(){return 0|E()}function zn(e){var t=Date.now();return O(0|e,0|t/1e3,4),O(e+4|0,0|t%1e3*1e3,4),0}function Nn(e,t){Kn.bindFramebuffer(e,xi.framebuffers[t])}function $n(e){Kn.clear(e)}function Un(e,t,o,i){Kn.clearColor(e,t,o,i)}function Gn(e){Kn.clearStencil(e)}function Wn(e,t){Wr(e,t,0)}function Vn(){if(!Vn.called){Vn.called=!0,O(0|ba(),60*(new Date).getTimezoneOffset()|0,4);var e=(new Date).getFullYear(),t=new Date(e,0,1),o=new Date(e,6,1);O(0|ya(),0|Number(t.getTimezoneOffset()!=o.getTimezoneOffset()),4);var i=a(t),r=a(o),s=K(i),n=K(r);o.getTimezoneOffset()<t.getTimezoneOffset()?(O(0|ga(),0|s,4),O(ga()+4|0,0|n,4)):(O(0|ga(),0|n,4),O(ga()+4|0,0|s,4))}function a(e){var t=e.toTimeString().match(/\(([A-Za-z ]+)\)$/);return t?t[1]:"GMT"}}function Hn(e,t){Vn();var o=new Date(1e3*(0|B(0|e,4,0)));O(0|t,0|o.getSeconds(),4),O(t+4|0,0|o.getMinutes(),4),O(t+8|0,0|o.getHours(),4),O(t+12|0,0|o.getDate(),4),O(t+16|0,0|o.getMonth(),4),O(t+20|0,o.getFullYear()-1900|0,4),O(t+24|0,0|o.getDay(),4);var i=new Date(o.getFullYear(),0,1);O(t+28|0,0|((o.getTime()-i.getTime())/864e5|0),4),O(t+36|0,-60*o.getTimezoneOffset()|0,4);var r=new Date(o.getFullYear(),6,1).getTimezoneOffset(),s=i.getTimezoneOffset(),n=0|(r!=s&&o.getTimezoneOffset()==Math.min(s,r));return O(t+32|0,0|n,4),O(t+40|0,0|(0|B(ga()+(n?4:0)|0,4,0)),4),t}function jn(){}function qn(){}function Xn(){}function Yn(){}function Zn(e){A(0|e)}function Qn(e){return e%4==0&&(e%100!=0||e%400==0)}function Jn(e,t){for(var o=0,i=0;i<=t;o+=e[i++]);return o}var Kn,ea=[31,29,31,30,31,30,31,31,30,31,30,31],ta=[31,28,31,30,31,30,31,31,30,31,30,31];function oa(e,t){for(var o=new Date(e.getTime());t>0;){var i=Qn(o.getFullYear()),r=o.getMonth(),s=(i?ea:ta)[r];if(!(t>s-o.getDate()))return o.setDate(o.getDate()+t),o;t-=s-o.getDate()+1,o.setDate(1),r<11?o.setMonth(r+1):(o.setMonth(0),o.setFullYear(o.getFullYear()+1))}return o}function ia(e,t,o,i){var r=0|B(i+40|0,4,0),s={tm_sec:0|B(0|i,4,0),tm_min:0|B(i+4|0,4,0),tm_hour:0|B(i+8|0,4,0),tm_mday:0|B(i+12|0,4,0),tm_mon:0|B(i+16|0,4,0),tm_year:0|B(i+20|0,4,0),tm_wday:0|B(i+24|0,4,0),tm_yday:0|B(i+28|0,4,0),tm_isdst:0|B(i+32|0,4,0),tm_gmtoff:0|B(i+36|0,4,0),tm_zone:r?G(r):""},n=G(o),a={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var l in a)n=n.replace(new RegExp(l,"g"),a[l]);var c=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],d=["January","February","March","April","May","June","July","August","September","October","November","December"];function h(e,t,o){for(var i="number"==typeof e?e.toString():e||"";i.length<t;)i=o[0]+i;return i}function p(e,t){return h(e,t,"0")}function u(e,t){function o(e){return e<0?-1:e>0?1:0}var i;return 0===(i=o(e.getFullYear()-t.getFullYear()))&&0===(i=o(e.getMonth()-t.getMonth()))&&(i=o(e.getDate()-t.getDate())),i}function m(e){switch(e.getDay()){case 0:return new Date(e.getFullYear()-1,11,29);case 1:return e;case 2:return new Date(e.getFullYear(),0,3);case 3:return new Date(e.getFullYear(),0,2);case 4:return new Date(e.getFullYear(),0,1);case 5:return new Date(e.getFullYear()-1,11,31);case 6:return new Date(e.getFullYear()-1,11,30)}}function f(e){var t=oa(new Date(e.tm_year+1900,0,1),e.tm_yday),o=new Date(t.getFullYear(),0,4),i=new Date(t.getFullYear()+1,0,4),r=m(o),s=m(i);return u(r,t)<=0?u(s,t)<=0?t.getFullYear()+1:t.getFullYear():t.getFullYear()-1}var g={"%a":function(e){return c[e.tm_wday].substring(0,3)},"%A":function(e){return c[e.tm_wday]},"%b":function(e){return d[e.tm_mon].substring(0,3)},"%B":function(e){return d[e.tm_mon]},"%C":function(e){return p((e.tm_year+1900)/100|0,2)},"%d":function(e){return p(e.tm_mday,2)},"%e":function(e){return h(e.tm_mday,2," ")},"%g":function(e){return f(e).toString().substring(2)},"%G":function(e){return f(e)},"%H":function(e){return p(e.tm_hour,2)},"%I":function(e){var t=e.tm_hour;return 0==t?t=12:t>12&&(t-=12),p(t,2)},"%j":function(e){return p(e.tm_mday+Jn(Qn(e.tm_year+1900)?ea:ta,e.tm_mon-1),3)},"%m":function(e){return p(e.tm_mon+1,2)},"%M":function(e){return p(e.tm_min,2)},"%n":function(){return"\n"},"%p":function(e){return e.tm_hour>=0&&e.tm_hour<12?"AM":"PM"},"%S":function(e){return p(e.tm_sec,2)},"%t":function(){return"\t"},"%u":function(e){return e.tm_wday||7},"%U":function(e){var t=new Date(e.tm_year+1900,0,1),o=0===t.getDay()?t:oa(t,7-t.getDay()),i=new Date(e.tm_year+1900,e.tm_mon,e.tm_mday);if(u(o,i)<0){var r=Jn(Qn(i.getFullYear())?ea:ta,i.getMonth()-1)-31,s=31-o.getDate()+r+i.getDate();return p(Math.ceil(s/7),2)}return 0===u(o,t)?"01":"00"},"%V":function(e){var t,o=new Date(e.tm_year+1900,0,4),i=new Date(e.tm_year+1901,0,4),r=m(o),s=m(i),n=oa(new Date(e.tm_year+1900,0,1),e.tm_yday);return u(n,r)<0?"53":u(s,n)<=0?"01":(t=r.getFullYear()<e.tm_year+1900?e.tm_yday+32-r.getDate():e.tm_yday+1-r.getDate(),p(Math.ceil(t/7),2))},"%w":function(e){return e.tm_wday},"%W":function(e){var t=new Date(e.tm_year,0,1),o=1===t.getDay()?t:oa(t,0===t.getDay()?1:7-t.getDay()+1),i=new Date(e.tm_year+1900,e.tm_mon,e.tm_mday);if(u(o,i)<0){var r=Jn(Qn(i.getFullYear())?ea:ta,i.getMonth()-1)-31,s=31-o.getDate()+r+i.getDate();return p(Math.ceil(s/7),2)}return 0===u(o,t)?"01":"00"},"%y":function(e){return(e.tm_year+1900).toString().substring(2)},"%Y":function(e){return e.tm_year+1900},"%z":function(e){var t=e.tm_gmtoff,o=t>=0;return t=(t=Math.abs(t)/60)/60*100+t%60,(o?"+":"-")+String("0000"+t).slice(-4)},"%Z":function(e){return e.tm_zone},"%%":function(){return"%"}};for(var l in g)n.indexOf(l)>=0&&(n=n.replace(new RegExp(l,"g"),g[l](s)));var y=la(n,!1);return y.length>t?0:(ee(y,e),y.length-1)}function ra(e,t,o,i){return ia(e,t,o,i)}Ct=r.InternalError=Pt(Error,"InternalError"),It(),Mt=r.BindingError=Pt(Error,"BindingError"),Jt(),_o(),go(),Ao=r.UnboundTypeError=Pt(Error,"UnboundTypeError"),Go();for(var sa=0;sa<32;++sa)ur.push(new Array(sa));var na=new Float32Array(288);for(sa=0;sa<288;++sa)zs[sa]=na.subarray(0,sa+1);var aa=new Int32Array(288);for(sa=0;sa<288;++sa)Us[sa]=aa.subarray(0,sa+1);function la(e,t,o){var i=o>0?o:H(e)+1,r=new Array(i),s=W(e,r,0,r.length);return t&&(r.length=s),r}we.push({func:function(){ha()}});var ca,da={__assert_fail:at,__cxa_allocate_exception:ct,__cxa_atexit:dt,__cxa_thread_atexit:ht,__cxa_throw:ut,_embind_finalize_value_object:Et,_embind_register_bool:Ft,_embind_register_class:Io,_embind_register_class_constructor:Oo,_embind_register_class_function:Do,_embind_register_emval:Vo,_embind_register_enum:jo,_embind_register_enum_value:Xo,_embind_register_float:Qo,_embind_register_function:Jo,_embind_register_integer:ei,_embind_register_memory_view:ti,_embind_register_smart_ptr:oi,_embind_register_std_string:ii,_embind_register_std_wstring:ri,_embind_register_value_object:si,_embind_register_value_object_field:ni,_embind_register_void:ai,_emval_decref:No,_emval_incref:li,_emval_take_value:ci,abort:di,alignfault:L,clock_gettime:ui,emscripten_glActiveTexture:wi,emscripten_glAttachShader:_i,emscripten_glBindAttribLocation:Si,emscripten_glBindBuffer:Pi,emscripten_glBindFramebuffer:Ci,emscripten_glBindRenderbuffer:Ti,emscripten_glBindSampler:Ai,emscripten_glBindTexture:Ei,emscripten_glBindVertexArray:ki,emscripten_glBindVertexArrayOES:Ii,emscripten_glBlendColor:Ri,emscripten_glBlendEquation:Oi,emscripten_glBlendFunc:Mi,emscripten_glBlitFramebuffer:Bi,emscripten_glBufferData:Di,emscripten_glBufferSubData:Fi,emscripten_glCheckFramebufferStatus:Li,emscripten_glClear:zi,emscripten_glClearColor:Ni,emscripten_glClearStencil:$i,emscripten_glClientWaitSync:Gi,emscripten_glColorMask:Wi,emscripten_glCompileShader:Vi,emscripten_glCompressedTexImage2D:Hi,emscripten_glCompressedTexSubImage2D:ji,emscripten_glCopyTexSubImage2D:qi,emscripten_glCreateProgram:Xi,emscripten_glCreateShader:Yi,emscripten_glCullFace:Zi,emscripten_glDeleteBuffers:Qi,emscripten_glDeleteFramebuffers:Ji,emscripten_glDeleteProgram:Ki,emscripten_glDeleteRenderbuffers:er,emscripten_glDeleteSamplers:tr,emscripten_glDeleteShader:or,emscripten_glDeleteSync:ir,emscripten_glDeleteTextures:rr,emscripten_glDeleteVertexArrays:sr,emscripten_glDeleteVertexArraysOES:nr,emscripten_glDepthMask:ar,emscripten_glDisable:lr,emscripten_glDisableVertexAttribArray:cr,emscripten_glDrawArrays:dr,emscripten_glDrawArraysInstanced:hr,emscripten_glDrawArraysInstancedBaseInstanceWEBGL:pr,emscripten_glDrawBuffers:mr,emscripten_glDrawElements:fr,emscripten_glDrawElementsInstanced:gr,emscripten_glDrawElementsInstancedBaseVertexBaseInstanceWEBGL:yr,emscripten_glDrawRangeElements:vr,emscripten_glEnable:xr,emscripten_glEnableVertexAttribArray:wr,emscripten_glFenceSync:_r,emscripten_glFinish:Sr,emscripten_glFlush:Pr,emscripten_glFramebufferRenderbuffer:Cr,emscripten_glFramebufferTexture2D:Tr,emscripten_glFrontFace:Ar,emscripten_glGenBuffers:kr,emscripten_glGenFramebuffers:Ir,emscripten_glGenRenderbuffers:Rr,emscripten_glGenSamplers:Or,emscripten_glGenTextures:Mr,emscripten_glGenVertexArrays:Br,emscripten_glGenVertexArraysOES:Dr,emscripten_glGenerateMipmap:Fr,emscripten_glGetBufferParameteriv:Lr,emscripten_glGetError:zr,emscripten_glGetFramebufferAttachmentParameteriv:Nr,emscripten_glGetIntegerv:Vr,emscripten_glGetProgramInfoLog:Hr,emscripten_glGetProgramiv:jr,emscripten_glGetRenderbufferParameteriv:qr,emscripten_glGetShaderInfoLog:Xr,emscripten_glGetShaderPrecisionFormat:Yr,emscripten_glGetShaderiv:Zr,emscripten_glGetString:Jr,emscripten_glGetStringi:Kr,emscripten_glGetUniformLocation:ts,emscripten_glInvalidateFramebuffer:os,emscripten_glInvalidateSubFramebuffer:is,emscripten_glIsSync:rs,emscripten_glIsTexture:ss,emscripten_glLineWidth:ns,emscripten_glLinkProgram:as,emscripten_glMultiDrawArraysInstancedBaseInstanceWEBGL:ls,emscripten_glMultiDrawElementsInstancedBaseVertexBaseInstanceWEBGL:cs,emscripten_glPixelStorei:ds,emscripten_glReadBuffer:hs,emscripten_glReadPixels:ys,emscripten_glRenderbufferStorage:bs,emscripten_glRenderbufferStorageMultisample:vs,emscripten_glSamplerParameteri:xs,emscripten_glSamplerParameteriv:ws,emscripten_glScissor:_s,emscripten_glShaderSource:Ss,emscripten_glStencilFunc:Ps,emscripten_glStencilFuncSeparate:Cs,emscripten_glStencilMask:Ts,emscripten_glStencilMaskSeparate:As,emscripten_glStencilOp:Es,emscripten_glStencilOpSeparate:ks,emscripten_glTexImage2D:Is,emscripten_glTexParameterf:Rs,emscripten_glTexParameterfv:Os,emscripten_glTexParameteri:Ms,emscripten_glTexParameteriv:Bs,emscripten_glTexStorage2D:Ds,emscripten_glTexSubImage2D:Fs,emscripten_glUniform1f:Ls,emscripten_glUniform1fv:Ns,emscripten_glUniform1i:$s,emscripten_glUniform1iv:Gs,emscripten_glUniform2f:Ws,emscripten_glUniform2fv:Vs,emscripten_glUniform2i:Hs,emscripten_glUniform2iv:js,emscripten_glUniform3f:qs,emscripten_glUniform3fv:Xs,emscripten_glUniform3i:Ys,emscripten_glUniform3iv:Zs,emscripten_glUniform4f:Qs,emscripten_glUniform4fv:Js,emscripten_glUniform4i:Ks,emscripten_glUniform4iv:en,emscripten_glUniformMatrix2fv:tn,emscripten_glUniformMatrix3fv:on,emscripten_glUniformMatrix4fv:rn,emscripten_glUseProgram:sn,emscripten_glVertexAttrib1f:nn,emscripten_glVertexAttrib2fv:an,emscripten_glVertexAttrib3fv:ln,emscripten_glVertexAttrib4fv:cn,emscripten_glVertexAttribDivisor:dn,emscripten_glVertexAttribIPointer:hn,emscripten_glVertexAttribPointer:pn,emscripten_glViewport:un,emscripten_glWaitSync:mn,emscripten_longjmp:gn,emscripten_longjmp_jmpbuf:yn,emscripten_memcpy_big:bn,emscripten_resize_heap:wn,emscripten_webgl_get_current_context:Sn,emscripten_webgl_make_context_current:Pn,environ_get:En,environ_sizes_get:kn,exit:In,fd_close:On,fd_read:Mn,fd_seek:Bn,fd_write:Fn,getTempRet0:Ln,gettimeofday:zn,glBindFramebuffer:Nn,glClear:$n,glClearColor:Un,glClearStencil:Gn,glGetIntegerv:Wn,invoke_ii:Sa,invoke_iii:Pa,invoke_iiii:Ta,invoke_iiiii:Ma,invoke_iiiiii:ka,invoke_iiiiiii:Ra,invoke_vi:Aa,invoke_vii:Ca,invoke_viii:Ea,invoke_viiii:Ia,invoke_viiiii:Oa,invoke_viiiiii:Da,invoke_viiiiiiiii:Ba,localtime_r:Hn,memory:P,segfault:F,sem_destroy:jn,sem_init:qn,sem_post:Xn,sem_wait:Yn,setTempRet0:Zn,strftime_l:ra},ha=(Je(),r.___wasm_call_ctors=je("__wasm_call_ctors")),pa=(r._hb_blob_destroy=je("hb_blob_destroy"),r._hb_blob_create=je("hb_blob_create"),r._calloc=je("calloc"),r._malloc=je("malloc")),ua=r._free=je("free"),ma=(r._hb_blob_get_length=je("hb_blob_get_length"),r._realloc=je("realloc"),r._hb_buffer_get_glyph_infos=je("hb_buffer_get_glyph_infos"),r._hb_buffer_get_glyph_positions=je("hb_buffer_get_glyph_positions"),r._hb_font_get_glyph_extents=je("hb_font_get_glyph_extents"),r._memset=je("memset"),r._hb_buffer_create=je("hb_buffer_create"),r._hb_buffer_destroy=je("hb_buffer_destroy"),r._hb_buffer_set_direction=je("hb_buffer_set_direction"),r._hb_buffer_get_length=je("hb_buffer_get_length"),r._hb_buffer_guess_segment_properties=je("hb_buffer_guess_segment_properties"),r._hb_buffer_add_utf8=je("hb_buffer_add_utf8"),r._hb_face_create=je("hb_face_create"),r._hb_face_destroy=je("hb_face_destroy"),r._hb_face_get_upem=je("hb_face_get_upem"),r._hb_font_get_h_extents=je("hb_font_get_h_extents"),r._hb_font_create=je("hb_font_create"),r._hb_font_destroy=je("hb_font_destroy"),r._hb_font_set_scale=je("hb_font_set_scale"),r.___errno_location=je("__errno_location")),fa=(r._hb_shape=je("hb_shape"),r._mesh_test=je("mesh_test"),r._create_spline_mesh=je("create_spline_mesh"),r._mesh_has_overflow=je("mesh_has_overflow"),r._mesh_result_width=je("mesh_result_width"),r._mesh_result_height=je("mesh_result_height"),r._mesh_result_top=je("mesh_result_top"),r._mesh_result_left=je("mesh_result_left"),r._mesh_transform=je("mesh_transform"),r._path_create=je("path_create"),r._path_destroy=je("path_destroy"),r._path_move_to=je("path_move_to"),r._path_line_to=je("path_line_to"),r._path_cubic_to=je("path_cubic_to"),r._path_close=je("path_close"),r._create_sine_transformer=je("create_sine_transformer"),r._delete_sine_transformer=je("delete_sine_transformer"),r._create_cosine_transformer=je("create_cosine_transformer"),r._delete_cosine_transformer=je("delete_cosine_transformer"),r._create_parable_transformer=je("create_parable_transformer"),r._delete_parable_transformer=je("delete_parable_transformer"),r._create_inverse_parable_transformer=je("create_inverse_parable_transformer"),r._delete_inverse_parable_transformer=je("delete_inverse_parable_transformer"),r._delete_arc_transformer=je("delete_arc_transformer"),r._create_cup_transformer=je("create_cup_transformer"),r._delete_cup_transformer=je("delete_cup_transformer"),r._create_mesh_transformer=je("create_mesh_transformer"),r._delete_mesh_transformer=je("delete_mesh_transformer"),r._create_turbulence_transformer=je("create_turbulence_transformer"),r._delete_turbulence_transformer=je("delete_turbulence_transformer"),r._transform_points=je("transform_points"),r._transform_path_sine=je("transform_path_sine"),r._transform_path_cosine=je("transform_path_cosine"),r._transform_path_parable=je("transform_path_parable"),r._transform_path_parable_inverse=je("transform_path_parable_inverse"),r._transform_path_top_bottom=je("transform_path_top_bottom"),r._apply_perspective_transform=je("apply_perspective_transform"),r._apply_scale_transform=je("apply_scale_transform"),r._apply_translate_transform=je("apply_translate_transform"),r._transform_set_create=je("transform_set_create"),r._transform_set_delete=je("transform_set_delete"),r._transform_set_set_taper_transform=je("transform_set_set_taper_transform"),r._transform_set_set_top_transformer=je("transform_set_set_top_transformer"),r._transform_set_set_bottom_transformer=je("transform_set_set_bottom_transformer"),r._transform_set_set_top_fish_transformer=je("transform_set_set_top_fish_transformer"),r._transform_set_set_bottom_fish_transformer=je("transform_set_set_bottom_fish_transformer"),r._transform_set_set_top_flag_transformer=je("transform_set_set_top_flag_transformer"),r._transform_set_set_bottom_flag_transformer=je("transform_set_set_bottom_flag_transformer"),r._transform_set_set_top_pit_transformer=je("transform_set_set_top_pit_transformer"),r._transform_set_set_bottom_pit_transformer=je("transform_set_set_bottom_pit_transformer"),r._transform_set_set_top_arc_transformer=je("transform_set_set_top_arc_transformer"),r._transform_set_set_bottom_arc_transformer=je("transform_set_set_bottom_arc_transformer"),r._transform_set_set_arch_transformer=je("transform_set_set_arch_transformer"),r._transform_set_set_cup_transformer=je("transform_set_set_cup_transformer"),r._transform_set_set_turbulence_transformer=je("transform_set_set_turbulence_transformer"),r._transform_set_set_mesh_transformer=je("transform_set_set_mesh_transformer"),r._PathProperties_SetStrokeWidth=je("PathProperties_SetStrokeWidth"),r._PathProperties_SetIsStrokeWidthPercent=je("PathProperties_SetIsStrokeWidthPercent"),r._PathProperties_SetStrokeColorArgb=je("PathProperties_SetStrokeColorArgb"),r._PathProperties_SetFillColorArgb=je("PathProperties_SetFillColorArgb"),r._PathProperties_SetStrokeCap=je("PathProperties_SetStrokeCap"),r._PathProperties_SetStrokeJoin=je("PathProperties_SetStrokeJoin"),r._PathProperties_SetStrokePosition=je("PathProperties_SetStrokePosition"),r._PathProperties_SetMiterLimit=je("PathProperties_SetMiterLimit"),r._PathProperties_SetIsImageMask=je("PathProperties_SetIsImageMask"),r._PathProperties_SetIsClosed=je("PathProperties_SetIsClosed"),r._PathProperties_SetStrokeType=je("PathProperties_SetStrokeType"),r._PathProperties_SetDashGap=je("PathProperties_SetDashGap"),r._PathProperties_SetDashGapDashGap=je("PathProperties_SetDashGapDashGap"),r._OneLineShaper_Create=je("OneLineShaper_Create"),r._OneLineShaper_Destroy=je("OneLineShaper_Destroy"),r._OneLineShaper_GetTransformSetPointer=je("OneLineShaper_GetTransformSetPointer"),r._OneLineShaper_GetTextPathPropertiesPointer=je("OneLineShaper_GetTextPathPropertiesPointer"),r._OneLineShaper_GetEffectsSetPointer=je("OneLineShaper_GetEffectsSetPointer"),r._OneLineShaper_SetText=je("OneLineShaper_SetText"),r._OneLineShaper_SetFont=je("OneLineShaper_SetFont"),r._OneLineShaper_SetSize=je("OneLineShaper_SetSize"),r._OneLineShaper_SetAlignment=je("OneLineShaper_SetAlignment"),r._OneLineShaper_SetUseFontMetrics=je("OneLineShaper_SetUseFontMetrics"),r._OneLineShaper_SetStretch=je("OneLineShaper_SetStretch"),r._TextOnPath_Create=je("TextOnPath_Create"),r._TextOnPath_Destroy=je("TextOnPath_Destroy"),r._TextOnPath_GetTransformSetPointer=je("TextOnPath_GetTransformSetPointer"),r._TextOnPath_GetShapePathPropertiesPointer=je("TextOnPath_GetShapePathPropertiesPointer"),r._TextOnPath_GetTextPathPropertiesPointer=je("TextOnPath_GetTextPathPropertiesPointer"),r._TextOnPath_SetText=je("TextOnPath_SetText"),r._TextOnPath_GetEffectsSetPointer=je("TextOnPath_GetEffectsSetPointer"),r._TextOnPath_SetFont=je("TextOnPath_SetFont"),r._TextOnPath_SetPath=je("TextOnPath_SetPath"),r._TextOnPath_SetSize=je("TextOnPath_SetSize"),r._TextOnPath_SetFontSize=je("TextOnPath_SetFontSize"),r._TextOnPath_SetStartX=je("TextOnPath_SetStartX"),r._TextOnPath_SetHorizontalAlignment=je("TextOnPath_SetHorizontalAlignment"),r._TextOnPath_SetDistance=je("TextOnPath_SetDistance"),r._TextOnPath_SetDistanceIsPercent=je("TextOnPath_SetDistanceIsPercent"),r._TextOnPath_SetHasBoxOpacity=je("TextOnPath_SetHasBoxOpacity"),r._GeneralTransformer_Create=je("GeneralTransformer_Create"),r._GeneralTransformer_Destroy=je("GeneralTransformer_Destroy"),r._GeneralTransformer_GetTransformSetPointer=je("GeneralTransformer_GetTransformSetPointer"),r._GeneralTransformer_GetShapePathPropertiesPointer=je("GeneralTransformer_GetShapePathPropertiesPointer"),r._GeneralTransformer_GetEffectsSetPointer=je("GeneralTransformer_GetEffectsSetPointer"),r._GeneralTransformer_SetPath=je("GeneralTransformer_SetPath"),r._GeneralTransformer_SetSize=je("GeneralTransformer_SetSize"),r._GeneralTransformer_SetHasBoxOpacity=je("GeneralTransformer_SetHasBoxOpacity"),r._GeneralTransformer_BuildPathSvg=je("GeneralTransformer_BuildPathSvg"),r._GeneralTransformer_GetPathSvgByteLength=je("GeneralTransformer_GetPathSvgByteLength"),r._GeneralTransformer_CopyPathSvgToBuffer=je("GeneralTransformer_CopyPathSvgToBuffer"),r._GeneralTransformer_GetAdjustmentTop=je("GeneralTransformer_GetAdjustmentTop"),r._GeneralTransformer_GetAdjustmentLeft=je("GeneralTransformer_GetAdjustmentLeft"),r._GeneralTransformer_GetFinalWidth=je("GeneralTransformer_GetFinalWidth"),r._GeneralTransformer_GetFinalHeight=je("GeneralTransformer_GetFinalHeight"),r._general_transformer_transform_points=je("general_transformer_transform_points"),r._testSetjmp=je("testSetjmp"),r._saveSetjmp=je("saveSetjmp"),r.___getTypeName=je("__getTypeName")),ga=(r.___embind_register_native_and_builtin_types=je("__embind_register_native_and_builtin_types"),r.__get_tzname=je("_get_tzname")),ya=r.__get_daylight=je("_get_daylight"),ba=r.__get_timezone=je("_get_timezone"),va=r.stackSave=je("stackSave"),xa=r.stackRestore=je("stackRestore"),wa=(r.stackAlloc=je("stackAlloc"),r._setThrew=je("setThrew")),_a=r._sbrk=je("sbrk");r._memalign=je("memalign"),r._emscripten_get_sbrk_ptr=je("emscripten_get_sbrk_ptr"),r._emscripten_main_thread_process_queued_calls=je("emscripten_main_thread_process_queued_calls"),r.dynCall_viji=je("dynCall_viji"),r.dynCall_vijiii=je("dynCall_vijiii"),r.dynCall_viiiiij=je("dynCall_viiiiij"),r.dynCall_ji=je("dynCall_ji"),r.dynCall_jii=je("dynCall_jii"),r.dynCall_vijii=je("dynCall_vijii"),r.dynCall_iiij=je("dynCall_iiij"),r.dynCall_viij=je("dynCall_viij"),r.dynCall_iiiij=je("dynCall_iiiij"),r.dynCall_viiij=je("dynCall_viiij"),r.dynCall_iij=je("dynCall_iij"),r.dynCall_vij=je("dynCall_vij"),r.dynCall_jiiii=je("dynCall_jiiii"),r.dynCall_jiiiiii=je("dynCall_jiiiiii"),r.dynCall_iijj=je("dynCall_iijj"),r.dynCall_jijjiii=je("dynCall_jijjiii"),r.dynCall_jijii=je("dynCall_jijii"),r.dynCall_jijiii=je("dynCall_jijiii"),r.dynCall_jijiiiii=je("dynCall_jijiiiii"),r.dynCall_jijj=je("dynCall_jijj"),r.dynCall_jiii=je("dynCall_jiii"),r.dynCall_jijiiii=je("dynCall_jijiiii"),r.dynCall_iijijjji=je("dynCall_iijijjji"),r.dynCall_iiiji=je("dynCall_iiiji"),r.dynCall_iiji=je("dynCall_iiji"),r.dynCall_jijij=je("dynCall_jijij"),r.dynCall_iijijji=je("dynCall_iijijji"),r.dynCall_jij=je("dynCall_jij"),r.dynCall_jiji=je("dynCall_jiji"),r.dynCall_viijii=je("dynCall_viijii"),r.dynCall_iiiiiijj=je("dynCall_iiiiiijj"),r.dynCall_iiiiij=je("dynCall_iiiiij"),r.dynCall_iiiiijj=je("dynCall_iiiiijj");function Sa(e,t){var o=va();try{return C.get(e)(t)}catch(e){if(xa(o),e!==e+0&&"longjmp"!==e)throw e;wa(1,0)}}function Pa(e,t,o){var i=va();try{return C.get(e)(t,o)}catch(e){if(xa(i),e!==e+0&&"longjmp"!==e)throw e;wa(1,0)}}function Ca(e,t,o){var i=va();try{C.get(e)(t,o)}catch(e){if(xa(i),e!==e+0&&"longjmp"!==e)throw e;wa(1,0)}}function Ta(e,t,o,i){var r=va();try{return C.get(e)(t,o,i)}catch(e){if(xa(r),e!==e+0&&"longjmp"!==e)throw e;wa(1,0)}}function Aa(e,t){var o=va();try{C.get(e)(t)}catch(e){if(xa(o),e!==e+0&&"longjmp"!==e)throw e;wa(1,0)}}function Ea(e,t,o,i){var r=va();try{C.get(e)(t,o,i)}catch(e){if(xa(r),e!==e+0&&"longjmp"!==e)throw e;wa(1,0)}}function ka(e,t,o,i,r,s){var n=va();try{return C.get(e)(t,o,i,r,s)}catch(e){if(xa(n),e!==e+0&&"longjmp"!==e)throw e;wa(1,0)}}function Ia(e,t,o,i,r){var s=va();try{C.get(e)(t,o,i,r)}catch(e){if(xa(s),e!==e+0&&"longjmp"!==e)throw e;wa(1,0)}}function Ra(e,t,o,i,r,s,n){var a=va();try{return C.get(e)(t,o,i,r,s,n)}catch(e){if(xa(a),e!==e+0&&"longjmp"!==e)throw e;wa(1,0)}}function Oa(e,t,o,i,r,s){var n=va();try{C.get(e)(t,o,i,r,s)}catch(e){if(xa(n),e!==e+0&&"longjmp"!==e)throw e;wa(1,0)}}function Ma(e,t,o,i,r){var s=va();try{return C.get(e)(t,o,i,r)}catch(e){if(xa(s),e!==e+0&&"longjmp"!==e)throw e;wa(1,0)}}function Ba(e,t,o,i,r,s,n,a,l,c){var d=va();try{C.get(e)(t,o,i,r,s,n,a,l,c)}catch(e){if(xa(d),e!==e+0&&"longjmp"!==e)throw e;wa(1,0)}}function Da(e,t,o,i,r,s,n){var a=va();try{C.get(e)(t,o,i,r,s,n)}catch(e){if(xa(a),e!==e+0&&"longjmp"!==e)throw e;wa(1,0)}}function Fa(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function La(e){function t(){ca||(ca=!0,r.calledRun=!0,z||(Ae(),Ee(),o(r),r.onRuntimeInitialized&&r.onRuntimeInitialized(),N(!r._main,'compiled without a main, but one is present. if you added it from JS, use Module["onRuntimeInitialized"]'),Ie()))}Me>0||(be(),Te(),Me>0||(r.setStatus?(r.setStatus("Running..."),setTimeout((function(){setTimeout((function(){r.setStatus("")}),1),t()}),1)):t(),z||ve()))}function za(){var e=v,t=x,o=!1;v=x=function(e){o=!0};try{Dn&&Dn()}catch(e){}v=e,x=t,o&&(w("stdio streams had content in them that was not flushed. you should set EXIT_RUNTIME to 1 (see the FAQ), or make sure to emit a newline when you printf etc."),w("(this may also be due to not including full filesystem support - try building with -s FORCE_FILESYSTEM=1)"))}function Na(e,t){if(za(),!t||!S||0!==e){if(S){if(!t){var o="program exited (with status: "+e+"), but EXIT_RUNTIME is not set, so halting execution but not exiting the runtime or preventing further async execution (build with EXIT_RUNTIME=1, if you want a true shutdown)";i(o),x(o)}}else ke(),r.onExit&&r.onExit(e),z=!0;l(e,new Fa(e))}}if(Object.getOwnPropertyDescriptor(r,"intArrayFromString")||(r.intArrayFromString=function(){Ne("'intArrayFromString' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"intArrayToString")||(r.intArrayToString=function(){Ne("'intArrayToString' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"ccall")||(r.ccall=function(){Ne("'ccall' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"cwrap")||(r.cwrap=function(){Ne("'cwrap' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"setValue")||(r.setValue=function(){Ne("'setValue' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"getValue")||(r.getValue=function(){Ne("'getValue' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"allocate")||(r.allocate=function(){Ne("'allocate' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"UTF8ArrayToString")||(r.UTF8ArrayToString=function(){Ne("'UTF8ArrayToString' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"UTF8ToString")||(r.UTF8ToString=function(){Ne("'UTF8ToString' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"stringToUTF8Array")||(r.stringToUTF8Array=function(){Ne("'stringToUTF8Array' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"stringToUTF8")||(r.stringToUTF8=function(){Ne("'stringToUTF8' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"lengthBytesUTF8")||(r.lengthBytesUTF8=function(){Ne("'lengthBytesUTF8' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"stackTrace")||(r.stackTrace=function(){Ne("'stackTrace' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"addOnPreRun")||(r.addOnPreRun=function(){Ne("'addOnPreRun' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"addOnInit")||(r.addOnInit=function(){Ne("'addOnInit' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"addOnPreMain")||(r.addOnPreMain=function(){Ne("'addOnPreMain' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"addOnExit")||(r.addOnExit=function(){Ne("'addOnExit' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"addOnPostRun")||(r.addOnPostRun=function(){Ne("'addOnPostRun' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"writeStringToMemory")||(r.writeStringToMemory=function(){Ne("'writeStringToMemory' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"writeArrayToMemory")||(r.writeArrayToMemory=function(){Ne("'writeArrayToMemory' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"writeAsciiToMemory")||(r.writeAsciiToMemory=function(){Ne("'writeAsciiToMemory' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"addRunDependency")||(r.addRunDependency=function(){Ne("'addRunDependency' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(r,"removeRunDependency")||(r.removeRunDependency=function(){Ne("'removeRunDependency' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(r,"FS_createFolder")||(r.FS_createFolder=function(){Ne("'FS_createFolder' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"FS_createPath")||(r.FS_createPath=function(){Ne("'FS_createPath' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(r,"FS_createDataFile")||(r.FS_createDataFile=function(){Ne("'FS_createDataFile' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(r,"FS_createPreloadedFile")||(r.FS_createPreloadedFile=function(){Ne("'FS_createPreloadedFile' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(r,"FS_createLazyFile")||(r.FS_createLazyFile=function(){Ne("'FS_createLazyFile' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(r,"FS_createLink")||(r.FS_createLink=function(){Ne("'FS_createLink' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"FS_createDevice")||(r.FS_createDevice=function(){Ne("'FS_createDevice' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(r,"FS_unlink")||(r.FS_unlink=function(){Ne("'FS_unlink' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(r,"getLEB")||(r.getLEB=function(){Ne("'getLEB' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"getFunctionTables")||(r.getFunctionTables=function(){Ne("'getFunctionTables' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"alignFunctionTables")||(r.alignFunctionTables=function(){Ne("'alignFunctionTables' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"registerFunctions")||(r.registerFunctions=function(){Ne("'registerFunctions' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"addFunction")||(r.addFunction=function(){Ne("'addFunction' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"removeFunction")||(r.removeFunction=function(){Ne("'removeFunction' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"getFuncWrapper")||(r.getFuncWrapper=function(){Ne("'getFuncWrapper' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"prettyPrint")||(r.prettyPrint=function(){Ne("'prettyPrint' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"makeBigInt")||(r.makeBigInt=function(){Ne("'makeBigInt' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"dynCall")||(r.dynCall=function(){Ne("'dynCall' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"getCompilerSetting")||(r.getCompilerSetting=function(){Ne("'getCompilerSetting' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"print")||(r.print=function(){Ne("'print' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"printErr")||(r.printErr=function(){Ne("'printErr' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"getTempRet0")||(r.getTempRet0=function(){Ne("'getTempRet0' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"setTempRet0")||(r.setTempRet0=function(){Ne("'setTempRet0' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"callMain")||(r.callMain=function(){Ne("'callMain' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"abort")||(r.abort=function(){Ne("'abort' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"stringToNewUTF8")||(r.stringToNewUTF8=function(){Ne("'stringToNewUTF8' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"emscripten_realloc_buffer")||(r.emscripten_realloc_buffer=function(){Ne("'emscripten_realloc_buffer' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"ENV")||(r.ENV=function(){Ne("'ENV' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"ERRNO_CODES")||(r.ERRNO_CODES=function(){Ne("'ERRNO_CODES' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"ERRNO_MESSAGES")||(r.ERRNO_MESSAGES=function(){Ne("'ERRNO_MESSAGES' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"setErrNo")||(r.setErrNo=function(){Ne("'setErrNo' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"DNS")||(r.DNS=function(){Ne("'DNS' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"getHostByName")||(r.getHostByName=function(){Ne("'getHostByName' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"GAI_ERRNO_MESSAGES")||(r.GAI_ERRNO_MESSAGES=function(){Ne("'GAI_ERRNO_MESSAGES' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"Protocols")||(r.Protocols=function(){Ne("'Protocols' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"Sockets")||(r.Sockets=function(){Ne("'Sockets' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"getRandomDevice")||(r.getRandomDevice=function(){Ne("'getRandomDevice' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"traverseStack")||(r.traverseStack=function(){Ne("'traverseStack' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"UNWIND_CACHE")||(r.UNWIND_CACHE=function(){Ne("'UNWIND_CACHE' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"withBuiltinMalloc")||(r.withBuiltinMalloc=function(){Ne("'withBuiltinMalloc' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"readAsmConstArgsArray")||(r.readAsmConstArgsArray=function(){Ne("'readAsmConstArgsArray' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"readAsmConstArgs")||(r.readAsmConstArgs=function(){Ne("'readAsmConstArgs' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"mainThreadEM_ASM")||(r.mainThreadEM_ASM=function(){Ne("'mainThreadEM_ASM' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"jstoi_q")||(r.jstoi_q=function(){Ne("'jstoi_q' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"jstoi_s")||(r.jstoi_s=function(){Ne("'jstoi_s' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"getExecutableName")||(r.getExecutableName=function(){Ne("'getExecutableName' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"listenOnce")||(r.listenOnce=function(){Ne("'listenOnce' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"autoResumeAudioContext")||(r.autoResumeAudioContext=function(){Ne("'autoResumeAudioContext' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"dynCallLegacy")||(r.dynCallLegacy=function(){Ne("'dynCallLegacy' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"getDynCaller")||(r.getDynCaller=function(){Ne("'getDynCaller' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"dynCall")||(r.dynCall=function(){Ne("'dynCall' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"callRuntimeCallbacks")||(r.callRuntimeCallbacks=function(){Ne("'callRuntimeCallbacks' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"abortStackOverflow")||(r.abortStackOverflow=function(){Ne("'abortStackOverflow' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"reallyNegative")||(r.reallyNegative=function(){Ne("'reallyNegative' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"unSign")||(r.unSign=function(){Ne("'unSign' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"reSign")||(r.reSign=function(){Ne("'reSign' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"formatString")||(r.formatString=function(){Ne("'formatString' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"PATH")||(r.PATH=function(){Ne("'PATH' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"PATH_FS")||(r.PATH_FS=function(){Ne("'PATH_FS' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"SYSCALLS")||(r.SYSCALLS=function(){Ne("'SYSCALLS' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"syscallMmap2")||(r.syscallMmap2=function(){Ne("'syscallMmap2' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"syscallMunmap")||(r.syscallMunmap=function(){Ne("'syscallMunmap' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"flush_NO_FILESYSTEM")||(r.flush_NO_FILESYSTEM=function(){Ne("'flush_NO_FILESYSTEM' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"JSEvents")||(r.JSEvents=function(){Ne("'JSEvents' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"specialHTMLTargets")||(r.specialHTMLTargets=function(){Ne("'specialHTMLTargets' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"maybeCStringToJsString")||(r.maybeCStringToJsString=function(){Ne("'maybeCStringToJsString' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"findEventTarget")||(r.findEventTarget=function(){Ne("'findEventTarget' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"findCanvasEventTarget")||(r.findCanvasEventTarget=function(){Ne("'findCanvasEventTarget' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"polyfillSetImmediate")||(r.polyfillSetImmediate=function(){Ne("'polyfillSetImmediate' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"demangle")||(r.demangle=function(){Ne("'demangle' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"demangleAll")||(r.demangleAll=function(){Ne("'demangleAll' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"jsStackTrace")||(r.jsStackTrace=function(){Ne("'jsStackTrace' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"stackTrace")||(r.stackTrace=function(){Ne("'stackTrace' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"getEnvStrings")||(r.getEnvStrings=function(){Ne("'getEnvStrings' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"checkWasiClock")||(r.checkWasiClock=function(){Ne("'checkWasiClock' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"writeI53ToI64")||(r.writeI53ToI64=function(){Ne("'writeI53ToI64' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"writeI53ToI64Clamped")||(r.writeI53ToI64Clamped=function(){Ne("'writeI53ToI64Clamped' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"writeI53ToI64Signaling")||(r.writeI53ToI64Signaling=function(){Ne("'writeI53ToI64Signaling' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"writeI53ToU64Clamped")||(r.writeI53ToU64Clamped=function(){Ne("'writeI53ToU64Clamped' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"writeI53ToU64Signaling")||(r.writeI53ToU64Signaling=function(){Ne("'writeI53ToU64Signaling' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"readI53FromI64")||(r.readI53FromI64=function(){Ne("'readI53FromI64' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"readI53FromU64")||(r.readI53FromU64=function(){Ne("'readI53FromU64' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"convertI32PairToI53")||(r.convertI32PairToI53=function(){Ne("'convertI32PairToI53' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"convertU32PairToI53")||(r.convertU32PairToI53=function(){Ne("'convertU32PairToI53' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"exceptionLast")||(r.exceptionLast=function(){Ne("'exceptionLast' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"exceptionCaught")||(r.exceptionCaught=function(){Ne("'exceptionCaught' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"ExceptionInfoAttrs")||(r.ExceptionInfoAttrs=function(){Ne("'ExceptionInfoAttrs' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"ExceptionInfo")||(r.ExceptionInfo=function(){Ne("'ExceptionInfo' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"CatchInfo")||(r.CatchInfo=function(){Ne("'CatchInfo' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"exception_addRef")||(r.exception_addRef=function(){Ne("'exception_addRef' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"exception_decRef")||(r.exception_decRef=function(){Ne("'exception_decRef' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"Browser")||(r.Browser=function(){Ne("'Browser' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"funcWrappers")||(r.funcWrappers=function(){Ne("'funcWrappers' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"getFuncWrapper")||(r.getFuncWrapper=function(){Ne("'getFuncWrapper' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"setMainLoop")||(r.setMainLoop=function(){Ne("'setMainLoop' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"SDL_unicode")||(r.SDL_unicode=function(){Ne("'SDL_unicode' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"SDL_ttfContext")||(r.SDL_ttfContext=function(){Ne("'SDL_ttfContext' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"SDL_audio")||(r.SDL_audio=function(){Ne("'SDL_audio' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"SDL")||(r.SDL=function(){Ne("'SDL' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"SDL_gfx")||(r.SDL_gfx=function(){Ne("'SDL_gfx' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"emval_handle_array")||(r.emval_handle_array=function(){Ne("'emval_handle_array' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"emval_free_list")||(r.emval_free_list=function(){Ne("'emval_free_list' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"emval_symbols")||(r.emval_symbols=function(){Ne("'emval_symbols' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"init_emval")||(r.init_emval=function(){Ne("'init_emval' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"count_emval_handles")||(r.count_emval_handles=function(){Ne("'count_emval_handles' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"get_first_emval")||(r.get_first_emval=function(){Ne("'get_first_emval' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"getStringOrSymbol")||(r.getStringOrSymbol=function(){Ne("'getStringOrSymbol' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"requireHandle")||(r.requireHandle=function(){Ne("'requireHandle' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"emval_newers")||(r.emval_newers=function(){Ne("'emval_newers' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"craftEmvalAllocator")||(r.craftEmvalAllocator=function(){Ne("'craftEmvalAllocator' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"emval_get_global")||(r.emval_get_global=function(){Ne("'emval_get_global' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"emval_methodCallers")||(r.emval_methodCallers=function(){Ne("'emval_methodCallers' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"InternalError")||(r.InternalError=function(){Ne("'InternalError' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"BindingError")||(r.BindingError=function(){Ne("'BindingError' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"UnboundTypeError")||(r.UnboundTypeError=function(){Ne("'UnboundTypeError' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"PureVirtualError")||(r.PureVirtualError=function(){Ne("'PureVirtualError' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"init_embind")||(r.init_embind=function(){Ne("'init_embind' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"throwInternalError")||(r.throwInternalError=function(){Ne("'throwInternalError' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"throwBindingError")||(r.throwBindingError=function(){Ne("'throwBindingError' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"throwUnboundTypeError")||(r.throwUnboundTypeError=function(){Ne("'throwUnboundTypeError' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"ensureOverloadTable")||(r.ensureOverloadTable=function(){Ne("'ensureOverloadTable' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"exposePublicSymbol")||(r.exposePublicSymbol=function(){Ne("'exposePublicSymbol' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"replacePublicSymbol")||(r.replacePublicSymbol=function(){Ne("'replacePublicSymbol' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"extendError")||(r.extendError=function(){Ne("'extendError' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"createNamedFunction")||(r.createNamedFunction=function(){Ne("'createNamedFunction' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"registeredInstances")||(r.registeredInstances=function(){Ne("'registeredInstances' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"getBasestPointer")||(r.getBasestPointer=function(){Ne("'getBasestPointer' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"registerInheritedInstance")||(r.registerInheritedInstance=function(){Ne("'registerInheritedInstance' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"unregisterInheritedInstance")||(r.unregisterInheritedInstance=function(){Ne("'unregisterInheritedInstance' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"getInheritedInstance")||(r.getInheritedInstance=function(){Ne("'getInheritedInstance' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"getInheritedInstanceCount")||(r.getInheritedInstanceCount=function(){Ne("'getInheritedInstanceCount' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"getLiveInheritedInstances")||(r.getLiveInheritedInstances=function(){Ne("'getLiveInheritedInstances' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"registeredTypes")||(r.registeredTypes=function(){Ne("'registeredTypes' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"awaitingDependencies")||(r.awaitingDependencies=function(){Ne("'awaitingDependencies' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"typeDependencies")||(r.typeDependencies=function(){Ne("'typeDependencies' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"registeredPointers")||(r.registeredPointers=function(){Ne("'registeredPointers' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"registerType")||(r.registerType=function(){Ne("'registerType' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"whenDependentTypesAreResolved")||(r.whenDependentTypesAreResolved=function(){Ne("'whenDependentTypesAreResolved' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"embind_charCodes")||(r.embind_charCodes=function(){Ne("'embind_charCodes' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"embind_init_charCodes")||(r.embind_init_charCodes=function(){Ne("'embind_init_charCodes' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"readLatin1String")||(r.readLatin1String=function(){Ne("'readLatin1String' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"getTypeName")||(r.getTypeName=function(){Ne("'getTypeName' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"heap32VectorToArray")||(r.heap32VectorToArray=function(){Ne("'heap32VectorToArray' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"requireRegisteredType")||(r.requireRegisteredType=function(){Ne("'requireRegisteredType' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"getShiftFromSize")||(r.getShiftFromSize=function(){Ne("'getShiftFromSize' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"integerReadValueFromPointer")||(r.integerReadValueFromPointer=function(){Ne("'integerReadValueFromPointer' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"enumReadValueFromPointer")||(r.enumReadValueFromPointer=function(){Ne("'enumReadValueFromPointer' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"floatReadValueFromPointer")||(r.floatReadValueFromPointer=function(){Ne("'floatReadValueFromPointer' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"simpleReadValueFromPointer")||(r.simpleReadValueFromPointer=function(){Ne("'simpleReadValueFromPointer' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"runDestructors")||(r.runDestructors=function(){Ne("'runDestructors' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"new_")||(r.new_=function(){Ne("'new_' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"craftInvokerFunction")||(r.craftInvokerFunction=function(){Ne("'craftInvokerFunction' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"embind__requireFunction")||(r.embind__requireFunction=function(){Ne("'embind__requireFunction' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"tupleRegistrations")||(r.tupleRegistrations=function(){Ne("'tupleRegistrations' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"structRegistrations")||(r.structRegistrations=function(){Ne("'structRegistrations' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"genericPointerToWireType")||(r.genericPointerToWireType=function(){Ne("'genericPointerToWireType' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"constNoSmartPtrRawPointerToWireType")||(r.constNoSmartPtrRawPointerToWireType=function(){Ne("'constNoSmartPtrRawPointerToWireType' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"nonConstNoSmartPtrRawPointerToWireType")||(r.nonConstNoSmartPtrRawPointerToWireType=function(){Ne("'nonConstNoSmartPtrRawPointerToWireType' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"init_RegisteredPointer")||(r.init_RegisteredPointer=function(){Ne("'init_RegisteredPointer' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"RegisteredPointer")||(r.RegisteredPointer=function(){Ne("'RegisteredPointer' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"RegisteredPointer_getPointee")||(r.RegisteredPointer_getPointee=function(){Ne("'RegisteredPointer_getPointee' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"RegisteredPointer_destructor")||(r.RegisteredPointer_destructor=function(){Ne("'RegisteredPointer_destructor' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"RegisteredPointer_deleteObject")||(r.RegisteredPointer_deleteObject=function(){Ne("'RegisteredPointer_deleteObject' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"RegisteredPointer_fromWireType")||(r.RegisteredPointer_fromWireType=function(){Ne("'RegisteredPointer_fromWireType' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"runDestructor")||(r.runDestructor=function(){Ne("'runDestructor' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"releaseClassHandle")||(r.releaseClassHandle=function(){Ne("'releaseClassHandle' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"finalizationGroup")||(r.finalizationGroup=function(){Ne("'finalizationGroup' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"detachFinalizer_deps")||(r.detachFinalizer_deps=function(){Ne("'detachFinalizer_deps' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"detachFinalizer")||(r.detachFinalizer=function(){Ne("'detachFinalizer' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"attachFinalizer")||(r.attachFinalizer=function(){Ne("'attachFinalizer' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"makeClassHandle")||(r.makeClassHandle=function(){Ne("'makeClassHandle' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"init_ClassHandle")||(r.init_ClassHandle=function(){Ne("'init_ClassHandle' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"ClassHandle")||(r.ClassHandle=function(){Ne("'ClassHandle' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"ClassHandle_isAliasOf")||(r.ClassHandle_isAliasOf=function(){Ne("'ClassHandle_isAliasOf' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"throwInstanceAlreadyDeleted")||(r.throwInstanceAlreadyDeleted=function(){Ne("'throwInstanceAlreadyDeleted' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"ClassHandle_clone")||(r.ClassHandle_clone=function(){Ne("'ClassHandle_clone' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"ClassHandle_delete")||(r.ClassHandle_delete=function(){Ne("'ClassHandle_delete' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"deletionQueue")||(r.deletionQueue=function(){Ne("'deletionQueue' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"ClassHandle_isDeleted")||(r.ClassHandle_isDeleted=function(){Ne("'ClassHandle_isDeleted' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"ClassHandle_deleteLater")||(r.ClassHandle_deleteLater=function(){Ne("'ClassHandle_deleteLater' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"flushPendingDeletes")||(r.flushPendingDeletes=function(){Ne("'flushPendingDeletes' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"delayFunction")||(r.delayFunction=function(){Ne("'delayFunction' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"setDelayFunction")||(r.setDelayFunction=function(){Ne("'setDelayFunction' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"RegisteredClass")||(r.RegisteredClass=function(){Ne("'RegisteredClass' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"shallowCopyInternalPointer")||(r.shallowCopyInternalPointer=function(){Ne("'shallowCopyInternalPointer' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"downcastPointer")||(r.downcastPointer=function(){Ne("'downcastPointer' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"upcastPointer")||(r.upcastPointer=function(){Ne("'upcastPointer' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"validateThis")||(r.validateThis=function(){Ne("'validateThis' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"char_0")||(r.char_0=function(){Ne("'char_0' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"char_9")||(r.char_9=function(){Ne("'char_9' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"makeLegalFunctionName")||(r.makeLegalFunctionName=function(){Ne("'makeLegalFunctionName' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"EGL")||(r.EGL=function(){Ne("'EGL' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"tempFixedLengthArray")||(r.tempFixedLengthArray=function(){Ne("'tempFixedLengthArray' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"miniTempWebGLFloatBuffers")||(r.miniTempWebGLFloatBuffers=function(){Ne("'miniTempWebGLFloatBuffers' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"heapObjectForWebGLType")||(r.heapObjectForWebGLType=function(){Ne("'heapObjectForWebGLType' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"heapAccessShiftForWebGLHeap")||(r.heapAccessShiftForWebGLHeap=function(){Ne("'heapAccessShiftForWebGLHeap' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"GL")||(r.GL=function(){Ne("'GL' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"emscriptenWebGLGet")||(r.emscriptenWebGLGet=function(){Ne("'emscriptenWebGLGet' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"computeUnpackAlignedImageSize")||(r.computeUnpackAlignedImageSize=function(){Ne("'computeUnpackAlignedImageSize' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"emscriptenWebGLGetTexPixelData")||(r.emscriptenWebGLGetTexPixelData=function(){Ne("'emscriptenWebGLGetTexPixelData' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"emscriptenWebGLGetUniform")||(r.emscriptenWebGLGetUniform=function(){Ne("'emscriptenWebGLGetUniform' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"emscriptenWebGLGetVertexAttrib")||(r.emscriptenWebGLGetVertexAttrib=function(){Ne("'emscriptenWebGLGetVertexAttrib' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"writeGLArray")||(r.writeGLArray=function(){Ne("'writeGLArray' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"emscriptenWebGLGetIndexed")||(r.emscriptenWebGLGetIndexed=function(){Ne("'emscriptenWebGLGetIndexed' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"warnOnce")||(r.warnOnce=function(){Ne("'warnOnce' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"stackSave")||(r.stackSave=function(){Ne("'stackSave' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"stackRestore")||(r.stackRestore=function(){Ne("'stackRestore' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"stackAlloc")||(r.stackAlloc=function(){Ne("'stackAlloc' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"AsciiToString")||(r.AsciiToString=function(){Ne("'AsciiToString' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"stringToAscii")||(r.stringToAscii=function(){Ne("'stringToAscii' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"UTF16ToString")||(r.UTF16ToString=function(){Ne("'UTF16ToString' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"stringToUTF16")||(r.stringToUTF16=function(){Ne("'stringToUTF16' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"lengthBytesUTF16")||(r.lengthBytesUTF16=function(){Ne("'lengthBytesUTF16' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"UTF32ToString")||(r.UTF32ToString=function(){Ne("'UTF32ToString' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"stringToUTF32")||(r.stringToUTF32=function(){Ne("'stringToUTF32' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"lengthBytesUTF32")||(r.lengthBytesUTF32=function(){Ne("'lengthBytesUTF32' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"allocateUTF8")||(r.allocateUTF8=function(){Ne("'allocateUTF8' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(r,"allocateUTF8OnStack")||(r.allocateUTF8OnStack=function(){Ne("'allocateUTF8OnStack' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),r.writeStackCookie=be,r.checkStackCookie=ve,Object.getOwnPropertyDescriptor(r,"ALLOC_NORMAL")||Object.defineProperty(r,"ALLOC_NORMAL",{configurable:!0,get:function(){Ne("'ALLOC_NORMAL' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}}),Object.getOwnPropertyDescriptor(r,"ALLOC_STACK")||Object.defineProperty(r,"ALLOC_STACK",{configurable:!0,get:function(){Ne("'ALLOC_STACK' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}}),De=function e(){ca||La(),ca||(De=e)},r.run=La,r.preInit)for("function"==typeof r.preInit&&(r.preInit=[r.preInit]);r.preInit.length>0;)r.preInit.pop()();return S=!0,La(),t.ready}}(),$_documentContainer$w=html$1`<dom-module id="lumo-tab" theme-for="vaadin-tab">
  <template>
    <style>
      :host {
        box-sizing: border-box;
        padding: 0.5rem 0.75rem;
        font-family: var(--lumo-font-family);
        font-size: var(--lumo-font-size-m);
        line-height: var(--lumo-line-height-xs);
        font-weight: 500;
        opacity: 1;
        color: var(--lumo-contrast-60pct);
        transition: 0.15s color, 0.2s transform;
        flex-shrink: 0;
        display: flex;
        align-items: center;
        position: relative;
        cursor: pointer;
        transform-origin: 50% 100%;
        outline: none;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        overflow: hidden;
        min-width: var(--lumo-size-m);
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
      }

      :host(:not([orientation="vertical"])) {
        text-align: center;
      }

      :host([orientation="vertical"]) {
        transform-origin: 0% 50%;
        padding: 0.25rem 1rem;
        min-height: var(--lumo-size-m);
        min-width: 0;
      }

      :host(:hover),
      :host([focus-ring]) {
        color: var(--lumo-body-text-color);
      }

      :host([selected]) {
        color: var(--lumo-primary-text-color);
        transition: 0.6s color;
      }

      :host([active]:not([selected])) {
        color: var(--lumo-primary-text-color);
        transition-duration: 0.1s;
      }

      :host::before,
      :host::after {
        content: "";
        position: absolute;
        display: var(--_lumo-tab-marker-display, block);
        bottom: 0;
        left: 50%;
        width: var(--lumo-size-s);
        height: 2px;
        background-color: var(--lumo-contrast-60pct);
        border-radius: var(--lumo-border-radius) var(--lumo-border-radius) 0 0;
        transform: translateX(-50%) scale(0);
        transform-origin: 50% 100%;
        transition: 0.14s transform cubic-bezier(.12, .32, .54, 1);
        will-change: transform;
      }

      :host([selected])::before,
      :host([selected])::after {
        background-color: var(--lumo-primary-color);
      }

      :host([orientation="vertical"])::before,
      :host([orientation="vertical"])::after {
        left: 0;
        bottom: 50%;
        transform: translateY(50%) scale(0);
        width: 2px;
        height: var(--lumo-size-xs);
        border-radius: 0 var(--lumo-border-radius) var(--lumo-border-radius) 0;
        transform-origin: 100% 50%;
      }

      :host::after {
        box-shadow: 0 0 0 4px var(--lumo-primary-color);
        opacity: 0.15;
        transition: 0.15s 0.02s transform, 0.8s 0.17s opacity;
      }

      :host([selected])::before,
      :host([selected])::after {
        transform: translateX(-50%) scale(1);
        transition-timing-function: cubic-bezier(.12, .32, .54, 1.5);
      }

      :host([orientation="vertical"][selected])::before,
      :host([orientation="vertical"][selected])::after {
        transform: translateY(50%) scale(1);
      }

      :host([selected]:not([active]))::after {
        opacity: 0;
      }

      :host(:not([orientation="vertical"])) ::slotted(a[href]) {
        justify-content: center;
      }

      :host ::slotted(a) {
        display: flex;
        width: 100%;
        align-items: center;
        height: 100%;
        margin: -0.5rem -0.75rem;
        padding: 0.5rem 0.75rem;
        outline: none;

        /*
          Override the CSS inherited from \`lumo-color\` and \`lumo-typography\`.
          Note: \`!important\` is needed because of the \`:slotted\` specificity.
        */
        text-decoration: none !important;
        color: inherit !important;
      }

      :host ::slotted(iron-icon) {
        margin: 0 4px;
        width: var(--lumo-icon-size-m);
        height: var(--lumo-icon-size-m);
      }

      /* Vaadin icons are based on a 16x16 grid (unlike Lumo and Material icons with 24x24), so they look too big by default */
      :host ::slotted(iron-icon[icon^="vaadin:"]) {
        padding: 0.25rem;
        box-sizing: border-box !important;
      }

      :host ::slotted(iron-icon:first-child) {
        margin-left: 0;
      }

      :host ::slotted(iron-icon:last-child) {
        margin-right: 0;
      }

      :host([theme~="icon-on-top"]) {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: space-around;
        text-align: center;
        padding-bottom: 0.5rem;
        padding-top: 0.25rem;
      }

      :host([theme~="icon-on-top"]) ::slotted(a) {
        flex-direction: column;
        align-items: center;
        margin-top: -0.25rem;
        padding-top: 0.25rem;
      }

      :host([theme~="icon-on-top"]) ::slotted(iron-icon) {
        margin: 0;
      }

      /* Disabled */

      :host([disabled]) {
        pointer-events: none;
        opacity: 1;
        color: var(--lumo-disabled-text-color);
      }

      /* Focus-ring */

      :host([focus-ring]) {
        box-shadow: inset 0 0 0 2px var(--lumo-primary-color-50pct);
        border-radius: var(--lumo-border-radius);
      }
    </style>
  </template>
</dom-module>`;document.head.appendChild($_documentContainer$w.content);
/**
@license
Copyright (c) 2017 Vaadin Ltd.
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
*/
class TabElement extends(ElementMixin$1(ThemableMixin(ItemMixin(PolymerElement)))){static get template(){return html$1`
    <slot></slot>
`}static get is(){return"vaadin-tab"}static get version(){return"3.0.5"}ready(){super.ready(),this.setAttribute("role","tab")}_onKeyup(e){const t=this.hasAttribute("active");if(super._onKeyup(e),t){const e=this.querySelector("a");e&&e.click()}}}customElements.define(TabElement.is,TabElement);const $_documentContainer$x=html$1`<dom-module id="lumo-tabs" theme-for="vaadin-tabs">
  <template>
    <style>
      :host {
        -webkit-tap-highlight-color: transparent;
      }

      :host(:not([orientation="vertical"])) {
        box-shadow: inset 0 -1px 0 0 var(--lumo-contrast-10pct);
        position: relative;
        min-height: var(--lumo-size-l);
      }

      :host([orientation="horizontal"]) [part="tabs"] ::slotted(vaadin-tab:not([theme~="icon-on-top"])) {
        justify-content: center;
      }

      :host([orientation="vertical"]) {
        box-shadow: -1px 0 0 0 var(--lumo-contrast-10pct);
      }

      :host([orientation="horizontal"]) [part="tabs"] {
        margin: 0 0.75rem;
      }

      :host([orientation="vertical"]) [part="tabs"] {
        width: 100%;
        margin: 0.5rem 0;
      }

      [part="forward-button"],
      [part="back-button"] {
        position: absolute;
        z-index: 1;
        font-family: lumo-icons;
        color: var(--lumo-tertiary-text-color);
        font-size: var(--lumo-icon-size-m);
        display: flex;
        align-items: center;
        justify-content: center;
        width: 1.5em;
        height: 100%;
        transition: 0.2s opacity;
        top: 0;
      }

      [part="forward-button"]:hover,
      [part="back-button"]:hover {
        color: inherit;
      }

      [part="forward-button"] {
        right: 0;
      }

      [part="forward-button"]::after {
        content: var(--lumo-icons-angle-right);
      }

      [part="back-button"]::after {
        content: var(--lumo-icons-angle-left);
      }

      /* Tabs overflow */

      [part="tabs"] {
        --_lumo-tabs-overflow-mask-image: none;
        -webkit-mask-image: var(--_lumo-tabs-overflow-mask-image);
        /* For IE11 */
        min-height: var(--lumo-size-l);
      }

      /*
        TODO: CSS custom property in \`mask-image\` causes crash in Edge
        see https://developer.microsoft.com/en-us/microsoft-edge/platform/issues/15415089/
      */
      @-moz-document url-prefix() {
        [part="tabs"] {
          mask-image: var(--_lumo-tabs-overflow-mask-image);
        }
      }

      /* Horizontal tabs overflow */

      /* Both ends overflowing */
      :host([overflow~="start"][overflow~="end"]:not([orientation="vertical"])) [part="tabs"] {
        --_lumo-tabs-overflow-mask-image: linear-gradient(90deg, transparent 2em, #000 4em, #000 calc(100% - 4em), transparent calc(100% - 2em));
      }

      /* End overflowing */
      :host([overflow~="end"]:not([orientation="vertical"])) [part="tabs"] {
        --_lumo-tabs-overflow-mask-image: linear-gradient(90deg, #000 calc(100% - 4em), transparent calc(100% - 2em));
      }

      /* Start overflowing */
      :host([overflow~="start"]:not([orientation="vertical"])) [part="tabs"] {
        --_lumo-tabs-overflow-mask-image: linear-gradient(90deg, transparent 2em, #000 4em);
      }

      /* Vertical tabs overflow */

      /* Both ends overflowing */
      :host([overflow~="start"][overflow~="end"][orientation="vertical"]) [part="tabs"] {
        --_lumo-tabs-overflow-mask-image: linear-gradient(transparent, #000 2em, #000 calc(100% - 2em), transparent);
      }

      /* End overflowing */
      :host([overflow~="end"][orientation="vertical"]) [part="tabs"] {
        --_lumo-tabs-overflow-mask-image: linear-gradient(#000 calc(100% - 2em), transparent);
      }

      /* Start overflowing */
      :host([overflow~="start"][orientation="vertical"]) [part="tabs"] {
        --_lumo-tabs-overflow-mask-image: linear-gradient(transparent, #000 2em);
      }

      :host [part="tabs"] ::slotted(:not(vaadin-tab)) {
        margin-left: var(--lumo-space-m);
      }

      /* Centered */

      :host([theme~="centered"][orientation="horizontal"]) [part="tabs"] {
        justify-content: center;
      }

      /* Small */

      :host([theme~="small"]),
      :host([theme~="small"]) [part="tabs"] {
        min-height: var(--lumo-size-m);
      }

      :host([theme~="small"]) [part="tabs"] ::slotted(vaadin-tab) {
        font-size: var(--lumo-font-size-s);
      }

      /* Minimal */

      :host([theme~="minimal"]) {
        box-shadow: none;
        /* This doesn't work with ShadyCSS */
        --_lumo-tab-marker-display: none;
      }

      /* Workaround for the above ShadyCSS issue */
      :host([theme~="minimal"]) [part="tabs"] ::slotted(vaadin-tab[selected])::before,
      :host([theme~="minimal"]) [part="tabs"] ::slotted(vaadin-tab[selected])::after {
        display: none;
      }

      /* Hide-scroll-buttons */

      :host([theme~="hide-scroll-buttons"]) [part="back-button"],
      :host([theme~="hide-scroll-buttons"]) [part="forward-button"] {
        display: none;
      }

      :host([theme~="hide-scroll-buttons"][overflow~="start"][overflow~="end"]:not([orientation="vertical"])) [part="tabs"] {
        --_lumo-tabs-overflow-mask-image: linear-gradient(90deg, transparent, #000 2em, #000 calc(100% - 2em), transparent 100%);
      }

      :host([theme~="hide-scroll-buttons"][overflow~="end"]:not([orientation="vertical"])) [part="tabs"] {
        --_lumo-tabs-overflow-mask-image: linear-gradient(90deg, #000 calc(100% - 2em), transparent 100%);
      }

      :host([theme~="hide-scroll-buttons"][overflow~="start"]:not([orientation="vertical"])) [part="tabs"] {
        --_lumo-tabs-overflow-mask-image: linear-gradient(90deg, transparent, #000 2em);
      }

      /* Equal-width tabs */
      :host([theme~="equal-width-tabs"]) {
        flex: auto;
      }

      :host([theme~="equal-width-tabs"]) [part="tabs"] ::slotted(vaadin-tab) {
        flex: 1 0 0%;
      }
    </style>
  </template>
</dom-module>`;document.head.appendChild($_documentContainer$x.content);
/**
@license
Copyright (c) 2017 Vaadin Ltd.
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
*/
const safari10=/Apple.* Version\/(9|10)/.test(navigator.userAgent);class TabsElement extends(ElementMixin$1(ListMixin(ThemableMixin(mixinBehaviors([IronResizableBehavior],PolymerElement))))){static get template(){return html$1`
    <style>
      :host {
        display: flex;
        align-items: center;
      }

      :host([hidden]) {
        display: none !important;
      }

      :host([orientation="vertical"]) {
        display: block;
      }

      :host([orientation="horizontal"]) [part="tabs"] {
        flex-grow: 1;
        display: flex;
        align-self: stretch;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        -ms-overflow-style: none;
      }

      /* This seems more future-proof than \`overflow: -moz-scrollbars-none\` which is marked obsolete
         and is no longer guaranteed to work:
         https://developer.mozilla.org/en-US/docs/Web/CSS/overflow#Mozilla_Extensions */
      @-moz-document url-prefix() {
        :host([orientation="horizontal"]) [part="tabs"] {
          overflow: hidden;
        }
      }

      :host([orientation="horizontal"]) [part="tabs"]::-webkit-scrollbar {
        display: none;
      }

      :host([orientation="vertical"]) [part="tabs"] {
        height: 100%;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
      }

      [part="back-button"],
      [part="forward-button"] {
        pointer-events: none;
        opacity: 0;
        cursor: default;
      }

      :host([overflow~="start"]) [part="back-button"],
      :host([overflow~="end"]) [part="forward-button"] {
        pointer-events: auto;
        opacity: 1;
      }

      [part="back-button"]::after {
        content: '';
      }

      [part="forward-button"]::after {
        content: '';
      }

      :host([orientation="vertical"]) [part="back-button"],
      :host([orientation="vertical"]) [part="forward-button"] {
        display: none;
      }
    </style>
    <div on-click="_scrollBack" part="back-button"></div>

    <div id="scroll" part="tabs">
      <slot></slot>
    </div>

    <div on-click="_scrollForward" part="forward-button"></div>
`}static get is(){return"vaadin-tabs"}static get version(){return"3.0.5"}static get properties(){return{orientation:{value:"horizontal",type:String},selected:{value:0,type:Number}}}static get observers(){return["_updateOverflow(items.*, vertical)"]}ready(){super.ready(),this.addEventListener("iron-resize",(()=>this._updateOverflow())),this._scrollerElement.addEventListener("scroll",(()=>this._updateOverflow())),this.setAttribute("role","tablist"),afterNextRender(this,(()=>{this._updateOverflow()}))}_scrollForward(){this._scroll(this._scrollOffset)}_scrollBack(){this._scroll(-1*this._scrollOffset)}get _scrollOffset(){return this._vertical?this._scrollerElement.offsetHeight:this._scrollerElement.offsetWidth}get _scrollerElement(){return this.$.scroll}_updateOverflow(){const e=this._vertical?this._scrollerElement.scrollTop:this._scrollerElement.scrollLeft;let t=this._vertical?this._scrollerElement.scrollHeight:this._scrollerElement.scrollWidth;t-=1;let o=e>0?"start":"";o+=e+this._scrollOffset<t?" end":"",o?this.setAttribute("overflow",o.trim()):this.removeAttribute("overflow"),this._repaintShadowNodesHack()}_repaintShadowNodesHack(){if(safari10&&this.root){const e="-webkit-backface-visibility";this.root.querySelectorAll("*").forEach((t=>{t.style[e]="visible",t.style[e]=""}))}}}customElements.define(TabsElement.is,TabsElement);var __awaiter$_=function(e,t,o,i){return new(o||(o=Promise))((function(r,s){function n(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))};function attachPrintess(e){var t;return __awaiter$_(this,void 0,void 0,(function*(){if(!e||!e.div)throw"can't attach printess-editor - not div element";config.providedContainerDiv=e.div,e.user&&(config.user=Object.assign(Object.assign({},config.user),e.user),config.user.initials=getInitials(config.user.email)),"eyJhbGciOiJSUzI1NiIsImtpZCI6InByaW50ZXNzLXNhYXMtYWxwaGEiLCJ0eXAiOiJKV1QifQ.eyJzdWIiOiJaMDhkQUpveERuZ3VXVWdyRmNheE1UYkFWclEyIiwianRpIjoiTmY5QTBGYTBuaFpNcG16ZXR5bkdlc3RrLVkyMG50TFkiLCJuYmYiOjE2MTU0Njk5ODcsImV4cCI6MTY0NzAwNTk4NywiaWF0IjoxNjE1NDY5OTg3LCJpc3MiOiJQcmludGVzcyBHbWJIICYgQ28uS0ciLCJhdWQiOiJwcmludGVzcy1zYWFzIn0.fjfjqu-tNVFQqTExjjKjM3X8P4-MWU-zl_9St-6U223j0_dQg-ZYIuFCIh_gQj39JIZbX0H4wxD2pl4Xt8KAPxeKBffKUqm2nIzowpvKwjkR7yG99dFuLeaPfWDZ0_1SBLrHRYaPjz3H3Wb9gCvWuAr4TUHZrPu5C25OVqaQRsT6LROd3tRhWHwJJz0n9gJuIQ75DLJHs-aE0zWzy7Lc-ZDRfTGLg-4-bm418_DQa-kM4ph4Kw12FCCJiIlYkpaVdirBdRQanX1L7OgEbJ2j1f1LyqP_qp_xP9bW-GNIomEn7gWcjY8G1MRv1P3PRACN3r0b0GBJojellq4oGyGbun82_qB3iLO9Vk4Smx8rsW4FFY6Zn9qNkEcAIJ2RBQ4eAHGDzZ-4DF88-czOdjGO5aPUJ8tyteBZgKJTpXHpNqZgWRHRi-My8xc9gFPhkqGapdbYdyakvsnThZcJ5IK66PEUFMFouslbVW_2cAYkAglFSA04gGApXB0cDMWj7cauFBwA-QRKhm9druBtu-ra3YUia-_t0ECvIML6G9ObAawD49l6XijxN8pwkrWA2WSmNVPzX0yHrAd0wbLYi5-cj0Dyi8HifomlpjmHEDXUExpNc2z5SxmLt4RqMNRXKbEDM67NypgPEUpfWGc4OcunXxcnxQxOoioQEYBMnY35qR0"===e.token&&(config.isBuyer=!0,config.buyerOnly=!0),"string"==typeof e.wasmUrl&&e.wasmUrl&&(config.wasmUrl=e.wasmUrl),"string"==typeof e.domain&&e.domain&&(config.domain=e.domain),"string"==typeof e.token&&e.token&&(config.token=e.token),"boolean"==typeof e.updatePageThumbnails&&(config.updatePageThumbnails=e.updatePageThumbnails),"boolean"==typeof e.fullScreenOnMobile&&(config.fullScreenOnMobile=e.fullScreenOnMobile),"boolean"==typeof e.isAutomationMode&&(config.isAutomationMode=e.isAutomationMode),"boolean"==typeof e.isDebugViewBkr&&(config.isDebugViewBkr=e.isDebugViewBkr),"boolean"==typeof e.enableMacros&&(config.enableMacros=e.enableMacros),"boolean"==typeof e.allowZoomAndPan&&(config.allowZoomAndPan=e.allowZoomAndPan),"boolean"==typeof e.showBuyerSide&&(config.isBuyer=e.showBuyerSide),"boolean"==typeof e.hideControls&&(config.hideControls=e.hideControls,config.hideControls&&(config.isBuyer=!0,config.buyerOnly=!0)),"boolean"==typeof e.forceMultilineFormEditing&&(config.forceMultilineFormEditing=e.forceMultilineFormEditing),"boolean"==typeof e.splitMultilineToParagraphs&&(config.splitMultilineToParagraphs=e.splitMultilineToParagraphs),"boolean"==typeof e.enterImageCropingOnSelect&&(config.enterImageCropingOnSelect=e.enterImageCropingOnSelect),"boolean"==typeof e.singleSelectionOnly&&(config.singleSelectionOnly=e.singleSelectionOnly),"boolean"==typeof e.debug&&(config.debug=e.debug),"number"==typeof e.scaledImageMinimumDpi&&(config.scaledImageMinimumDpi=e.scaledImageMinimumDpi),"number"==typeof e.zoomDuration&&(config.zoomDuration=e.zoomDuration),e.uploadProvider&&e.uploadProvider.upload&&(config.uploadProvider=e.uploadProvider),e.loadingFadeCallback&&(config.loadingFadeCallback=e.loadingFadeCallback),e.loadingDoneCallback&&(config.loadingDoneCallback=e.loadingDoneCallback),e.formFieldChangedCallback&&scopeReady((()=>{e.formFieldChangedCallback&&scope().externalFormFieldChangedCallbacks.push(e.formFieldChangedCallback)})),e.selectionChangeCallback&&scopeReady((()=>{e.selectionChangeCallback&&scope().externalSelectionChangedCallbacks.push(e.selectionChangeCallback)})),e.spreadChangeCallback&&scopeReady((()=>{e.spreadChangeCallback&&(scope().externalSpreadChangedCallbacks.push(e.spreadChangeCallback),scope().docUi.externalSpreadChangedCallbacksHaveBeenCalled||scope().docUi.callExternalSpreadChangedCallbacks())})),e.getOverlayCallback&&scopeReady((()=>{e.getOverlayCallback&&scope().externalGetOverlayCallbacks.push(e.getOverlayCallback)})),e.div.innerHTML=printessHtml(config.hideControls?"hide-controls":"buyer"),e.div.style.overflow="hidden";const o=document.querySelector("#content");addStyleSheet(eddiStyles.cssText,eStyleSheetId.eddiCss),addStyleSheet(masterStyles.cssText,eStyleSheetId.masterCss);let i=localStorage.getItem("printess")||"";for(;!i||"03750b204a9aaac5"!==simpleUnsecureHash(i);)i=prompt("Please enter password:");i&&localStorage.getItem("printess")!==i&&localStorage.setItem("printess",i);const r=printess({locateFile:()=>config.wasmUrl});let s;yield loadHarfBuzzEm(r),"new"===e.templateName&&(e.templateName=void 0);let n,a=!1;if(e.templateName)s=yield loadScopeJson(e.templateName),s||alert("Template not found ["+e.templateName+"]");else if(e.templateJson){try{s=JSON.parse(e.templateJson)}catch(e){alert("Can't load template JSON:"+e),s=void 0}s&&(a=!0,e.templateName=s.template.id)}if(e.autoScale&&s){let t=e.autoScale.maxWidth,o=e.autoScale.maxHeight;const i=s.documents.filter((e=>e.data.pri)),r=i.length?i[0]:s.documents[0],n=r.data.pw/r.data.ph,a=r.data.ph/r.data.pw;t*a>e.autoScale.maxHeight&&(t=o*n),o*n>e.autoScale.maxWidth&&(o=t*a),e.div.style.width=t+"px",e.div.style.height=o+"px"}resizePrintess();let l=!1;config.hideControls&&(l=!0),init({stageSelector:"#stage",contentSelector:"#content",scopeName:"",activateWillChange:!1,activateZoomAnimation:!isSafari,initialZoom:0,minZoom:.01,maxZoom:4,bleedY:isMobile()?900:100,bleedX:1e3,edgeScroll:!l,allowZoomAndPan:config.allowZoomAndPan,mousePanOnNoZoomItems:!1,mouseDown_Callback:zoomstageMouseDownCallback,mouseMove_Callback:zoomstageMouseMoveCallback,mouseHover_Callback:zoomstageMouseHoverCallback,mouseUp_Callback:zoomstageMouseUpCallback,mouseLeave_Callback:zoomstageMouseLeaveCallback,mouseOver_Callback:zoomstageMouseOverCallback,zoomChanged_Callback:function(e){scopeReady((()=>{scope().boxSelection.zoom=e,scope().pathEditor.setZoom(e),scope().perspectiveEditor.setZoom(e),scope().meshEditor.setZoom(e),scope().toolbarUi.zoom=e,scope().docUi.isCurrentSpreadInView()||(scope().docUi.currentSpread=scope().docUi.getSpreadInView(),scope().clearSelectionAndAllEditors(scope().docUi.currentSpread)),n&&clearTimeout(n),n=setTimeout((()=>{scope().docUi.setZoom(e)}),100)}))}}),attach(),attachKeyHandler(),document.addEventListener("touchstart",(e=>{e&&e.touches.length>1&&e.preventDefault()}),{passive:!1,capture:!1}),document.addEventListener("touchmove",(e=>{e&&e.touches.length>1&&e.preventDefault()}),{passive:!1,capture:!1}),document.body.addEventListener("blur",(e=>{if(scope()&&"story"===scope().selectedTool){const t=scope().eddiInputElement();e.target!==t&&scope().eddiSetFocus()}}),!0);let c=!1;if(s&&(c=yield loadJsonToLocalStorage(s,a?"loadAlwaysFromServer":void 0),c||alert("Provided Template data is corrupt")),c&&s){if(subscribe(o,e.templateName),!a)if(null===(t=e.mergeTemplates)||void 0===t?void 0:t.length){yield scopeReadyAsync();for(const t of e.mergeTemplates)yield mergeForeignScope(t.templateName,t.templateUserId),clearUndoAndRedos()}else e.replayId&&playerExecute(e.replayId||"")}else if(subscribe(o),!e.showBuyerSide&&!e.hideControls){(new WcDialogOpen).showDialog()}}))}function loadTemplate(e){return __awaiter$_(this,void 0,void 0,(function*(){showSingleTouchOverlay("loading "+e+" ..."),yield loadScope(e,null,"loadAlwaysFromServer"),hideSingleTouchOverlay(),api.resizePrintess(!1),scope().selection=new Selection$1([],null)}))}function getJson(){return JSON.stringify(scope().serializeAll(!0))}function setJson(e){return __awaiter$_(this,void 0,void 0,(function*(){return api.setJson(e)}))}function clearSelection(){return __awaiter$_(this,void 0,void 0,(function*(){return scope().clearSelectionAndAllEditors()}))}function deleteSelectedFrames(){return __awaiter$_(this,void 0,void 0,(function*(){return scope().removeItem()}))}function selectFrames(e){return __awaiter$_(this,void 0,void 0,(function*(){return api.selectFrames(e)}))}function selectSpread(e,t="entire"){return __awaiter$_(this,void 0,void 0,(function*(){return api.selectSpread(e,t)}))}function getAllSpreads(){return __awaiter$_(this,void 0,void 0,(function*(){return api.getAllSpreads()}))}function renderFirstPageImage(e,t="",o=400,i=400){return __awaiter$_(this,void 0,void 0,(function*(){return api.renderFirstPageImage(e,t,o,i)}))}function getFonts(e){return api.getFonts(e)}function getColors(e){return api.getColors(e)}function getImages(e){return api.getImages(e)}function getImagesAsImage(e){return api.getImagesAsImage(e)}function resizePrintess(){return api.resizePrintess()}function insertLayoutSnippet(e){return __awaiter$_(this,void 0,void 0,(function*(){return api.insertLayoutSnippet(e)}))}function insertGroupSnippet(e){return __awaiter$_(this,void 0,void 0,(function*(){return api.insertGroupSnippet(e)}))}function undo$1(){return api.undo()}function redo$1(){return api.redo()}function getAllProperties(){return __awaiter$_(this,void 0,void 0,(function*(){return api.getAllProperties()}))}function getAllPropertiesBySpreadId(e){return __awaiter$_(this,void 0,void 0,(function*(){return api.getAllPropertiesBySpreadId(e)}))}function getAllRequiredProperties(){return __awaiter$_(this,void 0,void 0,(function*(){return api.getAllRequiredProperties()}))}function getAllRequiredPropertiesBySpreadId(e){return __awaiter$_(this,void 0,void 0,(function*(){return api.getAllRequiredPropertiesBySpreadId(e)}))}function getNumberUi(e,t=null){return api.getNumberUi(e,t)}function setNumberUiProperty(e,t=null,o){return __awaiter$_(this,void 0,void 0,(function*(){return api.setNumberUiProperty(e,t,o)}))}function setProperty(e,t){return __awaiter$_(this,void 0,void 0,(function*(){return api.setProperty(e,t)}))}function setTextStyleProperty(e,t,o,i="default"){return __awaiter$_(this,void 0,void 0,(function*(){return api.setTextStyleProperty(e,t,o,i)}))}function setimageMetaProperty(e,t,o){return __awaiter$_(this,void 0,void 0,(function*(){return api.setImageMetaProperty(e,t,o)}))}function setImageMetaProperty(e,t,o){return __awaiter$_(this,void 0,void 0,(function*(){return api.setImageMetaProperty(e,t,o)}))}function resetImageFilters(e){return __awaiter$_(this,void 0,void 0,(function*(){return api.resetImageFilters(e)}))}function uploadImages(e,t,o=!0){return __awaiter$_(this,void 0,void 0,(function*(){return api.uploadImages(e,t,o)}))}function uploadImage$1(e,t,o=!0){return __awaiter$_(this,void 0,void 0,(function*(){return api.uploadImage(e,t,o)}))}function getSerializedImage(e){return api.getSerializedImage(e)}function addSerializedImage(e,t=!0){return __awaiter$_(this,void 0,void 0,(function*(){return api.addSerializedImage(e,t)}))}function zoomstageMouseDownCallback(e,t){scope()&&(scope().isRecording&&scope().e2e.record({module:"index",func:"zoomstageMouseDownCallback",args:[e]}),clearHovers(),scope().blurUiTextEditors(),"WC-DOC"===e.target?setMouseRouting(scope().docUi.mouseDown(e)):"STAGE"===e.target&&scope().clearSelection(),mouseRouting&&mouseRouting.preventDefault&&t&&t.preventDefault(),mouseRouting&&mouseRouting.down&&mouseRouting.down(e),mouseRouting&&mouseRouting.userInteractionStarted&&userInteractionStarted())}function cancelMouseRouting(){setMouseRouting(null)}const allHovers=[];function zoomstageMouseHoverCallback(e,t="hover"){var o,i;if(!scope())return null;if(clearHovers(),scope()&&scope().anyEditorActive())return null;const r="textFlow"===scope().selectedTool,s=null!==(i=null===(o=scope().docUi.getSpreadUnderMouse(e.client.x,e.client.y))||void 0===o?void 0:o.spread)&&void 0!==i?i:scope().docUi.currentSpread,n=s.toHitTestFrames(),a=hitTest(new Rect(e.model.x-s.left(),e.model.y-s.top(),1,1),n,!1),l=scope().docUi.getDivForSelection(s.id);let c=null;if(l){let e=!0;for(const o of a){const i=document.createElement("div");if(i.style.position="absolute",i.style.left=o.left+"px",i.style.top=o.top+"px",i.style.width=o.width+"px",i.style.height=o.height+"px",i.style.border="1px solid pink",i.style.transformOrigin=100*o.rotationPositionX+"% "+100*o.rotationPositionY+"%",i.style.transform="rotate("+o.rotation+"deg)",r){const e=scope().getBox(o.id||"");e&&e.box.id!==scope().textFlowToolActiveBoxId?i.style.border="4px solid #00c940":i.style.border="4px solid red"}else if(e){if(scope().selection.isSelected(o.id||""))continue;if("dropOnBuyerOrderNo"===t){const e=scope().getBox(o.id||"");if(!e||!1!==e.box.lock.isUiElement||"none"===e.box.lock.buyerOrderNo)break;i.style.border="4px solid red",c=e.box}else i.style.border="1px solid rgba(0,0,0,0.3)";e=!1}else i.style.border="1px solid rgba(0,0,0,0.3)";allHovers.push(i),l.appendChild(i);break}}else console.error("Can not attach rubber box.");return c}function clearHovers(){let e;for(;e=allHovers.shift();)e.parentElement&&e.parentElement.removeChild(e)}function zoomstageMouseMoveCallback(e){if(scope()&&mouseRouting&&(mouseRouting.move||mouseRouting.up_once)){if(scope().isRecording&&Date.now()-scope().e2e.lastRecordedActivityTime>100&&scope().e2e.record({module:"index",func:"zoomstageMouseMoveCallback",args:[e]}),e.touches>1)return mouseRouting.up_once&&(mouseRouting.up_once(e,!1),setMouseRouting(null)),void scope().clearSelection();mouseRouting.move&&e.touches<=1&&mouseRouting.move(e)}}function zoomstageMouseUpCallback(e,t){scope()&&(e.touches>0||(mouseRouting&&mouseRouting.up_once&&(scope().isRecording&&scope().e2e.record({module:"index",func:"zoomstageMouseUpCallback",args:[e,t]}),mouseRouting.up_once(e,t)),setMouseRouting(null)))}function zoomstageMouseLeaveCallback(){removeBuyerOverlays()}function zoomstageMouseOverCallback(){drawBuyerOverlays()}function printessHtml(e){return`\n<style>\n  \n  \n  #printess-startup-overlayXX {}\n      position: absolute;\n      z-index: 1000;\n      left: 0;\n      top: 0;\n      right: 0;\n      bottom: 0; \n      overflow: hidden;\n      display: inline-block;\n      cursor: pointer;\n      user-select: none;\n      background-color: rgba(50, 50, 50, 1);\n      opacity: 1;\n      transition-property: opacity;\n      transition-duration: 500ms;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      flex-direction: column;\n  }\n\n  /* style is not loaded on initial show, so logo flashes up in hide-controls mode */\n  \n#mainGrid.hide-controls {\n  grid-template-areas: 'stage';\n  grid-template-rows: 0px;\n  grid-template-columns: 0px;\n}\n\n\n</style>\n \n\x3c!-- launch screen --\x3e\n<div id="printess-startup--overlay">   \n</div>\n\n<div id="clipboard-container"><textarea style="width: 20px; opacity: 0;" id="clipboard-text-area"></textarea></div>\n\n<div id="bkr-test" style="position: absolute; z-index: 5; top: 0; left: 0; display: initial;">\n\x3c!-- <canvas id="bkr-canvas" width="1920" height="1080" style="width: 480px; height: 270px;"></canvas> --\x3e\n\x3c!--  <div id="bkr-drop" style="position: absolute; mix-blend-mode: multiply;"></div>\n<div id="bkr-glow" style="position: absolute; mix-blend-mode: screen;"></div>\n<div id="bkr-image" style="position: absolute;"></div> --\x3e\n</div> \n\n<div class="main-grid ${e}" id="mainGrid" >\n  <div class="doc-selector" id="docSelector" >\n   \n  </div>\n\n  <div id="toolbar">\n  </div>\n\n  <div id="resources" class="resources">\n      \x3c!-- here goes wc-resources --\x3e\n  </div>\n\n  <div id="stage" class="stage">\n      <div id="content" class="content">\n      </div>\n  </div>\n\n  <div id="properties" class="properties">\n      \x3c!-- here goes wc-selection-properties --\x3e\n  </div>\n\n  <div id="buyerPages" class="buyerPages">\n      \n      \x3c!-- here goes pages ui when in buyer mode on desktop --\x3e\n  </div>\n\n  <div id="dataPanel" class="dataPanel">\n      \x3c!-- here goes data ui when NOT in buyer mode  --\x3e\n  </div>\n\n \x3c!-- <div id="footer"></div>--\x3e\n  <div id="resourcesSplitterBar"></div>\n  <div id="propertiesSplitterBar"></div>\n</div>\n\n<div id="copyPasteIndicator"></div>\n \n\n \n`}export{addSerializedImage,attachPrintess,cancelMouseRouting,clearSelection,deleteSelectedFrames,getAllProperties,getAllPropertiesBySpreadId,getAllRequiredProperties,getAllRequiredPropertiesBySpreadId,getAllSpreads,getColors,getFonts,getImages,getImagesAsImage,getJson,getNumberUi,getSerializedImage,insertGroupSnippet,insertLayoutSnippet,loadTemplate,redo$1 as redo,renderFirstPageImage,resetImageFilters,resizePrintess,selectFrames,selectSpread,setImageMetaProperty,setJson,setNumberUiProperty,setProperty,setTextStyleProperty,setimageMetaProperty,undo$1 as undo,uploadImage$1 as uploadImage,uploadImages,zoomstageMouseDownCallback,zoomstageMouseHoverCallback,zoomstageMouseMoveCallback,zoomstageMouseUpCallback};